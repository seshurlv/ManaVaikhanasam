/*
 AngularJS v1.4.7
 (c) 2010-2015 Google, Inc. http://angularjs.org
 License: MIT
*/
(function(Q,X,w){'use strict';function I(b){return function(){var a=arguments[0],c;c="["+(b?b+":":"")+a+"] http://errors.angularjs.org/1.4.7/"+(b?b+"/":"")+a;for(a=1;a<arguments.length;a++){c=c+(1==a?"?":"&")+"p"+(a-1)+"=";var d=encodeURIComponent,e;e=arguments[a];e="function"==typeof e?e.toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof e?"undefined":"string"!=typeof e?JSON.stringify(e):e;c+=d(e)}return Error(c)}}function Da(b){if(null==b||Za(b))return!1;var a="length"in Object(b)&&b.length;
return b.nodeType===pa&&a?!0:G(b)||J(b)||0===a||"number"===typeof a&&0<a&&a-1 in b}function m(b,a,c){var d,e;if(b)if(x(b))for(d in b)"prototype"==d||"length"==d||"name"==d||b.hasOwnProperty&&!b.hasOwnProperty(d)||a.call(c,b[d],d,b);else if(J(b)||Da(b)){var f="object"!==typeof b;d=0;for(e=b.length;d<e;d++)(f||d in b)&&a.call(c,b[d],d,b)}else if(b.forEach&&b.forEach!==m)b.forEach(a,c,b);else if(mc(b))for(d in b)a.call(c,b[d],d,b);else if("function"===typeof b.hasOwnProperty)for(d in b)b.hasOwnProperty(d)&&
a.call(c,b[d],d,b);else for(d in b)ta.call(b,d)&&a.call(c,b[d],d,b);return b}function nc(b,a,c){for(var d=Object.keys(b).sort(),e=0;e<d.length;e++)a.call(c,b[d[e]],d[e]);return d}function oc(b){return function(a,c){b(c,a)}}function Ud(){return++nb}function pc(b,a){a?b.$$hashKey=a:delete b.$$hashKey}function Mb(b,a,c){for(var d=b.$$hashKey,e=0,f=a.length;e<f;++e){var h=a[e];if(C(h)||x(h))for(var g=Object.keys(h),l=0,k=g.length;l<k;l++){var n=g[l],p=h[n];c&&C(p)?ea(p)?b[n]=new Date(p.valueOf()):Oa(p)?
b[n]=new RegExp(p):(C(b[n])||(b[n]=J(p)?[]:{}),Mb(b[n],[p],!0)):b[n]=p}}pc(b,d);return b}function P(b){return Mb(b,ua.call(arguments,1),!1)}function Vd(b){return Mb(b,ua.call(arguments,1),!0)}function Y(b){return parseInt(b,10)}function Nb(b,a){return P(Object.create(b),a)}function y(){}function $a(b){return b}function qa(b){return function(){return b}}function qc(b){return x(b.toString)&&b.toString!==Object.prototype.toString}function v(b){return"undefined"===typeof b}function A(b){return"undefined"!==
typeof b}function C(b){return null!==b&&"object"===typeof b}function mc(b){return null!==b&&"object"===typeof b&&!rc(b)}function G(b){return"string"===typeof b}function V(b){return"number"===typeof b}function ea(b){return"[object Date]"===va.call(b)}function x(b){return"function"===typeof b}function Oa(b){return"[object RegExp]"===va.call(b)}function Za(b){return b&&b.window===b}function ab(b){return b&&b.$evalAsync&&b.$watch}function bb(b){return"boolean"===typeof b}function sc(b){return!(!b||!(b.nodeName||
b.prop&&b.attr&&b.find))}function Wd(b){var a={};b=b.split(",");var c;for(c=0;c<b.length;c++)a[b[c]]=!0;return a}function wa(b){return F(b.nodeName||b[0]&&b[0].nodeName)}function cb(b,a){var c=b.indexOf(a);0<=c&&b.splice(c,1);return c}function ha(b,a,c,d){if(Za(b)||ab(b))throw Ea("cpws");if(tc.test(va.call(a)))throw Ea("cpta");if(a){if(b===a)throw Ea("cpi");c=c||[];d=d||[];C(b)&&(c.push(b),d.push(a));var e;if(J(b))for(e=a.length=0;e<b.length;e++)a.push(ha(b[e],null,c,d));else{var f=a.$$hashKey;J(a)?
a.length=0:m(a,function(b,c){delete a[c]});if(mc(b))for(e in b)a[e]=ha(b[e],null,c,d);else if(b&&"function"===typeof b.hasOwnProperty)for(e in b)b.hasOwnProperty(e)&&(a[e]=ha(b[e],null,c,d));else for(e in b)ta.call(b,e)&&(a[e]=ha(b[e],null,c,d));pc(a,f)}}else if(a=b,C(b)){if(c&&-1!==(f=c.indexOf(b)))return d[f];if(J(b))return ha(b,[],c,d);if(tc.test(va.call(b)))a=new b.constructor(b);else if(ea(b))a=new Date(b.getTime());else if(Oa(b))a=new RegExp(b.source,b.toString().match(/[^\/]*$/)[0]),a.lastIndex=
b.lastIndex;else if(x(b.cloneNode))a=b.cloneNode(!0);else return e=Object.create(rc(b)),ha(b,e,c,d);d&&(c.push(b),d.push(a))}return a}function ja(b,a){if(J(b)){a=a||[];for(var c=0,d=b.length;c<d;c++)a[c]=b[c]}else if(C(b))for(c in a=a||{},b)if("$"!==c.charAt(0)||"$"!==c.charAt(1))a[c]=b[c];return a||b}function ka(b,a){if(b===a)return!0;if(null===b||null===a)return!1;if(b!==b&&a!==a)return!0;var c=typeof b,d;if(c==typeof a&&"object"==c)if(J(b)){if(!J(a))return!1;if((c=b.length)==a.length){for(d=0;d<
c;d++)if(!ka(b[d],a[d]))return!1;return!0}}else{if(ea(b))return ea(a)?ka(b.getTime(),a.getTime()):!1;if(Oa(b))return Oa(a)?b.toString()==a.toString():!1;if(ab(b)||ab(a)||Za(b)||Za(a)||J(a)||ea(a)||Oa(a))return!1;c=fa();for(d in b)if("$"!==d.charAt(0)&&!x(b[d])){if(!ka(b[d],a[d]))return!1;c[d]=!0}for(d in a)if(!(d in c)&&"$"!==d.charAt(0)&&A(a[d])&&!x(a[d]))return!1;return!0}return!1}function db(b,a,c){return b.concat(ua.call(a,c))}function uc(b,a){var c=2<arguments.length?ua.call(arguments,2):[];
return!x(a)||a instanceof RegExp?a:c.length?function(){return arguments.length?a.apply(b,db(c,arguments,0)):a.apply(b,c)}:function(){return arguments.length?a.apply(b,arguments):a.call(b)}}function Xd(b,a){var c=a;"string"===typeof b&&"$"===b.charAt(0)&&"$"===b.charAt(1)?c=w:Za(a)?c="$WINDOW":a&&X===a?c="$DOCUMENT":ab(a)&&(c="$SCOPE");return c}function eb(b,a){if("undefined"===typeof b)return w;V(a)||(a=a?2:null);return JSON.stringify(b,Xd,a)}function vc(b){return G(b)?JSON.parse(b):b}function wc(b,
a){var c=Date.parse("Jan 01, 1970 00:00:00 "+b)/6E4;return isNaN(c)?a:c}function Ob(b,a,c){c=c?-1:1;var d=wc(a,b.getTimezoneOffset());a=b;b=c*(d-b.getTimezoneOffset());a=new Date(a.getTime());a.setMinutes(a.getMinutes()+b);return a}function xa(b){b=B(b).clone();try{b.empty()}catch(a){}var c=B("<div>").append(b).html();try{return b[0].nodeType===Pa?F(c):c.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(a,b){return"<"+F(b)})}catch(d){return F(c)}}function xc(b){try{return decodeURIComponent(b)}catch(a){}}
function yc(b){var a={};m((b||"").split("&"),function(b){var d,e,f;b&&(e=b=b.replace(/\+/g,"%20"),d=b.indexOf("="),-1!==d&&(e=b.substring(0,d),f=b.substring(d+1)),e=xc(e),A(e)&&(f=A(f)?xc(f):!0,ta.call(a,e)?J(a[e])?a[e].push(f):a[e]=[a[e],f]:a[e]=f))});return a}function Pb(b){var a=[];m(b,function(b,d){J(b)?m(b,function(b){a.push(la(d,!0)+(!0===b?"":"="+la(b,!0)))}):a.push(la(d,!0)+(!0===b?"":"="+la(b,!0)))});return a.length?a.join("&"):""}function ob(b){return la(b,!0).replace(/%26/gi,"&").replace(/%3D/gi,
"=").replace(/%2B/gi,"+")}function la(b,a){return encodeURIComponent(b).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,a?"%20":"+")}function Yd(b,a){var c,d,e=Qa.length;for(d=0;d<e;++d)if(c=Qa[d]+a,G(c=b.getAttribute(c)))return c;return null}function Zd(b,a){var c,d,e={};m(Qa,function(a){a+="app";!c&&b.hasAttribute&&b.hasAttribute(a)&&(c=b,d=b.getAttribute(a))});m(Qa,function(a){a+="app";var e;!c&&(e=b.querySelector("["+a.replace(":",
"\\:")+"]"))&&(c=e,d=e.getAttribute(a))});c&&(e.strictDi=null!==Yd(c,"strict-di"),a(c,d?[d]:[],e))}function zc(b,a,c){C(c)||(c={});c=P({strictDi:!1},c);var d=function(){b=B(b);if(b.injector()){var d=b[0]===X?"document":xa(b);throw Ea("btstrpd",d.replace(/</,"&lt;").replace(/>/,"&gt;"));}a=a||[];a.unshift(["$provide",function(a){a.value("$rootElement",b)}]);c.debugInfoEnabled&&a.push(["$compileProvider",function(a){a.debugInfoEnabled(!0)}]);a.unshift("ng");d=fb(a,c.strictDi);d.invoke(["$rootScope",
"$rootElement","$compile","$injector",function(a,b,c,d){a.$apply(function(){b.data("$injector",d);c(b)(a)})}]);return d},e=/^NG_ENABLE_DEBUG_INFO!/,f=/^NG_DEFER_BOOTSTRAP!/;Q&&e.test(Q.name)&&(c.debugInfoEnabled=!0,Q.name=Q.name.replace(e,""));if(Q&&!f.test(Q.name))return d();Q.name=Q.name.replace(f,"");da.resumeBootstrap=function(b){m(b,function(b){a.push(b)});return d()};x(da.resumeDeferredBootstrap)&&da.resumeDeferredBootstrap()}function $d(){Q.name="NG_ENABLE_DEBUG_INFO!"+Q.name;Q.location.reload()}
function ae(b){b=da.element(b).injector();if(!b)throw Ea("test");return b.get("$$testability")}function Ac(b,a){a=a||"_";return b.replace(be,function(b,d){return(d?a:"")+b.toLowerCase()})}function ce(){var b;if(!Bc){var a=pb();(ra=v(a)?Q.jQuery:a?Q[a]:w)&&ra.fn.on?(B=ra,P(ra.fn,{scope:Ra.scope,isolateScope:Ra.isolateScope,controller:Ra.controller,injector:Ra.injector,inheritedData:Ra.inheritedData}),b=ra.cleanData,ra.cleanData=function(a){var d;if(Qb)Qb=!1;else for(var e=0,f;null!=(f=a[e]);e++)(d=
ra._data(f,"events"))&&d.$destroy&&ra(f).triggerHandler("$destroy");b(a)}):B=R;da.element=B;Bc=!0}}function qb(b,a,c){if(!b)throw Ea("areq",a||"?",c||"required");return b}function Sa(b,a,c){c&&J(b)&&(b=b[b.length-1]);qb(x(b),a,"not a function, got "+(b&&"object"===typeof b?b.constructor.name||"Object":typeof b));return b}function Ta(b,a){if("hasOwnProperty"===b)throw Ea("badname",a);}function Cc(b,a,c){if(!a)return b;a=a.split(".");for(var d,e=b,f=a.length,h=0;h<f;h++)d=a[h],b&&(b=(e=b)[d]);return!c&&
x(b)?uc(e,b):b}function rb(b){for(var a=b[0],c=b[b.length-1],d,e=1;a!==c&&(a=a.nextSibling);e++)if(d||b[e]!==a)d||(d=B(ua.call(b,0,e))),d.push(a);return d||b}function fa(){return Object.create(null)}function de(b){function a(a,b,c){return a[b]||(a[b]=c())}var c=I("$injector"),d=I("ng");b=a(b,"angular",Object);b.$$minErr=b.$$minErr||I;return a(b,"module",function(){var b={};return function(f,h,g){if("hasOwnProperty"===f)throw d("badname","module");h&&b.hasOwnProperty(f)&&(b[f]=null);return a(b,f,function(){function a(b,
c,e,f){f||(f=d);return function(){f[e||"push"]([b,c,arguments]);return E}}function b(a,c){return function(b,e){e&&x(e)&&(e.$$moduleName=f);d.push([a,c,arguments]);return E}}if(!h)throw c("nomod",f);var d=[],e=[],r=[],t=a("$injector","invoke","push",e),E={_invokeQueue:d,_configBlocks:e,_runBlocks:r,requires:h,name:f,provider:b("$provide","provider"),factory:b("$provide","factory"),service:b("$provide","service"),value:a("$provide","value"),constant:a("$provide","constant","unshift"),decorator:b("$provide",
"decorator"),animation:b("$animateProvider","register"),filter:b("$filterProvider","register"),controller:b("$controllerProvider","register"),directive:b("$compileProvider","directive"),config:t,run:function(a){r.push(a);return this}};g&&t(g);return E})}})}function ee(b){P(b,{bootstrap:zc,copy:ha,extend:P,merge:Vd,equals:ka,element:B,forEach:m,injector:fb,noop:y,bind:uc,toJson:eb,fromJson:vc,identity:$a,isUndefined:v,isDefined:A,isString:G,isFunction:x,isObject:C,isNumber:V,isElement:sc,isArray:J,
version:fe,isDate:ea,lowercase:F,uppercase:sb,callbacks:{counter:0},getTestability:ae,$$minErr:I,$$csp:Fa,reloadWithDebugInfo:$d});Rb=de(Q);Rb("ng",["ngLocale"],["$provide",function(a){a.provider({$$sanitizeUri:ge});a.provider("$compile",Dc).directive({a:he,input:Ec,textarea:Ec,form:ie,script:je,select:ke,style:le,option:me,ngBind:ne,ngBindHtml:oe,ngBindTemplate:pe,ngClass:qe,ngClassEven:re,ngClassOdd:se,ngCloak:te,ngController:ue,ngForm:ve,ngHide:we,ngIf:xe,ngInclude:ye,ngInit:ze,ngNonBindable:Ae,
ngPluralize:Be,ngRepeat:Ce,ngShow:De,ngStyle:Ee,ngSwitch:Fe,ngSwitchWhen:Ge,ngSwitchDefault:He,ngOptions:Ie,ngTransclude:Je,ngModel:Ke,ngList:Le,ngChange:Me,pattern:Fc,ngPattern:Fc,required:Gc,ngRequired:Gc,minlength:Hc,ngMinlength:Hc,maxlength:Ic,ngMaxlength:Ic,ngValue:Ne,ngModelOptions:Oe}).directive({ngInclude:Pe}).directive(tb).directive(Jc);a.provider({$anchorScroll:Qe,$animate:Re,$animateCss:Se,$$animateQueue:Te,$$AnimateRunner:Ue,$browser:Ve,$cacheFactory:We,$controller:Xe,$document:Ye,$exceptionHandler:Ze,
$filter:Kc,$$forceReflow:$e,$interpolate:af,$interval:bf,$http:cf,$httpParamSerializer:df,$httpParamSerializerJQLike:ef,$httpBackend:ff,$xhrFactory:gf,$location:hf,$log:jf,$parse:kf,$rootScope:lf,$q:mf,$$q:nf,$sce:of,$sceDelegate:pf,$sniffer:qf,$templateCache:rf,$templateRequest:sf,$$testability:tf,$timeout:uf,$window:vf,$$rAF:wf,$$jqLite:xf,$$HashMap:yf,$$cookieReader:zf})}])}function gb(b){return b.replace(Af,function(a,b,d,e){return e?d.toUpperCase():d}).replace(Bf,"Moz$1")}function Lc(b){b=b.nodeType;
return b===pa||!b||9===b}function Mc(b,a){var c,d,e=a.createDocumentFragment(),f=[];if(Sb.test(b)){c=c||e.appendChild(a.createElement("div"));d=(Cf.exec(b)||["",""])[1].toLowerCase();d=ma[d]||ma._default;c.innerHTML=d[1]+b.replace(Df,"<$1></$2>")+d[2];for(d=d[0];d--;)c=c.lastChild;f=db(f,c.childNodes);c=e.firstChild;c.textContent=""}else f.push(a.createTextNode(b));e.textContent="";e.innerHTML="";m(f,function(a){e.appendChild(a)});return e}function R(b){if(b instanceof R)return b;var a;G(b)&&(b=T(b),
a=!0);if(!(this instanceof R)){if(a&&"<"!=b.charAt(0))throw Tb("nosel");return new R(b)}if(a){a=X;var c;b=(c=Ef.exec(b))?[a.createElement(c[1])]:(c=Mc(b,a))?c.childNodes:[]}Nc(this,b)}function Ub(b){return b.cloneNode(!0)}function ub(b,a){a||vb(b);if(b.querySelectorAll)for(var c=b.querySelectorAll("*"),d=0,e=c.length;d<e;d++)vb(c[d])}function Oc(b,a,c,d){if(A(d))throw Tb("offargs");var e=(d=wb(b))&&d.events,f=d&&d.handle;if(f)if(a)m(a.split(" "),function(a){if(A(c)){var d=e[a];cb(d||[],c);if(d&&0<
d.length)return}b.removeEventListener(a,f,!1);delete e[a]});else for(a in e)"$destroy"!==a&&b.removeEventListener(a,f,!1),delete e[a]}function vb(b,a){var c=b.ng339,d=c&&hb[c];d&&(a?delete d.data[a]:(d.handle&&(d.events.$destroy&&d.handle({},"$destroy"),Oc(b)),delete hb[c],b.ng339=w))}function wb(b,a){var c=b.ng339,c=c&&hb[c];a&&!c&&(b.ng339=c=++Ff,c=hb[c]={events:{},data:{},handle:w});return c}function Vb(b,a,c){if(Lc(b)){var d=A(c),e=!d&&a&&!C(a),f=!a;b=(b=wb(b,!e))&&b.data;if(d)b[a]=c;else{if(f)return b;
if(e)return b&&b[a];P(b,a)}}}function xb(b,a){return b.getAttribute?-1<(" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+a+" "):!1}function yb(b,a){a&&b.setAttribute&&m(a.split(" "),function(a){b.setAttribute("class",T((" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+T(a)+" "," ")))})}function zb(b,a){if(a&&b.setAttribute){var c=(" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");m(a.split(" "),function(a){a=T(a);-1===c.indexOf(" "+a+" ")&&
(c+=a+" ")});b.setAttribute("class",T(c))}}function Nc(b,a){if(a)if(a.nodeType)b[b.length++]=a;else{var c=a.length;if("number"===typeof c&&a.window!==a){if(c)for(var d=0;d<c;d++)b[b.length++]=a[d]}else b[b.length++]=a}}function Pc(b,a){return Ab(b,"$"+(a||"ngController")+"Controller")}function Ab(b,a,c){9==b.nodeType&&(b=b.documentElement);for(a=J(a)?a:[a];b;){for(var d=0,e=a.length;d<e;d++)if(A(c=B.data(b,a[d])))return c;b=b.parentNode||11===b.nodeType&&b.host}}function Qc(b){for(ub(b,!0);b.firstChild;)b.removeChild(b.firstChild)}
function Wb(b,a){a||ub(b);var c=b.parentNode;c&&c.removeChild(b)}function Gf(b,a){a=a||Q;if("complete"===a.document.readyState)a.setTimeout(b);else B(a).on("load",b)}function Rc(b,a){var c=Bb[a.toLowerCase()];return c&&Sc[wa(b)]&&c}function Hf(b,a){var c=function(c,e){c.isDefaultPrevented=function(){return c.defaultPrevented};var f=a[e||c.type],h=f?f.length:0;if(h){if(v(c.immediatePropagationStopped)){var g=c.stopImmediatePropagation;c.stopImmediatePropagation=function(){c.immediatePropagationStopped=
!0;c.stopPropagation&&c.stopPropagation();g&&g.call(c)}}c.isImmediatePropagationStopped=function(){return!0===c.immediatePropagationStopped};1<h&&(f=ja(f));for(var l=0;l<h;l++)c.isImmediatePropagationStopped()||f[l].call(b,c)}};c.elem=b;return c}function xf(){this.$get=function(){return P(R,{hasClass:function(b,a){b.attr&&(b=b[0]);return xb(b,a)},addClass:function(b,a){b.attr&&(b=b[0]);return zb(b,a)},removeClass:function(b,a){b.attr&&(b=b[0]);return yb(b,a)}})}}function Ga(b,a){var c=b&&b.$$hashKey;
if(c)return"function"===typeof c&&(c=b.$$hashKey()),c;c=typeof b;return c="function"==c||"object"==c&&null!==b?b.$$hashKey=c+":"+(a||Ud)():c+":"+b}function Ua(b,a){if(a){var c=0;this.nextUid=function(){return++c}}m(b,this.put,this)}function If(b){return(b=b.toString().replace(Tc,"").match(Uc))?"function("+(b[1]||"").replace(/[\s\r\n]+/," ")+")":"fn"}function fb(b,a){function c(a){return function(b,c){if(C(b))m(b,oc(a));else return a(b,c)}}function d(a,b){Ta(a,"service");if(x(b)||J(b))b=r.instantiate(b);
if(!b.$get)throw Ha("pget",a);return p[a+"Provider"]=b}function e(a,b){return function(){var c=E.invoke(b,this);if(v(c))throw Ha("undef",a);return c}}function f(a,b,c){return d(a,{$get:!1!==c?e(a,b):b})}function h(a){qb(v(a)||J(a),"modulesToLoad","not an array");var b=[],c;m(a,function(a){function d(a){var b,c;b=0;for(c=a.length;b<c;b++){var e=a[b],f=r.get(e[0]);f[e[1]].apply(f,e[2])}}if(!n.get(a)){n.put(a,!0);try{G(a)?(c=Rb(a),b=b.concat(h(c.requires)).concat(c._runBlocks),d(c._invokeQueue),d(c._configBlocks)):
x(a)?b.push(r.invoke(a)):J(a)?b.push(r.invoke(a)):Sa(a,"module")}catch(e){throw J(a)&&(a=a[a.length-1]),e.message&&e.stack&&-1==e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),Ha("modulerr",a,e.stack||e.message||e);}}});return b}function g(b,c){function d(a,e){if(b.hasOwnProperty(a)){if(b[a]===l)throw Ha("cdep",a+" <- "+k.join(" <- "));return b[a]}try{return k.unshift(a),b[a]=l,b[a]=c(a,e)}catch(f){throw b[a]===l&&delete b[a],f;}finally{k.shift()}}function e(b,c,f,g){"string"===typeof f&&(g=
f,f=null);var h=[],k=fb.$$annotate(b,a,g),l,r,p;r=0;for(l=k.length;r<l;r++){p=k[r];if("string"!==typeof p)throw Ha("itkn",p);h.push(f&&f.hasOwnProperty(p)?f[p]:d(p,g))}J(b)&&(b=b[l]);return b.apply(c,h)}return{invoke:e,instantiate:function(a,b,c){var d=Object.create((J(a)?a[a.length-1]:a).prototype||null);a=e(a,d,b,c);return C(a)||x(a)?a:d},get:d,annotate:fb.$$annotate,has:function(a){return p.hasOwnProperty(a+"Provider")||b.hasOwnProperty(a)}}}a=!0===a;var l={},k=[],n=new Ua([],!0),p={$provide:{provider:c(d),
factory:c(f),service:c(function(a,b){return f(a,["$injector",function(a){return a.instantiate(b)}])}),value:c(function(a,b){return f(a,qa(b),!1)}),constant:c(function(a,b){Ta(a,"constant");p[a]=b;t[a]=b}),decorator:function(a,b){var c=r.get(a+"Provider"),d=c.$get;c.$get=function(){var a=E.invoke(d,c);return E.invoke(b,null,{$delegate:a})}}}},r=p.$injector=g(p,function(a,b){da.isString(b)&&k.push(b);throw Ha("unpr",k.join(" <- "));}),t={},E=t.$injector=g(t,function(a,b){var c=r.get(a+"Provider",b);
return E.invoke(c.$get,c,w,a)});m(h(b),function(a){a&&E.invoke(a)});return E}function Qe(){var b=!0;this.disableAutoScrolling=function(){b=!1};this.$get=["$window","$location","$rootScope",function(a,c,d){function e(a){var b=null;Array.prototype.some.call(a,function(a){if("a"===wa(a))return b=a,!0});return b}function f(b){if(b){b.scrollIntoView();var c;c=h.yOffset;x(c)?c=c():sc(c)?(c=c[0],c="fixed"!==a.getComputedStyle(c).position?0:c.getBoundingClientRect().bottom):V(c)||(c=0);c&&(b=b.getBoundingClientRect().top,
a.scrollBy(0,b-c))}else a.scrollTo(0,0)}function h(a){a=G(a)?a:c.hash();var b;a?(b=g.getElementById(a))?f(b):(b=e(g.getElementsByName(a)))?f(b):"top"===a&&f(null):f(null)}var g=a.document;b&&d.$watch(function(){return c.hash()},function(a,b){a===b&&""===a||Gf(function(){d.$evalAsync(h)})});return h}]}function ib(b,a){if(!b&&!a)return"";if(!b)return a;if(!a)return b;J(b)&&(b=b.join(" "));J(a)&&(a=a.join(" "));return b+" "+a}function Jf(b){G(b)&&(b=b.split(" "));var a=fa();m(b,function(b){b.length&&
(a[b]=!0)});return a}function Ia(b){return C(b)?b:{}}function Kf(b,a,c,d){function e(a){try{a.apply(null,ua.call(arguments,1))}finally{if(E--,0===E)for(;K.length;)try{K.pop()()}catch(b){c.error(b)}}}function f(){ia=null;h();g()}function h(){a:{try{u=n.state;break a}catch(a){}u=void 0}u=v(u)?null:u;ka(u,L)&&(u=L);L=u}function g(){if(z!==l.url()||q!==u)z=l.url(),q=u,m(O,function(a){a(l.url(),u)})}var l=this,k=b.location,n=b.history,p=b.setTimeout,r=b.clearTimeout,t={};l.isMock=!1;var E=0,K=[];l.$$completeOutstandingRequest=
e;l.$$incOutstandingRequestCount=function(){E++};l.notifyWhenNoOutstandingRequests=function(a){0===E?a():K.push(a)};var u,q,z=k.href,N=a.find("base"),ia=null;h();q=u;l.url=function(a,c,e){v(e)&&(e=null);k!==b.location&&(k=b.location);n!==b.history&&(n=b.history);if(a){var f=q===e;if(z===a&&(!d.history||f))return l;var g=z&&Ja(z)===Ja(a);z=a;q=e;if(!d.history||g&&f){if(!g||ia)ia=a;c?k.replace(a):g?(c=k,e=a.indexOf("#"),e=-1===e?"":a.substr(e),c.hash=e):k.href=a;k.href!==a&&(ia=a)}else n[c?"replaceState":
"pushState"](e,"",a),h(),q=u;return l}return ia||k.href.replace(/%27/g,"'")};l.state=function(){return u};var O=[],H=!1,L=null;l.onUrlChange=function(a){if(!H){if(d.history)B(b).on("popstate",f);B(b).on("hashchange",f);H=!0}O.push(a);return a};l.$$applicationDestroyed=function(){B(b).off("hashchange popstate",f)};l.$$checkUrlChange=g;l.baseHref=function(){var a=N.attr("href");return a?a.replace(/^(https?\:)?\/\/[^\/]*/,""):""};l.defer=function(a,b){var c;E++;c=p(function(){delete t[c];e(a)},b||0);
t[c]=!0;return c};l.defer.cancel=function(a){return t[a]?(delete t[a],r(a),e(y),!0):!1}}function Ve(){this.$get=["$window","$log","$sniffer","$document",function(b,a,c,d){return new Kf(b,d,a,c)}]}function We(){this.$get=function(){function b(b,d){function e(a){a!=p&&(r?r==a&&(r=a.n):r=a,f(a.n,a.p),f(a,p),p=a,p.n=null)}function f(a,b){a!=b&&(a&&(a.p=b),b&&(b.n=a))}if(b in a)throw I("$cacheFactory")("iid",b);var h=0,g=P({},d,{id:b}),l={},k=d&&d.capacity||Number.MAX_VALUE,n={},p=null,r=null;return a[b]=
{put:function(a,b){if(!v(b)){if(k<Number.MAX_VALUE){var c=n[a]||(n[a]={key:a});e(c)}a in l||h++;l[a]=b;h>k&&this.remove(r.key);return b}},get:function(a){if(k<Number.MAX_VALUE){var b=n[a];if(!b)return;e(b)}return l[a]},remove:function(a){if(k<Number.MAX_VALUE){var b=n[a];if(!b)return;b==p&&(p=b.p);b==r&&(r=b.n);f(b.n,b.p);delete n[a]}delete l[a];h--},removeAll:function(){l={};h=0;n={};p=r=null},destroy:function(){n=g=l=null;delete a[b]},info:function(){return P({},g,{size:h})}}}var a={};b.info=function(){var b=
{};m(a,function(a,e){b[e]=a.info()});return b};b.get=function(b){return a[b]};return b}}function rf(){this.$get=["$cacheFactory",function(b){return b("templates")}]}function Dc(b,a){function c(a,b,c){var d=/^\s*([@&]|=(\*?))(\??)\s*(\w*)\s*$/,e={};m(a,function(a,f){var g=a.match(d);if(!g)throw ga("iscp",b,f,a,c?"controller bindings definition":"isolate scope definition");e[f]={mode:g[1][0],collection:"*"===g[2],optional:"?"===g[3],attrName:g[4]||f}});return e}function d(a){var b=a.charAt(0);if(!b||
b!==F(b))throw ga("baddir",a);if(a!==a.trim())throw ga("baddir",a);}var e={},f=/^\s*directive\:\s*([\w\-]+)\s+(.*)$/,h=/(([\w\-]+)(?:\:([^;]+))?;?)/,g=Wd("ngSrc,ngSrcset,src,srcset"),l=/^(?:(\^\^?)?(\?)?(\^\^?)?)?/,k=/^(on[a-z]+|formaction)$/;this.directive=function r(a,f){Ta(a,"directive");G(a)?(d(a),qb(f,"directiveFactory"),e.hasOwnProperty(a)||(e[a]=[],b.factory(a+"Directive",["$injector","$exceptionHandler",function(b,d){var f=[];m(e[a],function(e,g){try{var h=b.invoke(e);x(h)?h={compile:qa(h)}:
!h.compile&&h.link&&(h.compile=qa(h.link));h.priority=h.priority||0;h.index=g;h.name=h.name||a;h.require=h.require||h.controller&&h.name;h.restrict=h.restrict||"EA";var k=h,l=h,r=h.name,n={isolateScope:null,bindToController:null};C(l.scope)&&(!0===l.bindToController?(n.bindToController=c(l.scope,r,!0),n.isolateScope={}):n.isolateScope=c(l.scope,r,!1));C(l.bindToController)&&(n.bindToController=c(l.bindToController,r,!0));if(C(n.bindToController)){var S=l.controller,E=l.controllerAs;if(!S)throw ga("noctrl",
r);var ca;a:if(E&&G(E))ca=E;else{if(G(S)){var m=Vc.exec(S);if(m){ca=m[3];break a}}ca=void 0}if(!ca)throw ga("noident",r);}var s=k.$$bindings=n;C(s.isolateScope)&&(h.$$isolateBindings=s.isolateScope);h.$$moduleName=e.$$moduleName;f.push(h)}catch(w){d(w)}});return f}])),e[a].push(f)):m(a,oc(r));return this};this.aHrefSanitizationWhitelist=function(b){return A(b)?(a.aHrefSanitizationWhitelist(b),this):a.aHrefSanitizationWhitelist()};this.imgSrcSanitizationWhitelist=function(b){return A(b)?(a.imgSrcSanitizationWhitelist(b),
this):a.imgSrcSanitizationWhitelist()};var n=!0;this.debugInfoEnabled=function(a){return A(a)?(n=a,this):n};this.$get=["$injector","$interpolate","$exceptionHandler","$templateRequest","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(a,b,c,d,u,q,z,N,ia,O,H){function L(a,b){try{a.addClass(b)}catch(c){}}function W(a,b,c,d,e){a instanceof B||(a=B(a));m(a,function(b,c){b.nodeType==Pa&&b.nodeValue.match(/\S+/)&&(a[c]=B(b).wrap("<span></span>").parent()[0])});var f=
S(a,b,a,c,d,e);W.$$addScopeClass(a);var g=null;return function(b,c,d){qb(b,"scope");d=d||{};var e=d.parentBoundTranscludeFn,h=d.transcludeControllers;d=d.futureParentElement;e&&e.$$boundTransclude&&(e=e.$$boundTransclude);g||(g=(d=d&&d[0])?"foreignobject"!==wa(d)&&d.toString().match(/SVG/)?"svg":"html":"html");d="html"!==g?B(Xb(g,B("<div>").append(a).html())):c?Ra.clone.call(a):a;if(h)for(var k in h)d.data("$"+k+"Controller",h[k].instance);W.$$addScopeInfo(d,b);c&&c(d,b);f&&f(b,d,d,e);return d}}function S(a,
b,c,d,e,f){function g(a,c,d,e){var f,k,l,r,n,t,O;if(q)for(O=Array(c.length),r=0;r<h.length;r+=3)f=h[r],O[f]=c[f];else O=c;r=0;for(n=h.length;r<n;)if(k=O[h[r++]],c=h[r++],f=h[r++],c){if(c.scope){if(l=a.$new(),W.$$addScopeInfo(B(k),l),t=c.$$destroyBindings)c.$$destroyBindings=null,l.$on("$destroyed",t)}else l=a;t=c.transcludeOnThisElement?ba(a,c.transclude,e):!c.templateOnThisElement&&e?e:!e&&b?ba(a,b):null;c(f,l,k,d,t,c)}else f&&f(a,k.childNodes,w,e)}for(var h=[],k,l,r,n,q,t=0;t<a.length;t++){k=new Z;
l=ca(a[t],[],k,0===t?d:w,e);(f=l.length?D(l,a[t],k,b,c,null,[],[],f):null)&&f.scope&&W.$$addScopeClass(k.$$element);k=f&&f.terminal||!(r=a[t].childNodes)||!r.length?null:S(r,f?(f.transcludeOnThisElement||!f.templateOnThisElement)&&f.transclude:b);if(f||k)h.push(t,f,k),n=!0,q=q||f;f=null}return n?g:null}function ba(a,b,c){return function(d,e,f,g,h){d||(d=a.$new(!1,h),d.$$transcluded=!0);return b(d,e,{parentBoundTranscludeFn:c,transcludeControllers:f,futureParentElement:g})}}function ca(a,b,c,d,e){var g=
c.$attr,k;switch(a.nodeType){case pa:na(b,ya(wa(a)),"E",d,e);for(var l,r,n,q=a.attributes,t=0,O=q&&q.length;t<O;t++){var K=!1,H=!1;l=q[t];k=l.name;r=T(l.value);l=ya(k);if(n=ja.test(l))k=k.replace(Wc,"").substr(8).replace(/_(.)/g,function(a,b){return b.toUpperCase()});var S=l.replace(/(Start|End)$/,"");I(S)&&l===S+"Start"&&(K=k,H=k.substr(0,k.length-5)+"end",k=k.substr(0,k.length-6));l=ya(k.toLowerCase());g[l]=k;if(n||!c.hasOwnProperty(l))c[l]=r,Rc(a,l)&&(c[l]=!0);V(a,b,r,l,n);na(b,l,"A",d,e,K,H)}a=
a.className;C(a)&&(a=a.animVal);if(G(a)&&""!==a)for(;k=h.exec(a);)l=ya(k[2]),na(b,l,"C",d,e)&&(c[l]=T(k[3])),a=a.substr(k.index+k[0].length);break;case Pa:if(11===Wa)for(;a.parentNode&&a.nextSibling&&a.nextSibling.nodeType===Pa;)a.nodeValue+=a.nextSibling.nodeValue,a.parentNode.removeChild(a.nextSibling);Ka(b,a.nodeValue);break;case 8:try{if(k=f.exec(a.nodeValue))l=ya(k[1]),na(b,l,"M",d,e)&&(c[l]=T(k[2]))}catch(E){}}b.sort(M);return b}function za(a,b,c){var d=[],e=0;if(b&&a.hasAttribute&&a.hasAttribute(b)){do{if(!a)throw ga("uterdir",
b,c);a.nodeType==pa&&(a.hasAttribute(b)&&e++,a.hasAttribute(c)&&e--);d.push(a);a=a.nextSibling}while(0<e)}else d.push(a);return B(d)}function s(a,b,c){return function(d,e,f,g,h){e=za(e[0],b,c);return a(d,e,f,g,h)}}function D(a,b,d,e,f,g,h,k,r){function n(a,b,c,d){if(a){c&&(a=s(a,c,d));a.require=D.require;a.directiveName=y;if(u===D||D.$$isolateScope)a=$(a,{isolateScope:!0});h.push(a)}if(b){c&&(b=s(b,c,d));b.require=D.require;b.directiveName=y;if(u===D||D.$$isolateScope)b=$(b,{isolateScope:!0});k.push(b)}}
function t(a,b,c,d){var e;if(G(b)){var f=b.match(l);b=b.substring(f[0].length);var g=f[1]||f[3],f="?"===f[2];"^^"===g?c=c.parent():e=(e=d&&d[b])&&e.instance;e||(d="$"+b+"Controller",e=g?c.inheritedData(d):c.data(d));if(!e&&!f)throw ga("ctreq",b,a);}else if(J(b))for(e=[],g=0,f=b.length;g<f;g++)e[g]=t(a,b[g],c,d);return e||null}function O(a,b,c,d,e,f){var g=fa(),h;for(h in d){var k=d[h],l={$scope:k===u||k.$$isolateScope?e:f,$element:a,$attrs:b,$transclude:c},r=k.controller;"@"==r&&(r=b[k.name]);l=q(r,
l,!0,k.controllerAs);g[k.name]=l;ia||a.data("$"+k.name+"Controller",l.instance)}return g}function K(a,c,e,f,g,l){function r(a,b,c){var d;ab(a)||(c=b,b=a,a=w);ia&&(d=ca);c||(c=ia?N.parent():N);return g(a,b,d,c,za)}var n,q,H,E,ca,z,N;b===e?(f=d,N=d.$$element):(N=B(e),f=new Z(N,d));u&&(E=c.$new(!0));g&&(z=r,z.$$boundTransclude=g);ba&&(ca=O(N,f,z,ba,E,c));u&&(W.$$addScopeInfo(N,E,!0,!(L&&(L===u||L===u.$$originalDirective))),W.$$addScopeClass(N,!0),E.$$isolateBindings=u.$$isolateBindings,Y(c,f,E,E.$$isolateBindings,
u,E));if(ca){var Va=u||S,m;Va&&ca[Va.name]&&(q=Va.$$bindings.bindToController,(H=ca[Va.name])&&H.identifier&&q&&(m=H,l.$$destroyBindings=Y(c,f,H.instance,q,Va)));for(n in ca){H=ca[n];var D=H();D!==H.instance&&(H.instance=D,N.data("$"+n+"Controller",D),H===m&&(l.$$destroyBindings(),l.$$destroyBindings=Y(c,f,D,q,Va)))}}n=0;for(l=h.length;n<l;n++)q=h[n],aa(q,q.isolateScope?E:c,N,f,q.require&&t(q.directiveName,q.require,N,ca),z);var za=c;u&&(u.template||null===u.templateUrl)&&(za=E);a&&a(za,e.childNodes,
w,g);for(n=k.length-1;0<=n;n--)q=k[n],aa(q,q.isolateScope?E:c,N,f,q.require&&t(q.directiveName,q.require,N,ca),z)}r=r||{};for(var H=-Number.MAX_VALUE,S=r.newScopeDirective,ba=r.controllerDirectives,u=r.newIsolateScopeDirective,L=r.templateDirective,z=r.nonTlbTranscludeDirective,N=!1,m=!1,ia=r.hasElementTranscludeDirective,v=d.$$element=B(b),D,y,M,Ka=e,na,I=0,F=a.length;I<F;I++){D=a[I];var P=D.$$start,R=D.$$end;P&&(v=za(b,P,R));M=w;if(H>D.priority)break;if(M=D.scope)D.templateUrl||(C(M)?(Q("new/isolated scope",
u||S,D,v),u=D):Q("new/isolated scope",u,D,v)),S=S||D;y=D.name;!D.templateUrl&&D.controller&&(M=D.controller,ba=ba||fa(),Q("'"+y+"' controller",ba[y],D,v),ba[y]=D);if(M=D.transclude)N=!0,D.$$tlb||(Q("transclusion",z,D,v),z=D),"element"==M?(ia=!0,H=D.priority,M=v,v=d.$$element=B(X.createComment(" "+y+": "+d[y]+" ")),b=v[0],U(f,ua.call(M,0),b),Ka=W(M,e,H,g&&g.name,{nonTlbTranscludeDirective:z})):(M=B(Ub(b)).contents(),v.empty(),Ka=W(M,e));if(D.template)if(m=!0,Q("template",L,D,v),L=D,M=x(D.template)?
D.template(v,d):D.template,M=ha(M),D.replace){g=D;M=Sb.test(M)?Xc(Xb(D.templateNamespace,T(M))):[];b=M[0];if(1!=M.length||b.nodeType!==pa)throw ga("tplrt",y,"");U(f,v,b);F={$attr:{}};M=ca(b,[],F);var Lf=a.splice(I+1,a.length-(I+1));u&&A(M);a=a.concat(M).concat(Lf);Yc(d,F);F=a.length}else v.html(M);if(D.templateUrl)m=!0,Q("template",L,D,v),L=D,D.replace&&(g=D),K=Mf(a.splice(I,a.length-I),v,d,f,N&&Ka,h,k,{controllerDirectives:ba,newScopeDirective:S!==D&&S,newIsolateScopeDirective:u,templateDirective:L,
nonTlbTranscludeDirective:z}),F=a.length;else if(D.compile)try{na=D.compile(v,d,Ka),x(na)?n(null,na,P,R):na&&n(na.pre,na.post,P,R)}catch(V){c(V,xa(v))}D.terminal&&(K.terminal=!0,H=Math.max(H,D.priority))}K.scope=S&&!0===S.scope;K.transcludeOnThisElement=N;K.templateOnThisElement=m;K.transclude=Ka;r.hasElementTranscludeDirective=ia;return K}function A(a){for(var b=0,c=a.length;b<c;b++)a[b]=Nb(a[b],{$$isolateScope:!0})}function na(b,d,f,g,h,k,l){if(d===h)return null;h=null;if(e.hasOwnProperty(d)){var n;
d=a.get(d+"Directive");for(var q=0,t=d.length;q<t;q++)try{n=d[q],(v(g)||g>n.priority)&&-1!=n.restrict.indexOf(f)&&(k&&(n=Nb(n,{$$start:k,$$end:l})),b.push(n),h=n)}catch(H){c(H)}}return h}function I(b){if(e.hasOwnProperty(b))for(var c=a.get(b+"Directive"),d=0,f=c.length;d<f;d++)if(b=c[d],b.multiElement)return!0;return!1}function Yc(a,b){var c=b.$attr,d=a.$attr,e=a.$$element;m(a,function(d,e){"$"!=e.charAt(0)&&(b[e]&&b[e]!==d&&(d+=("style"===e?";":" ")+b[e]),a.$set(e,d,!0,c[e]))});m(b,function(b,f){"class"==
f?(L(e,b),a["class"]=(a["class"]?a["class"]+" ":"")+b):"style"==f?(e.attr("style",e.attr("style")+";"+b),a.style=(a.style?a.style+";":"")+b):"$"==f.charAt(0)||a.hasOwnProperty(f)||(a[f]=b,d[f]=c[f])})}function Mf(a,b,c,e,f,g,h,k){var l=[],r,n,q=b[0],t=a.shift(),H=Nb(t,{templateUrl:null,transclude:null,replace:null,$$originalDirective:t}),O=x(t.templateUrl)?t.templateUrl(b,c):t.templateUrl,E=t.templateNamespace;b.empty();d(O).then(function(d){var K,u;d=ha(d);if(t.replace){d=Sb.test(d)?Xc(Xb(E,T(d))):
[];K=d[0];if(1!=d.length||K.nodeType!==pa)throw ga("tplrt",t.name,O);d={$attr:{}};U(e,b,K);var z=ca(K,[],d);C(t.scope)&&A(z);a=z.concat(a);Yc(c,d)}else K=q,b.html(d);a.unshift(H);r=D(a,K,c,f,b,t,g,h,k);m(e,function(a,c){a==K&&(e[c]=b[0])});for(n=S(b[0].childNodes,f);l.length;){d=l.shift();u=l.shift();var N=l.shift(),W=l.shift(),z=b[0];if(!d.$$destroyed){if(u!==q){var za=u.className;k.hasElementTranscludeDirective&&t.replace||(z=Ub(K));U(N,B(u),z);L(B(z),za)}u=r.transcludeOnThisElement?ba(d,r.transclude,
W):W;r(n,d,z,e,u,r)}}l=null});return function(a,b,c,d,e){a=e;b.$$destroyed||(l?l.push(b,c,d,a):(r.transcludeOnThisElement&&(a=ba(b,r.transclude,e)),r(n,b,c,d,a,r)))}}function M(a,b){var c=b.priority-a.priority;return 0!==c?c:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function Q(a,b,c,d){function e(a){return a?" (module: "+a+")":""}if(b)throw ga("multidir",b.name,e(b.$$moduleName),c.name,e(c.$$moduleName),a,xa(d));}function Ka(a,c){var d=b(c,!0);d&&a.push({priority:0,compile:function(a){a=
a.parent();var b=!!a.length;b&&W.$$addBindingClass(a);return function(a,c){var e=c.parent();b||W.$$addBindingClass(e);W.$$addBindingInfo(e,d.expressions);a.$watch(d,function(a){c[0].nodeValue=a})}}})}function Xb(a,b){a=F(a||"html");switch(a){case "svg":case "math":var c=X.createElement("div");c.innerHTML="<"+a+">"+b+"</"+a+">";return c.childNodes[0].childNodes;default:return b}}function R(a,b){if("srcdoc"==b)return ia.HTML;var c=wa(a);if("xlinkHref"==b||"form"==c&&"action"==b||"img"!=c&&("src"==b||
"ngSrc"==b))return ia.RESOURCE_URL}function V(a,c,d,e,f){var h=R(a,e);f=g[e]||f;var l=b(d,!0,h,f);if(l){if("multiple"===e&&"select"===wa(a))throw ga("selmulti",xa(a));c.push({priority:100,compile:function(){return{pre:function(a,c,g){c=g.$$observers||(g.$$observers=fa());if(k.test(e))throw ga("nodomevents");var r=g[e];r!==d&&(l=r&&b(r,!0,h,f),d=r);l&&(g[e]=l(a),(c[e]||(c[e]=[])).$$inter=!0,(g.$$observers&&g.$$observers[e].$$scope||a).$watch(l,function(a,b){"class"===e&&a!=b?g.$updateClass(a,b):g.$set(e,
a)}))}}}})}}function U(a,b,c){var d=b[0],e=b.length,f=d.parentNode,g,h;if(a)for(g=0,h=a.length;g<h;g++)if(a[g]==d){a[g++]=c;h=g+e-1;for(var k=a.length;g<k;g++,h++)h<k?a[g]=a[h]:delete a[g];a.length-=e-1;a.context===d&&(a.context=c);break}f&&f.replaceChild(c,d);a=X.createDocumentFragment();a.appendChild(d);B.hasData(d)&&(B(c).data(B(d).data()),ra?(Qb=!0,ra.cleanData([d])):delete B.cache[d[B.expando]]);d=1;for(e=b.length;d<e;d++)f=b[d],B(f).remove(),a.appendChild(f),delete b[d];b[0]=c;b.length=1}function $(a,
b){return P(function(){return a.apply(null,arguments)},a,b)}function aa(a,b,d,e,f,g){try{a(b,d,e,f,g)}catch(h){c(h,xa(d))}}function Y(a,c,d,e,f,g){var h;m(e,function(e,g){var k=e.attrName,l=e.optional,r,n,q,K;switch(e.mode){case "@":l||ta.call(c,k)||(d[g]=c[k]=void 0);c.$observe(k,function(a){G(a)&&(d[g]=a)});c.$$observers[k].$$scope=a;G(c[k])&&(d[g]=b(c[k])(a));break;case "=":if(!ta.call(c,k)){if(l)break;c[k]=void 0}if(l&&!c[k])break;n=u(c[k]);K=n.literal?ka:function(a,b){return a===b||a!==a&&b!==
b};q=n.assign||function(){r=d[g]=n(a);throw ga("nonassign",c[k],f.name);};r=d[g]=n(a);l=function(b){K(b,d[g])||(K(b,r)?q(a,b=d[g]):d[g]=b);return r=b};l.$stateful=!0;l=e.collection?a.$watchCollection(c[k],l):a.$watch(u(c[k],l),null,n.literal);h=h||[];h.push(l);break;case "&":n=c.hasOwnProperty(k)?u(c[k]):y;if(n===y&&l)break;d[g]=function(b){return n(a,b)}}});e=h?function(){for(var a=0,b=h.length;a<b;++a)h[a]()}:y;return g&&e!==y?(g.$on("$destroy",e),y):e}var Z=function(a,b){if(b){var c=Object.keys(b),
d,e,f;d=0;for(e=c.length;d<e;d++)f=c[d],this[f]=b[f]}else this.$attr={};this.$$element=a};Z.prototype={$normalize:ya,$addClass:function(a){a&&0<a.length&&O.addClass(this.$$element,a)},$removeClass:function(a){a&&0<a.length&&O.removeClass(this.$$element,a)},$updateClass:function(a,b){var c=Zc(a,b);c&&c.length&&O.addClass(this.$$element,c);(c=Zc(b,a))&&c.length&&O.removeClass(this.$$element,c)},$set:function(a,b,d,e){var f=Rc(this.$$element[0],a),g=$c[a],h=a;f?(this.$$element.prop(a,b),e=f):g&&(this[g]=
b,h=g);this[a]=b;e?this.$attr[a]=e:(e=this.$attr[a])||(this.$attr[a]=e=Ac(a,"-"));f=wa(this.$$element);if("a"===f&&"href"===a||"img"===f&&"src"===a)this[a]=b=H(b,"src"===a);else if("img"===f&&"srcset"===a){for(var f="",g=T(b),k=/(\s+\d+x\s*,|\s+\d+w\s*,|\s+,|,\s+)/,k=/\s/.test(g)?k:/(,)/,g=g.split(k),k=Math.floor(g.length/2),l=0;l<k;l++)var r=2*l,f=f+H(T(g[r]),!0),f=f+(" "+T(g[r+1]));g=T(g[2*l]).split(/\s/);f+=H(T(g[0]),!0);2===g.length&&(f+=" "+T(g[1]));this[a]=b=f}!1!==d&&(null===b||v(b)?this.$$element.removeAttr(e):
this.$$element.attr(e,b));(a=this.$$observers)&&m(a[h],function(a){try{a(b)}catch(d){c(d)}})},$observe:function(a,b){var c=this,d=c.$$observers||(c.$$observers=fa()),e=d[a]||(d[a]=[]);e.push(b);z.$evalAsync(function(){e.$$inter||!c.hasOwnProperty(a)||v(c[a])||b(c[a])});return function(){cb(e,b)}}};var da=b.startSymbol(),ea=b.endSymbol(),ha="{{"==da||"}}"==ea?$a:function(a){return a.replace(/\{\{/g,da).replace(/}}/g,ea)},ja=/^ngAttr[A-Z]/;W.$$addBindingInfo=n?function(a,b){var c=a.data("$binding")||
[];J(b)?c=c.concat(b):c.push(b);a.data("$binding",c)}:y;W.$$addBindingClass=n?function(a){L(a,"ng-binding")}:y;W.$$addScopeInfo=n?function(a,b,c,d){a.data(c?d?"$isolateScopeNoTemplate":"$isolateScope":"$scope",b)}:y;W.$$addScopeClass=n?function(a,b){L(a,b?"ng-isolate-scope":"ng-scope")}:y;return W}]}function ya(b){return gb(b.replace(Wc,""))}function Zc(b,a){var c="",d=b.split(/\s+/),e=a.split(/\s+/),f=0;a:for(;f<d.length;f++){for(var h=d[f],g=0;g<e.length;g++)if(h==e[g])continue a;c+=(0<c.length?
" ":"")+h}return c}function Xc(b){b=B(b);var a=b.length;if(1>=a)return b;for(;a--;)8===b[a].nodeType&&Nf.call(b,a,1);return b}function Xe(){var b={},a=!1;this.register=function(a,d){Ta(a,"controller");C(a)?P(b,a):b[a]=d};this.allowGlobals=function(){a=!0};this.$get=["$injector","$window",function(c,d){function e(a,b,c,d){if(!a||!C(a.$scope))throw I("$controller")("noscp",d,b);a.$scope[b]=c}return function(f,h,g,l){var k,n,p;g=!0===g;l&&G(l)&&(p=l);if(G(f)){l=f.match(Vc);if(!l)throw Of("ctrlfmt",f);
n=l[1];p=p||l[3];f=b.hasOwnProperty(n)?b[n]:Cc(h.$scope,n,!0)||(a?Cc(d,n,!0):w);Sa(f,n,!0)}if(g)return g=(J(f)?f[f.length-1]:f).prototype,k=Object.create(g||null),p&&e(h,p,k,n||f.name),P(function(){var a=c.invoke(f,k,h,n);a!==k&&(C(a)||x(a))&&(k=a,p&&e(h,p,k,n||f.name));return k},{instance:k,identifier:p});k=c.instantiate(f,h,n);p&&e(h,p,k,n||f.name);return k}}]}function Ye(){this.$get=["$window",function(b){return B(b.document)}]}function Ze(){this.$get=["$log",function(b){return function(a,c){b.error.apply(b,
arguments)}}]}function Yb(b){return C(b)?ea(b)?b.toISOString():eb(b):b}function df(){this.$get=function(){return function(b){if(!b)return"";var a=[];nc(b,function(b,d){null===b||v(b)||(J(b)?m(b,function(b,c){a.push(la(d)+"="+la(Yb(b)))}):a.push(la(d)+"="+la(Yb(b))))});return a.join("&")}}}function ef(){this.$get=function(){return function(b){function a(b,e,f){null===b||v(b)||(J(b)?m(b,function(b,c){a(b,e+"["+(C(b)?c:"")+"]")}):C(b)&&!ea(b)?nc(b,function(b,c){a(b,e+(f?"":"[")+c+(f?"":"]"))}):c.push(la(e)+
"="+la(Yb(b))))}if(!b)return"";var c=[];a(b,"",!0);return c.join("&")}}}function Zb(b,a){if(G(b)){var c=b.replace(Pf,"").trim();if(c){var d=a("Content-Type");(d=d&&0===d.indexOf(ad))||(d=(d=c.match(Qf))&&Rf[d[0]].test(c));d&&(b=vc(c))}}return b}function bd(b){var a=fa(),c;G(b)?m(b.split("\n"),function(b){c=b.indexOf(":");var e=F(T(b.substr(0,c)));b=T(b.substr(c+1));e&&(a[e]=a[e]?a[e]+", "+b:b)}):C(b)&&m(b,function(b,c){var f=F(c),h=T(b);f&&(a[f]=a[f]?a[f]+", "+h:h)});return a}function cd(b){var a;
return function(c){a||(a=bd(b));return c?(c=a[F(c)],void 0===c&&(c=null),c):a}}function dd(b,a,c,d){if(x(d))return d(b,a,c);m(d,function(d){b=d(b,a,c)});return b}function cf(){var b=this.defaults={transformResponse:[Zb],transformRequest:[function(a){return C(a)&&"[object File]"!==va.call(a)&&"[object Blob]"!==va.call(a)&&"[object FormData]"!==va.call(a)?eb(a):a}],headers:{common:{Accept:"application/json, text/plain, */*"},post:ja($b),put:ja($b),patch:ja($b)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",
paramSerializer:"$httpParamSerializer"},a=!1;this.useApplyAsync=function(b){return A(b)?(a=!!b,this):a};var c=!0;this.useLegacyPromiseExtensions=function(a){return A(a)?(c=!!a,this):c};var d=this.interceptors=[];this.$get=["$httpBackend","$$cookieReader","$cacheFactory","$rootScope","$q","$injector",function(e,f,h,g,l,k){function n(a){function d(a){var b=P({},a);b.data=a.data?dd(a.data,a.headers,a.status,f.transformResponse):a.data;a=a.status;return 200<=a&&300>a?b:l.reject(b)}function e(a,b){var c,
d={};m(a,function(a,e){x(a)?(c=a(b),null!=c&&(d[e]=c)):d[e]=a});return d}if(!da.isObject(a))throw I("$http")("badreq",a);var f=P({method:"get",transformRequest:b.transformRequest,transformResponse:b.transformResponse,paramSerializer:b.paramSerializer},a);f.headers=function(a){var c=b.headers,d=P({},a.headers),f,g,h,c=P({},c.common,c[F(a.method)]);a:for(f in c){g=F(f);for(h in d)if(F(h)===g)continue a;d[f]=c[f]}return e(d,ja(a))}(a);f.method=sb(f.method);f.paramSerializer=G(f.paramSerializer)?k.get(f.paramSerializer):
f.paramSerializer;var g=[function(a){var c=a.headers,e=dd(a.data,cd(c),w,a.transformRequest);v(e)&&m(c,function(a,b){"content-type"===F(b)&&delete c[b]});v(a.withCredentials)&&!v(b.withCredentials)&&(a.withCredentials=b.withCredentials);return p(a,e).then(d,d)},w],h=l.when(f);for(m(E,function(a){(a.request||a.requestError)&&g.unshift(a.request,a.requestError);(a.response||a.responseError)&&g.push(a.response,a.responseError)});g.length;){a=g.shift();var r=g.shift(),h=h.then(a,r)}c?(h.success=function(a){Sa(a,
"fn");h.then(function(b){a(b.data,b.status,b.headers,f)});return h},h.error=function(a){Sa(a,"fn");h.then(null,function(b){a(b.data,b.status,b.headers,f)});return h}):(h.success=ed("success"),h.error=ed("error"));return h}function p(c,d){function h(b,c,d,e){function f(){k(c,b,d,e)}L&&(200<=b&&300>b?L.put(ba,[b,c,bd(d),e]):L.remove(ba));a?g.$applyAsync(f):(f(),g.$$phase||g.$apply())}function k(a,b,d,e){b=-1<=b?b:0;(200<=b&&300>b?O.resolve:O.reject)({data:a,status:b,headers:cd(d),config:c,statusText:e})}
function p(a){k(a.data,a.status,ja(a.headers()),a.statusText)}function E(){var a=n.pendingRequests.indexOf(c);-1!==a&&n.pendingRequests.splice(a,1)}var O=l.defer(),H=O.promise,L,m,S=c.headers,ba=r(c.url,c.paramSerializer(c.params));n.pendingRequests.push(c);H.then(E,E);!c.cache&&!b.cache||!1===c.cache||"GET"!==c.method&&"JSONP"!==c.method||(L=C(c.cache)?c.cache:C(b.cache)?b.cache:t);L&&(m=L.get(ba),A(m)?m&&x(m.then)?m.then(p,p):J(m)?k(m[1],m[0],ja(m[2]),m[3]):k(m,200,{},"OK"):L.put(ba,H));v(m)&&((m=
fd(c.url)?f()[c.xsrfCookieName||b.xsrfCookieName]:w)&&(S[c.xsrfHeaderName||b.xsrfHeaderName]=m),e(c.method,ba,d,h,S,c.timeout,c.withCredentials,c.responseType));return H}function r(a,b){0<b.length&&(a+=(-1==a.indexOf("?")?"?":"&")+b);return a}var t=h("$http");b.paramSerializer=G(b.paramSerializer)?k.get(b.paramSerializer):b.paramSerializer;var E=[];m(d,function(a){E.unshift(G(a)?k.get(a):k.invoke(a))});n.pendingRequests=[];(function(a){m(arguments,function(a){n[a]=function(b,c){return n(P({},c||{},
{method:a,url:b}))}})})("get","delete","head","jsonp");(function(a){m(arguments,function(a){n[a]=function(b,c,d){return n(P({},d||{},{method:a,url:b,data:c}))}})})("post","put","patch");n.defaults=b;return n}]}function gf(){this.$get=function(){return function(){return new Q.XMLHttpRequest}}}function ff(){this.$get=["$browser","$window","$document","$xhrFactory",function(b,a,c,d){return Sf(b,d,b.defer,a.angular.callbacks,c[0])}]}function Sf(b,a,c,d,e){function f(a,b,c){var f=e.createElement("script"),
n=null;f.type="text/javascript";f.src=a;f.async=!0;n=function(a){f.removeEventListener("load",n,!1);f.removeEventListener("error",n,!1);e.body.removeChild(f);f=null;var h=-1,t="unknown";a&&("load"!==a.type||d[b].called||(a={type:"error"}),t=a.type,h="error"===a.type?404:200);c&&c(h,t)};f.addEventListener("load",n,!1);f.addEventListener("error",n,!1);e.body.appendChild(f);return n}return function(e,g,l,k,n,p,r,t){function E(){q&&q();z&&z.abort()}function K(a,d,e,f,g){A(s)&&c.cancel(s);q=z=null;a(d,
e,f,g);b.$$completeOutstandingRequest(y)}b.$$incOutstandingRequestCount();g=g||b.url();if("jsonp"==F(e)){var u="_"+(d.counter++).toString(36);d[u]=function(a){d[u].data=a;d[u].called=!0};var q=f(g.replace("JSON_CALLBACK","angular.callbacks."+u),u,function(a,b){K(k,a,d[u].data,"",b);d[u]=y})}else{var z=a(e,g);z.open(e,g,!0);m(n,function(a,b){A(a)&&z.setRequestHeader(b,a)});z.onload=function(){var a=z.statusText||"",b="response"in z?z.response:z.responseText,c=1223===z.status?204:z.status;0===c&&(c=
b?200:"file"==Aa(g).protocol?404:0);K(k,c,b,z.getAllResponseHeaders(),a)};e=function(){K(k,-1,null,null,"")};z.onerror=e;z.onabort=e;r&&(z.withCredentials=!0);if(t)try{z.responseType=t}catch(N){if("json"!==t)throw N;}z.send(v(l)?null:l)}if(0<p)var s=c(E,p);else p&&x(p.then)&&p.then(E)}}function af(){var b="{{",a="}}";this.startSymbol=function(a){return a?(b=a,this):b};this.endSymbol=function(b){return b?(a=b,this):a};this.$get=["$parse","$exceptionHandler","$sce",function(c,d,e){function f(a){return"\\\\\\"+
a}function h(c){return c.replace(n,b).replace(p,a)}function g(f,g,n,p){function u(a){try{var b=a;a=n?e.getTrusted(n,b):e.valueOf(b);var c;if(p&&!A(a))c=a;else if(null==a)c="";else{switch(typeof a){case "string":break;case "number":a=""+a;break;default:a=eb(a)}c=a}return c}catch(g){d(La.interr(f,g))}}p=!!p;for(var q,m,N=0,s=[],O=[],H=f.length,L=[],W=[];N<H;)if(-1!=(q=f.indexOf(b,N))&&-1!=(m=f.indexOf(a,q+l)))N!==q&&L.push(h(f.substring(N,q))),N=f.substring(q+l,m),s.push(N),O.push(c(N,u)),N=m+k,W.push(L.length),
L.push("");else{N!==H&&L.push(h(f.substring(N)));break}n&&1<L.length&&La.throwNoconcat(f);if(!g||s.length){var S=function(a){for(var b=0,c=s.length;b<c;b++){if(p&&v(a[b]))return;L[W[b]]=a[b]}return L.join("")};return P(function(a){var b=0,c=s.length,e=Array(c);try{for(;b<c;b++)e[b]=O[b](a);return S(e)}catch(g){d(La.interr(f,g))}},{exp:f,expressions:s,$$watchDelegate:function(a,b){var c;return a.$watchGroup(O,function(d,e){var f=S(d);x(b)&&b.call(this,f,d!==e?c:f,a);c=f})}})}}var l=b.length,k=a.length,
n=new RegExp(b.replace(/./g,f),"g"),p=new RegExp(a.replace(/./g,f),"g");g.startSymbol=function(){return b};g.endSymbol=function(){return a};return g}]}function bf(){this.$get=["$rootScope","$window","$q","$$q",function(b,a,c,d){function e(e,g,l,k){var n=4<arguments.length,p=n?ua.call(arguments,4):[],r=a.setInterval,t=a.clearInterval,E=0,K=A(k)&&!k,u=(K?d:c).defer(),q=u.promise;l=A(l)?l:0;q.then(null,null,n?function(){e.apply(null,p)}:e);q.$$intervalId=r(function(){u.notify(E++);0<l&&E>=l&&(u.resolve(E),
t(q.$$intervalId),delete f[q.$$intervalId]);K||b.$apply()},g);f[q.$$intervalId]=u;return q}var f={};e.cancel=function(b){return b&&b.$$intervalId in f?(f[b.$$intervalId].reject("canceled"),a.clearInterval(b.$$intervalId),delete f[b.$$intervalId],!0):!1};return e}]}function ac(b){b=b.split("/");for(var a=b.length;a--;)b[a]=ob(b[a]);return b.join("/")}function gd(b,a){var c=Aa(b);a.$$protocol=c.protocol;a.$$host=c.hostname;a.$$port=Y(c.port)||Tf[c.protocol]||null}function hd(b,a){var c="/"!==b.charAt(0);
c&&(b="/"+b);var d=Aa(b);a.$$path=decodeURIComponent(c&&"/"===d.pathname.charAt(0)?d.pathname.substring(1):d.pathname);a.$$search=yc(d.search);a.$$hash=decodeURIComponent(d.hash);a.$$path&&"/"!=a.$$path.charAt(0)&&(a.$$path="/"+a.$$path)}function sa(b,a){if(0===a.indexOf(b))return a.substr(b.length)}function Ja(b){var a=b.indexOf("#");return-1==a?b:b.substr(0,a)}function Cb(b){return b.replace(/(#.+)|#$/,"$1")}function bc(b,a,c){this.$$html5=!0;c=c||"";gd(b,this);this.$$parse=function(b){var c=sa(a,
b);if(!G(c))throw Db("ipthprfx",b,a);hd(c,this);this.$$path||(this.$$path="/");this.$$compose()};this.$$compose=function(){var b=Pb(this.$$search),c=this.$$hash?"#"+ob(this.$$hash):"";this.$$url=ac(this.$$path)+(b?"?"+b:"")+c;this.$$absUrl=a+this.$$url.substr(1)};this.$$parseLinkUrl=function(d,e){if(e&&"#"===e[0])return this.hash(e.slice(1)),!0;var f,h;A(f=sa(b,d))?(h=f,h=A(f=sa(c,f))?a+(sa("/",f)||f):b+h):A(f=sa(a,d))?h=a+f:a==d+"/"&&(h=a);h&&this.$$parse(h);return!!h}}function cc(b,a,c){gd(b,this);
this.$$parse=function(d){var e=sa(b,d)||sa(a,d),f;v(e)||"#"!==e.charAt(0)?this.$$html5?f=e:(f="",v(e)&&(b=d,this.replace())):(f=sa(c,e),v(f)&&(f=e));hd(f,this);d=this.$$path;var e=b,h=/^\/[A-Z]:(\/.*)/;0===f.indexOf(e)&&(f=f.replace(e,""));h.exec(f)||(d=(f=h.exec(d))?f[1]:d);this.$$path=d;this.$$compose()};this.$$compose=function(){var a=Pb(this.$$search),e=this.$$hash?"#"+ob(this.$$hash):"";this.$$url=ac(this.$$path)+(a?"?"+a:"")+e;this.$$absUrl=b+(this.$$url?c+this.$$url:"")};this.$$parseLinkUrl=
function(a,c){return Ja(b)==Ja(a)?(this.$$parse(a),!0):!1}}function id(b,a,c){this.$$html5=!0;cc.apply(this,arguments);this.$$parseLinkUrl=function(d,e){if(e&&"#"===e[0])return this.hash(e.slice(1)),!0;var f,h;b==Ja(d)?f=d:(h=sa(a,d))?f=b+c+h:a===d+"/"&&(f=a);f&&this.$$parse(f);return!!f};this.$$compose=function(){var a=Pb(this.$$search),e=this.$$hash?"#"+ob(this.$$hash):"";this.$$url=ac(this.$$path)+(a?"?"+a:"")+e;this.$$absUrl=b+c+this.$$url}}function Eb(b){return function(){return this[b]}}function jd(b,
a){return function(c){if(v(c))return this[b];this[b]=a(c);this.$$compose();return this}}function hf(){var b="",a={enabled:!1,requireBase:!0,rewriteLinks:!0};this.hashPrefix=function(a){return A(a)?(b=a,this):b};this.html5Mode=function(b){return bb(b)?(a.enabled=b,this):C(b)?(bb(b.enabled)&&(a.enabled=b.enabled),bb(b.requireBase)&&(a.requireBase=b.requireBase),bb(b.rewriteLinks)&&(a.rewriteLinks=b.rewriteLinks),this):a};this.$get=["$rootScope","$browser","$sniffer","$rootElement","$window",function(c,
d,e,f,h){function g(a,b,c){var e=k.url(),f=k.$$state;try{d.url(a,b,c),k.$$state=d.state()}catch(g){throw k.url(e),k.$$state=f,g;}}function l(a,b){c.$broadcast("$locationChangeSuccess",k.absUrl(),a,k.$$state,b)}var k,n;n=d.baseHref();var p=d.url(),r;if(a.enabled){if(!n&&a.requireBase)throw Db("nobase");r=p.substring(0,p.indexOf("/",p.indexOf("//")+2))+(n||"/");n=e.history?bc:id}else r=Ja(p),n=cc;var t=r.substr(0,Ja(r).lastIndexOf("/")+1);k=new n(r,t,"#"+b);k.$$parseLinkUrl(p,p);k.$$state=d.state();
var E=/^\s*(javascript|mailto):/i;f.on("click",function(b){if(a.rewriteLinks&&!b.ctrlKey&&!b.metaKey&&!b.shiftKey&&2!=b.which&&2!=b.button){for(var e=B(b.target);"a"!==wa(e[0]);)if(e[0]===f[0]||!(e=e.parent())[0])return;var g=e.prop("href"),l=e.attr("href")||e.attr("xlink:href");C(g)&&"[object SVGAnimatedString]"===g.toString()&&(g=Aa(g.animVal).href);E.test(g)||!g||e.attr("target")||b.isDefaultPrevented()||!k.$$parseLinkUrl(g,l)||(b.preventDefault(),k.absUrl()!=d.url()&&(c.$apply(),h.angular["ff-684208-preventDefault"]=
!0))}});Cb(k.absUrl())!=Cb(p)&&d.url(k.absUrl(),!0);var K=!0;d.onUrlChange(function(a,b){v(sa(t,a))?h.location.href=a:(c.$evalAsync(function(){var d=k.absUrl(),e=k.$$state,f;k.$$parse(a);k.$$state=b;f=c.$broadcast("$locationChangeStart",a,d,b,e).defaultPrevented;k.absUrl()===a&&(f?(k.$$parse(d),k.$$state=e,g(d,!1,e)):(K=!1,l(d,e)))}),c.$$phase||c.$digest())});c.$watch(function(){var a=Cb(d.url()),b=Cb(k.absUrl()),f=d.state(),h=k.$$replace,r=a!==b||k.$$html5&&e.history&&f!==k.$$state;if(K||r)K=!1,
c.$evalAsync(function(){var b=k.absUrl(),d=c.$broadcast("$locationChangeStart",b,a,k.$$state,f).defaultPrevented;k.absUrl()===b&&(d?(k.$$parse(a),k.$$state=f):(r&&g(b,h,f===k.$$state?null:k.$$state),l(a,f)))});k.$$replace=!1});return k}]}function jf(){var b=!0,a=this;this.debugEnabled=function(a){return A(a)?(b=a,this):b};this.$get=["$window",function(c){function d(a){a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=
a.message+"\n"+a.sourceURL+":"+a.line));return a}function e(a){var b=c.console||{},e=b[a]||b.log||y;a=!1;try{a=!!e.apply}catch(l){}return a?function(){var a=[];m(arguments,function(b){a.push(d(b))});return e.apply(b,a)}:function(a,b){e(a,null==b?"":b)}}return{log:e("log"),info:e("info"),warn:e("warn"),error:e("error"),debug:function(){var c=e("debug");return function(){b&&c.apply(a,arguments)}}()}}]}function Xa(b,a){if("__defineGetter__"===b||"__defineSetter__"===b||"__lookupGetter__"===b||"__lookupSetter__"===
b||"__proto__"===b)throw Z("isecfld",a);return b}function kd(b,a){b+="";if(!G(b))throw Z("iseccst",a);return b}function Ba(b,a){if(b){if(b.constructor===b)throw Z("isecfn",a);if(b.window===b)throw Z("isecwindow",a);if(b.children&&(b.nodeName||b.prop&&b.attr&&b.find))throw Z("isecdom",a);if(b===Object)throw Z("isecobj",a);}return b}function ld(b,a){if(b){if(b.constructor===b)throw Z("isecfn",a);if(b===Uf||b===Vf||b===Wf)throw Z("isecff",a);}}function md(b,a){if(b&&(b===(0).constructor||b===(!1).constructor||
b==="".constructor||b==={}.constructor||b===[].constructor||b===Function.constructor))throw Z("isecaf",a);}function Xf(b,a){return"undefined"!==typeof b?b:a}function nd(b,a){return"undefined"===typeof b?a:"undefined"===typeof a?b:b+a}function U(b,a){var c,d;switch(b.type){case s.Program:c=!0;m(b.body,function(b){U(b.expression,a);c=c&&b.expression.constant});b.constant=c;break;case s.Literal:b.constant=!0;b.toWatch=[];break;case s.UnaryExpression:U(b.argument,a);b.constant=b.argument.constant;b.toWatch=
b.argument.toWatch;break;case s.BinaryExpression:U(b.left,a);U(b.right,a);b.constant=b.left.constant&&b.right.constant;b.toWatch=b.left.toWatch.concat(b.right.toWatch);break;case s.LogicalExpression:U(b.left,a);U(b.right,a);b.constant=b.left.constant&&b.right.constant;b.toWatch=b.constant?[]:[b];break;case s.ConditionalExpression:U(b.test,a);U(b.alternate,a);U(b.consequent,a);b.constant=b.test.constant&&b.alternate.constant&&b.consequent.constant;b.toWatch=b.constant?[]:[b];break;case s.Identifier:b.constant=
!1;b.toWatch=[b];break;case s.MemberExpression:U(b.object,a);b.computed&&U(b.property,a);b.constant=b.object.constant&&(!b.computed||b.property.constant);b.toWatch=[b];break;case s.CallExpression:c=b.filter?!a(b.callee.name).$stateful:!1;d=[];m(b.arguments,function(b){U(b,a);c=c&&b.constant;b.constant||d.push.apply(d,b.toWatch)});b.constant=c;b.toWatch=b.filter&&!a(b.callee.name).$stateful?d:[b];break;case s.AssignmentExpression:U(b.left,a);U(b.right,a);b.constant=b.left.constant&&b.right.constant;
b.toWatch=[b];break;case s.ArrayExpression:c=!0;d=[];m(b.elements,function(b){U(b,a);c=c&&b.constant;b.constant||d.push.apply(d,b.toWatch)});b.constant=c;b.toWatch=d;break;case s.ObjectExpression:c=!0;d=[];m(b.properties,function(b){U(b.value,a);c=c&&b.value.constant;b.value.constant||d.push.apply(d,b.value.toWatch)});b.constant=c;b.toWatch=d;break;case s.ThisExpression:b.constant=!1,b.toWatch=[]}}function od(b){if(1==b.length){b=b[0].expression;var a=b.toWatch;return 1!==a.length?a:a[0]!==b?a:w}}
function pd(b){return b.type===s.Identifier||b.type===s.MemberExpression}function qd(b){if(1===b.body.length&&pd(b.body[0].expression))return{type:s.AssignmentExpression,left:b.body[0].expression,right:{type:s.NGValueParameter},operator:"="}}function rd(b){return 0===b.body.length||1===b.body.length&&(b.body[0].expression.type===s.Literal||b.body[0].expression.type===s.ArrayExpression||b.body[0].expression.type===s.ObjectExpression)}function sd(b,a){this.astBuilder=b;this.$filter=a}function td(b,
a){this.astBuilder=b;this.$filter=a}function Fb(b){return"constructor"==b}function dc(b){return x(b.valueOf)?b.valueOf():Yf.call(b)}function kf(){var b=fa(),a=fa();this.$get=["$filter",function(c){function d(a,b){return null==a||null==b?a===b:"object"===typeof a&&(a=dc(a),"object"===typeof a)?!1:a===b||a!==a&&b!==b}function e(a,b,c,e,f){var g=e.inputs,h;if(1===g.length){var k=d,g=g[0];return a.$watch(function(a){var b=g(a);d(b,k)||(h=e(a,w,w,[b]),k=b&&dc(b));return h},b,c,f)}for(var l=[],n=[],p=0,
m=g.length;p<m;p++)l[p]=d,n[p]=null;return a.$watch(function(a){for(var b=!1,c=0,f=g.length;c<f;c++){var k=g[c](a);if(b||(b=!d(k,l[c])))n[c]=k,l[c]=k&&dc(k)}b&&(h=e(a,w,w,n));return h},b,c,f)}function f(a,b,c,d){var e,f;return e=a.$watch(function(a){return d(a)},function(a,c,d){f=a;x(b)&&b.apply(this,arguments);A(a)&&d.$$postDigest(function(){A(f)&&e()})},c)}function h(a,b,c,d){function e(a){var b=!0;m(a,function(a){A(a)||(b=!1)});return b}var f,g;return f=a.$watch(function(a){return d(a)},function(a,
c,d){g=a;x(b)&&b.call(this,a,c,d);e(a)&&d.$$postDigest(function(){e(g)&&f()})},c)}function g(a,b,c,d){var e;return e=a.$watch(function(a){return d(a)},function(a,c,d){x(b)&&b.apply(this,arguments);e()},c)}function l(a,b){if(!b)return a;var c=a.$$watchDelegate,c=c!==h&&c!==f?function(c,d,e,f){e=a(c,d,e,f);return b(e,c,d)}:function(c,d,e,f){e=a(c,d,e,f);c=b(e,c,d);return A(e)?c:e};a.$$watchDelegate&&a.$$watchDelegate!==e?c.$$watchDelegate=a.$$watchDelegate:b.$stateful||(c.$$watchDelegate=e,c.inputs=
a.inputs?a.inputs:[a]);return c}var k=Fa().noUnsafeEval,n={csp:k,expensiveChecks:!1},p={csp:k,expensiveChecks:!0};return function(d,k,E){var m,u,q;switch(typeof d){case "string":q=d=d.trim();var s=E?a:b;m=s[q];m||(":"===d.charAt(0)&&":"===d.charAt(1)&&(u=!0,d=d.substring(2)),E=E?p:n,m=new ec(E),m=(new fc(m,c,E)).parse(d),m.constant?m.$$watchDelegate=g:u?m.$$watchDelegate=m.literal?h:f:m.inputs&&(m.$$watchDelegate=e),s[q]=m);return l(m,k);case "function":return l(d,k);default:return y}}}]}function mf(){this.$get=
["$rootScope","$exceptionHandler",function(b,a){return ud(function(a){b.$evalAsync(a)},a)}]}function nf(){this.$get=["$browser","$exceptionHandler",function(b,a){return ud(function(a){b.defer(a)},a)}]}function ud(b,a){function c(a,b,c){function d(b){return function(c){e||(e=!0,b.call(a,c))}}var e=!1;return[d(b),d(c)]}function d(){this.$$state={status:0}}function e(a,b){return function(c){b.call(a,c)}}function f(c){!c.processScheduled&&c.pending&&(c.processScheduled=!0,b(function(){var b,d,e;e=c.pending;
c.processScheduled=!1;c.pending=w;for(var f=0,g=e.length;f<g;++f){d=e[f][0];b=e[f][c.status];try{x(b)?d.resolve(b(c.value)):1===c.status?d.resolve(c.value):d.reject(c.value)}catch(h){d.reject(h),a(h)}}}))}function h(){this.promise=new d;this.resolve=e(this,this.resolve);this.reject=e(this,this.reject);this.notify=e(this,this.notify)}var g=I("$q",TypeError);P(d.prototype,{then:function(a,b,c){if(v(a)&&v(b)&&v(c))return this;var d=new h;this.$$state.pending=this.$$state.pending||[];this.$$state.pending.push([d,
a,b,c]);0<this.$$state.status&&f(this.$$state);return d.promise},"catch":function(a){return this.then(null,a)},"finally":function(a,b){return this.then(function(b){return k(b,!0,a)},function(b){return k(b,!1,a)},b)}});P(h.prototype,{resolve:function(a){this.promise.$$state.status||(a===this.promise?this.$$reject(g("qcycle",a)):this.$$resolve(a))},$$resolve:function(b){var d,e;e=c(this,this.$$resolve,this.$$reject);try{if(C(b)||x(b))d=b&&b.then;x(d)?(this.promise.$$state.status=-1,d.call(b,e[0],e[1],
this.notify)):(this.promise.$$state.value=b,this.promise.$$state.status=1,f(this.promise.$$state))}catch(g){e[1](g),a(g)}},reject:function(a){this.promise.$$state.status||this.$$reject(a)},$$reject:function(a){this.promise.$$state.value=a;this.promise.$$state.status=2;f(this.promise.$$state)},notify:function(c){var d=this.promise.$$state.pending;0>=this.promise.$$state.status&&d&&d.length&&b(function(){for(var b,e,f=0,g=d.length;f<g;f++){e=d[f][0];b=d[f][3];try{e.notify(x(b)?b(c):c)}catch(h){a(h)}}})}});
var l=function(a,b){var c=new h;b?c.resolve(a):c.reject(a);return c.promise},k=function(a,b,c){var d=null;try{x(c)&&(d=c())}catch(e){return l(e,!1)}return d&&x(d.then)?d.then(function(){return l(a,b)},function(a){return l(a,!1)}):l(a,b)},n=function(a,b,c,d){var e=new h;e.resolve(a);return e.promise.then(b,c,d)},p=function t(a){if(!x(a))throw g("norslvr",a);if(!(this instanceof t))return new t(a);var b=new h;a(function(a){b.resolve(a)},function(a){b.reject(a)});return b.promise};p.defer=function(){return new h};
p.reject=function(a){var b=new h;b.reject(a);return b.promise};p.when=n;p.resolve=n;p.all=function(a){var b=new h,c=0,d=J(a)?[]:{};m(a,function(a,e){c++;n(a).then(function(a){d.hasOwnProperty(e)||(d[e]=a,--c||b.resolve(d))},function(a){d.hasOwnProperty(e)||b.reject(a)})});0===c&&b.resolve(d);return b.promise};return p}function wf(){this.$get=["$window","$timeout",function(b,a){var c=b.requestAnimationFrame||b.webkitRequestAnimationFrame,d=b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.webkitCancelRequestAnimationFrame,
e=!!c,f=e?function(a){var b=c(a);return function(){d(b)}}:function(b){var c=a(b,16.66,!1);return function(){a.cancel(c)}};f.supported=e;return f}]}function lf(){function b(a){function b(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null;this.$$listeners={};this.$$listenerCount={};this.$$watchersCount=0;this.$id=++nb;this.$$ChildScope=null}b.prototype=a;return b}var a=10,c=I("$rootScope"),d=null,e=null;this.digestTtl=function(b){arguments.length&&(a=b);return a};this.$get=
["$injector","$exceptionHandler","$parse","$browser",function(f,h,g,l){function k(a){a.currentScope.$$destroyed=!0}function n(){this.$id=++nb;this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null;this.$root=this;this.$$destroyed=!1;this.$$listeners={};this.$$listenerCount={};this.$$watchersCount=0;this.$$isolateBindings=null}function p(a){if(q.$$phase)throw c("inprog",q.$$phase);q.$$phase=a}function r(a,b){do a.$$watchersCount+=b;while(a=
a.$parent)}function t(a,b,c){do a.$$listenerCount[c]-=b,0===a.$$listenerCount[c]&&delete a.$$listenerCount[c];while(a=a.$parent)}function E(){}function s(){for(;w.length;)try{w.shift()()}catch(a){h(a)}e=null}function u(){null===e&&(e=l.defer(function(){q.$apply(s)}))}n.prototype={constructor:n,$new:function(a,c){var d;c=c||this;a?(d=new n,d.$root=this.$root):(this.$$ChildScope||(this.$$ChildScope=b(this)),d=new this.$$ChildScope);d.$parent=c;d.$$prevSibling=c.$$childTail;c.$$childHead?(c.$$childTail.$$nextSibling=
d,c.$$childTail=d):c.$$childHead=c.$$childTail=d;(a||c!=this)&&d.$on("$destroy",k);return d},$watch:function(a,b,c,e){var f=g(a);if(f.$$watchDelegate)return f.$$watchDelegate(this,b,c,f,a);var h=this,k=h.$$watchers,l={fn:b,last:E,get:f,exp:e||a,eq:!!c};d=null;x(b)||(l.fn=y);k||(k=h.$$watchers=[]);k.unshift(l);r(this,1);return function(){0<=cb(k,l)&&r(h,-1);d=null}},$watchGroup:function(a,b){function c(){h=!1;k?(k=!1,b(e,e,g)):b(e,d,g)}var d=Array(a.length),e=Array(a.length),f=[],g=this,h=!1,k=!0;
if(!a.length){var l=!0;g.$evalAsync(function(){l&&b(e,e,g)});return function(){l=!1}}if(1===a.length)return this.$watch(a[0],function(a,c,f){e[0]=a;d[0]=c;b(e,a===c?e:d,f)});m(a,function(a,b){var k=g.$watch(a,function(a,f){e[b]=a;d[b]=f;h||(h=!0,g.$evalAsync(c))});f.push(k)});return function(){for(;f.length;)f.shift()()}},$watchCollection:function(a,b){function c(a){e=a;var b,d,g,h;if(!v(e)){if(C(e))if(Da(e))for(f!==p&&(f=p,t=f.length=0,l++),a=e.length,t!==a&&(l++,f.length=t=a),b=0;b<a;b++)h=f[b],
g=e[b],d=h!==h&&g!==g,d||h===g||(l++,f[b]=g);else{f!==r&&(f=r={},t=0,l++);a=0;for(b in e)ta.call(e,b)&&(a++,g=e[b],h=f[b],b in f?(d=h!==h&&g!==g,d||h===g||(l++,f[b]=g)):(t++,f[b]=g,l++));if(t>a)for(b in l++,f)ta.call(e,b)||(t--,delete f[b])}else f!==e&&(f=e,l++);return l}}c.$stateful=!0;var d=this,e,f,h,k=1<b.length,l=0,n=g(a,c),p=[],r={},q=!0,t=0;return this.$watch(n,function(){q?(q=!1,b(e,e,d)):b(e,h,d);if(k)if(C(e))if(Da(e)){h=Array(e.length);for(var a=0;a<e.length;a++)h[a]=e[a]}else for(a in h=
{},e)ta.call(e,a)&&(h[a]=e[a]);else h=e})},$digest:function(){var b,f,g,k,n,r,t=a,m,u=[],D,v;p("$digest");l.$$checkUrlChange();this===q&&null!==e&&(l.defer.cancel(e),s());d=null;do{r=!1;for(m=this;z.length;){try{v=z.shift(),v.scope.$eval(v.expression,v.locals)}catch(w){h(w)}d=null}a:do{if(k=m.$$watchers)for(n=k.length;n--;)try{if(b=k[n])if((f=b.get(m))!==(g=b.last)&&!(b.eq?ka(f,g):"number"===typeof f&&"number"===typeof g&&isNaN(f)&&isNaN(g)))r=!0,d=b,b.last=b.eq?ha(f,null):f,b.fn(f,g===E?f:g,m),5>
t&&(D=4-t,u[D]||(u[D]=[]),u[D].push({msg:x(b.exp)?"fn: "+(b.exp.name||b.exp.toString()):b.exp,newVal:f,oldVal:g}));else if(b===d){r=!1;break a}}catch(y){h(y)}if(!(k=m.$$watchersCount&&m.$$childHead||m!==this&&m.$$nextSibling))for(;m!==this&&!(k=m.$$nextSibling);)m=m.$parent}while(m=k);if((r||z.length)&&!t--)throw q.$$phase=null,c("infdig",a,u);}while(r||z.length);for(q.$$phase=null;N.length;)try{N.shift()()}catch(A){h(A)}},$destroy:function(){if(!this.$$destroyed){var a=this.$parent;this.$broadcast("$destroy");
this.$$destroyed=!0;this===q&&l.$$applicationDestroyed();r(this,-this.$$watchersCount);for(var b in this.$$listenerCount)t(this,this.$$listenerCount[b],b);a&&a.$$childHead==this&&(a.$$childHead=this.$$nextSibling);a&&a.$$childTail==this&&(a.$$childTail=this.$$prevSibling);this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling);this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling);this.$destroy=this.$digest=this.$apply=this.$evalAsync=this.$applyAsync=y;this.$on=
this.$watch=this.$watchGroup=function(){return y};this.$$listeners={};this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=this.$$watchers=null}},$eval:function(a,b){return g(a)(this,b)},$evalAsync:function(a,b){q.$$phase||z.length||l.defer(function(){z.length&&q.$digest()});z.push({scope:this,expression:a,locals:b})},$$postDigest:function(a){N.push(a)},$apply:function(a){try{p("$apply");try{return this.$eval(a)}finally{q.$$phase=null}}catch(b){h(b)}finally{try{q.$digest()}catch(c){throw h(c),
c;}}},$applyAsync:function(a){function b(){c.$eval(a)}var c=this;a&&w.push(b);u()},$on:function(a,b){var c=this.$$listeners[a];c||(this.$$listeners[a]=c=[]);c.push(b);var d=this;do d.$$listenerCount[a]||(d.$$listenerCount[a]=0),d.$$listenerCount[a]++;while(d=d.$parent);var e=this;return function(){var d=c.indexOf(b);-1!==d&&(c[d]=null,t(e,1,a))}},$emit:function(a,b){var c=[],d,e=this,f=!1,g={name:a,targetScope:e,stopPropagation:function(){f=!0},preventDefault:function(){g.defaultPrevented=!0},defaultPrevented:!1},
k=db([g],arguments,1),l,n;do{d=e.$$listeners[a]||c;g.currentScope=e;l=0;for(n=d.length;l<n;l++)if(d[l])try{d[l].apply(null,k)}catch(p){h(p)}else d.splice(l,1),l--,n--;if(f)return g.currentScope=null,g;e=e.$parent}while(e);g.currentScope=null;return g},$broadcast:function(a,b){var c=this,d=this,e={name:a,targetScope:this,preventDefault:function(){e.defaultPrevented=!0},defaultPrevented:!1};if(!this.$$listenerCount[a])return e;for(var f=db([e],arguments,1),g,k;c=d;){e.currentScope=c;d=c.$$listeners[a]||
[];g=0;for(k=d.length;g<k;g++)if(d[g])try{d[g].apply(null,f)}catch(l){h(l)}else d.splice(g,1),g--,k--;if(!(d=c.$$listenerCount[a]&&c.$$childHead||c!==this&&c.$$nextSibling))for(;c!==this&&!(d=c.$$nextSibling);)c=c.$parent}e.currentScope=null;return e}};var q=new n,z=q.$$asyncQueue=[],N=q.$$postDigestQueue=[],w=q.$$applyAsyncQueue=[];return q}]}function ge(){var b=/^\s*(https?|ftp|mailto|tel|file):/,a=/^\s*((https?|ftp|file|blob):|data:image\/)/;this.aHrefSanitizationWhitelist=function(a){return A(a)?
(b=a,this):b};this.imgSrcSanitizationWhitelist=function(b){return A(b)?(a=b,this):a};this.$get=function(){return function(c,d){var e=d?a:b,f;f=Aa(c).href;return""===f||f.match(e)?c:"unsafe:"+f}}}function Zf(b){if("self"===b)return b;if(G(b)){if(-1<b.indexOf("***"))throw Ca("iwcard",b);b=vd(b).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*");return new RegExp("^"+b+"$")}if(Oa(b))return new RegExp("^"+b.source+"$");throw Ca("imatcher");}function wd(b){var a=[];A(b)&&m(b,function(b){a.push(Zf(b))});
return a}function pf(){this.SCE_CONTEXTS=oa;var b=["self"],a=[];this.resourceUrlWhitelist=function(a){arguments.length&&(b=wd(a));return b};this.resourceUrlBlacklist=function(b){arguments.length&&(a=wd(b));return a};this.$get=["$injector",function(c){function d(a,b){return"self"===a?fd(b):!!a.exec(b.href)}function e(a){var b=function(a){this.$$unwrapTrustedValue=function(){return a}};a&&(b.prototype=new a);b.prototype.valueOf=function(){return this.$$unwrapTrustedValue()};b.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()};
return b}var f=function(a){throw Ca("unsafe");};c.has("$sanitize")&&(f=c.get("$sanitize"));var h=e(),g={};g[oa.HTML]=e(h);g[oa.CSS]=e(h);g[oa.URL]=e(h);g[oa.JS]=e(h);g[oa.RESOURCE_URL]=e(g[oa.URL]);return{trustAs:function(a,b){var c=g.hasOwnProperty(a)?g[a]:null;if(!c)throw Ca("icontext",a,b);if(null===b||v(b)||""===b)return b;if("string"!==typeof b)throw Ca("itype",a);return new c(b)},getTrusted:function(c,e){if(null===e||v(e)||""===e)return e;var h=g.hasOwnProperty(c)?g[c]:null;if(h&&e instanceof
h)return e.$$unwrapTrustedValue();if(c===oa.RESOURCE_URL){var h=Aa(e.toString()),p,r,t=!1;p=0;for(r=b.length;p<r;p++)if(d(b[p],h)){t=!0;break}if(t)for(p=0,r=a.length;p<r;p++)if(d(a[p],h)){t=!1;break}if(t)return e;throw Ca("insecurl",e.toString());}if(c===oa.HTML)return f(e);throw Ca("unsafe");},valueOf:function(a){return a instanceof h?a.$$unwrapTrustedValue():a}}}]}function of(){var b=!0;this.enabled=function(a){arguments.length&&(b=!!a);return b};this.$get=["$parse","$sceDelegate",function(a,c){if(b&&
8>Wa)throw Ca("iequirks");var d=ja(oa);d.isEnabled=function(){return b};d.trustAs=c.trustAs;d.getTrusted=c.getTrusted;d.valueOf=c.valueOf;b||(d.trustAs=d.getTrusted=function(a,b){return b},d.valueOf=$a);d.parseAs=function(b,c){var e=a(c);return e.literal&&e.constant?e:a(c,function(a){return d.getTrusted(b,a)})};var e=d.parseAs,f=d.getTrusted,h=d.trustAs;m(oa,function(a,b){var c=F(b);d[gb("parse_as_"+c)]=function(b){return e(a,b)};d[gb("get_trusted_"+c)]=function(b){return f(a,b)};d[gb("trust_as_"+
c)]=function(b){return h(a,b)}});return d}]}function qf(){this.$get=["$window","$document",function(b,a){var c={},d=Y((/android (\d+)/.exec(F((b.navigator||{}).userAgent))||[])[1]),e=/Boxee/i.test((b.navigator||{}).userAgent),f=a[0]||{},h,g=/^(Moz|webkit|ms)(?=[A-Z])/,l=f.body&&f.body.style,k=!1,n=!1;if(l){for(var p in l)if(k=g.exec(p)){h=k[0];h=h.substr(0,1).toUpperCase()+h.substr(1);break}h||(h="WebkitOpacity"in l&&"webkit");k=!!("transition"in l||h+"Transition"in l);n=!!("animation"in l||h+"Animation"in
l);!d||k&&n||(k=G(l.webkitTransition),n=G(l.webkitAnimation))}return{history:!(!b.history||!b.history.pushState||4>d||e),hasEvent:function(a){if("input"===a&&11>=Wa)return!1;if(v(c[a])){var b=f.createElement("div");c[a]="on"+a in b}return c[a]},csp:Fa(),vendorPrefix:h,transitions:k,animations:n,android:d}}]}function sf(){this.$get=["$templateCache","$http","$q","$sce",function(b,a,c,d){function e(f,h){e.totalPendingRequests++;G(f)&&b.get(f)||(f=d.getTrustedResourceUrl(f));var g=a.defaults&&a.defaults.transformResponse;
J(g)?g=g.filter(function(a){return a!==Zb}):g===Zb&&(g=null);return a.get(f,{cache:b,transformResponse:g})["finally"](function(){e.totalPendingRequests--}).then(function(a){b.put(f,a.data);return a.data},function(a){if(!h)throw ga("tpload",f,a.status,a.statusText);return c.reject(a)})}e.totalPendingRequests=0;return e}]}function tf(){this.$get=["$rootScope","$browser","$location",function(b,a,c){return{findBindings:function(a,b,c){a=a.getElementsByClassName("ng-binding");var h=[];m(a,function(a){var d=
da.element(a).data("$binding");d&&m(d,function(d){c?(new RegExp("(^|\\s)"+vd(b)+"(\\s|\\||$)")).test(d)&&h.push(a):-1!=d.indexOf(b)&&h.push(a)})});return h},findModels:function(a,b,c){for(var h=["ng-","data-ng-","ng\\:"],g=0;g<h.length;++g){var l=a.querySelectorAll("["+h[g]+"model"+(c?"=":"*=")+'"'+b+'"]');if(l.length)return l}},getLocation:function(){return c.url()},setLocation:function(a){a!==c.url()&&(c.url(a),b.$digest())},whenStable:function(b){a.notifyWhenNoOutstandingRequests(b)}}}]}function uf(){this.$get=
["$rootScope","$browser","$q","$$q","$exceptionHandler",function(b,a,c,d,e){function f(f,l,k){x(f)||(k=l,l=f,f=y);var n=ua.call(arguments,3),p=A(k)&&!k,r=(p?d:c).defer(),t=r.promise,m;m=a.defer(function(){try{r.resolve(f.apply(null,n))}catch(a){r.reject(a),e(a)}finally{delete h[t.$$timeoutId]}p||b.$apply()},l);t.$$timeoutId=m;h[m]=r;return t}var h={};f.cancel=function(b){return b&&b.$$timeoutId in h?(h[b.$$timeoutId].reject("canceled"),delete h[b.$$timeoutId],a.defer.cancel(b.$$timeoutId)):!1};return f}]}
function Aa(b){Wa&&($.setAttribute("href",b),b=$.href);$.setAttribute("href",b);return{href:$.href,protocol:$.protocol?$.protocol.replace(/:$/,""):"",host:$.host,search:$.search?$.search.replace(/^\?/,""):"",hash:$.hash?$.hash.replace(/^#/,""):"",hostname:$.hostname,port:$.port,pathname:"/"===$.pathname.charAt(0)?$.pathname:"/"+$.pathname}}function fd(b){b=G(b)?Aa(b):b;return b.protocol===xd.protocol&&b.host===xd.host}function vf(){this.$get=qa(Q)}function yd(b){function a(a){try{return decodeURIComponent(a)}catch(b){return a}}
var c=b[0]||{},d={},e="";return function(){var b,h,g,l,k;b=c.cookie||"";if(b!==e)for(e=b,b=e.split("; "),d={},g=0;g<b.length;g++)h=b[g],l=h.indexOf("="),0<l&&(k=a(h.substring(0,l)),v(d[k])&&(d[k]=a(h.substring(l+1))));return d}}function zf(){this.$get=yd}function Kc(b){function a(c,d){if(C(c)){var e={};m(c,function(b,c){e[c]=a(c,b)});return e}return b.factory(c+"Filter",d)}this.register=a;this.$get=["$injector",function(a){return function(b){return a.get(b+"Filter")}}];a("currency",zd);a("date",Ad);
a("filter",$f);a("json",ag);a("limitTo",bg);a("lowercase",cg);a("number",Bd);a("orderBy",Cd);a("uppercase",dg)}function $f(){return function(b,a,c){if(!Da(b)){if(null==b)return b;throw I("filter")("notarray",b);}var d;switch(gc(a)){case "function":break;case "boolean":case "null":case "number":case "string":d=!0;case "object":a=eg(a,c,d);break;default:return b}return Array.prototype.filter.call(b,a)}}function eg(b,a,c){var d=C(b)&&"$"in b;!0===a?a=ka:x(a)||(a=function(a,b){if(v(a))return!1;if(null===
a||null===b)return a===b;if(C(b)||C(a)&&!qc(a))return!1;a=F(""+a);b=F(""+b);return-1!==a.indexOf(b)});return function(e){return d&&!C(e)?Ma(e,b.$,a,!1):Ma(e,b,a,c)}}function Ma(b,a,c,d,e){var f=gc(b),h=gc(a);if("string"===h&&"!"===a.charAt(0))return!Ma(b,a.substring(1),c,d);if(J(b))return b.some(function(b){return Ma(b,a,c,d)});switch(f){case "object":var g;if(d){for(g in b)if("$"!==g.charAt(0)&&Ma(b[g],a,c,!0))return!0;return e?!1:Ma(b,a,c,!1)}if("object"===h){for(g in a)if(e=a[g],!x(e)&&!v(e)&&
(f="$"===g,!Ma(f?b:b[g],e,c,f,f)))return!1;return!0}return c(b,a);case "function":return!1;default:return c(b,a)}}function gc(b){return null===b?"null":typeof b}function zd(b){var a=b.NUMBER_FORMATS;return function(b,d,e){v(d)&&(d=a.CURRENCY_SYM);v(e)&&(e=a.PATTERNS[1].maxFrac);return null==b?b:Dd(b,a.PATTERNS[1],a.GROUP_SEP,a.DECIMAL_SEP,e).replace(/\u00A4/g,d)}}function Bd(b){var a=b.NUMBER_FORMATS;return function(b,d){return null==b?b:Dd(b,a.PATTERNS[0],a.GROUP_SEP,a.DECIMAL_SEP,d)}}function Dd(b,
a,c,d,e){if(C(b))return"";var f=0>b;b=Math.abs(b);var h=Infinity===b;if(!h&&!isFinite(b))return"";var g=b+"",l="",k=!1,n=[];h&&(l="\u221e");if(!h&&-1!==g.indexOf("e")){var p=g.match(/([\d\.]+)e(-?)(\d+)/);p&&"-"==p[2]&&p[3]>e+1?b=0:(l=g,k=!0)}if(h||k)0<e&&1>b&&(l=b.toFixed(e),b=parseFloat(l),l=l.replace(hc,d));else{h=(g.split(hc)[1]||"").length;v(e)&&(e=Math.min(Math.max(a.minFrac,h),a.maxFrac));b=+(Math.round(+(b.toString()+"e"+e)).toString()+"e"+-e);var h=(""+b).split(hc),g=h[0],h=h[1]||"",p=0,
r=a.lgSize,t=a.gSize;if(g.length>=r+t)for(p=g.length-r,k=0;k<p;k++)0===(p-k)%t&&0!==k&&(l+=c),l+=g.charAt(k);for(k=p;k<g.length;k++)0===(g.length-k)%r&&0!==k&&(l+=c),l+=g.charAt(k);for(;h.length<e;)h+="0";e&&"0"!==e&&(l+=d+h.substr(0,e))}0===b&&(f=!1);n.push(f?a.negPre:a.posPre,l,f?a.negSuf:a.posSuf);return n.join("")}function Gb(b,a,c){var d="";0>b&&(d="-",b=-b);for(b=""+b;b.length<a;)b="0"+b;c&&(b=b.substr(b.length-a));return d+b}function aa(b,a,c,d){c=c||0;return function(e){e=e["get"+b]();if(0<
c||e>-c)e+=c;0===e&&-12==c&&(e=12);return Gb(e,a,d)}}function Hb(b,a){return function(c,d){var e=c["get"+b](),f=sb(a?"SHORT"+b:b);return d[f][e]}}function Ed(b){var a=(new Date(b,0,1)).getDay();return new Date(b,0,(4>=a?5:12)-a)}function Fd(b){return function(a){var c=Ed(a.getFullYear());a=+new Date(a.getFullYear(),a.getMonth(),a.getDate()+(4-a.getDay()))-+c;a=1+Math.round(a/6048E5);return Gb(a,b)}}function ic(b,a){return 0>=b.getFullYear()?a.ERAS[0]:a.ERAS[1]}function Ad(b){function a(a){var b;if(b=
a.match(c)){a=new Date(0);var f=0,h=0,g=b[8]?a.setUTCFullYear:a.setFullYear,l=b[8]?a.setUTCHours:a.setHours;b[9]&&(f=Y(b[9]+b[10]),h=Y(b[9]+b[11]));g.call(a,Y(b[1]),Y(b[2])-1,Y(b[3]));f=Y(b[4]||0)-f;h=Y(b[5]||0)-h;g=Y(b[6]||0);b=Math.round(1E3*parseFloat("0."+(b[7]||0)));l.call(a,f,h,g,b)}return a}var c=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(c,e,f){var h="",g=[],l,k;e=e||"mediumDate";e=b.DATETIME_FORMATS[e]||e;G(c)&&(c=
fg.test(c)?Y(c):a(c));V(c)&&(c=new Date(c));if(!ea(c)||!isFinite(c.getTime()))return c;for(;e;)(k=gg.exec(e))?(g=db(g,k,1),e=g.pop()):(g.push(e),e=null);var n=c.getTimezoneOffset();f&&(n=wc(f,c.getTimezoneOffset()),c=Ob(c,f,!0));m(g,function(a){l=hg[a];h+=l?l(c,b.DATETIME_FORMATS,n):a.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return h}}function ag(){return function(b,a){v(a)&&(a=2);return eb(b,a)}}function bg(){return function(b,a,c){a=Infinity===Math.abs(Number(a))?Number(a):Y(a);if(isNaN(a))return b;
V(b)&&(b=b.toString());if(!J(b)&&!G(b))return b;c=!c||isNaN(c)?0:Y(c);c=0>c&&c>=-b.length?b.length+c:c;return 0<=a?b.slice(c,c+a):0===c?b.slice(a,b.length):b.slice(Math.max(0,c+a),c)}}function Cd(b){function a(a,c){c=c?-1:1;return a.map(function(a){var d=1,g=$a;if(x(a))g=a;else if(G(a)){if("+"==a.charAt(0)||"-"==a.charAt(0))d="-"==a.charAt(0)?-1:1,a=a.substring(1);if(""!==a&&(g=b(a),g.constant))var l=g(),g=function(a){return a[l]}}return{get:g,descending:d*c}})}function c(a){switch(typeof a){case "number":case "boolean":case "string":return!0;
default:return!1}}return function(b,e,f){if(!Da(b))return b;J(e)||(e=[e]);0===e.length&&(e=["+"]);var h=a(e,f);h.push({get:function(){return{}},descending:f?-1:1});b=Array.prototype.map.call(b,function(a,b){return{value:a,predicateValues:h.map(function(d){var e=d.get(a);d=typeof e;if(null===e)d="string",e="null";else if("string"===d)e=e.toLowerCase();else if("object"===d)a:{if("function"===typeof e.valueOf&&(e=e.valueOf(),c(e)))break a;if(qc(e)&&(e=e.toString(),c(e)))break a;e=b}return{value:e,type:d}})}});
b.sort(function(a,b){for(var c=0,d=0,e=h.length;d<e;++d){var c=a.predicateValues[d],f=b.predicateValues[d],t=0;c.type===f.type?c.value!==f.value&&(t=c.value<f.value?-1:1):t=c.type<f.type?-1:1;if(c=t*h[d].descending)break}return c});return b=b.map(function(a){return a.value})}}function Na(b){x(b)&&(b={link:b});b.restrict=b.restrict||"AC";return qa(b)}function Gd(b,a,c,d,e){var f=this,h=[];f.$error={};f.$$success={};f.$pending=w;f.$name=e(a.name||a.ngForm||"")(c);f.$dirty=!1;f.$pristine=!0;f.$valid=
!0;f.$invalid=!1;f.$submitted=!1;f.$$parentForm=Ib;f.$rollbackViewValue=function(){m(h,function(a){a.$rollbackViewValue()})};f.$commitViewValue=function(){m(h,function(a){a.$commitViewValue()})};f.$addControl=function(a){Ta(a.$name,"input");h.push(a);a.$name&&(f[a.$name]=a);a.$$parentForm=f};f.$$renameControl=function(a,b){var c=a.$name;f[c]===a&&delete f[c];f[b]=a;a.$name=b};f.$removeControl=function(a){a.$name&&f[a.$name]===a&&delete f[a.$name];m(f.$pending,function(b,c){f.$setValidity(c,null,a)});
m(f.$error,function(b,c){f.$setValidity(c,null,a)});m(f.$$success,function(b,c){f.$setValidity(c,null,a)});cb(h,a);a.$$parentForm=Ib};Hd({ctrl:this,$element:b,set:function(a,b,c){var d=a[b];d?-1===d.indexOf(c)&&d.push(c):a[b]=[c]},unset:function(a,b,c){var d=a[b];d&&(cb(d,c),0===d.length&&delete a[b])},$animate:d});f.$setDirty=function(){d.removeClass(b,Ya);d.addClass(b,Jb);f.$dirty=!0;f.$pristine=!1;f.$$parentForm.$setDirty()};f.$setPristine=function(){d.setClass(b,Ya,Jb+" ng-submitted");f.$dirty=
!1;f.$pristine=!0;f.$submitted=!1;m(h,function(a){a.$setPristine()})};f.$setUntouched=function(){m(h,function(a){a.$setUntouched()})};f.$setSubmitted=function(){d.addClass(b,"ng-submitted");f.$submitted=!0;f.$$parentForm.$setSubmitted()}}function jc(b){b.$formatters.push(function(a){return b.$isEmpty(a)?a:a.toString()})}function jb(b,a,c,d,e,f){var h=F(a[0].type);if(!e.android){var g=!1;a.on("compositionstart",function(a){g=!0});a.on("compositionend",function(){g=!1;l()})}var l=function(b){k&&(f.defer.cancel(k),
k=null);if(!g){var e=a.val();b=b&&b.type;"password"===h||c.ngTrim&&"false"===c.ngTrim||(e=T(e));(d.$viewValue!==e||""===e&&d.$$hasNativeValidators)&&d.$setViewValue(e,b)}};if(e.hasEvent("input"))a.on("input",l);else{var k,n=function(a,b,c){k||(k=f.defer(function(){k=null;b&&b.value===c||l(a)}))};a.on("keydown",function(a){var b=a.keyCode;91===b||15<b&&19>b||37<=b&&40>=b||n(a,this,this.value)});if(e.hasEvent("paste"))a.on("paste cut",n)}a.on("change",l);d.$render=function(){var b=d.$isEmpty(d.$viewValue)?
"":d.$viewValue;a.val()!==b&&a.val(b)}}function Kb(b,a){return function(c,d){var e,f;if(ea(c))return c;if(G(c)){'"'==c.charAt(0)&&'"'==c.charAt(c.length-1)&&(c=c.substring(1,c.length-1));if(ig.test(c))return new Date(c);b.lastIndex=0;if(e=b.exec(c))return e.shift(),f=d?{yyyy:d.getFullYear(),MM:d.getMonth()+1,dd:d.getDate(),HH:d.getHours(),mm:d.getMinutes(),ss:d.getSeconds(),sss:d.getMilliseconds()/1E3}:{yyyy:1970,MM:1,dd:1,HH:0,mm:0,ss:0,sss:0},m(e,function(b,c){c<a.length&&(f[a[c]]=+b)}),new Date(f.yyyy,
f.MM-1,f.dd,f.HH,f.mm,f.ss||0,1E3*f.sss||0)}return NaN}}function kb(b,a,c,d){return function(e,f,h,g,l,k,n){function p(a){return a&&!(a.getTime&&a.getTime()!==a.getTime())}function r(a){return A(a)&&!ea(a)?c(a)||w:a}Id(e,f,h,g);jb(e,f,h,g,l,k);var t=g&&g.$options&&g.$options.timezone,m;g.$$parserName=b;g.$parsers.push(function(b){return g.$isEmpty(b)?null:a.test(b)?(b=c(b,m),t&&(b=Ob(b,t)),b):w});g.$formatters.push(function(a){if(a&&!ea(a))throw lb("datefmt",a);if(p(a))return(m=a)&&t&&(m=Ob(m,t,!0)),
n("date")(a,d,t);m=null;return""});if(A(h.min)||h.ngMin){var s;g.$validators.min=function(a){return!p(a)||v(s)||c(a)>=s};h.$observe("min",function(a){s=r(a);g.$validate()})}if(A(h.max)||h.ngMax){var u;g.$validators.max=function(a){return!p(a)||v(u)||c(a)<=u};h.$observe("max",function(a){u=r(a);g.$validate()})}}}function Id(b,a,c,d){(d.$$hasNativeValidators=C(a[0].validity))&&d.$parsers.push(function(b){var c=a.prop("validity")||{};return c.badInput&&!c.typeMismatch?w:b})}function Jd(b,a,c,d,e){if(A(d)){b=
b(d);if(!b.constant)throw lb("constexpr",c,d);return b(a)}return e}function kc(b,a){b="ngClass"+b;return["$animate",function(c){function d(a,b){var c=[],d=0;a:for(;d<a.length;d++){for(var e=a[d],n=0;n<b.length;n++)if(e==b[n])continue a;c.push(e)}return c}function e(a){var b=[];return J(a)?(m(a,function(a){b=b.concat(e(a))}),b):G(a)?a.split(" "):C(a)?(m(a,function(a,c){a&&(b=b.concat(c.split(" ")))}),b):a}return{restrict:"AC",link:function(f,h,g){function l(a,b){var c=h.data("$classCounts")||fa(),
d=[];m(a,function(a){if(0<b||c[a])c[a]=(c[a]||0)+b,c[a]===+(0<b)&&d.push(a)});h.data("$classCounts",c);return d.join(" ")}function k(b){if(!0===a||f.$index%2===a){var k=e(b||[]);if(!n){var m=l(k,1);g.$addClass(m)}else if(!ka(b,n)){var s=e(n),m=d(k,s),k=d(s,k),m=l(m,1),k=l(k,-1);m&&m.length&&c.addClass(h,m);k&&k.length&&c.removeClass(h,k)}}n=ja(b)}var n;f.$watch(g[b],k,!0);g.$observe("class",function(a){k(f.$eval(g[b]))});"ngClass"!==b&&f.$watch("$index",function(c,d){var h=c&1;if(h!==(d&1)){var k=
e(f.$eval(g[b]));h===a?(h=l(k,1),g.$addClass(h)):(h=l(k,-1),g.$removeClass(h))}})}}}]}function Hd(b){function a(a,b){b&&!f[a]?(l.addClass(e,a),f[a]=!0):!b&&f[a]&&(l.removeClass(e,a),f[a]=!1)}function c(b,c){b=b?"-"+Ac(b,"-"):"";a(mb+b,!0===c);a(Kd+b,!1===c)}var d=b.ctrl,e=b.$element,f={},h=b.set,g=b.unset,l=b.$animate;f[Kd]=!(f[mb]=e.hasClass(mb));d.$setValidity=function(b,e,f){v(e)?(d.$pending||(d.$pending={}),h(d.$pending,b,f)):(d.$pending&&g(d.$pending,b,f),Ld(d.$pending)&&(d.$pending=w));bb(e)?
e?(g(d.$error,b,f),h(d.$$success,b,f)):(h(d.$error,b,f),g(d.$$success,b,f)):(g(d.$error,b,f),g(d.$$success,b,f));d.$pending?(a(Md,!0),d.$valid=d.$invalid=w,c("",null)):(a(Md,!1),d.$valid=Ld(d.$error),d.$invalid=!d.$valid,c("",d.$valid));e=d.$pending&&d.$pending[b]?w:d.$error[b]?!1:d.$$success[b]?!0:null;c(b,e);d.$$parentForm.$setValidity(b,e,d)}}function Ld(b){if(b)for(var a in b)if(b.hasOwnProperty(a))return!1;return!0}var jg=/^\/(.+)\/([a-z]*)$/,F=function(b){return G(b)?b.toLowerCase():b},ta=Object.prototype.hasOwnProperty,
sb=function(b){return G(b)?b.toUpperCase():b},Wa,B,ra,ua=[].slice,Nf=[].splice,kg=[].push,va=Object.prototype.toString,rc=Object.getPrototypeOf,Ea=I("ng"),da=Q.angular||(Q.angular={}),Rb,nb=0;Wa=X.documentMode;y.$inject=[];$a.$inject=[];var J=Array.isArray,tc=/^\[object (Uint8(Clamped)?)|(Uint16)|(Uint32)|(Int8)|(Int16)|(Int32)|(Float(32)|(64))Array\]$/,T=function(b){return G(b)?b.trim():b},vd=function(b){return b.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},Fa=function(){if(!A(Fa.rules)){var b=
X.querySelector("[ng-csp]")||X.querySelector("[data-ng-csp]");if(b){var a=b.getAttribute("ng-csp")||b.getAttribute("data-ng-csp");Fa.rules={noUnsafeEval:!a||-1!==a.indexOf("no-unsafe-eval"),noInlineStyle:!a||-1!==a.indexOf("no-inline-style")}}else{b=Fa;try{new Function(""),a=!1}catch(c){a=!0}b.rules={noUnsafeEval:a,noInlineStyle:!1}}}return Fa.rules},pb=function(){if(A(pb.name_))return pb.name_;var b,a,c=Qa.length,d,e;for(a=0;a<c;++a)if(d=Qa[a],b=X.querySelector("["+d.replace(":","\\:")+"jq]")){e=
b.getAttribute(d+"jq");break}return pb.name_=e},Qa=["ng-","data-ng-","ng:","x-ng-"],be=/[A-Z]/g,Bc=!1,Qb,pa=1,Pa=3,fe={full:"1.4.7",major:1,minor:4,dot:7,codeName:"dark-luminescence"};R.expando="ng339";var hb=R.cache={},Ff=1;R._data=function(b){return this.cache[b[this.expando]]||{}};var Af=/([\:\-\_]+(.))/g,Bf=/^moz([A-Z])/,lg={mouseleave:"mouseout",mouseenter:"mouseover"},Tb=I("jqLite"),Ef=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,Sb=/<|&#?\w+;/,Cf=/<([\w:-]+)/,Df=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,
ma={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ma.optgroup=ma.option;ma.tbody=ma.tfoot=ma.colgroup=ma.caption=ma.thead;ma.th=ma.td;var Ra=R.prototype={ready:function(b){function a(){c||(c=!0,b())}var c=!1;"complete"===X.readyState?setTimeout(a):(this.on("DOMContentLoaded",a),R(Q).on("load",a))},
toString:function(){var b=[];m(this,function(a){b.push(""+a)});return"["+b.join(", ")+"]"},eq:function(b){return 0<=b?B(this[b]):B(this[this.length+b])},length:0,push:kg,sort:[].sort,splice:[].splice},Bb={};m("multiple selected checked disabled readOnly required open".split(" "),function(b){Bb[F(b)]=b});var Sc={};m("input select option textarea button form details".split(" "),function(b){Sc[b]=!0});var $c={ngMinlength:"minlength",ngMaxlength:"maxlength",ngMin:"min",ngMax:"max",ngPattern:"pattern"};
m({data:Vb,removeData:vb,hasData:function(b){for(var a in hb[b.ng339])return!0;return!1}},function(b,a){R[a]=b});m({data:Vb,inheritedData:Ab,scope:function(b){return B.data(b,"$scope")||Ab(b.parentNode||b,["$isolateScope","$scope"])},isolateScope:function(b){return B.data(b,"$isolateScope")||B.data(b,"$isolateScopeNoTemplate")},controller:Pc,injector:function(b){return Ab(b,"$injector")},removeAttr:function(b,a){b.removeAttribute(a)},hasClass:xb,css:function(b,a,c){a=gb(a);if(A(c))b.style[a]=c;else return b.style[a]},
attr:function(b,a,c){var d=b.nodeType;if(d!==Pa&&2!==d&&8!==d)if(d=F(a),Bb[d])if(A(c))c?(b[a]=!0,b.setAttribute(a,d)):(b[a]=!1,b.removeAttribute(d));else return b[a]||(b.attributes.getNamedItem(a)||y).specified?d:w;else if(A(c))b.setAttribute(a,c);else if(b.getAttribute)return b=b.getAttribute(a,2),null===b?w:b},prop:function(b,a,c){if(A(c))b[a]=c;else return b[a]},text:function(){function b(a,b){if(v(b)){var d=a.nodeType;return d===pa||d===Pa?a.textContent:""}a.textContent=b}b.$dv="";return b}(),
val:function(b,a){if(v(a)){if(b.multiple&&"select"===wa(b)){var c=[];m(b.options,function(a){a.selected&&c.push(a.value||a.text)});return 0===c.length?null:c}return b.value}b.value=a},html:function(b,a){if(v(a))return b.innerHTML;ub(b,!0);b.innerHTML=a},empty:Qc},function(b,a){R.prototype[a]=function(a,d){var e,f,h=this.length;if(b!==Qc&&v(2==b.length&&b!==xb&&b!==Pc?a:d)){if(C(a)){for(e=0;e<h;e++)if(b===Vb)b(this[e],a);else for(f in a)b(this[e],f,a[f]);return this}e=b.$dv;h=v(e)?Math.min(h,1):h;
for(f=0;f<h;f++){var g=b(this[f],a,d);e=e?e+g:g}return e}for(e=0;e<h;e++)b(this[e],a,d);return this}});m({removeData:vb,on:function a(c,d,e,f){if(A(f))throw Tb("onargs");if(Lc(c)){var h=wb(c,!0);f=h.events;var g=h.handle;g||(g=h.handle=Hf(c,f));for(var h=0<=d.indexOf(" ")?d.split(" "):[d],l=h.length;l--;){d=h[l];var k=f[d];k||(f[d]=[],"mouseenter"===d||"mouseleave"===d?a(c,lg[d],function(a){var c=a.relatedTarget;c&&(c===this||this.contains(c))||g(a,d)}):"$destroy"!==d&&c.addEventListener(d,g,!1),
k=f[d]);k.push(e)}}},off:Oc,one:function(a,c,d){a=B(a);a.on(c,function f(){a.off(c,d);a.off(c,f)});a.on(c,d)},replaceWith:function(a,c){var d,e=a.parentNode;ub(a);m(new R(c),function(c){d?e.insertBefore(c,d.nextSibling):e.replaceChild(c,a);d=c})},children:function(a){var c=[];m(a.childNodes,function(a){a.nodeType===pa&&c.push(a)});return c},contents:function(a){return a.contentDocument||a.childNodes||[]},append:function(a,c){var d=a.nodeType;if(d===pa||11===d){c=new R(c);for(var d=0,e=c.length;d<
e;d++)a.appendChild(c[d])}},prepend:function(a,c){if(a.nodeType===pa){var d=a.firstChild;m(new R(c),function(c){a.insertBefore(c,d)})}},wrap:function(a,c){c=B(c).eq(0).clone()[0];var d=a.parentNode;d&&d.replaceChild(c,a);c.appendChild(a)},remove:Wb,detach:function(a){Wb(a,!0)},after:function(a,c){var d=a,e=a.parentNode;c=new R(c);for(var f=0,h=c.length;f<h;f++){var g=c[f];e.insertBefore(g,d.nextSibling);d=g}},addClass:zb,removeClass:yb,toggleClass:function(a,c,d){c&&m(c.split(" "),function(c){var f=
d;v(f)&&(f=!xb(a,c));(f?zb:yb)(a,c)})},parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},next:function(a){return a.nextElementSibling},find:function(a,c){return a.getElementsByTagName?a.getElementsByTagName(c):[]},clone:Ub,triggerHandler:function(a,c,d){var e,f,h=c.type||c,g=wb(a);if(g=(g=g&&g.events)&&g[h])e={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopImmediatePropagation:function(){this.immediatePropagationStopped=
!0},isImmediatePropagationStopped:function(){return!0===this.immediatePropagationStopped},stopPropagation:y,type:h,target:a},c.type&&(e=P(e,c)),c=ja(g),f=d?[e].concat(d):[e],m(c,function(c){e.isImmediatePropagationStopped()||c.apply(a,f)})}},function(a,c){R.prototype[c]=function(c,e,f){for(var h,g=0,l=this.length;g<l;g++)v(h)?(h=a(this[g],c,e,f),A(h)&&(h=B(h))):Nc(h,a(this[g],c,e,f));return A(h)?h:this};R.prototype.bind=R.prototype.on;R.prototype.unbind=R.prototype.off});Ua.prototype={put:function(a,
c){this[Ga(a,this.nextUid)]=c},get:function(a){return this[Ga(a,this.nextUid)]},remove:function(a){var c=this[a=Ga(a,this.nextUid)];delete this[a];return c}};var yf=[function(){this.$get=[function(){return Ua}]}],Uc=/^[^\(]*\(\s*([^\)]*)\)/m,mg=/,/,ng=/^\s*(_?)(\S+?)\1\s*$/,Tc=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,Ha=I("$injector");fb.$$annotate=function(a,c,d){var e;if("function"===typeof a){if(!(e=a.$inject)){e=[];if(a.length){if(c)throw G(d)&&d||(d=a.name||If(a)),Ha("strictdi",d);c=a.toString().replace(Tc,
"");c=c.match(Uc);m(c[1].split(mg),function(a){a.replace(ng,function(a,c,d){e.push(d)})})}a.$inject=e}}else J(a)?(c=a.length-1,Sa(a[c],"fn"),e=a.slice(0,c)):Sa(a,"fn",!0);return e};var Nd=I("$animate"),Ue=function(){this.$get=["$q","$$rAF",function(a,c){function d(){}d.all=y;d.chain=y;d.prototype={end:y,cancel:y,resume:y,pause:y,complete:y,then:function(d,f){return a(function(a){c(function(){a()})}).then(d,f)}};return d}]},Te=function(){var a=new Ua,c=[];this.$get=["$$AnimateRunner","$rootScope",
function(d,e){function f(a,c,d){var e=!1;c&&(c=G(c)?c.split(" "):J(c)?c:[],m(c,function(c){c&&(e=!0,a[c]=d)}));return e}function h(){m(c,function(c){var d=a.get(c);if(d){var e=Jf(c.attr("class")),f="",h="";m(d,function(a,c){a!==!!e[c]&&(a?f+=(f.length?" ":"")+c:h+=(h.length?" ":"")+c)});m(c,function(a){f&&zb(a,f);h&&yb(a,h)});a.remove(c)}});c.length=0}return{enabled:y,on:y,off:y,pin:y,push:function(g,l,k,n){n&&n();k=k||{};k.from&&g.css(k.from);k.to&&g.css(k.to);if(k.addClass||k.removeClass)if(l=k.addClass,
n=k.removeClass,k=a.get(g)||{},l=f(k,l,!0),n=f(k,n,!1),l||n)a.put(g,k),c.push(g),1===c.length&&e.$$postDigest(h);return new d}}}]},Re=["$provide",function(a){var c=this;this.$$registeredAnimations=Object.create(null);this.register=function(d,e){if(d&&"."!==d.charAt(0))throw Nd("notcsel",d);var f=d+"-animation";c.$$registeredAnimations[d.substr(1)]=f;a.factory(f,e)};this.classNameFilter=function(a){if(1===arguments.length&&(this.$$classNameFilter=a instanceof RegExp?a:null)&&/(\s+|\/)ng-animate(\s+|\/)/.test(this.$$classNameFilter.toString()))throw Nd("nongcls",
"ng-animate");return this.$$classNameFilter};this.$get=["$$animateQueue",function(a){function c(a,d,e){if(e){var l;a:{for(l=0;l<e.length;l++){var k=e[l];if(1===k.nodeType){l=k;break a}}l=void 0}!l||l.parentNode||l.previousElementSibling||(e=null)}e?e.after(a):d.prepend(a)}return{on:a.on,off:a.off,pin:a.pin,enabled:a.enabled,cancel:function(a){a.end&&a.end()},enter:function(f,h,g,l){h=h&&B(h);g=g&&B(g);h=h||g.parent();c(f,h,g);return a.push(f,"enter",Ia(l))},move:function(f,h,g,l){h=h&&B(h);g=g&&B(g);
h=h||g.parent();c(f,h,g);return a.push(f,"move",Ia(l))},leave:function(c,e){return a.push(c,"leave",Ia(e),function(){c.remove()})},addClass:function(c,e,g){g=Ia(g);g.addClass=ib(g.addclass,e);return a.push(c,"addClass",g)},removeClass:function(c,e,g){g=Ia(g);g.removeClass=ib(g.removeClass,e);return a.push(c,"removeClass",g)},setClass:function(c,e,g,l){l=Ia(l);l.addClass=ib(l.addClass,e);l.removeClass=ib(l.removeClass,g);return a.push(c,"setClass",l)},animate:function(c,e,g,l,k){k=Ia(k);k.from=k.from?
P(k.from,e):e;k.to=k.to?P(k.to,g):g;k.tempClasses=ib(k.tempClasses,l||"ng-inline-animate");return a.push(c,"animate",k)}}}]}],Se=function(){this.$get=["$$rAF","$q",function(a,c){var d=function(){};d.prototype={done:function(a){this.defer&&this.defer[!0===a?"reject":"resolve"]()},end:function(){this.done()},cancel:function(){this.done(!0)},getPromise:function(){this.defer||(this.defer=c.defer());return this.defer.promise},then:function(a,c){return this.getPromise().then(a,c)},"catch":function(a){return this.getPromise()["catch"](a)},
"finally":function(a){return this.getPromise()["finally"](a)}};return function(c,f){function h(){a(function(){f.addClass&&(c.addClass(f.addClass),f.addClass=null);f.removeClass&&(c.removeClass(f.removeClass),f.removeClass=null);f.to&&(c.css(f.to),f.to=null);g||l.done();g=!0});return l}f.cleanupStyles&&(f.from=f.to=null);f.from&&(c.css(f.from),f.from=null);var g,l=new d;return{start:h,end:h}}}]},ga=I("$compile");Dc.$inject=["$provide","$$sanitizeUriProvider"];var Wc=/^((?:x|data)[\:\-_])/i,Of=I("$controller"),
Vc=/^(\S+)(\s+as\s+(\w+))?$/,$e=function(){this.$get=["$document",function(a){return function(c){c?!c.nodeType&&c instanceof B&&(c=c[0]):c=a[0].body;return c.offsetWidth+1}}]},ad="application/json",$b={"Content-Type":ad+";charset=utf-8"},Qf=/^\[|^\{(?!\{)/,Rf={"[":/]$/,"{":/}$/},Pf=/^\)\]\}',?\n/,og=I("$http"),ed=function(a){return function(){throw og("legacy",a);}},La=da.$interpolateMinErr=I("$interpolate");La.throwNoconcat=function(a){throw La("noconcat",a);};La.interr=function(a,c){return La("interr",
a,c.toString())};var pg=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,Tf={http:80,https:443,ftp:21},Db=I("$location"),qg={$$html5:!1,$$replace:!1,absUrl:Eb("$$absUrl"),url:function(a){if(v(a))return this.$$url;var c=pg.exec(a);(c[1]||""===a)&&this.path(decodeURIComponent(c[1]));(c[2]||c[1]||""===a)&&this.search(c[3]||"");this.hash(c[5]||"");return this},protocol:Eb("$$protocol"),host:Eb("$$host"),port:Eb("$$port"),path:jd("$$path",function(a){a=null!==a?a.toString():"";return"/"==a.charAt(0)?a:"/"+a}),search:function(a,
c){switch(arguments.length){case 0:return this.$$search;case 1:if(G(a)||V(a))a=a.toString(),this.$$search=yc(a);else if(C(a))a=ha(a,{}),m(a,function(c,e){null==c&&delete a[e]}),this.$$search=a;else throw Db("isrcharg");break;default:v(c)||null===c?delete this.$$search[a]:this.$$search[a]=c}this.$$compose();return this},hash:jd("$$hash",function(a){return null!==a?a.toString():""}),replace:function(){this.$$replace=!0;return this}};m([id,cc,bc],function(a){a.prototype=Object.create(qg);a.prototype.state=
function(c){if(!arguments.length)return this.$$state;if(a!==bc||!this.$$html5)throw Db("nostate");this.$$state=v(c)?null:c;return this}});var Z=I("$parse"),Uf=Function.prototype.call,Vf=Function.prototype.apply,Wf=Function.prototype.bind,Lb=fa();m("+ - * / % === !== == != < > <= >= && || ! = |".split(" "),function(a){Lb[a]=!0});var rg={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'},ec=function(a){this.options=a};ec.prototype={constructor:ec,lex:function(a){this.text=a;this.index=0;for(this.tokens=
[];this.index<this.text.length;)if(a=this.text.charAt(this.index),'"'===a||"'"===a)this.readString(a);else if(this.isNumber(a)||"."===a&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(a))this.readIdent();else if(this.is(a,"(){}[].,;:?"))this.tokens.push({index:this.index,text:a}),this.index++;else if(this.isWhitespace(a))this.index++;else{var c=a+this.peek(),d=c+this.peek(2),e=Lb[c],f=Lb[d];Lb[a]||e||f?(a=f?d:e?c:a,this.tokens.push({index:this.index,text:a,operator:!0}),this.index+=
a.length):this.throwError("Unexpected next character ",this.index,this.index+1)}return this.tokens},is:function(a,c){return-1!==c.indexOf(a)},peek:function(a){a=a||1;return this.index+a<this.text.length?this.text.charAt(this.index+a):!1},isNumber:function(a){return"0"<=a&&"9">=a&&"string"===typeof a},isWhitespace:function(a){return" "===a||"\r"===a||"\t"===a||"\n"===a||"\v"===a||"\u00a0"===a},isIdent:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a||"_"===a||"$"===a},isExpOperator:function(a){return"-"===
a||"+"===a||this.isNumber(a)},throwError:function(a,c,d){d=d||this.index;c=A(c)?"s "+c+"-"+this.index+" ["+this.text.substring(c,d)+"]":" "+d;throw Z("lexerr",a,c,this.text);},readNumber:function(){for(var a="",c=this.index;this.index<this.text.length;){var d=F(this.text.charAt(this.index));if("."==d||this.isNumber(d))a+=d;else{var e=this.peek();if("e"==d&&this.isExpOperator(e))a+=d;else if(this.isExpOperator(d)&&e&&this.isNumber(e)&&"e"==a.charAt(a.length-1))a+=d;else if(!this.isExpOperator(d)||
e&&this.isNumber(e)||"e"!=a.charAt(a.length-1))break;else this.throwError("Invalid exponent")}this.index++}this.tokens.push({index:c,text:a,constant:!0,value:Number(a)})},readIdent:function(){for(var a=this.index;this.index<this.text.length;){var c=this.text.charAt(this.index);if(!this.isIdent(c)&&!this.isNumber(c))break;this.index++}this.tokens.push({index:a,text:this.text.slice(a,this.index),identifier:!0})},readString:function(a){var c=this.index;this.index++;for(var d="",e=a,f=!1;this.index<this.text.length;){var h=
this.text.charAt(this.index),e=e+h;if(f)"u"===h?(f=this.text.substring(this.index+1,this.index+5),f.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+f+"]"),this.index+=4,d+=String.fromCharCode(parseInt(f,16))):d+=rg[h]||h,f=!1;else if("\\"===h)f=!0;else{if(h===a){this.index++;this.tokens.push({index:c,text:e,constant:!0,value:d});return}d+=h}this.index++}this.throwError("Unterminated quote",c)}};var s=function(a,c){this.lexer=a;this.options=c};s.Program="Program";s.ExpressionStatement=
"ExpressionStatement";s.AssignmentExpression="AssignmentExpression";s.ConditionalExpression="ConditionalExpression";s.LogicalExpression="LogicalExpression";s.BinaryExpression="BinaryExpression";s.UnaryExpression="UnaryExpression";s.CallExpression="CallExpression";s.MemberExpression="MemberExpression";s.Identifier="Identifier";s.Literal="Literal";s.ArrayExpression="ArrayExpression";s.Property="Property";s.ObjectExpression="ObjectExpression";s.ThisExpression="ThisExpression";s.NGValueParameter="NGValueParameter";
s.prototype={ast:function(a){this.text=a;this.tokens=this.lexer.lex(a);a=this.program();0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]);return a},program:function(){for(var a=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&a.push(this.expressionStatement()),!this.expect(";"))return{type:s.Program,body:a}},expressionStatement:function(){return{type:s.ExpressionStatement,expression:this.filterChain()}},filterChain:function(){for(var a=this.expression();this.expect("|");)a=
this.filter(a);return a},expression:function(){return this.assignment()},assignment:function(){var a=this.ternary();this.expect("=")&&(a={type:s.AssignmentExpression,left:a,right:this.assignment(),operator:"="});return a},ternary:function(){var a=this.logicalOR(),c,d;return this.expect("?")&&(c=this.expression(),this.consume(":"))?(d=this.expression(),{type:s.ConditionalExpression,test:a,alternate:c,consequent:d}):a},logicalOR:function(){for(var a=this.logicalAND();this.expect("||");)a={type:s.LogicalExpression,
operator:"||",left:a,right:this.logicalAND()};return a},logicalAND:function(){for(var a=this.equality();this.expect("&&");)a={type:s.LogicalExpression,operator:"&&",left:a,right:this.equality()};return a},equality:function(){for(var a=this.relational(),c;c=this.expect("==","!=","===","!==");)a={type:s.BinaryExpression,operator:c.text,left:a,right:this.relational()};return a},relational:function(){for(var a=this.additive(),c;c=this.expect("<",">","<=",">=");)a={type:s.BinaryExpression,operator:c.text,
left:a,right:this.additive()};return a},additive:function(){for(var a=this.multiplicative(),c;c=this.expect("+","-");)a={type:s.BinaryExpression,operator:c.text,left:a,right:this.multiplicative()};return a},multiplicative:function(){for(var a=this.unary(),c;c=this.expect("*","/","%");)a={type:s.BinaryExpression,operator:c.text,left:a,right:this.unary()};return a},unary:function(){var a;return(a=this.expect("+","-","!"))?{type:s.UnaryExpression,operator:a.text,prefix:!0,argument:this.unary()}:this.primary()},
primary:function(){var a;this.expect("(")?(a=this.filterChain(),this.consume(")")):this.expect("[")?a=this.arrayDeclaration():this.expect("{")?a=this.object():this.constants.hasOwnProperty(this.peek().text)?a=ha(this.constants[this.consume().text]):this.peek().identifier?a=this.identifier():this.peek().constant?a=this.constant():this.throwError("not a primary expression",this.peek());for(var c;c=this.expect("(","[",".");)"("===c.text?(a={type:s.CallExpression,callee:a,arguments:this.parseArguments()},
this.consume(")")):"["===c.text?(a={type:s.MemberExpression,object:a,property:this.expression(),computed:!0},this.consume("]")):"."===c.text?a={type:s.MemberExpression,object:a,property:this.identifier(),computed:!1}:this.throwError("IMPOSSIBLE");return a},filter:function(a){a=[a];for(var c={type:s.CallExpression,callee:this.identifier(),arguments:a,filter:!0};this.expect(":");)a.push(this.expression());return c},parseArguments:function(){var a=[];if(")"!==this.peekToken().text){do a.push(this.expression());
while(this.expect(","))}return a},identifier:function(){var a=this.consume();a.identifier||this.throwError("is not a valid identifier",a);return{type:s.Identifier,name:a.text}},constant:function(){return{type:s.Literal,value:this.consume().value}},arrayDeclaration:function(){var a=[];if("]"!==this.peekToken().text){do{if(this.peek("]"))break;a.push(this.expression())}while(this.expect(","))}this.consume("]");return{type:s.ArrayExpression,elements:a}},object:function(){var a=[],c;if("}"!==this.peekToken().text){do{if(this.peek("}"))break;
c={type:s.Property,kind:"init"};this.peek().constant?c.key=this.constant():this.peek().identifier?c.key=this.identifier():this.throwError("invalid key",this.peek());this.consume(":");c.value=this.expression();a.push(c)}while(this.expect(","))}this.consume("}");return{type:s.ObjectExpression,properties:a}},throwError:function(a,c){throw Z("syntax",c.text,a,c.index+1,this.text,this.text.substring(c.index));},consume:function(a){if(0===this.tokens.length)throw Z("ueoe",this.text);var c=this.expect(a);
c||this.throwError("is unexpected, expecting ["+a+"]",this.peek());return c},peekToken:function(){if(0===this.tokens.length)throw Z("ueoe",this.text);return this.tokens[0]},peek:function(a,c,d,e){return this.peekAhead(0,a,c,d,e)},peekAhead:function(a,c,d,e,f){if(this.tokens.length>a){a=this.tokens[a];var h=a.text;if(h===c||h===d||h===e||h===f||!(c||d||e||f))return a}return!1},expect:function(a,c,d,e){return(a=this.peek(a,c,d,e))?(this.tokens.shift(),a):!1},constants:{"true":{type:s.Literal,value:!0},
"false":{type:s.Literal,value:!1},"null":{type:s.Literal,value:null},undefined:{type:s.Literal,value:w},"this":{type:s.ThisExpression}}};sd.prototype={compile:function(a,c){var d=this,e=this.astBuilder.ast(a);this.state={nextId:0,filters:{},expensiveChecks:c,fn:{vars:[],body:[],own:{}},assign:{vars:[],body:[],own:{}},inputs:[]};U(e,d.$filter);var f="",h;this.stage="assign";if(h=qd(e))this.state.computing="assign",f=this.nextId(),this.recurse(h,f),this.return_(f),f="fn.assign="+this.generateFunction("assign",
"s,v,l");h=od(e.body);d.stage="inputs";m(h,function(a,c){var e="fn"+c;d.state[e]={vars:[],body:[],own:{}};d.state.computing=e;var f=d.nextId();d.recurse(a,f);d.return_(f);d.state.inputs.push(e);a.watchId=c});this.state.computing="fn";this.stage="main";this.recurse(e);f='"'+this.USE+" "+this.STRICT+'";\n'+this.filterPrefix()+"var fn="+this.generateFunction("fn","s,l,a,i")+f+this.watchFns()+"return fn;";f=(new Function("$filter","ensureSafeMemberName","ensureSafeObject","ensureSafeFunction","getStringValue",
"ensureSafeAssignContext","ifDefined","plus","text",f))(this.$filter,Xa,Ba,ld,kd,md,Xf,nd,a);this.state=this.stage=w;f.literal=rd(e);f.constant=e.constant;return f},USE:"use",STRICT:"strict",watchFns:function(){var a=[],c=this.state.inputs,d=this;m(c,function(c){a.push("var "+c+"="+d.generateFunction(c,"s"))});c.length&&a.push("fn.inputs=["+c.join(",")+"];");return a.join("")},generateFunction:function(a,c){return"function("+c+"){"+this.varsPrefix(a)+this.body(a)+"};"},filterPrefix:function(){var a=
[],c=this;m(this.state.filters,function(d,e){a.push(d+"=$filter("+c.escape(e)+")")});return a.length?"var "+a.join(",")+";":""},varsPrefix:function(a){return this.state[a].vars.length?"var "+this.state[a].vars.join(",")+";":""},body:function(a){return this.state[a].body.join("")},recurse:function(a,c,d,e,f,h){var g,l,k=this,n,p;e=e||y;if(!h&&A(a.watchId))c=c||this.nextId(),this.if_("i",this.lazyAssign(c,this.computedMember("i",a.watchId)),this.lazyRecurse(a,c,d,e,f,!0));else switch(a.type){case s.Program:m(a.body,
function(c,d){k.recurse(c.expression,w,w,function(a){l=a});d!==a.body.length-1?k.current().body.push(l,";"):k.return_(l)});break;case s.Literal:p=this.escape(a.value);this.assign(c,p);e(p);break;case s.UnaryExpression:this.recurse(a.argument,w,w,function(a){l=a});p=a.operator+"("+this.ifDefined(l,0)+")";this.assign(c,p);e(p);break;case s.BinaryExpression:this.recurse(a.left,w,w,function(a){g=a});this.recurse(a.right,w,w,function(a){l=a});p="+"===a.operator?this.plus(g,l):"-"===a.operator?this.ifDefined(g,
0)+a.operator+this.ifDefined(l,0):"("+g+")"+a.operator+"("+l+")";this.assign(c,p);e(p);break;case s.LogicalExpression:c=c||this.nextId();k.recurse(a.left,c);k.if_("&&"===a.operator?c:k.not(c),k.lazyRecurse(a.right,c));e(c);break;case s.ConditionalExpression:c=c||this.nextId();k.recurse(a.test,c);k.if_(c,k.lazyRecurse(a.alternate,c),k.lazyRecurse(a.consequent,c));e(c);break;case s.Identifier:c=c||this.nextId();d&&(d.context="inputs"===k.stage?"s":this.assign(this.nextId(),this.getHasOwnProperty("l",
a.name)+"?l:s"),d.computed=!1,d.name=a.name);Xa(a.name);k.if_("inputs"===k.stage||k.not(k.getHasOwnProperty("l",a.name)),function(){k.if_("inputs"===k.stage||"s",function(){f&&1!==f&&k.if_(k.not(k.nonComputedMember("s",a.name)),k.lazyAssign(k.nonComputedMember("s",a.name),"{}"));k.assign(c,k.nonComputedMember("s",a.name))})},c&&k.lazyAssign(c,k.nonComputedMember("l",a.name)));(k.state.expensiveChecks||Fb(a.name))&&k.addEnsureSafeObject(c);e(c);break;case s.MemberExpression:g=d&&(d.context=this.nextId())||
this.nextId();c=c||this.nextId();k.recurse(a.object,g,w,function(){k.if_(k.notNull(g),function(){if(a.computed)l=k.nextId(),k.recurse(a.property,l),k.getStringValue(l),k.addEnsureSafeMemberName(l),f&&1!==f&&k.if_(k.not(k.computedMember(g,l)),k.lazyAssign(k.computedMember(g,l),"{}")),p=k.ensureSafeObject(k.computedMember(g,l)),k.assign(c,p),d&&(d.computed=!0,d.name=l);else{Xa(a.property.name);f&&1!==f&&k.if_(k.not(k.nonComputedMember(g,a.property.name)),k.lazyAssign(k.nonComputedMember(g,a.property.name),
"{}"));p=k.nonComputedMember(g,a.property.name);if(k.state.expensiveChecks||Fb(a.property.name))p=k.ensureSafeObject(p);k.assign(c,p);d&&(d.computed=!1,d.name=a.property.name)}},function(){k.assign(c,"undefined")});e(c)},!!f);break;case s.CallExpression:c=c||this.nextId();a.filter?(l=k.filter(a.callee.name),n=[],m(a.arguments,function(a){var c=k.nextId();k.recurse(a,c);n.push(c)}),p=l+"("+n.join(",")+")",k.assign(c,p),e(c)):(l=k.nextId(),g={},n=[],k.recurse(a.callee,l,g,function(){k.if_(k.notNull(l),
function(){k.addEnsureSafeFunction(l);m(a.arguments,function(a){k.recurse(a,k.nextId(),w,function(a){n.push(k.ensureSafeObject(a))})});g.name?(k.state.expensiveChecks||k.addEnsureSafeObject(g.context),p=k.member(g.context,g.name,g.computed)+"("+n.join(",")+")"):p=l+"("+n.join(",")+")";p=k.ensureSafeObject(p);k.assign(c,p)},function(){k.assign(c,"undefined")});e(c)}));break;case s.AssignmentExpression:l=this.nextId();g={};if(!pd(a.left))throw Z("lval");this.recurse(a.left,w,g,function(){k.if_(k.notNull(g.context),
function(){k.recurse(a.right,l);k.addEnsureSafeObject(k.member(g.context,g.name,g.computed));k.addEnsureSafeAssignContext(g.context);p=k.member(g.context,g.name,g.computed)+a.operator+l;k.assign(c,p);e(c||p)})},1);break;case s.ArrayExpression:n=[];m(a.elements,function(a){k.recurse(a,k.nextId(),w,function(a){n.push(a)})});p="["+n.join(",")+"]";this.assign(c,p);e(p);break;case s.ObjectExpression:n=[];m(a.properties,function(a){k.recurse(a.value,k.nextId(),w,function(c){n.push(k.escape(a.key.type===
s.Identifier?a.key.name:""+a.key.value)+":"+c)})});p="{"+n.join(",")+"}";this.assign(c,p);e(p);break;case s.ThisExpression:this.assign(c,"s");e("s");break;case s.NGValueParameter:this.assign(c,"v"),e("v")}},getHasOwnProperty:function(a,c){var d=a+"."+c,e=this.current().own;e.hasOwnProperty(d)||(e[d]=this.nextId(!1,a+"&&("+this.escape(c)+" in "+a+")"));return e[d]},assign:function(a,c){if(a)return this.current().body.push(a,"=",c,";"),a},filter:function(a){this.state.filters.hasOwnProperty(a)||(this.state.filters[a]=
this.nextId(!0));return this.state.filters[a]},ifDefined:function(a,c){return"ifDefined("+a+","+this.escape(c)+")"},plus:function(a,c){return"plus("+a+","+c+")"},return_:function(a){this.current().body.push("return ",a,";")},if_:function(a,c,d){if(!0===a)c();else{var e=this.current().body;e.push("if(",a,"){");c();e.push("}");d&&(e.push("else{"),d(),e.push("}"))}},not:function(a){return"!("+a+")"},notNull:function(a){return a+"!=null"},nonComputedMember:function(a,c){return a+"."+c},computedMember:function(a,
c){return a+"["+c+"]"},member:function(a,c,d){return d?this.computedMember(a,c):this.nonComputedMember(a,c)},addEnsureSafeObject:function(a){this.current().body.push(this.ensureSafeObject(a),";")},addEnsureSafeMemberName:function(a){this.current().body.push(this.ensureSafeMemberName(a),";")},addEnsureSafeFunction:function(a){this.current().body.push(this.ensureSafeFunction(a),";")},addEnsureSafeAssignContext:function(a){this.current().body.push(this.ensureSafeAssignContext(a),";")},ensureSafeObject:function(a){return"ensureSafeObject("+
a+",text)"},ensureSafeMemberName:function(a){return"ensureSafeMemberName("+a+",text)"},ensureSafeFunction:function(a){return"ensureSafeFunction("+a+",text)"},getStringValue:function(a){this.assign(a,"getStringValue("+a+",text)")},ensureSafeAssignContext:function(a){return"ensureSafeAssignContext("+a+",text)"},lazyRecurse:function(a,c,d,e,f,h){var g=this;return function(){g.recurse(a,c,d,e,f,h)}},lazyAssign:function(a,c){var d=this;return function(){d.assign(a,c)}},stringEscapeRegex:/[^ a-zA-Z0-9]/g,
stringEscapeFn:function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)},escape:function(a){if(G(a))return"'"+a.replace(this.stringEscapeRegex,this.stringEscapeFn)+"'";if(V(a))return a.toString();if(!0===a)return"true";if(!1===a)return"false";if(null===a)return"null";if("undefined"===typeof a)return"undefined";throw Z("esc");},nextId:function(a,c){var d="v"+this.state.nextId++;a||this.current().vars.push(d+(c?"="+c:""));return d},current:function(){return this.state[this.state.computing]}};
td.prototype={compile:function(a,c){var d=this,e=this.astBuilder.ast(a);this.expression=a;this.expensiveChecks=c;U(e,d.$filter);var f,h;if(f=qd(e))h=this.recurse(f);f=od(e.body);var g;f&&(g=[],m(f,function(a,c){var e=d.recurse(a);a.input=e;g.push(e);a.watchId=c}));var l=[];m(e.body,function(a){l.push(d.recurse(a.expression))});f=0===e.body.length?function(){}:1===e.body.length?l[0]:function(a,c){var d;m(l,function(e){d=e(a,c)});return d};h&&(f.assign=function(a,c,d){return h(a,d,c)});g&&(f.inputs=
g);f.literal=rd(e);f.constant=e.constant;return f},recurse:function(a,c,d){var e,f,h=this,g;if(a.input)return this.inputs(a.input,a.watchId);switch(a.type){case s.Literal:return this.value(a.value,c);case s.UnaryExpression:return f=this.recurse(a.argument),this["unary"+a.operator](f,c);case s.BinaryExpression:return e=this.recurse(a.left),f=this.recurse(a.right),this["binary"+a.operator](e,f,c);case s.LogicalExpression:return e=this.recurse(a.left),f=this.recurse(a.right),this["binary"+a.operator](e,
f,c);case s.ConditionalExpression:return this["ternary?:"](this.recurse(a.test),this.recurse(a.alternate),this.recurse(a.consequent),c);case s.Identifier:return Xa(a.name,h.expression),h.identifier(a.name,h.expensiveChecks||Fb(a.name),c,d,h.expression);case s.MemberExpression:return e=this.recurse(a.object,!1,!!d),a.computed||(Xa(a.property.name,h.expression),f=a.property.name),a.computed&&(f=this.recurse(a.property)),a.computed?this.computedMember(e,f,c,d,h.expression):this.nonComputedMember(e,f,
h.expensiveChecks,c,d,h.expression);case s.CallExpression:return g=[],m(a.arguments,function(a){g.push(h.recurse(a))}),a.filter&&(f=this.$filter(a.callee.name)),a.filter||(f=this.recurse(a.callee,!0)),a.filter?function(a,d,e,h){for(var r=[],m=0;m<g.length;++m)r.push(g[m](a,d,e,h));a=f.apply(w,r,h);return c?{context:w,name:w,value:a}:a}:function(a,d,e,p){var r=f(a,d,e,p),m;if(null!=r.value){Ba(r.context,h.expression);ld(r.value,h.expression);m=[];for(var s=0;s<g.length;++s)m.push(Ba(g[s](a,d,e,p),
h.expression));m=Ba(r.value.apply(r.context,m),h.expression)}return c?{value:m}:m};case s.AssignmentExpression:return e=this.recurse(a.left,!0,1),f=this.recurse(a.right),function(a,d,g,p){var r=e(a,d,g,p);a=f(a,d,g,p);Ba(r.value,h.expression);md(r.context);r.context[r.name]=a;return c?{value:a}:a};case s.ArrayExpression:return g=[],m(a.elements,function(a){g.push(h.recurse(a))}),function(a,d,e,f){for(var h=[],m=0;m<g.length;++m)h.push(g[m](a,d,e,f));return c?{value:h}:h};case s.ObjectExpression:return g=
[],m(a.properties,function(a){g.push({key:a.key.type===s.Identifier?a.key.name:""+a.key.value,value:h.recurse(a.value)})}),function(a,d,e,f){for(var h={},m=0;m<g.length;++m)h[g[m].key]=g[m].value(a,d,e,f);return c?{value:h}:h};case s.ThisExpression:return function(a){return c?{value:a}:a};case s.NGValueParameter:return function(a,d,e,f){return c?{value:e}:e}}},"unary+":function(a,c){return function(d,e,f,h){d=a(d,e,f,h);d=A(d)?+d:0;return c?{value:d}:d}},"unary-":function(a,c){return function(d,e,
f,h){d=a(d,e,f,h);d=A(d)?-d:0;return c?{value:d}:d}},"unary!":function(a,c){return function(d,e,f,h){d=!a(d,e,f,h);return c?{value:d}:d}},"binary+":function(a,c,d){return function(e,f,h,g){var l=a(e,f,h,g);e=c(e,f,h,g);l=nd(l,e);return d?{value:l}:l}},"binary-":function(a,c,d){return function(e,f,h,g){var l=a(e,f,h,g);e=c(e,f,h,g);l=(A(l)?l:0)-(A(e)?e:0);return d?{value:l}:l}},"binary*":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)*c(e,f,h,g);return d?{value:e}:e}},"binary/":function(a,c,
d){return function(e,f,h,g){e=a(e,f,h,g)/c(e,f,h,g);return d?{value:e}:e}},"binary%":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)%c(e,f,h,g);return d?{value:e}:e}},"binary===":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)===c(e,f,h,g);return d?{value:e}:e}},"binary!==":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)!==c(e,f,h,g);return d?{value:e}:e}},"binary==":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)==c(e,f,h,g);return d?{value:e}:e}},"binary!=":function(a,c,
d){return function(e,f,h,g){e=a(e,f,h,g)!=c(e,f,h,g);return d?{value:e}:e}},"binary<":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)<c(e,f,h,g);return d?{value:e}:e}},"binary>":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)>c(e,f,h,g);return d?{value:e}:e}},"binary<=":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)<=c(e,f,h,g);return d?{value:e}:e}},"binary>=":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)>=c(e,f,h,g);return d?{value:e}:e}},"binary&&":function(a,c,d){return function(e,
f,h,g){e=a(e,f,h,g)&&c(e,f,h,g);return d?{value:e}:e}},"binary||":function(a,c,d){return function(e,f,h,g){e=a(e,f,h,g)||c(e,f,h,g);return d?{value:e}:e}},"ternary?:":function(a,c,d,e){return function(f,h,g,l){f=a(f,h,g,l)?c(f,h,g,l):d(f,h,g,l);return e?{value:f}:f}},value:function(a,c){return function(){return c?{context:w,name:w,value:a}:a}},identifier:function(a,c,d,e,f){return function(h,g,l,k){h=g&&a in g?g:h;e&&1!==e&&h&&!h[a]&&(h[a]={});g=h?h[a]:w;c&&Ba(g,f);return d?{context:h,name:a,value:g}:
g}},computedMember:function(a,c,d,e,f){return function(h,g,l,k){var n=a(h,g,l,k),p,m;null!=n&&(p=c(h,g,l,k),p=kd(p),Xa(p,f),e&&1!==e&&n&&!n[p]&&(n[p]={}),m=n[p],Ba(m,f));return d?{context:n,name:p,value:m}:m}},nonComputedMember:function(a,c,d,e,f,h){return function(g,l,k,n){g=a(g,l,k,n);f&&1!==f&&g&&!g[c]&&(g[c]={});l=null!=g?g[c]:w;(d||Fb(c))&&Ba(l,h);return e?{context:g,name:c,value:l}:l}},inputs:function(a,c){return function(d,e,f,h){return h?h[c]:a(d,e,f)}}};var fc=function(a,c,d){this.lexer=
a;this.$filter=c;this.options=d;this.ast=new s(this.lexer);this.astCompiler=d.csp?new td(this.ast,c):new sd(this.ast,c)};fc.prototype={constructor:fc,parse:function(a){return this.astCompiler.compile(a,this.options.expensiveChecks)}};fa();fa();var Yf=Object.prototype.valueOf,Ca=I("$sce"),oa={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},ga=I("$compile"),$=X.createElement("a"),xd=Aa(Q.location.href);yd.$inject=["$document"];Kc.$inject=["$provide"];zd.$inject=["$locale"];Bd.$inject=
["$locale"];var hc=".",hg={yyyy:aa("FullYear",4),yy:aa("FullYear",2,0,!0),y:aa("FullYear",1),MMMM:Hb("Month"),MMM:Hb("Month",!0),MM:aa("Month",2,1),M:aa("Month",1,1),dd:aa("Date",2),d:aa("Date",1),HH:aa("Hours",2),H:aa("Hours",1),hh:aa("Hours",2,-12),h:aa("Hours",1,-12),mm:aa("Minutes",2),m:aa("Minutes",1),ss:aa("Seconds",2),s:aa("Seconds",1),sss:aa("Milliseconds",3),EEEE:Hb("Day"),EEE:Hb("Day",!0),a:function(a,c){return 12>a.getHours()?c.AMPMS[0]:c.AMPMS[1]},Z:function(a,c,d){a=-1*d;return a=(0<=
a?"+":"")+(Gb(Math[0<a?"floor":"ceil"](a/60),2)+Gb(Math.abs(a%60),2))},ww:Fd(2),w:Fd(1),G:ic,GG:ic,GGG:ic,GGGG:function(a,c){return 0>=a.getFullYear()?c.ERANAMES[0]:c.ERANAMES[1]}},gg=/((?:[^yMdHhmsaZEwG']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z|G+|w+))(.*)/,fg=/^\-?\d+$/;Ad.$inject=["$locale"];var cg=qa(F),dg=qa(sb);Cd.$inject=["$parse"];var he=qa({restrict:"E",compile:function(a,c){if(!c.href&&!c.xlinkHref)return function(a,c){if("a"===c[0].nodeName.toLowerCase()){var f="[object SVGAnimatedString]"===
va.call(c.prop("href"))?"xlink:href":"href";c.on("click",function(a){c.attr(f)||a.preventDefault()})}}}}),tb={};m(Bb,function(a,c){function d(a,d,f){a.$watch(f[e],function(a){f.$set(c,!!a)})}if("multiple"!=a){var e=ya("ng-"+c),f=d;"checked"===a&&(f=function(a,c,f){f.ngModel!==f[e]&&d(a,c,f)});tb[e]=function(){return{restrict:"A",priority:100,link:f}}}});m($c,function(a,c){tb[c]=function(){return{priority:100,link:function(a,e,f){if("ngPattern"===c&&"/"==f.ngPattern.charAt(0)&&(e=f.ngPattern.match(jg))){f.$set("ngPattern",
new RegExp(e[1],e[2]));return}a.$watch(f[c],function(a){f.$set(c,a)})}}}});m(["src","srcset","href"],function(a){var c=ya("ng-"+a);tb[c]=function(){return{priority:99,link:function(d,e,f){var h=a,g=a;"href"===a&&"[object SVGAnimatedString]"===va.call(e.prop("href"))&&(g="xlinkHref",f.$attr[g]="xlink:href",h=null);f.$observe(c,function(c){c?(f.$set(g,c),Wa&&h&&e.prop(h,f[g])):"href"===a&&f.$set(g,null)})}}}});var Ib={$addControl:y,$$renameControl:function(a,c){a.$name=c},$removeControl:y,$setValidity:y,
$setDirty:y,$setPristine:y,$setSubmitted:y};Gd.$inject=["$element","$attrs","$scope","$animate","$interpolate"];var Od=function(a){return["$timeout","$parse",function(c,d){function e(a){return""===a?d('this[""]').assign:d(a).assign||y}return{name:"form",restrict:a?"EAC":"E",require:["form","^^?form"],controller:Gd,compile:function(d,h){d.addClass(Ya).addClass(mb);var g=h.name?"name":a&&h.ngForm?"ngForm":!1;return{pre:function(a,d,f,h){var m=h[0];if(!("action"in f)){var t=function(c){a.$apply(function(){m.$commitViewValue();
m.$setSubmitted()});c.preventDefault()};d[0].addEventListener("submit",t,!1);d.on("$destroy",function(){c(function(){d[0].removeEventListener("submit",t,!1)},0,!1)})}(h[1]||m.$$parentForm).$addControl(m);var s=g?e(m.$name):y;g&&(s(a,m),f.$observe(g,function(c){m.$name!==c&&(s(a,w),m.$$parentForm.$$renameControl(m,c),s=e(m.$name),s(a,m))}));d.on("$destroy",function(){m.$$parentForm.$removeControl(m);s(a,w);P(m,Ib)})}}}}}]},ie=Od(),ve=Od(!0),ig=/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/,
sg=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,tg=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,ug=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))([eE][+-]?\d+)?\s*$/,Pd=/^(\d{4})-(\d{2})-(\d{2})$/,Qd=/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,lc=/^(\d{4})-W(\d\d)$/,Rd=/^(\d{4})-(\d\d)$/,Sd=/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,Td={text:function(a,c,d,e,f,h){jb(a,c,d,e,f,h);jc(e)},date:kb("date",
Pd,Kb(Pd,["yyyy","MM","dd"]),"yyyy-MM-dd"),"datetime-local":kb("datetimelocal",Qd,Kb(Qd,"yyyy MM dd HH mm ss sss".split(" ")),"yyyy-MM-ddTHH:mm:ss.sss"),time:kb("time",Sd,Kb(Sd,["HH","mm","ss","sss"]),"HH:mm:ss.sss"),week:kb("week",lc,function(a,c){if(ea(a))return a;if(G(a)){lc.lastIndex=0;var d=lc.exec(a);if(d){var e=+d[1],f=+d[2],h=d=0,g=0,l=0,k=Ed(e),f=7*(f-1);c&&(d=c.getHours(),h=c.getMinutes(),g=c.getSeconds(),l=c.getMilliseconds());return new Date(e,0,k.getDate()+f,d,h,g,l)}}return NaN},"yyyy-Www"),
month:kb("month",Rd,Kb(Rd,["yyyy","MM"]),"yyyy-MM"),number:function(a,c,d,e,f,h){Id(a,c,d,e);jb(a,c,d,e,f,h);e.$$parserName="number";e.$parsers.push(function(a){return e.$isEmpty(a)?null:ug.test(a)?parseFloat(a):w});e.$formatters.push(function(a){if(!e.$isEmpty(a)){if(!V(a))throw lb("numfmt",a);a=a.toString()}return a});if(A(d.min)||d.ngMin){var g;e.$validators.min=function(a){return e.$isEmpty(a)||v(g)||a>=g};d.$observe("min",function(a){A(a)&&!V(a)&&(a=parseFloat(a,10));g=V(a)&&!isNaN(a)?a:w;e.$validate()})}if(A(d.max)||
d.ngMax){var l;e.$validators.max=function(a){return e.$isEmpty(a)||v(l)||a<=l};d.$observe("max",function(a){A(a)&&!V(a)&&(a=parseFloat(a,10));l=V(a)&&!isNaN(a)?a:w;e.$validate()})}},url:function(a,c,d,e,f,h){jb(a,c,d,e,f,h);jc(e);e.$$parserName="url";e.$validators.url=function(a,c){var d=a||c;return e.$isEmpty(d)||sg.test(d)}},email:function(a,c,d,e,f,h){jb(a,c,d,e,f,h);jc(e);e.$$parserName="email";e.$validators.email=function(a,c){var d=a||c;return e.$isEmpty(d)||tg.test(d)}},radio:function(a,c,
d,e){v(d.name)&&c.attr("name",++nb);c.on("click",function(a){c[0].checked&&e.$setViewValue(d.value,a&&a.type)});e.$render=function(){c[0].checked=d.value==e.$viewValue};d.$observe("value",e.$render)},checkbox:function(a,c,d,e,f,h,g,l){var k=Jd(l,a,"ngTrueValue",d.ngTrueValue,!0),n=Jd(l,a,"ngFalseValue",d.ngFalseValue,!1);c.on("click",function(a){e.$setViewValue(c[0].checked,a&&a.type)});e.$render=function(){c[0].checked=e.$viewValue};e.$isEmpty=function(a){return!1===a};e.$formatters.push(function(a){return ka(a,
k)});e.$parsers.push(function(a){return a?k:n})},hidden:y,button:y,submit:y,reset:y,file:y},Ec=["$browser","$sniffer","$filter","$parse",function(a,c,d,e){return{restrict:"E",require:["?ngModel"],link:{pre:function(f,h,g,l){l[0]&&(Td[F(g.type)]||Td.text)(f,h,g,l[0],c,a,d,e)}}}}],vg=/^(true|false|\d+)$/,Ne=function(){return{restrict:"A",priority:100,compile:function(a,c){return vg.test(c.ngValue)?function(a,c,f){f.$set("value",a.$eval(f.ngValue))}:function(a,c,f){a.$watch(f.ngValue,function(a){f.$set("value",
a)})}}}},ne=["$compile",function(a){return{restrict:"AC",compile:function(c){a.$$addBindingClass(c);return function(c,e,f){a.$$addBindingInfo(e,f.ngBind);e=e[0];c.$watch(f.ngBind,function(a){e.textContent=v(a)?"":a})}}}}],pe=["$interpolate","$compile",function(a,c){return{compile:function(d){c.$$addBindingClass(d);return function(d,f,h){d=a(f.attr(h.$attr.ngBindTemplate));c.$$addBindingInfo(f,d.expressions);f=f[0];h.$observe("ngBindTemplate",function(a){f.textContent=v(a)?"":a})}}}}],oe=["$sce","$parse",
"$compile",function(a,c,d){return{restrict:"A",compile:function(e,f){var h=c(f.ngBindHtml),g=c(f.ngBindHtml,function(a){return(a||"").toString()});d.$$addBindingClass(e);return function(c,e,f){d.$$addBindingInfo(e,f.ngBindHtml);c.$watch(g,function(){e.html(a.getTrustedHtml(h(c))||"")})}}}}],Me=qa({restrict:"A",require:"ngModel",link:function(a,c,d,e){e.$viewChangeListeners.push(function(){a.$eval(d.ngChange)})}}),qe=kc("",!0),se=kc("Odd",0),re=kc("Even",1),te=Na({compile:function(a,c){c.$set("ngCloak",
w);a.removeClass("ng-cloak")}}),ue=[function(){return{restrict:"A",scope:!0,controller:"@",priority:500}}],Jc={},wg={blur:!0,focus:!0};m("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(a){var c=ya("ng-"+a);Jc[c]=["$parse","$rootScope",function(d,e){return{restrict:"A",compile:function(f,h){var g=d(h[c],null,!0);return function(c,d){d.on(a,function(d){var f=function(){g(c,{$event:d})};
wg[a]&&e.$$phase?c.$evalAsync(f):c.$apply(f)})}}}}]});var xe=["$animate",function(a){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(c,d,e,f,h){var g,l,k;c.$watch(e.ngIf,function(c){c?l||h(function(c,f){l=f;c[c.length++]=X.createComment(" end ngIf: "+e.ngIf+" ");g={clone:c};a.enter(c,d.parent(),d)}):(k&&(k.remove(),k=null),l&&(l.$destroy(),l=null),g&&(k=rb(g.clone),a.leave(k).then(function(){k=null}),g=null))})}}}],ye=["$templateRequest","$anchorScroll",
"$animate",function(a,c,d){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:da.noop,compile:function(e,f){var h=f.ngInclude||f.src,g=f.onload||"",l=f.autoscroll;return function(e,f,m,r,t){var s=0,v,u,q,z=function(){u&&(u.remove(),u=null);v&&(v.$destroy(),v=null);q&&(d.leave(q).then(function(){u=null}),u=q,q=null)};e.$watch(h,function(h){var m=function(){!A(l)||l&&!e.$eval(l)||c()},p=++s;h?(a(h,!0).then(function(a){if(p===s){var c=e.$new();r.template=a;a=t(c,function(a){z();
d.enter(a,null,f).then(m)});v=c;q=a;v.$emit("$includeContentLoaded",h);e.$eval(g)}},function(){p===s&&(z(),e.$emit("$includeContentError",h))}),e.$emit("$includeContentRequested",h)):(z(),r.template=null)})}}}}],Pe=["$compile",function(a){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(c,d,e,f){/SVG/.test(d[0].toString())?(d.empty(),a(Mc(f.template,X).childNodes)(c,function(a){d.append(a)},{futureParentElement:d})):(d.html(f.template),a(d.contents())(c))}}}],ze=Na({priority:450,
compile:function(){return{pre:function(a,c,d){a.$eval(d.ngInit)}}}}),Le=function(){return{restrict:"A",priority:100,require:"ngModel",link:function(a,c,d,e){var f=c.attr(d.$attr.ngList)||", ",h="false"!==d.ngTrim,g=h?T(f):f;e.$parsers.push(function(a){if(!v(a)){var c=[];a&&m(a.split(g),function(a){a&&c.push(h?T(a):a)});return c}});e.$formatters.push(function(a){return J(a)?a.join(f):w});e.$isEmpty=function(a){return!a||!a.length}}}},mb="ng-valid",Kd="ng-invalid",Ya="ng-pristine",Jb="ng-dirty",Md=
"ng-pending",lb=I("ngModel"),xg=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate","$timeout","$rootScope","$q","$interpolate",function(a,c,d,e,f,h,g,l,k,n){this.$modelValue=this.$viewValue=Number.NaN;this.$$rawModelValue=w;this.$validators={};this.$asyncValidators={};this.$parsers=[];this.$formatters=[];this.$viewChangeListeners=[];this.$untouched=!0;this.$touched=!1;this.$pristine=!0;this.$dirty=!1;this.$valid=!0;this.$invalid=!1;this.$error={};this.$$success={};this.$pending=
w;this.$name=n(d.name||"",!1)(a);this.$$parentForm=Ib;var p=f(d.ngModel),r=p.assign,t=p,s=r,K=null,u,q=this;this.$$setOptions=function(a){if((q.$options=a)&&a.getterSetter){var c=f(d.ngModel+"()"),g=f(d.ngModel+"($$$p)");t=function(a){var d=p(a);x(d)&&(d=c(a));return d};s=function(a,c){x(p(a))?g(a,{$$$p:q.$modelValue}):r(a,q.$modelValue)}}else if(!p.assign)throw lb("nonassign",d.ngModel,xa(e));};this.$render=y;this.$isEmpty=function(a){return v(a)||""===a||null===a||a!==a};var z=0;Hd({ctrl:this,$element:e,
set:function(a,c){a[c]=!0},unset:function(a,c){delete a[c]},$animate:h});this.$setPristine=function(){q.$dirty=!1;q.$pristine=!0;h.removeClass(e,Jb);h.addClass(e,Ya)};this.$setDirty=function(){q.$dirty=!0;q.$pristine=!1;h.removeClass(e,Ya);h.addClass(e,Jb);q.$$parentForm.$setDirty()};this.$setUntouched=function(){q.$touched=!1;q.$untouched=!0;h.setClass(e,"ng-untouched","ng-touched")};this.$setTouched=function(){q.$touched=!0;q.$untouched=!1;h.setClass(e,"ng-touched","ng-untouched")};this.$rollbackViewValue=
function(){g.cancel(K);q.$viewValue=q.$$lastCommittedViewValue;q.$render()};this.$validate=function(){if(!V(q.$modelValue)||!isNaN(q.$modelValue)){var a=q.$$rawModelValue,c=q.$valid,d=q.$modelValue,e=q.$options&&q.$options.allowInvalid;q.$$runValidators(a,q.$$lastCommittedViewValue,function(f){e||c===f||(q.$modelValue=f?a:w,q.$modelValue!==d&&q.$$writeModelToScope())})}};this.$$runValidators=function(a,c,d){function e(){var d=!0;m(q.$validators,function(e,f){var h=e(a,c);d=d&&h;g(f,h)});return d?
!0:(m(q.$asyncValidators,function(a,c){g(c,null)}),!1)}function f(){var d=[],e=!0;m(q.$asyncValidators,function(f,h){var k=f(a,c);if(!k||!x(k.then))throw lb("$asyncValidators",k);g(h,w);d.push(k.then(function(){g(h,!0)},function(a){e=!1;g(h,!1)}))});d.length?k.all(d).then(function(){h(e)},y):h(!0)}function g(a,c){l===z&&q.$setValidity(a,c)}function h(a){l===z&&d(a)}z++;var l=z;(function(){var a=q.$$parserName||"parse";if(v(u))g(a,null);else return u||(m(q.$validators,function(a,c){g(c,null)}),m(q.$asyncValidators,
function(a,c){g(c,null)})),g(a,u),u;return!0})()?e()?f():h(!1):h(!1)};this.$commitViewValue=function(){var a=q.$viewValue;g.cancel(K);if(q.$$lastCommittedViewValue!==a||""===a&&q.$$hasNativeValidators)q.$$lastCommittedViewValue=a,q.$pristine&&this.$setDirty(),this.$$parseAndValidate()};this.$$parseAndValidate=function(){var c=q.$$lastCommittedViewValue;if(u=v(c)?w:!0)for(var d=0;d<q.$parsers.length;d++)if(c=q.$parsers[d](c),v(c)){u=!1;break}V(q.$modelValue)&&isNaN(q.$modelValue)&&(q.$modelValue=t(a));
var e=q.$modelValue,f=q.$options&&q.$options.allowInvalid;q.$$rawModelValue=c;f&&(q.$modelValue=c,q.$modelValue!==e&&q.$$writeModelToScope());q.$$runValidators(c,q.$$lastCommittedViewValue,function(a){f||(q.$modelValue=a?c:w,q.$modelValue!==e&&q.$$writeModelToScope())})};this.$$writeModelToScope=function(){s(a,q.$modelValue);m(q.$viewChangeListeners,function(a){try{a()}catch(d){c(d)}})};this.$setViewValue=function(a,c){q.$viewValue=a;q.$options&&!q.$options.updateOnDefault||q.$$debounceViewValueCommit(c)};
this.$$debounceViewValueCommit=function(c){var d=0,e=q.$options;e&&A(e.debounce)&&(e=e.debounce,V(e)?d=e:V(e[c])?d=e[c]:V(e["default"])&&(d=e["default"]));g.cancel(K);d?K=g(function(){q.$commitViewValue()},d):l.$$phase?q.$commitViewValue():a.$apply(function(){q.$commitViewValue()})};a.$watch(function(){var c=t(a);if(c!==q.$modelValue&&(q.$modelValue===q.$modelValue||c===c)){q.$modelValue=q.$$rawModelValue=c;u=w;for(var d=q.$formatters,e=d.length,f=c;e--;)f=d[e](f);q.$viewValue!==f&&(q.$viewValue=
q.$$lastCommittedViewValue=f,q.$render(),q.$$runValidators(c,f,y))}return c})}],Ke=["$rootScope",function(a){return{restrict:"A",require:["ngModel","^?form","^?ngModelOptions"],controller:xg,priority:1,compile:function(c){c.addClass(Ya).addClass("ng-untouched").addClass(mb);return{pre:function(a,c,f,h){var g=h[0];c=h[1]||g.$$parentForm;g.$$setOptions(h[2]&&h[2].$options);c.$addControl(g);f.$observe("name",function(a){g.$name!==a&&g.$$parentForm.$$renameControl(g,a)});a.$on("$destroy",function(){g.$$parentForm.$removeControl(g)})},
post:function(c,e,f,h){var g=h[0];if(g.$options&&g.$options.updateOn)e.on(g.$options.updateOn,function(a){g.$$debounceViewValueCommit(a&&a.type)});e.on("blur",function(e){g.$touched||(a.$$phase?c.$evalAsync(g.$setTouched):c.$apply(g.$setTouched))})}}}}}],yg=/(\s+|^)default(\s+|$)/,Oe=function(){return{restrict:"A",controller:["$scope","$attrs",function(a,c){var d=this;this.$options=ha(a.$eval(c.ngModelOptions));A(this.$options.updateOn)?(this.$options.updateOnDefault=!1,this.$options.updateOn=T(this.$options.updateOn.replace(yg,
function(){d.$options.updateOnDefault=!0;return" "}))):this.$options.updateOnDefault=!0}]}},Ae=Na({terminal:!0,priority:1E3}),zg=I("ngOptions"),Ag=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,Ie=["$compile","$parse",function(a,c){function d(a,d,e){function f(a,c,d,e,g){this.selectValue=a;this.viewValue=c;this.label=
d;this.group=e;this.disabled=g}function n(a){var c;if(!s&&Da(a))c=a;else{c=[];for(var d in a)a.hasOwnProperty(d)&&"$"!==d.charAt(0)&&c.push(d)}return c}var m=a.match(Ag);if(!m)throw zg("iexp",a,xa(d));var r=m[5]||m[7],s=m[6];a=/ as /.test(m[0])&&m[1];var v=m[9];d=c(m[2]?m[1]:r);var w=a&&c(a)||d,u=v&&c(v),q=v?function(a,c){return u(e,c)}:function(a){return Ga(a)},z=function(a,c){return q(a,x(a,c))},y=c(m[2]||m[1]),A=c(m[3]||""),O=c(m[4]||""),H=c(m[8]),B={},x=s?function(a,c){B[s]=c;B[r]=a;return B}:
function(a){B[r]=a;return B};return{trackBy:v,getTrackByValue:z,getWatchables:c(H,function(a){var c=[];a=a||[];for(var d=n(a),f=d.length,g=0;g<f;g++){var h=a===d?g:d[g],k=x(a[h],h),h=q(a[h],k);c.push(h);if(m[2]||m[1])h=y(e,k),c.push(h);m[4]&&(k=O(e,k),c.push(k))}return c}),getOptions:function(){for(var a=[],c={},d=H(e)||[],g=n(d),h=g.length,m=0;m<h;m++){var p=d===g?m:g[m],r=x(d[p],p),s=w(e,r),p=q(s,r),t=y(e,r),u=A(e,r),r=O(e,r),s=new f(p,s,t,u,r);a.push(s);c[p]=s}return{items:a,selectValueMap:c,getOptionFromViewValue:function(a){return c[z(a)]},
getViewValueFromOption:function(a){return v?da.copy(a.viewValue):a.viewValue}}}}}var e=X.createElement("option"),f=X.createElement("optgroup");return{restrict:"A",terminal:!0,require:["select","?ngModel"],link:function(c,g,l,k){function n(a,c){a.element=c;c.disabled=a.disabled;a.label!==c.label&&(c.label=a.label,c.textContent=a.label);a.value!==c.value&&(c.value=a.selectValue)}function p(a,c,d,e){c&&F(c.nodeName)===d?d=c:(d=e.cloneNode(!1),c?a.insertBefore(d,c):a.appendChild(d));return d}function r(a){for(var c;a;)c=
a.nextSibling,Wb(a),a=c}function s(a){var c=q&&q[0],d=H&&H[0];if(c||d)for(;a&&(a===c||a===d||c&&8===c.nodeType);)a=a.nextSibling;return a}function v(){var a=x&&u.readValue();x=C.getOptions();var c={},d=g[0].firstChild;O&&g.prepend(q);d=s(d);x.items.forEach(function(a){var h,k;a.group?(h=c[a.group],h||(h=p(g[0],d,"optgroup",f),d=h.nextSibling,h.label=a.group,h=c[a.group]={groupElement:h,currentOptionElement:h.firstChild}),k=p(h.groupElement,h.currentOptionElement,"option",e),n(a,k),h.currentOptionElement=
k.nextSibling):(k=p(g[0],d,"option",e),n(a,k),d=k.nextSibling)});Object.keys(c).forEach(function(a){r(c[a].currentOptionElement)});r(d);w.$render();if(!w.$isEmpty(a)){var h=u.readValue();(C.trackBy?ka(a,h):a===h)||(w.$setViewValue(h),w.$render())}}var w=k[1];if(w){var u=k[0];k=l.multiple;for(var q,z=0,y=g.children(),A=y.length;z<A;z++)if(""===y[z].value){q=y.eq(z);break}var O=!!q,H=B(e.cloneNode(!1));H.val("?");var x,C=d(l.ngOptions,g,c);k?(w.$isEmpty=function(a){return!a||0===a.length},u.writeValue=
function(a){x.items.forEach(function(a){a.element.selected=!1});a&&a.forEach(function(a){(a=x.getOptionFromViewValue(a))&&!a.disabled&&(a.element.selected=!0)})},u.readValue=function(){var a=g.val()||[],c=[];m(a,function(a){(a=x.selectValueMap[a])&&!a.disabled&&c.push(x.getViewValueFromOption(a))});return c},C.trackBy&&c.$watchCollection(function(){if(J(w.$viewValue))return w.$viewValue.map(function(a){return C.getTrackByValue(a)})},function(){w.$render()})):(u.writeValue=function(a){var c=x.getOptionFromViewValue(a);
c&&!c.disabled?g[0].value!==c.selectValue&&(H.remove(),O||q.remove(),g[0].value=c.selectValue,c.element.selected=!0,c.element.setAttribute("selected","selected")):null===a||O?(H.remove(),O||g.prepend(q),g.val(""),q.prop("selected",!0),q.attr("selected",!0)):(O||q.remove(),g.prepend(H),g.val("?"),H.prop("selected",!0),H.attr("selected",!0))},u.readValue=function(){var a=x.selectValueMap[g.val()];return a&&!a.disabled?(O||q.remove(),H.remove(),x.getViewValueFromOption(a)):null},C.trackBy&&c.$watch(function(){return C.getTrackByValue(w.$viewValue)},
function(){w.$render()}));O?(q.remove(),a(q)(c),q.removeClass("ng-scope")):q=B(e.cloneNode(!1));v();c.$watchCollection(C.getWatchables,v)}}}}],Be=["$locale","$interpolate","$log",function(a,c,d){var e=/{}/g,f=/^when(Minus)?(.+)$/;return{link:function(h,g,l){function k(a){g.text(a||"")}var n=l.count,p=l.$attr.when&&g.attr(l.$attr.when),r=l.offset||0,s=h.$eval(p)||{},w={},A=c.startSymbol(),u=c.endSymbol(),q=A+n+"-"+r+u,z=da.noop,x;m(l,function(a,c){var d=f.exec(c);d&&(d=(d[1]?"-":"")+F(d[2]),s[d]=g.attr(l.$attr[c]))});
m(s,function(a,d){w[d]=c(a.replace(e,q))});h.$watch(n,function(c){var e=parseFloat(c),f=isNaN(e);f||e in s||(e=a.pluralCat(e-r));e===x||f&&V(x)&&isNaN(x)||(z(),f=w[e],v(f)?(null!=c&&d.debug("ngPluralize: no rule defined for '"+e+"' in "+p),z=y,k()):z=h.$watch(f,k),x=e)})}}}],Ce=["$parse","$animate",function(a,c){var d=I("ngRepeat"),e=function(a,c,d,e,k,m,p){a[d]=e;k&&(a[k]=m);a.$index=c;a.$first=0===c;a.$last=c===p-1;a.$middle=!(a.$first||a.$last);a.$odd=!(a.$even=0===(c&1))};return{restrict:"A",
multiElement:!0,transclude:"element",priority:1E3,terminal:!0,$$tlb:!0,compile:function(f,h){var g=h.ngRepeat,l=X.createComment(" end ngRepeat: "+g+" "),k=g.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!k)throw d("iexp",g);var n=k[1],p=k[2],r=k[3],s=k[4],k=n.match(/^(?:(\s*[\$\w]+)|\(\s*([\$\w]+)\s*,\s*([\$\w]+)\s*\))$/);if(!k)throw d("iidexp",n);var v=k[3]||k[1],y=k[2];if(r&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(r)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent|\$root|\$id)$/.test(r)))throw d("badident",
r);var u,q,z,A,x={$id:Ga};s?u=a(s):(z=function(a,c){return Ga(c)},A=function(a){return a});return function(a,f,h,k,n){u&&(q=function(c,d,e){y&&(x[y]=c);x[v]=d;x.$index=e;return u(a,x)});var s=fa();a.$watchCollection(p,function(h){var k,p,t=f[0],u,x=fa(),C,G,J,M,I,F,L;r&&(a[r]=h);if(Da(h))I=h,p=q||z;else for(L in p=q||A,I=[],h)ta.call(h,L)&&"$"!==L.charAt(0)&&I.push(L);C=I.length;L=Array(C);for(k=0;k<C;k++)if(G=h===I?k:I[k],J=h[G],M=p(G,J,k),s[M])F=s[M],delete s[M],x[M]=F,L[k]=F;else{if(x[M])throw m(L,
function(a){a&&a.scope&&(s[a.id]=a)}),d("dupes",g,M,J);L[k]={id:M,scope:w,clone:w};x[M]=!0}for(u in s){F=s[u];M=rb(F.clone);c.leave(M);if(M[0].parentNode)for(k=0,p=M.length;k<p;k++)M[k].$$NG_REMOVED=!0;F.scope.$destroy()}for(k=0;k<C;k++)if(G=h===I?k:I[k],J=h[G],F=L[k],F.scope){u=t;do u=u.nextSibling;while(u&&u.$$NG_REMOVED);F.clone[0]!=u&&c.move(rb(F.clone),null,B(t));t=F.clone[F.clone.length-1];e(F.scope,k,v,J,y,G,C)}else n(function(a,d){F.scope=d;var f=l.cloneNode(!1);a[a.length++]=f;c.enter(a,
null,B(t));t=f;F.clone=a;x[F.id]=F;e(F.scope,k,v,J,y,G,C)});s=x})}}}}],De=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(c,d,e){c.$watch(e.ngShow,function(c){a[c?"removeClass":"addClass"](d,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],we=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(c,d,e){c.$watch(e.ngHide,function(c){a[c?"addClass":"removeClass"](d,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],Ee=Na(function(a,c,d){a.$watch(d.ngStyle,
function(a,d){d&&a!==d&&m(d,function(a,d){c.css(d,"")});a&&c.css(a)},!0)}),Fe=["$animate",function(a){return{require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(c,d,e,f){var h=[],g=[],l=[],k=[],n=function(a,c){return function(){a.splice(c,1)}};c.$watch(e.ngSwitch||e.on,function(c){var d,e;d=0;for(e=l.length;d<e;++d)a.cancel(l[d]);d=l.length=0;for(e=k.length;d<e;++d){var s=rb(g[d].clone);k[d].$destroy();(l[d]=a.leave(s)).then(n(l,d))}g.length=0;k.length=0;(h=f.cases["!"+
c]||f.cases["?"])&&m(h,function(c){c.transclude(function(d,e){k.push(e);var f=c.element;d[d.length++]=X.createComment(" end ngSwitchWhen: ");g.push({clone:d});a.enter(d,f.parent(),f)})})})}}}],Ge=Na({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,c,d,e,f){e.cases["!"+d.ngSwitchWhen]=e.cases["!"+d.ngSwitchWhen]||[];e.cases["!"+d.ngSwitchWhen].push({transclude:f,element:c})}}),He=Na({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,
c,d,e,f){e.cases["?"]=e.cases["?"]||[];e.cases["?"].push({transclude:f,element:c})}}),Je=Na({restrict:"EAC",link:function(a,c,d,e,f){if(!f)throw I("ngTransclude")("orphan",xa(c));f(function(a){c.empty();c.append(a)})}}),je=["$templateCache",function(a){return{restrict:"E",terminal:!0,compile:function(c,d){"text/ng-template"==d.type&&a.put(d.id,c[0].text)}}}],Bg={$setViewValue:y,$render:y},Cg=["$element","$scope","$attrs",function(a,c,d){var e=this,f=new Ua;e.ngModelCtrl=Bg;e.unknownOption=B(X.createElement("option"));
e.renderUnknownOption=function(c){c="? "+Ga(c)+" ?";e.unknownOption.val(c);a.prepend(e.unknownOption);a.val(c)};c.$on("$destroy",function(){e.renderUnknownOption=y});e.removeUnknownOption=function(){e.unknownOption.parent()&&e.unknownOption.remove()};e.readValue=function(){e.removeUnknownOption();return a.val()};e.writeValue=function(c){e.hasOption(c)?(e.removeUnknownOption(),a.val(c),""===c&&e.emptyOption.prop("selected",!0)):null==c&&e.emptyOption?(e.removeUnknownOption(),a.val("")):e.renderUnknownOption(c)};
e.addOption=function(a,c){Ta(a,'"option value"');""===a&&(e.emptyOption=c);var d=f.get(a)||0;f.put(a,d+1)};e.removeOption=function(a){var c=f.get(a);c&&(1===c?(f.remove(a),""===a&&(e.emptyOption=w)):f.put(a,c-1))};e.hasOption=function(a){return!!f.get(a)}}],ke=function(){return{restrict:"E",require:["select","?ngModel"],controller:Cg,link:function(a,c,d,e){var f=e[1];if(f){var h=e[0];h.ngModelCtrl=f;f.$render=function(){h.writeValue(f.$viewValue)};c.on("change",function(){a.$apply(function(){f.$setViewValue(h.readValue())})});
if(d.multiple){h.readValue=function(){var a=[];m(c.find("option"),function(c){c.selected&&a.push(c.value)});return a};h.writeValue=function(a){var d=new Ua(a);m(c.find("option"),function(a){a.selected=A(d.get(a.value))})};var g,l=NaN;a.$watch(function(){l!==f.$viewValue||ka(g,f.$viewValue)||(g=ja(f.$viewValue),f.$render());l=f.$viewValue});f.$isEmpty=function(a){return!a||0===a.length}}}}}},me=["$interpolate",function(a){return{restrict:"E",priority:100,compile:function(c,d){if(A(d.value))var e=a(d.value,
!0);else{var f=a(c.text(),!0);f||d.$set("value",c.text())}return function(a,c,d){function k(a){p.addOption(a,c);p.ngModelCtrl.$render();c[0].hasAttribute("selected")&&(c[0].selected=!0)}var m=c.parent(),p=m.data("$selectController")||m.parent().data("$selectController");if(p&&p.ngModelCtrl){if(e){var r;d.$observe("value",function(a){A(r)&&p.removeOption(r);r=a;k(a)})}else f?a.$watch(f,function(a,c){d.$set("value",a);c!==a&&p.removeOption(c);k(a)}):k(d.value);c.on("$destroy",function(){p.removeOption(d.value);
p.ngModelCtrl.$render()})}}}}}],le=qa({restrict:"E",terminal:!1}),Gc=function(){return{restrict:"A",require:"?ngModel",link:function(a,c,d,e){e&&(d.required=!0,e.$validators.required=function(a,c){return!d.required||!e.$isEmpty(c)},d.$observe("required",function(){e.$validate()}))}}},Fc=function(){return{restrict:"A",require:"?ngModel",link:function(a,c,d,e){if(e){var f,h=d.ngPattern||d.pattern;d.$observe("pattern",function(a){G(a)&&0<a.length&&(a=new RegExp("^"+a+"$"));if(a&&!a.test)throw I("ngPattern")("noregexp",
h,a,xa(c));f=a||w;e.$validate()});e.$validators.pattern=function(a,c){return e.$isEmpty(c)||v(f)||f.test(c)}}}}},Ic=function(){return{restrict:"A",require:"?ngModel",link:function(a,c,d,e){if(e){var f=-1;d.$observe("maxlength",function(a){a=Y(a);f=isNaN(a)?-1:a;e.$validate()});e.$validators.maxlength=function(a,c){return 0>f||e.$isEmpty(c)||c.length<=f}}}}},Hc=function(){return{restrict:"A",require:"?ngModel",link:function(a,c,d,e){if(e){var f=0;d.$observe("minlength",function(a){f=Y(a)||0;e.$validate()});
e.$validators.minlength=function(a,c){return e.$isEmpty(c)||c.length>=f}}}}};Q.angular.bootstrap?console.log("WARNING: Tried to load angular more than once."):(ce(),ee(da),da.module("ngLocale",[],["$provide",function(a){function c(a){a+="";var c=a.indexOf(".");return-1==c?0:a.length-c-1}a.value("$locale",{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ERANAMES:["Before Christ","Anno Domini"],ERAS:["BC","AD"],FIRSTDAYOFWEEK:6,MONTH:"January February March April May June July August September October November December".split(" "),
SHORTDAY:"Sun Mon Tue Wed Thu Fri Sat".split(" "),SHORTMONTH:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),WEEKENDRANGE:[5,6],fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",medium:"MMM d, y h:mm:ss a",mediumDate:"MMM d, y",mediumTime:"h:mm:ss a","short":"M/d/yy h:mm a",shortDate:"M/d/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,
maxFrac:2,minFrac:2,minInt:1,negPre:"-\u00a4",negSuf:"",posPre:"\u00a4",posSuf:""}]},id:"en-us",pluralCat:function(a,e){var f=a|0,h=e;w===h&&(h=Math.min(c(a),3));Math.pow(10,h);return 1==f&&0==h?"one":"other"}})}]),B(X).ready(function(){Zd(X,zc)}))})(window,document);!window.angular.$$csp().noInlineStyle&&window.angular.element(document.head).prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}</style>');
//# sourceMappingURL=angular.min.js.map

/**
 * angular-strap
 * @version v2.3.5 - 2015-10-29
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes <olivier@mg-crea.com> (https://github.com/mgcrea)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(window, document, undefined) {
  'use strict';
  angular.module('mgcrea.ngStrap.typeahead', [ 'mgcrea.ngStrap.tooltip', 'mgcrea.ngStrap.helpers.parseOptions' ]).provider('$typeahead', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      prefixClass: 'typeahead',
      prefixEvent: '$typeahead',
      placement: 'bottom-left',
      templateUrl: 'typeahead/typeahead.tpl.html',
      trigger: 'focus',
      container: false,
      keyboard: true,
      html: false,
      delay: 0,
      minLength: 1,
      filter: 'bsAsyncFilter',
      limit: 6,
      autoSelect: false,
      comparator: '',
      trimValue: true
    };
    this.$get = [ '$window', '$rootScope', '$tooltip', '$$rAF', '$timeout', function($window, $rootScope, $tooltip, $$rAF, $timeout) {
      var bodyEl = angular.element($window.document.body);
      function TypeaheadFactory(element, controller, config) {
        var $typeahead = {};
        var options = angular.extend({}, defaults, config);
        $typeahead = $tooltip(element, options);
        var parentScope = config.scope;
        var scope = $typeahead.$scope;
        scope.$resetMatches = function() {
          scope.$matches = [];
          scope.$activeIndex = options.autoSelect ? 0 : -1;
        };
        scope.$resetMatches();
        scope.$activate = function(index) {
          scope.$$postDigest(function() {
            $typeahead.activate(index);
          });
        };
        scope.$select = function(index, evt) {
          scope.$$postDigest(function() {
            $typeahead.select(index);
          });
        };
        scope.$isVisible = function() {
          return $typeahead.$isVisible();
        };
        $typeahead.update = function(matches) {
          scope.$matches = matches;
          if (scope.$activeIndex >= matches.length) {
            scope.$activeIndex = options.autoSelect ? 0 : -1;
          }
          safeDigest(scope);
          $$rAF($typeahead.$applyPlacement);
        };
        $typeahead.activate = function(index) {
          scope.$activeIndex = index;
        };
        $typeahead.select = function(index) {
          if (index === -1) return;
          var value = scope.$matches[index].value;
          controller.$setViewValue(value);
          controller.$render();
          scope.$resetMatches();
          if (parentScope) parentScope.$digest();
          scope.$emit(options.prefixEvent + '.select', value, index, $typeahead);
        };
        $typeahead.$isVisible = function() {
          if (!options.minLength || !controller) {
            return !!scope.$matches.length;
          }
          return scope.$matches.length && angular.isString(controller.$viewValue) && controller.$viewValue.length >= options.minLength;
        };
        $typeahead.$getIndex = function(value) {
          var l = scope.$matches.length, i = l;
          if (!l) return;
          for (i = l; i--; ) {
            if (scope.$matches[i].value === value) break;
          }
          if (i < 0) return;
          return i;
        };
        $typeahead.$onMouseDown = function(evt) {
          evt.preventDefault();
          evt.stopPropagation();
        };
        $typeahead.$onKeyDown = function(evt) {
          if (!/(38|40|13)/.test(evt.keyCode)) return;
          if ($typeahead.$isVisible() && !(evt.keyCode === 13 && scope.$activeIndex === -1)) {
            evt.preventDefault();
            evt.stopPropagation();
          }
          if (evt.keyCode === 13 && scope.$matches.length) {
            $typeahead.select(scope.$activeIndex);
          } else if (evt.keyCode === 38 && scope.$activeIndex > 0) scope.$activeIndex--; else if (evt.keyCode === 40 && scope.$activeIndex < scope.$matches.length - 1) scope.$activeIndex++; else if (angular.isUndefined(scope.$activeIndex)) scope.$activeIndex = 0;
          scope.$digest();
        };
        var show = $typeahead.show;
        $typeahead.show = function() {
          show();
          $timeout(function() {
            $typeahead.$element && $typeahead.$element.on('mousedown', $typeahead.$onMouseDown);
            if (options.keyboard) {
              element && element.on('keydown', $typeahead.$onKeyDown);
            }
          }, 0, false);
        };
        var hide = $typeahead.hide;
        $typeahead.hide = function() {
          $typeahead.$element && $typeahead.$element.off('mousedown', $typeahead.$onMouseDown);
          if (options.keyboard) {
            element && element.off('keydown', $typeahead.$onKeyDown);
          }
          if (!options.autoSelect) $typeahead.activate(-1);
          hide();
        };
        return $typeahead;
      }
      function safeDigest(scope) {
        scope.$$phase || scope.$root && scope.$root.$$phase || scope.$digest();
      }
      TypeaheadFactory.defaults = defaults;
      return TypeaheadFactory;
    } ];
  }).filter('bsAsyncFilter', [ '$filter', function($filter) {
    return function(array, expression, comparator) {
      if (array && angular.isFunction(array.then)) {
        return array.then(function(results) {
          return $filter('filter')(results, expression, comparator);
        });
      } else {
        return $filter('filter')(array, expression, comparator);
      }
    };
  } ]).directive('bsTypeahead', [ '$window', '$parse', '$q', '$typeahead', '$parseOptions', function($window, $parse, $q, $typeahead, $parseOptions) {
    var defaults = $typeahead.defaults;
    return {
      restrict: 'EAC',
      require: 'ngModel',
      link: function postLink(scope, element, attr, controller) {
        var options = {
          scope: scope
        };
        angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'placement', 'container', 'delay', 'trigger', 'keyboard', 'html', 'animation', 'filter', 'limit', 'minLength', 'watchOptions', 'selectMode', 'autoSelect', 'comparator', 'id', 'prefixEvent', 'prefixClass' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var falseValueRegExp = /^(false|0|)$/i;
        angular.forEach([ 'html', 'container', 'trimValue' ], function(key) {
          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;
        });
        if (!element.attr('autocomplete')) element.attr('autocomplete', 'off');
        var filter = options.filter || defaults.filter;
        var limit = options.limit || defaults.limit;
        var comparator = options.comparator || defaults.comparator;
        var bsOptions = attr.bsOptions;
        if (filter) bsOptions += ' | ' + filter + ':$viewValue';
        if (comparator) bsOptions += ':' + comparator;
        if (limit) bsOptions += ' | limitTo:' + limit;
        var parsedOptions = $parseOptions(bsOptions);
        var typeahead = $typeahead(element, controller, options);
        if (options.watchOptions) {
          var watchedOptions = parsedOptions.$match[7].replace(/\|.+/, '').replace(/\(.*\)/g, '').trim();
          scope.$watchCollection(watchedOptions, function(newValue, oldValue) {
            parsedOptions.valuesFn(scope, controller).then(function(values) {
              typeahead.update(values);
              controller.$render();
            });
          });
        }
        scope.$watch(attr.ngModel, function(newValue, oldValue) {
          scope.$modelValue = newValue;
          parsedOptions.valuesFn(scope, controller).then(function(values) {
            if (options.selectMode && !values.length && newValue.length > 0) {
              controller.$setViewValue(controller.$viewValue.substring(0, controller.$viewValue.length - 1));
              return;
            }
            if (values.length > limit) values = values.slice(0, limit);
            typeahead.update(values);
            controller.$render();
          });
        });
        controller.$formatters.push(function(modelValue) {
          var displayValue = parsedOptions.displayValue(modelValue);
          if (displayValue) {
            return displayValue;
          }
          if (modelValue && typeof modelValue !== 'object') {
            return modelValue;
          }
          return '';
        });
        controller.$render = function() {
          if (controller.$isEmpty(controller.$viewValue)) {
            return element.val('');
          }
          var index = typeahead.$getIndex(controller.$modelValue);
          var selected = angular.isDefined(index) ? typeahead.$scope.$matches[index].label : controller.$viewValue;
          selected = angular.isObject(selected) ? parsedOptions.displayValue(selected) : selected;
          var value = selected ? selected.toString().replace(/<(?:.|\n)*?>/gm, '') : '';
          element.val(options.trimValue === false ? value : value.trim());
        };
        scope.$on('$destroy', function() {
          if (typeahead) typeahead.destroy();
          options = null;
          typeahead = null;
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.tooltip', [ 'mgcrea.ngStrap.core', 'mgcrea.ngStrap.helpers.dimensions' ]).provider('$tooltip', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      customClass: '',
      prefixClass: 'tooltip',
      prefixEvent: 'tooltip',
      container: false,
      target: false,
      placement: 'top',
      templateUrl: 'tooltip/tooltip.tpl.html',
      template: '',
      contentTemplate: false,
      trigger: 'hover focus',
      keyboard: false,
      html: false,
      show: false,
      title: '',
      type: '',
      delay: 0,
      autoClose: false,
      bsEnabled: true,
      viewport: {
        selector: 'body',
        padding: 0
      }
    };
    this.$get = [ '$window', '$rootScope', '$bsCompiler', '$q', '$templateCache', '$http', '$animate', '$sce', 'dimensions', '$$rAF', '$timeout', function($window, $rootScope, $bsCompiler, $q, $templateCache, $http, $animate, $sce, dimensions, $$rAF, $timeout) {
      var trim = String.prototype.trim;
      var isTouch = 'createTouch' in $window.document;
      var htmlReplaceRegExp = /ng-bind="/gi;
      var $body = angular.element($window.document);
      function TooltipFactory(element, config) {
        var $tooltip = {};
        var options = $tooltip.$options = angular.extend({}, defaults, config);
        var promise = $tooltip.$promise = $bsCompiler.compile(options);
        var scope = $tooltip.$scope = options.scope && options.scope.$new() || $rootScope.$new();
        var nodeName = element[0].nodeName.toLowerCase();
        if (options.delay && angular.isString(options.delay)) {
          var split = options.delay.split(',').map(parseFloat);
          options.delay = split.length > 1 ? {
            show: split[0],
            hide: split[1]
          } : split[0];
        }
        $tooltip.$id = options.id || element.attr('id') || '';
        if (options.title) {
          scope.title = $sce.trustAsHtml(options.title);
        }
        scope.$setEnabled = function(isEnabled) {
          scope.$$postDigest(function() {
            $tooltip.setEnabled(isEnabled);
          });
        };
        scope.$hide = function() {
          scope.$$postDigest(function() {
            $tooltip.hide();
          });
        };
        scope.$show = function() {
          scope.$$postDigest(function() {
            $tooltip.show();
          });
        };
        scope.$toggle = function() {
          scope.$$postDigest(function() {
            $tooltip.toggle();
          });
        };
        $tooltip.$isShown = scope.$isShown = false;
        var timeout, hoverState;
        var compileData, tipElement, tipContainer, tipScope;
        promise.then(function(data) {
          compileData = data;
          $tooltip.init();
        });
        $tooltip.init = function() {
          if (options.delay && angular.isNumber(options.delay)) {
            options.delay = {
              show: options.delay,
              hide: options.delay
            };
          }
          if (options.container === 'self') {
            tipContainer = element;
          } else if (angular.isElement(options.container)) {
            tipContainer = options.container;
          } else if (options.container) {
            tipContainer = findElement(options.container);
          }
          bindTriggerEvents();
          if (options.target) {
            options.target = angular.isElement(options.target) ? options.target : findElement(options.target);
          }
          if (options.show) {
            scope.$$postDigest(function() {
              options.trigger === 'focus' ? element[0].focus() : $tooltip.show();
            });
          }
        };
        $tooltip.destroy = function() {
          unbindTriggerEvents();
          destroyTipElement();
          scope.$destroy();
        };
        $tooltip.enter = function() {
          clearTimeout(timeout);
          hoverState = 'in';
          if (!options.delay || !options.delay.show) {
            return $tooltip.show();
          }
          timeout = setTimeout(function() {
            if (hoverState === 'in') $tooltip.show();
          }, options.delay.show);
        };
        $tooltip.show = function() {
          if (!options.bsEnabled || $tooltip.$isShown) return;
          scope.$emit(options.prefixEvent + '.show.before', $tooltip);
          var parent, after;
          if (options.container) {
            parent = tipContainer;
            if (tipContainer[0].lastChild) {
              after = angular.element(tipContainer[0].lastChild);
            } else {
              after = null;
            }
          } else {
            parent = null;
            after = element;
          }
          if (tipElement) destroyTipElement();
          tipScope = $tooltip.$scope.$new();
          tipElement = $tooltip.$element = compileData.link(tipScope, function(clonedElement, scope) {});
          tipElement.css({
            top: '-9999px',
            left: '-9999px',
            right: 'auto',
            display: 'block',
            visibility: 'hidden'
          });
          if (options.animation) tipElement.addClass(options.animation);
          if (options.type) tipElement.addClass(options.prefixClass + '-' + options.type);
          if (options.customClass) tipElement.addClass(options.customClass);
          after ? after.after(tipElement) : parent.prepend(tipElement);
          $tooltip.$isShown = scope.$isShown = true;
          safeDigest(scope);
          $tooltip.$applyPlacement();
          if (angular.version.minor <= 2) {
            $animate.enter(tipElement, parent, after, enterAnimateCallback);
          } else {
            $animate.enter(tipElement, parent, after).then(enterAnimateCallback);
          }
          safeDigest(scope);
          $$rAF(function() {
            if (tipElement) tipElement.css({
              visibility: 'visible'
            });
            if (options.keyboard) {
              if (options.trigger !== 'focus') {
                $tooltip.focus();
              }
              bindKeyboardEvents();
            }
          });
          if (options.autoClose) {
            bindAutoCloseEvents();
          }
        };
        function enterAnimateCallback() {
          scope.$emit(options.prefixEvent + '.show', $tooltip);
        }
        $tooltip.leave = function() {
          clearTimeout(timeout);
          hoverState = 'out';
          if (!options.delay || !options.delay.hide) {
            return $tooltip.hide();
          }
          timeout = setTimeout(function() {
            if (hoverState === 'out') {
              $tooltip.hide();
            }
          }, options.delay.hide);
        };
        var _blur;
        var _tipToHide;
        $tooltip.hide = function(blur) {
          if (!$tooltip.$isShown) return;
          scope.$emit(options.prefixEvent + '.hide.before', $tooltip);
          _blur = blur;
          _tipToHide = tipElement;
          if (angular.version.minor <= 2) {
            $animate.leave(tipElement, leaveAnimateCallback);
          } else {
            $animate.leave(tipElement).then(leaveAnimateCallback);
          }
          $tooltip.$isShown = scope.$isShown = false;
          safeDigest(scope);
          if (options.keyboard && tipElement !== null) {
            unbindKeyboardEvents();
          }
          if (options.autoClose && tipElement !== null) {
            unbindAutoCloseEvents();
          }
        };
        function leaveAnimateCallback() {
          scope.$emit(options.prefixEvent + '.hide', $tooltip);
          if (tipElement === _tipToHide) {
            if (_blur && options.trigger === 'focus') {
              return element[0].blur();
            }
            destroyTipElement();
          }
        }
        $tooltip.toggle = function() {
          $tooltip.$isShown ? $tooltip.leave() : $tooltip.enter();
        };
        $tooltip.focus = function() {
          tipElement[0].focus();
        };
        $tooltip.setEnabled = function(isEnabled) {
          options.bsEnabled = isEnabled;
        };
        $tooltip.setViewport = function(viewport) {
          options.viewport = viewport;
        };
        $tooltip.$applyPlacement = function() {
          if (!tipElement) return;
          var placement = options.placement, autoToken = /\s?auto?\s?/i, autoPlace = autoToken.test(placement);
          if (autoPlace) {
            placement = placement.replace(autoToken, '') || defaults.placement;
          }
          tipElement.addClass(options.placement);
          var elementPosition = getPosition(), tipWidth = tipElement.prop('offsetWidth'), tipHeight = tipElement.prop('offsetHeight');
          $tooltip.$viewport = options.viewport && findElement(options.viewport.selector || options.viewport);
          if (autoPlace) {
            var originalPlacement = placement;
            var viewportPosition = getPosition($tooltip.$viewport);
            if (originalPlacement.indexOf('bottom') >= 0 && elementPosition.bottom + tipHeight > viewportPosition.bottom) {
              placement = originalPlacement.replace('bottom', 'top');
            } else if (originalPlacement.indexOf('top') >= 0 && elementPosition.top - tipHeight < viewportPosition.top) {
              placement = originalPlacement.replace('top', 'bottom');
            }
            if ((originalPlacement === 'right' || originalPlacement === 'bottom-left' || originalPlacement === 'top-left') && elementPosition.right + tipWidth > viewportPosition.width) {
              placement = originalPlacement === 'right' ? 'left' : placement.replace('left', 'right');
            } else if ((originalPlacement === 'left' || originalPlacement === 'bottom-right' || originalPlacement === 'top-right') && elementPosition.left - tipWidth < viewportPosition.left) {
              placement = originalPlacement === 'left' ? 'right' : placement.replace('right', 'left');
            }
            tipElement.removeClass(originalPlacement).addClass(placement);
          }
          var tipPosition = getCalculatedOffset(placement, elementPosition, tipWidth, tipHeight);
          applyPlacement(tipPosition, placement);
        };
        $tooltip.$onKeyUp = function(evt) {
          if (evt.which === 27 && $tooltip.$isShown) {
            $tooltip.hide();
            evt.stopPropagation();
          }
        };
        $tooltip.$onFocusKeyUp = function(evt) {
          if (evt.which === 27) {
            element[0].blur();
            evt.stopPropagation();
          }
        };
        $tooltip.$onFocusElementMouseDown = function(evt) {
          evt.preventDefault();
          evt.stopPropagation();
          $tooltip.$isShown ? element[0].blur() : element[0].focus();
        };
        function bindTriggerEvents() {
          var triggers = options.trigger.split(' ');
          angular.forEach(triggers, function(trigger) {
            if (trigger === 'click') {
              element.on('click', $tooltip.toggle);
            } else if (trigger !== 'manual') {
              element.on(trigger === 'hover' ? 'mouseenter' : 'focus', $tooltip.enter);
              element.on(trigger === 'hover' ? 'mouseleave' : 'blur', $tooltip.leave);
              nodeName === 'button' && trigger !== 'hover' && element.on(isTouch ? 'touchstart' : 'mousedown', $tooltip.$onFocusElementMouseDown);
            }
          });
        }
        function unbindTriggerEvents() {
          var triggers = options.trigger.split(' ');
          for (var i = triggers.length; i--; ) {
            var trigger = triggers[i];
            if (trigger === 'click') {
              element.off('click', $tooltip.toggle);
            } else if (trigger !== 'manual') {
              element.off(trigger === 'hover' ? 'mouseenter' : 'focus', $tooltip.enter);
              element.off(trigger === 'hover' ? 'mouseleave' : 'blur', $tooltip.leave);
              nodeName === 'button' && trigger !== 'hover' && element.off(isTouch ? 'touchstart' : 'mousedown', $tooltip.$onFocusElementMouseDown);
            }
          }
        }
        function bindKeyboardEvents() {
          if (options.trigger !== 'focus') {
            tipElement.on('keyup', $tooltip.$onKeyUp);
          } else {
            element.on('keyup', $tooltip.$onFocusKeyUp);
          }
        }
        function unbindKeyboardEvents() {
          if (options.trigger !== 'focus') {
            tipElement.off('keyup', $tooltip.$onKeyUp);
          } else {
            element.off('keyup', $tooltip.$onFocusKeyUp);
          }
        }
        var _autoCloseEventsBinded = false;
        function bindAutoCloseEvents() {
          $timeout(function() {
            tipElement.on('click', stopEventPropagation);
            $body.on('click', $tooltip.hide);
            _autoCloseEventsBinded = true;
          }, 0, false);
        }
        function unbindAutoCloseEvents() {
          if (_autoCloseEventsBinded) {
            tipElement.off('click', stopEventPropagation);
            $body.off('click', $tooltip.hide);
            _autoCloseEventsBinded = false;
          }
        }
        function stopEventPropagation(event) {
          event.stopPropagation();
        }
        function getPosition($element) {
          $element = $element || (options.target || element);
          var el = $element[0], isBody = el.tagName === 'BODY';
          var elRect = el.getBoundingClientRect();
          var rect = {};
          for (var p in elRect) {
            rect[p] = elRect[p];
          }
          if (rect.width === null) {
            rect = angular.extend({}, rect, {
              width: elRect.right - elRect.left,
              height: elRect.bottom - elRect.top
            });
          }
          var elOffset = isBody ? {
            top: 0,
            left: 0
          } : dimensions.offset(el), scroll = {
            scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.prop('scrollTop') || 0
          }, outerDims = isBody ? {
            width: document.documentElement.clientWidth,
            height: $window.innerHeight
          } : null;
          return angular.extend({}, rect, scroll, outerDims, elOffset);
        }
        function getCalculatedOffset(placement, position, actualWidth, actualHeight) {
          var offset;
          var split = placement.split('-');
          switch (split[0]) {
           case 'right':
            offset = {
              top: position.top + position.height / 2 - actualHeight / 2,
              left: position.left + position.width
            };
            break;

           case 'bottom':
            offset = {
              top: position.top + position.height,
              left: position.left + position.width / 2 - actualWidth / 2
            };
            break;

           case 'left':
            offset = {
              top: position.top + position.height / 2 - actualHeight / 2,
              left: position.left - actualWidth
            };
            break;

           default:
            offset = {
              top: position.top - actualHeight,
              left: position.left + position.width / 2 - actualWidth / 2
            };
            break;
          }
          if (!split[1]) {
            return offset;
          }
          if (split[0] === 'top' || split[0] === 'bottom') {
            switch (split[1]) {
             case 'left':
              offset.left = position.left;
              break;

             case 'right':
              offset.left = position.left + position.width - actualWidth;
            }
          } else if (split[0] === 'left' || split[0] === 'right') {
            switch (split[1]) {
             case 'top':
              offset.top = position.top - actualHeight;
              break;

             case 'bottom':
              offset.top = position.top + position.height;
            }
          }
          return offset;
        }
        function applyPlacement(offset, placement) {
          var tip = tipElement[0], width = tip.offsetWidth, height = tip.offsetHeight;
          var marginTop = parseInt(dimensions.css(tip, 'margin-top'), 10), marginLeft = parseInt(dimensions.css(tip, 'margin-left'), 10);
          if (isNaN(marginTop)) marginTop = 0;
          if (isNaN(marginLeft)) marginLeft = 0;
          offset.top = offset.top + marginTop;
          offset.left = offset.left + marginLeft;
          dimensions.setOffset(tip, angular.extend({
            using: function(props) {
              tipElement.css({
                top: Math.round(props.top) + 'px',
                left: Math.round(props.left) + 'px',
                right: ''
              });
            }
          }, offset), 0);
          var actualWidth = tip.offsetWidth, actualHeight = tip.offsetHeight;
          if (placement === 'top' && actualHeight !== height) {
            offset.top = offset.top + height - actualHeight;
          }
          if (/top-left|top-right|bottom-left|bottom-right/.test(placement)) return;
          var delta = getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight);
          if (delta.left) {
            offset.left += delta.left;
          } else {
            offset.top += delta.top;
          }
          dimensions.setOffset(tip, offset);
          if (/top|right|bottom|left/.test(placement)) {
            var isVertical = /top|bottom/.test(placement), arrowDelta = isVertical ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight, arrowOffsetPosition = isVertical ? 'offsetWidth' : 'offsetHeight';
            replaceArrow(arrowDelta, tip[arrowOffsetPosition], isVertical);
          }
        }
        function getViewportAdjustedDelta(placement, position, actualWidth, actualHeight) {
          var delta = {
            top: 0,
            left: 0
          };
          if (!$tooltip.$viewport) return delta;
          var viewportPadding = options.viewport && options.viewport.padding || 0;
          var viewportDimensions = getPosition($tooltip.$viewport);
          if (/right|left/.test(placement)) {
            var topEdgeOffset = position.top - viewportPadding - viewportDimensions.scroll;
            var bottomEdgeOffset = position.top + viewportPadding - viewportDimensions.scroll + actualHeight;
            if (topEdgeOffset < viewportDimensions.top) {
              delta.top = viewportDimensions.top - topEdgeOffset;
            } else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) {
              delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset;
            }
          } else {
            var leftEdgeOffset = position.left - viewportPadding;
            var rightEdgeOffset = position.left + viewportPadding + actualWidth;
            if (leftEdgeOffset < viewportDimensions.left) {
              delta.left = viewportDimensions.left - leftEdgeOffset;
            } else if (rightEdgeOffset > viewportDimensions.right) {
              delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset;
            }
          }
          return delta;
        }
        function replaceArrow(delta, dimension, isHorizontal) {
          var $arrow = findElement('.tooltip-arrow, .arrow', tipElement[0]);
          $arrow.css(isHorizontal ? 'left' : 'top', 50 * (1 - delta / dimension) + '%').css(isHorizontal ? 'top' : 'left', '');
        }
        function destroyTipElement() {
          clearTimeout(timeout);
          if ($tooltip.$isShown && tipElement !== null) {
            if (options.autoClose) {
              unbindAutoCloseEvents();
            }
            if (options.keyboard) {
              unbindKeyboardEvents();
            }
          }
          if (tipScope) {
            tipScope.$destroy();
            tipScope = null;
          }
          if (tipElement) {
            tipElement.remove();
            tipElement = $tooltip.$element = null;
          }
        }
        return $tooltip;
      }
      function safeDigest(scope) {
        scope.$$phase || scope.$root && scope.$root.$$phase || scope.$digest();
      }
      function findElement(query, element) {
        return angular.element((element || document).querySelectorAll(query));
      }
      var fetchPromises = {};
      function fetchTemplate(template) {
        if (fetchPromises[template]) return fetchPromises[template];
        return fetchPromises[template] = $http.get(template, {
          cache: $templateCache
        }).then(function(res) {
          return res.data;
        });
      }
      return TooltipFactory;
    } ];
  }).directive('bsTooltip', [ '$window', '$location', '$sce', '$tooltip', '$$rAF', function($window, $location, $sce, $tooltip, $$rAF) {
    return {
      restrict: 'EAC',
      scope: true,
      link: function postLink(scope, element, attr, transclusion) {
        var options = {
          scope: scope
        };
        angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'contentTemplate', 'placement', 'container', 'delay', 'trigger', 'html', 'animation', 'backdropAnimation', 'type', 'customClass', 'id' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var falseValueRegExp = /^(false|0|)$/i;
        angular.forEach([ 'html', 'container' ], function(key) {
          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;
        });
        var dataTarget = element.attr('data-target');
        if (angular.isDefined(dataTarget)) {
          if (falseValueRegExp.test(dataTarget)) options.target = false; else options.target = dataTarget;
        }
        if (!scope.hasOwnProperty('title')) {
          scope.title = '';
        }
        attr.$observe('title', function(newValue) {
          if (angular.isDefined(newValue) || !scope.hasOwnProperty('title')) {
            var oldValue = scope.title;
            scope.title = $sce.trustAsHtml(newValue);
            angular.isDefined(oldValue) && $$rAF(function() {
              tooltip && tooltip.$applyPlacement();
            });
          }
        });
        attr.bsTooltip && scope.$watch(attr.bsTooltip, function(newValue, oldValue) {
          if (angular.isObject(newValue)) {
            angular.extend(scope, newValue);
          } else {
            scope.title = newValue;
          }
          angular.isDefined(oldValue) && $$rAF(function() {
            tooltip && tooltip.$applyPlacement();
          });
        }, true);
        attr.bsShow && scope.$watch(attr.bsShow, function(newValue, oldValue) {
          if (!tooltip || !angular.isDefined(newValue)) return;
          if (angular.isString(newValue)) newValue = !!newValue.match(/true|,?(tooltip),?/i);
          newValue === true ? tooltip.show() : tooltip.hide();
        });
        attr.bsEnabled && scope.$watch(attr.bsEnabled, function(newValue, oldValue) {
          if (!tooltip || !angular.isDefined(newValue)) return;
          if (angular.isString(newValue)) newValue = !!newValue.match(/true|1|,?(tooltip),?/i);
          newValue === false ? tooltip.setEnabled(false) : tooltip.setEnabled(true);
        });
        attr.viewport && scope.$watch(attr.viewport, function(newValue) {
          if (!tooltip || !angular.isDefined(newValue)) return;
          tooltip.setViewport(newValue);
        });
        var tooltip = $tooltip(element, options);
        scope.$on('$destroy', function() {
          if (tooltip) tooltip.destroy();
          options = null;
          tooltip = null;
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.timepicker', [ 'mgcrea.ngStrap.helpers.dateParser', 'mgcrea.ngStrap.helpers.dateFormatter', 'mgcrea.ngStrap.tooltip' ]).provider('$timepicker', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      prefixClass: 'timepicker',
      placement: 'bottom-left',
      templateUrl: 'timepicker/timepicker.tpl.html',
      trigger: 'focus',
      container: false,
      keyboard: true,
      html: false,
      delay: 0,
      useNative: true,
      timeType: 'date',
      timeFormat: 'shortTime',
      timezone: null,
      modelTimeFormat: null,
      autoclose: false,
      minTime: -Infinity,
      maxTime: +Infinity,
      length: 5,
      hourStep: 1,
      minuteStep: 5,
      secondStep: 5,
      roundDisplay: false,
      iconUp: 'glyphicon glyphicon-chevron-up',
      iconDown: 'glyphicon glyphicon-chevron-down',
      arrowBehavior: 'pager'
    };
    this.$get = [ '$window', '$document', '$rootScope', '$sce', '$dateFormatter', '$tooltip', '$timeout', function($window, $document, $rootScope, $sce, $dateFormatter, $tooltip, $timeout) {
      var isNative = /(ip(a|o)d|iphone|android)/gi.test($window.navigator.userAgent);
      var isTouch = 'createTouch' in $window.document && isNative;
      if (!defaults.lang) {
        defaults.lang = $dateFormatter.getDefaultLocale();
      }
      function timepickerFactory(element, controller, config) {
        var $timepicker = $tooltip(element, angular.extend({}, defaults, config));
        var parentScope = config.scope;
        var options = $timepicker.$options;
        var scope = $timepicker.$scope;
        var lang = options.lang;
        var formatDate = function(date, format, timezone) {
          return $dateFormatter.formatDate(date, format, lang, timezone);
        };
        function floorMinutes(time) {
          var coeff = 1e3 * 60 * options.minuteStep;
          return new Date(Math.floor(time.getTime() / coeff) * coeff);
        }
        var selectedIndex = 0;
        var defaultDate = options.roundDisplay ? floorMinutes(new Date()) : new Date();
        var startDate = controller.$dateValue || defaultDate;
        var viewDate = {
          hour: startDate.getHours(),
          meridian: startDate.getHours() < 12,
          minute: startDate.getMinutes(),
          second: startDate.getSeconds(),
          millisecond: startDate.getMilliseconds()
        };
        var format = $dateFormatter.getDatetimeFormat(options.timeFormat, lang);
        var hoursFormat = $dateFormatter.hoursFormat(format), timeSeparator = $dateFormatter.timeSeparator(format), minutesFormat = $dateFormatter.minutesFormat(format), secondsFormat = $dateFormatter.secondsFormat(format), showSeconds = $dateFormatter.showSeconds(format), showAM = $dateFormatter.showAM(format);
        scope.$iconUp = options.iconUp;
        scope.$iconDown = options.iconDown;
        scope.$select = function(date, index) {
          $timepicker.select(date, index);
        };
        scope.$moveIndex = function(value, index) {
          $timepicker.$moveIndex(value, index);
        };
        scope.$switchMeridian = function(date) {
          $timepicker.switchMeridian(date);
        };
        $timepicker.update = function(date) {
          if (angular.isDate(date) && !isNaN(date.getTime())) {
            $timepicker.$date = date;
            angular.extend(viewDate, {
              hour: date.getHours(),
              minute: date.getMinutes(),
              second: date.getSeconds(),
              millisecond: date.getMilliseconds()
            });
            $timepicker.$build();
          } else if (!$timepicker.$isBuilt) {
            $timepicker.$build();
          }
        };
        $timepicker.select = function(date, index, keep) {
          if (!controller.$dateValue || isNaN(controller.$dateValue.getTime())) controller.$dateValue = new Date(1970, 0, 1);
          if (!angular.isDate(date)) date = new Date(date);
          if (index === 0) controller.$dateValue.setHours(date.getHours()); else if (index === 1) controller.$dateValue.setMinutes(date.getMinutes()); else if (index === 2) controller.$dateValue.setSeconds(date.getSeconds());
          controller.$setViewValue(angular.copy(controller.$dateValue));
          controller.$render();
          if (options.autoclose && !keep) {
            $timeout(function() {
              $timepicker.hide(true);
            });
          }
        };
        $timepicker.switchMeridian = function(date) {
          if (!controller.$dateValue || isNaN(controller.$dateValue.getTime())) {
            return;
          }
          var hours = (date || controller.$dateValue).getHours();
          controller.$dateValue.setHours(hours < 12 ? hours + 12 : hours - 12);
          controller.$setViewValue(angular.copy(controller.$dateValue));
          controller.$render();
        };
        $timepicker.$build = function() {
          var i, midIndex = scope.midIndex = parseInt(options.length / 2, 10);
          var hours = [], hour;
          for (i = 0; i < options.length; i++) {
            hour = new Date(1970, 0, 1, viewDate.hour - (midIndex - i) * options.hourStep);
            hours.push({
              date: hour,
              label: formatDate(hour, hoursFormat),
              selected: $timepicker.$date && $timepicker.$isSelected(hour, 0),
              disabled: $timepicker.$isDisabled(hour, 0)
            });
          }
          var minutes = [], minute;
          for (i = 0; i < options.length; i++) {
            minute = new Date(1970, 0, 1, 0, viewDate.minute - (midIndex - i) * options.minuteStep);
            minutes.push({
              date: minute,
              label: formatDate(minute, minutesFormat),
              selected: $timepicker.$date && $timepicker.$isSelected(minute, 1),
              disabled: $timepicker.$isDisabled(minute, 1)
            });
          }
          var seconds = [], second;
          for (i = 0; i < options.length; i++) {
            second = new Date(1970, 0, 1, 0, 0, viewDate.second - (midIndex - i) * options.secondStep);
            seconds.push({
              date: second,
              label: formatDate(second, secondsFormat),
              selected: $timepicker.$date && $timepicker.$isSelected(second, 2),
              disabled: $timepicker.$isDisabled(second, 2)
            });
          }
          var rows = [];
          for (i = 0; i < options.length; i++) {
            if (showSeconds) {
              rows.push([ hours[i], minutes[i], seconds[i] ]);
            } else {
              rows.push([ hours[i], minutes[i] ]);
            }
          }
          scope.rows = rows;
          scope.showSeconds = showSeconds;
          scope.showAM = showAM;
          scope.isAM = ($timepicker.$date || hours[midIndex].date).getHours() < 12;
          scope.timeSeparator = timeSeparator;
          $timepicker.$isBuilt = true;
        };
        $timepicker.$isSelected = function(date, index) {
          if (!$timepicker.$date) return false; else if (index === 0) {
            return date.getHours() === $timepicker.$date.getHours();
          } else if (index === 1) {
            return date.getMinutes() === $timepicker.$date.getMinutes();
          } else if (index === 2) {
            return date.getSeconds() === $timepicker.$date.getSeconds();
          }
        };
        $timepicker.$isDisabled = function(date, index) {
          var selectedTime;
          if (index === 0) {
            selectedTime = date.getTime() + viewDate.minute * 6e4 + viewDate.second * 1e3;
          } else if (index === 1) {
            selectedTime = date.getTime() + viewDate.hour * 36e5 + viewDate.second * 1e3;
          } else if (index === 2) {
            selectedTime = date.getTime() + viewDate.hour * 36e5 + viewDate.minute * 6e4;
          }
          return selectedTime < options.minTime * 1 || selectedTime > options.maxTime * 1;
        };
        scope.$arrowAction = function(value, index) {
          if (options.arrowBehavior === 'picker') {
            $timepicker.$setTimeByStep(value, index);
          } else {
            $timepicker.$moveIndex(value, index);
          }
        };
        $timepicker.$setTimeByStep = function(value, index) {
          var newDate = new Date($timepicker.$date || startDate);
          var hours = newDate.getHours();
          var minutes = newDate.getMinutes();
          var seconds = newDate.getSeconds();
          if (index === 0) {
            newDate.setHours(hours - parseInt(options.hourStep, 10) * value);
          } else if (index === 1) {
            newDate.setMinutes(minutes - parseInt(options.minuteStep, 10) * value);
          } else if (index === 2) {
            newDate.setSeconds(seconds - parseInt(options.secondStep, 10) * value);
          }
          $timepicker.select(newDate, index, true);
        };
        $timepicker.$moveIndex = function(value, index) {
          var targetDate;
          if (index === 0) {
            targetDate = new Date(1970, 0, 1, viewDate.hour + value * options.length, viewDate.minute, viewDate.second);
            angular.extend(viewDate, {
              hour: targetDate.getHours()
            });
          } else if (index === 1) {
            targetDate = new Date(1970, 0, 1, viewDate.hour, viewDate.minute + value * options.length * options.minuteStep, viewDate.second);
            angular.extend(viewDate, {
              minute: targetDate.getMinutes()
            });
          } else if (index === 2) {
            targetDate = new Date(1970, 0, 1, viewDate.hour, viewDate.minute, viewDate.second + value * options.length * options.secondStep);
            angular.extend(viewDate, {
              second: targetDate.getSeconds()
            });
          }
          $timepicker.$build();
        };
        $timepicker.$onMouseDown = function(evt) {
          if (evt.target.nodeName.toLowerCase() !== 'input') evt.preventDefault();
          evt.stopPropagation();
          if (isTouch) {
            var targetEl = angular.element(evt.target);
            if (targetEl[0].nodeName.toLowerCase() !== 'button') {
              targetEl = targetEl.parent();
            }
            targetEl.triggerHandler('click');
          }
        };
        $timepicker.$onKeyDown = function(evt) {
          if (!/(38|37|39|40|13)/.test(evt.keyCode) || evt.shiftKey || evt.altKey) return;
          evt.preventDefault();
          evt.stopPropagation();
          if (evt.keyCode === 13) {
            $timepicker.hide(true);
            return;
          }
          var newDate = new Date($timepicker.$date);
          var hours = newDate.getHours(), hoursLength = formatDate(newDate, hoursFormat).length;
          var minutes = newDate.getMinutes(), minutesLength = formatDate(newDate, minutesFormat).length;
          var seconds = newDate.getSeconds(), secondsLength = formatDate(newDate, secondsFormat).length;
          var sepLength = 1;
          var lateralMove = /(37|39)/.test(evt.keyCode);
          var count = 2 + showSeconds * 1 + showAM * 1;
          if (lateralMove) {
            if (evt.keyCode === 37) selectedIndex = selectedIndex < 1 ? count - 1 : selectedIndex - 1; else if (evt.keyCode === 39) selectedIndex = selectedIndex < count - 1 ? selectedIndex + 1 : 0;
          }
          var selectRange = [ 0, hoursLength ];
          var incr = 0;
          if (evt.keyCode === 38) incr = -1;
          if (evt.keyCode === 40) incr = +1;
          var isSeconds = selectedIndex === 2 && showSeconds;
          var isMeridian = selectedIndex === 2 && !showSeconds || selectedIndex === 3 && showSeconds;
          if (selectedIndex === 0) {
            newDate.setHours(hours + incr * parseInt(options.hourStep, 10));
            hoursLength = formatDate(newDate, hoursFormat).length;
            selectRange = [ 0, hoursLength ];
          } else if (selectedIndex === 1) {
            newDate.setMinutes(minutes + incr * parseInt(options.minuteStep, 10));
            minutesLength = formatDate(newDate, minutesFormat).length;
            selectRange = [ hoursLength + sepLength, minutesLength ];
          } else if (isSeconds) {
            newDate.setSeconds(seconds + incr * parseInt(options.secondStep, 10));
            secondsLength = formatDate(newDate, secondsFormat).length;
            selectRange = [ hoursLength + sepLength + minutesLength + sepLength, secondsLength ];
          } else if (isMeridian) {
            if (!lateralMove) $timepicker.switchMeridian();
            selectRange = [ hoursLength + sepLength + minutesLength + sepLength + (secondsLength + sepLength) * showSeconds, 2 ];
          }
          $timepicker.select(newDate, selectedIndex, true);
          createSelection(selectRange[0], selectRange[1]);
          parentScope.$digest();
        };
        function createSelection(start, length) {
          var end = start + length;
          if (element[0].createTextRange) {
            var selRange = element[0].createTextRange();
            selRange.collapse(true);
            selRange.moveStart('character', start);
            selRange.moveEnd('character', end);
            selRange.select();
          } else if (element[0].setSelectionRange) {
            element[0].setSelectionRange(start, end);
          } else if (angular.isUndefined(element[0].selectionStart)) {
            element[0].selectionStart = start;
            element[0].selectionEnd = end;
          }
        }
        function focusElement() {
          element[0].focus();
        }
        var _init = $timepicker.init;
        $timepicker.init = function() {
          if (isNative && options.useNative) {
            element.prop('type', 'time');
            element.css('-webkit-appearance', 'textfield');
            return;
          } else if (isTouch) {
            element.prop('type', 'text');
            element.attr('readonly', 'true');
            element.on('click', focusElement);
          }
          _init();
        };
        var _destroy = $timepicker.destroy;
        $timepicker.destroy = function() {
          if (isNative && options.useNative) {
            element.off('click', focusElement);
          }
          _destroy();
        };
        var _show = $timepicker.show;
        $timepicker.show = function() {
          if (!isTouch && element.attr('readonly') || element.attr('disabled')) return;
          _show();
          $timeout(function() {
            $timepicker.$element && $timepicker.$element.on(isTouch ? 'touchstart' : 'mousedown', $timepicker.$onMouseDown);
            if (options.keyboard) {
              element && element.on('keydown', $timepicker.$onKeyDown);
            }
          }, 0, false);
        };
        var _hide = $timepicker.hide;
        $timepicker.hide = function(blur) {
          if (!$timepicker.$isShown) return;
          $timepicker.$element && $timepicker.$element.off(isTouch ? 'touchstart' : 'mousedown', $timepicker.$onMouseDown);
          if (options.keyboard) {
            element && element.off('keydown', $timepicker.$onKeyDown);
          }
          _hide(blur);
        };
        return $timepicker;
      }
      timepickerFactory.defaults = defaults;
      return timepickerFactory;
    } ];
  }).directive('bsTimepicker', [ '$window', '$parse', '$q', '$dateFormatter', '$dateParser', '$timepicker', function($window, $parse, $q, $dateFormatter, $dateParser, $timepicker) {
    var defaults = $timepicker.defaults;
    var isNative = /(ip(a|o)d|iphone|android)/gi.test($window.navigator.userAgent);
    return {
      restrict: 'EAC',
      require: 'ngModel',
      link: function postLink(scope, element, attr, controller) {
        var options = {
          scope: scope
        };
        angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'placement', 'container', 'delay', 'trigger', 'keyboard', 'html', 'animation', 'autoclose', 'timeType', 'timeFormat', 'timezone', 'modelTimeFormat', 'useNative', 'hourStep', 'minuteStep', 'secondStep', 'length', 'arrowBehavior', 'iconUp', 'iconDown', 'roundDisplay', 'id', 'prefixClass', 'prefixEvent' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var falseValueRegExp = /^(false|0|)$/i;
        angular.forEach([ 'html', 'container', 'autoclose', 'useNative', 'roundDisplay' ], function(key) {
          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;
        });
        attr.bsShow && scope.$watch(attr.bsShow, function(newValue, oldValue) {
          if (!timepicker || !angular.isDefined(newValue)) return;
          if (angular.isString(newValue)) newValue = !!newValue.match(/true|,?(timepicker),?/i);
          newValue === true ? timepicker.show() : timepicker.hide();
        });
        if (isNative && (options.useNative || defaults.useNative)) options.timeFormat = 'HH:mm';
        var timepicker = $timepicker(element, controller, options);
        options = timepicker.$options;
        var lang = options.lang;
        var formatDate = function(date, format, timezone) {
          return $dateFormatter.formatDate(date, format, lang, timezone);
        };
        var dateParser = $dateParser({
          format: options.timeFormat,
          lang: lang
        });
        angular.forEach([ 'minTime', 'maxTime' ], function(key) {
          angular.isDefined(attr[key]) && attr.$observe(key, function(newValue) {
            timepicker.$options[key] = dateParser.getTimeForAttribute(key, newValue);
            !isNaN(timepicker.$options[key]) && timepicker.$build();
            validateAgainstMinMaxTime(controller.$dateValue);
          });
        });
        scope.$watch(attr.ngModel, function(newValue, oldValue) {
          timepicker.update(controller.$dateValue);
        }, true);
        function validateAgainstMinMaxTime(parsedTime) {
          if (!angular.isDate(parsedTime)) return;
          var isMinValid = isNaN(options.minTime) || new Date(parsedTime.getTime()).setFullYear(1970, 0, 1) >= options.minTime;
          var isMaxValid = isNaN(options.maxTime) || new Date(parsedTime.getTime()).setFullYear(1970, 0, 1) <= options.maxTime;
          var isValid = isMinValid && isMaxValid;
          controller.$setValidity('date', isValid);
          controller.$setValidity('min', isMinValid);
          controller.$setValidity('max', isMaxValid);
          if (!isValid) {
            return;
          }
          controller.$dateValue = parsedTime;
        }
        controller.$parsers.unshift(function(viewValue) {
          var date;
          if (!viewValue) {
            controller.$setValidity('date', true);
            return null;
          }
          var parsedTime = angular.isDate(viewValue) ? viewValue : dateParser.parse(viewValue, controller.$dateValue);
          if (!parsedTime || isNaN(parsedTime.getTime())) {
            controller.$setValidity('date', false);
            return undefined;
          } else {
            validateAgainstMinMaxTime(parsedTime);
          }
          if (options.timeType === 'string') {
            date = dateParser.timezoneOffsetAdjust(parsedTime, options.timezone, true);
            return formatDate(date, options.modelTimeFormat || options.timeFormat);
          }
          date = dateParser.timezoneOffsetAdjust(controller.$dateValue, options.timezone, true);
          if (options.timeType === 'number') {
            return date.getTime();
          } else if (options.timeType === 'unix') {
            return date.getTime() / 1e3;
          } else if (options.timeType === 'iso') {
            return date.toISOString();
          } else {
            return new Date(date);
          }
        });
        controller.$formatters.push(function(modelValue) {
          var date;
          if (angular.isUndefined(modelValue) || modelValue === null) {
            date = NaN;
          } else if (angular.isDate(modelValue)) {
            date = modelValue;
          } else if (options.timeType === 'string') {
            date = dateParser.parse(modelValue, null, options.modelTimeFormat);
          } else if (options.timeType === 'unix') {
            date = new Date(modelValue * 1e3);
          } else {
            date = new Date(modelValue);
          }
          controller.$dateValue = dateParser.timezoneOffsetAdjust(date, options.timezone);
          return getTimeFormattedString();
        });
        controller.$render = function() {
          element.val(getTimeFormattedString());
        };
        function getTimeFormattedString() {
          return !controller.$dateValue || isNaN(controller.$dateValue.getTime()) ? '' : formatDate(controller.$dateValue, options.timeFormat);
        }
        scope.$on('$destroy', function() {
          if (timepicker) timepicker.destroy();
          options = null;
          timepicker = null;
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.tab', []).provider('$tab', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      template: 'tab/tab.tpl.html',
      navClass: 'nav-tabs',
      activeClass: 'active'
    };
    var controller = this.controller = function($scope, $element, $attrs) {
      var self = this;
      self.$options = angular.copy(defaults);
      angular.forEach([ 'animation', 'navClass', 'activeClass' ], function(key) {
        if (angular.isDefined($attrs[key])) self.$options[key] = $attrs[key];
      });
      $scope.$navClass = self.$options.navClass;
      $scope.$activeClass = self.$options.activeClass;
      self.$panes = $scope.$panes = [];
      self.$activePaneChangeListeners = self.$viewChangeListeners = [];
      self.$push = function(pane) {
        if (angular.isUndefined(self.$panes.$active)) {
          $scope.$setActive(pane.name || 0);
        }
        self.$panes.push(pane);
      };
      self.$remove = function(pane) {
        var index = self.$panes.indexOf(pane);
        var active = self.$panes.$active;
        var activeIndex;
        if (angular.isString(active)) {
          activeIndex = self.$panes.map(function(pane) {
            return pane.name;
          }).indexOf(active);
        } else {
          activeIndex = self.$panes.$active;
        }
        self.$panes.splice(index, 1);
        if (index < activeIndex) {
          activeIndex--;
        } else if (index === activeIndex && activeIndex === self.$panes.length) {
          activeIndex--;
        }
        if (activeIndex >= 0 && activeIndex < self.$panes.length) {
          self.$setActive(self.$panes[activeIndex].name || activeIndex);
        } else {
          self.$setActive();
        }
      };
      self.$setActive = $scope.$setActive = function(value) {
        self.$panes.$active = value;
        self.$activePaneChangeListeners.forEach(function(fn) {
          fn();
        });
      };
      self.$isActive = $scope.$isActive = function($pane, $index) {
        return self.$panes.$active === $pane.name || self.$panes.$active === $index;
      };
    };
    this.$get = function() {
      var $tab = {};
      $tab.defaults = defaults;
      $tab.controller = controller;
      return $tab;
    };
  }).directive('bsTabs', [ '$window', '$animate', '$tab', '$parse', function($window, $animate, $tab, $parse) {
    var defaults = $tab.defaults;
    return {
      require: [ '?ngModel', 'bsTabs' ],
      transclude: true,
      scope: true,
      controller: [ '$scope', '$element', '$attrs', $tab.controller ],
      templateUrl: function(element, attr) {
        return attr.template || defaults.template;
      },
      link: function postLink(scope, element, attrs, controllers) {
        var ngModelCtrl = controllers[0];
        var bsTabsCtrl = controllers[1];
        if (ngModelCtrl) {
          bsTabsCtrl.$activePaneChangeListeners.push(function() {
            ngModelCtrl.$setViewValue(bsTabsCtrl.$panes.$active);
          });
          ngModelCtrl.$formatters.push(function(modelValue) {
            bsTabsCtrl.$setActive(modelValue);
            return modelValue;
          });
        }
        if (attrs.bsActivePane) {
          var parsedBsActivePane = $parse(attrs.bsActivePane);
          bsTabsCtrl.$activePaneChangeListeners.push(function() {
            parsedBsActivePane.assign(scope, bsTabsCtrl.$panes.$active);
          });
          scope.$watch(attrs.bsActivePane, function(newValue, oldValue) {
            bsTabsCtrl.$setActive(newValue);
          }, true);
        }
      }
    };
  } ]).directive('bsPane', [ '$window', '$animate', '$sce', function($window, $animate, $sce) {
    return {
      require: [ '^?ngModel', '^bsTabs' ],
      scope: true,
      link: function postLink(scope, element, attrs, controllers) {
        var ngModelCtrl = controllers[0];
        var bsTabsCtrl = controllers[1];
        element.addClass('tab-pane');
        attrs.$observe('title', function(newValue, oldValue) {
          scope.title = $sce.trustAsHtml(newValue);
        });
        scope.name = attrs.name;
        if (bsTabsCtrl.$options.animation) {
          element.addClass(bsTabsCtrl.$options.animation);
        }
        attrs.$observe('disabled', function(newValue, oldValue) {
          scope.disabled = scope.$eval(newValue);
        });
        bsTabsCtrl.$push(scope);
        scope.$on('$destroy', function() {
          bsTabsCtrl.$remove(scope);
        });
        function render() {
          var index = bsTabsCtrl.$panes.indexOf(scope);
          $animate[bsTabsCtrl.$isActive(scope, index) ? 'addClass' : 'removeClass'](element, bsTabsCtrl.$options.activeClass);
        }
        bsTabsCtrl.$activePaneChangeListeners.push(function() {
          render();
        });
        render();
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.select', [ 'mgcrea.ngStrap.tooltip', 'mgcrea.ngStrap.helpers.parseOptions' ]).provider('$select', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      prefixClass: 'select',
      prefixEvent: '$select',
      placement: 'bottom-left',
      templateUrl: 'select/select.tpl.html',
      trigger: 'focus',
      container: false,
      keyboard: true,
      html: false,
      delay: 0,
      multiple: false,
      allNoneButtons: false,
      sort: true,
      caretHtml: '&nbsp;<span class="caret"></span>',
      placeholder: 'Choose among the following...',
      allText: 'All',
      noneText: 'None',
      maxLength: 3,
      maxLengthHtml: 'selected',
      iconCheckmark: 'glyphicon glyphicon-ok'
    };
    this.$get = [ '$window', '$document', '$rootScope', '$tooltip', '$timeout', function($window, $document, $rootScope, $tooltip, $timeout) {
      var bodyEl = angular.element($window.document.body);
      var isNative = /(ip(a|o)d|iphone|android)/gi.test($window.navigator.userAgent);
      var isTouch = 'createTouch' in $window.document && isNative;
      function SelectFactory(element, controller, config) {
        var $select = {};
        var options = angular.extend({}, defaults, config);
        $select = $tooltip(element, options);
        var scope = $select.$scope;
        scope.$matches = [];
        if (options.multiple) {
          scope.$activeIndex = [];
        } else {
          scope.$activeIndex = -1;
        }
        scope.$isMultiple = options.multiple;
        scope.$showAllNoneButtons = options.allNoneButtons && options.multiple;
        scope.$iconCheckmark = options.iconCheckmark;
        scope.$allText = options.allText;
        scope.$noneText = options.noneText;
        scope.$activate = function(index) {
          scope.$$postDigest(function() {
            $select.activate(index);
          });
        };
        scope.$select = function(index, evt) {
          scope.$$postDigest(function() {
            $select.select(index);
          });
        };
        scope.$isVisible = function() {
          return $select.$isVisible();
        };
        scope.$isActive = function(index) {
          return $select.$isActive(index);
        };
        scope.$selectAll = function() {
          for (var i = 0; i < scope.$matches.length; i++) {
            if (!scope.$isActive(i)) {
              scope.$select(i);
            }
          }
        };
        scope.$selectNone = function() {
          for (var i = 0; i < scope.$matches.length; i++) {
            if (scope.$isActive(i)) {
              scope.$select(i);
            }
          }
        };
        $select.update = function(matches) {
          scope.$matches = matches;
          $select.$updateActiveIndex();
        };
        $select.activate = function(index) {
          if (options.multiple) {
            $select.$isActive(index) ? scope.$activeIndex.splice(scope.$activeIndex.indexOf(index), 1) : scope.$activeIndex.push(index);
            if (options.sort) scope.$activeIndex.sort(function(a, b) {
              return a - b;
            });
          } else {
            scope.$activeIndex = index;
          }
          return scope.$activeIndex;
        };
        $select.select = function(index) {
          var value = scope.$matches[index].value;
          scope.$apply(function() {
            $select.activate(index);
            if (options.multiple) {
              controller.$setViewValue(scope.$activeIndex.map(function(index) {
                if (angular.isUndefined(scope.$matches[index])) {
                  return null;
                }
                return scope.$matches[index].value;
              }));
            } else {
              controller.$setViewValue(value);
              $select.hide();
            }
          });
          scope.$emit(options.prefixEvent + '.select', value, index, $select);
        };
        $select.$updateActiveIndex = function() {
          if (options.multiple) {
            if (angular.isArray(controller.$modelValue)) {
              scope.$activeIndex = controller.$modelValue.map(function(value) {
                return $select.$getIndex(value);
              });
            } else {
              scope.$activeIndex = [];
            }
          } else {
            if (angular.isDefined(controller.$modelValue) && scope.$matches.length) {
              scope.$activeIndex = $select.$getIndex(controller.$modelValue);
            } else {
              scope.$activeIndex = -1;
            }
          }
        };
        $select.$isVisible = function() {
          if (!options.minLength || !controller) {
            return scope.$matches.length;
          }
          return scope.$matches.length && controller.$viewValue.length >= options.minLength;
        };
        $select.$isActive = function(index) {
          if (options.multiple) {
            return scope.$activeIndex.indexOf(index) !== -1;
          } else {
            return scope.$activeIndex === index;
          }
        };
        $select.$getIndex = function(value) {
          var l = scope.$matches.length, i = l;
          if (!l) return;
          for (i = l; i--; ) {
            if (scope.$matches[i].value === value) break;
          }
          if (i < 0) return;
          return i;
        };
        $select.$onMouseDown = function(evt) {
          evt.preventDefault();
          evt.stopPropagation();
          if (isTouch) {
            var targetEl = angular.element(evt.target);
            targetEl.triggerHandler('click');
          }
        };
        $select.$onKeyDown = function(evt) {
          if (!/(9|13|38|40)/.test(evt.keyCode)) return;
          if (evt.keyCode !== 9) {
            evt.preventDefault();
            evt.stopPropagation();
          }
          if (options.multiple && evt.keyCode === 9) {
            return $select.hide();
          }
          if (!options.multiple && (evt.keyCode === 13 || evt.keyCode === 9)) {
            return $select.select(scope.$activeIndex);
          }
          if (!options.multiple) {
            if (evt.keyCode === 38 && scope.$activeIndex > 0) scope.$activeIndex--; else if (evt.keyCode === 38 && scope.$activeIndex < 0) scope.$activeIndex = scope.$matches.length - 1; else if (evt.keyCode === 40 && scope.$activeIndex < scope.$matches.length - 1) scope.$activeIndex++; else if (angular.isUndefined(scope.$activeIndex)) scope.$activeIndex = 0;
            scope.$digest();
          }
        };
        $select.$isIE = function() {
          var ua = $window.navigator.userAgent;
          return ua.indexOf('MSIE ') > 0 || ua.indexOf('Trident/') > 0 || ua.indexOf('Edge/') > 0;
        };
        $select.$selectScrollFix = function(e) {
          if ($document[0].activeElement.tagName === 'UL') {
            e.preventDefault();
            e.stopImmediatePropagation();
            e.target.focus();
          }
        };
        var _show = $select.show;
        $select.show = function() {
          _show();
          if (options.multiple) {
            $select.$element.addClass('select-multiple');
          }
          $timeout(function() {
            $select.$element.on(isTouch ? 'touchstart' : 'mousedown', $select.$onMouseDown);
            if (options.keyboard) {
              element.on('keydown', $select.$onKeyDown);
            }
          }, 0, false);
        };
        var _hide = $select.hide;
        $select.hide = function() {
          if (!options.multiple && angular.isUndefined(controller.$modelValue)) {
            scope.$activeIndex = -1;
          }
          $select.$element.off(isTouch ? 'touchstart' : 'mousedown', $select.$onMouseDown);
          if (options.keyboard) {
            element.off('keydown', $select.$onKeyDown);
          }
          _hide(true);
        };
        return $select;
      }
      SelectFactory.defaults = defaults;
      return SelectFactory;
    } ];
  }).directive('bsSelect', [ '$window', '$parse', '$q', '$select', '$parseOptions', function($window, $parse, $q, $select, $parseOptions) {
    var defaults = $select.defaults;
    return {
      restrict: 'EAC',
      require: 'ngModel',
      link: function postLink(scope, element, attr, controller) {
        var options = {
          scope: scope,
          placeholder: defaults.placeholder
        };
        angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'placement', 'container', 'delay', 'trigger', 'keyboard', 'html', 'animation', 'placeholder', 'allNoneButtons', 'maxLength', 'maxLengthHtml', 'allText', 'noneText', 'iconCheckmark', 'autoClose', 'id', 'sort', 'caretHtml', 'prefixClass', 'prefixEvent' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var falseValueRegExp = /^(false|0|)$/i;
        angular.forEach([ 'html', 'container', 'allNoneButtons', 'sort' ], function(key) {
          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;
        });
        var dataMultiple = element.attr('data-multiple');
        if (angular.isDefined(dataMultiple)) {
          if (falseValueRegExp.test(dataMultiple)) options.multiple = false; else options.multiple = dataMultiple;
        }
        if (element[0].nodeName.toLowerCase() === 'select') {
          var inputEl = element;
          inputEl.css('display', 'none');
          element = angular.element('<button type="button" class="btn btn-default"></button>');
          inputEl.after(element);
        }
        var parsedOptions = $parseOptions(attr.bsOptions);
        var select = $select(element, controller, options);
        if (select.$isIE()) {
          element[0].addEventListener('blur', select.$selectScrollFix);
        }
        var watchedOptions = parsedOptions.$match[7].replace(/\|.+/, '').trim();
        scope.$watchCollection(watchedOptions, function(newValue, oldValue) {
          parsedOptions.valuesFn(scope, controller).then(function(values) {
            select.update(values);
            controller.$render();
          });
        });
        scope.$watch(attr.ngModel, function(newValue, oldValue) {
          select.$updateActiveIndex();
          controller.$render();
        }, true);
        controller.$render = function() {
          var selected, index;
          if (options.multiple && angular.isArray(controller.$modelValue)) {
            selected = controller.$modelValue.map(function(value) {
              index = select.$getIndex(value);
              return angular.isDefined(index) ? select.$scope.$matches[index].label : false;
            }).filter(angular.isDefined);
            if (selected.length > (options.maxLength || defaults.maxLength)) {
              selected = selected.length + ' ' + (options.maxLengthHtml || defaults.maxLengthHtml);
            } else {
              selected = selected.join(', ');
            }
          } else {
            index = select.$getIndex(controller.$modelValue);
            selected = angular.isDefined(index) ? select.$scope.$matches[index].label : false;
          }
          element.html((selected ? selected : options.placeholder) + (options.caretHtml ? options.caretHtml : defaults.caretHtml));
        };
        if (options.multiple) {
          controller.$isEmpty = function(value) {
            return !value || value.length === 0;
          };
        }
        scope.$on('$destroy', function() {
          if (select) select.destroy();
          options = null;
          select = null;
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.scrollspy', [ 'mgcrea.ngStrap.helpers.debounce', 'mgcrea.ngStrap.helpers.dimensions' ]).provider('$scrollspy', function() {
    var spies = this.$$spies = {};
    var defaults = this.defaults = {
      debounce: 150,
      throttle: 100,
      offset: 100
    };
    this.$get = [ '$window', '$document', '$rootScope', 'dimensions', 'debounce', 'throttle', function($window, $document, $rootScope, dimensions, debounce, throttle) {
      var windowEl = angular.element($window);
      var docEl = angular.element($document.prop('documentElement'));
      var bodyEl = angular.element($window.document.body);
      function nodeName(element, name) {
        return element[0].nodeName && element[0].nodeName.toLowerCase() === name.toLowerCase();
      }
      function ScrollSpyFactory(config) {
        var options = angular.extend({}, defaults, config);
        if (!options.element) options.element = bodyEl;
        var isWindowSpy = nodeName(options.element, 'body');
        var scrollEl = isWindowSpy ? windowEl : options.element;
        var scrollId = isWindowSpy ? 'window' : options.id;
        if (spies[scrollId]) {
          spies[scrollId].$$count++;
          return spies[scrollId];
        }
        var $scrollspy = {};
        var unbindViewContentLoaded, unbindIncludeContentLoaded;
        var trackedElements = $scrollspy.$trackedElements = [];
        var sortedElements = [];
        var activeTarget;
        var debouncedCheckPosition;
        var throttledCheckPosition;
        var debouncedCheckOffsets;
        var viewportHeight;
        var scrollTop;
        $scrollspy.init = function() {
          this.$$count = 1;
          debouncedCheckPosition = debounce(this.checkPosition, options.debounce);
          throttledCheckPosition = throttle(this.checkPosition, options.throttle);
          scrollEl.on('click', this.checkPositionWithEventLoop);
          windowEl.on('resize', debouncedCheckPosition);
          scrollEl.on('scroll', throttledCheckPosition);
          debouncedCheckOffsets = debounce(this.checkOffsets, options.debounce);
          unbindViewContentLoaded = $rootScope.$on('$viewContentLoaded', debouncedCheckOffsets);
          unbindIncludeContentLoaded = $rootScope.$on('$includeContentLoaded', debouncedCheckOffsets);
          debouncedCheckOffsets();
          if (scrollId) {
            spies[scrollId] = $scrollspy;
          }
        };
        $scrollspy.destroy = function() {
          this.$$count--;
          if (this.$$count > 0) {
            return;
          }
          scrollEl.off('click', this.checkPositionWithEventLoop);
          windowEl.off('resize', debouncedCheckPosition);
          scrollEl.off('scroll', throttledCheckPosition);
          unbindViewContentLoaded();
          unbindIncludeContentLoaded();
          if (scrollId) {
            delete spies[scrollId];
          }
        };
        $scrollspy.checkPosition = function() {
          if (!sortedElements.length) return;
          scrollTop = (isWindowSpy ? $window.pageYOffset : scrollEl.prop('scrollTop')) || 0;
          viewportHeight = Math.max($window.innerHeight, docEl.prop('clientHeight'));
          if (scrollTop < sortedElements[0].offsetTop && activeTarget !== sortedElements[0].target) {
            return $scrollspy.$activateElement(sortedElements[0]);
          }
          for (var i = sortedElements.length; i--; ) {
            if (angular.isUndefined(sortedElements[i].offsetTop) || sortedElements[i].offsetTop === null) continue;
            if (activeTarget === sortedElements[i].target) continue;
            if (scrollTop < sortedElements[i].offsetTop) continue;
            if (sortedElements[i + 1] && scrollTop > sortedElements[i + 1].offsetTop) continue;
            return $scrollspy.$activateElement(sortedElements[i]);
          }
        };
        $scrollspy.checkPositionWithEventLoop = function() {
          setTimeout($scrollspy.checkPosition, 1);
        };
        $scrollspy.$activateElement = function(element) {
          if (activeTarget) {
            var activeElement = $scrollspy.$getTrackedElement(activeTarget);
            if (activeElement) {
              activeElement.source.removeClass('active');
              if (nodeName(activeElement.source, 'li') && nodeName(activeElement.source.parent().parent(), 'li')) {
                activeElement.source.parent().parent().removeClass('active');
              }
            }
          }
          activeTarget = element.target;
          element.source.addClass('active');
          if (nodeName(element.source, 'li') && nodeName(element.source.parent().parent(), 'li')) {
            element.source.parent().parent().addClass('active');
          }
        };
        $scrollspy.$getTrackedElement = function(target) {
          return trackedElements.filter(function(obj) {
            return obj.target === target;
          })[0];
        };
        $scrollspy.checkOffsets = function() {
          angular.forEach(trackedElements, function(trackedElement) {
            var targetElement = document.querySelector(trackedElement.target);
            trackedElement.offsetTop = targetElement ? dimensions.offset(targetElement).top : null;
            if (options.offset && trackedElement.offsetTop !== null) trackedElement.offsetTop -= options.offset * 1;
          });
          sortedElements = trackedElements.filter(function(el) {
            return el.offsetTop !== null;
          }).sort(function(a, b) {
            return a.offsetTop - b.offsetTop;
          });
          debouncedCheckPosition();
        };
        $scrollspy.trackElement = function(target, source) {
          trackedElements.push({
            target: target,
            source: source
          });
        };
        $scrollspy.untrackElement = function(target, source) {
          var toDelete;
          for (var i = trackedElements.length; i--; ) {
            if (trackedElements[i].target === target && trackedElements[i].source === source) {
              toDelete = i;
              break;
            }
          }
          trackedElements = trackedElements.splice(toDelete, 1);
        };
        $scrollspy.activate = function(i) {
          trackedElements[i].addClass('active');
        };
        $scrollspy.init();
        return $scrollspy;
      }
      return ScrollSpyFactory;
    } ];
  }).directive('bsScrollspy', [ '$rootScope', 'debounce', 'dimensions', '$scrollspy', function($rootScope, debounce, dimensions, $scrollspy) {
    return {
      restrict: 'EAC',
      link: function postLink(scope, element, attr) {
        var options = {
          scope: scope
        };
        angular.forEach([ 'offset', 'target' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var scrollspy = $scrollspy(options);
        scrollspy.trackElement(options.target, element);
        scope.$on('$destroy', function() {
          if (scrollspy) {
            scrollspy.untrackElement(options.target, element);
            scrollspy.destroy();
          }
          options = null;
          scrollspy = null;
        });
      }
    };
  } ]).directive('bsScrollspyList', [ '$rootScope', 'debounce', 'dimensions', '$scrollspy', function($rootScope, debounce, dimensions, $scrollspy) {
    return {
      restrict: 'A',
      compile: function postLink(element, attr) {
        var children = element[0].querySelectorAll('li > a[href]');
        angular.forEach(children, function(child) {
          var childEl = angular.element(child);
          childEl.parent().attr('bs-scrollspy', '').attr('data-target', childEl.attr('href'));
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.popover', [ 'mgcrea.ngStrap.tooltip' ]).provider('$popover', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      customClass: '',
      container: false,
      target: false,
      placement: 'right',
      templateUrl: 'popover/popover.tpl.html',
      contentTemplate: false,
      trigger: 'click',
      keyboard: true,
      html: false,
      title: '',
      content: '',
      delay: 0,
      autoClose: false
    };
    this.$get = [ '$tooltip', function($tooltip) {
      function PopoverFactory(element, config) {
        var options = angular.extend({}, defaults, config);
        var $popover = $tooltip(element, options);
        if (options.content) {
          $popover.$scope.content = options.content;
        }
        return $popover;
      }
      return PopoverFactory;
    } ];
  }).directive('bsPopover', [ '$window', '$sce', '$popover', function($window, $sce, $popover) {
    var requestAnimationFrame = $window.requestAnimationFrame || $window.setTimeout;
    return {
      restrict: 'EAC',
      scope: true,
      link: function postLink(scope, element, attr) {
        var options = {
          scope: scope
        };
        angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'contentTemplate', 'placement', 'container', 'delay', 'trigger', 'html', 'animation', 'customClass', 'autoClose', 'id', 'prefixClass', 'prefixEvent' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var falseValueRegExp = /^(false|0|)$/i;
        angular.forEach([ 'html', 'container', 'autoClose' ], function(key) {
          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;
        });
        var dataTarget = element.attr('data-target');
        if (angular.isDefined(dataTarget)) {
          if (falseValueRegExp.test(dataTarget)) options.target = false; else options.target = dataTarget;
        }
        angular.forEach([ 'title', 'content' ], function(key) {
          attr[key] && attr.$observe(key, function(newValue, oldValue) {
            scope[key] = $sce.trustAsHtml(newValue);
            angular.isDefined(oldValue) && requestAnimationFrame(function() {
              popover && popover.$applyPlacement();
            });
          });
        });
        attr.bsPopover && scope.$watch(attr.bsPopover, function(newValue, oldValue) {
          if (angular.isObject(newValue)) {
            angular.extend(scope, newValue);
          } else {
            scope.content = newValue;
          }
          angular.isDefined(oldValue) && requestAnimationFrame(function() {
            popover && popover.$applyPlacement();
          });
        }, true);
        attr.bsShow && scope.$watch(attr.bsShow, function(newValue, oldValue) {
          if (!popover || !angular.isDefined(newValue)) return;
          if (angular.isString(newValue)) newValue = !!newValue.match(/true|,?(popover),?/i);
          newValue === true ? popover.show() : popover.hide();
        });
        attr.viewport && scope.$watch(attr.viewport, function(newValue) {
          if (!popover || !angular.isDefined(newValue)) return;
          popover.setViewport(newValue);
        });
        var popover = $popover(element, options);
        scope.$on('$destroy', function() {
          if (popover) popover.destroy();
          options = null;
          popover = null;
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.navbar', []).provider('$navbar', function() {
    var defaults = this.defaults = {
      activeClass: 'active',
      routeAttr: 'data-match-route',
      strict: false
    };
    this.$get = function() {
      return {
        defaults: defaults
      };
    };
  }).directive('bsNavbar', [ '$window', '$location', '$navbar', function($window, $location, $navbar) {
    var defaults = $navbar.defaults;
    return {
      restrict: 'A',
      link: function postLink(scope, element, attr, controller) {
        var options = angular.copy(defaults);
        angular.forEach(Object.keys(defaults), function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        scope.$watch(function() {
          return $location.path();
        }, function(newValue, oldValue) {
          var liElements = element[0].querySelectorAll('li[' + options.routeAttr + ']');
          angular.forEach(liElements, function(li) {
            var liElement = angular.element(li);
            var pattern = liElement.attr(options.routeAttr).replace('/', '\\/');
            if (options.strict) {
              pattern = '^' + pattern + '$';
            }
            var regexp = new RegExp(pattern, 'i');
            if (regexp.test(newValue)) {
              liElement.addClass(options.activeClass);
            } else {
              liElement.removeClass(options.activeClass);
            }
          });
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.modal', [ 'mgcrea.ngStrap.core', 'mgcrea.ngStrap.helpers.dimensions' ]).provider('$modal', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      backdropAnimation: 'am-fade',
      prefixClass: 'modal',
      prefixEvent: 'modal',
      placement: 'top',
      templateUrl: 'modal/modal.tpl.html',
      template: '',
      contentTemplate: false,
      container: false,
      element: null,
      backdrop: true,
      keyboard: true,
      html: false,
      show: true
    };
    this.$get = [ '$window', '$rootScope', '$bsCompiler', '$animate', '$timeout', '$sce', 'dimensions', function($window, $rootScope, $bsCompiler, $animate, $timeout, $sce, dimensions) {
      var forEach = angular.forEach;
      var trim = String.prototype.trim;
      var requestAnimationFrame = $window.requestAnimationFrame || $window.setTimeout;
      var bodyElement = angular.element($window.document.body);
      function ModalFactory(config) {
        var $modal = {};
        var options = $modal.$options = angular.extend({}, defaults, config);
        var promise = $modal.$promise = $bsCompiler.compile(options);
        var scope = $modal.$scope = options.scope && options.scope.$new() || $rootScope.$new();
        if (!options.element && !options.container) {
          options.container = 'body';
        }
        $modal.$id = options.id || options.element && options.element.attr('id') || '';
        forEach([ 'title', 'content' ], function(key) {
          if (options[key]) scope[key] = $sce.trustAsHtml(options[key]);
        });
        scope.$hide = function() {
          scope.$$postDigest(function() {
            $modal.hide();
          });
        };
        scope.$show = function() {
          scope.$$postDigest(function() {
            $modal.show();
          });
        };
        scope.$toggle = function() {
          scope.$$postDigest(function() {
            $modal.toggle();
          });
        };
        $modal.$isShown = scope.$isShown = false;
        var compileData, modalElement, modalScope;
        var backdropElement = angular.element('<div class="' + options.prefixClass + '-backdrop"/>');
        backdropElement.css({
          position: 'fixed',
          top: '0px',
          left: '0px',
          bottom: '0px',
          right: '0px',
          'z-index': 1038
        });
        promise.then(function(data) {
          compileData = data;
          $modal.init();
        });
        $modal.init = function() {
          if (options.show) {
            scope.$$postDigest(function() {
              $modal.show();
            });
          }
        };
        $modal.destroy = function() {
          destroyModalElement();
          if (backdropElement) {
            backdropElement.remove();
            backdropElement = null;
          }
          scope.$destroy();
        };
        $modal.show = function() {
          if ($modal.$isShown) return;
          var parent, after;
          if (angular.isElement(options.container)) {
            parent = options.container;
            after = options.container[0].lastChild ? angular.element(options.container[0].lastChild) : null;
          } else {
            if (options.container) {
              parent = findElement(options.container);
              after = parent[0] && parent[0].lastChild ? angular.element(parent[0].lastChild) : null;
            } else {
              parent = null;
              after = options.element;
            }
          }
          if (modalElement) destroyModalElement();
          modalScope = $modal.$scope.$new();
          modalElement = $modal.$element = compileData.link(modalScope, function(clonedElement, scope) {});
          if (scope.$emit(options.prefixEvent + '.show.before', $modal).defaultPrevented) {
            return;
          }
          modalElement.css({
            display: 'block'
          }).addClass(options.placement);
          if (options.animation) {
            if (options.backdrop) {
              backdropElement.addClass(options.backdropAnimation);
            }
            modalElement.addClass(options.animation);
          }
          if (options.backdrop) {
            $animate.enter(backdropElement, bodyElement, null);
          }
          if (angular.version.minor <= 2) {
            $animate.enter(modalElement, parent, after, enterAnimateCallback);
          } else {
            $animate.enter(modalElement, parent, after).then(enterAnimateCallback);
          }
          $modal.$isShown = scope.$isShown = true;
          safeDigest(scope);
          var el = modalElement[0];
          requestAnimationFrame(function() {
            el.focus();
          });
          bodyElement.addClass(options.prefixClass + '-open');
          if (options.animation) {
            bodyElement.addClass(options.prefixClass + '-with-' + options.animation);
          }
          bindBackdropEvents();
          bindKeyboardEvents();
        };
        function enterAnimateCallback() {
          scope.$emit(options.prefixEvent + '.show', $modal);
        }
        $modal.hide = function() {
          if (!$modal.$isShown) return;
          if (scope.$emit(options.prefixEvent + '.hide.before', $modal).defaultPrevented) {
            return;
          }
          if (angular.version.minor <= 2) {
            $animate.leave(modalElement, leaveAnimateCallback);
          } else {
            $animate.leave(modalElement).then(leaveAnimateCallback);
          }
          if (options.backdrop) {
            $animate.leave(backdropElement);
          }
          $modal.$isShown = scope.$isShown = false;
          safeDigest(scope);
          unbindBackdropEvents();
          unbindKeyboardEvents();
        };
        function leaveAnimateCallback() {
          scope.$emit(options.prefixEvent + '.hide', $modal);
          bodyElement.removeClass(options.prefixClass + '-open');
          if (options.animation) {
            bodyElement.removeClass(options.prefixClass + '-with-' + options.animation);
          }
        }
        $modal.toggle = function() {
          $modal.$isShown ? $modal.hide() : $modal.show();
        };
        $modal.focus = function() {
          modalElement[0].focus();
        };
        $modal.$onKeyUp = function(evt) {
          if (evt.which === 27 && $modal.$isShown) {
            $modal.hide();
            evt.stopPropagation();
          }
        };
        function bindBackdropEvents() {
          if (options.backdrop) {
            modalElement.on('click', hideOnBackdropClick);
            backdropElement.on('click', hideOnBackdropClick);
            backdropElement.on('wheel', preventEventDefault);
          }
        }
        function unbindBackdropEvents() {
          if (options.backdrop) {
            modalElement.off('click', hideOnBackdropClick);
            backdropElement.off('click', hideOnBackdropClick);
            backdropElement.off('wheel', preventEventDefault);
          }
        }
        function bindKeyboardEvents() {
          if (options.keyboard) {
            modalElement.on('keyup', $modal.$onKeyUp);
          }
        }
        function unbindKeyboardEvents() {
          if (options.keyboard) {
            modalElement.off('keyup', $modal.$onKeyUp);
          }
        }
        function hideOnBackdropClick(evt) {
          if (evt.target !== evt.currentTarget) return;
          options.backdrop === 'static' ? $modal.focus() : $modal.hide();
        }
        function preventEventDefault(evt) {
          evt.preventDefault();
        }
        function destroyModalElement() {
          if ($modal.$isShown && modalElement !== null) {
            unbindBackdropEvents();
            unbindKeyboardEvents();
          }
          if (modalScope) {
            modalScope.$destroy();
            modalScope = null;
          }
          if (modalElement) {
            modalElement.remove();
            modalElement = $modal.$element = null;
          }
        }
        return $modal;
      }
      function safeDigest(scope) {
        scope.$$phase || scope.$root && scope.$root.$$phase || scope.$digest();
      }
      function findElement(query, element) {
        return angular.element((element || document).querySelectorAll(query));
      }
      return ModalFactory;
    } ];
  }).directive('bsModal', [ '$window', '$sce', '$modal', function($window, $sce, $modal) {
    return {
      restrict: 'EAC',
      scope: true,
      link: function postLink(scope, element, attr, transclusion) {
        var options = {
          scope: scope,
          element: element,
          show: false
        };
        angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'contentTemplate', 'placement', 'backdrop', 'keyboard', 'html', 'container', 'animation', 'backdropAnimation', 'id', 'prefixEvent', 'prefixClass' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var falseValueRegExp = /^(false|0|)$/i;
        angular.forEach([ 'backdrop', 'keyboard', 'html', 'container' ], function(key) {
          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;
        });
        angular.forEach([ 'title', 'content' ], function(key) {
          attr[key] && attr.$observe(key, function(newValue, oldValue) {
            scope[key] = $sce.trustAsHtml(newValue);
          });
        });
        attr.bsModal && scope.$watch(attr.bsModal, function(newValue, oldValue) {
          if (angular.isObject(newValue)) {
            angular.extend(scope, newValue);
          } else {
            scope.content = newValue;
          }
        }, true);
        var modal = $modal(options);
        element.on(attr.trigger || 'click', modal.toggle);
        scope.$on('$destroy', function() {
          if (modal) modal.destroy();
          options = null;
          modal = null;
        });
      }
    };
  } ]);
  angular.version.minor < 3 && angular.version.dot < 14 && angular.module('ng').factory('$$rAF', [ '$window', '$timeout', function($window, $timeout) {
    var requestAnimationFrame = $window.requestAnimationFrame || $window.webkitRequestAnimationFrame || $window.mozRequestAnimationFrame;
    var cancelAnimationFrame = $window.cancelAnimationFrame || $window.webkitCancelAnimationFrame || $window.mozCancelAnimationFrame || $window.webkitCancelRequestAnimationFrame;
    var rafSupported = !!requestAnimationFrame;
    var raf = rafSupported ? function(fn) {
      var id = requestAnimationFrame(fn);
      return function() {
        cancelAnimationFrame(id);
      };
    } : function(fn) {
      var timer = $timeout(fn, 16.66, false);
      return function() {
        $timeout.cancel(timer);
      };
    };
    raf.supported = rafSupported;
    return raf;
  } ]);
  angular.module('mgcrea.ngStrap.helpers.parseOptions', []).provider('$parseOptions', function() {
    var defaults = this.defaults = {
      regexp: /^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/
    };
    this.$get = [ '$parse', '$q', function($parse, $q) {
      function ParseOptionsFactory(attr, config) {
        var $parseOptions = {};
        var options = angular.extend({}, defaults, config);
        $parseOptions.$values = [];
        var match, displayFn, valueName, keyName, groupByFn, valueFn, valuesFn;
        $parseOptions.init = function() {
          $parseOptions.$match = match = attr.match(options.regexp);
          displayFn = $parse(match[2] || match[1]), valueName = match[4] || match[6], keyName = match[5], 
          groupByFn = $parse(match[3] || ''), valueFn = $parse(match[2] ? match[1] : valueName), 
          valuesFn = $parse(match[7]);
        };
        $parseOptions.valuesFn = function(scope, controller) {
          return $q.when(valuesFn(scope, controller)).then(function(values) {
            if (!angular.isArray(values)) {
              values = [];
            }
            $parseOptions.$values = values.length ? parseValues(values, scope) : [];
            return $parseOptions.$values;
          });
        };
        $parseOptions.displayValue = function(modelValue) {
          var scope = {};
          scope[valueName] = modelValue;
          return displayFn(scope);
        };
        function parseValues(values, scope) {
          return values.map(function(match, index) {
            var locals = {}, label, value;
            locals[valueName] = match;
            label = displayFn(scope, locals);
            value = valueFn(scope, locals);
            return {
              label: label,
              value: value,
              index: index
            };
          });
        }
        $parseOptions.init();
        return $parseOptions;
      }
      return ParseOptionsFactory;
    } ];
  });
  angular.module('mgcrea.ngStrap.helpers.dimensions', []).factory('dimensions', [ '$document', '$window', function($document, $window) {
    var jqLite = angular.element;
    var fn = {};
    var nodeName = fn.nodeName = function(element, name) {
      return element.nodeName && element.nodeName.toLowerCase() === name.toLowerCase();
    };
    fn.css = function(element, prop, extra) {
      var value;
      if (element.currentStyle) {
        value = element.currentStyle[prop];
      } else if (window.getComputedStyle) {
        value = window.getComputedStyle(element)[prop];
      } else {
        value = element.style[prop];
      }
      return extra === true ? parseFloat(value) || 0 : value;
    };
    fn.offset = function(element) {
      var boxRect = element.getBoundingClientRect();
      var docElement = element.ownerDocument;
      return {
        width: boxRect.width || element.offsetWidth,
        height: boxRect.height || element.offsetHeight,
        top: boxRect.top + (window.pageYOffset || docElement.documentElement.scrollTop) - (docElement.documentElement.clientTop || 0),
        left: boxRect.left + (window.pageXOffset || docElement.documentElement.scrollLeft) - (docElement.documentElement.clientLeft || 0)
      };
    };
    fn.setOffset = function(element, options, i) {
      var curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition, position = fn.css(element, 'position'), curElem = angular.element(element), props = {};
      if (position === 'static') {
        element.style.position = 'relative';
      }
      curOffset = fn.offset(element);
      curCSSTop = fn.css(element, 'top');
      curCSSLeft = fn.css(element, 'left');
      calculatePosition = (position === 'absolute' || position === 'fixed') && (curCSSTop + curCSSLeft).indexOf('auto') > -1;
      if (calculatePosition) {
        curPosition = fn.position(element);
        curTop = curPosition.top;
        curLeft = curPosition.left;
      } else {
        curTop = parseFloat(curCSSTop) || 0;
        curLeft = parseFloat(curCSSLeft) || 0;
      }
      if (angular.isFunction(options)) {
        options = options.call(element, i, curOffset);
      }
      if (options.top !== null) {
        props.top = options.top - curOffset.top + curTop;
      }
      if (options.left !== null) {
        props.left = options.left - curOffset.left + curLeft;
      }
      if ('using' in options) {
        options.using.call(curElem, props);
      } else {
        curElem.css({
          top: props.top + 'px',
          left: props.left + 'px'
        });
      }
    };
    fn.position = function(element) {
      var offsetParentRect = {
        top: 0,
        left: 0
      }, offsetParentElement, offset;
      if (fn.css(element, 'position') === 'fixed') {
        offset = element.getBoundingClientRect();
      } else {
        offsetParentElement = offsetParent(element);
        offset = fn.offset(element);
        if (!nodeName(offsetParentElement, 'html')) {
          offsetParentRect = fn.offset(offsetParentElement);
        }
        offsetParentRect.top += fn.css(offsetParentElement, 'borderTopWidth', true);
        offsetParentRect.left += fn.css(offsetParentElement, 'borderLeftWidth', true);
      }
      return {
        width: element.offsetWidth,
        height: element.offsetHeight,
        top: offset.top - offsetParentRect.top - fn.css(element, 'marginTop', true),
        left: offset.left - offsetParentRect.left - fn.css(element, 'marginLeft', true)
      };
    };
    var offsetParent = function offsetParentElement(element) {
      var docElement = element.ownerDocument;
      var offsetParent = element.offsetParent || docElement;
      if (nodeName(offsetParent, '#document')) return docElement.documentElement;
      while (offsetParent && !nodeName(offsetParent, 'html') && fn.css(offsetParent, 'position') === 'static') {
        offsetParent = offsetParent.offsetParent;
      }
      return offsetParent || docElement.documentElement;
    };
    fn.height = function(element, outer) {
      var value = element.offsetHeight;
      if (outer) {
        value += fn.css(element, 'marginTop', true) + fn.css(element, 'marginBottom', true);
      } else {
        value -= fn.css(element, 'paddingTop', true) + fn.css(element, 'paddingBottom', true) + fn.css(element, 'borderTopWidth', true) + fn.css(element, 'borderBottomWidth', true);
      }
      return value;
    };
    fn.width = function(element, outer) {
      var value = element.offsetWidth;
      if (outer) {
        value += fn.css(element, 'marginLeft', true) + fn.css(element, 'marginRight', true);
      } else {
        value -= fn.css(element, 'paddingLeft', true) + fn.css(element, 'paddingRight', true) + fn.css(element, 'borderLeftWidth', true) + fn.css(element, 'borderRightWidth', true);
      }
      return value;
    };
    return fn;
  } ]);
  angular.module('mgcrea.ngStrap.helpers.debounce', []).factory('debounce', [ '$timeout', function($timeout) {
    return function(func, wait, immediate) {
      var timeout = null;
      return function() {
        var context = this, args = arguments, callNow = immediate && !timeout;
        if (timeout) {
          $timeout.cancel(timeout);
        }
        timeout = $timeout(function later() {
          timeout = null;
          if (!immediate) {
            func.apply(context, args);
          }
        }, wait, false);
        if (callNow) {
          func.apply(context, args);
        }
        return timeout;
      };
    };
  } ]).factory('throttle', [ '$timeout', function($timeout) {
    return function(func, wait, options) {
      var timeout = null;
      options || (options = {});
      return function() {
        var context = this, args = arguments;
        if (!timeout) {
          if (options.leading !== false) {
            func.apply(context, args);
          }
          timeout = $timeout(function later() {
            timeout = null;
            if (options.trailing !== false) {
              func.apply(context, args);
            }
          }, wait, false);
        }
      };
    };
  } ]);
  angular.module('mgcrea.ngStrap.helpers.dateParser', []).provider('$dateParser', [ '$localeProvider', function($localeProvider) {
    function ParseDate() {
      this.year = 1970;
      this.month = 0;
      this.day = 1;
      this.hours = 0;
      this.minutes = 0;
      this.seconds = 0;
      this.milliseconds = 0;
    }
    ParseDate.prototype.setMilliseconds = function(value) {
      this.milliseconds = value;
    };
    ParseDate.prototype.setSeconds = function(value) {
      this.seconds = value;
    };
    ParseDate.prototype.setMinutes = function(value) {
      this.minutes = value;
    };
    ParseDate.prototype.setHours = function(value) {
      this.hours = value;
    };
    ParseDate.prototype.getHours = function() {
      return this.hours;
    };
    ParseDate.prototype.setDate = function(value) {
      this.day = value;
    };
    ParseDate.prototype.setMonth = function(value) {
      this.month = value;
    };
    ParseDate.prototype.setFullYear = function(value) {
      this.year = value;
    };
    ParseDate.prototype.fromDate = function(value) {
      this.year = value.getFullYear();
      this.month = value.getMonth();
      this.day = value.getDate();
      this.hours = value.getHours();
      this.minutes = value.getMinutes();
      this.seconds = value.getSeconds();
      this.milliseconds = value.getMilliseconds();
      return this;
    };
    ParseDate.prototype.toDate = function() {
      return new Date(this.year, this.month, this.day, this.hours, this.minutes, this.seconds, this.milliseconds);
    };
    var proto = ParseDate.prototype;
    function noop() {}
    function isNumeric(n) {
      return !isNaN(parseFloat(n)) && isFinite(n);
    }
    function indexOfCaseInsensitive(array, value) {
      var len = array.length, str = value.toString().toLowerCase();
      for (var i = 0; i < len; i++) {
        if (array[i].toLowerCase() === str) {
          return i;
        }
      }
      return -1;
    }
    var defaults = this.defaults = {
      format: 'shortDate',
      strict: false
    };
    this.$get = [ '$locale', 'dateFilter', function($locale, dateFilter) {
      var DateParserFactory = function(config) {
        var options = angular.extend({}, defaults, config);
        var $dateParser = {};
        var regExpMap = {
          sss: '[0-9]{3}',
          ss: '[0-5][0-9]',
          s: options.strict ? '[1-5]?[0-9]' : '[0-9]|[0-5][0-9]',
          mm: '[0-5][0-9]',
          m: options.strict ? '[1-5]?[0-9]' : '[0-9]|[0-5][0-9]',
          HH: '[01][0-9]|2[0-3]',
          H: options.strict ? '1?[0-9]|2[0-3]' : '[01]?[0-9]|2[0-3]',
          hh: '[0][1-9]|[1][012]',
          h: options.strict ? '[1-9]|1[012]' : '0?[1-9]|1[012]',
          a: 'AM|PM',
          EEEE: $locale.DATETIME_FORMATS.DAY.join('|'),
          EEE: $locale.DATETIME_FORMATS.SHORTDAY.join('|'),
          dd: '0[1-9]|[12][0-9]|3[01]',
          d: options.strict ? '[1-9]|[1-2][0-9]|3[01]' : '0?[1-9]|[1-2][0-9]|3[01]',
          MMMM: $locale.DATETIME_FORMATS.MONTH.join('|'),
          MMM: $locale.DATETIME_FORMATS.SHORTMONTH.join('|'),
          MM: '0[1-9]|1[012]',
          M: options.strict ? '[1-9]|1[012]' : '0?[1-9]|1[012]',
          yyyy: '[1]{1}[0-9]{3}|[2]{1}[0-9]{3}',
          yy: '[0-9]{2}',
          y: options.strict ? '-?(0|[1-9][0-9]{0,3})' : '-?0*[0-9]{1,4}'
        };
        var setFnMap = {
          sss: proto.setMilliseconds,
          ss: proto.setSeconds,
          s: proto.setSeconds,
          mm: proto.setMinutes,
          m: proto.setMinutes,
          HH: proto.setHours,
          H: proto.setHours,
          hh: proto.setHours,
          h: proto.setHours,
          EEEE: noop,
          EEE: noop,
          dd: proto.setDate,
          d: proto.setDate,
          a: function(value) {
            var hours = this.getHours() % 12;
            return this.setHours(value.match(/pm/i) ? hours + 12 : hours);
          },
          MMMM: function(value) {
            return this.setMonth(indexOfCaseInsensitive($locale.DATETIME_FORMATS.MONTH, value));
          },
          MMM: function(value) {
            return this.setMonth(indexOfCaseInsensitive($locale.DATETIME_FORMATS.SHORTMONTH, value));
          },
          MM: function(value) {
            return this.setMonth(1 * value - 1);
          },
          M: function(value) {
            return this.setMonth(1 * value - 1);
          },
          yyyy: proto.setFullYear,
          yy: function(value) {
            return this.setFullYear(2e3 + 1 * value);
          },
          y: function(value) {
            return 1 * value <= 50 && value.length === 2 ? this.setFullYear(2e3 + 1 * value) : this.setFullYear(1 * value);
          }
        };
        var regex, setMap;
        $dateParser.init = function() {
          $dateParser.$format = $locale.DATETIME_FORMATS[options.format] || options.format;
          regex = regExpForFormat($dateParser.$format);
          setMap = setMapForFormat($dateParser.$format);
        };
        $dateParser.isValid = function(date) {
          if (angular.isDate(date)) return !isNaN(date.getTime());
          return regex.test(date);
        };
        $dateParser.parse = function(value, baseDate, format, timezone) {
          if (format) format = $locale.DATETIME_FORMATS[format] || format;
          if (angular.isDate(value)) value = dateFilter(value, format || $dateParser.$format, timezone);
          var formatRegex = format ? regExpForFormat(format) : regex;
          var formatSetMap = format ? setMapForFormat(format) : setMap;
          var matches = formatRegex.exec(value);
          if (!matches) return false;
          var date = baseDate && !isNaN(baseDate.getTime()) ? new ParseDate().fromDate(baseDate) : new ParseDate().fromDate(new Date(1970, 0, 1, 0));
          for (var i = 0; i < matches.length - 1; i++) {
            formatSetMap[i] && formatSetMap[i].call(date, matches[i + 1]);
          }
          var newDate = date.toDate();
          if (parseInt(date.day, 10) !== newDate.getDate()) {
            return false;
          }
          return newDate;
        };
        $dateParser.getDateForAttribute = function(key, value) {
          var date;
          if (value === 'today') {
            var today = new Date();
            date = new Date(today.getFullYear(), today.getMonth(), today.getDate() + (key === 'maxDate' ? 1 : 0), 0, 0, 0, key === 'minDate' ? 0 : -1);
          } else if (angular.isString(value) && value.match(/^".+"$/)) {
            date = new Date(value.substr(1, value.length - 2));
          } else if (isNumeric(value)) {
            date = new Date(parseInt(value, 10));
          } else if (angular.isString(value) && 0 === value.length) {
            date = key === 'minDate' ? -Infinity : +Infinity;
          } else {
            date = new Date(value);
          }
          return date;
        };
        $dateParser.getTimeForAttribute = function(key, value) {
          var time;
          if (value === 'now') {
            time = new Date().setFullYear(1970, 0, 1);
          } else if (angular.isString(value) && value.match(/^".+"$/)) {
            time = new Date(value.substr(1, value.length - 2)).setFullYear(1970, 0, 1);
          } else if (isNumeric(value)) {
            time = new Date(parseInt(value, 10)).setFullYear(1970, 0, 1);
          } else if (angular.isString(value) && 0 === value.length) {
            time = key === 'minTime' ? -Infinity : +Infinity;
          } else {
            time = $dateParser.parse(value, new Date(1970, 0, 1, 0));
          }
          return time;
        };
        $dateParser.daylightSavingAdjust = function(date) {
          if (!date) {
            return null;
          }
          date.setHours(date.getHours() > 12 ? date.getHours() + 2 : 0);
          return date;
        };
        $dateParser.timezoneOffsetAdjust = function(date, timezone, undo) {
          if (!date) {
            return null;
          }
          if (timezone && timezone === 'UTC') {
            date = new Date(date.getTime());
            date.setMinutes(date.getMinutes() + (undo ? -1 : 1) * date.getTimezoneOffset());
          }
          return date;
        };
        function setMapForFormat(format) {
          var keys = Object.keys(setFnMap), i;
          var map = [], sortedMap = [];
          var clonedFormat = format;
          for (i = 0; i < keys.length; i++) {
            if (format.split(keys[i]).length > 1) {
              var index = clonedFormat.search(keys[i]);
              format = format.split(keys[i]).join('');
              if (setFnMap[keys[i]]) {
                map[index] = setFnMap[keys[i]];
              }
            }
          }
          angular.forEach(map, function(v) {
            if (v) sortedMap.push(v);
          });
          return sortedMap;
        }
        function escapeReservedSymbols(text) {
          return text.replace(/\//g, '[\\/]').replace('/-/g', '[-]').replace(/\./g, '[.]').replace(/\\s/g, '[\\s]');
        }
        function regExpForFormat(format) {
          var keys = Object.keys(regExpMap), i;
          var re = format;
          for (i = 0; i < keys.length; i++) {
            re = re.split(keys[i]).join('${' + i + '}');
          }
          for (i = 0; i < keys.length; i++) {
            re = re.split('${' + i + '}').join('(' + regExpMap[keys[i]] + ')');
          }
          format = escapeReservedSymbols(format);
          return new RegExp('^' + re + '$', [ 'i' ]);
        }
        $dateParser.init();
        return $dateParser;
      };
      return DateParserFactory;
    } ];
  } ]);
  angular.module('mgcrea.ngStrap.helpers.dateFormatter', []).service('$dateFormatter', [ '$locale', 'dateFilter', function($locale, dateFilter) {
    this.getDefaultLocale = function() {
      return $locale.id;
    };
    this.getDatetimeFormat = function(format, lang) {
      return $locale.DATETIME_FORMATS[format] || format;
    };
    this.weekdaysShort = function(lang) {
      return $locale.DATETIME_FORMATS.SHORTDAY;
    };
    function splitTimeFormat(format) {
      return /(h+)([:\.])?(m+)([:\.])?(s*)[ ]?(a?)/i.exec(format).slice(1);
    }
    this.hoursFormat = function(timeFormat) {
      return splitTimeFormat(timeFormat)[0];
    };
    this.minutesFormat = function(timeFormat) {
      return splitTimeFormat(timeFormat)[2];
    };
    this.secondsFormat = function(timeFormat) {
      return splitTimeFormat(timeFormat)[4];
    };
    this.timeSeparator = function(timeFormat) {
      return splitTimeFormat(timeFormat)[1];
    };
    this.showSeconds = function(timeFormat) {
      return !!splitTimeFormat(timeFormat)[4];
    };
    this.showAM = function(timeFormat) {
      return !!splitTimeFormat(timeFormat)[5];
    };
    this.formatDate = function(date, format, lang, timezone) {
      return dateFilter(date, format, timezone);
    };
  } ]);
  angular.module('mgcrea.ngStrap.core', []).service('$bsCompiler', bsCompilerService);
  function bsCompilerService($q, $http, $injector, $compile, $controller, $templateCache) {
    this.compile = function(options) {
      if (options.template && /\.html$/.test(options.template)) {
        console.warn('Deprecated use of `template` option to pass a file. Please use the `templateUrl` option instead.');
        options.templateUrl = options.template;
        options.template = '';
      }
      var templateUrl = options.templateUrl;
      var template = options.template || '';
      var controller = options.controller;
      var controllerAs = options.controllerAs;
      var resolve = angular.copy(options.resolve || {});
      var locals = angular.copy(options.locals || {});
      var transformTemplate = options.transformTemplate || angular.identity;
      var bindToController = options.bindToController;
      angular.forEach(resolve, function(value, key) {
        if (angular.isString(value)) {
          resolve[key] = $injector.get(value);
        } else {
          resolve[key] = $injector.invoke(value);
        }
      });
      angular.extend(resolve, locals);
      if (template) {
        resolve.$template = $q.when(template);
      } else if (templateUrl) {
        resolve.$template = fetchTemplate(templateUrl);
      } else {
        throw new Error('Missing `template` / `templateUrl` option.');
      }
      if (options.contentTemplate) {
        resolve.$template = $q.all([ resolve.$template, fetchTemplate(options.contentTemplate) ]).then(function(templates) {
          var templateEl = angular.element(templates[0]);
          var contentEl = findElement('[ng-bind="content"]', templateEl[0]).removeAttr('ng-bind').html(templates[1]);
          if (!options.templateUrl) contentEl.next().remove();
          return templateEl[0].outerHTML;
        });
      }
      return $q.all(resolve).then(function(locals) {
        var template = transformTemplate(locals.$template);
        if (options.html) {
          template = template.replace(/ng-bind="/gi, 'ng-bind-html="');
        }
        var element = angular.element('<div>').html(template.trim()).contents();
        var linkFn = $compile(element);
        return {
          locals: locals,
          element: element,
          link: function link(scope) {
            locals.$scope = scope;
            if (controller) {
              var invokeCtrl = $controller(controller, locals, true);
              if (bindToController) {
                angular.extend(invokeCtrl.instance, locals);
              }
              var ctrl = angular.isObject(invokeCtrl) ? invokeCtrl : invokeCtrl();
              element.data('$ngControllerController', ctrl);
              element.children().data('$ngControllerController', ctrl);
              if (controllerAs) {
                scope[controllerAs] = ctrl;
              }
            }
            return linkFn.apply(null, arguments);
          }
        };
      });
    };
    function findElement(query, element) {
      return angular.element((element || document).querySelectorAll(query));
    }
    var fetchPromises = {};
    function fetchTemplate(template) {
      if (fetchPromises[template]) return fetchPromises[template];
      return fetchPromises[template] = $http.get(template, {
        cache: $templateCache
      }).then(function(res) {
        return res.data;
      });
    }
  }
  bsCompilerService.$inject = [ '$q', '$http', '$injector', '$compile', '$controller', '$templateCache' ];
  angular.module('mgcrea.ngStrap.dropdown', [ 'mgcrea.ngStrap.tooltip' ]).provider('$dropdown', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      prefixClass: 'dropdown',
      prefixEvent: 'dropdown',
      placement: 'bottom-left',
      templateUrl: 'dropdown/dropdown.tpl.html',
      trigger: 'click',
      container: false,
      keyboard: true,
      html: false,
      delay: 0
    };
    this.$get = [ '$window', '$rootScope', '$tooltip', '$timeout', function($window, $rootScope, $tooltip, $timeout) {
      var bodyEl = angular.element($window.document.body);
      var matchesSelector = Element.prototype.matchesSelector || Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector;
      function DropdownFactory(element, config) {
        var $dropdown = {};
        var options = angular.extend({}, defaults, config);
        var scope = $dropdown.$scope = options.scope && options.scope.$new() || $rootScope.$new();
        $dropdown = $tooltip(element, options);
        var parentEl = element.parent();
        $dropdown.$onKeyDown = function(evt) {
          if (!/(38|40)/.test(evt.keyCode)) return;
          evt.preventDefault();
          evt.stopPropagation();
          var items = angular.element($dropdown.$element[0].querySelectorAll('li:not(.divider) a'));
          if (!items.length) return;
          var index;
          angular.forEach(items, function(el, i) {
            if (matchesSelector && matchesSelector.call(el, ':focus')) index = i;
          });
          if (evt.keyCode === 38 && index > 0) index--; else if (evt.keyCode === 40 && index < items.length - 1) index++; else if (angular.isUndefined(index)) index = 0;
          items.eq(index)[0].focus();
        };
        var show = $dropdown.show;
        $dropdown.show = function() {
          show();
          $timeout(function() {
            options.keyboard && $dropdown.$element && $dropdown.$element.on('keydown', $dropdown.$onKeyDown);
            bodyEl.on('click', onBodyClick);
          }, 0, false);
          parentEl.hasClass('dropdown') && parentEl.addClass('open');
        };
        var hide = $dropdown.hide;
        $dropdown.hide = function() {
          if (!$dropdown.$isShown) return;
          options.keyboard && $dropdown.$element && $dropdown.$element.off('keydown', $dropdown.$onKeyDown);
          bodyEl.off('click', onBodyClick);
          parentEl.hasClass('dropdown') && parentEl.removeClass('open');
          hide();
        };
        var destroy = $dropdown.destroy;
        $dropdown.destroy = function() {
          bodyEl.off('click', onBodyClick);
          destroy();
        };
        function onBodyClick(evt) {
          if (evt.target === element[0]) return;
          return evt.target !== element[0] && $dropdown.hide();
        }
        return $dropdown;
      }
      return DropdownFactory;
    } ];
  }).directive('bsDropdown', [ '$window', '$sce', '$dropdown', function($window, $sce, $dropdown) {
    return {
      restrict: 'EAC',
      scope: true,
      compile: function(tElement, tAttrs) {
        var options = {};
        if (!tAttrs.bsDropdown) {
          var nextSibling = tElement[0].nextSibling;
          while (nextSibling && nextSibling.nodeType !== 1) {
            nextSibling = nextSibling.nextSibling;
          }
          if (nextSibling.classList.contains('dropdown-menu')) {
            options.template = nextSibling.outerHTML;
            options.templateUrl = undefined;
            nextSibling.parentNode.removeChild(nextSibling);
          }
        }
        return function postLink(scope, element, attr) {
          options.scope = scope;
          angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'placement', 'container', 'delay', 'trigger', 'keyboard', 'html', 'animation', 'id' ], function(key) {
            if (angular.isDefined(tAttrs[key])) options[key] = tAttrs[key];
          });
          var falseValueRegExp = /^(false|0|)$/i;
          angular.forEach([ 'html', 'container' ], function(key) {
            if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;
          });
          attr.bsDropdown && scope.$watch(attr.bsDropdown, function(newValue, oldValue) {
            scope.content = newValue;
          }, true);
          attr.bsShow && scope.$watch(attr.bsShow, function(newValue, oldValue) {
            if (!dropdown || !angular.isDefined(newValue)) return;
            if (angular.isString(newValue)) newValue = !!newValue.match(/true|,?(dropdown),?/i);
            newValue === true ? dropdown.show() : dropdown.hide();
          });
          var dropdown = $dropdown(element, options);
          scope.$on('$destroy', function() {
            if (dropdown) dropdown.destroy();
            options = null;
            dropdown = null;
          });
        };
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.datepicker', [ 'mgcrea.ngStrap.helpers.dateParser', 'mgcrea.ngStrap.helpers.dateFormatter', 'mgcrea.ngStrap.tooltip' ]).provider('$datepicker', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      prefixClass: 'datepicker',
      placement: 'bottom-left',
      templateUrl: 'datepicker/datepicker.tpl.html',
      trigger: 'focus',
      container: false,
      keyboard: true,
      html: false,
      delay: 0,
      useNative: false,
      dateType: 'date',
      dateFormat: 'shortDate',
      timezone: null,
      modelDateFormat: null,
      dayFormat: 'dd',
      monthFormat: 'MMM',
      yearFormat: 'yyyy',
      monthTitleFormat: 'MMMM yyyy',
      yearTitleFormat: 'yyyy',
      strictFormat: false,
      autoclose: false,
      minDate: -Infinity,
      maxDate: +Infinity,
      startView: 0,
      minView: 0,
      startWeek: 0,
      daysOfWeekDisabled: '',
      iconLeft: 'glyphicon glyphicon-chevron-left',
      iconRight: 'glyphicon glyphicon-chevron-right'
    };
    this.$get = [ '$window', '$document', '$rootScope', '$sce', '$dateFormatter', 'datepickerViews', '$tooltip', '$timeout', function($window, $document, $rootScope, $sce, $dateFormatter, datepickerViews, $tooltip, $timeout) {
      var isNative = /(ip(a|o)d|iphone|android)/gi.test($window.navigator.userAgent);
      var isTouch = 'createTouch' in $window.document && isNative;
      if (!defaults.lang) defaults.lang = $dateFormatter.getDefaultLocale();
      function DatepickerFactory(element, controller, config) {
        var $datepicker = $tooltip(element, angular.extend({}, defaults, config));
        var parentScope = config.scope;
        var options = $datepicker.$options;
        var scope = $datepicker.$scope;
        if (options.startView) options.startView -= options.minView;
        var pickerViews = datepickerViews($datepicker);
        $datepicker.$views = pickerViews.views;
        var viewDate = pickerViews.viewDate;
        scope.$mode = options.startView;
        scope.$iconLeft = options.iconLeft;
        scope.$iconRight = options.iconRight;
        var $picker = $datepicker.$views[scope.$mode];
        scope.$select = function(date) {
          $datepicker.select(date);
        };
        scope.$selectPane = function(value) {
          $datepicker.$selectPane(value);
        };
        scope.$toggleMode = function() {
          $datepicker.setMode((scope.$mode + 1) % $datepicker.$views.length);
        };
        $datepicker.update = function(date) {
          if (angular.isDate(date) && !isNaN(date.getTime())) {
            $datepicker.$date = date;
            $picker.update.call($picker, date);
          }
          $datepicker.$build(true);
        };
        $datepicker.updateDisabledDates = function(dateRanges) {
          options.disabledDateRanges = dateRanges;
          for (var i = 0, l = scope.rows.length; i < l; i++) {
            angular.forEach(scope.rows[i], $datepicker.$setDisabledEl);
          }
        };
        $datepicker.select = function(date, keep) {
          if (!angular.isDate(controller.$dateValue)) controller.$dateValue = new Date(date);
          if (!scope.$mode || keep) {
            controller.$setViewValue(angular.copy(date));
            controller.$render();
            if (options.autoclose && !keep) {
              $timeout(function() {
                $datepicker.hide(true);
              });
            }
          } else {
            angular.extend(viewDate, {
              year: date.getFullYear(),
              month: date.getMonth(),
              date: date.getDate()
            });
            $datepicker.setMode(scope.$mode - 1);
            $datepicker.$build();
          }
        };
        $datepicker.setMode = function(mode) {
          scope.$mode = mode;
          $picker = $datepicker.$views[scope.$mode];
          $datepicker.$build();
        };
        $datepicker.$build = function(pristine) {
          if (pristine === true && $picker.built) return;
          if (pristine === false && !$picker.built) return;
          $picker.build.call($picker);
        };
        $datepicker.$updateSelected = function() {
          for (var i = 0, l = scope.rows.length; i < l; i++) {
            angular.forEach(scope.rows[i], updateSelected);
          }
        };
        $datepicker.$isSelected = function(date) {
          return $picker.isSelected(date);
        };
        $datepicker.$setDisabledEl = function(el) {
          el.disabled = $picker.isDisabled(el.date);
        };
        $datepicker.$selectPane = function(value) {
          var steps = $picker.steps;
          var targetDate = new Date(Date.UTC(viewDate.year + (steps.year || 0) * value, viewDate.month + (steps.month || 0) * value, 1));
          angular.extend(viewDate, {
            year: targetDate.getUTCFullYear(),
            month: targetDate.getUTCMonth(),
            date: targetDate.getUTCDate()
          });
          $datepicker.$build();
        };
        $datepicker.$onMouseDown = function(evt) {
          evt.preventDefault();
          evt.stopPropagation();
          if (isTouch) {
            var targetEl = angular.element(evt.target);
            if (targetEl[0].nodeName.toLowerCase() !== 'button') {
              targetEl = targetEl.parent();
            }
            targetEl.triggerHandler('click');
          }
        };
        $datepicker.$onKeyDown = function(evt) {
          if (!/(38|37|39|40|13)/.test(evt.keyCode) || evt.shiftKey || evt.altKey) return;
          evt.preventDefault();
          evt.stopPropagation();
          if (evt.keyCode === 13) {
            if (!scope.$mode) {
              $datepicker.hide(true);
            } else {
              scope.$apply(function() {
                $datepicker.setMode(scope.$mode - 1);
              });
            }
            return;
          }
          $picker.onKeyDown(evt);
          parentScope.$digest();
        };
        function updateSelected(el) {
          el.selected = $datepicker.$isSelected(el.date);
        }
        function focusElement() {
          element[0].focus();
        }
        var _init = $datepicker.init;
        $datepicker.init = function() {
          if (isNative && options.useNative) {
            element.prop('type', 'date');
            element.css('-webkit-appearance', 'textfield');
            return;
          } else if (isTouch) {
            element.prop('type', 'text');
            element.attr('readonly', 'true');
            element.on('click', focusElement);
          }
          _init();
        };
        var _destroy = $datepicker.destroy;
        $datepicker.destroy = function() {
          if (isNative && options.useNative) {
            element.off('click', focusElement);
          }
          _destroy();
        };
        var _show = $datepicker.show;
        $datepicker.show = function() {
          if (!isTouch && element.attr('readonly') || element.attr('disabled')) return;
          _show();
          $timeout(function() {
            if (!$datepicker.$isShown) return;
            $datepicker.$element.on(isTouch ? 'touchstart' : 'mousedown', $datepicker.$onMouseDown);
            if (options.keyboard) {
              element.on('keydown', $datepicker.$onKeyDown);
            }
          }, 0, false);
        };
        var _hide = $datepicker.hide;
        $datepicker.hide = function(blur) {
          if (!$datepicker.$isShown) return;
          $datepicker.$element.off(isTouch ? 'touchstart' : 'mousedown', $datepicker.$onMouseDown);
          if (options.keyboard) {
            element.off('keydown', $datepicker.$onKeyDown);
          }
          _hide(blur);
        };
        return $datepicker;
      }
      DatepickerFactory.defaults = defaults;
      return DatepickerFactory;
    } ];
  }).directive('bsDatepicker', [ '$window', '$parse', '$q', '$dateFormatter', '$dateParser', '$datepicker', function($window, $parse, $q, $dateFormatter, $dateParser, $datepicker) {
    var defaults = $datepicker.defaults;
    var isNative = /(ip(a|o)d|iphone|android)/gi.test($window.navigator.userAgent);
    return {
      restrict: 'EAC',
      require: 'ngModel',
      link: function postLink(scope, element, attr, controller) {
        var options = {
          scope: scope
        };
        angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'placement', 'container', 'delay', 'trigger', 'html', 'animation', 'autoclose', 'dateType', 'dateFormat', 'timezone', 'modelDateFormat', 'dayFormat', 'strictFormat', 'startWeek', 'startDate', 'useNative', 'lang', 'startView', 'minView', 'iconLeft', 'iconRight', 'daysOfWeekDisabled', 'id', 'prefixClass', 'prefixEvent' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var falseValueRegExp = /^(false|0|)$/i;
        angular.forEach([ 'html', 'container', 'autoclose', 'useNative' ], function(key) {
          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) {
            options[key] = false;
          }
        });
        var datepicker = $datepicker(element, controller, options);
        options = datepicker.$options;
        if (isNative && options.useNative) options.dateFormat = 'yyyy-MM-dd';
        var lang = options.lang;
        var formatDate = function(date, format) {
          return $dateFormatter.formatDate(date, format, lang);
        };
        var dateParser = $dateParser({
          format: options.dateFormat,
          lang: lang,
          strict: options.strictFormat
        });
        attr.bsShow && scope.$watch(attr.bsShow, function(newValue, oldValue) {
          if (!datepicker || !angular.isDefined(newValue)) return;
          if (angular.isString(newValue)) newValue = !!newValue.match(/true|,?(datepicker),?/i);
          newValue === true ? datepicker.show() : datepicker.hide();
        });
        angular.forEach([ 'minDate', 'maxDate' ], function(key) {
          angular.isDefined(attr[key]) && attr.$observe(key, function(newValue) {
            datepicker.$options[key] = dateParser.getDateForAttribute(key, newValue);
            !isNaN(datepicker.$options[key]) && datepicker.$build(false);
            validateAgainstMinMaxDate(controller.$dateValue);
          });
        });
        angular.isDefined(attr.dateFormat) && attr.$observe('dateFormat', function(newValue) {
          datepicker.$options.dateFormat = newValue;
        });
        scope.$watch(attr.ngModel, function(newValue, oldValue) {
          datepicker.update(controller.$dateValue);
        }, true);
        function normalizeDateRanges(ranges) {
          if (!ranges || !ranges.length) return null;
          return ranges;
        }
        if (angular.isDefined(attr.disabledDates)) {
          scope.$watch(attr.disabledDates, function(disabledRanges, previousValue) {
            disabledRanges = normalizeDateRanges(disabledRanges);
            previousValue = normalizeDateRanges(previousValue);
            if (disabledRanges) {
              datepicker.updateDisabledDates(disabledRanges);
            }
          });
        }
        function validateAgainstMinMaxDate(parsedDate) {
          if (!angular.isDate(parsedDate)) return;
          var isMinValid = isNaN(datepicker.$options.minDate) || parsedDate.getTime() >= datepicker.$options.minDate;
          var isMaxValid = isNaN(datepicker.$options.maxDate) || parsedDate.getTime() <= datepicker.$options.maxDate;
          var isValid = isMinValid && isMaxValid;
          controller.$setValidity('date', isValid);
          controller.$setValidity('min', isMinValid);
          controller.$setValidity('max', isMaxValid);
          if (isValid) controller.$dateValue = parsedDate;
        }
        controller.$parsers.unshift(function(viewValue) {
          var date;
          if (!viewValue) {
            controller.$setValidity('date', true);
            return null;
          }
          var parsedDate = dateParser.parse(viewValue, controller.$dateValue);
          if (!parsedDate || isNaN(parsedDate.getTime())) {
            controller.$setValidity('date', false);
            return;
          } else {
            validateAgainstMinMaxDate(parsedDate);
          }
          if (options.dateType === 'string') {
            date = dateParser.timezoneOffsetAdjust(parsedDate, options.timezone, true);
            return formatDate(date, options.modelDateFormat || options.dateFormat);
          }
          date = dateParser.timezoneOffsetAdjust(controller.$dateValue, options.timezone, true);
          if (options.dateType === 'number') {
            return date.getTime();
          } else if (options.dateType === 'unix') {
            return date.getTime() / 1e3;
          } else if (options.dateType === 'iso') {
            return date.toISOString();
          } else {
            return new Date(date);
          }
        });
        controller.$formatters.push(function(modelValue) {
          var date;
          if (angular.isUndefined(modelValue) || modelValue === null) {
            date = NaN;
          } else if (angular.isDate(modelValue)) {
            date = modelValue;
          } else if (options.dateType === 'string') {
            date = dateParser.parse(modelValue, null, options.modelDateFormat);
          } else if (options.dateType === 'unix') {
            date = new Date(modelValue * 1e3);
          } else {
            date = new Date(modelValue);
          }
          controller.$dateValue = dateParser.timezoneOffsetAdjust(date, options.timezone);
          return getDateFormattedString();
        });
        controller.$render = function() {
          element.val(getDateFormattedString());
        };
        function getDateFormattedString() {
          return !controller.$dateValue || isNaN(controller.$dateValue.getTime()) ? '' : formatDate(controller.$dateValue, options.dateFormat);
        }
        scope.$on('$destroy', function() {
          if (datepicker) datepicker.destroy();
          options = null;
          datepicker = null;
        });
      }
    };
  } ]).provider('datepickerViews', function() {
    var defaults = this.defaults = {
      dayFormat: 'dd',
      daySplit: 7
    };
    function split(arr, size) {
      var arrays = [];
      while (arr.length > 0) {
        arrays.push(arr.splice(0, size));
      }
      return arrays;
    }
    function mod(n, m) {
      return (n % m + m) % m;
    }
    this.$get = [ '$dateFormatter', '$dateParser', '$sce', function($dateFormatter, $dateParser, $sce) {
      return function(picker) {
        var scope = picker.$scope;
        var options = picker.$options;
        var lang = options.lang;
        var formatDate = function(date, format) {
          return $dateFormatter.formatDate(date, format, lang);
        };
        var dateParser = $dateParser({
          format: options.dateFormat,
          lang: lang,
          strict: options.strictFormat
        });
        var weekDaysMin = $dateFormatter.weekdaysShort(lang);
        var weekDaysLabels = weekDaysMin.slice(options.startWeek).concat(weekDaysMin.slice(0, options.startWeek));
        var weekDaysLabelsHtml = $sce.trustAsHtml('<th class="dow text-center">' + weekDaysLabels.join('</th><th class="dow text-center">') + '</th>');
        var startDate = picker.$date || (options.startDate ? dateParser.getDateForAttribute('startDate', options.startDate) : new Date());
        var viewDate = {
          year: startDate.getFullYear(),
          month: startDate.getMonth(),
          date: startDate.getDate()
        };
        var views = [ {
          format: options.dayFormat,
          split: 7,
          steps: {
            month: 1
          },
          update: function(date, force) {
            if (!this.built || force || date.getFullYear() !== viewDate.year || date.getMonth() !== viewDate.month) {
              angular.extend(viewDate, {
                year: picker.$date.getFullYear(),
                month: picker.$date.getMonth(),
                date: picker.$date.getDate()
              });
              picker.$build();
            } else if (date.getDate() !== viewDate.date || date.getDate() === 1) {
              viewDate.date = picker.$date.getDate();
              picker.$updateSelected();
            }
          },
          build: function() {
            var firstDayOfMonth = new Date(viewDate.year, viewDate.month, 1), firstDayOfMonthOffset = firstDayOfMonth.getTimezoneOffset();
            var firstDate = new Date(+firstDayOfMonth - mod(firstDayOfMonth.getDay() - options.startWeek, 7) * 864e5), firstDateOffset = firstDate.getTimezoneOffset();
            var today = dateParser.timezoneOffsetAdjust(new Date(), options.timezone).toDateString();
            if (firstDateOffset !== firstDayOfMonthOffset) firstDate = new Date(+firstDate + (firstDateOffset - firstDayOfMonthOffset) * 6e4);
            var days = [], day;
            for (var i = 0; i < 42; i++) {
              day = dateParser.daylightSavingAdjust(new Date(firstDate.getFullYear(), firstDate.getMonth(), firstDate.getDate() + i));
              days.push({
                date: day,
                isToday: day.toDateString() === today,
                label: formatDate(day, this.format),
                selected: picker.$date && this.isSelected(day),
                muted: day.getMonth() !== viewDate.month,
                disabled: this.isDisabled(day)
              });
            }
            scope.title = formatDate(firstDayOfMonth, options.monthTitleFormat);
            scope.showLabels = true;
            scope.labels = weekDaysLabelsHtml;
            scope.rows = split(days, this.split);
            this.built = true;
          },
          isSelected: function(date) {
            return picker.$date && date.getFullYear() === picker.$date.getFullYear() && date.getMonth() === picker.$date.getMonth() && date.getDate() === picker.$date.getDate();
          },
          isDisabled: function(date) {
            var time = date.getTime();
            if (time < options.minDate || time > options.maxDate) return true;
            if (options.daysOfWeekDisabled.indexOf(date.getDay()) !== -1) return true;
            if (options.disabledDateRanges) {
              for (var i = 0; i < options.disabledDateRanges.length; i++) {
                if (time >= options.disabledDateRanges[i].start && time <= options.disabledDateRanges[i].end) {
                  return true;
                }
              }
            }
            return false;
          },
          onKeyDown: function(evt) {
            if (!picker.$date) {
              return;
            }
            var actualTime = picker.$date.getTime();
            var newDate;
            if (evt.keyCode === 37) newDate = new Date(actualTime - 1 * 864e5); else if (evt.keyCode === 38) newDate = new Date(actualTime - 7 * 864e5); else if (evt.keyCode === 39) newDate = new Date(actualTime + 1 * 864e5); else if (evt.keyCode === 40) newDate = new Date(actualTime + 7 * 864e5);
            if (!this.isDisabled(newDate)) picker.select(newDate, true);
          }
        }, {
          name: 'month',
          format: options.monthFormat,
          split: 4,
          steps: {
            year: 1
          },
          update: function(date, force) {
            if (!this.built || date.getFullYear() !== viewDate.year) {
              angular.extend(viewDate, {
                year: picker.$date.getFullYear(),
                month: picker.$date.getMonth(),
                date: picker.$date.getDate()
              });
              picker.$build();
            } else if (date.getMonth() !== viewDate.month) {
              angular.extend(viewDate, {
                month: picker.$date.getMonth(),
                date: picker.$date.getDate()
              });
              picker.$updateSelected();
            }
          },
          build: function() {
            var firstMonth = new Date(viewDate.year, 0, 1);
            var months = [], month;
            for (var i = 0; i < 12; i++) {
              month = new Date(viewDate.year, i, 1);
              months.push({
                date: month,
                label: formatDate(month, this.format),
                selected: picker.$isSelected(month),
                disabled: this.isDisabled(month)
              });
            }
            scope.title = formatDate(month, options.yearTitleFormat);
            scope.showLabels = false;
            scope.rows = split(months, this.split);
            this.built = true;
          },
          isSelected: function(date) {
            return picker.$date && date.getFullYear() === picker.$date.getFullYear() && date.getMonth() === picker.$date.getMonth();
          },
          isDisabled: function(date) {
            var lastDate = +new Date(date.getFullYear(), date.getMonth() + 1, 0);
            return lastDate < options.minDate || date.getTime() > options.maxDate;
          },
          onKeyDown: function(evt) {
            if (!picker.$date) {
              return;
            }
            var actualMonth = picker.$date.getMonth();
            var newDate = new Date(picker.$date);
            if (evt.keyCode === 37) newDate.setMonth(actualMonth - 1); else if (evt.keyCode === 38) newDate.setMonth(actualMonth - 4); else if (evt.keyCode === 39) newDate.setMonth(actualMonth + 1); else if (evt.keyCode === 40) newDate.setMonth(actualMonth + 4);
            if (!this.isDisabled(newDate)) picker.select(newDate, true);
          }
        }, {
          name: 'year',
          format: options.yearFormat,
          split: 4,
          steps: {
            year: 12
          },
          update: function(date, force) {
            if (!this.built || force || parseInt(date.getFullYear() / 20, 10) !== parseInt(viewDate.year / 20, 10)) {
              angular.extend(viewDate, {
                year: picker.$date.getFullYear(),
                month: picker.$date.getMonth(),
                date: picker.$date.getDate()
              });
              picker.$build();
            } else if (date.getFullYear() !== viewDate.year) {
              angular.extend(viewDate, {
                year: picker.$date.getFullYear(),
                month: picker.$date.getMonth(),
                date: picker.$date.getDate()
              });
              picker.$updateSelected();
            }
          },
          build: function() {
            var firstYear = viewDate.year - viewDate.year % (this.split * 3);
            var years = [], year;
            for (var i = 0; i < 12; i++) {
              year = new Date(firstYear + i, 0, 1);
              years.push({
                date: year,
                label: formatDate(year, this.format),
                selected: picker.$isSelected(year),
                disabled: this.isDisabled(year)
              });
            }
            scope.title = years[0].label + '-' + years[years.length - 1].label;
            scope.showLabels = false;
            scope.rows = split(years, this.split);
            this.built = true;
          },
          isSelected: function(date) {
            return picker.$date && date.getFullYear() === picker.$date.getFullYear();
          },
          isDisabled: function(date) {
            var lastDate = +new Date(date.getFullYear() + 1, 0, 0);
            return lastDate < options.minDate || date.getTime() > options.maxDate;
          },
          onKeyDown: function(evt) {
            if (!picker.$date) {
              return;
            }
            var actualYear = picker.$date.getFullYear(), newDate = new Date(picker.$date);
            if (evt.keyCode === 37) newDate.setYear(actualYear - 1); else if (evt.keyCode === 38) newDate.setYear(actualYear - 4); else if (evt.keyCode === 39) newDate.setYear(actualYear + 1); else if (evt.keyCode === 40) newDate.setYear(actualYear + 4);
            if (!this.isDisabled(newDate)) picker.select(newDate, true);
          }
        } ];
        return {
          views: options.minView ? Array.prototype.slice.call(views, options.minView) : views,
          viewDate: viewDate
        };
      };
    } ];
  });
  angular.module('mgcrea.ngStrap.collapse', []).provider('$collapse', function() {
    var defaults = this.defaults = {
      animation: 'am-collapse',
      disallowToggle: false,
      activeClass: 'in',
      startCollapsed: false,
      allowMultiple: false
    };
    var controller = this.controller = function($scope, $element, $attrs) {
      var self = this;
      self.$options = angular.copy(defaults);
      angular.forEach([ 'animation', 'disallowToggle', 'activeClass', 'startCollapsed', 'allowMultiple' ], function(key) {
        if (angular.isDefined($attrs[key])) self.$options[key] = $attrs[key];
      });
      var falseValueRegExp = /^(false|0|)$/i;
      angular.forEach([ 'disallowToggle', 'startCollapsed', 'allowMultiple' ], function(key) {
        if (angular.isDefined($attrs[key]) && falseValueRegExp.test($attrs[key])) {
          self.$options[key] = false;
        }
      });
      self.$toggles = [];
      self.$targets = [];
      self.$viewChangeListeners = [];
      self.$registerToggle = function(element) {
        self.$toggles.push(element);
      };
      self.$registerTarget = function(element) {
        self.$targets.push(element);
      };
      self.$unregisterToggle = function(element) {
        var index = self.$toggles.indexOf(element);
        self.$toggles.splice(index, 1);
      };
      self.$unregisterTarget = function(element) {
        var index = self.$targets.indexOf(element);
        self.$targets.splice(index, 1);
        if (self.$options.allowMultiple) {
          deactivateItem(element);
        }
        fixActiveItemIndexes(index);
        self.$viewChangeListeners.forEach(function(fn) {
          fn();
        });
      };
      self.$targets.$active = !self.$options.startCollapsed ? [ 0 ] : [];
      self.$setActive = $scope.$setActive = function(value) {
        if (angular.isArray(value)) {
          self.$targets.$active = value;
        } else if (!self.$options.disallowToggle) {
          isActive(value) ? deactivateItem(value) : activateItem(value);
        } else {
          activateItem(value);
        }
        self.$viewChangeListeners.forEach(function(fn) {
          fn();
        });
      };
      self.$activeIndexes = function() {
        return self.$options.allowMultiple ? self.$targets.$active : self.$targets.$active.length === 1 ? self.$targets.$active[0] : -1;
      };
      function fixActiveItemIndexes(index) {
        var activeIndexes = self.$targets.$active;
        for (var i = 0; i < activeIndexes.length; i++) {
          if (index < activeIndexes[i]) {
            activeIndexes[i] = activeIndexes[i] - 1;
          }
          if (activeIndexes[i] === self.$targets.length) {
            activeIndexes[i] = self.$targets.length - 1;
          }
        }
      }
      function isActive(value) {
        var activeItems = self.$targets.$active;
        return activeItems.indexOf(value) === -1 ? false : true;
      }
      function deactivateItem(value) {
        var index = self.$targets.$active.indexOf(value);
        if (index !== -1) {
          self.$targets.$active.splice(index, 1);
        }
      }
      function activateItem(value) {
        if (!self.$options.allowMultiple) {
          self.$targets.$active.splice(0, 1);
        }
        if (self.$targets.$active.indexOf(value) === -1) {
          self.$targets.$active.push(value);
        }
      }
    };
    this.$get = function() {
      var $collapse = {};
      $collapse.defaults = defaults;
      $collapse.controller = controller;
      return $collapse;
    };
  }).directive('bsCollapse', [ '$window', '$animate', '$collapse', function($window, $animate, $collapse) {
    var defaults = $collapse.defaults;
    return {
      require: [ '?ngModel', 'bsCollapse' ],
      controller: [ '$scope', '$element', '$attrs', $collapse.controller ],
      link: function postLink(scope, element, attrs, controllers) {
        var ngModelCtrl = controllers[0];
        var bsCollapseCtrl = controllers[1];
        if (ngModelCtrl) {
          bsCollapseCtrl.$viewChangeListeners.push(function() {
            ngModelCtrl.$setViewValue(bsCollapseCtrl.$activeIndexes());
          });
          ngModelCtrl.$formatters.push(function(modelValue) {
            if (angular.isArray(modelValue)) {
              bsCollapseCtrl.$setActive(modelValue);
            } else {
              var activeIndexes = bsCollapseCtrl.$activeIndexes();
              if (angular.isArray(activeIndexes)) {
                if (activeIndexes.indexOf(modelValue * 1) === -1) {
                  bsCollapseCtrl.$setActive(modelValue * 1);
                }
              } else if (activeIndexes !== modelValue * 1) {
                bsCollapseCtrl.$setActive(modelValue * 1);
              }
            }
            return modelValue;
          });
        }
      }
    };
  } ]).directive('bsCollapseToggle', function() {
    return {
      require: [ '^?ngModel', '^bsCollapse' ],
      link: function postLink(scope, element, attrs, controllers) {
        var ngModelCtrl = controllers[0];
        var bsCollapseCtrl = controllers[1];
        element.attr('data-toggle', 'collapse');
        bsCollapseCtrl.$registerToggle(element);
        scope.$on('$destroy', function() {
          bsCollapseCtrl.$unregisterToggle(element);
        });
        element.on('click', function() {
          var index = attrs.bsCollapseToggle && attrs.bsCollapseToggle !== 'bs-collapse-toggle' ? attrs.bsCollapseToggle : bsCollapseCtrl.$toggles.indexOf(element);
          bsCollapseCtrl.$setActive(index * 1);
          scope.$apply();
        });
      }
    };
  }).directive('bsCollapseTarget', [ '$animate', function($animate) {
    return {
      require: [ '^?ngModel', '^bsCollapse' ],
      link: function postLink(scope, element, attrs, controllers) {
        var ngModelCtrl = controllers[0];
        var bsCollapseCtrl = controllers[1];
        element.addClass('collapse');
        if (bsCollapseCtrl.$options.animation) {
          element.addClass(bsCollapseCtrl.$options.animation);
        }
        bsCollapseCtrl.$registerTarget(element);
        scope.$on('$destroy', function() {
          bsCollapseCtrl.$unregisterTarget(element);
        });
        function render() {
          var index = bsCollapseCtrl.$targets.indexOf(element);
          var active = bsCollapseCtrl.$activeIndexes();
          var action = 'removeClass';
          if (angular.isArray(active)) {
            if (active.indexOf(index) !== -1) {
              action = 'addClass';
            }
          } else if (index === active) {
            action = 'addClass';
          }
          $animate[action](element, bsCollapseCtrl.$options.activeClass);
        }
        bsCollapseCtrl.$viewChangeListeners.push(function() {
          render();
        });
        render();
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.button', []).provider('$button', function() {
    var defaults = this.defaults = {
      activeClass: 'active',
      toggleEvent: 'click'
    };
    this.$get = function() {
      return {
        defaults: defaults
      };
    };
  }).directive('bsCheckboxGroup', function() {
    return {
      restrict: 'A',
      require: 'ngModel',
      compile: function postLink(element, attr) {
        element.attr('data-toggle', 'buttons');
        element.removeAttr('ng-model');
        var children = element[0].querySelectorAll('input[type="checkbox"]');
        angular.forEach(children, function(child) {
          var childEl = angular.element(child);
          childEl.attr('bs-checkbox', '');
          childEl.attr('ng-model', attr.ngModel + '.' + childEl.attr('value'));
        });
      }
    };
  }).directive('bsCheckbox', [ '$button', '$$rAF', function($button, $$rAF) {
    var defaults = $button.defaults;
    var constantValueRegExp = /^(true|false|\d+)$/;
    return {
      restrict: 'A',
      require: 'ngModel',
      link: function postLink(scope, element, attr, controller) {
        var options = defaults;
        var isInput = element[0].nodeName === 'INPUT';
        var activeElement = isInput ? element.parent() : element;
        var trueValue = angular.isDefined(attr.trueValue) ? attr.trueValue : true;
        if (constantValueRegExp.test(attr.trueValue)) {
          trueValue = scope.$eval(attr.trueValue);
        }
        var falseValue = angular.isDefined(attr.falseValue) ? attr.falseValue : false;
        if (constantValueRegExp.test(attr.falseValue)) {
          falseValue = scope.$eval(attr.falseValue);
        }
        var hasExoticValues = typeof trueValue !== 'boolean' || typeof falseValue !== 'boolean';
        if (hasExoticValues) {
          controller.$parsers.push(function(viewValue) {
            return viewValue ? trueValue : falseValue;
          });
          controller.$formatters.push(function(modelValue) {
            return angular.equals(modelValue, trueValue);
          });
          scope.$watch(attr.ngModel, function(newValue, oldValue) {
            controller.$render();
          });
        }
        controller.$render = function() {
          var isActive = angular.equals(controller.$modelValue, trueValue);
          $$rAF(function() {
            if (isInput) element[0].checked = isActive;
            activeElement.toggleClass(options.activeClass, isActive);
          });
        };
        element.bind(options.toggleEvent, function() {
          scope.$apply(function() {
            if (!isInput) {
              controller.$setViewValue(!activeElement.hasClass('active'));
            }
            if (!hasExoticValues) {
              controller.$render();
            }
          });
        });
      }
    };
  } ]).directive('bsRadioGroup', function() {
    return {
      restrict: 'A',
      require: 'ngModel',
      compile: function postLink(element, attr) {
        element.attr('data-toggle', 'buttons');
        element.removeAttr('ng-model');
        var children = element[0].querySelectorAll('input[type="radio"]');
        angular.forEach(children, function(child) {
          angular.element(child).attr('bs-radio', '');
          angular.element(child).attr('ng-model', attr.ngModel);
        });
      }
    };
  }).directive('bsRadio', [ '$button', '$$rAF', function($button, $$rAF) {
    var defaults = $button.defaults;
    var constantValueRegExp = /^(true|false|\d+)$/;
    return {
      restrict: 'A',
      require: 'ngModel',
      link: function postLink(scope, element, attr, controller) {
        var options = defaults;
        var isInput = element[0].nodeName === 'INPUT';
        var activeElement = isInput ? element.parent() : element;
        var value;
        attr.$observe('value', function(v) {
          value = constantValueRegExp.test(v) ? scope.$eval(v) : v;
          controller.$render();
        });
        controller.$render = function() {
          var isActive = angular.equals(controller.$modelValue, value);
          $$rAF(function() {
            if (isInput) element[0].checked = isActive;
            activeElement.toggleClass(options.activeClass, isActive);
          });
        };
        element.bind(options.toggleEvent, function() {
          scope.$apply(function() {
            controller.$setViewValue(value);
            controller.$render();
          });
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.aside', [ 'mgcrea.ngStrap.modal' ]).provider('$aside', function() {
    var defaults = this.defaults = {
      animation: 'am-fade-and-slide-right',
      prefixClass: 'aside',
      prefixEvent: 'aside',
      placement: 'right',
      templateUrl: 'aside/aside.tpl.html',
      contentTemplate: false,
      container: false,
      element: null,
      backdrop: true,
      keyboard: true,
      html: false,
      show: true
    };
    this.$get = [ '$modal', function($modal) {
      function AsideFactory(config) {
        var $aside = {};
        var options = angular.extend({}, defaults, config);
        $aside = $modal(options);
        return $aside;
      }
      return AsideFactory;
    } ];
  }).directive('bsAside', [ '$window', '$sce', '$aside', function($window, $sce, $aside) {
    var requestAnimationFrame = $window.requestAnimationFrame || $window.setTimeout;
    return {
      restrict: 'EAC',
      scope: true,
      link: function postLink(scope, element, attr, transclusion) {
        var options = {
          scope: scope,
          element: element,
          show: false
        };
        angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'contentTemplate', 'placement', 'backdrop', 'keyboard', 'html', 'container', 'animation' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var falseValueRegExp = /^(false|0|)$/i;
        angular.forEach([ 'backdrop', 'keyboard', 'html', 'container' ], function(key) {
          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;
        });
        angular.forEach([ 'title', 'content' ], function(key) {
          attr[key] && attr.$observe(key, function(newValue, oldValue) {
            scope[key] = $sce.trustAsHtml(newValue);
          });
        });
        attr.bsAside && scope.$watch(attr.bsAside, function(newValue, oldValue) {
          if (angular.isObject(newValue)) {
            angular.extend(scope, newValue);
          } else {
            scope.content = newValue;
          }
        }, true);
        var aside = $aside(options);
        element.on(attr.trigger || 'click', aside.toggle);
        scope.$on('$destroy', function() {
          if (aside) aside.destroy();
          options = null;
          aside = null;
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.alert', [ 'mgcrea.ngStrap.modal' ]).provider('$alert', function() {
    var defaults = this.defaults = {
      animation: 'am-fade',
      prefixClass: 'alert',
      prefixEvent: 'alert',
      placement: null,
      templateUrl: 'alert/alert.tpl.html',
      container: false,
      element: null,
      backdrop: false,
      keyboard: true,
      show: true,
      duration: false,
      type: false,
      dismissable: true
    };
    this.$get = [ '$modal', '$timeout', function($modal, $timeout) {
      function AlertFactory(config) {
        var $alert = {};
        var options = angular.extend({}, defaults, config);
        $alert = $modal(options);
        $alert.$scope.dismissable = !!options.dismissable;
        if (options.type) {
          $alert.$scope.type = options.type;
        }
        var show = $alert.show;
        if (options.duration) {
          $alert.show = function() {
            show();
            $timeout(function() {
              $alert.hide();
            }, options.duration * 1e3);
          };
        }
        return $alert;
      }
      return AlertFactory;
    } ];
  }).directive('bsAlert', [ '$window', '$sce', '$alert', function($window, $sce, $alert) {
    var requestAnimationFrame = $window.requestAnimationFrame || $window.setTimeout;
    return {
      restrict: 'EAC',
      scope: true,
      link: function postLink(scope, element, attr, transclusion) {
        var options = {
          scope: scope,
          element: element,
          show: false
        };
        angular.forEach([ 'template', 'templateUrl', 'controller', 'controllerAs', 'placement', 'keyboard', 'html', 'container', 'animation', 'duration', 'dismissable' ], function(key) {
          if (angular.isDefined(attr[key])) options[key] = attr[key];
        });
        var falseValueRegExp = /^(false|0|)$/i;
        angular.forEach([ 'keyboard', 'html', 'container', 'dismissable' ], function(key) {
          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;
        });
        if (!scope.hasOwnProperty('title')) {
          scope.title = '';
        }
        angular.forEach([ 'title', 'content', 'type' ], function(key) {
          attr[key] && attr.$observe(key, function(newValue, oldValue) {
            scope[key] = $sce.trustAsHtml(newValue);
          });
        });
        attr.bsAlert && scope.$watch(attr.bsAlert, function(newValue, oldValue) {
          if (angular.isObject(newValue)) {
            angular.extend(scope, newValue);
          } else {
            scope.content = newValue;
          }
        }, true);
        var alert = $alert(options);
        element.on(attr.trigger || 'click', alert.toggle);
        scope.$on('$destroy', function() {
          if (alert) alert.destroy();
          options = null;
          alert = null;
        });
      }
    };
  } ]);
  angular.module('mgcrea.ngStrap.affix', [ 'mgcrea.ngStrap.helpers.dimensions', 'mgcrea.ngStrap.helpers.debounce' ]).provider('$affix', function() {
    var defaults = this.defaults = {
      offsetTop: 'auto',
      inlineStyles: true
    };
    this.$get = [ '$window', 'debounce', 'dimensions', function($window, debounce, dimensions) {
      var bodyEl = angular.element($window.document.body);
      var windowEl = angular.element($window);
      function AffixFactory(element, config) {
        var $affix = {};
        var options = angular.extend({}, defaults, config);
        var targetEl = options.target;
        var reset = 'affix affix-top affix-bottom', setWidth = false, initialAffixTop = 0, initialOffsetTop = 0, offsetTop = 0, offsetBottom = 0, affixed = null, unpin = null;
        var parent = element.parent();
        if (options.offsetParent) {
          if (options.offsetParent.match(/^\d+$/)) {
            for (var i = 0; i < options.offsetParent * 1 - 1; i++) {
              parent = parent.parent();
            }
          } else {
            parent = angular.element(options.offsetParent);
          }
        }
        $affix.init = function() {
          this.$parseOffsets();
          initialOffsetTop = dimensions.offset(element[0]).top + initialAffixTop;
          setWidth = !element[0].style.width;
          targetEl.on('scroll', this.checkPosition);
          targetEl.on('click', this.checkPositionWithEventLoop);
          windowEl.on('resize', this.$debouncedOnResize);
          this.checkPosition();
          this.checkPositionWithEventLoop();
        };
        $affix.destroy = function() {
          targetEl.off('scroll', this.checkPosition);
          targetEl.off('click', this.checkPositionWithEventLoop);
          windowEl.off('resize', this.$debouncedOnResize);
        };
        $affix.checkPositionWithEventLoop = function() {
          setTimeout($affix.checkPosition, 1);
        };
        $affix.checkPosition = function() {
          var scrollTop = getScrollTop();
          var position = dimensions.offset(element[0]);
          var elementHeight = dimensions.height(element[0]);
          var affix = getRequiredAffixClass(unpin, position, elementHeight);
          if (affixed === affix) return;
          affixed = affix;
          if (affix === 'top') {
            unpin = null;
            if (setWidth) {
              element.css('width', '');
            }
            if (options.inlineStyles) {
              element.css('position', options.offsetParent ? '' : 'relative');
              element.css('top', '');
            }
          } else if (affix === 'bottom') {
            if (options.offsetUnpin) {
              unpin = -(options.offsetUnpin * 1);
            } else {
              unpin = position.top - scrollTop;
            }
            if (setWidth) {
              element.css('width', '');
            }
            if (options.inlineStyles) {
              element.css('position', options.offsetParent ? '' : 'relative');
              element.css('top', options.offsetParent ? '' : bodyEl[0].offsetHeight - offsetBottom - elementHeight - initialOffsetTop + 'px');
            }
          } else {
            unpin = null;
            if (setWidth) {
              element.css('width', element[0].offsetWidth + 'px');
            }
            if (options.inlineStyles) {
              element.css('position', 'fixed');
              element.css('top', initialAffixTop + 'px');
            }
          }
          element.removeClass(reset).addClass('affix' + (affix !== 'middle' ? '-' + affix : ''));
        };
        $affix.$onResize = function() {
          $affix.$parseOffsets();
          $affix.checkPosition();
        };
        $affix.$debouncedOnResize = debounce($affix.$onResize, 50);
        $affix.$parseOffsets = function() {
          var initialPosition = element.css('position');
          if (options.inlineStyles) {
            element.css('position', options.offsetParent ? '' : 'relative');
          }
          if (options.offsetTop) {
            if (options.offsetTop === 'auto') {
              options.offsetTop = '+0';
            }
            if (options.offsetTop.match(/^[-+]\d+$/)) {
              initialAffixTop = -options.offsetTop * 1;
              if (options.offsetParent) {
                offsetTop = dimensions.offset(parent[0]).top + options.offsetTop * 1;
              } else {
                offsetTop = dimensions.offset(element[0]).top - dimensions.css(element[0], 'marginTop', true) + options.offsetTop * 1;
              }
            } else {
              offsetTop = options.offsetTop * 1;
            }
          }
          if (options.offsetBottom) {
            if (options.offsetParent && options.offsetBottom.match(/^[-+]\d+$/)) {
              offsetBottom = getScrollHeight() - (dimensions.offset(parent[0]).top + dimensions.height(parent[0])) + options.offsetBottom * 1 + 1;
            } else {
              offsetBottom = options.offsetBottom * 1;
            }
          }
          if (options.inlineStyles) {
            element.css('position', initialPosition);
          }
        };
        function getRequiredAffixClass(unpin, position, elementHeight) {
          var scrollTop = getScrollTop();
          var scrollHeight = getScrollHeight();
          if (scrollTop <= offsetTop) {
            return 'top';
          } else if (unpin !== null && scrollTop + unpin <= position.top) {
            return 'middle';
          } else if (offsetBottom !== null && position.top + elementHeight + initialAffixTop >= scrollHeight - offsetBottom) {
            return 'bottom';
          } else {
            return 'middle';
          }
        }
        function getScrollTop() {
          return targetEl[0] === $window ? $window.pageYOffset : targetEl[0].scrollTop;
        }
        function getScrollHeight() {
          return targetEl[0] === $window ? $window.document.body.scrollHeight : targetEl[0].scrollHeight;
        }
        $affix.init();
        return $affix;
      }
      return AffixFactory;
    } ];
  }).directive('bsAffix', [ '$affix', '$window', function($affix, $window) {
    return {
      restrict: 'EAC',
      require: '^?bsAffixTarget',
      link: function postLink(scope, element, attr, affixTarget) {
        var options = {
          scope: scope,
          target: affixTarget ? affixTarget.$element : angular.element($window)
        };
        angular.forEach([ 'offsetTop', 'offsetBottom', 'offsetParent', 'offsetUnpin', 'inlineStyles' ], function(key) {
          if (angular.isDefined(attr[key])) {
            var option = attr[key];
            if (/true/i.test(option)) option = true;
            if (/false/i.test(option)) option = false;
            options[key] = option;
          }
        });
        var affix = $affix(element, options);
        scope.$on('$destroy', function() {
          affix && affix.destroy();
          options = null;
          affix = null;
        });
      }
    };
  } ]).directive('bsAffixTarget', function() {
    return {
      controller: [ '$element', function($element) {
        this.$element = $element;
      } ]
    };
  });
  angular.module('mgcrea.ngStrap', [ 'mgcrea.ngStrap.modal', 'mgcrea.ngStrap.aside', 'mgcrea.ngStrap.alert', 'mgcrea.ngStrap.button', 'mgcrea.ngStrap.select', 'mgcrea.ngStrap.datepicker', 'mgcrea.ngStrap.timepicker', 'mgcrea.ngStrap.navbar', 'mgcrea.ngStrap.tooltip', 'mgcrea.ngStrap.popover', 'mgcrea.ngStrap.dropdown', 'mgcrea.ngStrap.typeahead', 'mgcrea.ngStrap.scrollspy', 'mgcrea.ngStrap.affix', 'mgcrea.ngStrap.tab', 'mgcrea.ngStrap.collapse' ]);
})(window, document);
/**
 * angular-strap
 * @version v2.3.5 - 2015-10-29
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes <olivier@mg-crea.com> (https://github.com/mgcrea)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(window, document, undefined) {
  'use strict';
  angular.module('mgcrea.ngStrap.alert').run([ '$templateCache', function($templateCache) {
    $templateCache.put('alert/alert.tpl.html', '<div class="alert" ng-class="[type ? \'alert-\' + type : null]"><button type="button" class="close" ng-if="dismissable" ng-click="$hide()">&times;</button> <strong ng-bind="title"></strong>&nbsp;<span ng-bind-html="content"></span></div>');
  } ]);
  angular.module('mgcrea.ngStrap.aside').run([ '$templateCache', function($templateCache) {
    $templateCache.put('aside/aside.tpl.html', '<div class="aside" tabindex="-1" role="dialog"><div class="aside-dialog"><div class="aside-content"><div class="aside-header" ng-show="title"><button type="button" class="close" ng-click="$hide()">&times;</button><h4 class="aside-title" ng-bind="title"></h4></div><div class="aside-body" ng-bind="content"></div><div class="aside-footer"><button type="button" class="btn btn-default" ng-click="$hide()">Close</button></div></div></div></div>');
  } ]);
  angular.module('mgcrea.ngStrap.datepicker').run([ '$templateCache', function($templateCache) {
    $templateCache.put('datepicker/datepicker.tpl.html', '<div class="dropdown-menu datepicker" ng-class="\'datepicker-mode-\' + $mode" style="max-width: 320px"><table style="table-layout: fixed; height: 100%; width: 100%"><thead><tr class="text-center"><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$selectPane(-1)"><i class="{{$iconLeft}}"></i></button></th><th colspan="{{ rows[0].length - 2 }}"><button tabindex="-1" type="button" class="btn btn-default btn-block text-strong" ng-click="$toggleMode()"><strong style="text-transform: capitalize" ng-bind="title"></strong></button></th><th><button tabindex="-1" type="button" class="btn btn-default pull-right" ng-click="$selectPane(+1)"><i class="{{$iconRight}}"></i></button></th></tr><tr ng-if="showLabels" ng-bind-html="labels"></tr></thead><tbody><tr ng-repeat="(i, row) in rows" height="{{ 100 / rows.length }}%"><td class="text-center" ng-repeat="(j, el) in row"><button tabindex="-1" type="button" class="btn btn-default" style="width: 100%" ng-class="{\'btn-primary\': el.selected, \'btn-info btn-today\': el.isToday && !el.selected}" ng-click="$select(el.date)" ng-disabled="el.disabled"><span ng-class="{\'text-muted\': el.muted}" ng-bind="el.label"></span></button></td></tr></tbody></table></div>');
  } ]);
  angular.module('mgcrea.ngStrap.dropdown').run([ '$templateCache', function($templateCache) {
    $templateCache.put('dropdown/dropdown.tpl.html', '<ul tabindex="-1" class="dropdown-menu" role="menu" ng-show="content && content.length"><li role="presentation" ng-class="{divider: item.divider}" ng-repeat="item in content"><a role="menuitem" tabindex="-1" ng-href="{{item.href}}" ng-if="!item.divider && item.href" target="{{item.target || \'\'}}" ng-bind="item.text"></a> <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()" ng-bind="item.text"></a></li></ul>');
  } ]);
  angular.module('mgcrea.ngStrap.modal').run([ '$templateCache', function($templateCache) {
    $templateCache.put('modal/modal.tpl.html', '<div class="modal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header" ng-show="title"><button type="button" class="close" aria-label="Close" ng-click="$hide()"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" ng-bind="title"></h4></div><div class="modal-body" ng-bind="content"></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="$hide()">Close</button></div></div></div></div>');
  } ]);
  angular.module('mgcrea.ngStrap.popover').run([ '$templateCache', function($templateCache) {
    $templateCache.put('popover/popover.tpl.html', '<div class="popover" tabindex="-1"><div class="arrow"></div><h3 class="popover-title" ng-bind="title" ng-show="title"></h3><div class="popover-content" ng-bind="content"></div></div>');
  } ]);
  angular.module('mgcrea.ngStrap.select').run([ '$templateCache', function($templateCache) {
    $templateCache.put('select/select.tpl.html', '<ul tabindex="-1" class="select dropdown-menu" ng-show="$isVisible()" role="select"><li ng-if="$showAllNoneButtons"><div class="btn-group" style="margin-bottom: 5px; margin-left: 5px"><button type="button" class="btn btn-default btn-xs" ng-click="$selectAll()">{{$allText}}</button> <button type="button" class="btn btn-default btn-xs" ng-click="$selectNone()">{{$noneText}}</button></div></li><li role="presentation" ng-repeat="match in $matches" ng-class="{active: $isActive($index)}"><a style="cursor: default" role="menuitem" tabindex="-1" ng-click="$select($index, $event)"><i class="{{$iconCheckmark}} pull-right" ng-if="$isMultiple && $isActive($index)"></i> <span ng-bind="match.label"></span></a></li></ul>');
  } ]);
  angular.module('mgcrea.ngStrap.tab').run([ '$templateCache', function($templateCache) {
    $templateCache.put('tab/tab.tpl.html', '<ul class="nav" ng-class="$navClass" role="tablist"><li role="presentation" ng-repeat="$pane in $panes track by $index" ng-class="[ $isActive($pane, $index) ? $activeClass : \'\', $pane.disabled ? \'disabled\' : \'\' ]"><a role="tab" data-toggle="tab" ng-click="!$pane.disabled && $setActive($pane.name || $index)" data-index="{{ $index }}" ng-bind-html="$pane.title" aria-controls="$pane.title"></a></li></ul><div ng-transclude class="tab-content"></div>');
  } ]);
  angular.module('mgcrea.ngStrap.timepicker').run([ '$templateCache', function($templateCache) {
    $templateCache.put('timepicker/timepicker.tpl.html', '<div class="dropdown-menu timepicker" style="min-width: 0px;width: auto"><table height="100%"><thead><tr class="text-center"><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 0)"><i class="{{ $iconUp }}"></i></button></th><th>&nbsp;</th><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 1)"><i class="{{ $iconUp }}"></i></button></th><th>&nbsp;</th><th><button ng-if="showSeconds" tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 2)"><i class="{{ $iconUp }}"></i></button></th></tr></thead><tbody><tr ng-repeat="(i, row) in rows"><td class="text-center"><button tabindex="-1" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[0].selected}" ng-click="$select(row[0].date, 0)" ng-disabled="row[0].disabled"><span ng-class="{\'text-muted\': row[0].muted}" ng-bind="row[0].label"></span></button></td><td><span ng-bind="i == midIndex ? timeSeparator : \' \'"></span></td><td class="text-center"><button tabindex="-1" ng-if="row[1].date" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[1].selected}" ng-click="$select(row[1].date, 1)" ng-disabled="row[1].disabled"><span ng-class="{\'text-muted\': row[1].muted}" ng-bind="row[1].label"></span></button></td><td><span ng-bind="i == midIndex ? timeSeparator : \' \'"></span></td><td class="text-center"><button tabindex="-1" ng-if="showSeconds && row[2].date" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[2].selected}" ng-click="$select(row[2].date, 2)" ng-disabled="row[2].disabled"><span ng-class="{\'text-muted\': row[2].muted}" ng-bind="row[2].label"></span></button></td><td ng-if="showAM">&nbsp;</td><td ng-if="showAM"><button tabindex="-1" ng-show="i == midIndex - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !!isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">AM</button> <button tabindex="-1" ng-show="i == midIndex + 1 - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">PM</button></td></tr></tbody><tfoot><tr class="text-center"><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 0)"><i class="{{ $iconDown }}"></i></button></th><th>&nbsp;</th><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 1)"><i class="{{ $iconDown }}"></i></button></th><th>&nbsp;</th><th><button ng-if="showSeconds" tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 2)"><i class="{{ $iconDown }}"></i></button></th></tr></tfoot></table></div>');
  } ]);
  angular.module('mgcrea.ngStrap.tooltip').run([ '$templateCache', function($templateCache) {
    $templateCache.put('tooltip/tooltip.tpl.html', '<div class="tooltip in" ng-show="title"><div class="tooltip-arrow"></div><div class="tooltip-inner" ng-bind="title"></div></div>');
  } ]);
  angular.module('mgcrea.ngStrap.typeahead').run([ '$templateCache', function($templateCache) {
    $templateCache.put('typeahead/typeahead.tpl.html', '<ul tabindex="-1" class="typeahead dropdown-menu" ng-show="$isVisible()" role="select"><li role="presentation" ng-repeat="match in $matches" ng-class="{active: $index == $activeIndex}"><a role="menuitem" tabindex="-1" ng-click="$select($index, $event)" ng-bind="match.label"></a></li></ul>');
  } ]);
})(window, document);
/*
 AngularJS v1.4.7
 (c) 2010-2015 Google, Inc. http://angularjs.org
 License: MIT
*/
(function(n,h,p){'use strict';function E(a){var f=[];r(f,h.noop).chars(a);return f.join("")}function g(a,f){var d={},c=a.split(","),b;for(b=0;b<c.length;b++)d[f?h.lowercase(c[b]):c[b]]=!0;return d}function F(a,f){function d(a,b,d,l){b=h.lowercase(b);if(s[b])for(;e.last()&&t[e.last()];)c("",e.last());u[b]&&e.last()==b&&c("",b);(l=v[b]||!!l)||e.push(b);var m={};d.replace(G,function(b,a,f,c,d){m[a]=q(f||c||d||"")});f.start&&f.start(b,m,l)}function c(b,a){var c=0,d;if(a=h.lowercase(a))for(c=e.length-
1;0<=c&&e[c]!=a;c--);if(0<=c){for(d=e.length-1;d>=c;d--)f.end&&f.end(e[d]);e.length=c}}"string"!==typeof a&&(a=null===a||"undefined"===typeof a?"":""+a);var b,k,e=[],m=a,l;for(e.last=function(){return e[e.length-1]};a;){l="";k=!0;if(e.last()&&w[e.last()])a=a.replace(new RegExp("([\\W\\w]*)<\\s*\\/\\s*"+e.last()+"[^>]*>","i"),function(a,b){b=b.replace(H,"$1").replace(I,"$1");f.chars&&f.chars(q(b));return""}),c("",e.last());else{if(0===a.indexOf("\x3c!--"))b=a.indexOf("--",4),0<=b&&a.lastIndexOf("--\x3e",
b)===b&&(f.comment&&f.comment(a.substring(4,b)),a=a.substring(b+3),k=!1);else if(x.test(a)){if(b=a.match(x))a=a.replace(b[0],""),k=!1}else if(J.test(a)){if(b=a.match(y))a=a.substring(b[0].length),b[0].replace(y,c),k=!1}else K.test(a)&&((b=a.match(z))?(b[4]&&(a=a.substring(b[0].length),b[0].replace(z,d)),k=!1):(l+="<",a=a.substring(1)));k&&(b=a.indexOf("<"),l+=0>b?a:a.substring(0,b),a=0>b?"":a.substring(b),f.chars&&f.chars(q(l)))}if(a==m)throw L("badparse",a);m=a}c()}function q(a){if(!a)return"";A.innerHTML=
a.replace(/</g,"&lt;");return A.textContent}function B(a){return a.replace(/&/g,"&amp;").replace(M,function(a){var d=a.charCodeAt(0);a=a.charCodeAt(1);return"&#"+(1024*(d-55296)+(a-56320)+65536)+";"}).replace(N,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(a,f){var d=!1,c=h.bind(a,a.push);return{start:function(a,k,e){a=h.lowercase(a);!d&&w[a]&&(d=a);d||!0!==C[a]||(c("<"),c(a),h.forEach(k,function(d,e){var k=h.lowercase(e),g="img"===a&&"src"===k||
"background"===k;!0!==O[k]||!0===D[k]&&!f(d,g)||(c(" "),c(e),c('="'),c(B(d)),c('"'))}),c(e?"/>":">"))},end:function(a){a=h.lowercase(a);d||!0!==C[a]||(c("</"),c(a),c(">"));a==d&&(d=!1)},chars:function(a){d||c(B(a))}}}var L=h.$$minErr("$sanitize"),z=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,y=/^<\/\s*([\w:-]+)[^>]*>/,G=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,K=/^</,J=/^<\//,H=/\x3c!--(.*?)--\x3e/g,x=/<!DOCTYPE([^>]*?)>/i,
I=/<!\[CDATA\[(.*?)]]\x3e/g,M=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,N=/([^\#-~| |!])/g,v=g("area,br,col,hr,img,wbr");n=g("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr");p=g("rp,rt");var u=h.extend({},p,n),s=h.extend({},n,g("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),t=h.extend({},p,g("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var"));
n=g("circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,stop,svg,switch,text,title,tspan,use");var w=g("script,style"),C=h.extend({},v,s,t,u,n),D=g("background,cite,href,longdesc,src,usemap,xlink:href");n=g("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,tabindex,target,title,type,valign,value,vspace,width");
p=g("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan",
!0);var O=h.extend({},D,p,n),A=document.createElement("pre");h.module("ngSanitize",[]).provider("$sanitize",function(){this.$get=["$$sanitizeUri",function(a){return function(f){var d=[];F(f,r(d,function(c,b){return!/^unsafe/.test(a(c,b))}));return d.join("")}}]});h.module("ngSanitize").filter("linky",["$sanitize",function(a){var f=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,d=/^mailto:/i;return function(c,b){function k(a){a&&g.push(E(a))}function e(a,
c){g.push("<a ");h.isDefined(b)&&g.push('target="',b,'" ');g.push('href="',a.replace(/"/g,"&quot;"),'">');k(c);g.push("</a>")}if(!c)return c;for(var m,l=c,g=[],n,p;m=l.match(f);)n=m[0],m[2]||m[4]||(n=(m[3]?"http://":"mailto:")+n),p=m.index,k(l.substr(0,p)),e(n,m[0].replace(d,"")),l=l.substring(p+m[0].length);k(l);return a(g.join(""))}}])})(window,window.angular);
//# sourceMappingURL=angular-sanitize.min.js.map

/*! ngTable v0.4.3 by Vitalii Savchuk(esvit666@gmail.com) - https://github.com/esvit/ng-table - New BSD License */

!function(a,b){"use strict";return"function"==typeof define&&define.amd?void define(["angular"],function(a){return b(a)}):b(a)}(angular||null,function(a){"use strict";var b=a.module("ngTable",[]);b.value("ngTableDefaults",{params:{},settings:{}}),b.factory("ngTableParams",["$q","$log","ngTableDefaults",function(b,c,d){var e=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},f=function(f,g){var h=this,i=function(){k.debugMode&&c.debug&&c.debug.apply(this,arguments)};this.data=[],this.parameters=function(b,c){if(c=c||!1,a.isDefined(b)){for(var d in b){var f=b[d];if(c&&d.indexOf("[")>=0){for(var g=d.split(/\[(.*)\]/).reverse(),h="",k=0,l=g.length;l>k;k++){var m=g[k];if(""!==m){var n=f;f={},f[h=m]=e(n)?parseFloat(n):n}}"sorting"===h&&(j[h]={}),j[h]=a.extend(j[h]||{},f[h])}else j[d]=e(b[d])?parseFloat(b[d]):b[d]}return i("ngTable: set parameters",j),this}return j},this.settings=function(b){return a.isDefined(b)?(a.isArray(b.data)&&(b.total=b.data.length),k=a.extend(k,b),i("ngTable: set settings",k),this):k},this.page=function(b){return a.isDefined(b)?this.parameters({page:b}):j.page},this.total=function(b){return a.isDefined(b)?this.settings({total:b}):k.total},this.count=function(b){return a.isDefined(b)?this.parameters({count:b,page:1}):j.count},this.filter=function(b){return a.isDefined(b)?this.parameters({filter:b,page:1}):j.filter},this.sorting=function(b){if(2==arguments.length){var c={};return c[b]=arguments[1],this.parameters({sorting:c}),this}return a.isDefined(b)?this.parameters({sorting:b}):j.sorting},this.isSortBy=function(b,c){return a.isDefined(j.sorting[b])&&a.equals(j.sorting[b],c)},this.orderBy=function(){var a=[];for(var b in j.sorting)a.push(("asc"===j.sorting[b]?"+":"-")+b);return a},this.getData=function(b,c){return b.resolve(a.isArray(this.data)&&a.isObject(c)?this.data.slice((c.page()-1)*c.count(),c.page()*c.count()):[]),b.promise},this.getGroups=function(c,d){var e=b.defer();return e.promise.then(function(b){var e={};a.forEach(b,function(b){var c=a.isFunction(d)?d(b):b[d];e[c]=e[c]||{data:[]},e[c].value=c,e[c].data.push(b)});var f=[];for(var g in e)f.push(e[g]);i("ngTable: refresh groups",f),c.resolve(f)}),this.getData(e,h)},this.generatePagesArray=function(a,b,c){var d,e,f,g,h,i;if(d=11,i=[],h=Math.ceil(b/c),h>1){i.push({type:"prev",number:Math.max(1,a-1),active:a>1}),i.push({type:"first",number:1,active:a>1,current:1===a}),f=Math.round((d-5)/2),g=Math.max(2,a-f),e=Math.min(h-1,a+2*f-(a-g)),g=Math.max(2,g-(2*f-(e-g)));for(var j=g;e>=j;)i.push(j===g&&2!==j||j===e&&j!==h-1?{type:"more",active:!1}:{type:"page",number:j,active:a!==j,current:a===j}),j++;i.push({type:"last",number:h,active:a!==h,current:a===h}),i.push({type:"next",number:Math.min(h,a+1),active:h>a})}return i},this.url=function(b){b=b||!1;var c=b?[]:{};for(var d in j)if(j.hasOwnProperty(d)){var e=j[d],f=encodeURIComponent(d);if("object"==typeof e){for(var g in e)if(!a.isUndefined(e[g])&&""!==e[g]){var h=f+"["+encodeURIComponent(g)+"]";b?c.push(h+"="+e[g]):c[h]=e[g]}}else a.isFunction(e)||a.isUndefined(e)||""===e||(b?c.push(f+"="+encodeURIComponent(e)):c[f]=encodeURIComponent(e))}return c},this.reload=function(){var a=b.defer(),c=this,d=null;if(k.$scope)return k.$loading=!0,d=k.groupBy?k.getGroups(a,k.groupBy,this):k.getData(a,this),i("ngTable: reload data"),d||(d=a.promise),d.then(function(a){return k.$loading=!1,i("ngTable: current scope",k.$scope),k.groupBy?(c.data=a,k.$scope&&(k.$scope.$groups=a)):(c.data=a,k.$scope&&(k.$scope.$data=a)),k.$scope&&(k.$scope.pages=c.generatePagesArray(c.page(),c.total(),c.count())),k.$scope.$emit("ngTableAfterReloadData"),a})},this.reloadPages=function(){var a=this;k.$scope.pages=a.generatePagesArray(a.page(),a.total(),a.count())};var j=this.$params={page:1,count:1,filter:{},sorting:{},group:{},groupBy:null};a.extend(j,d.params);var k={$scope:null,$loading:!1,data:null,total:0,defaultSort:"desc",filterDelay:750,counts:[10,25,50,100],getGroups:this.getGroups,getData:this.getData};return a.extend(k,d.settings),this.settings(g),this.parameters(f,!0),this};return f}]);var c=["$scope","ngTableParams","$timeout",function(b,c,d){function e(){b.params.$params.page=1}var f=!0;b.$loading=!1,b.hasOwnProperty("params")||(b.params=new c,b.params.isNullInstance=!0),b.params.settings().$scope=b;var g=function(){var a=0;return function(b,c){d.cancel(a),a=d(b,c)}}();b.$watch("params.$params",function(c,d){if(c!==d){if(b.params.settings().$scope=b,a.equals(c.filter,d.filter))b.params.reload();else{var h=f?a.noop:e;g(function(){h(),b.params.reload()},b.params.settings().filterDelay)}b.params.isNullInstance||(f=!1)}},!0),b.sortBy=function(a,c){var d=b.parse(a.sortable);if(d){var e=b.params.settings().defaultSort,f="asc"===e?"desc":"asc",g=b.params.sorting()&&b.params.sorting()[d]&&b.params.sorting()[d]===e,h=c.ctrlKey||c.metaKey?b.params.sorting():{};h[d]=g?f:e,b.params.parameters({sorting:h})}}}];return b.directive("ngTable",["$compile","$q","$parse",function(b,d,e){return{restrict:"A",priority:1001,scope:!0,controller:c,compile:function(c){var d=[],f=0,g=null,h=c.find("thead");return a.forEach(a.element(c.find("tr")),function(b){b=a.element(b),b.hasClass("ng-table-group")||g||(g=b)}),g?(a.forEach(g.find("td"),function(b){var c=a.element(b);if(!c.attr("ignore-cell")||"true"!==c.attr("ignore-cell")){var g=function(a,b){return function(f){return e(c.attr("x-data-"+a)||c.attr("data-"+a)||c.attr(a))(f,{$columns:d})||b}},h=g("title"," "),i=g("header",!1),j=g("filter",!1)(),k=!1,l=!1;j&&j.$$name&&(l=j.$$name,delete j.$$name),j&&j.templateURL&&(k=j.templateURL,delete j.templateURL),c.attr("data-title-text",h()),d.push({id:f++,title:h,sortable:g("sortable",!1),"class":c.attr("x-data-header-class")||c.attr("data-header-class")||c.attr("header-class"),filter:j,filterTemplateURL:k,filterName:l,headerTemplateURL:i,filterData:c.attr("filter-data")?c.attr("filter-data"):null,show:c.attr("ng-show")?function(a){return e(c.attr("ng-show"))(a)}:function(){return!0}})}}),function(c,f,g){if(c.$loading=!1,c.$columns=d,c.$filterRow={},c.$watch(g.ngTable,function(b){a.isUndefined(b)||(c.paramsModel=e(g.ngTable),c.params=b)},!0),c.parse=function(b){return a.isDefined(b)?b(c):""},g.showFilter&&c.$parent.$watch(g.showFilter,function(a){c.show_filter=a}),g.disableFilter&&c.$parent.$watch(g.disableFilter,function(a){c.$filterRow.disabled=a}),a.forEach(d,function(b){var d;if(b.filterData)return d=e(b.filterData)(c,{$column:b}),a.isObject(d)&&a.isObject(d.promise)?(delete b.filterData,d.promise.then(function(c){a.isArray(c)||a.isFunction(c)||a.isObject(c)?a.isArray(c)&&c.unshift({title:"-",id:""}):c=[],b.data=c})):b.data=d}),!f.hasClass("ng-table")){c.templates={header:g.templateHeader?g.templateHeader:"ng-table/header.html",pagination:g.templatePagination?g.templatePagination:"ng-table/pager.html"};var i=h.length>0?h:a.element(document.createElement("thead")).attr("ng-include","templates.header"),j=a.element(document.createElement("div")).attr({"ng-table-pagination":"params","template-url":"templates.pagination"});f.find("thead").remove(),f.addClass("ng-table").prepend(i).after(j),b(i)(c),b(j)(c)}}):void 0}}}]),b.directive("ngTablePagination",["$compile",function(b){return{restrict:"A",scope:{params:"=ngTablePagination",templateUrl:"="},replace:!1,link:function(c,d){c.params.settings().$scope.$on("ngTableAfterReloadData",function(){c.pages=c.params.generatePagesArray(c.params.page(),c.params.total(),c.params.count())},!0),c.$watch("templateUrl",function(e){if(!a.isUndefined(e)){var f=a.element(document.createElement("div"));f.attr({"ng-include":"templateUrl"}),d.append(f),b(f)(c)}})}}}]),a.module("ngTable").run(["$templateCache",function(a){a.put("ng-table/filters/select-multiple.html",'<select ng-options="data.id as data.title for data in column.data" ng-disabled="$filterRow.disabled" multiple ng-multiple="true" ng-model="params.filter()[name]" ng-show="filter==\'select-multiple\'" class="filter filter-select-multiple form-control" name="{{column.filterName}}"> </select>'),a.put("ng-table/filters/select.html",'<select ng-options="data.id as data.title for data in column.data" ng-disabled="$filterRow.disabled" ng-model="params.filter()[name]" ng-show="filter==\'select\'" class="filter filter-select form-control" name="{{column.filterName}}"> </select>'),a.put("ng-table/filters/text.html",'<input type="text" name="{{column.filterName}}" ng-disabled="$filterRow.disabled" ng-model="params.filter()[name]" ng-if="filter==\'text\'" class="input-filter form-control"/>'),a.put("ng-table/header.html",'<tr> <th ng-repeat="column in $columns" ng-class="{ \'sortable\': parse(column.sortable), \'sort-asc\': params.sorting()[parse(column.sortable)]==\'asc\', \'sort-desc\': params.sorting()[parse(column.sortable)]==\'desc\' }" ng-click="sortBy(column, $event)" ng-show="column.show(this)" ng-init="template=column.headerTemplateURL(this)" class="header {{column.class}}"> <div ng-if="!template" ng-show="!template" ng-bind="parse(column.title)"></div> <div ng-if="template" ng-show="template" ng-include="template"></div> </th> </tr> <tr ng-show="show_filter" class="ng-table-filters"> <th ng-repeat="column in $columns" ng-show="column.show(this)" class="filter"> <div ng-repeat="(name, filter) in column.filter"> <div ng-if="column.filterTemplateURL" ng-show="column.filterTemplateURL"> <div ng-include="column.filterTemplateURL"></div> </div> <div ng-if="!column.filterTemplateURL" ng-show="!column.filterTemplateURL"> <div ng-include="\'ng-table/filters/\' + filter + \'.html\'"></div> </div> </div> </th> </tr> '),a.put("ng-table/pager.html",'<div class="ng-cloak ng-table-pager"> <div ng-if="params.settings().counts.length" class="ng-table-counts btn-group pull-right"> <button ng-repeat="count in params.settings().counts" type="button" ng-class="{\'active\':params.count()==count}" ng-click="params.count(count)" class="btn btn-default"> <span ng-bind="count"></span> </button> </div> <ul class="pagination ng-table-pagination"> <li ng-class="{\'disabled\': !page.active && !page.current, \'active\': page.current}" ng-repeat="page in pages" ng-switch="page.type"> <a ng-switch-when="prev" ng-click="params.page(page.number)" href="">&laquo;</a> <a ng-switch-when="first" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a> <a ng-switch-when="page" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a> <a ng-switch-when="more" ng-click="params.page(page.number)" href="">&#8230;</a> <a ng-switch-when="last" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a> <a ng-switch-when="next" ng-click="params.page(page.number)" href="">&raquo;</a> </li> </ul> </div> ')}]),b});
//# sourceMappingURL=./dist/ng-table.min.js.map
/**
* Detect Element Resize
*
* https://github.com/sdecima/javascript-detect-element-resize
* Sebastian Decima
*
* version: 0.5.3
**/

(function () {
	var attachEvent = document.attachEvent,
		stylesCreated = false;
	
	if (!attachEvent) {
		var requestFrame = (function(){
			var raf = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame ||
								function(fn){ return window.setTimeout(fn, 20); };
			return function(fn){ return raf(fn); };
		})();
		
		var cancelFrame = (function(){
			var cancel = window.cancelAnimationFrame || window.mozCancelAnimationFrame || window.webkitCancelAnimationFrame ||
								   window.clearTimeout;
		  return function(id){ return cancel(id); };
		})();

		function resetTriggers(element){
			var triggers = element.__resizeTriggers__,
				expand = triggers.firstElementChild,
				contract = triggers.lastElementChild,
				expandChild = expand.firstElementChild;
			contract.scrollLeft = contract.scrollWidth;
			contract.scrollTop = contract.scrollHeight;
			expandChild.style.width = expand.offsetWidth + 1 + 'px';
			expandChild.style.height = expand.offsetHeight + 1 + 'px';
			expand.scrollLeft = expand.scrollWidth;
			expand.scrollTop = expand.scrollHeight;
		};

		function checkTriggers(element){
			return element.offsetWidth != element.__resizeLast__.width ||
						 element.offsetHeight != element.__resizeLast__.height;
		}
		
		function scrollListener(e){
			var element = this;
			resetTriggers(this);
			if (this.__resizeRAF__) cancelFrame(this.__resizeRAF__);
			this.__resizeRAF__ = requestFrame(function(){
				if (checkTriggers(element)) {
					element.__resizeLast__.width = element.offsetWidth;
					element.__resizeLast__.height = element.offsetHeight;
					element.__resizeListeners__.forEach(function(fn){
						fn.call(element, e);
					});
				}
			});
		};
		
		/* Detect CSS Animations support to detect element display/re-attach */
		var animation = false,
			animationstring = 'animation',
			keyframeprefix = '',
			animationstartevent = 'animationstart',
			domPrefixes = 'Webkit Moz O ms'.split(' '),
			startEvents = 'webkitAnimationStart animationstart oAnimationStart MSAnimationStart'.split(' '),
			pfx  = '';
		{
			var elm = document.createElement('fakeelement');
			if( elm.style.animationName !== undefined ) { animation = true; }    
			
			if( animation === false ) {
				for( var i = 0; i < domPrefixes.length; i++ ) {
					if( elm.style[ domPrefixes[i] + 'AnimationName' ] !== undefined ) {
						pfx = domPrefixes[ i ];
						animationstring = pfx + 'Animation';
						keyframeprefix = '-' + pfx.toLowerCase() + '-';
						animationstartevent = startEvents[ i ];
						animation = true;
						break;
					}
				}
			}
		}
		
		var animationName = 'resizeanim';
		var animationKeyframes = '@' + keyframeprefix + 'keyframes ' + animationName + ' { from { opacity: 0; } to { opacity: 0; } } ';
		var animationStyle = keyframeprefix + 'animation: 1ms ' + animationName + '; ';
	}
	
	function createStyles() {
		if (!stylesCreated) {
			//opacity:0 works around a chrome bug https://code.google.com/p/chromium/issues/detail?id=286360
			var css = (animationKeyframes ? animationKeyframes : '') +
					'.resize-triggers { ' + (animationStyle ? animationStyle : '') + 'visibility: hidden; opacity: 0; } ' +
					'.resize-triggers, .resize-triggers > div, .contract-trigger:before { content: \" \"; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',
				head = document.head || document.getElementsByTagName('head')[0],
				style = document.createElement('style');
			
			style.type = 'text/css';
			if (style.styleSheet) {
				style.styleSheet.cssText = css;
			} else {
				style.appendChild(document.createTextNode(css));
			}

			head.appendChild(style);
			stylesCreated = true;
		}
	}
	
	window.addResizeListener = function(element, fn){
		if (attachEvent) element.attachEvent('onresize', fn);
		else {
			if (!element.__resizeTriggers__) {
				if (getComputedStyle(element).position == 'static') element.style.position = 'relative';
				createStyles();
				element.__resizeLast__ = {};
				element.__resizeListeners__ = [];
				(element.__resizeTriggers__ = document.createElement('div')).className = 'resize-triggers';
				element.__resizeTriggers__.innerHTML = '<div class="expand-trigger"><div></div></div>' +
																						'<div class="contract-trigger"></div>';
				element.appendChild(element.__resizeTriggers__);
				resetTriggers(element);
				element.addEventListener('scroll', scrollListener, true);
				
				/* Listen for a css animation to detect element display/re-attach */
				animationstartevent && element.__resizeTriggers__.addEventListener(animationstartevent, function(e) {
					if(e.animationName == animationName)
						resetTriggers(element);
				});
			}
			element.__resizeListeners__.push(fn);
		}
	};
	
	window.removeResizeListener = function(element, fn){
		if (attachEvent) element.detachEvent('onresize', fn);
		else {
			element.__resizeListeners__.splice(element.__resizeListeners__.indexOf(fn), 1);
			if (!element.__resizeListeners__.length) {
					element.removeEventListener('scroll', scrollListener);
					element.__resizeTriggers__ = !element.removeChild(element.__resizeTriggers__);
			}
		}
	}
})();
(function(){
  var module = angular.module('multi-transclude', []);

  var Ctrl = ['$scope', '$element', '$transclude', function($scope, $element, $transclude){
    // Ensure we're transcluding or nothing will work.
    if(!$transclude){
      throw new Error(
        'Illegal use of ngMultiTransclude controller. No directive ' +
        'that requires a transclusion found.'
      );
    }

    // There's not a good way to ask Angular to give you the closest
    // controller from a list of controllers, we get all multi-transclude
    // controllers and select the one that is the child of the other.
    this.$element = $element;
    this.isChildOf = function(otherCtrl){
      return otherCtrl.$element[0].contains(this.$element[0]);
    };

    // Destination for transcluded content.
    var toTransclude;
    $scope.$on('$destroy', function(){
      if(toTransclude){
        toTransclude.remove();
        toTransclude = null;
      }
    });

    // A temporary container for transcluded content, so that content will not
    // be detached from the DOM during link. This ensures that controllers and
    // other data parent nodes are accessible within the transcluded content.
    var transcludeContainer = angular.element('<div style="display:none;"></div>');

    // Transclude content that matches name into element.
    this.transclude = function(name, element){
      for(var i = 0; i < toTransclude.length; ++i){
        // Uses the argument as the `name` attribute directly, but we could
        // evaluate it or interpolate it or whatever.
        var el = angular.element(toTransclude[i]);
        if(el.attr('name') === name){
          element.empty();
          element.append(el);
          return;
        }
      }
    };

    // Should be called after all transclusions are complete to clean up the
    // temporary container.
    this.transcluded = function(){
      if(transcludeContainer){
        transcludeContainer.remove();
        transcludeContainer = null;
      }
    };

    // Transclude content and keep track of it; be sure to keep it in the DOM
    // by attaching it to `$element`.
    $transclude(function(clone){
      toTransclude = clone;

      transcludeContainer.append(clone);
      $element.append(transcludeContainer);
    });
  }];

  module.directive('ngMultiTemplate', function(){
    return {
      transclude: true,
      templateUrl: function(element, attrs){
        return attrs.ngMultiTemplate;
      },
      controller: Ctrl,
      link: function(scope, element, attrs, ctrl){
        ctrl.transcluded();
      }
    };
  });

  module.directive('ngMultiTranscludeController', function(){
    return {
      controller: Ctrl,
      link: function(scope, element, attrs, ctrl){
        ctrl.transcluded();
      }
    };
  });

  module.directive('ngMultiTransclude', function(){
    return {
      require: ['?^ngMultiTranscludeController', '?^ngMultiTemplate'],
      link: function(scope, element, attrs, ctrls){
        // Find the deepest controller (closes to this element).
        var ctrl1 = ctrls[0];
        var ctrl2 = ctrls[1];
        var ctrl;
        if(ctrl1 && ctrl2){
          ctrl = ctrl1.isChildOf(ctrl2) ? ctrl1 : ctrl2;
        }
        else {
          ctrl = ctrl1 || ctrl2;
        }

        // A multi-transclude parent directive must be present.
        if(!ctrl){
          throw new Error('Illegal use of ngMultiTransclude. No wrapping controller.')
        }

        // Receive transcluded content.
        ctrl.transclude(attrs.ngMultiTransclude, element);
      }
    };
  });
})();

/**
 * @license Angular UI Tree v2.9.0
 * (c) 2010-2015. https://github.com/angular-ui-tree/angular-ui-tree
 * License: MIT
 */
(function () {
  'use strict';

  angular.module('ui.tree', [])
    .constant('treeConfig', {
      treeClass: 'angular-ui-tree',
      emptyTreeClass: 'angular-ui-tree-empty',
      hiddenClass: 'angular-ui-tree-hidden',
      nodesClass: 'angular-ui-tree-nodes',
      nodeClass: 'angular-ui-tree-node',
      handleClass: 'angular-ui-tree-handle',
      placeholderClass: 'angular-ui-tree-placeholder',
      dragClass: 'angular-ui-tree-drag',
      dragThreshold: 3,
      levelThreshold: 30
    });

})();

(function () {
  'use strict';

  angular.module('ui.tree')

    .controller('TreeHandleController', ['$scope', '$element',
      function ($scope, $element) {
        this.scope = $scope;

        $scope.$element = $element;
        $scope.$nodeScope = null;
        $scope.$type = 'uiTreeHandle';

      }
    ]);
})();

(function () {
  'use strict';

  angular.module('ui.tree')
    .controller('TreeNodeController', ['$scope', '$element',
      function ($scope, $element) {
        this.scope = $scope;

        $scope.$element = $element;
        $scope.$modelValue = null; // Model value for node;
        $scope.$parentNodeScope = null; // uiTreeNode Scope of parent node;
        $scope.$childNodesScope = null; // uiTreeNodes Scope of child nodes.
        $scope.$parentNodesScope = null; // uiTreeNodes Scope of parent nodes.
        $scope.$treeScope = null; // uiTree scope
        $scope.$handleScope = null; // it's handle scope
        $scope.$type = 'uiTreeNode';
        $scope.$$apply = false;
        $scope.collapsed = false;

        $scope.init = function (controllersArr) {
          var treeNodesCtrl = controllersArr[0];
          $scope.$treeScope = controllersArr[1] ? controllersArr[1].scope : null;

          // find the scope of it's parent node
          $scope.$parentNodeScope = treeNodesCtrl.scope.$nodeScope;
          // modelValue for current node
          $scope.$modelValue = treeNodesCtrl.scope.$modelValue[$scope.$index];
          $scope.$parentNodesScope = treeNodesCtrl.scope;
          treeNodesCtrl.scope.initSubNode($scope); // init sub nodes

          $element.on('$destroy', function () {
            treeNodesCtrl.scope.destroySubNode($scope); // destroy sub nodes
          });
        };

        $scope.index = function () {
          return $scope.$parentNodesScope.$modelValue.indexOf($scope.$modelValue);
        };

        $scope.dragEnabled = function () {
          return !($scope.$treeScope && !$scope.$treeScope.dragEnabled);
        };

        $scope.isSibling = function (targetNode) {
          return $scope.$parentNodesScope == targetNode.$parentNodesScope;
        };

        $scope.isChild = function (targetNode) {
          var nodes = $scope.childNodes();
          return nodes && nodes.indexOf(targetNode) > -1;
        };

        $scope.prev = function () {
          var index = $scope.index();
          if (index > 0) {
            return $scope.siblings()[index - 1];
          }
          return null;
        };

        $scope.siblings = function () {
          return $scope.$parentNodesScope.childNodes();
        };

        $scope.childNodesCount = function () {
          return $scope.childNodes() ? $scope.childNodes().length : 0;
        };

        $scope.hasChild = function () {
          return $scope.childNodesCount() > 0;
        };

        $scope.childNodes = function () {
          return $scope.$childNodesScope && $scope.$childNodesScope.$modelValue ?
            $scope.$childNodesScope.childNodes() :
            null;
        };

        $scope.accept = function (sourceNode, destIndex) {
          return $scope.$childNodesScope &&
            $scope.$childNodesScope.$modelValue &&
            $scope.$childNodesScope.accept(sourceNode, destIndex);
        };

        $scope.removeNode = function () {
          var node = $scope.remove();
          $scope.$callbacks.removed(node);
          return node;
        };

        $scope.remove = function () {
          return $scope.$parentNodesScope.removeNode($scope);
        };

        $scope.toggle = function () {
          $scope.collapsed = !$scope.collapsed;
        };

        $scope.collapse = function () {
          $scope.collapsed = true;
        };

        $scope.expand = function () {
          $scope.collapsed = false;
        };

        $scope.depth = function () {
          var parentNode = $scope.$parentNodeScope;
          if (parentNode) {
            return parentNode.depth() + 1;
          }
          return 1;
        };

        var subDepth = 0;
        function countSubDepth(scope) {
          var i, childNodes,
              count = 0,
              nodes = scope.childNodes();

          for (i = 0; i < nodes.length; i++) {
            childNodes = nodes[i].$childNodesScope;

            if (childNodes && childNodes.childNodesCount() > 0) {
              count = 1;
              countSubDepth(childNodes);
            }
          }
          subDepth += count;
        }

        $scope.maxSubDepth = function () {
          subDepth = 0;
          if ($scope.$childNodesScope) {
            countSubDepth($scope.$childNodesScope);
          }
          return subDepth;
        };

      }
    ]);
})();

(function () {
  'use strict';

  angular.module('ui.tree')

    .controller('TreeNodesController', ['$scope', '$element',
      function ($scope, $element) {
        this.scope = $scope;

        $scope.$element = $element;
        $scope.$modelValue = null;
        $scope.$nodeScope = null; // the scope of node which the nodes belongs to
        $scope.$treeScope = null;
        $scope.$type = 'uiTreeNodes';
        $scope.$nodesMap = {};

        $scope.nodropEnabled = false;
        $scope.maxDepth = 0;
        $scope.cloneEnabled = false;

        $scope.initSubNode = function (subNode) {
          if (!subNode.$modelValue) {
            return null;
          }
          $scope.$nodesMap[subNode.$modelValue.$$hashKey] = subNode;
        };

        $scope.destroySubNode = function (subNode) {
          if (!subNode.$modelValue) {
            return null;
          }
          $scope.$nodesMap[subNode.$modelValue.$$hashKey] = null;
        };

        $scope.accept = function (sourceNode, destIndex) {
          return $scope.$treeScope.$callbacks.accept(sourceNode, $scope, destIndex);
        };

        $scope.beforeDrag = function (sourceNode) {
          return $scope.$treeScope.$callbacks.beforeDrag(sourceNode);
        };

        $scope.isParent = function (node) {
          return node.$parentNodesScope == $scope;
        };

        $scope.hasChild = function () {
          return $scope.$modelValue.length > 0;
        };

        $scope.safeApply = function (fn) {
          var phase = this.$root.$$phase;
          if (phase == '$apply' || phase == '$digest') {
            if (fn && (typeof (fn) === 'function')) {
              fn();
            }
          } else {
            this.$apply(fn);
          }
        };

        $scope.removeNode = function (node) {
          var index = $scope.$modelValue.indexOf(node.$modelValue);
          if (index > -1) {
            $scope.safeApply(function () {
              $scope.$modelValue.splice(index, 1)[0];
            });
            return node;
          }
          return null;
        };

        $scope.insertNode = function (index, nodeData) {
          $scope.safeApply(function () {
            $scope.$modelValue.splice(index, 0, nodeData);
          });
        };

        $scope.childNodes = function () {
          var i, nodes = [];
          if ($scope.$modelValue) {
            for (i = 0; i < $scope.$modelValue.length; i++) {
              nodes.push($scope.$nodesMap[$scope.$modelValue[i].$$hashKey]);
            }
          }
          return nodes;
        };

        $scope.depth = function () {
          if ($scope.$nodeScope) {
            return $scope.$nodeScope.depth();
          }
          return 0; // if it has no $nodeScope, it's root
        };

        // check if depth limit has reached
        $scope.outOfDepth = function (sourceNode) {
          var maxDepth = $scope.maxDepth || $scope.$treeScope.maxDepth;
          if (maxDepth > 0) {
            return $scope.depth() + sourceNode.maxSubDepth() + 1 > maxDepth;
          }
          return false;
        };

      }
    ]);
})();

(function () {
  'use strict';

  angular.module('ui.tree')

    .controller('TreeController', ['$scope', '$element',
      function ($scope, $element) {
        this.scope = $scope;

        $scope.$element = $element;
        $scope.$nodesScope = null; // root nodes
        $scope.$type = 'uiTree';
        $scope.$emptyElm = null;
        $scope.$callbacks = null;

        $scope.dragEnabled = true;
        $scope.emptyPlaceholderEnabled = true;
        $scope.maxDepth = 0;
        $scope.dragDelay = 0;
        $scope.cloneEnabled = false;
        $scope.nodropEnabled = false;

        // Check if it's a empty tree
        $scope.isEmpty = function () {
          return ($scope.$nodesScope && $scope.$nodesScope.$modelValue
          && $scope.$nodesScope.$modelValue.length === 0);
        };

        // add placeholder to empty tree
        $scope.place = function (placeElm) {
          $scope.$nodesScope.$element.append(placeElm);
          $scope.$emptyElm.remove();
        };

        this.resetEmptyElement = function () {
          if ((!$scope.$nodesScope.$modelValue || $scope.$nodesScope.$modelValue.length === 0) &&
            $scope.emptyPlaceholderEnabled) {
            $element.append($scope.$emptyElm);
          } else {
            $scope.$emptyElm.remove();
          }
        };

        $scope.resetEmptyElement = this.resetEmptyElement;

        var collapseOrExpand = function (scope, collapsed) {
          var i, subScope,
              nodes = scope.childNodes();
          for (i = 0; i < nodes.length; i++) {
            collapsed ? nodes[i].collapse() : nodes[i].expand();
            subScope = nodes[i].$childNodesScope;
            if (subScope) {
              collapseOrExpand(subScope, collapsed);
            }
          }
        };

        $scope.collapseAll = function () {
          collapseOrExpand($scope.$nodesScope, true);
        };

        $scope.expandAll = function () {
          collapseOrExpand($scope.$nodesScope, false);
        };

      }
    ]);
})();

(function () {
  'use strict';

  angular.module('ui.tree')
    .directive('uiTree', ['treeConfig', '$window',
      function (treeConfig, $window) {
        return {
          restrict: 'A',
          scope: true,
          controller: 'TreeController',
          link: function (scope, element, attrs, ctrl) {
            var callbacks = {
              accept: null,
              beforeDrag: null
            },
              config = {};

            angular.extend(config, treeConfig);
            if (config.treeClass) {
              element.addClass(config.treeClass);
            }

            scope.$emptyElm = angular.element($window.document.createElement('div'));
            if (config.emptyTreeClass) {
              scope.$emptyElm.addClass(config.emptyTreeClass);
            }

            scope.$watch('$nodesScope.$modelValue.length', function () {
              if (!scope.$nodesScope.$modelValue) {
                return;
              }

              ctrl.resetEmptyElement();
            }, true);

            scope.$watch(attrs.dragEnabled, function (val) {
              if ((typeof val) == 'boolean') {
                scope.dragEnabled = val;
              }
            });

            scope.$watch(attrs.emptyPlaceholderEnabled, function (val) {
              if ((typeof val) == 'boolean') {
                scope.emptyPlaceholderEnabled = val;
                ctrl.resetEmptyElement();
              }
            });

            scope.$watch(attrs.nodropEnabled, function (val) {
              if ((typeof val) == 'boolean') {
                scope.nodropEnabled = val;
              }
            });

            scope.$watch(attrs.cloneEnabled, function (val) {
              if ((typeof val) == 'boolean') {
                scope.cloneEnabled = val;
              }
            });

            scope.$watch(attrs.maxDepth, function (val) {
              if ((typeof val) == 'number') {
                scope.maxDepth = val;
              }
            });

            scope.$watch(attrs.dragDelay, function (val) {
              if ((typeof val) == 'number') {
                scope.dragDelay = val;
              }
            });

            // check if the dest node can accept the dragging node
            // by default, we check the 'data-nodrop-enabled' attribute in `ui-tree-nodes`
            // and the 'max-depth' attribute in `ui-tree` or `ui-tree-nodes`.
            // the method can be overrided
            callbacks.accept = function (sourceNodeScope, destNodesScope, destIndex) {
              return !(destNodesScope.nodropEnabled || destNodesScope.outOfDepth(sourceNodeScope));
            };

            callbacks.beforeDrag = function (sourceNodeScope) {
              return true;
            };

            callbacks.removed = function (node) {

            };

            callbacks.dropped = function (event) {

            };

            callbacks.dragStart = function (event) {

            };

            callbacks.dragMove = function (event) {

            };

            callbacks.dragStop = function (event) {

            };

            callbacks.beforeDrop = function (event) {

            };

            scope.$watch(attrs.uiTree, function (newVal, oldVal) {
              angular.forEach(newVal, function (value, key) {
                if (callbacks[key]) {
                  if (typeof value === 'function') {
                    callbacks[key] = value;
                  }
                }
              });

              scope.$callbacks = callbacks;
            }, true);


          }
        };
      }
    ]);
})();

(function () {
  'use strict';

  angular.module('ui.tree')
    .directive('uiTreeHandle', ['treeConfig',
      function (treeConfig) {
        return {
          require: '^uiTreeNode',
          restrict: 'A',
          scope: true,
          controller: 'TreeHandleController',
          link: function (scope, element, attrs, treeNodeCtrl) {
            var config = {};
            angular.extend(config, treeConfig);
            if (config.handleClass) {
              element.addClass(config.handleClass);
            }
            // connect with the tree node.
            if (scope != treeNodeCtrl.scope) {
              scope.$nodeScope = treeNodeCtrl.scope;
              treeNodeCtrl.scope.$handleScope = scope;
            }
          }
        };
      }
    ]);
})();

(function () {
  'use strict';

  angular.module('ui.tree')

    .directive('uiTreeNode', ['treeConfig', 'UiTreeHelper', '$window', '$document', '$timeout',
      function (treeConfig, UiTreeHelper, $window, $document, $timeout) {
        return {
          require: ['^uiTreeNodes', '^uiTree'],
          restrict: 'A',
          controller: 'TreeNodeController',
          link: function (scope, element, attrs, controllersArr) {
            // todo startPos is unused
            var config = {},
              hasTouch = 'ontouchstart' in window,
              startPos, firstMoving, dragInfo, pos,
              placeElm, hiddenPlaceElm, dragElm,
              treeScope = null,
              elements, // As a parameter for callbacks
              dragDelaying = true,
              dragStarted = false,
              dragTimer = null,
              body = document.body,
              html = document.documentElement,
              document_height,
              document_width,
              dragStart,
              tagName,
              dragMove,
              dragEnd,
              dragStartEvent,
              dragMoveEvent,
              dragEndEvent,
              dragCancelEvent,
              dragDelay,
              bindDrag,
              keydownHandler,
              outOfBounds;
            angular.extend(config, treeConfig);
            if (config.nodeClass) {
              element.addClass(config.nodeClass);
            }
            scope.init(controllersArr);

            scope.collapsed = !!UiTreeHelper.getNodeAttribute(scope, 'collapsed');
            scope.sourceOnly = scope.nodropEnabled || scope.$treeScope.nodropEnabled;

            scope.$watch(attrs.collapsed, function (val) {
              if ((typeof val) == 'boolean') {
                scope.collapsed = val;
              }
            });

            scope.$watch('collapsed', function (val) {
              UiTreeHelper.setNodeAttribute(scope, 'collapsed', val);
              attrs.$set('collapsed', val);
            });

            dragStart = function (e) {
              if (!hasTouch && (e.button == 2 || e.which == 3)) {
                // disable right click
                return;
              }
              if (e.uiTreeDragging || (e.originalEvent && e.originalEvent.uiTreeDragging)) { // event has already fired in other scope.
                return;
              }

              // the element which is clicked.
              var eventElm = angular.element(e.target),
                eventScope = eventElm.scope(),
                cloneElm = element.clone(),
                eventElmTagName, tagName,
                eventObj, tdElm, hStyle;
              if (!eventScope || !eventScope.$type) {
                return;
              }
              if (eventScope.$type != 'uiTreeNode'
                && eventScope.$type != 'uiTreeHandle') { // Check if it is a node or a handle
                return;
              }
              if (eventScope.$type == 'uiTreeNode'
                && eventScope.$handleScope) { // If the node has a handle, then it should be clicked by the handle
                return;
              }

              eventElmTagName = eventElm.prop('tagName').toLowerCase();
              if (eventElmTagName == 'input' ||
                eventElmTagName == 'textarea' ||
                eventElmTagName == 'button' ||
                eventElmTagName == 'select') { // if it's a input or button, ignore it
                return;
              }

              // check if it or it's parents has a 'data-nodrag' attribute
              while (eventElm && eventElm[0] && eventElm[0] != element) {
                if (UiTreeHelper.nodrag(eventElm)) { // if the node mark as `nodrag`, DONOT drag it.
                  return;
                }
                eventElm = eventElm.parent();
              }

              if (!scope.beforeDrag(scope)) {
                return;
              }

              e.uiTreeDragging = true; // stop event bubbling
              if (e.originalEvent) {
                e.originalEvent.uiTreeDragging = true;
              }
              e.preventDefault();
              eventObj = UiTreeHelper.eventObj(e);

              firstMoving = true;
              dragInfo = UiTreeHelper.dragInfo(scope);

              // Fire dragStart callback
              scope.$apply(function () {
                scope.$treeScope.$callbacks.dragStart(dragInfo.eventArgs(elements, pos));
              });

              tagName = scope.$element.prop('tagName');

              if (tagName.toLowerCase() === 'tr') {
                placeElm = angular.element($window.document.createElement(tagName));
                tdElm = angular.element($window.document.createElement('td'))
                  .addClass(config.placeholderClass);
                placeElm.append(tdElm);
              } else {
                placeElm = angular.element($window.document.createElement(tagName))
                  .addClass(config.placeholderClass);
              }
              hiddenPlaceElm = angular.element($window.document.createElement(tagName));
              if (config.hiddenClass) {
                hiddenPlaceElm.addClass(config.hiddenClass);
              }

              pos = UiTreeHelper.positionStarted(eventObj, scope.$element);
              placeElm.css('height', UiTreeHelper.height(scope.$element) + 'px');
              placeElm.css('width', UiTreeHelper.width(scope.$element) + 'px');

              dragElm = angular.element($window.document.createElement(scope.$parentNodesScope.$element.prop('tagName')))
                .addClass(scope.$parentNodesScope.$element.attr('class')).addClass(config.dragClass);
              dragElm.css('width', UiTreeHelper.width(scope.$element) + 'px');
              dragElm.css('z-index', 9999);

              // Prevents cursor to change rapidly in Opera 12.16 and IE when dragging an element
              hStyle = (scope.$element[0].querySelector('.angular-ui-tree-handle') || scope.$element[0]).currentStyle;
              if (hStyle) {
                document.body.setAttribute('ui-tree-cursor', $document.find('body').css('cursor') || '');
                $document.find('body').css({'cursor': hStyle.cursor + '!important'});
              }

              if (scope.sourceOnly) {
                placeElm.css('display', 'none');
              }
              scope.$element.after(placeElm);
              scope.$element.after(hiddenPlaceElm);
              if (dragInfo.isClone() && scope.sourceOnly) {
                dragElm.append(cloneElm);
              } else {
                dragElm.append(scope.$element);
              }
              $document.find('body').append(dragElm);
              dragElm.css({
                'left': eventObj.pageX - pos.offsetX + 'px',
                'top': eventObj.pageY - pos.offsetY + 'px'
              });
              elements = {
                placeholder: placeElm,
                dragging: dragElm
              };

              angular.element($document).bind('touchend', dragEndEvent);
              angular.element($document).bind('touchcancel', dragEndEvent);
              angular.element($document).bind('touchmove', dragMoveEvent);
              angular.element($document).bind('mouseup', dragEndEvent);
              angular.element($document).bind('mousemove', dragMoveEvent);
              angular.element($document).bind('mouseleave', dragCancelEvent);

              document_height = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);
              document_width = Math.max(body.scrollWidth, body.offsetWidth, html.clientWidth, html.scrollWidth, html.offsetWidth);
            };

            dragMove = function (e) {
              var eventObj = UiTreeHelper.eventObj(e),
                prev,
                next,
                leftElmPos,
                topElmPos,
                top_scroll,
                bottom_scroll,
                target,
                decrease,
                targetX,
                targetY,
                displayElm,
                targetNode,
                targetElm,
                isEmpty,
                targetOffset,
                targetBefore;

              if (dragElm) {
                e.preventDefault();

                if ($window.getSelection) {
                  $window.getSelection().removeAllRanges();
                } else if ($window.document.selection) {
                  $window.document.selection.empty();
                }

                leftElmPos = eventObj.pageX - pos.offsetX;
                topElmPos = eventObj.pageY - pos.offsetY;

                //dragElm can't leave the screen on the left
                if (leftElmPos < 0) {
                  leftElmPos = 0;
                }

                //dragElm can't leave the screen on the top
                if (topElmPos < 0) {
                  topElmPos = 0;
                }

                //dragElm can't leave the screen on the bottom
                if ((topElmPos + 10) > document_height) {
                  topElmPos = document_height - 10;
                }

                //dragElm can't leave the screen on the right
                if ((leftElmPos + 10) > document_width) {
                  leftElmPos = document_width - 10;
                }

                dragElm.css({
                  'left': leftElmPos + 'px',
                  'top': topElmPos + 'px'
                });

                top_scroll = window.pageYOffset || $window.document.documentElement.scrollTop;
                bottom_scroll = top_scroll + (window.innerHeight || $window.document.clientHeight || $window.document.clientHeight);

                // to scroll down if cursor y-position is greater than the bottom position the vertical scroll
                if (bottom_scroll < eventObj.pageY && bottom_scroll <= document_height) {
                  window.scrollBy(0, 10);
                }

                // to scroll top if cursor y-position is less than the top position the vertical scroll
                if (top_scroll > eventObj.pageY) {
                  window.scrollBy(0, -10);
                }

                UiTreeHelper.positionMoved(e, pos, firstMoving);
                if (firstMoving) {
                  firstMoving = false;
                  return;
                }

                // check if add it as a child node first
                // todo decrease is unused
                decrease = (UiTreeHelper.offset(dragElm).left - UiTreeHelper.offset(placeElm).left) >= config.threshold;
                targetX = eventObj.pageX - $window.document.body.scrollLeft;
                targetY = eventObj.pageY - (window.pageYOffset || $window.document.documentElement.scrollTop);

                // Select the drag target. Because IE does not support CSS 'pointer-events: none', it will always
                // pick the drag element itself as the target. To prevent this, we hide the drag element while
                // selecting the target.
                if (angular.isFunction(dragElm.hide)) {
                  dragElm.hide();
                } else {
                  displayElm = dragElm[0].style.display;
                  dragElm[0].style.display = 'none';
                }

                // when using elementFromPoint() inside an iframe, you have to call
                // elementFromPoint() twice to make sure IE8 returns the correct value
                $window.document.elementFromPoint(targetX, targetY);

                targetElm = angular.element($window.document.elementFromPoint(targetX, targetY));

                if (angular.isFunction(dragElm.show)) {
                  dragElm.show();
                } else {
                  dragElm[0].style.display = displayElm;
                }

                outOfBounds = !(targetElm.scope().$type);

                // Detect out of bounds condition, update drop target display, and prevent drop
                if (outOfBounds) {

                  // Remove the placeholder
                  placeElm.remove();

                  // If the target was an empty tree, replace the empty element placeholder
                  if (treeScope) {
                    treeScope.resetEmptyElement();
                    treeScope = null;
                  }
                }

                // move horizontal
                if (pos.dirAx && pos.distAxX >= config.levelThreshold) {
                  pos.distAxX = 0;

                  // increase horizontal level if previous sibling exists and is not collapsed
                  if (pos.distX > 0) {
                    prev = dragInfo.prev();
                    if (prev && !prev.collapsed
                      && prev.accept(scope, prev.childNodesCount())) {
                      prev.$childNodesScope.$element.append(placeElm);
                      dragInfo.moveTo(prev.$childNodesScope, prev.childNodes(), prev.childNodesCount());
                    }
                  }

                  // decrease horizontal level
                  if (pos.distX < 0) {
                    // we can't decrease a level if an item preceeds the current one
                    next = dragInfo.next();
                    if (!next) {
                      target = dragInfo.parentNode(); // As a sibling of it's parent node
                      if (target
                        && target.$parentNodesScope.accept(scope, target.index() + 1)) {
                        target.$element.after(placeElm);
                        dragInfo.moveTo(target.$parentNodesScope, target.siblings(), target.index() + 1);
                      }
                    }
                  }
                }

                // move vertical
                if (!pos.dirAx) {
                  // check it's new position
                  targetNode = targetElm.scope();
                  isEmpty = false;
                  if (!targetNode) {
                    return;
                  }

                  // Show the placeholder if it was hidden for nodrop-enabled and this is a new tree
                  if (targetNode.$treeScope && !targetNode.$parent.nodropEnabled && !targetNode.$treeScope.nodropEnabled) {
                    placeElm.css('display', 'block');
                  }

                  if (targetNode.$type == 'uiTree' && targetNode.dragEnabled) {
                    isEmpty = targetNode.isEmpty(); // Check if it's empty tree
                  }

                  if (targetNode.$type == 'uiTreeHandle') {
                    targetNode = targetNode.$nodeScope;
                  }

                  if (targetNode.$type != 'uiTreeNode'
                    && !isEmpty) { // Check if it is a uiTreeNode or it's an empty tree
                    return;
                  }

                  // if placeholder move from empty tree, reset it.
                  if (treeScope && placeElm.parent()[0] != treeScope.$element[0]) {
                    treeScope.resetEmptyElement();
                    treeScope = null;
                  }

                  if (isEmpty) { // it's an empty tree
                    treeScope = targetNode;
                    if (targetNode.$nodesScope.accept(scope, 0)) {
                      targetNode.place(placeElm);
                      dragInfo.moveTo(targetNode.$nodesScope, targetNode.$nodesScope.childNodes(), 0);
                    }
                  } else if (targetNode.dragEnabled()) { // drag enabled
                    targetElm = targetNode.$element; // Get the element of ui-tree-node
                    targetOffset = UiTreeHelper.offset(targetElm);
                    targetBefore = targetNode.horizontal ? eventObj.pageX < (targetOffset.left + UiTreeHelper.width(targetElm) / 2)
                      : eventObj.pageY < (targetOffset.top + UiTreeHelper.height(targetElm) / 2);

                    if (targetNode.$parentNodesScope.accept(scope, targetNode.index())) {
                      if (targetBefore) {
                        targetElm[0].parentNode.insertBefore(placeElm[0], targetElm[0]);
                        dragInfo.moveTo(targetNode.$parentNodesScope, targetNode.siblings(), targetNode.index());
                      } else {
                        targetElm.after(placeElm);
                        dragInfo.moveTo(targetNode.$parentNodesScope, targetNode.siblings(), targetNode.index() + 1);
                      }
                    } else if (!targetBefore && targetNode.accept(scope, targetNode.childNodesCount())) { // we have to check if it can add the dragging node as a child
                      targetNode.$childNodesScope.$element.append(placeElm);
                      dragInfo.moveTo(targetNode.$childNodesScope, targetNode.childNodes(), targetNode.childNodesCount());
                    } else {
                      outOfBounds = true;
                    }
                  }
                }

                scope.$apply(function () {
                  scope.$treeScope.$callbacks.dragMove(dragInfo.eventArgs(elements, pos));
                });
              }
            };

            dragEnd = function (e) {

              e.preventDefault();

              if (dragElm) {
                scope.$treeScope.$apply(function () {
                  scope.$treeScope.$callbacks.beforeDrop(dragInfo.eventArgs(elements, pos));
                });
                // roll back elements changed
                hiddenPlaceElm.replaceWith(scope.$element);
                placeElm.remove();

                dragElm.remove();
                dragElm = null;
                if (scope.$$apply && !outOfBounds) {
                  scope.$treeScope.$apply(function () {
                    dragInfo.apply();
                    scope.$treeScope.$callbacks.dropped(dragInfo.eventArgs(elements, pos));
                  });
                } else {
                  bindDrag();
                }
                scope.$treeScope.$apply(function () {
                  scope.$treeScope.$callbacks.dragStop(dragInfo.eventArgs(elements, pos));
                });
                scope.$$apply = false;
                dragInfo = null;
              }

              // Restore cursor in Opera 12.16 and IE
              var oldCur = document.body.getAttribute('ui-tree-cursor');
              if (oldCur !== null) {
                $document.find('body').css({'cursor': oldCur});
                document.body.removeAttribute('ui-tree-cursor');
              }

              angular.element($document).unbind('touchend', dragEndEvent); // Mobile
              angular.element($document).unbind('touchcancel', dragEndEvent); // Mobile
              angular.element($document).unbind('touchmove', dragMoveEvent); // Mobile
              angular.element($document).unbind('mouseup', dragEndEvent);
              angular.element($document).unbind('mousemove', dragMoveEvent);
              angular.element($window.document.body).unbind('mouseleave', dragCancelEvent);
            };

            dragStartEvent = function (e) {
              if (scope.dragEnabled()) {
                dragStart(e);
              }
            };

            dragMoveEvent = function (e) {
              dragMove(e);
            };

            dragEndEvent = function (e) {
              scope.$$apply = true;
              dragEnd(e);
            };

            dragCancelEvent = function (e) {
              dragEnd(e);
            };

            dragDelay = (function () {
              var to;

              return {
                exec: function (fn, ms) {
                  if (!ms) {
                    ms = 0;
                  }
                  this.cancel();
                  to = $timeout(fn, ms);
                },
                cancel: function () {
                  $timeout.cancel(to);
                }
              };
            })();

            bindDrag = function () {
              element.bind('touchstart mousedown', function (e) {
                dragDelay.exec(function () {
                  dragStartEvent(e);
                }, scope.dragDelay || 0);
              });
              element.bind('touchend touchcancel mouseup', function () {
                dragDelay.cancel();
              });
            };
            bindDrag();

            keydownHandler = function (e) {
              if (e.keyCode == 27) {
                scope.$$apply = false;
                dragEnd(e);
              }
            };

            angular.element($window.document.body).bind('keydown', keydownHandler);

            //unbind handler that retains scope
            scope.$on('$destroy', function () {
              angular.element($window.document.body).unbind('keydown', keydownHandler);
            });
          }
        };
      }
    ]);

})();

(function () {
  'use strict';

  angular.module('ui.tree')
    .directive('uiTreeNodes', ['treeConfig', '$window',
      function (treeConfig) {
        return {
          require: ['ngModel', '?^uiTreeNode', '^uiTree'],
          restrict: 'A',
          scope: true,
          controller: 'TreeNodesController',
          link: function (scope, element, attrs, controllersArr) {

            var config = {},
                ngModel = controllersArr[0],
                treeNodeCtrl = controllersArr[1],
                treeCtrl = controllersArr[2];

            angular.extend(config, treeConfig);
            if (config.nodesClass) {
              element.addClass(config.nodesClass);
            }

            if (treeNodeCtrl) {
              treeNodeCtrl.scope.$childNodesScope = scope;
              scope.$nodeScope = treeNodeCtrl.scope;
            } else {
              // find the root nodes if there is no parent node and have a parent ui-tree
              treeCtrl.scope.$nodesScope = scope;
            }
            scope.$treeScope = treeCtrl.scope;

            if (ngModel) {
              ngModel.$render = function () {
                scope.$modelValue = ngModel.$modelValue;
              };
            }

            scope.$watch(attrs.maxDepth, function (val) {
              if ((typeof val) == 'number') {
                scope.maxDepth = val;
              }
            });

            scope.$watch(function () {
              return attrs.nodropEnabled;
            }, function (newVal) {
              if ((typeof newVal) != 'undefined') {
                scope.nodropEnabled = true;
              }
            }, true);

            attrs.$observe('horizontal', function (val) {
              scope.horizontal = ((typeof val) != 'undefined');
            });

          }
        };
      }
    ]);
})();

(function () {
  'use strict';

  angular.module('ui.tree')

  /**
   * @ngdoc service
   * @name ui.tree.service:UiTreeHelper
   * @requires ng.$document
   * @requires ng.$window
   *
   * @description
   * angular-ui-tree.
   */
    .factory('UiTreeHelper', ['$document', '$window',
      function ($document, $window) {
        return {

          /**
           * A hashtable used to storage data of nodes
           * @type {Object}
           */
          nodesData: {},

          setNodeAttribute: function (scope, attrName, val) {
            if (!scope.$modelValue) {
              return null;
            }
            var data = this.nodesData[scope.$modelValue.$$hashKey];
            if (!data) {
              data = {};
              this.nodesData[scope.$modelValue.$$hashKey] = data;
            }
            data[attrName] = val;
          },

          getNodeAttribute: function (scope, attrName) {
            if (!scope.$modelValue) {
              return null;
            }
            var data = this.nodesData[scope.$modelValue.$$hashKey];
            if (data) {
              return data[attrName];
            }
            return null;
          },

          /**
           * @ngdoc method
           * @methodOf ui.tree.service:$nodrag
           * @param  {Object} targetElm angular element
           * @return {Bool} check if the node can be dragged.
           */
          nodrag: function (targetElm) {
            if (typeof targetElm.attr('data-nodrag') != 'undefined') {
              return targetElm.attr('data-nodrag') !== 'false';
            }
            return false;
          },

          /**
           * get the event object for touches
           * @param  {[type]} e [description]
           * @return {[type]}   [description]
           */
          eventObj: function (e) {
            var obj = e;
            if (e.targetTouches !== undefined) {
              obj = e.targetTouches.item(0);
            } else if (e.originalEvent !== undefined && e.originalEvent.targetTouches !== undefined) {
              obj = e.originalEvent.targetTouches.item(0);
            }
            return obj;
          },

          dragInfo: function (node) {
            return {
              source: node,
              sourceInfo: {
                cloneModel: node.$treeScope.cloneEnabled === true ? angular.copy(node.$modelValue) : undefined,
                nodeScope: node,
                index: node.index(),
                nodesScope: node.$parentNodesScope
              },
              index: node.index(),
              siblings: node.siblings().slice(0),
              parent: node.$parentNodesScope,

              // Move the node to a new position
              moveTo: function (parent, siblings, index) {
                this.parent = parent;
                this.siblings = siblings.slice(0);

                // If source node is in the target nodes
                var i = this.siblings.indexOf(this.source);
                if (i > -1) {
                  this.siblings.splice(i, 1);
                  if (this.source.index() < index) {
                    index--;
                  }
                }

                this.siblings.splice(index, 0, this.source);
                this.index = index;
              },

              parentNode: function () {
                return this.parent.$nodeScope;
              },

              prev: function () {
                if (this.index > 0) {
                  return this.siblings[this.index - 1];
                }

                return null;
              },

              next: function () {
                if (this.index < this.siblings.length - 1) {
                  return this.siblings[this.index + 1];
                }

                return null;
              },

              isClone: function () {
                return this.source.$treeScope.cloneEnabled === true;
              },

              clonedNode: function (node) {
                return angular.copy(node);
              },

              isDirty: function () {
                return this.source.$parentNodesScope != this.parent ||
                  this.source.index() != this.index;
              },

              isForeign: function () {
                return this.source.$treeScope !== this.parent.$treeScope;
              },

              eventArgs: function (elements, pos) {
                return {
                  source: this.sourceInfo,
                  dest: {
                    index: this.index,
                    nodesScope: this.parent
                  },
                  elements: elements,
                  pos: pos
                };
              },

              apply: function () {

                var nodeData = this.source.$modelValue;

                // nodrop enabled on tree or parent
                if (this.parent.nodropEnabled || this.parent.$treeScope.nodropEnabled) {
                  return;
                }

                // node was dropped in the same place - do nothing
                if (!this.isDirty()) {
                  return;
                }

                // cloneEnabled and cross-tree so copy and do not remove from source
                if (this.isClone() && this.isForeign()) {
                  this.parent.insertNode(this.index, angular.copy(nodeData));
                } else { // Any other case, remove and reinsert
                  this.source.remove();
                  this.parent.insertNode(this.index, nodeData);
                }
              }
            };
          },

          /**
           * @ngdoc method
           * @name ui.tree#height
           * @methodOf ui.tree.service:UiTreeHelper
           *
           * @description
           * Get the height of an element.
           *
           * @param {Object} element Angular element.
           * @returns {String} Height
           */
          height: function (element) {
            return element.prop('scrollHeight');
          },

          /**
           * @ngdoc method
           * @name ui.tree#width
           * @methodOf ui.tree.service:UiTreeHelper
           *
           * @description
           * Get the width of an element.
           *
           * @param {Object} element Angular element.
           * @returns {String} Width
           */
          width: function (element) {
            return element.prop('scrollWidth');
          },

          /**
           * @ngdoc method
           * @name ui.tree#offset
           * @methodOf ui.nestedSortable.service:UiTreeHelper
           *
           * @description
           * Get the offset values of an element.
           *
           * @param {Object} element Angular element.
           * @returns {Object} Object with properties width, height, top and left
           */
          offset: function (element) {
            var boundingClientRect = element[0].getBoundingClientRect();

            return {
              width: element.prop('offsetWidth'),
              height: element.prop('offsetHeight'),
              top: boundingClientRect.top + ($window.pageYOffset || $document[0].body.scrollTop || $document[0].documentElement.scrollTop),
              left: boundingClientRect.left + ($window.pageXOffset || $document[0].body.scrollLeft || $document[0].documentElement.scrollLeft)
            };
          },

          /**
           * @ngdoc method
           * @name ui.tree#positionStarted
           * @methodOf ui.tree.service:UiTreeHelper
           *
           * @description
           * Get the start position of the target element according to the provided event properties.
           *
           * @param {Object} e Event
           * @param {Object} target Target element
           * @returns {Object} Object with properties offsetX, offsetY, startX, startY, nowX and dirX.
           */
          positionStarted: function (e, target) {
            var pos = {},
              pageX = e.pageX,
              pageY = e.pageY;

            if (e.originalEvent && e.originalEvent.touches && (e.originalEvent.touches.length > 0)) {
              pageX = e.originalEvent.touches[0].pageX;
              pageY = e.originalEvent.touches[0].pageY;
            }
            pos.offsetX = pageX - this.offset(target).left;
            pos.offsetY = pageY - this.offset(target).top;
            pos.startX = pos.lastX = pageX;
            pos.startY = pos.lastY = pageY;
            pos.nowX = pos.nowY = pos.distX = pos.distY = pos.dirAx = 0;
            pos.dirX = pos.dirY = pos.lastDirX = pos.lastDirY = pos.distAxX = pos.distAxY = 0;
            return pos;
          },

          positionMoved: function (e, pos, firstMoving) {
            var pageX = e.pageX,
              pageY = e.pageY,
              newAx;
            if (e.originalEvent && e.originalEvent.touches && (e.originalEvent.touches.length > 0)) {
              pageX = e.originalEvent.touches[0].pageX;
              pageY = e.originalEvent.touches[0].pageY;
            }
            // mouse position last events
            pos.lastX = pos.nowX;
            pos.lastY = pos.nowY;

            // mouse position this events
            pos.nowX = pageX;
            pos.nowY = pageY;

            // distance mouse moved between events
            pos.distX = pos.nowX - pos.lastX;
            pos.distY = pos.nowY - pos.lastY;

            // direction mouse was moving
            pos.lastDirX = pos.dirX;
            pos.lastDirY = pos.dirY;

            // direction mouse is now moving (on both axis)
            pos.dirX = pos.distX === 0 ? 0 : pos.distX > 0 ? 1 : -1;
            pos.dirY = pos.distY === 0 ? 0 : pos.distY > 0 ? 1 : -1;

            // axis mouse is now moving on
            newAx = Math.abs(pos.distX) > Math.abs(pos.distY) ? 1 : 0;

            // do nothing on first move
            if (firstMoving) {
              pos.dirAx = newAx;
              pos.moving = true;
              return;
            }

            // calc distance moved on this axis (and direction)
            if (pos.dirAx !== newAx) {
              pos.distAxX = 0;
              pos.distAxY = 0;
            } else {
              pos.distAxX += Math.abs(pos.distX);
              if (pos.dirX !== 0 && pos.dirX !== pos.lastDirX) {
                pos.distAxX = 0;
              }

              pos.distAxY += Math.abs(pos.distY);
              if (pos.dirY !== 0 && pos.dirY !== pos.lastDirY) {
                pos.distAxY = 0;
              }
            }

            pos.dirAx = newAx;
          }
        };
      }

    ]);

})();

/**
 * angular-drag-and-drop-lists v1.2.0
 *
 * Copyright (c) 2014 Marcel Juenemann mail@marcel-junemann.de
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
angular.module('dndLists', [])

  /**
   * Use the dnd-draggable attribute to make your element draggable
   *
   * Attributes:
   * - dnd-draggable      Required attribute. The value has to be an object that represents the data
   *                      of the element. In case of a drag and drop operation the object will be
   *                      serialized and unserialized on the receiving end.
   * - dnd-selected       Callback that is invoked when the element was clicked but not dragged.
   *                      The original click event will be provided in the local event variable.
   * - dnd-effect-allowed Use this attribute to limit the operations that can be performed. Options:
   *                      - "move": The drag operation will move the element. This is the default.
   *                      - "copy": The drag operation will copy the element. Shows a copy cursor.
   *                      - "copyMove": The user can choose between copy and move by pressing the
   *                        ctrl or shift key. *Not supported in IE:* In Internet Explorer this
   *                        option will be the same as "copy". *Not fully supported in Chrome on
   *                        Windows:* In the Windows version of Chrome the cursor will always be the
   *                        move cursor. However, when the user drops an element and has the ctrl
   *                        key pressed, we will perform a copy anyways.
   *                      - HTML5 also specifies the "link" option, but this library does not
   *                        actively support it yet, so use it at your own risk.
   * - dnd-moved          Callback that is invoked when the element was moved. Usually you will
   *                      remove your element from the original list in this callback, since the
   *                      directive is not doing that for you automatically. The original dragend
   *                      event will be provided in the local event variable.
   * - dnd-copied         Same as dnd-moved, just that it is called when the element was copied
   *                      instead of moved. The original dragend event will be provided in the local
   *                      event variable.
   * - dnd-dragstart      Callback that is invoked when the element was dragged. The original
   *                      dragstart event will be provided in the local event variable.
   * - dnd-type           Use this attribute if you have different kinds of items in your
   *                      application and you want to limit which items can be dropped into which
   *                      lists. Combine with dnd-allowed-types on the dnd-list(s). This attribute
   *                      should evaluate to a string, although this restriction is not enforced.
   * - dnd-disable-if     You can use this attribute to dynamically disable the draggability of the
   *                      element. This is useful if you have certain list items that you don't want
   *                      to be draggable, or if you want to disable drag & drop completely without
   *                      having two different code branches (e.g. only allow for admins).
   *                      **Note**: If your element is not draggable, the user is probably able to
   *                      select text or images inside of it. Since a selection is always draggable,
   *                      this breaks your UI. You most likely want to disable user selection via
   *                      CSS (see user-select).
   *
   * CSS classes:
   * - dndDragging        This class will be added to the element while the element is being
   *                      dragged. It will affect both the element you see while dragging and the
   *                      source element that stays at it's position. Do not try to hide the source
   *                      element with this class, because that will abort the drag operation.
   * - dndDraggingSource  This class will be added to the element after the drag operation was
   *                      started, meaning it only affects the original element that is still at
   *                      it's source position, and not the "element" that the user is dragging with
   *                      his mouse pointer.
   */
  .directive('dndDraggable', ['$parse', '$timeout', 'dndDropEffectWorkaround', 'dndDragTypeWorkaround',
                      function($parse,   $timeout,   dndDropEffectWorkaround,   dndDragTypeWorkaround) {
    return function(scope, element, attr) {
      // Set the HTML5 draggable attribute on the element
      element.attr("draggable", "true");

      // If the dnd-disable-if attribute is set, we have to watch that
      if (attr.dndDisableIf) {
        scope.$watch(attr.dndDisableIf, function(disabled) {
          element.attr("draggable", !disabled);
        });
      }

      /**
       * When the drag operation is started we have to prepare the dataTransfer object,
       * which is the primary way we communicate with the target element
       */
      element.on('dragstart', function(event) {
        event = event.originalEvent || event;

        // Serialize the data associated with this element. IE only supports the Text drag type
        event.dataTransfer.setData("Text", angular.toJson(scope.$eval(attr.dndDraggable)));

        // Only allow actions specified in dnd-effect-allowed attribute
        event.dataTransfer.effectAllowed = attr.dndEffectAllowed || "move";

        // Add CSS classes. See documentation above
        element.addClass("dndDragging");
        $timeout(function() { element.addClass("dndDraggingSource"); }, 0);

        // Workarounds for stupid browsers, see description below
        dndDropEffectWorkaround.dropEffect = "none";
        dndDragTypeWorkaround.isDragging = true;

        // Save type of item in global state. Usually, this would go into the dataTransfer
        // typename, but we have to use "Text" there to support IE
        dndDragTypeWorkaround.dragType = attr.dndType ? scope.$eval(attr.dndType) : undefined;

        // Invoke callback
        $parse(attr.dndDragstart)(scope, {event: event});

        event.stopPropagation();
      });

      /**
       * The dragend event is triggered when the element was dropped or when the drag
       * operation was aborted (e.g. hit escape button). Depending on the executed action
       * we will invoke the callbacks specified with the dnd-moved or dnd-copied attribute.
       */
      element.on('dragend', function(event) {
        event = event.originalEvent || event;

        // Invoke callbacks. Usually we would use event.dataTransfer.dropEffect to determine
        // the used effect, but Chrome has not implemented that field correctly. On Windows
        // it always sets it to 'none', while Chrome on Linux sometimes sets it to something
        // else when it's supposed to send 'none' (drag operation aborted).
        var dropEffect = dndDropEffectWorkaround.dropEffect;
        scope.$apply(function() {
          switch (dropEffect) {
            case "move":
              $parse(attr.dndMoved)(scope, {event: event});
              break;

            case "copy":
              $parse(attr.dndCopied)(scope, {event: event});
              break;
          }
        });

        // Clean up
        element.removeClass("dndDragging");
        element.removeClass("dndDraggingSource");
        dndDragTypeWorkaround.isDragging = false;
        event.stopPropagation();
      });

      /**
       * When the element is clicked we invoke the callback function
       * specified with the dnd-selected attribute.
       */
      element.on('click', function(event) {
        event = event.originalEvent || event;

        scope.$apply(function() {
          $parse(attr.dndSelected)(scope, {event: event});
        });

        event.stopPropagation();
      });

      /**
       * Workaround to make element draggable in IE9
       */
      element.on('selectstart', function() {
        if (this.dragDrop) this.dragDrop();
        return false;
      });
    };
  }])

  /**
   * Use the dnd-list attribute to make your list element a dropzone. Usually you will add a single
   * li element as child with the ng-repeat directive. If you don't do that, we will not be able to
   * position the dropped element correctly. If you want your list to be sortable, also add the
   * dnd-draggable directive to your li element(s). Both the dnd-list and it's direct children must
   * have position: relative CSS style, otherwise the positioning algorithm will not be able to
   * determine the correct placeholder position in all browsers.
   *
   * Attributes:
   * - dnd-list             Required attribute. The value has to be the array in which the data of
   *                        the dropped element should be inserted.
   * - dnd-allowed-types    Optional array of allowed item types. When used, only items that had a
   *                        matching dnd-type attribute will be dropable.
   * - dnd-disable-if       Optional boolean expresssion. When it evaluates to true, no dropping
   *                        into the list is possible. Note that this also disables rearranging
   *                        items inside the list.
   * - dnd-horizontal-list  Optional boolean expresssion. When it evaluates to true, the positioning
   *                        algorithm will use the left and right halfs of the list items instead of
   *                        the upper and lower halfs.
   * - dnd-dragover         Optional expression that is invoked when an element is dragged over the
   *                        list. If the expression is set, but does not return true, the element is
   *                        not allowed to be dropped. The following variables will be available:
   *                        - event: The original dragover event sent by the browser.
   *                        - index: The position in the list at which the element would be dropped.
   *                        - type: The dnd-type set on the dnd-draggable, or undefined if unset.
   * - dnd-drop             Optional expression that is invoked when an element is dropped over the
   *                        list. If the expression is set, it must return the object that will be
   *                        inserted into the list. If it returns false, the drop will be aborted
   *                        and the event is propagated. The following variables will be available:
   *                        - event: The original drop event sent by the browser.
   *                        - index: The position in the list at which the element would be dropped.
   *                        - item: The transferred object.
   *                        - type: The dnd-type set on the dnd-draggable, or undefined if unset.
   * - dnd-external-sources Optional boolean expression. When it evaluates to true, the list accepts
   *                        drops from sources outside of the current browser tab. This allows to
   *                        drag and drop accross different browser tabs. Note that this will allow
   *                        to drop arbitrary text into the list, thus it is highly recommended to
   *                        implement the dnd-drop callback to check the incoming element for
   *                        sanity. Furthermore, the dnd-type of external sources can not be
   *                        determined, therefore do not rely on restrictions of dnd-allowed-type.
   *
   * CSS classes:
   * - dndPlaceholder       When an element is dragged over the list, a new placeholder child
   *                        element will be added. This element is of type li and has the class
   *                        dndPlaceholder set.
   * - dndDragover          Will be added to the list while an element is dragged over the list.
   */
  .directive('dndList', ['$parse', '$timeout', 'dndDropEffectWorkaround', 'dndDragTypeWorkaround',
                 function($parse,   $timeout,   dndDropEffectWorkaround,   dndDragTypeWorkaround) {
    return function(scope, element, attr) {
      // While an element is dragged over the list, this placeholder element is inserted
      // at the location where the element would be inserted after dropping
      var placeholder = angular.element("<li class='dndPlaceholder'></li>");
      var placeholderNode = placeholder[0];
      var listNode = element[0];

      var horizontal = attr.dndHorizontalList && scope.$eval(attr.dndHorizontalList);
      var externalSources = attr.dndExternalSources && scope.$eval(attr.dndExternalSources);

      /**
       * The dragover event is triggered "every few hundred milliseconds" while an element
       * is being dragged over our list, or over an child element.
       */
      element.on('dragover', function(event) {
        event = event.originalEvent || event;

        if (!isDropAllowed(event)) return true;

        // First of all, make sure that the placeholder is shown
        // This is especially important if the list is empty
        if (placeholderNode.parentNode != listNode) {
          element.append(placeholder);
        }

        if (event.target !== listNode) {
          // Try to find the node direct directly below the list node.
          var listItemNode = event.target;
          while (listItemNode.parentNode !== listNode && listItemNode.parentNode) {
            listItemNode = listItemNode.parentNode;
          }

          if (listItemNode.parentNode === listNode && listItemNode !== placeholderNode) {
            // If the mouse pointer is in the upper half of the child element,
            // we place it before the child element, otherwise below it.
            if (isMouseInFirstHalf(event, listItemNode)) {
              listNode.insertBefore(placeholderNode, listItemNode);
            } else {
              listNode.insertBefore(placeholderNode, listItemNode.nextSibling);
            }
          }
        } else {
          // This branch is reached when we are dragging directly over the list element.
          // Usually we wouldn't need to do anything here, but the IE does not fire it's
          // events for the child element, only for the list directly. Therefore we repeat
          // the positioning algorithm for IE here.
          if (isMouseInFirstHalf(event, placeholderNode, true)) {
            // Check if we should move the placeholder element one spot towards the top.
            // Note that display none elements will have offsetTop and offsetHeight set to
            // zero, therefore we need a special check for them.
            while (placeholderNode.previousElementSibling
                 && (isMouseInFirstHalf(event, placeholderNode.previousElementSibling, true)
                 || placeholderNode.previousElementSibling.offsetHeight === 0)) {
              listNode.insertBefore(placeholderNode, placeholderNode.previousElementSibling);
            }
          } else {
            // Check if we should move the placeholder element one spot towards the bottom
            while (placeholderNode.nextElementSibling &&
                 !isMouseInFirstHalf(event, placeholderNode.nextElementSibling, true)) {
              listNode.insertBefore(placeholderNode,
                  placeholderNode.nextElementSibling.nextElementSibling);
            }
          }
        }

        // At this point we invoke the callback, which still can disallow the drop.
        // We can't do this earlier because we want to pass the index of the placeholder.
        if (attr.dndDragover && !invokeCallback(attr.dndDragover, event)) {
          return stopDragover();
        }

        element.addClass("dndDragover");
        event.preventDefault();
        event.stopPropagation();
        return false;
      });

      /**
       * When the element is dropped, we use the position of the placeholder element as the
       * position where we insert the transferred data. This assumes that the list has exactly
       * one child element per array element.
       */
      element.on('drop', function(event) {
        event = event.originalEvent || event;

        if (!isDropAllowed(event)) return true;

        // The default behavior in Firefox is to interpret the dropped element as URL and
        // forward to it. We want to prevent that even if our drop is aborted.
        event.preventDefault();

        // Unserialize the data that was serialized in dragstart. According to the HTML5 specs,
        // the "Text" drag type will be converted to text/plain, but IE does not do that.
        var data = event.dataTransfer.getData("Text") || event.dataTransfer.getData("text/plain");
        var transferredObject;
        try {
          transferredObject = JSON.parse(data);
        } catch(e) {
          return stopDragover();
        }

        // Invoke the callback, which can transform the transferredObject and even abort the drop.
        if (attr.dndDrop) {
          transferredObject = invokeCallback(attr.dndDrop, event, transferredObject);
          if (!transferredObject) {
            return stopDragover();
          }
        }

        // Retrieve the JSON array and insert the transferred object into it.
        var targetArray = scope.$eval(attr.dndList);
        scope.$apply(function() {
          targetArray.splice(getPlaceholderIndex(), 0, transferredObject);
        });

        // In Chrome on Windows the dropEffect will always be none...
        // We have to determine the actual effect manually from the allowed effects
        if (event.dataTransfer.dropEffect === "none") {
          if (event.dataTransfer.effectAllowed === "copy" ||
              event.dataTransfer.effectAllowed === "move") {
            dndDropEffectWorkaround.dropEffect = event.dataTransfer.effectAllowed;
          } else {
            dndDropEffectWorkaround.dropEffect = event.ctrlKey ? "copy" : "move";
          }
        } else {
          dndDropEffectWorkaround.dropEffect = event.dataTransfer.dropEffect;
        }

        // Clean up
        stopDragover();
        event.stopPropagation();
        return false;
      });

      /**
       * We have to remove the placeholder when the element is no longer dragged over our list. The
       * problem is that the dragleave event is not only fired when the element leaves our list,
       * but also when it leaves a child element -- so practically it's fired all the time. As a
       * workaround we wait a few milliseconds and then check if the dndDragover class was added
       * again. If it is there, dragover must have been called in the meantime, i.e. the element
       * is still dragging over the list. If you know a better way of doing this, please tell me!
       */
      element.on('dragleave', function(event) {
        event = event.originalEvent || event;

        element.removeClass("dndDragover");
        $timeout(function() {
          if (!element.hasClass("dndDragover")) {
            placeholder.remove();
          }
        }, 100);
      });

      /**
       * Checks whether the mouse pointer is in the first half of the given target element.
       *
       * In Chrome we can just use offsetY, but in Firefox we have to use layerY, which only
       * works if the child element has position relative. In IE the events are only triggered
       * on the listNode instead of the listNodeItem, therefore the mouse positions are
       * relative to the parent element of targetNode.
       */
      function isMouseInFirstHalf(event, targetNode, relativeToParent) {
        var mousePointer = horizontal ? (event.offsetX || event.layerX)
                                      : (event.offsetY || event.layerY);
        var targetSize = horizontal ? targetNode.offsetWidth : targetNode.offsetHeight;
        var targetPosition = horizontal ? targetNode.offsetLeft : targetNode.offsetTop;
        targetPosition = relativeToParent ? targetPosition : 0;
        return mousePointer < targetPosition + targetSize / 2;
      }

      /**
       * We use the position of the placeholder node to determine at which position of the array the
       * object needs to be inserted
       */
      function getPlaceholderIndex() {
        return Array.prototype.indexOf.call(listNode.children, placeholderNode);
      }

      /**
       * Checks various conditions that must be fulfilled for a drop to be allowed
       */
      function isDropAllowed(event) {
        // Disallow drop from external source unless it's allowed explicitly.
        if (!dndDragTypeWorkaround.isDragging && !externalSources) return false;

        // Check mimetype. Usually we would use a custom drag type instead of Text, but IE doesn't
        // support that.
        if (!hasTextMimetype(event.dataTransfer.types)) return false;

        // Now check the dnd-allowed-types against the type of the incoming element. For drops from
        // external sources we don't know the type, so it will need to be checked via dnd-drop.
        if (attr.dndAllowedTypes && dndDragTypeWorkaround.isDragging) {
          var allowed = scope.$eval(attr.dndAllowedTypes);
          if (angular.isArray(allowed) && allowed.indexOf(dndDragTypeWorkaround.dragType) === -1) {
            return false;
          }
        }

        // Check whether droping is disabled completely
        if (attr.dndDisableIf && scope.$eval(attr.dndDisableIf)) return false;

        return true;
      }

      /**
       * Small helper function that cleans up if we aborted a drop.
       */
      function stopDragover() {
        placeholder.remove();
        element.removeClass("dndDragover");
        return true;
      }

      /**
       * Invokes a callback with some interesting parameters and returns the callbacks return value.
       */
      function invokeCallback(expression, event, item) {
        return $parse(expression)(scope, {
          event: event,
          index: getPlaceholderIndex(),
          item: item || undefined,
          external: !dndDragTypeWorkaround.isDragging,
          type: dndDragTypeWorkaround.isDragging ? dndDragTypeWorkaround.dragType : undefined
        });
      }

      /**
       * Check if the dataTransfer object contains a drag type that we can handle. In old versions
       * of IE the types collection will not even be there, so we just assume a drop is possible.
       */
      function hasTextMimetype(types) {
        if (!types) return true;
        for (var i = 0; i < types.length; i++) {
          if (types[i] === "Text" || types[i] === "text/plain") return true;
        }

        return false;
      }
    };
  }])

  /**
   * This workaround handles the fact that Internet Explorer does not support drag types other than
   * "Text" and "URL". That means we can not know whether the data comes from one of our elements or
   * is just some other data like a text selection. As a workaround we save the isDragging flag in
   * here. When a dropover event occurs, we only allow the drop if we are already dragging, because
   * that means the element is ours.
   */
  .factory('dndDragTypeWorkaround', function(){ return {} })

  /**
   * Chrome on Windows does not set the dropEffect field, which we need in dragend to determine
   * whether a drag operation was successful. Therefore we have to maintain it in this global
   * variable. The bug report for that has been open for years:
   * https://code.google.com/p/chromium/issues/detail?id=39399
   */
  .factory('dndDropEffectWorkaround', function(){ return {} });

/**
 * Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */

(function(factory, root) {
    if (typeof define == "function" && define.amd) {
        // AMD. Register as an anonymous module.
        define(factory);
    } else if (typeof module != "undefined" && typeof exports == "object") {
        // Node/CommonJS style
        module.exports = factory();
    } else {
        // No AMD or CommonJS support so we place Rangy in (probably) the global variable
        root.rangy = factory();
    }
})(function() {

    var OBJECT = "object", FUNCTION = "function", UNDEFINED = "undefined";

    // Minimal set of properties required for DOM Level 2 Range compliance. Comparison constants such as START_TO_START
    // are omitted because ranges in KHTML do not have them but otherwise work perfectly well. See issue 113.
    var domRangeProperties = ["startContainer", "startOffset", "endContainer", "endOffset", "collapsed",
        "commonAncestorContainer"];

    // Minimal set of methods required for DOM Level 2 Range compliance
    var domRangeMethods = ["setStart", "setStartBefore", "setStartAfter", "setEnd", "setEndBefore",
        "setEndAfter", "collapse", "selectNode", "selectNodeContents", "compareBoundaryPoints", "deleteContents",
        "extractContents", "cloneContents", "insertNode", "surroundContents", "cloneRange", "toString", "detach"];

    var textRangeProperties = ["boundingHeight", "boundingLeft", "boundingTop", "boundingWidth", "htmlText", "text"];

    // Subset of TextRange's full set of methods that we're interested in
    var textRangeMethods = ["collapse", "compareEndPoints", "duplicate", "moveToElementText", "parentElement", "select",
        "setEndPoint", "getBoundingClientRect"];

    /*----------------------------------------------------------------------------------------------------------------*/

    // Trio of functions taken from Peter Michaux's article:
    // http://peter.michaux.ca/articles/feature-detection-state-of-the-art-browser-scripting
    function isHostMethod(o, p) {
        var t = typeof o[p];
        return t == FUNCTION || (!!(t == OBJECT && o[p])) || t == "unknown";
    }

    function isHostObject(o, p) {
        return !!(typeof o[p] == OBJECT && o[p]);
    }

    function isHostProperty(o, p) {
        return typeof o[p] != UNDEFINED;
    }

    // Creates a convenience function to save verbose repeated calls to tests functions
    function createMultiplePropertyTest(testFunc) {
        return function(o, props) {
            var i = props.length;
            while (i--) {
                if (!testFunc(o, props[i])) {
                    return false;
                }
            }
            return true;
        };
    }

    // Next trio of functions are a convenience to save verbose repeated calls to previous two functions
    var areHostMethods = createMultiplePropertyTest(isHostMethod);
    var areHostObjects = createMultiplePropertyTest(isHostObject);
    var areHostProperties = createMultiplePropertyTest(isHostProperty);

    function isTextRange(range) {
        return range && areHostMethods(range, textRangeMethods) && areHostProperties(range, textRangeProperties);
    }

    function getBody(doc) {
        return isHostObject(doc, "body") ? doc.body : doc.getElementsByTagName("body")[0];
    }

    var forEach = [].forEach ?
        function(arr, func) {
            arr.forEach(func);
        } :
        function(arr, func) {
            for (var i = 0, len = arr.length; i < len; ++i) {
                func(arr[i], i);
            }
        };

    var modules = {};

    var isBrowser = (typeof window != UNDEFINED && typeof document != UNDEFINED);

    var util = {
        isHostMethod: isHostMethod,
        isHostObject: isHostObject,
        isHostProperty: isHostProperty,
        areHostMethods: areHostMethods,
        areHostObjects: areHostObjects,
        areHostProperties: areHostProperties,
        isTextRange: isTextRange,
        getBody: getBody,
        forEach: forEach
    };

    var api = {
        version: "1.3.0",
        initialized: false,
        isBrowser: isBrowser,
        supported: true,
        util: util,
        features: {},
        modules: modules,
        config: {
            alertOnFail: false,
            alertOnWarn: false,
            preferTextRange: false,
            autoInitialize: (typeof rangyAutoInitialize == UNDEFINED) ? true : rangyAutoInitialize
        }
    };

    function consoleLog(msg) {
        if (typeof console != UNDEFINED && isHostMethod(console, "log")) {
            console.log(msg);
        }
    }

    function alertOrLog(msg, shouldAlert) {
        if (isBrowser && shouldAlert) {
            alert(msg);
        } else  {
            consoleLog(msg);
        }
    }

    function fail(reason) {
        api.initialized = true;
        api.supported = false;
        alertOrLog("Rangy is not supported in this environment. Reason: " + reason, api.config.alertOnFail);
    }

    api.fail = fail;

    function warn(msg) {
        alertOrLog("Rangy warning: " + msg, api.config.alertOnWarn);
    }

    api.warn = warn;

    // Add utility extend() method
    var extend;
    if ({}.hasOwnProperty) {
        util.extend = extend = function(obj, props, deep) {
            var o, p;
            for (var i in props) {
                if (props.hasOwnProperty(i)) {
                    o = obj[i];
                    p = props[i];
                    if (deep && o !== null && typeof o == "object" && p !== null && typeof p == "object") {
                        extend(o, p, true);
                    }
                    obj[i] = p;
                }
            }
            // Special case for toString, which does not show up in for...in loops in IE <= 8
            if (props.hasOwnProperty("toString")) {
                obj.toString = props.toString;
            }
            return obj;
        };

        util.createOptions = function(optionsParam, defaults) {
            var options = {};
            extend(options, defaults);
            if (optionsParam) {
                extend(options, optionsParam);
            }
            return options;
        };
    } else {
        fail("hasOwnProperty not supported");
    }

    // Test whether we're in a browser and bail out if not
    if (!isBrowser) {
        fail("Rangy can only run in a browser");
    }

    // Test whether Array.prototype.slice can be relied on for NodeLists and use an alternative toArray() if not
    (function() {
        var toArray;

        if (isBrowser) {
            var el = document.createElement("div");
            el.appendChild(document.createElement("span"));
            var slice = [].slice;
            try {
                if (slice.call(el.childNodes, 0)[0].nodeType == 1) {
                    toArray = function(arrayLike) {
                        return slice.call(arrayLike, 0);
                    };
                }
            } catch (e) {}
        }

        if (!toArray) {
            toArray = function(arrayLike) {
                var arr = [];
                for (var i = 0, len = arrayLike.length; i < len; ++i) {
                    arr[i] = arrayLike[i];
                }
                return arr;
            };
        }

        util.toArray = toArray;
    })();

    // Very simple event handler wrapper function that doesn't attempt to solve issues such as "this" handling or
    // normalization of event properties
    var addListener;
    if (isBrowser) {
        if (isHostMethod(document, "addEventListener")) {
            addListener = function(obj, eventType, listener) {
                obj.addEventListener(eventType, listener, false);
            };
        } else if (isHostMethod(document, "attachEvent")) {
            addListener = function(obj, eventType, listener) {
                obj.attachEvent("on" + eventType, listener);
            };
        } else {
            fail("Document does not have required addEventListener or attachEvent method");
        }

        util.addListener = addListener;
    }

    var initListeners = [];

    function getErrorDesc(ex) {
        return ex.message || ex.description || String(ex);
    }

    // Initialization
    function init() {
        if (!isBrowser || api.initialized) {
            return;
        }
        var testRange;
        var implementsDomRange = false, implementsTextRange = false;

        // First, perform basic feature tests

        if (isHostMethod(document, "createRange")) {
            testRange = document.createRange();
            if (areHostMethods(testRange, domRangeMethods) && areHostProperties(testRange, domRangeProperties)) {
                implementsDomRange = true;
            }
        }

        var body = getBody(document);
        if (!body || body.nodeName.toLowerCase() != "body") {
            fail("No body element found");
            return;
        }

        if (body && isHostMethod(body, "createTextRange")) {
            testRange = body.createTextRange();
            if (isTextRange(testRange)) {
                implementsTextRange = true;
            }
        }

        if (!implementsDomRange && !implementsTextRange) {
            fail("Neither Range nor TextRange are available");
            return;
        }

        api.initialized = true;
        api.features = {
            implementsDomRange: implementsDomRange,
            implementsTextRange: implementsTextRange
        };

        // Initialize modules
        var module, errorMessage;
        for (var moduleName in modules) {
            if ( (module = modules[moduleName]) instanceof Module ) {
                module.init(module, api);
            }
        }

        // Call init listeners
        for (var i = 0, len = initListeners.length; i < len; ++i) {
            try {
                initListeners[i](api);
            } catch (ex) {
                errorMessage = "Rangy init listener threw an exception. Continuing. Detail: " + getErrorDesc(ex);
                consoleLog(errorMessage);
            }
        }
    }

    function deprecationNotice(deprecated, replacement, module) {
        if (module) {
            deprecated += " in module " + module.name;
        }
        api.warn("DEPRECATED: " + deprecated + " is deprecated. Please use " +
        replacement + " instead.");
    }

    function createAliasForDeprecatedMethod(owner, deprecated, replacement, module) {
        owner[deprecated] = function() {
            deprecationNotice(deprecated, replacement, module);
            return owner[replacement].apply(owner, util.toArray(arguments));
        };
    }

    util.deprecationNotice = deprecationNotice;
    util.createAliasForDeprecatedMethod = createAliasForDeprecatedMethod;

    // Allow external scripts to initialize this library in case it's loaded after the document has loaded
    api.init = init;

    // Execute listener immediately if already initialized
    api.addInitListener = function(listener) {
        if (api.initialized) {
            listener(api);
        } else {
            initListeners.push(listener);
        }
    };

    var shimListeners = [];

    api.addShimListener = function(listener) {
        shimListeners.push(listener);
    };

    function shim(win) {
        win = win || window;
        init();

        // Notify listeners
        for (var i = 0, len = shimListeners.length; i < len; ++i) {
            shimListeners[i](win);
        }
    }

    if (isBrowser) {
        api.shim = api.createMissingNativeApi = shim;
        createAliasForDeprecatedMethod(api, "createMissingNativeApi", "shim");
    }

    function Module(name, dependencies, initializer) {
        this.name = name;
        this.dependencies = dependencies;
        this.initialized = false;
        this.supported = false;
        this.initializer = initializer;
    }

    Module.prototype = {
        init: function() {
            var requiredModuleNames = this.dependencies || [];
            for (var i = 0, len = requiredModuleNames.length, requiredModule, moduleName; i < len; ++i) {
                moduleName = requiredModuleNames[i];

                requiredModule = modules[moduleName];
                if (!requiredModule || !(requiredModule instanceof Module)) {
                    throw new Error("required module '" + moduleName + "' not found");
                }

                requiredModule.init();

                if (!requiredModule.supported) {
                    throw new Error("required module '" + moduleName + "' not supported");
                }
            }

            // Now run initializer
            this.initializer(this);
        },

        fail: function(reason) {
            this.initialized = true;
            this.supported = false;
            throw new Error(reason);
        },

        warn: function(msg) {
            api.warn("Module " + this.name + ": " + msg);
        },

        deprecationNotice: function(deprecated, replacement) {
            api.warn("DEPRECATED: " + deprecated + " in module " + this.name + " is deprecated. Please use " +
                replacement + " instead");
        },

        createError: function(msg) {
            return new Error("Error in Rangy " + this.name + " module: " + msg);
        }
    };

    function createModule(name, dependencies, initFunc) {
        var newModule = new Module(name, dependencies, function(module) {
            if (!module.initialized) {
                module.initialized = true;
                try {
                    initFunc(api, module);
                    module.supported = true;
                } catch (ex) {
                    var errorMessage = "Module '" + name + "' failed to load: " + getErrorDesc(ex);
                    consoleLog(errorMessage);
                    if (ex.stack) {
                        consoleLog(ex.stack);
                    }
                }
            }
        });
        modules[name] = newModule;
        return newModule;
    }

    api.createModule = function(name) {
        // Allow 2 or 3 arguments (second argument is an optional array of dependencies)
        var initFunc, dependencies;
        if (arguments.length == 2) {
            initFunc = arguments[1];
            dependencies = [];
        } else {
            initFunc = arguments[2];
            dependencies = arguments[1];
        }

        var module = createModule(name, dependencies, initFunc);

        // Initialize the module immediately if the core is already initialized
        if (api.initialized && api.supported) {
            module.init();
        }
    };

    api.createCoreModule = function(name, dependencies, initFunc) {
        createModule(name, dependencies, initFunc);
    };

    /*----------------------------------------------------------------------------------------------------------------*/

    // Ensure rangy.rangePrototype and rangy.selectionPrototype are available immediately

    function RangePrototype() {}
    api.RangePrototype = RangePrototype;
    api.rangePrototype = new RangePrototype();

    function SelectionPrototype() {}
    api.selectionPrototype = new SelectionPrototype();

    /*----------------------------------------------------------------------------------------------------------------*/

    // DOM utility methods used by Rangy
    api.createCoreModule("DomUtil", [], function(api, module) {
        var UNDEF = "undefined";
        var util = api.util;
        var getBody = util.getBody;

        // Perform feature tests
        if (!util.areHostMethods(document, ["createDocumentFragment", "createElement", "createTextNode"])) {
            module.fail("document missing a Node creation method");
        }

        if (!util.isHostMethod(document, "getElementsByTagName")) {
            module.fail("document missing getElementsByTagName method");
        }

        var el = document.createElement("div");
        if (!util.areHostMethods(el, ["insertBefore", "appendChild", "cloneNode"] ||
                !util.areHostObjects(el, ["previousSibling", "nextSibling", "childNodes", "parentNode"]))) {
            module.fail("Incomplete Element implementation");
        }

        // innerHTML is required for Range's createContextualFragment method
        if (!util.isHostProperty(el, "innerHTML")) {
            module.fail("Element is missing innerHTML property");
        }

        var textNode = document.createTextNode("test");
        if (!util.areHostMethods(textNode, ["splitText", "deleteData", "insertData", "appendData", "cloneNode"] ||
                !util.areHostObjects(el, ["previousSibling", "nextSibling", "childNodes", "parentNode"]) ||
                !util.areHostProperties(textNode, ["data"]))) {
            module.fail("Incomplete Text Node implementation");
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        // Removed use of indexOf because of a bizarre bug in Opera that is thrown in one of the Acid3 tests. I haven't been
        // able to replicate it outside of the test. The bug is that indexOf returns -1 when called on an Array that
        // contains just the document as a single element and the value searched for is the document.
        var arrayContains = /*Array.prototype.indexOf ?
            function(arr, val) {
                return arr.indexOf(val) > -1;
            }:*/

            function(arr, val) {
                var i = arr.length;
                while (i--) {
                    if (arr[i] === val) {
                        return true;
                    }
                }
                return false;
            };

        // Opera 11 puts HTML elements in the null namespace, it seems, and IE 7 has undefined namespaceURI
        function isHtmlNamespace(node) {
            var ns;
            return typeof node.namespaceURI == UNDEF || ((ns = node.namespaceURI) === null || ns == "http://www.w3.org/1999/xhtml");
        }

        function parentElement(node) {
            var parent = node.parentNode;
            return (parent.nodeType == 1) ? parent : null;
        }

        function getNodeIndex(node) {
            var i = 0;
            while( (node = node.previousSibling) ) {
                ++i;
            }
            return i;
        }

        function getNodeLength(node) {
            switch (node.nodeType) {
                case 7:
                case 10:
                    return 0;
                case 3:
                case 8:
                    return node.length;
                default:
                    return node.childNodes.length;
            }
        }

        function getCommonAncestor(node1, node2) {
            var ancestors = [], n;
            for (n = node1; n; n = n.parentNode) {
                ancestors.push(n);
            }

            for (n = node2; n; n = n.parentNode) {
                if (arrayContains(ancestors, n)) {
                    return n;
                }
            }

            return null;
        }

        function isAncestorOf(ancestor, descendant, selfIsAncestor) {
            var n = selfIsAncestor ? descendant : descendant.parentNode;
            while (n) {
                if (n === ancestor) {
                    return true;
                } else {
                    n = n.parentNode;
                }
            }
            return false;
        }

        function isOrIsAncestorOf(ancestor, descendant) {
            return isAncestorOf(ancestor, descendant, true);
        }

        function getClosestAncestorIn(node, ancestor, selfIsAncestor) {
            var p, n = selfIsAncestor ? node : node.parentNode;
            while (n) {
                p = n.parentNode;
                if (p === ancestor) {
                    return n;
                }
                n = p;
            }
            return null;
        }

        function isCharacterDataNode(node) {
            var t = node.nodeType;
            return t == 3 || t == 4 || t == 8 ; // Text, CDataSection or Comment
        }

        function isTextOrCommentNode(node) {
            if (!node) {
                return false;
            }
            var t = node.nodeType;
            return t == 3 || t == 8 ; // Text or Comment
        }

        function insertAfter(node, precedingNode) {
            var nextNode = precedingNode.nextSibling, parent = precedingNode.parentNode;
            if (nextNode) {
                parent.insertBefore(node, nextNode);
            } else {
                parent.appendChild(node);
            }
            return node;
        }

        // Note that we cannot use splitText() because it is bugridden in IE 9.
        function splitDataNode(node, index, positionsToPreserve) {
            var newNode = node.cloneNode(false);
            newNode.deleteData(0, index);
            node.deleteData(index, node.length - index);
            insertAfter(newNode, node);

            // Preserve positions
            if (positionsToPreserve) {
                for (var i = 0, position; position = positionsToPreserve[i++]; ) {
                    // Handle case where position was inside the portion of node after the split point
                    if (position.node == node && position.offset > index) {
                        position.node = newNode;
                        position.offset -= index;
                    }
                    // Handle the case where the position is a node offset within node's parent
                    else if (position.node == node.parentNode && position.offset > getNodeIndex(node)) {
                        ++position.offset;
                    }
                }
            }
            return newNode;
        }

        function getDocument(node) {
            if (node.nodeType == 9) {
                return node;
            } else if (typeof node.ownerDocument != UNDEF) {
                return node.ownerDocument;
            } else if (typeof node.document != UNDEF) {
                return node.document;
            } else if (node.parentNode) {
                return getDocument(node.parentNode);
            } else {
                throw module.createError("getDocument: no document found for node");
            }
        }

        function getWindow(node) {
            var doc = getDocument(node);
            if (typeof doc.defaultView != UNDEF) {
                return doc.defaultView;
            } else if (typeof doc.parentWindow != UNDEF) {
                return doc.parentWindow;
            } else {
                throw module.createError("Cannot get a window object for node");
            }
        }

        function getIframeDocument(iframeEl) {
            if (typeof iframeEl.contentDocument != UNDEF) {
                return iframeEl.contentDocument;
            } else if (typeof iframeEl.contentWindow != UNDEF) {
                return iframeEl.contentWindow.document;
            } else {
                throw module.createError("getIframeDocument: No Document object found for iframe element");
            }
        }

        function getIframeWindow(iframeEl) {
            if (typeof iframeEl.contentWindow != UNDEF) {
                return iframeEl.contentWindow;
            } else if (typeof iframeEl.contentDocument != UNDEF) {
                return iframeEl.contentDocument.defaultView;
            } else {
                throw module.createError("getIframeWindow: No Window object found for iframe element");
            }
        }

        // This looks bad. Is it worth it?
        function isWindow(obj) {
            return obj && util.isHostMethod(obj, "setTimeout") && util.isHostObject(obj, "document");
        }

        function getContentDocument(obj, module, methodName) {
            var doc;

            if (!obj) {
                doc = document;
            }

            // Test if a DOM node has been passed and obtain a document object for it if so
            else if (util.isHostProperty(obj, "nodeType")) {
                doc = (obj.nodeType == 1 && obj.tagName.toLowerCase() == "iframe") ?
                    getIframeDocument(obj) : getDocument(obj);
            }

            // Test if the doc parameter appears to be a Window object
            else if (isWindow(obj)) {
                doc = obj.document;
            }

            if (!doc) {
                throw module.createError(methodName + "(): Parameter must be a Window object or DOM node");
            }

            return doc;
        }

        function getRootContainer(node) {
            var parent;
            while ( (parent = node.parentNode) ) {
                node = parent;
            }
            return node;
        }

        function comparePoints(nodeA, offsetA, nodeB, offsetB) {
            // See http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html#Level-2-Range-Comparing
            var nodeC, root, childA, childB, n;
            if (nodeA == nodeB) {
                // Case 1: nodes are the same
                return offsetA === offsetB ? 0 : (offsetA < offsetB) ? -1 : 1;
            } else if ( (nodeC = getClosestAncestorIn(nodeB, nodeA, true)) ) {
                // Case 2: node C (container B or an ancestor) is a child node of A
                return offsetA <= getNodeIndex(nodeC) ? -1 : 1;
            } else if ( (nodeC = getClosestAncestorIn(nodeA, nodeB, true)) ) {
                // Case 3: node C (container A or an ancestor) is a child node of B
                return getNodeIndex(nodeC) < offsetB  ? -1 : 1;
            } else {
                root = getCommonAncestor(nodeA, nodeB);
                if (!root) {
                    throw new Error("comparePoints error: nodes have no common ancestor");
                }

                // Case 4: containers are siblings or descendants of siblings
                childA = (nodeA === root) ? root : getClosestAncestorIn(nodeA, root, true);
                childB = (nodeB === root) ? root : getClosestAncestorIn(nodeB, root, true);

                if (childA === childB) {
                    // This shouldn't be possible
                    throw module.createError("comparePoints got to case 4 and childA and childB are the same!");
                } else {
                    n = root.firstChild;
                    while (n) {
                        if (n === childA) {
                            return -1;
                        } else if (n === childB) {
                            return 1;
                        }
                        n = n.nextSibling;
                    }
                }
            }
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        // Test for IE's crash (IE 6/7) or exception (IE >= 8) when a reference to garbage-collected text node is queried
        var crashyTextNodes = false;

        function isBrokenNode(node) {
            var n;
            try {
                n = node.parentNode;
                return false;
            } catch (e) {
                return true;
            }
        }

        (function() {
            var el = document.createElement("b");
            el.innerHTML = "1";
            var textNode = el.firstChild;
            el.innerHTML = "<br />";
            crashyTextNodes = isBrokenNode(textNode);

            api.features.crashyTextNodes = crashyTextNodes;
        })();

        /*----------------------------------------------------------------------------------------------------------------*/

        function inspectNode(node) {
            if (!node) {
                return "[No node]";
            }
            if (crashyTextNodes && isBrokenNode(node)) {
                return "[Broken node]";
            }
            if (isCharacterDataNode(node)) {
                return '"' + node.data + '"';
            }
            if (node.nodeType == 1) {
                var idAttr = node.id ? ' id="' + node.id + '"' : "";
                return "<" + node.nodeName + idAttr + ">[index:" + getNodeIndex(node) + ",length:" + node.childNodes.length + "][" + (node.innerHTML || "[innerHTML not supported]").slice(0, 25) + "]";
            }
            return node.nodeName;
        }

        function fragmentFromNodeChildren(node) {
            var fragment = getDocument(node).createDocumentFragment(), child;
            while ( (child = node.firstChild) ) {
                fragment.appendChild(child);
            }
            return fragment;
        }

        var getComputedStyleProperty;
        if (typeof window.getComputedStyle != UNDEF) {
            getComputedStyleProperty = function(el, propName) {
                return getWindow(el).getComputedStyle(el, null)[propName];
            };
        } else if (typeof document.documentElement.currentStyle != UNDEF) {
            getComputedStyleProperty = function(el, propName) {
                return el.currentStyle ? el.currentStyle[propName] : "";
            };
        } else {
            module.fail("No means of obtaining computed style properties found");
        }

        function createTestElement(doc, html, contentEditable) {
            var body = getBody(doc);
            var el = doc.createElement("div");
            el.contentEditable = "" + !!contentEditable;
            if (html) {
                el.innerHTML = html;
            }

            // Insert the test element at the start of the body to prevent scrolling to the bottom in iOS (issue #292)
            var bodyFirstChild = body.firstChild;
            if (bodyFirstChild) {
                body.insertBefore(el, bodyFirstChild);
            } else {
                body.appendChild(el);
            }

            return el;
        }

        function removeNode(node) {
            return node.parentNode.removeChild(node);
        }

        function NodeIterator(root) {
            this.root = root;
            this._next = root;
        }

        NodeIterator.prototype = {
            _current: null,

            hasNext: function() {
                return !!this._next;
            },

            next: function() {
                var n = this._current = this._next;
                var child, next;
                if (this._current) {
                    child = n.firstChild;
                    if (child) {
                        this._next = child;
                    } else {
                        next = null;
                        while ((n !== this.root) && !(next = n.nextSibling)) {
                            n = n.parentNode;
                        }
                        this._next = next;
                    }
                }
                return this._current;
            },

            detach: function() {
                this._current = this._next = this.root = null;
            }
        };

        function createIterator(root) {
            return new NodeIterator(root);
        }

        function DomPosition(node, offset) {
            this.node = node;
            this.offset = offset;
        }

        DomPosition.prototype = {
            equals: function(pos) {
                return !!pos && this.node === pos.node && this.offset == pos.offset;
            },

            inspect: function() {
                return "[DomPosition(" + inspectNode(this.node) + ":" + this.offset + ")]";
            },

            toString: function() {
                return this.inspect();
            }
        };

        function DOMException(codeName) {
            this.code = this[codeName];
            this.codeName = codeName;
            this.message = "DOMException: " + this.codeName;
        }

        DOMException.prototype = {
            INDEX_SIZE_ERR: 1,
            HIERARCHY_REQUEST_ERR: 3,
            WRONG_DOCUMENT_ERR: 4,
            NO_MODIFICATION_ALLOWED_ERR: 7,
            NOT_FOUND_ERR: 8,
            NOT_SUPPORTED_ERR: 9,
            INVALID_STATE_ERR: 11,
            INVALID_NODE_TYPE_ERR: 24
        };

        DOMException.prototype.toString = function() {
            return this.message;
        };

        api.dom = {
            arrayContains: arrayContains,
            isHtmlNamespace: isHtmlNamespace,
            parentElement: parentElement,
            getNodeIndex: getNodeIndex,
            getNodeLength: getNodeLength,
            getCommonAncestor: getCommonAncestor,
            isAncestorOf: isAncestorOf,
            isOrIsAncestorOf: isOrIsAncestorOf,
            getClosestAncestorIn: getClosestAncestorIn,
            isCharacterDataNode: isCharacterDataNode,
            isTextOrCommentNode: isTextOrCommentNode,
            insertAfter: insertAfter,
            splitDataNode: splitDataNode,
            getDocument: getDocument,
            getWindow: getWindow,
            getIframeWindow: getIframeWindow,
            getIframeDocument: getIframeDocument,
            getBody: getBody,
            isWindow: isWindow,
            getContentDocument: getContentDocument,
            getRootContainer: getRootContainer,
            comparePoints: comparePoints,
            isBrokenNode: isBrokenNode,
            inspectNode: inspectNode,
            getComputedStyleProperty: getComputedStyleProperty,
            createTestElement: createTestElement,
            removeNode: removeNode,
            fragmentFromNodeChildren: fragmentFromNodeChildren,
            createIterator: createIterator,
            DomPosition: DomPosition
        };

        api.DOMException = DOMException;
    });

    /*----------------------------------------------------------------------------------------------------------------*/

    // Pure JavaScript implementation of DOM Range
    api.createCoreModule("DomRange", ["DomUtil"], function(api, module) {
        var dom = api.dom;
        var util = api.util;
        var DomPosition = dom.DomPosition;
        var DOMException = api.DOMException;

        var isCharacterDataNode = dom.isCharacterDataNode;
        var getNodeIndex = dom.getNodeIndex;
        var isOrIsAncestorOf = dom.isOrIsAncestorOf;
        var getDocument = dom.getDocument;
        var comparePoints = dom.comparePoints;
        var splitDataNode = dom.splitDataNode;
        var getClosestAncestorIn = dom.getClosestAncestorIn;
        var getNodeLength = dom.getNodeLength;
        var arrayContains = dom.arrayContains;
        var getRootContainer = dom.getRootContainer;
        var crashyTextNodes = api.features.crashyTextNodes;

        var removeNode = dom.removeNode;

        /*----------------------------------------------------------------------------------------------------------------*/

        // Utility functions

        function isNonTextPartiallySelected(node, range) {
            return (node.nodeType != 3) &&
                   (isOrIsAncestorOf(node, range.startContainer) || isOrIsAncestorOf(node, range.endContainer));
        }

        function getRangeDocument(range) {
            return range.document || getDocument(range.startContainer);
        }

        function getRangeRoot(range) {
            return getRootContainer(range.startContainer);
        }

        function getBoundaryBeforeNode(node) {
            return new DomPosition(node.parentNode, getNodeIndex(node));
        }

        function getBoundaryAfterNode(node) {
            return new DomPosition(node.parentNode, getNodeIndex(node) + 1);
        }

        function insertNodeAtPosition(node, n, o) {
            var firstNodeInserted = node.nodeType == 11 ? node.firstChild : node;
            if (isCharacterDataNode(n)) {
                if (o == n.length) {
                    dom.insertAfter(node, n);
                } else {
                    n.parentNode.insertBefore(node, o == 0 ? n : splitDataNode(n, o));
                }
            } else if (o >= n.childNodes.length) {
                n.appendChild(node);
            } else {
                n.insertBefore(node, n.childNodes[o]);
            }
            return firstNodeInserted;
        }

        function rangesIntersect(rangeA, rangeB, touchingIsIntersecting) {
            assertRangeValid(rangeA);
            assertRangeValid(rangeB);

            if (getRangeDocument(rangeB) != getRangeDocument(rangeA)) {
                throw new DOMException("WRONG_DOCUMENT_ERR");
            }

            var startComparison = comparePoints(rangeA.startContainer, rangeA.startOffset, rangeB.endContainer, rangeB.endOffset),
                endComparison = comparePoints(rangeA.endContainer, rangeA.endOffset, rangeB.startContainer, rangeB.startOffset);

            return touchingIsIntersecting ? startComparison <= 0 && endComparison >= 0 : startComparison < 0 && endComparison > 0;
        }

        function cloneSubtree(iterator) {
            var partiallySelected;
            for (var node, frag = getRangeDocument(iterator.range).createDocumentFragment(), subIterator; node = iterator.next(); ) {
                partiallySelected = iterator.isPartiallySelectedSubtree();
                node = node.cloneNode(!partiallySelected);
                if (partiallySelected) {
                    subIterator = iterator.getSubtreeIterator();
                    node.appendChild(cloneSubtree(subIterator));
                    subIterator.detach();
                }

                if (node.nodeType == 10) { // DocumentType
                    throw new DOMException("HIERARCHY_REQUEST_ERR");
                }
                frag.appendChild(node);
            }
            return frag;
        }

        function iterateSubtree(rangeIterator, func, iteratorState) {
            var it, n;
            iteratorState = iteratorState || { stop: false };
            for (var node, subRangeIterator; node = rangeIterator.next(); ) {
                if (rangeIterator.isPartiallySelectedSubtree()) {
                    if (func(node) === false) {
                        iteratorState.stop = true;
                        return;
                    } else {
                        // The node is partially selected by the Range, so we can use a new RangeIterator on the portion of
                        // the node selected by the Range.
                        subRangeIterator = rangeIterator.getSubtreeIterator();
                        iterateSubtree(subRangeIterator, func, iteratorState);
                        subRangeIterator.detach();
                        if (iteratorState.stop) {
                            return;
                        }
                    }
                } else {
                    // The whole node is selected, so we can use efficient DOM iteration to iterate over the node and its
                    // descendants
                    it = dom.createIterator(node);
                    while ( (n = it.next()) ) {
                        if (func(n) === false) {
                            iteratorState.stop = true;
                            return;
                        }
                    }
                }
            }
        }

        function deleteSubtree(iterator) {
            var subIterator;
            while (iterator.next()) {
                if (iterator.isPartiallySelectedSubtree()) {
                    subIterator = iterator.getSubtreeIterator();
                    deleteSubtree(subIterator);
                    subIterator.detach();
                } else {
                    iterator.remove();
                }
            }
        }

        function extractSubtree(iterator) {
            for (var node, frag = getRangeDocument(iterator.range).createDocumentFragment(), subIterator; node = iterator.next(); ) {

                if (iterator.isPartiallySelectedSubtree()) {
                    node = node.cloneNode(false);
                    subIterator = iterator.getSubtreeIterator();
                    node.appendChild(extractSubtree(subIterator));
                    subIterator.detach();
                } else {
                    iterator.remove();
                }
                if (node.nodeType == 10) { // DocumentType
                    throw new DOMException("HIERARCHY_REQUEST_ERR");
                }
                frag.appendChild(node);
            }
            return frag;
        }

        function getNodesInRange(range, nodeTypes, filter) {
            var filterNodeTypes = !!(nodeTypes && nodeTypes.length), regex;
            var filterExists = !!filter;
            if (filterNodeTypes) {
                regex = new RegExp("^(" + nodeTypes.join("|") + ")$");
            }

            var nodes = [];
            iterateSubtree(new RangeIterator(range, false), function(node) {
                if (filterNodeTypes && !regex.test(node.nodeType)) {
                    return;
                }
                if (filterExists && !filter(node)) {
                    return;
                }
                // Don't include a boundary container if it is a character data node and the range does not contain any
                // of its character data. See issue 190.
                var sc = range.startContainer;
                if (node == sc && isCharacterDataNode(sc) && range.startOffset == sc.length) {
                    return;
                }

                var ec = range.endContainer;
                if (node == ec && isCharacterDataNode(ec) && range.endOffset == 0) {
                    return;
                }

                nodes.push(node);
            });
            return nodes;
        }

        function inspect(range) {
            var name = (typeof range.getName == "undefined") ? "Range" : range.getName();
            return "[" + name + "(" + dom.inspectNode(range.startContainer) + ":" + range.startOffset + ", " +
                    dom.inspectNode(range.endContainer) + ":" + range.endOffset + ")]";
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        // RangeIterator code partially borrows from IERange by Tim Ryan (http://github.com/timcameronryan/IERange)

        function RangeIterator(range, clonePartiallySelectedTextNodes) {
            this.range = range;
            this.clonePartiallySelectedTextNodes = clonePartiallySelectedTextNodes;


            if (!range.collapsed) {
                this.sc = range.startContainer;
                this.so = range.startOffset;
                this.ec = range.endContainer;
                this.eo = range.endOffset;
                var root = range.commonAncestorContainer;

                if (this.sc === this.ec && isCharacterDataNode(this.sc)) {
                    this.isSingleCharacterDataNode = true;
                    this._first = this._last = this._next = this.sc;
                } else {
                    this._first = this._next = (this.sc === root && !isCharacterDataNode(this.sc)) ?
                        this.sc.childNodes[this.so] : getClosestAncestorIn(this.sc, root, true);
                    this._last = (this.ec === root && !isCharacterDataNode(this.ec)) ?
                        this.ec.childNodes[this.eo - 1] : getClosestAncestorIn(this.ec, root, true);
                }
            }
        }

        RangeIterator.prototype = {
            _current: null,
            _next: null,
            _first: null,
            _last: null,
            isSingleCharacterDataNode: false,

            reset: function() {
                this._current = null;
                this._next = this._first;
            },

            hasNext: function() {
                return !!this._next;
            },

            next: function() {
                // Move to next node
                var current = this._current = this._next;
                if (current) {
                    this._next = (current !== this._last) ? current.nextSibling : null;

                    // Check for partially selected text nodes
                    if (isCharacterDataNode(current) && this.clonePartiallySelectedTextNodes) {
                        if (current === this.ec) {
                            (current = current.cloneNode(true)).deleteData(this.eo, current.length - this.eo);
                        }
                        if (this._current === this.sc) {
                            (current = current.cloneNode(true)).deleteData(0, this.so);
                        }
                    }
                }

                return current;
            },

            remove: function() {
                var current = this._current, start, end;

                if (isCharacterDataNode(current) && (current === this.sc || current === this.ec)) {
                    start = (current === this.sc) ? this.so : 0;
                    end = (current === this.ec) ? this.eo : current.length;
                    if (start != end) {
                        current.deleteData(start, end - start);
                    }
                } else {
                    if (current.parentNode) {
                        removeNode(current);
                    } else {
                    }
                }
            },

            // Checks if the current node is partially selected
            isPartiallySelectedSubtree: function() {
                var current = this._current;
                return isNonTextPartiallySelected(current, this.range);
            },

            getSubtreeIterator: function() {
                var subRange;
                if (this.isSingleCharacterDataNode) {
                    subRange = this.range.cloneRange();
                    subRange.collapse(false);
                } else {
                    subRange = new Range(getRangeDocument(this.range));
                    var current = this._current;
                    var startContainer = current, startOffset = 0, endContainer = current, endOffset = getNodeLength(current);

                    if (isOrIsAncestorOf(current, this.sc)) {
                        startContainer = this.sc;
                        startOffset = this.so;
                    }
                    if (isOrIsAncestorOf(current, this.ec)) {
                        endContainer = this.ec;
                        endOffset = this.eo;
                    }

                    updateBoundaries(subRange, startContainer, startOffset, endContainer, endOffset);
                }
                return new RangeIterator(subRange, this.clonePartiallySelectedTextNodes);
            },

            detach: function() {
                this.range = this._current = this._next = this._first = this._last = this.sc = this.so = this.ec = this.eo = null;
            }
        };

        /*----------------------------------------------------------------------------------------------------------------*/

        var beforeAfterNodeTypes = [1, 3, 4, 5, 7, 8, 10];
        var rootContainerNodeTypes = [2, 9, 11];
        var readonlyNodeTypes = [5, 6, 10, 12];
        var insertableNodeTypes = [1, 3, 4, 5, 7, 8, 10, 11];
        var surroundNodeTypes = [1, 3, 4, 5, 7, 8];

        function createAncestorFinder(nodeTypes) {
            return function(node, selfIsAncestor) {
                var t, n = selfIsAncestor ? node : node.parentNode;
                while (n) {
                    t = n.nodeType;
                    if (arrayContains(nodeTypes, t)) {
                        return n;
                    }
                    n = n.parentNode;
                }
                return null;
            };
        }

        var getDocumentOrFragmentContainer = createAncestorFinder( [9, 11] );
        var getReadonlyAncestor = createAncestorFinder(readonlyNodeTypes);
        var getDocTypeNotationEntityAncestor = createAncestorFinder( [6, 10, 12] );

        function assertNoDocTypeNotationEntityAncestor(node, allowSelf) {
            if (getDocTypeNotationEntityAncestor(node, allowSelf)) {
                throw new DOMException("INVALID_NODE_TYPE_ERR");
            }
        }

        function assertValidNodeType(node, invalidTypes) {
            if (!arrayContains(invalidTypes, node.nodeType)) {
                throw new DOMException("INVALID_NODE_TYPE_ERR");
            }
        }

        function assertValidOffset(node, offset) {
            if (offset < 0 || offset > (isCharacterDataNode(node) ? node.length : node.childNodes.length)) {
                throw new DOMException("INDEX_SIZE_ERR");
            }
        }

        function assertSameDocumentOrFragment(node1, node2) {
            if (getDocumentOrFragmentContainer(node1, true) !== getDocumentOrFragmentContainer(node2, true)) {
                throw new DOMException("WRONG_DOCUMENT_ERR");
            }
        }

        function assertNodeNotReadOnly(node) {
            if (getReadonlyAncestor(node, true)) {
                throw new DOMException("NO_MODIFICATION_ALLOWED_ERR");
            }
        }

        function assertNode(node, codeName) {
            if (!node) {
                throw new DOMException(codeName);
            }
        }

        function isValidOffset(node, offset) {
            return offset <= (isCharacterDataNode(node) ? node.length : node.childNodes.length);
        }

        function isRangeValid(range) {
            return (!!range.startContainer && !!range.endContainer &&
                    !(crashyTextNodes && (dom.isBrokenNode(range.startContainer) || dom.isBrokenNode(range.endContainer))) &&
                    getRootContainer(range.startContainer) == getRootContainer(range.endContainer) &&
                    isValidOffset(range.startContainer, range.startOffset) &&
                    isValidOffset(range.endContainer, range.endOffset));
        }

        function assertRangeValid(range) {
            if (!isRangeValid(range)) {
                throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: (" + range.inspect() + ")");
            }
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        // Test the browser's innerHTML support to decide how to implement createContextualFragment
        var styleEl = document.createElement("style");
        var htmlParsingConforms = false;
        try {
            styleEl.innerHTML = "<b>x</b>";
            htmlParsingConforms = (styleEl.firstChild.nodeType == 3); // Opera incorrectly creates an element node
        } catch (e) {
            // IE 6 and 7 throw
        }

        api.features.htmlParsingConforms = htmlParsingConforms;

        var createContextualFragment = htmlParsingConforms ?

            // Implementation as per HTML parsing spec, trusting in the browser's implementation of innerHTML. See
            // discussion and base code for this implementation at issue 67.
            // Spec: http://html5.org/specs/dom-parsing.html#extensions-to-the-range-interface
            // Thanks to Aleks Williams.
            function(fragmentStr) {
                // "Let node the context object's start's node."
                var node = this.startContainer;
                var doc = getDocument(node);

                // "If the context object's start's node is null, raise an INVALID_STATE_ERR
                // exception and abort these steps."
                if (!node) {
                    throw new DOMException("INVALID_STATE_ERR");
                }

                // "Let element be as follows, depending on node's interface:"
                // Document, Document Fragment: null
                var el = null;

                // "Element: node"
                if (node.nodeType == 1) {
                    el = node;

                // "Text, Comment: node's parentElement"
                } else if (isCharacterDataNode(node)) {
                    el = dom.parentElement(node);
                }

                // "If either element is null or element's ownerDocument is an HTML document
                // and element's local name is "html" and element's namespace is the HTML
                // namespace"
                if (el === null || (
                    el.nodeName == "HTML" &&
                    dom.isHtmlNamespace(getDocument(el).documentElement) &&
                    dom.isHtmlNamespace(el)
                )) {

                // "let element be a new Element with "body" as its local name and the HTML
                // namespace as its namespace.""
                    el = doc.createElement("body");
                } else {
                    el = el.cloneNode(false);
                }

                // "If the node's document is an HTML document: Invoke the HTML fragment parsing algorithm."
                // "If the node's document is an XML document: Invoke the XML fragment parsing algorithm."
                // "In either case, the algorithm must be invoked with fragment as the input
                // and element as the context element."
                el.innerHTML = fragmentStr;

                // "If this raises an exception, then abort these steps. Otherwise, let new
                // children be the nodes returned."

                // "Let fragment be a new DocumentFragment."
                // "Append all new children to fragment."
                // "Return fragment."
                return dom.fragmentFromNodeChildren(el);
            } :

            // In this case, innerHTML cannot be trusted, so fall back to a simpler, non-conformant implementation that
            // previous versions of Rangy used (with the exception of using a body element rather than a div)
            function(fragmentStr) {
                var doc = getRangeDocument(this);
                var el = doc.createElement("body");
                el.innerHTML = fragmentStr;

                return dom.fragmentFromNodeChildren(el);
            };

        function splitRangeBoundaries(range, positionsToPreserve) {
            assertRangeValid(range);

            var sc = range.startContainer, so = range.startOffset, ec = range.endContainer, eo = range.endOffset;
            var startEndSame = (sc === ec);

            if (isCharacterDataNode(ec) && eo > 0 && eo < ec.length) {
                splitDataNode(ec, eo, positionsToPreserve);
            }

            if (isCharacterDataNode(sc) && so > 0 && so < sc.length) {
                sc = splitDataNode(sc, so, positionsToPreserve);
                if (startEndSame) {
                    eo -= so;
                    ec = sc;
                } else if (ec == sc.parentNode && eo >= getNodeIndex(sc)) {
                    eo++;
                }
                so = 0;
            }
            range.setStartAndEnd(sc, so, ec, eo);
        }

        function rangeToHtml(range) {
            assertRangeValid(range);
            var container = range.commonAncestorContainer.parentNode.cloneNode(false);
            container.appendChild( range.cloneContents() );
            return container.innerHTML;
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        var rangeProperties = ["startContainer", "startOffset", "endContainer", "endOffset", "collapsed",
            "commonAncestorContainer"];

        var s2s = 0, s2e = 1, e2e = 2, e2s = 3;
        var n_b = 0, n_a = 1, n_b_a = 2, n_i = 3;

        util.extend(api.rangePrototype, {
            compareBoundaryPoints: function(how, range) {
                assertRangeValid(this);
                assertSameDocumentOrFragment(this.startContainer, range.startContainer);

                var nodeA, offsetA, nodeB, offsetB;
                var prefixA = (how == e2s || how == s2s) ? "start" : "end";
                var prefixB = (how == s2e || how == s2s) ? "start" : "end";
                nodeA = this[prefixA + "Container"];
                offsetA = this[prefixA + "Offset"];
                nodeB = range[prefixB + "Container"];
                offsetB = range[prefixB + "Offset"];
                return comparePoints(nodeA, offsetA, nodeB, offsetB);
            },

            insertNode: function(node) {
                assertRangeValid(this);
                assertValidNodeType(node, insertableNodeTypes);
                assertNodeNotReadOnly(this.startContainer);

                if (isOrIsAncestorOf(node, this.startContainer)) {
                    throw new DOMException("HIERARCHY_REQUEST_ERR");
                }

                // No check for whether the container of the start of the Range is of a type that does not allow
                // children of the type of node: the browser's DOM implementation should do this for us when we attempt
                // to add the node

                var firstNodeInserted = insertNodeAtPosition(node, this.startContainer, this.startOffset);
                this.setStartBefore(firstNodeInserted);
            },

            cloneContents: function() {
                assertRangeValid(this);

                var clone, frag;
                if (this.collapsed) {
                    return getRangeDocument(this).createDocumentFragment();
                } else {
                    if (this.startContainer === this.endContainer && isCharacterDataNode(this.startContainer)) {
                        clone = this.startContainer.cloneNode(true);
                        clone.data = clone.data.slice(this.startOffset, this.endOffset);
                        frag = getRangeDocument(this).createDocumentFragment();
                        frag.appendChild(clone);
                        return frag;
                    } else {
                        var iterator = new RangeIterator(this, true);
                        clone = cloneSubtree(iterator);
                        iterator.detach();
                    }
                    return clone;
                }
            },

            canSurroundContents: function() {
                assertRangeValid(this);
                assertNodeNotReadOnly(this.startContainer);
                assertNodeNotReadOnly(this.endContainer);

                // Check if the contents can be surrounded. Specifically, this means whether the range partially selects
                // no non-text nodes.
                var iterator = new RangeIterator(this, true);
                var boundariesInvalid = (iterator._first && (isNonTextPartiallySelected(iterator._first, this)) ||
                        (iterator._last && isNonTextPartiallySelected(iterator._last, this)));
                iterator.detach();
                return !boundariesInvalid;
            },

            surroundContents: function(node) {
                assertValidNodeType(node, surroundNodeTypes);

                if (!this.canSurroundContents()) {
                    throw new DOMException("INVALID_STATE_ERR");
                }

                // Extract the contents
                var content = this.extractContents();

                // Clear the children of the node
                if (node.hasChildNodes()) {
                    while (node.lastChild) {
                        node.removeChild(node.lastChild);
                    }
                }

                // Insert the new node and add the extracted contents
                insertNodeAtPosition(node, this.startContainer, this.startOffset);
                node.appendChild(content);

                this.selectNode(node);
            },

            cloneRange: function() {
                assertRangeValid(this);
                var range = new Range(getRangeDocument(this));
                var i = rangeProperties.length, prop;
                while (i--) {
                    prop = rangeProperties[i];
                    range[prop] = this[prop];
                }
                return range;
            },

            toString: function() {
                assertRangeValid(this);
                var sc = this.startContainer;
                if (sc === this.endContainer && isCharacterDataNode(sc)) {
                    return (sc.nodeType == 3 || sc.nodeType == 4) ? sc.data.slice(this.startOffset, this.endOffset) : "";
                } else {
                    var textParts = [], iterator = new RangeIterator(this, true);
                    iterateSubtree(iterator, function(node) {
                        // Accept only text or CDATA nodes, not comments
                        if (node.nodeType == 3 || node.nodeType == 4) {
                            textParts.push(node.data);
                        }
                    });
                    iterator.detach();
                    return textParts.join("");
                }
            },

            // The methods below are all non-standard. The following batch were introduced by Mozilla but have since
            // been removed from Mozilla.

            compareNode: function(node) {
                assertRangeValid(this);

                var parent = node.parentNode;
                var nodeIndex = getNodeIndex(node);

                if (!parent) {
                    throw new DOMException("NOT_FOUND_ERR");
                }

                var startComparison = this.comparePoint(parent, nodeIndex),
                    endComparison = this.comparePoint(parent, nodeIndex + 1);

                if (startComparison < 0) { // Node starts before
                    return (endComparison > 0) ? n_b_a : n_b;
                } else {
                    return (endComparison > 0) ? n_a : n_i;
                }
            },

            comparePoint: function(node, offset) {
                assertRangeValid(this);
                assertNode(node, "HIERARCHY_REQUEST_ERR");
                assertSameDocumentOrFragment(node, this.startContainer);

                if (comparePoints(node, offset, this.startContainer, this.startOffset) < 0) {
                    return -1;
                } else if (comparePoints(node, offset, this.endContainer, this.endOffset) > 0) {
                    return 1;
                }
                return 0;
            },

            createContextualFragment: createContextualFragment,

            toHtml: function() {
                return rangeToHtml(this);
            },

            // touchingIsIntersecting determines whether this method considers a node that borders a range intersects
            // with it (as in WebKit) or not (as in Gecko pre-1.9, and the default)
            intersectsNode: function(node, touchingIsIntersecting) {
                assertRangeValid(this);
                if (getRootContainer(node) != getRangeRoot(this)) {
                    return false;
                }

                var parent = node.parentNode, offset = getNodeIndex(node);
                if (!parent) {
                    return true;
                }

                var startComparison = comparePoints(parent, offset, this.endContainer, this.endOffset),
                    endComparison = comparePoints(parent, offset + 1, this.startContainer, this.startOffset);

                return touchingIsIntersecting ? startComparison <= 0 && endComparison >= 0 : startComparison < 0 && endComparison > 0;
            },

            isPointInRange: function(node, offset) {
                assertRangeValid(this);
                assertNode(node, "HIERARCHY_REQUEST_ERR");
                assertSameDocumentOrFragment(node, this.startContainer);

                return (comparePoints(node, offset, this.startContainer, this.startOffset) >= 0) &&
                       (comparePoints(node, offset, this.endContainer, this.endOffset) <= 0);
            },

            // The methods below are non-standard and invented by me.

            // Sharing a boundary start-to-end or end-to-start does not count as intersection.
            intersectsRange: function(range) {
                return rangesIntersect(this, range, false);
            },

            // Sharing a boundary start-to-end or end-to-start does count as intersection.
            intersectsOrTouchesRange: function(range) {
                return rangesIntersect(this, range, true);
            },

            intersection: function(range) {
                if (this.intersectsRange(range)) {
                    var startComparison = comparePoints(this.startContainer, this.startOffset, range.startContainer, range.startOffset),
                        endComparison = comparePoints(this.endContainer, this.endOffset, range.endContainer, range.endOffset);

                    var intersectionRange = this.cloneRange();
                    if (startComparison == -1) {
                        intersectionRange.setStart(range.startContainer, range.startOffset);
                    }
                    if (endComparison == 1) {
                        intersectionRange.setEnd(range.endContainer, range.endOffset);
                    }
                    return intersectionRange;
                }
                return null;
            },

            union: function(range) {
                if (this.intersectsOrTouchesRange(range)) {
                    var unionRange = this.cloneRange();
                    if (comparePoints(range.startContainer, range.startOffset, this.startContainer, this.startOffset) == -1) {
                        unionRange.setStart(range.startContainer, range.startOffset);
                    }
                    if (comparePoints(range.endContainer, range.endOffset, this.endContainer, this.endOffset) == 1) {
                        unionRange.setEnd(range.endContainer, range.endOffset);
                    }
                    return unionRange;
                } else {
                    throw new DOMException("Ranges do not intersect");
                }
            },

            containsNode: function(node, allowPartial) {
                if (allowPartial) {
                    return this.intersectsNode(node, false);
                } else {
                    return this.compareNode(node) == n_i;
                }
            },

            containsNodeContents: function(node) {
                return this.comparePoint(node, 0) >= 0 && this.comparePoint(node, getNodeLength(node)) <= 0;
            },

            containsRange: function(range) {
                var intersection = this.intersection(range);
                return intersection !== null && range.equals(intersection);
            },

            containsNodeText: function(node) {
                var nodeRange = this.cloneRange();
                nodeRange.selectNode(node);
                var textNodes = nodeRange.getNodes([3]);
                if (textNodes.length > 0) {
                    nodeRange.setStart(textNodes[0], 0);
                    var lastTextNode = textNodes.pop();
                    nodeRange.setEnd(lastTextNode, lastTextNode.length);
                    return this.containsRange(nodeRange);
                } else {
                    return this.containsNodeContents(node);
                }
            },

            getNodes: function(nodeTypes, filter) {
                assertRangeValid(this);
                return getNodesInRange(this, nodeTypes, filter);
            },

            getDocument: function() {
                return getRangeDocument(this);
            },

            collapseBefore: function(node) {
                this.setEndBefore(node);
                this.collapse(false);
            },

            collapseAfter: function(node) {
                this.setStartAfter(node);
                this.collapse(true);
            },

            getBookmark: function(containerNode) {
                var doc = getRangeDocument(this);
                var preSelectionRange = api.createRange(doc);
                containerNode = containerNode || dom.getBody(doc);
                preSelectionRange.selectNodeContents(containerNode);
                var range = this.intersection(preSelectionRange);
                var start = 0, end = 0;
                if (range) {
                    preSelectionRange.setEnd(range.startContainer, range.startOffset);
                    start = preSelectionRange.toString().length;
                    end = start + range.toString().length;
                }

                return {
                    start: start,
                    end: end,
                    containerNode: containerNode
                };
            },

            moveToBookmark: function(bookmark) {
                var containerNode = bookmark.containerNode;
                var charIndex = 0;
                this.setStart(containerNode, 0);
                this.collapse(true);
                var nodeStack = [containerNode], node, foundStart = false, stop = false;
                var nextCharIndex, i, childNodes;

                while (!stop && (node = nodeStack.pop())) {
                    if (node.nodeType == 3) {
                        nextCharIndex = charIndex + node.length;
                        if (!foundStart && bookmark.start >= charIndex && bookmark.start <= nextCharIndex) {
                            this.setStart(node, bookmark.start - charIndex);
                            foundStart = true;
                        }
                        if (foundStart && bookmark.end >= charIndex && bookmark.end <= nextCharIndex) {
                            this.setEnd(node, bookmark.end - charIndex);
                            stop = true;
                        }
                        charIndex = nextCharIndex;
                    } else {
                        childNodes = node.childNodes;
                        i = childNodes.length;
                        while (i--) {
                            nodeStack.push(childNodes[i]);
                        }
                    }
                }
            },

            getName: function() {
                return "DomRange";
            },

            equals: function(range) {
                return Range.rangesEqual(this, range);
            },

            isValid: function() {
                return isRangeValid(this);
            },

            inspect: function() {
                return inspect(this);
            },

            detach: function() {
                // In DOM4, detach() is now a no-op.
            }
        });

        function copyComparisonConstantsToObject(obj) {
            obj.START_TO_START = s2s;
            obj.START_TO_END = s2e;
            obj.END_TO_END = e2e;
            obj.END_TO_START = e2s;

            obj.NODE_BEFORE = n_b;
            obj.NODE_AFTER = n_a;
            obj.NODE_BEFORE_AND_AFTER = n_b_a;
            obj.NODE_INSIDE = n_i;
        }

        function copyComparisonConstants(constructor) {
            copyComparisonConstantsToObject(constructor);
            copyComparisonConstantsToObject(constructor.prototype);
        }

        function createRangeContentRemover(remover, boundaryUpdater) {
            return function() {
                assertRangeValid(this);

                var sc = this.startContainer, so = this.startOffset, root = this.commonAncestorContainer;

                var iterator = new RangeIterator(this, true);

                // Work out where to position the range after content removal
                var node, boundary;
                if (sc !== root) {
                    node = getClosestAncestorIn(sc, root, true);
                    boundary = getBoundaryAfterNode(node);
                    sc = boundary.node;
                    so = boundary.offset;
                }

                // Check none of the range is read-only
                iterateSubtree(iterator, assertNodeNotReadOnly);

                iterator.reset();

                // Remove the content
                var returnValue = remover(iterator);
                iterator.detach();

                // Move to the new position
                boundaryUpdater(this, sc, so, sc, so);

                return returnValue;
            };
        }

        function createPrototypeRange(constructor, boundaryUpdater) {
            function createBeforeAfterNodeSetter(isBefore, isStart) {
                return function(node) {
                    assertValidNodeType(node, beforeAfterNodeTypes);
                    assertValidNodeType(getRootContainer(node), rootContainerNodeTypes);

                    var boundary = (isBefore ? getBoundaryBeforeNode : getBoundaryAfterNode)(node);
                    (isStart ? setRangeStart : setRangeEnd)(this, boundary.node, boundary.offset);
                };
            }

            function setRangeStart(range, node, offset) {
                var ec = range.endContainer, eo = range.endOffset;
                if (node !== range.startContainer || offset !== range.startOffset) {
                    // Check the root containers of the range and the new boundary, and also check whether the new boundary
                    // is after the current end. In either case, collapse the range to the new position
                    if (getRootContainer(node) != getRootContainer(ec) || comparePoints(node, offset, ec, eo) == 1) {
                        ec = node;
                        eo = offset;
                    }
                    boundaryUpdater(range, node, offset, ec, eo);
                }
            }

            function setRangeEnd(range, node, offset) {
                var sc = range.startContainer, so = range.startOffset;
                if (node !== range.endContainer || offset !== range.endOffset) {
                    // Check the root containers of the range and the new boundary, and also check whether the new boundary
                    // is after the current end. In either case, collapse the range to the new position
                    if (getRootContainer(node) != getRootContainer(sc) || comparePoints(node, offset, sc, so) == -1) {
                        sc = node;
                        so = offset;
                    }
                    boundaryUpdater(range, sc, so, node, offset);
                }
            }

            // Set up inheritance
            var F = function() {};
            F.prototype = api.rangePrototype;
            constructor.prototype = new F();

            util.extend(constructor.prototype, {
                setStart: function(node, offset) {
                    assertNoDocTypeNotationEntityAncestor(node, true);
                    assertValidOffset(node, offset);

                    setRangeStart(this, node, offset);
                },

                setEnd: function(node, offset) {
                    assertNoDocTypeNotationEntityAncestor(node, true);
                    assertValidOffset(node, offset);

                    setRangeEnd(this, node, offset);
                },

                /**
                 * Convenience method to set a range's start and end boundaries. Overloaded as follows:
                 * - Two parameters (node, offset) creates a collapsed range at that position
                 * - Three parameters (node, startOffset, endOffset) creates a range contained with node starting at
                 *   startOffset and ending at endOffset
                 * - Four parameters (startNode, startOffset, endNode, endOffset) creates a range starting at startOffset in
                 *   startNode and ending at endOffset in endNode
                 */
                setStartAndEnd: function() {
                    var args = arguments;
                    var sc = args[0], so = args[1], ec = sc, eo = so;

                    switch (args.length) {
                        case 3:
                            eo = args[2];
                            break;
                        case 4:
                            ec = args[2];
                            eo = args[3];
                            break;
                    }

                    boundaryUpdater(this, sc, so, ec, eo);
                },

                setBoundary: function(node, offset, isStart) {
                    this["set" + (isStart ? "Start" : "End")](node, offset);
                },

                setStartBefore: createBeforeAfterNodeSetter(true, true),
                setStartAfter: createBeforeAfterNodeSetter(false, true),
                setEndBefore: createBeforeAfterNodeSetter(true, false),
                setEndAfter: createBeforeAfterNodeSetter(false, false),

                collapse: function(isStart) {
                    assertRangeValid(this);
                    if (isStart) {
                        boundaryUpdater(this, this.startContainer, this.startOffset, this.startContainer, this.startOffset);
                    } else {
                        boundaryUpdater(this, this.endContainer, this.endOffset, this.endContainer, this.endOffset);
                    }
                },

                selectNodeContents: function(node) {
                    assertNoDocTypeNotationEntityAncestor(node, true);

                    boundaryUpdater(this, node, 0, node, getNodeLength(node));
                },

                selectNode: function(node) {
                    assertNoDocTypeNotationEntityAncestor(node, false);
                    assertValidNodeType(node, beforeAfterNodeTypes);

                    var start = getBoundaryBeforeNode(node), end = getBoundaryAfterNode(node);
                    boundaryUpdater(this, start.node, start.offset, end.node, end.offset);
                },

                extractContents: createRangeContentRemover(extractSubtree, boundaryUpdater),

                deleteContents: createRangeContentRemover(deleteSubtree, boundaryUpdater),

                canSurroundContents: function() {
                    assertRangeValid(this);
                    assertNodeNotReadOnly(this.startContainer);
                    assertNodeNotReadOnly(this.endContainer);

                    // Check if the contents can be surrounded. Specifically, this means whether the range partially selects
                    // no non-text nodes.
                    var iterator = new RangeIterator(this, true);
                    var boundariesInvalid = (iterator._first && isNonTextPartiallySelected(iterator._first, this) ||
                            (iterator._last && isNonTextPartiallySelected(iterator._last, this)));
                    iterator.detach();
                    return !boundariesInvalid;
                },

                splitBoundaries: function() {
                    splitRangeBoundaries(this);
                },

                splitBoundariesPreservingPositions: function(positionsToPreserve) {
                    splitRangeBoundaries(this, positionsToPreserve);
                },

                normalizeBoundaries: function() {
                    assertRangeValid(this);

                    var sc = this.startContainer, so = this.startOffset, ec = this.endContainer, eo = this.endOffset;

                    var mergeForward = function(node) {
                        var sibling = node.nextSibling;
                        if (sibling && sibling.nodeType == node.nodeType) {
                            ec = node;
                            eo = node.length;
                            node.appendData(sibling.data);
                            removeNode(sibling);
                        }
                    };

                    var mergeBackward = function(node) {
                        var sibling = node.previousSibling;
                        if (sibling && sibling.nodeType == node.nodeType) {
                            sc = node;
                            var nodeLength = node.length;
                            so = sibling.length;
                            node.insertData(0, sibling.data);
                            removeNode(sibling);
                            if (sc == ec) {
                                eo += so;
                                ec = sc;
                            } else if (ec == node.parentNode) {
                                var nodeIndex = getNodeIndex(node);
                                if (eo == nodeIndex) {
                                    ec = node;
                                    eo = nodeLength;
                                } else if (eo > nodeIndex) {
                                    eo--;
                                }
                            }
                        }
                    };

                    var normalizeStart = true;
                    var sibling;

                    if (isCharacterDataNode(ec)) {
                        if (eo == ec.length) {
                            mergeForward(ec);
                        } else if (eo == 0) {
                            sibling = ec.previousSibling;
                            if (sibling && sibling.nodeType == ec.nodeType) {
                                eo = sibling.length;
                                if (sc == ec) {
                                    normalizeStart = false;
                                }
                                sibling.appendData(ec.data);
                                removeNode(ec);
                                ec = sibling;
                            }
                        }
                    } else {
                        if (eo > 0) {
                            var endNode = ec.childNodes[eo - 1];
                            if (endNode && isCharacterDataNode(endNode)) {
                                mergeForward(endNode);
                            }
                        }
                        normalizeStart = !this.collapsed;
                    }

                    if (normalizeStart) {
                        if (isCharacterDataNode(sc)) {
                            if (so == 0) {
                                mergeBackward(sc);
                            } else if (so == sc.length) {
                                sibling = sc.nextSibling;
                                if (sibling && sibling.nodeType == sc.nodeType) {
                                    if (ec == sibling) {
                                        ec = sc;
                                        eo += sc.length;
                                    }
                                    sc.appendData(sibling.data);
                                    removeNode(sibling);
                                }
                            }
                        } else {
                            if (so < sc.childNodes.length) {
                                var startNode = sc.childNodes[so];
                                if (startNode && isCharacterDataNode(startNode)) {
                                    mergeBackward(startNode);
                                }
                            }
                        }
                    } else {
                        sc = ec;
                        so = eo;
                    }

                    boundaryUpdater(this, sc, so, ec, eo);
                },

                collapseToPoint: function(node, offset) {
                    assertNoDocTypeNotationEntityAncestor(node, true);
                    assertValidOffset(node, offset);
                    this.setStartAndEnd(node, offset);
                }
            });

            copyComparisonConstants(constructor);
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        // Updates commonAncestorContainer and collapsed after boundary change
        function updateCollapsedAndCommonAncestor(range) {
            range.collapsed = (range.startContainer === range.endContainer && range.startOffset === range.endOffset);
            range.commonAncestorContainer = range.collapsed ?
                range.startContainer : dom.getCommonAncestor(range.startContainer, range.endContainer);
        }

        function updateBoundaries(range, startContainer, startOffset, endContainer, endOffset) {
            range.startContainer = startContainer;
            range.startOffset = startOffset;
            range.endContainer = endContainer;
            range.endOffset = endOffset;
            range.document = dom.getDocument(startContainer);

            updateCollapsedAndCommonAncestor(range);
        }

        function Range(doc) {
            this.startContainer = doc;
            this.startOffset = 0;
            this.endContainer = doc;
            this.endOffset = 0;
            this.document = doc;
            updateCollapsedAndCommonAncestor(this);
        }

        createPrototypeRange(Range, updateBoundaries);

        util.extend(Range, {
            rangeProperties: rangeProperties,
            RangeIterator: RangeIterator,
            copyComparisonConstants: copyComparisonConstants,
            createPrototypeRange: createPrototypeRange,
            inspect: inspect,
            toHtml: rangeToHtml,
            getRangeDocument: getRangeDocument,
            rangesEqual: function(r1, r2) {
                return r1.startContainer === r2.startContainer &&
                    r1.startOffset === r2.startOffset &&
                    r1.endContainer === r2.endContainer &&
                    r1.endOffset === r2.endOffset;
            }
        });

        api.DomRange = Range;
    });

    /*----------------------------------------------------------------------------------------------------------------*/

    // Wrappers for the browser's native DOM Range and/or TextRange implementation
    api.createCoreModule("WrappedRange", ["DomRange"], function(api, module) {
        var WrappedRange, WrappedTextRange;
        var dom = api.dom;
        var util = api.util;
        var DomPosition = dom.DomPosition;
        var DomRange = api.DomRange;
        var getBody = dom.getBody;
        var getContentDocument = dom.getContentDocument;
        var isCharacterDataNode = dom.isCharacterDataNode;


        /*----------------------------------------------------------------------------------------------------------------*/

        if (api.features.implementsDomRange) {
            // This is a wrapper around the browser's native DOM Range. It has two aims:
            // - Provide workarounds for specific browser bugs
            // - provide convenient extensions, which are inherited from Rangy's DomRange

            (function() {
                var rangeProto;
                var rangeProperties = DomRange.rangeProperties;

                function updateRangeProperties(range) {
                    var i = rangeProperties.length, prop;
                    while (i--) {
                        prop = rangeProperties[i];
                        range[prop] = range.nativeRange[prop];
                    }
                    // Fix for broken collapsed property in IE 9.
                    range.collapsed = (range.startContainer === range.endContainer && range.startOffset === range.endOffset);
                }

                function updateNativeRange(range, startContainer, startOffset, endContainer, endOffset) {
                    var startMoved = (range.startContainer !== startContainer || range.startOffset != startOffset);
                    var endMoved = (range.endContainer !== endContainer || range.endOffset != endOffset);
                    var nativeRangeDifferent = !range.equals(range.nativeRange);

                    // Always set both boundaries for the benefit of IE9 (see issue 35)
                    if (startMoved || endMoved || nativeRangeDifferent) {
                        range.setEnd(endContainer, endOffset);
                        range.setStart(startContainer, startOffset);
                    }
                }

                var createBeforeAfterNodeSetter;

                WrappedRange = function(range) {
                    if (!range) {
                        throw module.createError("WrappedRange: Range must be specified");
                    }
                    this.nativeRange = range;
                    updateRangeProperties(this);
                };

                DomRange.createPrototypeRange(WrappedRange, updateNativeRange);

                rangeProto = WrappedRange.prototype;

                rangeProto.selectNode = function(node) {
                    this.nativeRange.selectNode(node);
                    updateRangeProperties(this);
                };

                rangeProto.cloneContents = function() {
                    return this.nativeRange.cloneContents();
                };

                // Due to a long-standing Firefox bug that I have not been able to find a reliable way to detect,
                // insertNode() is never delegated to the native range.

                rangeProto.surroundContents = function(node) {
                    this.nativeRange.surroundContents(node);
                    updateRangeProperties(this);
                };

                rangeProto.collapse = function(isStart) {
                    this.nativeRange.collapse(isStart);
                    updateRangeProperties(this);
                };

                rangeProto.cloneRange = function() {
                    return new WrappedRange(this.nativeRange.cloneRange());
                };

                rangeProto.refresh = function() {
                    updateRangeProperties(this);
                };

                rangeProto.toString = function() {
                    return this.nativeRange.toString();
                };

                // Create test range and node for feature detection

                var testTextNode = document.createTextNode("test");
                getBody(document).appendChild(testTextNode);
                var range = document.createRange();

                /*--------------------------------------------------------------------------------------------------------*/

                // Test for Firefox 2 bug that prevents moving the start of a Range to a point after its current end and
                // correct for it

                range.setStart(testTextNode, 0);
                range.setEnd(testTextNode, 0);

                try {
                    range.setStart(testTextNode, 1);

                    rangeProto.setStart = function(node, offset) {
                        this.nativeRange.setStart(node, offset);
                        updateRangeProperties(this);
                    };

                    rangeProto.setEnd = function(node, offset) {
                        this.nativeRange.setEnd(node, offset);
                        updateRangeProperties(this);
                    };

                    createBeforeAfterNodeSetter = function(name) {
                        return function(node) {
                            this.nativeRange[name](node);
                            updateRangeProperties(this);
                        };
                    };

                } catch(ex) {

                    rangeProto.setStart = function(node, offset) {
                        try {
                            this.nativeRange.setStart(node, offset);
                        } catch (ex) {
                            this.nativeRange.setEnd(node, offset);
                            this.nativeRange.setStart(node, offset);
                        }
                        updateRangeProperties(this);
                    };

                    rangeProto.setEnd = function(node, offset) {
                        try {
                            this.nativeRange.setEnd(node, offset);
                        } catch (ex) {
                            this.nativeRange.setStart(node, offset);
                            this.nativeRange.setEnd(node, offset);
                        }
                        updateRangeProperties(this);
                    };

                    createBeforeAfterNodeSetter = function(name, oppositeName) {
                        return function(node) {
                            try {
                                this.nativeRange[name](node);
                            } catch (ex) {
                                this.nativeRange[oppositeName](node);
                                this.nativeRange[name](node);
                            }
                            updateRangeProperties(this);
                        };
                    };
                }

                rangeProto.setStartBefore = createBeforeAfterNodeSetter("setStartBefore", "setEndBefore");
                rangeProto.setStartAfter = createBeforeAfterNodeSetter("setStartAfter", "setEndAfter");
                rangeProto.setEndBefore = createBeforeAfterNodeSetter("setEndBefore", "setStartBefore");
                rangeProto.setEndAfter = createBeforeAfterNodeSetter("setEndAfter", "setStartAfter");

                /*--------------------------------------------------------------------------------------------------------*/

                // Always use DOM4-compliant selectNodeContents implementation: it's simpler and less code than testing
                // whether the native implementation can be trusted
                rangeProto.selectNodeContents = function(node) {
                    this.setStartAndEnd(node, 0, dom.getNodeLength(node));
                };

                /*--------------------------------------------------------------------------------------------------------*/

                // Test for and correct WebKit bug that has the behaviour of compareBoundaryPoints round the wrong way for
                // constants START_TO_END and END_TO_START: https://bugs.webkit.org/show_bug.cgi?id=20738

                range.selectNodeContents(testTextNode);
                range.setEnd(testTextNode, 3);

                var range2 = document.createRange();
                range2.selectNodeContents(testTextNode);
                range2.setEnd(testTextNode, 4);
                range2.setStart(testTextNode, 2);

                if (range.compareBoundaryPoints(range.START_TO_END, range2) == -1 &&
                        range.compareBoundaryPoints(range.END_TO_START, range2) == 1) {
                    // This is the wrong way round, so correct for it

                    rangeProto.compareBoundaryPoints = function(type, range) {
                        range = range.nativeRange || range;
                        if (type == range.START_TO_END) {
                            type = range.END_TO_START;
                        } else if (type == range.END_TO_START) {
                            type = range.START_TO_END;
                        }
                        return this.nativeRange.compareBoundaryPoints(type, range);
                    };
                } else {
                    rangeProto.compareBoundaryPoints = function(type, range) {
                        return this.nativeRange.compareBoundaryPoints(type, range.nativeRange || range);
                    };
                }

                /*--------------------------------------------------------------------------------------------------------*/

                // Test for IE deleteContents() and extractContents() bug and correct it. See issue 107.

                var el = document.createElement("div");
                el.innerHTML = "123";
                var textNode = el.firstChild;
                var body = getBody(document);
                body.appendChild(el);

                range.setStart(textNode, 1);
                range.setEnd(textNode, 2);
                range.deleteContents();

                if (textNode.data == "13") {
                    // Behaviour is correct per DOM4 Range so wrap the browser's implementation of deleteContents() and
                    // extractContents()
                    rangeProto.deleteContents = function() {
                        this.nativeRange.deleteContents();
                        updateRangeProperties(this);
                    };

                    rangeProto.extractContents = function() {
                        var frag = this.nativeRange.extractContents();
                        updateRangeProperties(this);
                        return frag;
                    };
                } else {
                }

                body.removeChild(el);
                body = null;

                /*--------------------------------------------------------------------------------------------------------*/

                // Test for existence of createContextualFragment and delegate to it if it exists
                if (util.isHostMethod(range, "createContextualFragment")) {
                    rangeProto.createContextualFragment = function(fragmentStr) {
                        return this.nativeRange.createContextualFragment(fragmentStr);
                    };
                }

                /*--------------------------------------------------------------------------------------------------------*/

                // Clean up
                getBody(document).removeChild(testTextNode);

                rangeProto.getName = function() {
                    return "WrappedRange";
                };

                api.WrappedRange = WrappedRange;

                api.createNativeRange = function(doc) {
                    doc = getContentDocument(doc, module, "createNativeRange");
                    return doc.createRange();
                };
            })();
        }

        if (api.features.implementsTextRange) {
            /*
            This is a workaround for a bug where IE returns the wrong container element from the TextRange's parentElement()
            method. For example, in the following (where pipes denote the selection boundaries):

            <ul id="ul"><li id="a">| a </li><li id="b"> b |</li></ul>

            var range = document.selection.createRange();
            alert(range.parentElement().id); // Should alert "ul" but alerts "b"

            This method returns the common ancestor node of the following:
            - the parentElement() of the textRange
            - the parentElement() of the textRange after calling collapse(true)
            - the parentElement() of the textRange after calling collapse(false)
            */
            var getTextRangeContainerElement = function(textRange) {
                var parentEl = textRange.parentElement();
                var range = textRange.duplicate();
                range.collapse(true);
                var startEl = range.parentElement();
                range = textRange.duplicate();
                range.collapse(false);
                var endEl = range.parentElement();
                var startEndContainer = (startEl == endEl) ? startEl : dom.getCommonAncestor(startEl, endEl);

                return startEndContainer == parentEl ? startEndContainer : dom.getCommonAncestor(parentEl, startEndContainer);
            };

            var textRangeIsCollapsed = function(textRange) {
                return textRange.compareEndPoints("StartToEnd", textRange) == 0;
            };

            // Gets the boundary of a TextRange expressed as a node and an offset within that node. This function started
            // out as an improved version of code found in Tim Cameron Ryan's IERange (http://code.google.com/p/ierange/)
            // but has grown, fixing problems with line breaks in preformatted text, adding workaround for IE TextRange
            // bugs, handling for inputs and images, plus optimizations.
            var getTextRangeBoundaryPosition = function(textRange, wholeRangeContainerElement, isStart, isCollapsed, startInfo) {
                var workingRange = textRange.duplicate();
                workingRange.collapse(isStart);
                var containerElement = workingRange.parentElement();

                // Sometimes collapsing a TextRange that's at the start of a text node can move it into the previous node, so
                // check for that
                if (!dom.isOrIsAncestorOf(wholeRangeContainerElement, containerElement)) {
                    containerElement = wholeRangeContainerElement;
                }


                // Deal with nodes that cannot "contain rich HTML markup". In practice, this means form inputs, images and
                // similar. See http://msdn.microsoft.com/en-us/library/aa703950%28VS.85%29.aspx
                if (!containerElement.canHaveHTML) {
                    var pos = new DomPosition(containerElement.parentNode, dom.getNodeIndex(containerElement));
                    return {
                        boundaryPosition: pos,
                        nodeInfo: {
                            nodeIndex: pos.offset,
                            containerElement: pos.node
                        }
                    };
                }

                var workingNode = dom.getDocument(containerElement).createElement("span");

                // Workaround for HTML5 Shiv's insane violation of document.createElement(). See Rangy issue 104 and HTML5
                // Shiv issue 64: https://github.com/aFarkas/html5shiv/issues/64
                if (workingNode.parentNode) {
                    dom.removeNode(workingNode);
                }

                var comparison, workingComparisonType = isStart ? "StartToStart" : "StartToEnd";
                var previousNode, nextNode, boundaryPosition, boundaryNode;
                var start = (startInfo && startInfo.containerElement == containerElement) ? startInfo.nodeIndex : 0;
                var childNodeCount = containerElement.childNodes.length;
                var end = childNodeCount;

                // Check end first. Code within the loop assumes that the endth child node of the container is definitely
                // after the range boundary.
                var nodeIndex = end;

                while (true) {
                    if (nodeIndex == childNodeCount) {
                        containerElement.appendChild(workingNode);
                    } else {
                        containerElement.insertBefore(workingNode, containerElement.childNodes[nodeIndex]);
                    }
                    workingRange.moveToElementText(workingNode);
                    comparison = workingRange.compareEndPoints(workingComparisonType, textRange);
                    if (comparison == 0 || start == end) {
                        break;
                    } else if (comparison == -1) {
                        if (end == start + 1) {
                            // We know the endth child node is after the range boundary, so we must be done.
                            break;
                        } else {
                            start = nodeIndex;
                        }
                    } else {
                        end = (end == start + 1) ? start : nodeIndex;
                    }
                    nodeIndex = Math.floor((start + end) / 2);
                    containerElement.removeChild(workingNode);
                }


                // We've now reached or gone past the boundary of the text range we're interested in
                // so have identified the node we want
                boundaryNode = workingNode.nextSibling;

                if (comparison == -1 && boundaryNode && isCharacterDataNode(boundaryNode)) {
                    // This is a character data node (text, comment, cdata). The working range is collapsed at the start of
                    // the node containing the text range's boundary, so we move the end of the working range to the
                    // boundary point and measure the length of its text to get the boundary's offset within the node.
                    workingRange.setEndPoint(isStart ? "EndToStart" : "EndToEnd", textRange);

                    var offset;

                    if (/[\r\n]/.test(boundaryNode.data)) {
                        /*
                        For the particular case of a boundary within a text node containing rendered line breaks (within a
                        <pre> element, for example), we need a slightly complicated approach to get the boundary's offset in
                        IE. The facts:

                        - Each line break is represented as \r in the text node's data/nodeValue properties
                        - Each line break is represented as \r\n in the TextRange's 'text' property
                        - The 'text' property of the TextRange does not contain trailing line breaks

                        To get round the problem presented by the final fact above, we can use the fact that TextRange's
                        moveStart() and moveEnd() methods return the actual number of characters moved, which is not
                        necessarily the same as the number of characters it was instructed to move. The simplest approach is
                        to use this to store the characters moved when moving both the start and end of the range to the
                        start of the document body and subtracting the start offset from the end offset (the
                        "move-negative-gazillion" method). However, this is extremely slow when the document is large and
                        the range is near the end of it. Clearly doing the mirror image (i.e. moving the range boundaries to
                        the end of the document) has the same problem.

                        Another approach that works is to use moveStart() to move the start boundary of the range up to the
                        end boundary one character at a time and incrementing a counter with the value returned by the
                        moveStart() call. However, the check for whether the start boundary has reached the end boundary is
                        expensive, so this method is slow (although unlike "move-negative-gazillion" is largely unaffected
                        by the location of the range within the document).

                        The approach used below is a hybrid of the two methods above. It uses the fact that a string
                        containing the TextRange's 'text' property with each \r\n converted to a single \r character cannot
                        be longer than the text of the TextRange, so the start of the range is moved that length initially
                        and then a character at a time to make up for any trailing line breaks not contained in the 'text'
                        property. This has good performance in most situations compared to the previous two methods.
                        */
                        var tempRange = workingRange.duplicate();
                        var rangeLength = tempRange.text.replace(/\r\n/g, "\r").length;

                        offset = tempRange.moveStart("character", rangeLength);
                        while ( (comparison = tempRange.compareEndPoints("StartToEnd", tempRange)) == -1) {
                            offset++;
                            tempRange.moveStart("character", 1);
                        }
                    } else {
                        offset = workingRange.text.length;
                    }
                    boundaryPosition = new DomPosition(boundaryNode, offset);
                } else {

                    // If the boundary immediately follows a character data node and this is the end boundary, we should favour
                    // a position within that, and likewise for a start boundary preceding a character data node
                    previousNode = (isCollapsed || !isStart) && workingNode.previousSibling;
                    nextNode = (isCollapsed || isStart) && workingNode.nextSibling;
                    if (nextNode && isCharacterDataNode(nextNode)) {
                        boundaryPosition = new DomPosition(nextNode, 0);
                    } else if (previousNode && isCharacterDataNode(previousNode)) {
                        boundaryPosition = new DomPosition(previousNode, previousNode.data.length);
                    } else {
                        boundaryPosition = new DomPosition(containerElement, dom.getNodeIndex(workingNode));
                    }
                }

                // Clean up
                dom.removeNode(workingNode);

                return {
                    boundaryPosition: boundaryPosition,
                    nodeInfo: {
                        nodeIndex: nodeIndex,
                        containerElement: containerElement
                    }
                };
            };

            // Returns a TextRange representing the boundary of a TextRange expressed as a node and an offset within that
            // node. This function started out as an optimized version of code found in Tim Cameron Ryan's IERange
            // (http://code.google.com/p/ierange/)
            var createBoundaryTextRange = function(boundaryPosition, isStart) {
                var boundaryNode, boundaryParent, boundaryOffset = boundaryPosition.offset;
                var doc = dom.getDocument(boundaryPosition.node);
                var workingNode, childNodes, workingRange = getBody(doc).createTextRange();
                var nodeIsDataNode = isCharacterDataNode(boundaryPosition.node);

                if (nodeIsDataNode) {
                    boundaryNode = boundaryPosition.node;
                    boundaryParent = boundaryNode.parentNode;
                } else {
                    childNodes = boundaryPosition.node.childNodes;
                    boundaryNode = (boundaryOffset < childNodes.length) ? childNodes[boundaryOffset] : null;
                    boundaryParent = boundaryPosition.node;
                }

                // Position the range immediately before the node containing the boundary
                workingNode = doc.createElement("span");

                // Making the working element non-empty element persuades IE to consider the TextRange boundary to be within
                // the element rather than immediately before or after it
                workingNode.innerHTML = "&#feff;";

                // insertBefore is supposed to work like appendChild if the second parameter is null. However, a bug report
                // for IERange suggests that it can crash the browser: http://code.google.com/p/ierange/issues/detail?id=12
                if (boundaryNode) {
                    boundaryParent.insertBefore(workingNode, boundaryNode);
                } else {
                    boundaryParent.appendChild(workingNode);
                }

                workingRange.moveToElementText(workingNode);
                workingRange.collapse(!isStart);

                // Clean up
                boundaryParent.removeChild(workingNode);

                // Move the working range to the text offset, if required
                if (nodeIsDataNode) {
                    workingRange[isStart ? "moveStart" : "moveEnd"]("character", boundaryOffset);
                }

                return workingRange;
            };

            /*------------------------------------------------------------------------------------------------------------*/

            // This is a wrapper around a TextRange, providing full DOM Range functionality using rangy's DomRange as a
            // prototype

            WrappedTextRange = function(textRange) {
                this.textRange = textRange;
                this.refresh();
            };

            WrappedTextRange.prototype = new DomRange(document);

            WrappedTextRange.prototype.refresh = function() {
                var start, end, startBoundary;

                // TextRange's parentElement() method cannot be trusted. getTextRangeContainerElement() works around that.
                var rangeContainerElement = getTextRangeContainerElement(this.textRange);

                if (textRangeIsCollapsed(this.textRange)) {
                    end = start = getTextRangeBoundaryPosition(this.textRange, rangeContainerElement, true,
                        true).boundaryPosition;
                } else {
                    startBoundary = getTextRangeBoundaryPosition(this.textRange, rangeContainerElement, true, false);
                    start = startBoundary.boundaryPosition;

                    // An optimization used here is that if the start and end boundaries have the same parent element, the
                    // search scope for the end boundary can be limited to exclude the portion of the element that precedes
                    // the start boundary
                    end = getTextRangeBoundaryPosition(this.textRange, rangeContainerElement, false, false,
                        startBoundary.nodeInfo).boundaryPosition;
                }

                this.setStart(start.node, start.offset);
                this.setEnd(end.node, end.offset);
            };

            WrappedTextRange.prototype.getName = function() {
                return "WrappedTextRange";
            };

            DomRange.copyComparisonConstants(WrappedTextRange);

            var rangeToTextRange = function(range) {
                if (range.collapsed) {
                    return createBoundaryTextRange(new DomPosition(range.startContainer, range.startOffset), true);
                } else {
                    var startRange = createBoundaryTextRange(new DomPosition(range.startContainer, range.startOffset), true);
                    var endRange = createBoundaryTextRange(new DomPosition(range.endContainer, range.endOffset), false);
                    var textRange = getBody( DomRange.getRangeDocument(range) ).createTextRange();
                    textRange.setEndPoint("StartToStart", startRange);
                    textRange.setEndPoint("EndToEnd", endRange);
                    return textRange;
                }
            };

            WrappedTextRange.rangeToTextRange = rangeToTextRange;

            WrappedTextRange.prototype.toTextRange = function() {
                return rangeToTextRange(this);
            };

            api.WrappedTextRange = WrappedTextRange;

            // IE 9 and above have both implementations and Rangy makes both available. The next few lines sets which
            // implementation to use by default.
            if (!api.features.implementsDomRange || api.config.preferTextRange) {
                // Add WrappedTextRange as the Range property of the global object to allow expression like Range.END_TO_END to work
                var globalObj = (function(f) { return f("return this;")(); })(Function);
                if (typeof globalObj.Range == "undefined") {
                    globalObj.Range = WrappedTextRange;
                }

                api.createNativeRange = function(doc) {
                    doc = getContentDocument(doc, module, "createNativeRange");
                    return getBody(doc).createTextRange();
                };

                api.WrappedRange = WrappedTextRange;
            }
        }

        api.createRange = function(doc) {
            doc = getContentDocument(doc, module, "createRange");
            return new api.WrappedRange(api.createNativeRange(doc));
        };

        api.createRangyRange = function(doc) {
            doc = getContentDocument(doc, module, "createRangyRange");
            return new DomRange(doc);
        };

        util.createAliasForDeprecatedMethod(api, "createIframeRange", "createRange");
        util.createAliasForDeprecatedMethod(api, "createIframeRangyRange", "createRangyRange");

        api.addShimListener(function(win) {
            var doc = win.document;
            if (typeof doc.createRange == "undefined") {
                doc.createRange = function() {
                    return api.createRange(doc);
                };
            }
            doc = win = null;
        });
    });

    /*----------------------------------------------------------------------------------------------------------------*/

    // This module creates a selection object wrapper that conforms as closely as possible to the Selection specification
    // in the HTML Editing spec (http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#selections)
    api.createCoreModule("WrappedSelection", ["DomRange", "WrappedRange"], function(api, module) {
        api.config.checkSelectionRanges = true;

        var BOOLEAN = "boolean";
        var NUMBER = "number";
        var dom = api.dom;
        var util = api.util;
        var isHostMethod = util.isHostMethod;
        var DomRange = api.DomRange;
        var WrappedRange = api.WrappedRange;
        var DOMException = api.DOMException;
        var DomPosition = dom.DomPosition;
        var getNativeSelection;
        var selectionIsCollapsed;
        var features = api.features;
        var CONTROL = "Control";
        var getDocument = dom.getDocument;
        var getBody = dom.getBody;
        var rangesEqual = DomRange.rangesEqual;


        // Utility function to support direction parameters in the API that may be a string ("backward", "backwards",
        // "forward" or "forwards") or a Boolean (true for backwards).
        function isDirectionBackward(dir) {
            return (typeof dir == "string") ? /^backward(s)?$/i.test(dir) : !!dir;
        }

        function getWindow(win, methodName) {
            if (!win) {
                return window;
            } else if (dom.isWindow(win)) {
                return win;
            } else if (win instanceof WrappedSelection) {
                return win.win;
            } else {
                var doc = dom.getContentDocument(win, module, methodName);
                return dom.getWindow(doc);
            }
        }

        function getWinSelection(winParam) {
            return getWindow(winParam, "getWinSelection").getSelection();
        }

        function getDocSelection(winParam) {
            return getWindow(winParam, "getDocSelection").document.selection;
        }

        function winSelectionIsBackward(sel) {
            var backward = false;
            if (sel.anchorNode) {
                backward = (dom.comparePoints(sel.anchorNode, sel.anchorOffset, sel.focusNode, sel.focusOffset) == 1);
            }
            return backward;
        }

        // Test for the Range/TextRange and Selection features required
        // Test for ability to retrieve selection
        var implementsWinGetSelection = isHostMethod(window, "getSelection"),
            implementsDocSelection = util.isHostObject(document, "selection");

        features.implementsWinGetSelection = implementsWinGetSelection;
        features.implementsDocSelection = implementsDocSelection;

        var useDocumentSelection = implementsDocSelection && (!implementsWinGetSelection || api.config.preferTextRange);

        if (useDocumentSelection) {
            getNativeSelection = getDocSelection;
            api.isSelectionValid = function(winParam) {
                var doc = getWindow(winParam, "isSelectionValid").document, nativeSel = doc.selection;

                // Check whether the selection TextRange is actually contained within the correct document
                return (nativeSel.type != "None" || getDocument(nativeSel.createRange().parentElement()) == doc);
            };
        } else if (implementsWinGetSelection) {
            getNativeSelection = getWinSelection;
            api.isSelectionValid = function() {
                return true;
            };
        } else {
            module.fail("Neither document.selection or window.getSelection() detected.");
            return false;
        }

        api.getNativeSelection = getNativeSelection;

        var testSelection = getNativeSelection();

        // In Firefox, the selection is null in an iframe with display: none. See issue #138.
        if (!testSelection) {
            module.fail("Native selection was null (possibly issue 138?)");
            return false;
        }

        var testRange = api.createNativeRange(document);
        var body = getBody(document);

        // Obtaining a range from a selection
        var selectionHasAnchorAndFocus = util.areHostProperties(testSelection,
            ["anchorNode", "focusNode", "anchorOffset", "focusOffset"]);

        features.selectionHasAnchorAndFocus = selectionHasAnchorAndFocus;

        // Test for existence of native selection extend() method
        var selectionHasExtend = isHostMethod(testSelection, "extend");
        features.selectionHasExtend = selectionHasExtend;

        // Test if rangeCount exists
        var selectionHasRangeCount = (typeof testSelection.rangeCount == NUMBER);
        features.selectionHasRangeCount = selectionHasRangeCount;

        var selectionSupportsMultipleRanges = false;
        var collapsedNonEditableSelectionsSupported = true;

        var addRangeBackwardToNative = selectionHasExtend ?
            function(nativeSelection, range) {
                var doc = DomRange.getRangeDocument(range);
                var endRange = api.createRange(doc);
                endRange.collapseToPoint(range.endContainer, range.endOffset);
                nativeSelection.addRange(getNativeRange(endRange));
                nativeSelection.extend(range.startContainer, range.startOffset);
            } : null;

        if (util.areHostMethods(testSelection, ["addRange", "getRangeAt", "removeAllRanges"]) &&
                typeof testSelection.rangeCount == NUMBER && features.implementsDomRange) {

            (function() {
                // Previously an iframe was used but this caused problems in some circumstances in IE, so tests are
                // performed on the current document's selection. See issue 109.

                // Note also that if a selection previously existed, it is wiped and later restored by these tests. This
                // will result in the selection direction begin reversed if the original selection was backwards and the
                // browser does not support setting backwards selections (Internet Explorer, I'm looking at you).
                var sel = window.getSelection();
                if (sel) {
                    // Store the current selection
                    var originalSelectionRangeCount = sel.rangeCount;
                    var selectionHasMultipleRanges = (originalSelectionRangeCount > 1);
                    var originalSelectionRanges = [];
                    var originalSelectionBackward = winSelectionIsBackward(sel);
                    for (var i = 0; i < originalSelectionRangeCount; ++i) {
                        originalSelectionRanges[i] = sel.getRangeAt(i);
                    }

                    // Create some test elements
                    var testEl = dom.createTestElement(document, "", false);
                    var textNode = testEl.appendChild( document.createTextNode("\u00a0\u00a0\u00a0") );

                    // Test whether the native selection will allow a collapsed selection within a non-editable element
                    var r1 = document.createRange();

                    r1.setStart(textNode, 1);
                    r1.collapse(true);
                    sel.removeAllRanges();
                    sel.addRange(r1);
                    collapsedNonEditableSelectionsSupported = (sel.rangeCount == 1);
                    sel.removeAllRanges();

                    // Test whether the native selection is capable of supporting multiple ranges.
                    if (!selectionHasMultipleRanges) {
                        // Doing the original feature test here in Chrome 36 (and presumably later versions) prints a
                        // console error of "Discontiguous selection is not supported." that cannot be suppressed. There's
                        // nothing we can do about this while retaining the feature test so we have to resort to a browser
                        // sniff. I'm not happy about it. See
                        // https://code.google.com/p/chromium/issues/detail?id=399791
                        var chromeMatch = window.navigator.appVersion.match(/Chrome\/(.*?) /);
                        if (chromeMatch && parseInt(chromeMatch[1]) >= 36) {
                            selectionSupportsMultipleRanges = false;
                        } else {
                            var r2 = r1.cloneRange();
                            r1.setStart(textNode, 0);
                            r2.setEnd(textNode, 3);
                            r2.setStart(textNode, 2);
                            sel.addRange(r1);
                            sel.addRange(r2);
                            selectionSupportsMultipleRanges = (sel.rangeCount == 2);
                        }
                    }

                    // Clean up
                    dom.removeNode(testEl);
                    sel.removeAllRanges();

                    for (i = 0; i < originalSelectionRangeCount; ++i) {
                        if (i == 0 && originalSelectionBackward) {
                            if (addRangeBackwardToNative) {
                                addRangeBackwardToNative(sel, originalSelectionRanges[i]);
                            } else {
                                api.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend");
                                sel.addRange(originalSelectionRanges[i]);
                            }
                        } else {
                            sel.addRange(originalSelectionRanges[i]);
                        }
                    }
                }
            })();
        }

        features.selectionSupportsMultipleRanges = selectionSupportsMultipleRanges;
        features.collapsedNonEditableSelectionsSupported = collapsedNonEditableSelectionsSupported;

        // ControlRanges
        var implementsControlRange = false, testControlRange;

        if (body && isHostMethod(body, "createControlRange")) {
            testControlRange = body.createControlRange();
            if (util.areHostProperties(testControlRange, ["item", "add"])) {
                implementsControlRange = true;
            }
        }
        features.implementsControlRange = implementsControlRange;

        // Selection collapsedness
        if (selectionHasAnchorAndFocus) {
            selectionIsCollapsed = function(sel) {
                return sel.anchorNode === sel.focusNode && sel.anchorOffset === sel.focusOffset;
            };
        } else {
            selectionIsCollapsed = function(sel) {
                return sel.rangeCount ? sel.getRangeAt(sel.rangeCount - 1).collapsed : false;
            };
        }

        function updateAnchorAndFocusFromRange(sel, range, backward) {
            var anchorPrefix = backward ? "end" : "start", focusPrefix = backward ? "start" : "end";
            sel.anchorNode = range[anchorPrefix + "Container"];
            sel.anchorOffset = range[anchorPrefix + "Offset"];
            sel.focusNode = range[focusPrefix + "Container"];
            sel.focusOffset = range[focusPrefix + "Offset"];
        }

        function updateAnchorAndFocusFromNativeSelection(sel) {
            var nativeSel = sel.nativeSelection;
            sel.anchorNode = nativeSel.anchorNode;
            sel.anchorOffset = nativeSel.anchorOffset;
            sel.focusNode = nativeSel.focusNode;
            sel.focusOffset = nativeSel.focusOffset;
        }

        function updateEmptySelection(sel) {
            sel.anchorNode = sel.focusNode = null;
            sel.anchorOffset = sel.focusOffset = 0;
            sel.rangeCount = 0;
            sel.isCollapsed = true;
            sel._ranges.length = 0;
        }

        function getNativeRange(range) {
            var nativeRange;
            if (range instanceof DomRange) {
                nativeRange = api.createNativeRange(range.getDocument());
                nativeRange.setEnd(range.endContainer, range.endOffset);
                nativeRange.setStart(range.startContainer, range.startOffset);
            } else if (range instanceof WrappedRange) {
                nativeRange = range.nativeRange;
            } else if (features.implementsDomRange && (range instanceof dom.getWindow(range.startContainer).Range)) {
                nativeRange = range;
            }
            return nativeRange;
        }

        function rangeContainsSingleElement(rangeNodes) {
            if (!rangeNodes.length || rangeNodes[0].nodeType != 1) {
                return false;
            }
            for (var i = 1, len = rangeNodes.length; i < len; ++i) {
                if (!dom.isAncestorOf(rangeNodes[0], rangeNodes[i])) {
                    return false;
                }
            }
            return true;
        }

        function getSingleElementFromRange(range) {
            var nodes = range.getNodes();
            if (!rangeContainsSingleElement(nodes)) {
                throw module.createError("getSingleElementFromRange: range " + range.inspect() + " did not consist of a single element");
            }
            return nodes[0];
        }

        // Simple, quick test which only needs to distinguish between a TextRange and a ControlRange
        function isTextRange(range) {
            return !!range && typeof range.text != "undefined";
        }

        function updateFromTextRange(sel, range) {
            // Create a Range from the selected TextRange
            var wrappedRange = new WrappedRange(range);
            sel._ranges = [wrappedRange];

            updateAnchorAndFocusFromRange(sel, wrappedRange, false);
            sel.rangeCount = 1;
            sel.isCollapsed = wrappedRange.collapsed;
        }

        function updateControlSelection(sel) {
            // Update the wrapped selection based on what's now in the native selection
            sel._ranges.length = 0;
            if (sel.docSelection.type == "None") {
                updateEmptySelection(sel);
            } else {
                var controlRange = sel.docSelection.createRange();
                if (isTextRange(controlRange)) {
                    // This case (where the selection type is "Control" and calling createRange() on the selection returns
                    // a TextRange) can happen in IE 9. It happens, for example, when all elements in the selected
                    // ControlRange have been removed from the ControlRange and removed from the document.
                    updateFromTextRange(sel, controlRange);
                } else {
                    sel.rangeCount = controlRange.length;
                    var range, doc = getDocument(controlRange.item(0));
                    for (var i = 0; i < sel.rangeCount; ++i) {
                        range = api.createRange(doc);
                        range.selectNode(controlRange.item(i));
                        sel._ranges.push(range);
                    }
                    sel.isCollapsed = sel.rangeCount == 1 && sel._ranges[0].collapsed;
                    updateAnchorAndFocusFromRange(sel, sel._ranges[sel.rangeCount - 1], false);
                }
            }
        }

        function addRangeToControlSelection(sel, range) {
            var controlRange = sel.docSelection.createRange();
            var rangeElement = getSingleElementFromRange(range);

            // Create a new ControlRange containing all the elements in the selected ControlRange plus the element
            // contained by the supplied range
            var doc = getDocument(controlRange.item(0));
            var newControlRange = getBody(doc).createControlRange();
            for (var i = 0, len = controlRange.length; i < len; ++i) {
                newControlRange.add(controlRange.item(i));
            }
            try {
                newControlRange.add(rangeElement);
            } catch (ex) {
                throw module.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");
            }
            newControlRange.select();

            // Update the wrapped selection based on what's now in the native selection
            updateControlSelection(sel);
        }

        var getSelectionRangeAt;

        if (isHostMethod(testSelection, "getRangeAt")) {
            // try/catch is present because getRangeAt() must have thrown an error in some browser and some situation.
            // Unfortunately, I didn't write a comment about the specifics and am now scared to take it out. Let that be a
            // lesson to us all, especially me.
            getSelectionRangeAt = function(sel, index) {
                try {
                    return sel.getRangeAt(index);
                } catch (ex) {
                    return null;
                }
            };
        } else if (selectionHasAnchorAndFocus) {
            getSelectionRangeAt = function(sel) {
                var doc = getDocument(sel.anchorNode);
                var range = api.createRange(doc);
                range.setStartAndEnd(sel.anchorNode, sel.anchorOffset, sel.focusNode, sel.focusOffset);

                // Handle the case when the selection was selected backwards (from the end to the start in the
                // document)
                if (range.collapsed !== this.isCollapsed) {
                    range.setStartAndEnd(sel.focusNode, sel.focusOffset, sel.anchorNode, sel.anchorOffset);
                }

                return range;
            };
        }

        function WrappedSelection(selection, docSelection, win) {
            this.nativeSelection = selection;
            this.docSelection = docSelection;
            this._ranges = [];
            this.win = win;
            this.refresh();
        }

        WrappedSelection.prototype = api.selectionPrototype;

        function deleteProperties(sel) {
            sel.win = sel.anchorNode = sel.focusNode = sel._ranges = null;
            sel.rangeCount = sel.anchorOffset = sel.focusOffset = 0;
            sel.detached = true;
        }

        var cachedRangySelections = [];

        function actOnCachedSelection(win, action) {
            var i = cachedRangySelections.length, cached, sel;
            while (i--) {
                cached = cachedRangySelections[i];
                sel = cached.selection;
                if (action == "deleteAll") {
                    deleteProperties(sel);
                } else if (cached.win == win) {
                    if (action == "delete") {
                        cachedRangySelections.splice(i, 1);
                        return true;
                    } else {
                        return sel;
                    }
                }
            }
            if (action == "deleteAll") {
                cachedRangySelections.length = 0;
            }
            return null;
        }

        var getSelection = function(win) {
            // Check if the parameter is a Rangy Selection object
            if (win && win instanceof WrappedSelection) {
                win.refresh();
                return win;
            }

            win = getWindow(win, "getNativeSelection");

            var sel = actOnCachedSelection(win);
            var nativeSel = getNativeSelection(win), docSel = implementsDocSelection ? getDocSelection(win) : null;
            if (sel) {
                sel.nativeSelection = nativeSel;
                sel.docSelection = docSel;
                sel.refresh();
            } else {
                sel = new WrappedSelection(nativeSel, docSel, win);
                cachedRangySelections.push( { win: win, selection: sel } );
            }
            return sel;
        };

        api.getSelection = getSelection;

        util.createAliasForDeprecatedMethod(api, "getIframeSelection", "getSelection");

        var selProto = WrappedSelection.prototype;

        function createControlSelection(sel, ranges) {
            // Ensure that the selection becomes of type "Control"
            var doc = getDocument(ranges[0].startContainer);
            var controlRange = getBody(doc).createControlRange();
            for (var i = 0, el, len = ranges.length; i < len; ++i) {
                el = getSingleElementFromRange(ranges[i]);
                try {
                    controlRange.add(el);
                } catch (ex) {
                    throw module.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)");
                }
            }
            controlRange.select();

            // Update the wrapped selection based on what's now in the native selection
            updateControlSelection(sel);
        }

        // Selecting a range
        if (!useDocumentSelection && selectionHasAnchorAndFocus && util.areHostMethods(testSelection, ["removeAllRanges", "addRange"])) {
            selProto.removeAllRanges = function() {
                this.nativeSelection.removeAllRanges();
                updateEmptySelection(this);
            };

            var addRangeBackward = function(sel, range) {
                addRangeBackwardToNative(sel.nativeSelection, range);
                sel.refresh();
            };

            if (selectionHasRangeCount) {
                selProto.addRange = function(range, direction) {
                    if (implementsControlRange && implementsDocSelection && this.docSelection.type == CONTROL) {
                        addRangeToControlSelection(this, range);
                    } else {
                        if (isDirectionBackward(direction) && selectionHasExtend) {
                            addRangeBackward(this, range);
                        } else {
                            var previousRangeCount;
                            if (selectionSupportsMultipleRanges) {
                                previousRangeCount = this.rangeCount;
                            } else {
                                this.removeAllRanges();
                                previousRangeCount = 0;
                            }
                            // Clone the native range so that changing the selected range does not affect the selection.
                            // This is contrary to the spec but is the only way to achieve consistency between browsers. See
                            // issue 80.
                            var clonedNativeRange = getNativeRange(range).cloneRange();
                            try {
                                this.nativeSelection.addRange(clonedNativeRange);
                            } catch (ex) {
                            }

                            // Check whether adding the range was successful
                            this.rangeCount = this.nativeSelection.rangeCount;

                            if (this.rangeCount == previousRangeCount + 1) {
                                // The range was added successfully

                                // Check whether the range that we added to the selection is reflected in the last range extracted from
                                // the selection
                                if (api.config.checkSelectionRanges) {
                                    var nativeRange = getSelectionRangeAt(this.nativeSelection, this.rangeCount - 1);
                                    if (nativeRange && !rangesEqual(nativeRange, range)) {
                                        // Happens in WebKit with, for example, a selection placed at the start of a text node
                                        range = new WrappedRange(nativeRange);
                                    }
                                }
                                this._ranges[this.rangeCount - 1] = range;
                                updateAnchorAndFocusFromRange(this, range, selectionIsBackward(this.nativeSelection));
                                this.isCollapsed = selectionIsCollapsed(this);
                            } else {
                                // The range was not added successfully. The simplest thing is to refresh
                                this.refresh();
                            }
                        }
                    }
                };
            } else {
                selProto.addRange = function(range, direction) {
                    if (isDirectionBackward(direction) && selectionHasExtend) {
                        addRangeBackward(this, range);
                    } else {
                        this.nativeSelection.addRange(getNativeRange(range));
                        this.refresh();
                    }
                };
            }

            selProto.setRanges = function(ranges) {
                if (implementsControlRange && implementsDocSelection && ranges.length > 1) {
                    createControlSelection(this, ranges);
                } else {
                    this.removeAllRanges();
                    for (var i = 0, len = ranges.length; i < len; ++i) {
                        this.addRange(ranges[i]);
                    }
                }
            };
        } else if (isHostMethod(testSelection, "empty") && isHostMethod(testRange, "select") &&
                   implementsControlRange && useDocumentSelection) {

            selProto.removeAllRanges = function() {
                // Added try/catch as fix for issue #21
                try {
                    this.docSelection.empty();

                    // Check for empty() not working (issue #24)
                    if (this.docSelection.type != "None") {
                        // Work around failure to empty a control selection by instead selecting a TextRange and then
                        // calling empty()
                        var doc;
                        if (this.anchorNode) {
                            doc = getDocument(this.anchorNode);
                        } else if (this.docSelection.type == CONTROL) {
                            var controlRange = this.docSelection.createRange();
                            if (controlRange.length) {
                                doc = getDocument( controlRange.item(0) );
                            }
                        }
                        if (doc) {
                            var textRange = getBody(doc).createTextRange();
                            textRange.select();
                            this.docSelection.empty();
                        }
                    }
                } catch(ex) {}
                updateEmptySelection(this);
            };

            selProto.addRange = function(range) {
                if (this.docSelection.type == CONTROL) {
                    addRangeToControlSelection(this, range);
                } else {
                    api.WrappedTextRange.rangeToTextRange(range).select();
                    this._ranges[0] = range;
                    this.rangeCount = 1;
                    this.isCollapsed = this._ranges[0].collapsed;
                    updateAnchorAndFocusFromRange(this, range, false);
                }
            };

            selProto.setRanges = function(ranges) {
                this.removeAllRanges();
                var rangeCount = ranges.length;
                if (rangeCount > 1) {
                    createControlSelection(this, ranges);
                } else if (rangeCount) {
                    this.addRange(ranges[0]);
                }
            };
        } else {
            module.fail("No means of selecting a Range or TextRange was found");
            return false;
        }

        selProto.getRangeAt = function(index) {
            if (index < 0 || index >= this.rangeCount) {
                throw new DOMException("INDEX_SIZE_ERR");
            } else {
                // Clone the range to preserve selection-range independence. See issue 80.
                return this._ranges[index].cloneRange();
            }
        };

        var refreshSelection;

        if (useDocumentSelection) {
            refreshSelection = function(sel) {
                var range;
                if (api.isSelectionValid(sel.win)) {
                    range = sel.docSelection.createRange();
                } else {
                    range = getBody(sel.win.document).createTextRange();
                    range.collapse(true);
                }

                if (sel.docSelection.type == CONTROL) {
                    updateControlSelection(sel);
                } else if (isTextRange(range)) {
                    updateFromTextRange(sel, range);
                } else {
                    updateEmptySelection(sel);
                }
            };
        } else if (isHostMethod(testSelection, "getRangeAt") && typeof testSelection.rangeCount == NUMBER) {
            refreshSelection = function(sel) {
                if (implementsControlRange && implementsDocSelection && sel.docSelection.type == CONTROL) {
                    updateControlSelection(sel);
                } else {
                    sel._ranges.length = sel.rangeCount = sel.nativeSelection.rangeCount;
                    if (sel.rangeCount) {
                        for (var i = 0, len = sel.rangeCount; i < len; ++i) {
                            sel._ranges[i] = new api.WrappedRange(sel.nativeSelection.getRangeAt(i));
                        }
                        updateAnchorAndFocusFromRange(sel, sel._ranges[sel.rangeCount - 1], selectionIsBackward(sel.nativeSelection));
                        sel.isCollapsed = selectionIsCollapsed(sel);
                    } else {
                        updateEmptySelection(sel);
                    }
                }
            };
        } else if (selectionHasAnchorAndFocus && typeof testSelection.isCollapsed == BOOLEAN && typeof testRange.collapsed == BOOLEAN && features.implementsDomRange) {
            refreshSelection = function(sel) {
                var range, nativeSel = sel.nativeSelection;
                if (nativeSel.anchorNode) {
                    range = getSelectionRangeAt(nativeSel, 0);
                    sel._ranges = [range];
                    sel.rangeCount = 1;
                    updateAnchorAndFocusFromNativeSelection(sel);
                    sel.isCollapsed = selectionIsCollapsed(sel);
                } else {
                    updateEmptySelection(sel);
                }
            };
        } else {
            module.fail("No means of obtaining a Range or TextRange from the user's selection was found");
            return false;
        }

        selProto.refresh = function(checkForChanges) {
            var oldRanges = checkForChanges ? this._ranges.slice(0) : null;
            var oldAnchorNode = this.anchorNode, oldAnchorOffset = this.anchorOffset;

            refreshSelection(this);
            if (checkForChanges) {
                // Check the range count first
                var i = oldRanges.length;
                if (i != this._ranges.length) {
                    return true;
                }

                // Now check the direction. Checking the anchor position is the same is enough since we're checking all the
                // ranges after this
                if (this.anchorNode != oldAnchorNode || this.anchorOffset != oldAnchorOffset) {
                    return true;
                }

                // Finally, compare each range in turn
                while (i--) {
                    if (!rangesEqual(oldRanges[i], this._ranges[i])) {
                        return true;
                    }
                }
                return false;
            }
        };

        // Removal of a single range
        var removeRangeManually = function(sel, range) {
            var ranges = sel.getAllRanges();
            sel.removeAllRanges();
            for (var i = 0, len = ranges.length; i < len; ++i) {
                if (!rangesEqual(range, ranges[i])) {
                    sel.addRange(ranges[i]);
                }
            }
            if (!sel.rangeCount) {
                updateEmptySelection(sel);
            }
        };

        if (implementsControlRange && implementsDocSelection) {
            selProto.removeRange = function(range) {
                if (this.docSelection.type == CONTROL) {
                    var controlRange = this.docSelection.createRange();
                    var rangeElement = getSingleElementFromRange(range);

                    // Create a new ControlRange containing all the elements in the selected ControlRange minus the
                    // element contained by the supplied range
                    var doc = getDocument(controlRange.item(0));
                    var newControlRange = getBody(doc).createControlRange();
                    var el, removed = false;
                    for (var i = 0, len = controlRange.length; i < len; ++i) {
                        el = controlRange.item(i);
                        if (el !== rangeElement || removed) {
                            newControlRange.add(controlRange.item(i));
                        } else {
                            removed = true;
                        }
                    }
                    newControlRange.select();

                    // Update the wrapped selection based on what's now in the native selection
                    updateControlSelection(this);
                } else {
                    removeRangeManually(this, range);
                }
            };
        } else {
            selProto.removeRange = function(range) {
                removeRangeManually(this, range);
            };
        }

        // Detecting if a selection is backward
        var selectionIsBackward;
        if (!useDocumentSelection && selectionHasAnchorAndFocus && features.implementsDomRange) {
            selectionIsBackward = winSelectionIsBackward;

            selProto.isBackward = function() {
                return selectionIsBackward(this);
            };
        } else {
            selectionIsBackward = selProto.isBackward = function() {
                return false;
            };
        }

        // Create an alias for backwards compatibility. From 1.3, everything is "backward" rather than "backwards"
        selProto.isBackwards = selProto.isBackward;

        // Selection stringifier
        // This is conformant to the old HTML5 selections draft spec but differs from WebKit and Mozilla's implementation.
        // The current spec does not yet define this method.
        selProto.toString = function() {
            var rangeTexts = [];
            for (var i = 0, len = this.rangeCount; i < len; ++i) {
                rangeTexts[i] = "" + this._ranges[i];
            }
            return rangeTexts.join("");
        };

        function assertNodeInSameDocument(sel, node) {
            if (sel.win.document != getDocument(node)) {
                throw new DOMException("WRONG_DOCUMENT_ERR");
            }
        }

        // No current browser conforms fully to the spec for this method, so Rangy's own method is always used
        selProto.collapse = function(node, offset) {
            assertNodeInSameDocument(this, node);
            var range = api.createRange(node);
            range.collapseToPoint(node, offset);
            this.setSingleRange(range);
            this.isCollapsed = true;
        };

        selProto.collapseToStart = function() {
            if (this.rangeCount) {
                var range = this._ranges[0];
                this.collapse(range.startContainer, range.startOffset);
            } else {
                throw new DOMException("INVALID_STATE_ERR");
            }
        };

        selProto.collapseToEnd = function() {
            if (this.rangeCount) {
                var range = this._ranges[this.rangeCount - 1];
                this.collapse(range.endContainer, range.endOffset);
            } else {
                throw new DOMException("INVALID_STATE_ERR");
            }
        };

        // The spec is very specific on how selectAllChildren should be implemented and not all browsers implement it as
        // specified so the native implementation is never used by Rangy.
        selProto.selectAllChildren = function(node) {
            assertNodeInSameDocument(this, node);
            var range = api.createRange(node);
            range.selectNodeContents(node);
            this.setSingleRange(range);
        };

        selProto.deleteFromDocument = function() {
            // Sepcial behaviour required for IE's control selections
            if (implementsControlRange && implementsDocSelection && this.docSelection.type == CONTROL) {
                var controlRange = this.docSelection.createRange();
                var element;
                while (controlRange.length) {
                    element = controlRange.item(0);
                    controlRange.remove(element);
                    dom.removeNode(element);
                }
                this.refresh();
            } else if (this.rangeCount) {
                var ranges = this.getAllRanges();
                if (ranges.length) {
                    this.removeAllRanges();
                    for (var i = 0, len = ranges.length; i < len; ++i) {
                        ranges[i].deleteContents();
                    }
                    // The spec says nothing about what the selection should contain after calling deleteContents on each
                    // range. Firefox moves the selection to where the final selected range was, so we emulate that
                    this.addRange(ranges[len - 1]);
                }
            }
        };

        // The following are non-standard extensions
        selProto.eachRange = function(func, returnValue) {
            for (var i = 0, len = this._ranges.length; i < len; ++i) {
                if ( func( this.getRangeAt(i) ) ) {
                    return returnValue;
                }
            }
        };

        selProto.getAllRanges = function() {
            var ranges = [];
            this.eachRange(function(range) {
                ranges.push(range);
            });
            return ranges;
        };

        selProto.setSingleRange = function(range, direction) {
            this.removeAllRanges();
            this.addRange(range, direction);
        };

        selProto.callMethodOnEachRange = function(methodName, params) {
            var results = [];
            this.eachRange( function(range) {
                results.push( range[methodName].apply(range, params || []) );
            } );
            return results;
        };

        function createStartOrEndSetter(isStart) {
            return function(node, offset) {
                var range;
                if (this.rangeCount) {
                    range = this.getRangeAt(0);
                    range["set" + (isStart ? "Start" : "End")](node, offset);
                } else {
                    range = api.createRange(this.win.document);
                    range.setStartAndEnd(node, offset);
                }
                this.setSingleRange(range, this.isBackward());
            };
        }

        selProto.setStart = createStartOrEndSetter(true);
        selProto.setEnd = createStartOrEndSetter(false);

        // Add select() method to Range prototype. Any existing selection will be removed.
        api.rangePrototype.select = function(direction) {
            getSelection( this.getDocument() ).setSingleRange(this, direction);
        };

        selProto.changeEachRange = function(func) {
            var ranges = [];
            var backward = this.isBackward();

            this.eachRange(function(range) {
                func(range);
                ranges.push(range);
            });

            this.removeAllRanges();
            if (backward && ranges.length == 1) {
                this.addRange(ranges[0], "backward");
            } else {
                this.setRanges(ranges);
            }
        };

        selProto.containsNode = function(node, allowPartial) {
            return this.eachRange( function(range) {
                return range.containsNode(node, allowPartial);
            }, true ) || false;
        };

        selProto.getBookmark = function(containerNode) {
            return {
                backward: this.isBackward(),
                rangeBookmarks: this.callMethodOnEachRange("getBookmark", [containerNode])
            };
        };

        selProto.moveToBookmark = function(bookmark) {
            var selRanges = [];
            for (var i = 0, rangeBookmark, range; rangeBookmark = bookmark.rangeBookmarks[i++]; ) {
                range = api.createRange(this.win);
                range.moveToBookmark(rangeBookmark);
                selRanges.push(range);
            }
            if (bookmark.backward) {
                this.setSingleRange(selRanges[0], "backward");
            } else {
                this.setRanges(selRanges);
            }
        };

        selProto.saveRanges = function() {
            return {
                backward: this.isBackward(),
                ranges: this.callMethodOnEachRange("cloneRange")
            };
        };

        selProto.restoreRanges = function(selRanges) {
            this.removeAllRanges();
            for (var i = 0, range; range = selRanges.ranges[i]; ++i) {
                this.addRange(range, (selRanges.backward && i == 0));
            }
        };

        selProto.toHtml = function() {
            var rangeHtmls = [];
            this.eachRange(function(range) {
                rangeHtmls.push( DomRange.toHtml(range) );
            });
            return rangeHtmls.join("");
        };

        if (features.implementsTextRange) {
            selProto.getNativeTextRange = function() {
                var sel, textRange;
                if ( (sel = this.docSelection) ) {
                    var range = sel.createRange();
                    if (isTextRange(range)) {
                        return range;
                    } else {
                        throw module.createError("getNativeTextRange: selection is a control selection");
                    }
                } else if (this.rangeCount > 0) {
                    return api.WrappedTextRange.rangeToTextRange( this.getRangeAt(0) );
                } else {
                    throw module.createError("getNativeTextRange: selection contains no range");
                }
            };
        }

        function inspect(sel) {
            var rangeInspects = [];
            var anchor = new DomPosition(sel.anchorNode, sel.anchorOffset);
            var focus = new DomPosition(sel.focusNode, sel.focusOffset);
            var name = (typeof sel.getName == "function") ? sel.getName() : "Selection";

            if (typeof sel.rangeCount != "undefined") {
                for (var i = 0, len = sel.rangeCount; i < len; ++i) {
                    rangeInspects[i] = DomRange.inspect(sel.getRangeAt(i));
                }
            }
            return "[" + name + "(Ranges: " + rangeInspects.join(", ") +
                    ")(anchor: " + anchor.inspect() + ", focus: " + focus.inspect() + "]";
        }

        selProto.getName = function() {
            return "WrappedSelection";
        };

        selProto.inspect = function() {
            return inspect(this);
        };

        selProto.detach = function() {
            actOnCachedSelection(this.win, "delete");
            deleteProperties(this);
        };

        WrappedSelection.detachAll = function() {
            actOnCachedSelection(null, "deleteAll");
        };

        WrappedSelection.inspect = inspect;
        WrappedSelection.isDirectionBackward = isDirectionBackward;

        api.Selection = WrappedSelection;

        api.selectionPrototype = selProto;

        api.addShimListener(function(win) {
            if (typeof win.getSelection == "undefined") {
                win.getSelection = function() {
                    return getSelection(win);
                };
            }
            win = null;
        });
    });
    

    /*----------------------------------------------------------------------------------------------------------------*/

    // Wait for document to load before initializing
    var docReady = false;

    var loadHandler = function(e) {
        if (!docReady) {
            docReady = true;
            if (!api.initialized && api.config.autoInitialize) {
                init();
            }
        }
    };

    if (isBrowser) {
        // Test whether the document has already been loaded and initialize immediately if so
        if (document.readyState == "complete") {
            loadHandler();
        } else {
            if (isHostMethod(document, "addEventListener")) {
                document.addEventListener("DOMContentLoaded", loadHandler, false);
            }

            // Add a fallback in case the DOMContentLoaded event isn't supported
            addListener(window, "load", loadHandler);
        }
    }

    return api;
}, this);
/**
 * Class Applier module for Rangy.
 * Adds, removes and toggles classes on Ranges and Selections
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
(function(factory, root) {
    if (typeof define == "function" && define.amd) {
        // AMD. Register as an anonymous module with a dependency on Rangy.
        define(["./rangy-core"], factory);
    } else if (typeof module != "undefined" && typeof exports == "object") {
        // Node/CommonJS style
        module.exports = factory( require("rangy") );
    } else {
        // No AMD or CommonJS support so we use the rangy property of root (probably the global variable)
        factory(root.rangy);
    }
})(function(rangy) {
    rangy.createModule("ClassApplier", ["WrappedSelection"], function(api, module) {
        var dom = api.dom;
        var DomPosition = dom.DomPosition;
        var contains = dom.arrayContains;
        var util = api.util;
        var forEach = util.forEach;


        var defaultTagName = "span";
        var createElementNSSupported = util.isHostMethod(document, "createElementNS");

        function each(obj, func) {
            for (var i in obj) {
                if (obj.hasOwnProperty(i)) {
                    if (func(i, obj[i]) === false) {
                        return false;
                    }
                }
            }
            return true;
        }

        function trim(str) {
            return str.replace(/^\s\s*/, "").replace(/\s\s*$/, "");
        }

        function classNameContainsClass(fullClassName, className) {
            return !!fullClassName && new RegExp("(?:^|\\s)" + className + "(?:\\s|$)").test(fullClassName);
        }

        // Inefficient, inelegant nonsense for IE's svg element, which has no classList and non-HTML className implementation
        function hasClass(el, className) {
            if (typeof el.classList == "object") {
                return el.classList.contains(className);
            } else {
                var classNameSupported = (typeof el.className == "string");
                var elClass = classNameSupported ? el.className : el.getAttribute("class");
                return classNameContainsClass(elClass, className);
            }
        }

        function addClass(el, className) {
            if (typeof el.classList == "object") {
                el.classList.add(className);
            } else {
                var classNameSupported = (typeof el.className == "string");
                var elClass = classNameSupported ? el.className : el.getAttribute("class");
                if (elClass) {
                    if (!classNameContainsClass(elClass, className)) {
                        elClass += " " + className;
                    }
                } else {
                    elClass = className;
                }
                if (classNameSupported) {
                    el.className = elClass;
                } else {
                    el.setAttribute("class", elClass);
                }
            }
        }

        var removeClass = (function() {
            function replacer(matched, whiteSpaceBefore, whiteSpaceAfter) {
                return (whiteSpaceBefore && whiteSpaceAfter) ? " " : "";
            }

            return function(el, className) {
                if (typeof el.classList == "object") {
                    el.classList.remove(className);
                } else {
                    var classNameSupported = (typeof el.className == "string");
                    var elClass = classNameSupported ? el.className : el.getAttribute("class");
                    elClass = elClass.replace(new RegExp("(^|\\s)" + className + "(\\s|$)"), replacer);
                    if (classNameSupported) {
                        el.className = elClass;
                    } else {
                        el.setAttribute("class", elClass);
                    }
                }
            };
        })();

        function getClass(el) {
            var classNameSupported = (typeof el.className == "string");
            return classNameSupported ? el.className : el.getAttribute("class");
        }

        function sortClassName(className) {
            return className && className.split(/\s+/).sort().join(" ");
        }

        function getSortedClassName(el) {
            return sortClassName( getClass(el) );
        }

        function haveSameClasses(el1, el2) {
            return getSortedClassName(el1) == getSortedClassName(el2);
        }

        function hasAllClasses(el, className) {
            var classes = className.split(/\s+/);
            for (var i = 0, len = classes.length; i < len; ++i) {
                if (!hasClass(el, trim(classes[i]))) {
                    return false;
                }
            }
            return true;
        }

        function canTextBeStyled(textNode) {
            var parent = textNode.parentNode;
            return (parent && parent.nodeType == 1 && !/^(textarea|style|script|select|iframe)$/i.test(parent.nodeName));
        }

        function movePosition(position, oldParent, oldIndex, newParent, newIndex) {
            var posNode = position.node, posOffset = position.offset;
            var newNode = posNode, newOffset = posOffset;

            if (posNode == newParent && posOffset > newIndex) {
                ++newOffset;
            }

            if (posNode == oldParent && (posOffset == oldIndex  || posOffset == oldIndex + 1)) {
                newNode = newParent;
                newOffset += newIndex - oldIndex;
            }

            if (posNode == oldParent && posOffset > oldIndex + 1) {
                --newOffset;
            }

            position.node = newNode;
            position.offset = newOffset;
        }

        function movePositionWhenRemovingNode(position, parentNode, index) {
            if (position.node == parentNode && position.offset > index) {
                --position.offset;
            }
        }

        function movePreservingPositions(node, newParent, newIndex, positionsToPreserve) {
            // For convenience, allow newIndex to be -1 to mean "insert at the end".
            if (newIndex == -1) {
                newIndex = newParent.childNodes.length;
            }

            var oldParent = node.parentNode;
            var oldIndex = dom.getNodeIndex(node);

            forEach(positionsToPreserve, function(position) {
                movePosition(position, oldParent, oldIndex, newParent, newIndex);
            });

            // Now actually move the node.
            if (newParent.childNodes.length == newIndex) {
                newParent.appendChild(node);
            } else {
                newParent.insertBefore(node, newParent.childNodes[newIndex]);
            }
        }

        function removePreservingPositions(node, positionsToPreserve) {

            var oldParent = node.parentNode;
            var oldIndex = dom.getNodeIndex(node);

            forEach(positionsToPreserve, function(position) {
                movePositionWhenRemovingNode(position, oldParent, oldIndex);
            });

            dom.removeNode(node);
        }

        function moveChildrenPreservingPositions(node, newParent, newIndex, removeNode, positionsToPreserve) {
            var child, children = [];
            while ( (child = node.firstChild) ) {
                movePreservingPositions(child, newParent, newIndex++, positionsToPreserve);
                children.push(child);
            }
            if (removeNode) {
                removePreservingPositions(node, positionsToPreserve);
            }
            return children;
        }

        function replaceWithOwnChildrenPreservingPositions(element, positionsToPreserve) {
            return moveChildrenPreservingPositions(element, element.parentNode, dom.getNodeIndex(element), true, positionsToPreserve);
        }

        function rangeSelectsAnyText(range, textNode) {
            var textNodeRange = range.cloneRange();
            textNodeRange.selectNodeContents(textNode);

            var intersectionRange = textNodeRange.intersection(range);
            var text = intersectionRange ? intersectionRange.toString() : "";

            return text != "";
        }

        function getEffectiveTextNodes(range) {
            var nodes = range.getNodes([3]);

            // Optimization as per issue 145

            // Remove non-intersecting text nodes from the start of the range
            var start = 0, node;
            while ( (node = nodes[start]) && !rangeSelectsAnyText(range, node) ) {
                ++start;
            }

            // Remove non-intersecting text nodes from the start of the range
            var end = nodes.length - 1;
            while ( (node = nodes[end]) && !rangeSelectsAnyText(range, node) ) {
                --end;
            }

            return nodes.slice(start, end + 1);
        }

        function elementsHaveSameNonClassAttributes(el1, el2) {
            if (el1.attributes.length != el2.attributes.length) return false;
            for (var i = 0, len = el1.attributes.length, attr1, attr2, name; i < len; ++i) {
                attr1 = el1.attributes[i];
                name = attr1.name;
                if (name != "class") {
                    attr2 = el2.attributes.getNamedItem(name);
                    if ( (attr1 === null) != (attr2 === null) ) return false;
                    if (attr1.specified != attr2.specified) return false;
                    if (attr1.specified && attr1.nodeValue !== attr2.nodeValue) return false;
                }
            }
            return true;
        }

        function elementHasNonClassAttributes(el, exceptions) {
            for (var i = 0, len = el.attributes.length, attrName; i < len; ++i) {
                attrName = el.attributes[i].name;
                if ( !(exceptions && contains(exceptions, attrName)) && el.attributes[i].specified && attrName != "class") {
                    return true;
                }
            }
            return false;
        }

        var getComputedStyleProperty = dom.getComputedStyleProperty;
        var isEditableElement = (function() {
            var testEl = document.createElement("div");
            return typeof testEl.isContentEditable == "boolean" ?
                function (node) {
                    return node && node.nodeType == 1 && node.isContentEditable;
                } :
                function (node) {
                    if (!node || node.nodeType != 1 || node.contentEditable == "false") {
                        return false;
                    }
                    return node.contentEditable == "true" || isEditableElement(node.parentNode);
                };
        })();

        function isEditingHost(node) {
            var parent;
            return node && node.nodeType == 1 &&
                (( (parent = node.parentNode) && parent.nodeType == 9 && parent.designMode == "on") ||
                (isEditableElement(node) && !isEditableElement(node.parentNode)));
        }

        function isEditable(node) {
            return (isEditableElement(node) || (node.nodeType != 1 && isEditableElement(node.parentNode))) && !isEditingHost(node);
        }

        var inlineDisplayRegex = /^inline(-block|-table)?$/i;

        function isNonInlineElement(node) {
            return node && node.nodeType == 1 && !inlineDisplayRegex.test(getComputedStyleProperty(node, "display"));
        }

        // White space characters as defined by HTML 4 (http://www.w3.org/TR/html401/struct/text.html)
        var htmlNonWhiteSpaceRegex = /[^\r\n\t\f \u200B]/;

        function isUnrenderedWhiteSpaceNode(node) {
            if (node.data.length == 0) {
                return true;
            }
            if (htmlNonWhiteSpaceRegex.test(node.data)) {
                return false;
            }
            var cssWhiteSpace = getComputedStyleProperty(node.parentNode, "whiteSpace");
            switch (cssWhiteSpace) {
                case "pre":
                case "pre-wrap":
                case "-moz-pre-wrap":
                    return false;
                case "pre-line":
                    if (/[\r\n]/.test(node.data)) {
                        return false;
                    }
            }

            // We now have a whitespace-only text node that may be rendered depending on its context. If it is adjacent to a
            // non-inline element, it will not be rendered. This seems to be a good enough definition.
            return isNonInlineElement(node.previousSibling) || isNonInlineElement(node.nextSibling);
        }

        function getRangeBoundaries(ranges) {
            var positions = [], i, range;
            for (i = 0; range = ranges[i++]; ) {
                positions.push(
                    new DomPosition(range.startContainer, range.startOffset),
                    new DomPosition(range.endContainer, range.endOffset)
                );
            }
            return positions;
        }

        function updateRangesFromBoundaries(ranges, positions) {
            for (var i = 0, range, start, end, len = ranges.length; i < len; ++i) {
                range = ranges[i];
                start = positions[i * 2];
                end = positions[i * 2 + 1];
                range.setStartAndEnd(start.node, start.offset, end.node, end.offset);
            }
        }

        function isSplitPoint(node, offset) {
            if (dom.isCharacterDataNode(node)) {
                if (offset == 0) {
                    return !!node.previousSibling;
                } else if (offset == node.length) {
                    return !!node.nextSibling;
                } else {
                    return true;
                }
            }

            return offset > 0 && offset < node.childNodes.length;
        }

        function splitNodeAt(node, descendantNode, descendantOffset, positionsToPreserve) {
            var newNode, parentNode;
            var splitAtStart = (descendantOffset == 0);

            if (dom.isAncestorOf(descendantNode, node)) {
                return node;
            }

            if (dom.isCharacterDataNode(descendantNode)) {
                var descendantIndex = dom.getNodeIndex(descendantNode);
                if (descendantOffset == 0) {
                    descendantOffset = descendantIndex;
                } else if (descendantOffset == descendantNode.length) {
                    descendantOffset = descendantIndex + 1;
                } else {
                    throw module.createError("splitNodeAt() should not be called with offset in the middle of a data node (" +
                        descendantOffset + " in " + descendantNode.data);
                }
                descendantNode = descendantNode.parentNode;
            }

            if (isSplitPoint(descendantNode, descendantOffset)) {
                // descendantNode is now guaranteed not to be a text or other character node
                newNode = descendantNode.cloneNode(false);
                parentNode = descendantNode.parentNode;
                if (newNode.id) {
                    newNode.removeAttribute("id");
                }
                var child, newChildIndex = 0;

                while ( (child = descendantNode.childNodes[descendantOffset]) ) {
                    movePreservingPositions(child, newNode, newChildIndex++, positionsToPreserve);
                }
                movePreservingPositions(newNode, parentNode, dom.getNodeIndex(descendantNode) + 1, positionsToPreserve);
                return (descendantNode == node) ? newNode : splitNodeAt(node, parentNode, dom.getNodeIndex(newNode), positionsToPreserve);
            } else if (node != descendantNode) {
                newNode = descendantNode.parentNode;

                // Work out a new split point in the parent node
                var newNodeIndex = dom.getNodeIndex(descendantNode);

                if (!splitAtStart) {
                    newNodeIndex++;
                }
                return splitNodeAt(node, newNode, newNodeIndex, positionsToPreserve);
            }
            return node;
        }

        function areElementsMergeable(el1, el2) {
            return el1.namespaceURI == el2.namespaceURI &&
                el1.tagName.toLowerCase() == el2.tagName.toLowerCase() &&
                haveSameClasses(el1, el2) &&
                elementsHaveSameNonClassAttributes(el1, el2) &&
                getComputedStyleProperty(el1, "display") == "inline" &&
                getComputedStyleProperty(el2, "display") == "inline";
        }

        function createAdjacentMergeableTextNodeGetter(forward) {
            var siblingPropName = forward ? "nextSibling" : "previousSibling";

            return function(textNode, checkParentElement) {
                var el = textNode.parentNode;
                var adjacentNode = textNode[siblingPropName];
                if (adjacentNode) {
                    // Can merge if the node's previous/next sibling is a text node
                    if (adjacentNode && adjacentNode.nodeType == 3) {
                        return adjacentNode;
                    }
                } else if (checkParentElement) {
                    // Compare text node parent element with its sibling
                    adjacentNode = el[siblingPropName];
                    if (adjacentNode && adjacentNode.nodeType == 1 && areElementsMergeable(el, adjacentNode)) {
                        var adjacentNodeChild = adjacentNode[forward ? "firstChild" : "lastChild"];
                        if (adjacentNodeChild && adjacentNodeChild.nodeType == 3) {
                            return adjacentNodeChild;
                        }
                    }
                }
                return null;
            };
        }

        var getPreviousMergeableTextNode = createAdjacentMergeableTextNodeGetter(false),
            getNextMergeableTextNode = createAdjacentMergeableTextNodeGetter(true);

    
        function Merge(firstNode) {
            this.isElementMerge = (firstNode.nodeType == 1);
            this.textNodes = [];
            var firstTextNode = this.isElementMerge ? firstNode.lastChild : firstNode;
            if (firstTextNode) {
                this.textNodes[0] = firstTextNode;
            }
        }

        Merge.prototype = {
            doMerge: function(positionsToPreserve) {
                var textNodes = this.textNodes;
                var firstTextNode = textNodes[0];
                if (textNodes.length > 1) {
                    var firstTextNodeIndex = dom.getNodeIndex(firstTextNode);
                    var textParts = [], combinedTextLength = 0, textNode, parent;
                    forEach(textNodes, function(textNode, i) {
                        parent = textNode.parentNode;
                        if (i > 0) {
                            parent.removeChild(textNode);
                            if (!parent.hasChildNodes()) {
                                dom.removeNode(parent);
                            }
                            if (positionsToPreserve) {
                                forEach(positionsToPreserve, function(position) {
                                    // Handle case where position is inside the text node being merged into a preceding node
                                    if (position.node == textNode) {
                                        position.node = firstTextNode;
                                        position.offset += combinedTextLength;
                                    }
                                    // Handle case where both text nodes precede the position within the same parent node
                                    if (position.node == parent && position.offset > firstTextNodeIndex) {
                                        --position.offset;
                                        if (position.offset == firstTextNodeIndex + 1 && i < len - 1) {
                                            position.node = firstTextNode;
                                            position.offset = combinedTextLength;
                                        }
                                    }
                                });
                            }
                        }
                        textParts[i] = textNode.data;
                        combinedTextLength += textNode.data.length;
                    });
                    firstTextNode.data = textParts.join("");
                }
                return firstTextNode.data;
            },

            getLength: function() {
                var i = this.textNodes.length, len = 0;
                while (i--) {
                    len += this.textNodes[i].length;
                }
                return len;
            },

            toString: function() {
                var textParts = [];
                forEach(this.textNodes, function(textNode, i) {
                    textParts[i] = "'" + textNode.data + "'";
                });
                return "[Merge(" + textParts.join(",") + ")]";
            }
        };

        var optionProperties = ["elementTagName", "ignoreWhiteSpace", "applyToEditableOnly", "useExistingElements",
            "removeEmptyElements", "onElementCreate"];

        // TODO: Populate this with every attribute name that corresponds to a property with a different name. Really??
        var attrNamesForProperties = {};

        function ClassApplier(className, options, tagNames) {
            var normalize, i, len, propName, applier = this;
            applier.cssClass = applier.className = className; // cssClass property is for backward compatibility

            var elementPropertiesFromOptions = null, elementAttributes = {};

            // Initialize from options object
            if (typeof options == "object" && options !== null) {
                if (typeof options.elementTagName !== "undefined") {
                    options.elementTagName = options.elementTagName.toLowerCase();
                }
                tagNames = options.tagNames;
                elementPropertiesFromOptions = options.elementProperties;
                elementAttributes = options.elementAttributes;

                for (i = 0; propName = optionProperties[i++]; ) {
                    if (options.hasOwnProperty(propName)) {
                        applier[propName] = options[propName];
                    }
                }
                normalize = options.normalize;
            } else {
                normalize = options;
            }

            // Backward compatibility: the second parameter can also be a Boolean indicating to normalize after unapplying
            applier.normalize = (typeof normalize == "undefined") ? true : normalize;

            // Initialize element properties and attribute exceptions
            applier.attrExceptions = [];
            var el = document.createElement(applier.elementTagName);
            applier.elementProperties = applier.copyPropertiesToElement(elementPropertiesFromOptions, el, true);
            each(elementAttributes, function(attrName, attrValue) {
                applier.attrExceptions.push(attrName);
                // Ensure each attribute value is a string
                elementAttributes[attrName] = "" + attrValue;
            });
            applier.elementAttributes = elementAttributes;

            applier.elementSortedClassName = applier.elementProperties.hasOwnProperty("className") ?
                sortClassName(applier.elementProperties.className + " " + className) : className;

            // Initialize tag names
            applier.applyToAnyTagName = false;
            var type = typeof tagNames;
            if (type == "string") {
                if (tagNames == "*") {
                    applier.applyToAnyTagName = true;
                } else {
                    applier.tagNames = trim(tagNames.toLowerCase()).split(/\s*,\s*/);
                }
            } else if (type == "object" && typeof tagNames.length == "number") {
                applier.tagNames = [];
                for (i = 0, len = tagNames.length; i < len; ++i) {
                    if (tagNames[i] == "*") {
                        applier.applyToAnyTagName = true;
                    } else {
                        applier.tagNames.push(tagNames[i].toLowerCase());
                    }
                }
            } else {
                applier.tagNames = [applier.elementTagName];
            }
        }

        ClassApplier.prototype = {
            elementTagName: defaultTagName,
            elementProperties: {},
            elementAttributes: {},
            ignoreWhiteSpace: true,
            applyToEditableOnly: false,
            useExistingElements: true,
            removeEmptyElements: true,
            onElementCreate: null,

            copyPropertiesToElement: function(props, el, createCopy) {
                var s, elStyle, elProps = {}, elPropsStyle, propValue, elPropValue, attrName;

                for (var p in props) {
                    if (props.hasOwnProperty(p)) {
                        propValue = props[p];
                        elPropValue = el[p];

                        // Special case for class. The copied properties object has the applier's class as well as its own
                        // to simplify checks when removing styling elements
                        if (p == "className") {
                            addClass(el, propValue);
                            addClass(el, this.className);
                            el[p] = sortClassName(el[p]);
                            if (createCopy) {
                                elProps[p] = propValue;
                            }
                        }

                        // Special case for style
                        else if (p == "style") {
                            elStyle = elPropValue;
                            if (createCopy) {
                                elProps[p] = elPropsStyle = {};
                            }
                            for (s in props[p]) {
                                if (props[p].hasOwnProperty(s)) {
                                    elStyle[s] = propValue[s];
                                    if (createCopy) {
                                        elPropsStyle[s] = elStyle[s];
                                    }
                                }
                            }
                            this.attrExceptions.push(p);
                        } else {
                            el[p] = propValue;
                            // Copy the property back from the dummy element so that later comparisons to check whether
                            // elements may be removed are checking against the right value. For example, the href property
                            // of an element returns a fully qualified URL even if it was previously assigned a relative
                            // URL.
                            if (createCopy) {
                                elProps[p] = el[p];

                                // Not all properties map to identically-named attributes
                                attrName = attrNamesForProperties.hasOwnProperty(p) ? attrNamesForProperties[p] : p;
                                this.attrExceptions.push(attrName);
                            }
                        }
                    }
                }

                return createCopy ? elProps : "";
            },

            copyAttributesToElement: function(attrs, el) {
                for (var attrName in attrs) {
                    if (attrs.hasOwnProperty(attrName) && !/^class(?:Name)?$/i.test(attrName)) {
                        el.setAttribute(attrName, attrs[attrName]);
                    }
                }
            },

            appliesToElement: function(el) {
                return contains(this.tagNames, el.tagName.toLowerCase());
            },

            getEmptyElements: function(range) {
                var applier = this;
                return range.getNodes([1], function(el) {
                    return applier.appliesToElement(el) && !el.hasChildNodes();
                });
            },

            hasClass: function(node) {
                return node.nodeType == 1 &&
                    (this.applyToAnyTagName || this.appliesToElement(node)) &&
                    hasClass(node, this.className);
            },

            getSelfOrAncestorWithClass: function(node) {
                while (node) {
                    if (this.hasClass(node)) {
                        return node;
                    }
                    node = node.parentNode;
                }
                return null;
            },

            isModifiable: function(node) {
                return !this.applyToEditableOnly || isEditable(node);
            },

            // White space adjacent to an unwrappable node can be ignored for wrapping
            isIgnorableWhiteSpaceNode: function(node) {
                return this.ignoreWhiteSpace && node && node.nodeType == 3 && isUnrenderedWhiteSpaceNode(node);
            },

            // Normalizes nodes after applying a class to a Range.
            postApply: function(textNodes, range, positionsToPreserve, isUndo) {
                var firstNode = textNodes[0], lastNode = textNodes[textNodes.length - 1];

                var merges = [], currentMerge;

                var rangeStartNode = firstNode, rangeEndNode = lastNode;
                var rangeStartOffset = 0, rangeEndOffset = lastNode.length;

                var textNode, precedingTextNode;

                // Check for every required merge and create a Merge object for each
                forEach(textNodes, function(textNode) {
                    precedingTextNode = getPreviousMergeableTextNode(textNode, !isUndo);
                    if (precedingTextNode) {
                        if (!currentMerge) {
                            currentMerge = new Merge(precedingTextNode);
                            merges.push(currentMerge);
                        }
                        currentMerge.textNodes.push(textNode);
                        if (textNode === firstNode) {
                            rangeStartNode = currentMerge.textNodes[0];
                            rangeStartOffset = rangeStartNode.length;
                        }
                        if (textNode === lastNode) {
                            rangeEndNode = currentMerge.textNodes[0];
                            rangeEndOffset = currentMerge.getLength();
                        }
                    } else {
                        currentMerge = null;
                    }
                });

                // Test whether the first node after the range needs merging
                var nextTextNode = getNextMergeableTextNode(lastNode, !isUndo);

                if (nextTextNode) {
                    if (!currentMerge) {
                        currentMerge = new Merge(lastNode);
                        merges.push(currentMerge);
                    }
                    currentMerge.textNodes.push(nextTextNode);
                }

                // Apply the merges
                if (merges.length) {
                    for (i = 0, len = merges.length; i < len; ++i) {
                        merges[i].doMerge(positionsToPreserve);
                    }

                    // Set the range boundaries
                    range.setStartAndEnd(rangeStartNode, rangeStartOffset, rangeEndNode, rangeEndOffset);
                }
            },

            createContainer: function(parentNode) {
                var doc = dom.getDocument(parentNode);
                var namespace;
                var el = createElementNSSupported && !dom.isHtmlNamespace(parentNode) && (namespace = parentNode.namespaceURI) ?
                    doc.createElementNS(parentNode.namespaceURI, this.elementTagName) :
                    doc.createElement(this.elementTagName);

                this.copyPropertiesToElement(this.elementProperties, el, false);
                this.copyAttributesToElement(this.elementAttributes, el);
                addClass(el, this.className);
                if (this.onElementCreate) {
                    this.onElementCreate(el, this);
                }
                return el;
            },

            elementHasProperties: function(el, props) {
                var applier = this;
                return each(props, function(p, propValue) {
                    if (p == "className") {
                        // For checking whether we should reuse an existing element, we just want to check that the element
                        // has all the classes specified in the className property. When deciding whether the element is
                        // removable when unapplying a class, there is separate special handling to check whether the
                        // element has extra classes so the same simple check will do.
                        return hasAllClasses(el, propValue);
                    } else if (typeof propValue == "object") {
                        if (!applier.elementHasProperties(el[p], propValue)) {
                            return false;
                        }
                    } else if (el[p] !== propValue) {
                        return false;
                    }
                });
            },

            elementHasAttributes: function(el, attrs) {
                return each(attrs, function(name, value) {
                    if (el.getAttribute(name) !== value) {
                        return false;
                    }
                });
            },

            applyToTextNode: function(textNode, positionsToPreserve) {

                // Check whether the text node can be styled. Text within a <style> or <script> element, for example,
                // should not be styled. See issue 283.
                if (canTextBeStyled(textNode)) {
                    var parent = textNode.parentNode;
                    if (parent.childNodes.length == 1 &&
                        this.useExistingElements &&
                        this.appliesToElement(parent) &&
                        this.elementHasProperties(parent, this.elementProperties) &&
                        this.elementHasAttributes(parent, this.elementAttributes)) {

                        addClass(parent, this.className);
                    } else {
                        var textNodeParent = textNode.parentNode;
                        var el = this.createContainer(textNodeParent);
                        textNodeParent.insertBefore(el, textNode);
                        el.appendChild(textNode);
                    }
                }

            },

            isRemovable: function(el) {
                return el.tagName.toLowerCase() == this.elementTagName &&
                    getSortedClassName(el) == this.elementSortedClassName &&
                    this.elementHasProperties(el, this.elementProperties) &&
                    !elementHasNonClassAttributes(el, this.attrExceptions) &&
                    this.elementHasAttributes(el, this.elementAttributes) &&
                    this.isModifiable(el);
            },

            isEmptyContainer: function(el) {
                var childNodeCount = el.childNodes.length;
                return el.nodeType == 1 &&
                    this.isRemovable(el) &&
                    (childNodeCount == 0 || (childNodeCount == 1 && this.isEmptyContainer(el.firstChild)));
            },

            removeEmptyContainers: function(range) {
                var applier = this;
                var nodesToRemove = range.getNodes([1], function(el) {
                    return applier.isEmptyContainer(el);
                });

                var rangesToPreserve = [range];
                var positionsToPreserve = getRangeBoundaries(rangesToPreserve);

                forEach(nodesToRemove, function(node) {
                    removePreservingPositions(node, positionsToPreserve);
                });

                // Update the range from the preserved boundary positions
                updateRangesFromBoundaries(rangesToPreserve, positionsToPreserve);
            },

            undoToTextNode: function(textNode, range, ancestorWithClass, positionsToPreserve) {
                if (!range.containsNode(ancestorWithClass)) {
                    // Split out the portion of the ancestor from which we can remove the class
                    //var parent = ancestorWithClass.parentNode, index = dom.getNodeIndex(ancestorWithClass);
                    var ancestorRange = range.cloneRange();
                    ancestorRange.selectNode(ancestorWithClass);
                    if (ancestorRange.isPointInRange(range.endContainer, range.endOffset)) {
                        splitNodeAt(ancestorWithClass, range.endContainer, range.endOffset, positionsToPreserve);
                        range.setEndAfter(ancestorWithClass);
                    }
                    if (ancestorRange.isPointInRange(range.startContainer, range.startOffset)) {
                        ancestorWithClass = splitNodeAt(ancestorWithClass, range.startContainer, range.startOffset, positionsToPreserve);
                    }
                }

                if (this.isRemovable(ancestorWithClass)) {
                    replaceWithOwnChildrenPreservingPositions(ancestorWithClass, positionsToPreserve);
                } else {
                    removeClass(ancestorWithClass, this.className);
                }
            },

            splitAncestorWithClass: function(container, offset, positionsToPreserve) {
                var ancestorWithClass = this.getSelfOrAncestorWithClass(container);
                if (ancestorWithClass) {
                    splitNodeAt(ancestorWithClass, container, offset, positionsToPreserve);
                }
            },

            undoToAncestor: function(ancestorWithClass, positionsToPreserve) {
                if (this.isRemovable(ancestorWithClass)) {
                    replaceWithOwnChildrenPreservingPositions(ancestorWithClass, positionsToPreserve);
                } else {
                    removeClass(ancestorWithClass, this.className);
                }
            },

            applyToRange: function(range, rangesToPreserve) {
                var applier = this;
                rangesToPreserve = rangesToPreserve || [];

                // Create an array of range boundaries to preserve
                var positionsToPreserve = getRangeBoundaries(rangesToPreserve || []);

                range.splitBoundariesPreservingPositions(positionsToPreserve);

                // Tidy up the DOM by removing empty containers
                if (applier.removeEmptyElements) {
                    applier.removeEmptyContainers(range);
                }

                var textNodes = getEffectiveTextNodes(range);

                if (textNodes.length) {
                    forEach(textNodes, function(textNode) {
                        if (!applier.isIgnorableWhiteSpaceNode(textNode) && !applier.getSelfOrAncestorWithClass(textNode) &&
                                applier.isModifiable(textNode)) {
                            applier.applyToTextNode(textNode, positionsToPreserve);
                        }
                    });
                    var lastTextNode = textNodes[textNodes.length - 1];
                    range.setStartAndEnd(textNodes[0], 0, lastTextNode, lastTextNode.length);
                    if (applier.normalize) {
                        applier.postApply(textNodes, range, positionsToPreserve, false);
                    }

                    // Update the ranges from the preserved boundary positions
                    updateRangesFromBoundaries(rangesToPreserve, positionsToPreserve);
                }

                // Apply classes to any appropriate empty elements
                var emptyElements = applier.getEmptyElements(range);

                forEach(emptyElements, function(el) {
                    addClass(el, applier.className);
                });
            },

            applyToRanges: function(ranges) {

                var i = ranges.length;
                while (i--) {
                    this.applyToRange(ranges[i], ranges);
                }


                return ranges;
            },

            applyToSelection: function(win) {
                var sel = api.getSelection(win);
                sel.setRanges( this.applyToRanges(sel.getAllRanges()) );
            },

            undoToRange: function(range, rangesToPreserve) {
                var applier = this;
                // Create an array of range boundaries to preserve
                rangesToPreserve = rangesToPreserve || [];
                var positionsToPreserve = getRangeBoundaries(rangesToPreserve);


                range.splitBoundariesPreservingPositions(positionsToPreserve);

                // Tidy up the DOM by removing empty containers
                if (applier.removeEmptyElements) {
                    applier.removeEmptyContainers(range, positionsToPreserve);
                }

                var textNodes = getEffectiveTextNodes(range);
                var textNode, ancestorWithClass;
                var lastTextNode = textNodes[textNodes.length - 1];

                if (textNodes.length) {
                    applier.splitAncestorWithClass(range.endContainer, range.endOffset, positionsToPreserve);
                    applier.splitAncestorWithClass(range.startContainer, range.startOffset, positionsToPreserve);
                    for (var i = 0, len = textNodes.length; i < len; ++i) {
                        textNode = textNodes[i];
                        ancestorWithClass = applier.getSelfOrAncestorWithClass(textNode);
                        if (ancestorWithClass && applier.isModifiable(textNode)) {
                            applier.undoToAncestor(ancestorWithClass, positionsToPreserve);
                        }
                    }
                    // Ensure the range is still valid
                    range.setStartAndEnd(textNodes[0], 0, lastTextNode, lastTextNode.length);


                    if (applier.normalize) {
                        applier.postApply(textNodes, range, positionsToPreserve, true);
                    }

                    // Update the ranges from the preserved boundary positions
                    updateRangesFromBoundaries(rangesToPreserve, positionsToPreserve);
                }

                // Remove class from any appropriate empty elements
                var emptyElements = applier.getEmptyElements(range);

                forEach(emptyElements, function(el) {
                    removeClass(el, applier.className);
                });
            },

            undoToRanges: function(ranges) {
                // Get ranges returned in document order
                var i = ranges.length;

                while (i--) {
                    this.undoToRange(ranges[i], ranges);
                }

                return ranges;
            },

            undoToSelection: function(win) {
                var sel = api.getSelection(win);
                var ranges = api.getSelection(win).getAllRanges();
                this.undoToRanges(ranges);
                sel.setRanges(ranges);
            },

            isAppliedToRange: function(range) {
                if (range.collapsed || range.toString() == "") {
                    return !!this.getSelfOrAncestorWithClass(range.commonAncestorContainer);
                } else {
                    var textNodes = range.getNodes( [3] );
                    if (textNodes.length)
                    for (var i = 0, textNode; textNode = textNodes[i++]; ) {
                        if (!this.isIgnorableWhiteSpaceNode(textNode) && rangeSelectsAnyText(range, textNode) &&
                                this.isModifiable(textNode) && !this.getSelfOrAncestorWithClass(textNode)) {
                            return false;
                        }
                    }
                    return true;
                }
            },

            isAppliedToRanges: function(ranges) {
                var i = ranges.length;
                if (i == 0) {
                    return false;
                }
                while (i--) {
                    if (!this.isAppliedToRange(ranges[i])) {
                        return false;
                    }
                }
                return true;
            },

            isAppliedToSelection: function(win) {
                var sel = api.getSelection(win);
                return this.isAppliedToRanges(sel.getAllRanges());
            },

            toggleRange: function(range) {
                if (this.isAppliedToRange(range)) {
                    this.undoToRange(range);
                } else {
                    this.applyToRange(range);
                }
            },

            toggleSelection: function(win) {
                if (this.isAppliedToSelection(win)) {
                    this.undoToSelection(win);
                } else {
                    this.applyToSelection(win);
                }
            },

            getElementsWithClassIntersectingRange: function(range) {
                var elements = [];
                var applier = this;
                range.getNodes([3], function(textNode) {
                    var el = applier.getSelfOrAncestorWithClass(textNode);
                    if (el && !contains(elements, el)) {
                        elements.push(el);
                    }
                });
                return elements;
            },

            detach: function() {}
        };

        function createClassApplier(className, options, tagNames) {
            return new ClassApplier(className, options, tagNames);
        }

        ClassApplier.util = {
            hasClass: hasClass,
            addClass: addClass,
            removeClass: removeClass,
            getClass: getClass,
            hasSameClasses: haveSameClasses,
            hasAllClasses: hasAllClasses,
            replaceWithOwnChildren: replaceWithOwnChildrenPreservingPositions,
            elementsHaveSameNonClassAttributes: elementsHaveSameNonClassAttributes,
            elementHasNonClassAttributes: elementHasNonClassAttributes,
            splitNodeAt: splitNodeAt,
            isEditableElement: isEditableElement,
            isEditingHost: isEditingHost,
            isEditable: isEditable
        };

        api.CssClassApplier = api.ClassApplier = ClassApplier;
        api.createClassApplier = createClassApplier;
        util.createAliasForDeprecatedMethod(api, "createCssClassApplier", "createClassApplier", module);
    });
    
    return rangy;
}, this);

/**
 * Highlighter module for Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core, ClassApplier and optionally TextRange modules.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
(function(factory, root) {
    if (typeof define == "function" && define.amd) {
        // AMD. Register as an anonymous module with a dependency on Rangy.
        define(["./rangy-core"], factory);
    } else if (typeof module != "undefined" && typeof exports == "object") {
        // Node/CommonJS style
        module.exports = factory( require("rangy") );
    } else {
        // No AMD or CommonJS support so we use the rangy property of root (probably the global variable)
        factory(root.rangy);
    }
})(function(rangy) {
    rangy.createModule("Highlighter", ["ClassApplier"], function(api, module) {
        var dom = api.dom;
        var contains = dom.arrayContains;
        var getBody = dom.getBody;
        var createOptions = api.util.createOptions;
        var forEach = api.util.forEach;
        var nextHighlightId = 1;

        // Puts highlights in order, last in document first.
        function compareHighlights(h1, h2) {
            return h1.characterRange.start - h2.characterRange.start;
        }

        function getContainerElement(doc, id) {
            return id ? doc.getElementById(id) : getBody(doc);
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        var highlighterTypes = {};

        function HighlighterType(type, converterCreator) {
            this.type = type;
            this.converterCreator = converterCreator;
        }

        HighlighterType.prototype.create = function() {
            var converter = this.converterCreator();
            converter.type = this.type;
            return converter;
        };

        function registerHighlighterType(type, converterCreator) {
            highlighterTypes[type] = new HighlighterType(type, converterCreator);
        }

        function getConverter(type) {
            var highlighterType = highlighterTypes[type];
            if (highlighterType instanceof HighlighterType) {
                return highlighterType.create();
            } else {
                throw new Error("Highlighter type '" + type + "' is not valid");
            }
        }

        api.registerHighlighterType = registerHighlighterType;

        /*----------------------------------------------------------------------------------------------------------------*/

        function CharacterRange(start, end) {
            this.start = start;
            this.end = end;
        }

        CharacterRange.prototype = {
            intersects: function(charRange) {
                return this.start < charRange.end && this.end > charRange.start;
            },

            isContiguousWith: function(charRange) {
                return this.start == charRange.end || this.end == charRange.start;
            },

            union: function(charRange) {
                return new CharacterRange(Math.min(this.start, charRange.start), Math.max(this.end, charRange.end));
            },

            intersection: function(charRange) {
                return new CharacterRange(Math.max(this.start, charRange.start), Math.min(this.end, charRange.end));
            },

            getComplements: function(charRange) {
                var ranges = [];
                if (this.start >= charRange.start) {
                    if (this.end <= charRange.end) {
                        return [];
                    }
                    ranges.push(new CharacterRange(charRange.end, this.end));
                } else {
                    ranges.push(new CharacterRange(this.start, Math.min(this.end, charRange.start)));
                    if (this.end > charRange.end) {
                        ranges.push(new CharacterRange(charRange.end, this.end));
                    }
                }
                return ranges;
            },

            toString: function() {
                return "[CharacterRange(" + this.start + ", " + this.end + ")]";
            }
        };

        CharacterRange.fromCharacterRange = function(charRange) {
            return new CharacterRange(charRange.start, charRange.end);
        };

        /*----------------------------------------------------------------------------------------------------------------*/

        var textContentConverter = {
            rangeToCharacterRange: function(range, containerNode) {
                var bookmark = range.getBookmark(containerNode);
                return new CharacterRange(bookmark.start, bookmark.end);
            },

            characterRangeToRange: function(doc, characterRange, containerNode) {
                var range = api.createRange(doc);
                range.moveToBookmark({
                    start: characterRange.start,
                    end: characterRange.end,
                    containerNode: containerNode
                });

                return range;
            },

            serializeSelection: function(selection, containerNode) {
                var ranges = selection.getAllRanges(), rangeCount = ranges.length;
                var rangeInfos = [];

                var backward = rangeCount == 1 && selection.isBackward();

                for (var i = 0, len = ranges.length; i < len; ++i) {
                    rangeInfos[i] = {
                        characterRange: this.rangeToCharacterRange(ranges[i], containerNode),
                        backward: backward
                    };
                }

                return rangeInfos;
            },

            restoreSelection: function(selection, savedSelection, containerNode) {
                selection.removeAllRanges();
                var doc = selection.win.document;
                for (var i = 0, len = savedSelection.length, range, rangeInfo, characterRange; i < len; ++i) {
                    rangeInfo = savedSelection[i];
                    characterRange = rangeInfo.characterRange;
                    range = this.characterRangeToRange(doc, rangeInfo.characterRange, containerNode);
                    selection.addRange(range, rangeInfo.backward);
                }
            }
        };

        registerHighlighterType("textContent", function() {
            return textContentConverter;
        });

        /*----------------------------------------------------------------------------------------------------------------*/

        // Lazily load the TextRange-based converter so that the dependency is only checked when required.
        registerHighlighterType("TextRange", (function() {
            var converter;

            return function() {
                if (!converter) {
                    // Test that textRangeModule exists and is supported
                    var textRangeModule = api.modules.TextRange;
                    if (!textRangeModule) {
                        throw new Error("TextRange module is missing.");
                    } else if (!textRangeModule.supported) {
                        throw new Error("TextRange module is present but not supported.");
                    }

                    converter = {
                        rangeToCharacterRange: function(range, containerNode) {
                            return CharacterRange.fromCharacterRange( range.toCharacterRange(containerNode) );
                        },

                        characterRangeToRange: function(doc, characterRange, containerNode) {
                            var range = api.createRange(doc);
                            range.selectCharacters(containerNode, characterRange.start, characterRange.end);
                            return range;
                        },

                        serializeSelection: function(selection, containerNode) {
                            return selection.saveCharacterRanges(containerNode);
                        },

                        restoreSelection: function(selection, savedSelection, containerNode) {
                            selection.restoreCharacterRanges(containerNode, savedSelection);
                        }
                    };
                }

                return converter;
            };
        })());

        /*----------------------------------------------------------------------------------------------------------------*/

        function Highlight(doc, characterRange, classApplier, converter, id, containerElementId) {
            if (id) {
                this.id = id;
                nextHighlightId = Math.max(nextHighlightId, id + 1);
            } else {
                this.id = nextHighlightId++;
            }
            this.characterRange = characterRange;
            this.doc = doc;
            this.classApplier = classApplier;
            this.converter = converter;
            this.containerElementId = containerElementId || null;
            this.applied = false;
        }

        Highlight.prototype = {
            getContainerElement: function() {
                return getContainerElement(this.doc, this.containerElementId);
            },

            getRange: function() {
                return this.converter.characterRangeToRange(this.doc, this.characterRange, this.getContainerElement());
            },

            fromRange: function(range) {
                this.characterRange = this.converter.rangeToCharacterRange(range, this.getContainerElement());
            },

            getText: function() {
                return this.getRange().toString();
            },

            containsElement: function(el) {
                return this.getRange().containsNodeContents(el.firstChild);
            },

            unapply: function() {
                this.classApplier.undoToRange(this.getRange());
                this.applied = false;
            },

            apply: function() {
                this.classApplier.applyToRange(this.getRange());
                this.applied = true;
            },

            getHighlightElements: function() {
                return this.classApplier.getElementsWithClassIntersectingRange(this.getRange());
            },

            toString: function() {
                return "[Highlight(ID: " + this.id + ", class: " + this.classApplier.className + ", character range: " +
                    this.characterRange.start + " - " + this.characterRange.end + ")]";
            }
        };

        /*----------------------------------------------------------------------------------------------------------------*/

        function Highlighter(doc, type) {
            type = type || "textContent";
            this.doc = doc || document;
            this.classAppliers = {};
            this.highlights = [];
            this.converter = getConverter(type);
        }

        Highlighter.prototype = {
            addClassApplier: function(classApplier) {
                this.classAppliers[classApplier.className] = classApplier;
            },

            getHighlightForElement: function(el) {
                var highlights = this.highlights;
                for (var i = 0, len = highlights.length; i < len; ++i) {
                    if (highlights[i].containsElement(el)) {
                        return highlights[i];
                    }
                }
                return null;
            },

            removeHighlights: function(highlights) {
                for (var i = 0, len = this.highlights.length, highlight; i < len; ++i) {
                    highlight = this.highlights[i];
                    if (contains(highlights, highlight)) {
                        highlight.unapply();
                        this.highlights.splice(i--, 1);
                    }
                }
            },

            removeAllHighlights: function() {
                this.removeHighlights(this.highlights);
            },

            getIntersectingHighlights: function(ranges) {
                // Test each range against each of the highlighted ranges to see whether they overlap
                var intersectingHighlights = [], highlights = this.highlights;
                forEach(ranges, function(range) {
                    //var selCharRange = converter.rangeToCharacterRange(range);
                    forEach(highlights, function(highlight) {
                        if (range.intersectsRange( highlight.getRange() ) && !contains(intersectingHighlights, highlight)) {
                            intersectingHighlights.push(highlight);
                        }
                    });
                });

                return intersectingHighlights;
            },

            highlightCharacterRanges: function(className, charRanges, options) {
                var i, len, j;
                var highlights = this.highlights;
                var converter = this.converter;
                var doc = this.doc;
                var highlightsToRemove = [];
                var classApplier = className ? this.classAppliers[className] : null;

                options = createOptions(options, {
                    containerElementId: null,
                    exclusive: true
                });

                var containerElementId = options.containerElementId;
                var exclusive = options.exclusive;

                var containerElement, containerElementRange, containerElementCharRange;
                if (containerElementId) {
                    containerElement = this.doc.getElementById(containerElementId);
                    if (containerElement) {
                        containerElementRange = api.createRange(this.doc);
                        containerElementRange.selectNodeContents(containerElement);
                        containerElementCharRange = new CharacterRange(0, containerElementRange.toString().length);
                    }
                }

                var charRange, highlightCharRange, removeHighlight, isSameClassApplier, highlightsToKeep, splitHighlight;

                for (i = 0, len = charRanges.length; i < len; ++i) {
                    charRange = charRanges[i];
                    highlightsToKeep = [];

                    // Restrict character range to container element, if it exists
                    if (containerElementCharRange) {
                        charRange = charRange.intersection(containerElementCharRange);
                    }

                    // Ignore empty ranges
                    if (charRange.start == charRange.end) {
                        continue;
                    }

                    // Check for intersection with existing highlights. For each intersection, create a new highlight
                    // which is the union of the highlight range and the selected range
                    for (j = 0; j < highlights.length; ++j) {
                        removeHighlight = false;

                        if (containerElementId == highlights[j].containerElementId) {
                            highlightCharRange = highlights[j].characterRange;
                            isSameClassApplier = (classApplier == highlights[j].classApplier);
                            splitHighlight = !isSameClassApplier && exclusive;

                            // Replace the existing highlight if it needs to be:
                            //  1. merged (isSameClassApplier)
                            //  2. partially or entirely erased (className === null)
                            //  3. partially or entirely replaced (isSameClassApplier == false && exclusive == true)
                            if (    (highlightCharRange.intersects(charRange) || highlightCharRange.isContiguousWith(charRange)) &&
                                    (isSameClassApplier || splitHighlight) ) {

                                // Remove existing highlights, keeping the unselected parts
                                if (splitHighlight) {
                                    forEach(highlightCharRange.getComplements(charRange), function(rangeToAdd) {
                                        highlightsToKeep.push( new Highlight(doc, rangeToAdd, highlights[j].classApplier, converter, null, containerElementId) );
                                    });
                                }

                                removeHighlight = true;
                                if (isSameClassApplier) {
                                    charRange = highlightCharRange.union(charRange);
                                }
                            }
                        }

                        if (removeHighlight) {
                            highlightsToRemove.push(highlights[j]);
                            highlights[j] = new Highlight(doc, highlightCharRange.union(charRange), classApplier, converter, null, containerElementId);
                        } else {
                            highlightsToKeep.push(highlights[j]);
                        }
                    }

                    // Add new range
                    if (classApplier) {
                        highlightsToKeep.push(new Highlight(doc, charRange, classApplier, converter, null, containerElementId));
                    }
                    this.highlights = highlights = highlightsToKeep;
                }

                // Remove the old highlights
                forEach(highlightsToRemove, function(highlightToRemove) {
                    highlightToRemove.unapply();
                });

                // Apply new highlights
                var newHighlights = [];
                forEach(highlights, function(highlight) {
                    if (!highlight.applied) {
                        highlight.apply();
                        newHighlights.push(highlight);
                    }
                });

                return newHighlights;
            },

            highlightRanges: function(className, ranges, options) {
                var selCharRanges = [];
                var converter = this.converter;

                options = createOptions(options, {
                    containerElement: null,
                    exclusive: true
                });

                var containerElement = options.containerElement;
                var containerElementId = containerElement ? containerElement.id : null;
                var containerElementRange;
                if (containerElement) {
                    containerElementRange = api.createRange(containerElement);
                    containerElementRange.selectNodeContents(containerElement);
                }

                forEach(ranges, function(range) {
                    var scopedRange = containerElement ? containerElementRange.intersection(range) : range;
                    selCharRanges.push( converter.rangeToCharacterRange(scopedRange, containerElement || getBody(range.getDocument())) );
                });

                return this.highlightCharacterRanges(className, selCharRanges, {
                    containerElementId: containerElementId,
                    exclusive: options.exclusive
                });
            },

            highlightSelection: function(className, options) {
                var converter = this.converter;
                var classApplier = className ? this.classAppliers[className] : false;

                options = createOptions(options, {
                    containerElementId: null,
                    selection: api.getSelection(this.doc),
                    exclusive: true
                });

                var containerElementId = options.containerElementId;
                var exclusive = options.exclusive;
                var selection = options.selection;
                var doc = selection.win.document;
                var containerElement = getContainerElement(doc, containerElementId);

                if (!classApplier && className !== false) {
                    throw new Error("No class applier found for class '" + className + "'");
                }

                // Store the existing selection as character ranges
                var serializedSelection = converter.serializeSelection(selection, containerElement);

                // Create an array of selected character ranges
                var selCharRanges = [];
                forEach(serializedSelection, function(rangeInfo) {
                    selCharRanges.push( CharacterRange.fromCharacterRange(rangeInfo.characterRange) );
                });

                var newHighlights = this.highlightCharacterRanges(className, selCharRanges, {
                    containerElementId: containerElementId,
                    exclusive: exclusive
                });

                // Restore selection
                converter.restoreSelection(selection, serializedSelection, containerElement);

                return newHighlights;
            },

            unhighlightSelection: function(selection) {
                selection = selection || api.getSelection(this.doc);
                var intersectingHighlights = this.getIntersectingHighlights( selection.getAllRanges() );
                this.removeHighlights(intersectingHighlights);
                selection.removeAllRanges();
                return intersectingHighlights;
            },

            getHighlightsInSelection: function(selection) {
                selection = selection || api.getSelection(this.doc);
                return this.getIntersectingHighlights(selection.getAllRanges());
            },

            selectionOverlapsHighlight: function(selection) {
                return this.getHighlightsInSelection(selection).length > 0;
            },

            serialize: function(options) {
                var highlighter = this;
                var highlights = highlighter.highlights;
                var serializedType, serializedHighlights, convertType, serializationConverter;

                highlights.sort(compareHighlights);
                options = createOptions(options, {
                    serializeHighlightText: false,
                    type: highlighter.converter.type
                });

                serializedType = options.type;
                convertType = (serializedType != highlighter.converter.type);

                if (convertType) {
                    serializationConverter = getConverter(serializedType);
                }

                serializedHighlights = ["type:" + serializedType];

                forEach(highlights, function(highlight) {
                    var characterRange = highlight.characterRange;
                    var containerElement;

                    // Convert to the current Highlighter's type, if different from the serialization type
                    if (convertType) {
                        containerElement = highlight.getContainerElement();
                        characterRange = serializationConverter.rangeToCharacterRange(
                            highlighter.converter.characterRangeToRange(highlighter.doc, characterRange, containerElement),
                            containerElement
                        );
                    }

                    var parts = [
                        characterRange.start,
                        characterRange.end,
                        highlight.id,
                        highlight.classApplier.className,
                        highlight.containerElementId
                    ];

                    if (options.serializeHighlightText) {
                        parts.push(highlight.getText());
                    }
                    serializedHighlights.push( parts.join("$") );
                });

                return serializedHighlights.join("|");
            },

            deserialize: function(serialized) {
                var serializedHighlights = serialized.split("|");
                var highlights = [];

                var firstHighlight = serializedHighlights[0];
                var regexResult;
                var serializationType, serializationConverter, convertType = false;
                if ( firstHighlight && (regexResult = /^type:(\w+)$/.exec(firstHighlight)) ) {
                    serializationType = regexResult[1];
                    if (serializationType != this.converter.type) {
                        serializationConverter = getConverter(serializationType);
                        convertType = true;
                    }
                    serializedHighlights.shift();
                } else {
                    throw new Error("Serialized highlights are invalid.");
                }

                var classApplier, highlight, characterRange, containerElementId, containerElement;

                for (var i = serializedHighlights.length, parts; i-- > 0; ) {
                    parts = serializedHighlights[i].split("$");
                    characterRange = new CharacterRange(+parts[0], +parts[1]);
                    containerElementId = parts[4] || null;

                    // Convert to the current Highlighter's type, if different from the serialization type
                    if (convertType) {
                        containerElement = getContainerElement(this.doc, containerElementId);
                        characterRange = this.converter.rangeToCharacterRange(
                            serializationConverter.characterRangeToRange(this.doc, characterRange, containerElement),
                            containerElement
                        );
                    }

                    classApplier = this.classAppliers[ parts[3] ];

                    if (!classApplier) {
                        throw new Error("No class applier found for class '" + parts[3] + "'");
                    }

                    highlight = new Highlight(this.doc, characterRange, classApplier, this.converter, parseInt(parts[2]), containerElementId);
                    highlight.apply();
                    highlights.push(highlight);
                }
                this.highlights = highlights;
            }
        };

        api.Highlighter = Highlighter;

        api.createHighlighter = function(doc, rangeCharacterOffsetConverterType) {
            return new Highlighter(doc, rangeCharacterOffsetConverterType);
        };
    });
    
    return rangy;
}, this);

/**
 * Selection save and restore module for Rangy.
 * Saves and restores user selections using marker invisible elements in the DOM.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
(function(factory, root) {
    if (typeof define == "function" && define.amd) {
        // AMD. Register as an anonymous module with a dependency on Rangy.
        define(["./rangy-core"], factory);
    } else if (typeof module != "undefined" && typeof exports == "object") {
        // Node/CommonJS style
        module.exports = factory( require("rangy") );
    } else {
        // No AMD or CommonJS support so we use the rangy property of root (probably the global variable)
        factory(root.rangy);
    }
})(function(rangy) {
    rangy.createModule("SaveRestore", ["WrappedRange"], function(api, module) {
        var dom = api.dom;
        var removeNode = dom.removeNode;
        var isDirectionBackward = api.Selection.isDirectionBackward;
        var markerTextChar = "\ufeff";

        function gEBI(id, doc) {
            return (doc || document).getElementById(id);
        }

        function insertRangeBoundaryMarker(range, atStart) {
            var markerId = "selectionBoundary_" + (+new Date()) + "_" + ("" + Math.random()).slice(2);
            var markerEl;
            var doc = dom.getDocument(range.startContainer);

            // Clone the Range and collapse to the appropriate boundary point
            var boundaryRange = range.cloneRange();
            boundaryRange.collapse(atStart);

            // Create the marker element containing a single invisible character using DOM methods and insert it
            markerEl = doc.createElement("span");
            markerEl.id = markerId;
            markerEl.style.lineHeight = "0";
            markerEl.style.display = "none";
            markerEl.className = "rangySelectionBoundary";
            markerEl.appendChild(doc.createTextNode(markerTextChar));

            boundaryRange.insertNode(markerEl);
            return markerEl;
        }

        function setRangeBoundary(doc, range, markerId, atStart) {
            var markerEl = gEBI(markerId, doc);
            if (markerEl) {
                range[atStart ? "setStartBefore" : "setEndBefore"](markerEl);
                removeNode(markerEl);
            } else {
                module.warn("Marker element has been removed. Cannot restore selection.");
            }
        }

        function compareRanges(r1, r2) {
            return r2.compareBoundaryPoints(r1.START_TO_START, r1);
        }

        function saveRange(range, direction) {
            var startEl, endEl, doc = api.DomRange.getRangeDocument(range), text = range.toString();
            var backward = isDirectionBackward(direction);

            if (range.collapsed) {
                endEl = insertRangeBoundaryMarker(range, false);
                return {
                    document: doc,
                    markerId: endEl.id,
                    collapsed: true
                };
            } else {
                endEl = insertRangeBoundaryMarker(range, false);
                startEl = insertRangeBoundaryMarker(range, true);

                return {
                    document: doc,
                    startMarkerId: startEl.id,
                    endMarkerId: endEl.id,
                    collapsed: false,
                    backward: backward,
                    toString: function() {
                        return "original text: '" + text + "', new text: '" + range.toString() + "'";
                    }
                };
            }
        }

        function restoreRange(rangeInfo, normalize) {
            var doc = rangeInfo.document;
            if (typeof normalize == "undefined") {
                normalize = true;
            }
            var range = api.createRange(doc);
            if (rangeInfo.collapsed) {
                var markerEl = gEBI(rangeInfo.markerId, doc);
                if (markerEl) {
                    markerEl.style.display = "inline";
                    var previousNode = markerEl.previousSibling;

                    // Workaround for issue 17
                    if (previousNode && previousNode.nodeType == 3) {
                        removeNode(markerEl);
                        range.collapseToPoint(previousNode, previousNode.length);
                    } else {
                        range.collapseBefore(markerEl);
                        removeNode(markerEl);
                    }
                } else {
                    module.warn("Marker element has been removed. Cannot restore selection.");
                }
            } else {
                setRangeBoundary(doc, range, rangeInfo.startMarkerId, true);
                setRangeBoundary(doc, range, rangeInfo.endMarkerId, false);
            }

            if (normalize) {
                range.normalizeBoundaries();
            }

            return range;
        }

        function saveRanges(ranges, direction) {
            var rangeInfos = [], range, doc;
            var backward = isDirectionBackward(direction);

            // Order the ranges by position within the DOM, latest first, cloning the array to leave the original untouched
            ranges = ranges.slice(0);
            ranges.sort(compareRanges);

            for (var i = 0, len = ranges.length; i < len; ++i) {
                rangeInfos[i] = saveRange(ranges[i], backward);
            }

            // Now that all the markers are in place and DOM manipulation over, adjust each range's boundaries to lie
            // between its markers
            for (i = len - 1; i >= 0; --i) {
                range = ranges[i];
                doc = api.DomRange.getRangeDocument(range);
                if (range.collapsed) {
                    range.collapseAfter(gEBI(rangeInfos[i].markerId, doc));
                } else {
                    range.setEndBefore(gEBI(rangeInfos[i].endMarkerId, doc));
                    range.setStartAfter(gEBI(rangeInfos[i].startMarkerId, doc));
                }
            }

            return rangeInfos;
        }

        function saveSelection(win) {
            if (!api.isSelectionValid(win)) {
                module.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.");
                return null;
            }
            var sel = api.getSelection(win);
            var ranges = sel.getAllRanges();
            var backward = (ranges.length == 1 && sel.isBackward());

            var rangeInfos = saveRanges(ranges, backward);

            // Ensure current selection is unaffected
            if (backward) {
                sel.setSingleRange(ranges[0], backward);
            } else {
                sel.setRanges(ranges);
            }

            return {
                win: win,
                rangeInfos: rangeInfos,
                restored: false
            };
        }

        function restoreRanges(rangeInfos) {
            var ranges = [];

            // Ranges are in reverse order of appearance in the DOM. We want to restore earliest first to avoid
            // normalization affecting previously restored ranges.
            var rangeCount = rangeInfos.length;

            for (var i = rangeCount - 1; i >= 0; i--) {
                ranges[i] = restoreRange(rangeInfos[i], true);
            }

            return ranges;
        }

        function restoreSelection(savedSelection, preserveDirection) {
            if (!savedSelection.restored) {
                var rangeInfos = savedSelection.rangeInfos;
                var sel = api.getSelection(savedSelection.win);
                var ranges = restoreRanges(rangeInfos), rangeCount = rangeInfos.length;

                if (rangeCount == 1 && preserveDirection && api.features.selectionHasExtend && rangeInfos[0].backward) {
                    sel.removeAllRanges();
                    sel.addRange(ranges[0], true);
                } else {
                    sel.setRanges(ranges);
                }

                savedSelection.restored = true;
            }
        }

        function removeMarkerElement(doc, markerId) {
            var markerEl = gEBI(markerId, doc);
            if (markerEl) {
                removeNode(markerEl);
            }
        }

        function removeMarkers(savedSelection) {
            var rangeInfos = savedSelection.rangeInfos;
            for (var i = 0, len = rangeInfos.length, rangeInfo; i < len; ++i) {
                rangeInfo = rangeInfos[i];
                if (rangeInfo.collapsed) {
                    removeMarkerElement(savedSelection.doc, rangeInfo.markerId);
                } else {
                    removeMarkerElement(savedSelection.doc, rangeInfo.startMarkerId);
                    removeMarkerElement(savedSelection.doc, rangeInfo.endMarkerId);
                }
            }
        }

        api.util.extend(api, {
            saveRange: saveRange,
            restoreRange: restoreRange,
            saveRanges: saveRanges,
            restoreRanges: restoreRanges,
            saveSelection: saveSelection,
            restoreSelection: restoreSelection,
            removeMarkerElement: removeMarkerElement,
            removeMarkers: removeMarkers
        });
    });
    
    return rangy;
}, this);
/**
 * Serializer module for Rangy.
 * Serializes Ranges and Selections. An example use would be to store a user's selection on a particular page in a
 * cookie or local storage and restore it on the user's next visit to the same page.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
(function(factory, root) {
    if (typeof define == "function" && define.amd) {
        // AMD. Register as an anonymous module with a dependency on Rangy.
        define(["./rangy-core"], factory);
    } else if (typeof module != "undefined" && typeof exports == "object") {
        // Node/CommonJS style
        module.exports = factory( require("rangy") );
    } else {
        // No AMD or CommonJS support so we use the rangy property of root (probably the global variable)
        factory(root.rangy);
    }
})(function(rangy) {
    rangy.createModule("Serializer", ["WrappedSelection"], function(api, module) {
        var UNDEF = "undefined";
        var util = api.util;

        // encodeURIComponent and decodeURIComponent are required for cookie handling
        if (typeof encodeURIComponent == UNDEF || typeof decodeURIComponent == UNDEF) {
            module.fail("encodeURIComponent and/or decodeURIComponent method is missing");
        }

        // Checksum for checking whether range can be serialized
        var crc32 = (function() {
            function utf8encode(str) {
                var utf8CharCodes = [];

                for (var i = 0, len = str.length, c; i < len; ++i) {
                    c = str.charCodeAt(i);
                    if (c < 128) {
                        utf8CharCodes.push(c);
                    } else if (c < 2048) {
                        utf8CharCodes.push((c >> 6) | 192, (c & 63) | 128);
                    } else {
                        utf8CharCodes.push((c >> 12) | 224, ((c >> 6) & 63) | 128, (c & 63) | 128);
                    }
                }
                return utf8CharCodes;
            }

            var cachedCrcTable = null;

            function buildCRCTable() {
                var table = [];
                for (var i = 0, j, crc; i < 256; ++i) {
                    crc = i;
                    j = 8;
                    while (j--) {
                        if ((crc & 1) == 1) {
                            crc = (crc >>> 1) ^ 0xEDB88320;
                        } else {
                            crc >>>= 1;
                        }
                    }
                    table[i] = crc >>> 0;
                }
                return table;
            }

            function getCrcTable() {
                if (!cachedCrcTable) {
                    cachedCrcTable = buildCRCTable();
                }
                return cachedCrcTable;
            }

            return function(str) {
                var utf8CharCodes = utf8encode(str), crc = -1, crcTable = getCrcTable();
                for (var i = 0, len = utf8CharCodes.length, y; i < len; ++i) {
                    y = (crc ^ utf8CharCodes[i]) & 0xFF;
                    crc = (crc >>> 8) ^ crcTable[y];
                }
                return (crc ^ -1) >>> 0;
            };
        })();

        var dom = api.dom;

        function escapeTextForHtml(str) {
            return str.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        }

        function nodeToInfoString(node, infoParts) {
            infoParts = infoParts || [];
            var nodeType = node.nodeType, children = node.childNodes, childCount = children.length;
            var nodeInfo = [nodeType, node.nodeName, childCount].join(":");
            var start = "", end = "";
            switch (nodeType) {
                case 3: // Text node
                    start = escapeTextForHtml(node.nodeValue);
                    break;
                case 8: // Comment
                    start = "<!--" + escapeTextForHtml(node.nodeValue) + "-->";
                    break;
                default:
                    start = "<" + nodeInfo + ">";
                    end = "</>";
                    break;
            }
            if (start) {
                infoParts.push(start);
            }
            for (var i = 0; i < childCount; ++i) {
                nodeToInfoString(children[i], infoParts);
            }
            if (end) {
                infoParts.push(end);
            }
            return infoParts;
        }

        // Creates a string representation of the specified element's contents that is similar to innerHTML but omits all
        // attributes and comments and includes child node counts. This is done instead of using innerHTML to work around
        // IE <= 8's policy of including element properties in attributes, which ruins things by changing an element's
        // innerHTML whenever the user changes an input within the element.
        function getElementChecksum(el) {
            var info = nodeToInfoString(el).join("");
            return crc32(info).toString(16);
        }

        function serializePosition(node, offset, rootNode) {
            var pathParts = [], n = node;
            rootNode = rootNode || dom.getDocument(node).documentElement;
            while (n && n != rootNode) {
                pathParts.push(dom.getNodeIndex(n, true));
                n = n.parentNode;
            }
            return pathParts.join("/") + ":" + offset;
        }

        function deserializePosition(serialized, rootNode, doc) {
            if (!rootNode) {
                rootNode = (doc || document).documentElement;
            }
            var parts = serialized.split(":");
            var node = rootNode;
            var nodeIndices = parts[0] ? parts[0].split("/") : [], i = nodeIndices.length, nodeIndex;

            while (i--) {
                nodeIndex = parseInt(nodeIndices[i], 10);
                if (nodeIndex < node.childNodes.length) {
                    node = node.childNodes[nodeIndex];
                } else {
                    throw module.createError("deserializePosition() failed: node " + dom.inspectNode(node) +
                            " has no child with index " + nodeIndex + ", " + i);
                }
            }

            return new dom.DomPosition(node, parseInt(parts[1], 10));
        }

        function serializeRange(range, omitChecksum, rootNode) {
            rootNode = rootNode || api.DomRange.getRangeDocument(range).documentElement;
            if (!dom.isOrIsAncestorOf(rootNode, range.commonAncestorContainer)) {
                throw module.createError("serializeRange(): range " + range.inspect() +
                    " is not wholly contained within specified root node " + dom.inspectNode(rootNode));
            }
            var serialized = serializePosition(range.startContainer, range.startOffset, rootNode) + "," +
                serializePosition(range.endContainer, range.endOffset, rootNode);
            if (!omitChecksum) {
                serialized += "{" + getElementChecksum(rootNode) + "}";
            }
            return serialized;
        }

        var deserializeRegex = /^([^,]+),([^,\{]+)(\{([^}]+)\})?$/;

        function deserializeRange(serialized, rootNode, doc) {
            if (rootNode) {
                doc = doc || dom.getDocument(rootNode);
            } else {
                doc = doc || document;
                rootNode = doc.documentElement;
            }
            var result = deserializeRegex.exec(serialized);
            var checksum = result[4];
            if (checksum) {
                var rootNodeChecksum = getElementChecksum(rootNode);
                if (checksum !== rootNodeChecksum) {
                    throw module.createError("deserializeRange(): checksums of serialized range root node (" + checksum +
                        ") and target root node (" + rootNodeChecksum + ") do not match");
                }
            }
            var start = deserializePosition(result[1], rootNode, doc), end = deserializePosition(result[2], rootNode, doc);
            var range = api.createRange(doc);
            range.setStartAndEnd(start.node, start.offset, end.node, end.offset);
            return range;
        }

        function canDeserializeRange(serialized, rootNode, doc) {
            if (!rootNode) {
                rootNode = (doc || document).documentElement;
            }
            var result = deserializeRegex.exec(serialized);
            var checksum = result[3];
            return !checksum || checksum === getElementChecksum(rootNode);
        }

        function serializeSelection(selection, omitChecksum, rootNode) {
            selection = api.getSelection(selection);
            var ranges = selection.getAllRanges(), serializedRanges = [];
            for (var i = 0, len = ranges.length; i < len; ++i) {
                serializedRanges[i] = serializeRange(ranges[i], omitChecksum, rootNode);
            }
            return serializedRanges.join("|");
        }

        function deserializeSelection(serialized, rootNode, win) {
            if (rootNode) {
                win = win || dom.getWindow(rootNode);
            } else {
                win = win || window;
                rootNode = win.document.documentElement;
            }
            var serializedRanges = serialized.split("|");
            var sel = api.getSelection(win);
            var ranges = [];

            for (var i = 0, len = serializedRanges.length; i < len; ++i) {
                ranges[i] = deserializeRange(serializedRanges[i], rootNode, win.document);
            }
            sel.setRanges(ranges);

            return sel;
        }

        function canDeserializeSelection(serialized, rootNode, win) {
            var doc;
            if (rootNode) {
                doc = win ? win.document : dom.getDocument(rootNode);
            } else {
                win = win || window;
                rootNode = win.document.documentElement;
            }
            var serializedRanges = serialized.split("|");

            for (var i = 0, len = serializedRanges.length; i < len; ++i) {
                if (!canDeserializeRange(serializedRanges[i], rootNode, doc)) {
                    return false;
                }
            }

            return true;
        }

        var cookieName = "rangySerializedSelection";

        function getSerializedSelectionFromCookie(cookie) {
            var parts = cookie.split(/[;,]/);
            for (var i = 0, len = parts.length, nameVal, val; i < len; ++i) {
                nameVal = parts[i].split("=");
                if (nameVal[0].replace(/^\s+/, "") == cookieName) {
                    val = nameVal[1];
                    if (val) {
                        return decodeURIComponent(val.replace(/\s+$/, ""));
                    }
                }
            }
            return null;
        }

        function restoreSelectionFromCookie(win) {
            win = win || window;
            var serialized = getSerializedSelectionFromCookie(win.document.cookie);
            if (serialized) {
                deserializeSelection(serialized, win.doc);
            }
        }

        function saveSelectionCookie(win, props) {
            win = win || window;
            props = (typeof props == "object") ? props : {};
            var expires = props.expires ? ";expires=" + props.expires.toUTCString() : "";
            var path = props.path ? ";path=" + props.path : "";
            var domain = props.domain ? ";domain=" + props.domain : "";
            var secure = props.secure ? ";secure" : "";
            var serialized = serializeSelection(api.getSelection(win));
            win.document.cookie = encodeURIComponent(cookieName) + "=" + encodeURIComponent(serialized) + expires + path + domain + secure;
        }

        util.extend(api, {
            serializePosition: serializePosition,
            deserializePosition: deserializePosition,
            serializeRange: serializeRange,
            deserializeRange: deserializeRange,
            canDeserializeRange: canDeserializeRange,
            serializeSelection: serializeSelection,
            deserializeSelection: deserializeSelection,
            canDeserializeSelection: canDeserializeSelection,
            restoreSelectionFromCookie: restoreSelectionFromCookie,
            saveSelectionCookie: saveSelectionCookie,
            getElementChecksum: getElementChecksum,
            nodeToInfoString: nodeToInfoString
        });

        util.crc32 = crc32;
    });
    
    return rangy;
}, this);
/**
 * Text range module for Rangy.
 * Text-based manipulation and searching of ranges and selections.
 *
 * Features
 *
 * - Ability to move range boundaries by character or word offsets
 * - Customizable word tokenizer
 * - Ignores text nodes inside <script> or <style> elements or those hidden by CSS display and visibility properties
 * - Range findText method to search for text or regex within the page or within a range. Flags for whole words and case
 *   sensitivity
 * - Selection and range save/restore as text offsets within a node
 * - Methods to return visible text within a range or selection
 * - innerText method for elements
 *
 * References
 *
 * https://www.w3.org/Bugs/Public/show_bug.cgi?id=13145
 * http://aryeh.name/spec/innertext/innertext.html
 * http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */

/**
 * Problem: handling of trailing spaces before line breaks is handled inconsistently between browsers.
 *
 * First, a <br>: this is relatively simple. For the following HTML:
 *
 * 1 <br>2
 *
 * - IE and WebKit render the space, include it in the selection (i.e. when the content is selected and pasted into a
 *   textarea, the space is present) and allow the caret to be placed after it.
 * - Firefox does not acknowledge the space in the selection but it is possible to place the caret after it.
 * - Opera does not render the space but has two separate caret positions on either side of the space (left and right
 *   arrow keys show this) and includes the space in the selection.
 *
 * The other case is the line break or breaks implied by block elements. For the following HTML:
 *
 * <p>1 </p><p>2<p>
 *
 * - WebKit does not acknowledge the space in any way
 * - Firefox, IE and Opera as per <br>
 *
 * One more case is trailing spaces before line breaks in elements with white-space: pre-line. For the following HTML:
 *
 * <p style="white-space: pre-line">1
 * 2</p>
 *
 * - Firefox and WebKit include the space in caret positions
 * - IE does not support pre-line up to and including version 9
 * - Opera ignores the space
 * - Trailing space only renders if there is a non-collapsed character in the line
 *
 * Problem is whether Rangy should ever acknowledge the space and if so, when. Another problem is whether this can be
 * feature-tested
 */
(function(factory, root) {
    if (typeof define == "function" && define.amd) {
        // AMD. Register as an anonymous module with a dependency on Rangy.
        define(["./rangy-core"], factory);
    } else if (typeof module != "undefined" && typeof exports == "object") {
        // Node/CommonJS style
        module.exports = factory( require("rangy") );
    } else {
        // No AMD or CommonJS support so we use the rangy property of root (probably the global variable)
        factory(root.rangy);
    }
})(function(rangy) {
    rangy.createModule("TextRange", ["WrappedSelection"], function(api, module) {
        var UNDEF = "undefined";
        var CHARACTER = "character", WORD = "word";
        var dom = api.dom, util = api.util;
        var extend = util.extend;
        var createOptions = util.createOptions;
        var getBody = dom.getBody;


        var spacesRegex = /^[ \t\f\r\n]+$/;
        var spacesMinusLineBreaksRegex = /^[ \t\f\r]+$/;
        var allWhiteSpaceRegex = /^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/;
        var nonLineBreakWhiteSpaceRegex = /^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/;
        var lineBreakRegex = /^[\n-\r\u0085\u2028\u2029]$/;

        var defaultLanguage = "en";

        var isDirectionBackward = api.Selection.isDirectionBackward;

        // Properties representing whether trailing spaces inside blocks are completely collapsed (as they are in WebKit,
        // but not other browsers). Also test whether trailing spaces before <br> elements are collapsed.
        var trailingSpaceInBlockCollapses = false;
        var trailingSpaceBeforeBrCollapses = false;
        var trailingSpaceBeforeBlockCollapses = false;
        var trailingSpaceBeforeLineBreakInPreLineCollapses = true;

        (function() {
            var el = dom.createTestElement(document, "<p>1 </p><p></p>", true);
            var p = el.firstChild;
            var sel = api.getSelection();
            sel.collapse(p.lastChild, 2);
            sel.setStart(p.firstChild, 0);
            trailingSpaceInBlockCollapses = ("" + sel).length == 1;

            el.innerHTML = "1 <br />";
            sel.collapse(el, 2);
            sel.setStart(el.firstChild, 0);
            trailingSpaceBeforeBrCollapses = ("" + sel).length == 1;

            el.innerHTML = "1 <p>1</p>";
            sel.collapse(el, 2);
            sel.setStart(el.firstChild, 0);
            trailingSpaceBeforeBlockCollapses = ("" + sel).length == 1;

            dom.removeNode(el);
            sel.removeAllRanges();
        })();

        /*----------------------------------------------------------------------------------------------------------------*/

        // This function must create word and non-word tokens for the whole of the text supplied to it
        function defaultTokenizer(chars, wordOptions) {
            var word = chars.join(""), result, tokenRanges = [];

            function createTokenRange(start, end, isWord) {
                tokenRanges.push( { start: start, end: end, isWord: isWord } );
            }

            // Match words and mark characters
            var lastWordEnd = 0, wordStart, wordEnd;
            while ( (result = wordOptions.wordRegex.exec(word)) ) {
                wordStart = result.index;
                wordEnd = wordStart + result[0].length;

                // Create token for non-word characters preceding this word
                if (wordStart > lastWordEnd) {
                    createTokenRange(lastWordEnd, wordStart, false);
                }

                // Get trailing space characters for word
                if (wordOptions.includeTrailingSpace) {
                    while ( nonLineBreakWhiteSpaceRegex.test(chars[wordEnd]) ) {
                        ++wordEnd;
                    }
                }
                createTokenRange(wordStart, wordEnd, true);
                lastWordEnd = wordEnd;
            }

            // Create token for trailing non-word characters, if any exist
            if (lastWordEnd < chars.length) {
                createTokenRange(lastWordEnd, chars.length, false);
            }

            return tokenRanges;
        }

        function convertCharRangeToToken(chars, tokenRange) {
            var tokenChars = chars.slice(tokenRange.start, tokenRange.end);
            var token = {
                isWord: tokenRange.isWord,
                chars: tokenChars,
                toString: function() {
                    return tokenChars.join("");
                }
            };
            for (var i = 0, len = tokenChars.length; i < len; ++i) {
                tokenChars[i].token = token;
            }
            return token;
        }

        function tokenize(chars, wordOptions, tokenizer) {
            var tokenRanges = tokenizer(chars, wordOptions);
            var tokens = [];
            for (var i = 0, tokenRange; tokenRange = tokenRanges[i++]; ) {
                tokens.push( convertCharRangeToToken(chars, tokenRange) );
            }
            return tokens;
        }

        var defaultCharacterOptions = {
            includeBlockContentTrailingSpace: true,
            includeSpaceBeforeBr: true,
            includeSpaceBeforeBlock: true,
            includePreLineTrailingSpace: true,
            ignoreCharacters: ""
        };

        function normalizeIgnoredCharacters(ignoredCharacters) {
            // Check if character is ignored
            var ignoredChars = ignoredCharacters || "";

            // Normalize ignored characters into a string consisting of characters in ascending order of character code
            var ignoredCharsArray = (typeof ignoredChars == "string") ? ignoredChars.split("") : ignoredChars;
            ignoredCharsArray.sort(function(char1, char2) {
                return char1.charCodeAt(0) - char2.charCodeAt(0);
            });

            /// Convert back to a string and remove duplicates
            return ignoredCharsArray.join("").replace(/(.)\1+/g, "$1");
        }

        var defaultCaretCharacterOptions = {
            includeBlockContentTrailingSpace: !trailingSpaceBeforeLineBreakInPreLineCollapses,
            includeSpaceBeforeBr: !trailingSpaceBeforeBrCollapses,
            includeSpaceBeforeBlock: !trailingSpaceBeforeBlockCollapses,
            includePreLineTrailingSpace: true
        };

        var defaultWordOptions = {
            "en": {
                wordRegex: /[a-z0-9]+('[a-z0-9]+)*/gi,
                includeTrailingSpace: false,
                tokenizer: defaultTokenizer
            }
        };

        var defaultFindOptions = {
            caseSensitive: false,
            withinRange: null,
            wholeWordsOnly: false,
            wrap: false,
            direction: "forward",
            wordOptions: null,
            characterOptions: null
        };

        var defaultMoveOptions = {
            wordOptions: null,
            characterOptions: null
        };

        var defaultExpandOptions = {
            wordOptions: null,
            characterOptions: null,
            trim: false,
            trimStart: true,
            trimEnd: true
        };

        var defaultWordIteratorOptions = {
            wordOptions: null,
            characterOptions: null,
            direction: "forward"
        };

        function createWordOptions(options) {
            var lang, defaults;
            if (!options) {
                return defaultWordOptions[defaultLanguage];
            } else {
                lang = options.language || defaultLanguage;
                defaults = {};
                extend(defaults, defaultWordOptions[lang] || defaultWordOptions[defaultLanguage]);
                extend(defaults, options);
                return defaults;
            }
        }

        function createNestedOptions(optionsParam, defaults) {
            var options = createOptions(optionsParam, defaults);
            if (defaults.hasOwnProperty("wordOptions")) {
                options.wordOptions = createWordOptions(options.wordOptions);
            }
            if (defaults.hasOwnProperty("characterOptions")) {
                options.characterOptions = createOptions(options.characterOptions, defaultCharacterOptions);
            }
            return options;
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        /* DOM utility functions */
        var getComputedStyleProperty = dom.getComputedStyleProperty;

        // Create cachable versions of DOM functions

        // Test for old IE's incorrect display properties
        var tableCssDisplayBlock;
        (function() {
            var table = document.createElement("table");
            var body = getBody(document);
            body.appendChild(table);
            tableCssDisplayBlock = (getComputedStyleProperty(table, "display") == "block");
            body.removeChild(table);
        })();

        var defaultDisplayValueForTag = {
            table: "table",
            caption: "table-caption",
            colgroup: "table-column-group",
            col: "table-column",
            thead: "table-header-group",
            tbody: "table-row-group",
            tfoot: "table-footer-group",
            tr: "table-row",
            td: "table-cell",
            th: "table-cell"
        };

        // Corrects IE's "block" value for table-related elements
        function getComputedDisplay(el, win) {
            var display = getComputedStyleProperty(el, "display", win);
            var tagName = el.tagName.toLowerCase();
            return (display == "block" &&
                    tableCssDisplayBlock &&
                    defaultDisplayValueForTag.hasOwnProperty(tagName)) ?
                defaultDisplayValueForTag[tagName] : display;
        }

        function isHidden(node) {
            var ancestors = getAncestorsAndSelf(node);
            for (var i = 0, len = ancestors.length; i < len; ++i) {
                if (ancestors[i].nodeType == 1 && getComputedDisplay(ancestors[i]) == "none") {
                    return true;
                }
            }

            return false;
        }

        function isVisibilityHiddenTextNode(textNode) {
            var el;
            return textNode.nodeType == 3 &&
                (el = textNode.parentNode) &&
                getComputedStyleProperty(el, "visibility") == "hidden";
        }

        /*----------------------------------------------------------------------------------------------------------------*/

    
        // "A block node is either an Element whose "display" property does not have
        // resolved value "inline" or "inline-block" or "inline-table" or "none", or a
        // Document, or a DocumentFragment."
        function isBlockNode(node) {
            return node &&
                ((node.nodeType == 1 && !/^(inline(-block|-table)?|none)$/.test(getComputedDisplay(node))) ||
                node.nodeType == 9 || node.nodeType == 11);
        }

        function getLastDescendantOrSelf(node) {
            var lastChild = node.lastChild;
            return lastChild ? getLastDescendantOrSelf(lastChild) : node;
        }

        function containsPositions(node) {
            return dom.isCharacterDataNode(node) ||
                !/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(node.nodeName);
        }

        function getAncestors(node) {
            var ancestors = [];
            while (node.parentNode) {
                ancestors.unshift(node.parentNode);
                node = node.parentNode;
            }
            return ancestors;
        }

        function getAncestorsAndSelf(node) {
            return getAncestors(node).concat([node]);
        }

        function nextNodeDescendants(node) {
            while (node && !node.nextSibling) {
                node = node.parentNode;
            }
            if (!node) {
                return null;
            }
            return node.nextSibling;
        }

        function nextNode(node, excludeChildren) {
            if (!excludeChildren && node.hasChildNodes()) {
                return node.firstChild;
            }
            return nextNodeDescendants(node);
        }

        function previousNode(node) {
            var previous = node.previousSibling;
            if (previous) {
                node = previous;
                while (node.hasChildNodes()) {
                    node = node.lastChild;
                }
                return node;
            }
            var parent = node.parentNode;
            if (parent && parent.nodeType == 1) {
                return parent;
            }
            return null;
        }

        // Adpated from Aryeh's code.
        // "A whitespace node is either a Text node whose data is the empty string; or
        // a Text node whose data consists only of one or more tabs (0x0009), line
        // feeds (0x000A), carriage returns (0x000D), and/or spaces (0x0020), and whose
        // parent is an Element whose resolved value for "white-space" is "normal" or
        // "nowrap"; or a Text node whose data consists only of one or more tabs
        // (0x0009), carriage returns (0x000D), and/or spaces (0x0020), and whose
        // parent is an Element whose resolved value for "white-space" is "pre-line"."
        function isWhitespaceNode(node) {
            if (!node || node.nodeType != 3) {
                return false;
            }
            var text = node.data;
            if (text === "") {
                return true;
            }
            var parent = node.parentNode;
            if (!parent || parent.nodeType != 1) {
                return false;
            }
            var computedWhiteSpace = getComputedStyleProperty(node.parentNode, "whiteSpace");

            return (/^[\t\n\r ]+$/.test(text) && /^(normal|nowrap)$/.test(computedWhiteSpace)) ||
                (/^[\t\r ]+$/.test(text) && computedWhiteSpace == "pre-line");
        }

        // Adpated from Aryeh's code.
        // "node is a collapsed whitespace node if the following algorithm returns
        // true:"
        function isCollapsedWhitespaceNode(node) {
            // "If node's data is the empty string, return true."
            if (node.data === "") {
                return true;
            }

            // "If node is not a whitespace node, return false."
            if (!isWhitespaceNode(node)) {
                return false;
            }

            // "Let ancestor be node's parent."
            var ancestor = node.parentNode;

            // "If ancestor is null, return true."
            if (!ancestor) {
                return true;
            }

            // "If the "display" property of some ancestor of node has resolved value "none", return true."
            if (isHidden(node)) {
                return true;
            }

            return false;
        }

        function isCollapsedNode(node) {
            var type = node.nodeType;
            return type == 7 /* PROCESSING_INSTRUCTION */ ||
                type == 8 /* COMMENT */ ||
                isHidden(node) ||
                /^(script|style)$/i.test(node.nodeName) ||
                isVisibilityHiddenTextNode(node) ||
                isCollapsedWhitespaceNode(node);
        }

        function isIgnoredNode(node, win) {
            var type = node.nodeType;
            return type == 7 /* PROCESSING_INSTRUCTION */ ||
                type == 8 /* COMMENT */ ||
                (type == 1 && getComputedDisplay(node, win) == "none");
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        // Possibly overengineered caching system to prevent repeated DOM calls slowing everything down

        function Cache() {
            this.store = {};
        }

        Cache.prototype = {
            get: function(key) {
                return this.store.hasOwnProperty(key) ? this.store[key] : null;
            },

            set: function(key, value) {
                return this.store[key] = value;
            }
        };

        var cachedCount = 0, uncachedCount = 0;

        function createCachingGetter(methodName, func, objProperty) {
            return function(args) {
                var cache = this.cache;
                if (cache.hasOwnProperty(methodName)) {
                    cachedCount++;
                    return cache[methodName];
                } else {
                    uncachedCount++;
                    var value = func.call(this, objProperty ? this[objProperty] : this, args);
                    cache[methodName] = value;
                    return value;
                }
            };
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        function NodeWrapper(node, session) {
            this.node = node;
            this.session = session;
            this.cache = new Cache();
            this.positions = new Cache();
        }

        var nodeProto = {
            getPosition: function(offset) {
                var positions = this.positions;
                return positions.get(offset) || positions.set(offset, new Position(this, offset));
            },

            toString: function() {
                return "[NodeWrapper(" + dom.inspectNode(this.node) + ")]";
            }
        };

        NodeWrapper.prototype = nodeProto;

        var EMPTY = "EMPTY",
            NON_SPACE = "NON_SPACE",
            UNCOLLAPSIBLE_SPACE = "UNCOLLAPSIBLE_SPACE",
            COLLAPSIBLE_SPACE = "COLLAPSIBLE_SPACE",
            TRAILING_SPACE_BEFORE_BLOCK = "TRAILING_SPACE_BEFORE_BLOCK",
            TRAILING_SPACE_IN_BLOCK = "TRAILING_SPACE_IN_BLOCK",
            TRAILING_SPACE_BEFORE_BR = "TRAILING_SPACE_BEFORE_BR",
            PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK = "PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",
            TRAILING_LINE_BREAK_AFTER_BR = "TRAILING_LINE_BREAK_AFTER_BR",
            INCLUDED_TRAILING_LINE_BREAK_AFTER_BR = "INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";

        extend(nodeProto, {
            isCharacterDataNode: createCachingGetter("isCharacterDataNode", dom.isCharacterDataNode, "node"),
            getNodeIndex: createCachingGetter("nodeIndex", dom.getNodeIndex, "node"),
            getLength: createCachingGetter("nodeLength", dom.getNodeLength, "node"),
            containsPositions: createCachingGetter("containsPositions", containsPositions, "node"),
            isWhitespace: createCachingGetter("isWhitespace", isWhitespaceNode, "node"),
            isCollapsedWhitespace: createCachingGetter("isCollapsedWhitespace", isCollapsedWhitespaceNode, "node"),
            getComputedDisplay: createCachingGetter("computedDisplay", getComputedDisplay, "node"),
            isCollapsed: createCachingGetter("collapsed", isCollapsedNode, "node"),
            isIgnored: createCachingGetter("ignored", isIgnoredNode, "node"),
            next: createCachingGetter("nextPos", nextNode, "node"),
            previous: createCachingGetter("previous", previousNode, "node"),

            getTextNodeInfo: createCachingGetter("textNodeInfo", function(textNode) {
                var spaceRegex = null, collapseSpaces = false;
                var cssWhitespace = getComputedStyleProperty(textNode.parentNode, "whiteSpace");
                var preLine = (cssWhitespace == "pre-line");
                if (preLine) {
                    spaceRegex = spacesMinusLineBreaksRegex;
                    collapseSpaces = true;
                } else if (cssWhitespace == "normal" || cssWhitespace == "nowrap") {
                    spaceRegex = spacesRegex;
                    collapseSpaces = true;
                }

                return {
                    node: textNode,
                    text: textNode.data,
                    spaceRegex: spaceRegex,
                    collapseSpaces: collapseSpaces,
                    preLine: preLine
                };
            }, "node"),

            hasInnerText: createCachingGetter("hasInnerText", function(el, backward) {
                var session = this.session;
                var posAfterEl = session.getPosition(el.parentNode, this.getNodeIndex() + 1);
                var firstPosInEl = session.getPosition(el, 0);

                var pos = backward ? posAfterEl : firstPosInEl;
                var endPos = backward ? firstPosInEl : posAfterEl;

                /*
                 <body><p>X  </p><p>Y</p></body>

                 Positions:

                 body:0:""
                 p:0:""
                 text:0:""
                 text:1:"X"
                 text:2:TRAILING_SPACE_IN_BLOCK
                 text:3:COLLAPSED_SPACE
                 p:1:""
                 body:1:"\n"
                 p:0:""
                 text:0:""
                 text:1:"Y"

                 A character is a TRAILING_SPACE_IN_BLOCK iff:

                 - There is no uncollapsed character after it within the visible containing block element

                 A character is a TRAILING_SPACE_BEFORE_BR iff:

                 - There is no uncollapsed character after it preceding a <br> element

                 An element has inner text iff

                 - It is not hidden
                 - It contains an uncollapsed character

                 All trailing spaces (pre-line, before <br>, end of block) require definite non-empty characters to render.
                 */

                while (pos !== endPos) {
                    pos.prepopulateChar();
                    if (pos.isDefinitelyNonEmpty()) {
                        return true;
                    }
                    pos = backward ? pos.previousVisible() : pos.nextVisible();
                }

                return false;
            }, "node"),

            isRenderedBlock: createCachingGetter("isRenderedBlock", function(el) {
                // Ensure that a block element containing a <br> is considered to have inner text
                var brs = el.getElementsByTagName("br");
                for (var i = 0, len = brs.length; i < len; ++i) {
                    if (!isCollapsedNode(brs[i])) {
                        return true;
                    }
                }
                return this.hasInnerText();
            }, "node"),

            getTrailingSpace: createCachingGetter("trailingSpace", function(el) {
                if (el.tagName.toLowerCase() == "br") {
                    return "";
                } else {
                    switch (this.getComputedDisplay()) {
                        case "inline":
                            var child = el.lastChild;
                            while (child) {
                                if (!isIgnoredNode(child)) {
                                    return (child.nodeType == 1) ? this.session.getNodeWrapper(child).getTrailingSpace() : "";
                                }
                                child = child.previousSibling;
                            }
                            break;
                        case "inline-block":
                        case "inline-table":
                        case "none":
                        case "table-column":
                        case "table-column-group":
                            break;
                        case "table-cell":
                            return "\t";
                        default:
                            return this.isRenderedBlock(true) ? "\n" : "";
                    }
                }
                return "";
            }, "node"),

            getLeadingSpace: createCachingGetter("leadingSpace", function(el) {
                switch (this.getComputedDisplay()) {
                    case "inline":
                    case "inline-block":
                    case "inline-table":
                    case "none":
                    case "table-column":
                    case "table-column-group":
                    case "table-cell":
                        break;
                    default:
                        return this.isRenderedBlock(false) ? "\n" : "";
                }
                return "";
            }, "node")
        });

        /*----------------------------------------------------------------------------------------------------------------*/

        function Position(nodeWrapper, offset) {
            this.offset = offset;
            this.nodeWrapper = nodeWrapper;
            this.node = nodeWrapper.node;
            this.session = nodeWrapper.session;
            this.cache = new Cache();
        }

        function inspectPosition() {
            return "[Position(" + dom.inspectNode(this.node) + ":" + this.offset + ")]";
        }

        var positionProto = {
            character: "",
            characterType: EMPTY,
            isBr: false,

            /*
            This method:
            - Fully populates positions that have characters that can be determined independently of any other characters.
            - Populates most types of space positions with a provisional character. The character is finalized later.
             */
            prepopulateChar: function() {
                var pos = this;
                if (!pos.prepopulatedChar) {
                    var node = pos.node, offset = pos.offset;
                    var visibleChar = "", charType = EMPTY;
                    var finalizedChar = false;
                    if (offset > 0) {
                        if (node.nodeType == 3) {
                            var text = node.data;
                            var textChar = text.charAt(offset - 1);

                            var nodeInfo = pos.nodeWrapper.getTextNodeInfo();
                            var spaceRegex = nodeInfo.spaceRegex;
                            if (nodeInfo.collapseSpaces) {
                                if (spaceRegex.test(textChar)) {
                                    // "If the character at position is from set, append a single space (U+0020) to newdata and advance
                                    // position until the character at position is not from set."

                                    // We also need to check for the case where we're in a pre-line and we have a space preceding a
                                    // line break, because such spaces are collapsed in some browsers
                                    if (offset > 1 && spaceRegex.test(text.charAt(offset - 2))) {
                                    } else if (nodeInfo.preLine && text.charAt(offset) === "\n") {
                                        visibleChar = " ";
                                        charType = PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK;
                                    } else {
                                        visibleChar = " ";
                                        //pos.checkForFollowingLineBreak = true;
                                        charType = COLLAPSIBLE_SPACE;
                                    }
                                } else {
                                    visibleChar = textChar;
                                    charType = NON_SPACE;
                                    finalizedChar = true;
                                }
                            } else {
                                visibleChar = textChar;
                                charType = UNCOLLAPSIBLE_SPACE;
                                finalizedChar = true;
                            }
                        } else {
                            var nodePassed = node.childNodes[offset - 1];
                            if (nodePassed && nodePassed.nodeType == 1 && !isCollapsedNode(nodePassed)) {
                                if (nodePassed.tagName.toLowerCase() == "br") {
                                    visibleChar = "\n";
                                    pos.isBr = true;
                                    charType = COLLAPSIBLE_SPACE;
                                    finalizedChar = false;
                                } else {
                                    pos.checkForTrailingSpace = true;
                                }
                            }

                            // Check the leading space of the next node for the case when a block element follows an inline
                            // element or text node. In that case, there is an implied line break between the two nodes.
                            if (!visibleChar) {
                                var nextNode = node.childNodes[offset];
                                if (nextNode && nextNode.nodeType == 1 && !isCollapsedNode(nextNode)) {
                                    pos.checkForLeadingSpace = true;
                                }
                            }
                        }
                    }

                    pos.prepopulatedChar = true;
                    pos.character = visibleChar;
                    pos.characterType = charType;
                    pos.isCharInvariant = finalizedChar;
                }
            },

            isDefinitelyNonEmpty: function() {
                var charType = this.characterType;
                return charType == NON_SPACE || charType == UNCOLLAPSIBLE_SPACE;
            },

            // Resolve leading and trailing spaces, which may involve prepopulating other positions
            resolveLeadingAndTrailingSpaces: function() {
                if (!this.prepopulatedChar) {
                    this.prepopulateChar();
                }
                if (this.checkForTrailingSpace) {
                    var trailingSpace = this.session.getNodeWrapper(this.node.childNodes[this.offset - 1]).getTrailingSpace();
                    if (trailingSpace) {
                        this.isTrailingSpace = true;
                        this.character = trailingSpace;
                        this.characterType = COLLAPSIBLE_SPACE;
                    }
                    this.checkForTrailingSpace = false;
                }
                if (this.checkForLeadingSpace) {
                    var leadingSpace = this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();
                    if (leadingSpace) {
                        this.isLeadingSpace = true;
                        this.character = leadingSpace;
                        this.characterType = COLLAPSIBLE_SPACE;
                    }
                    this.checkForLeadingSpace = false;
                }
            },

            getPrecedingUncollapsedPosition: function(characterOptions) {
                var pos = this, character;
                while ( (pos = pos.previousVisible()) ) {
                    character = pos.getCharacter(characterOptions);
                    if (character !== "") {
                        return pos;
                    }
                }

                return null;
            },

            getCharacter: function(characterOptions) {
                this.resolveLeadingAndTrailingSpaces();

                var thisChar = this.character, returnChar;

                // Check if character is ignored
                var ignoredChars = normalizeIgnoredCharacters(characterOptions.ignoreCharacters);
                var isIgnoredCharacter = (thisChar !== "" && ignoredChars.indexOf(thisChar) > -1);

                // Check if this position's  character is invariant (i.e. not dependent on character options) and return it
                // if so
                if (this.isCharInvariant) {
                    returnChar = isIgnoredCharacter ? "" : thisChar;
                    return returnChar;
                }

                var cacheKey = ["character", characterOptions.includeSpaceBeforeBr, characterOptions.includeBlockContentTrailingSpace, characterOptions.includePreLineTrailingSpace, ignoredChars].join("_");
                var cachedChar = this.cache.get(cacheKey);
                if (cachedChar !== null) {
                    return cachedChar;
                }

                // We need to actually get the character now
                var character = "";
                var collapsible = (this.characterType == COLLAPSIBLE_SPACE);

                var nextPos, previousPos;
                var gotPreviousPos = false;
                var pos = this;

                function getPreviousPos() {
                    if (!gotPreviousPos) {
                        previousPos = pos.getPrecedingUncollapsedPosition(characterOptions);
                        gotPreviousPos = true;
                    }
                    return previousPos;
                }

                // Disallow a collapsible space that is followed by a line break or is the last character
                if (collapsible) {
                    // Allow a trailing space that we've previously determined should be included
                    if (this.type == INCLUDED_TRAILING_LINE_BREAK_AFTER_BR) {
                        character = "\n";
                    }
                    // Disallow a collapsible space that follows a trailing space or line break, or is the first character,
                    // or follows a collapsible included space
                    else if (thisChar == " " &&
                            (!getPreviousPos() || previousPos.isTrailingSpace || previousPos.character == "\n" || (previousPos.character == " " && previousPos.characterType == COLLAPSIBLE_SPACE))) {
                    }
                    // Allow a leading line break unless it follows a line break
                    else if (thisChar == "\n" && this.isLeadingSpace) {
                        if (getPreviousPos() && previousPos.character != "\n") {
                            character = "\n";
                        } else {
                        }
                    } else {
                        nextPos = this.nextUncollapsed();
                        if (nextPos) {
                            if (nextPos.isBr) {
                                this.type = TRAILING_SPACE_BEFORE_BR;
                            } else if (nextPos.isTrailingSpace && nextPos.character == "\n") {
                                this.type = TRAILING_SPACE_IN_BLOCK;
                            } else if (nextPos.isLeadingSpace && nextPos.character == "\n") {
                                this.type = TRAILING_SPACE_BEFORE_BLOCK;
                            }

                            if (nextPos.character == "\n") {
                                if (this.type == TRAILING_SPACE_BEFORE_BR && !characterOptions.includeSpaceBeforeBr) {
                                } else if (this.type == TRAILING_SPACE_BEFORE_BLOCK && !characterOptions.includeSpaceBeforeBlock) {
                                } else if (this.type == TRAILING_SPACE_IN_BLOCK && nextPos.isTrailingSpace && !characterOptions.includeBlockContentTrailingSpace) {
                                } else if (this.type == PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK && nextPos.type == NON_SPACE && !characterOptions.includePreLineTrailingSpace) {
                                } else if (thisChar == "\n") {
                                    if (nextPos.isTrailingSpace) {
                                        if (this.isTrailingSpace) {
                                        } else if (this.isBr) {
                                            nextPos.type = TRAILING_LINE_BREAK_AFTER_BR;

                                            if (getPreviousPos() && previousPos.isLeadingSpace && !previousPos.isTrailingSpace && previousPos.character == "\n") {
                                                nextPos.character = "";
                                            } else {
                                                nextPos.type = INCLUDED_TRAILING_LINE_BREAK_AFTER_BR;
                                            }
                                        }
                                    } else {
                                        character = "\n";
                                    }
                                } else if (thisChar == " ") {
                                    character = " ";
                                } else {
                                }
                            } else {
                                character = thisChar;
                            }
                        } else {
                        }
                    }
                }

                if (ignoredChars.indexOf(character) > -1) {
                    character = "";
                }


                this.cache.set(cacheKey, character);

                return character;
            },

            equals: function(pos) {
                return !!pos && this.node === pos.node && this.offset === pos.offset;
            },

            inspect: inspectPosition,

            toString: function() {
                return this.character;
            }
        };

        Position.prototype = positionProto;

        extend(positionProto, {
            next: createCachingGetter("nextPos", function(pos) {
                var nodeWrapper = pos.nodeWrapper, node = pos.node, offset = pos.offset, session = nodeWrapper.session;
                if (!node) {
                    return null;
                }
                var nextNode, nextOffset, child;
                if (offset == nodeWrapper.getLength()) {
                    // Move onto the next node
                    nextNode = node.parentNode;
                    nextOffset = nextNode ? nodeWrapper.getNodeIndex() + 1 : 0;
                } else {
                    if (nodeWrapper.isCharacterDataNode()) {
                        nextNode = node;
                        nextOffset = offset + 1;
                    } else {
                        child = node.childNodes[offset];
                        // Go into the children next, if children there are
                        if (session.getNodeWrapper(child).containsPositions()) {
                            nextNode = child;
                            nextOffset = 0;
                        } else {
                            nextNode = node;
                            nextOffset = offset + 1;
                        }
                    }
                }

                return nextNode ? session.getPosition(nextNode, nextOffset) : null;
            }),

            previous: createCachingGetter("previous", function(pos) {
                var nodeWrapper = pos.nodeWrapper, node = pos.node, offset = pos.offset, session = nodeWrapper.session;
                var previousNode, previousOffset, child;
                if (offset == 0) {
                    previousNode = node.parentNode;
                    previousOffset = previousNode ? nodeWrapper.getNodeIndex() : 0;
                } else {
                    if (nodeWrapper.isCharacterDataNode()) {
                        previousNode = node;
                        previousOffset = offset - 1;
                    } else {
                        child = node.childNodes[offset - 1];
                        // Go into the children next, if children there are
                        if (session.getNodeWrapper(child).containsPositions()) {
                            previousNode = child;
                            previousOffset = dom.getNodeLength(child);
                        } else {
                            previousNode = node;
                            previousOffset = offset - 1;
                        }
                    }
                }
                return previousNode ? session.getPosition(previousNode, previousOffset) : null;
            }),

            /*
             Next and previous position moving functions that filter out

             - Hidden (CSS visibility/display) elements
             - Script and style elements
             */
            nextVisible: createCachingGetter("nextVisible", function(pos) {
                var next = pos.next();
                if (!next) {
                    return null;
                }
                var nodeWrapper = next.nodeWrapper, node = next.node;
                var newPos = next;
                if (nodeWrapper.isCollapsed()) {
                    // We're skipping this node and all its descendants
                    newPos = nodeWrapper.session.getPosition(node.parentNode, nodeWrapper.getNodeIndex() + 1);
                }
                return newPos;
            }),

            nextUncollapsed: createCachingGetter("nextUncollapsed", function(pos) {
                var nextPos = pos;
                while ( (nextPos = nextPos.nextVisible()) ) {
                    nextPos.resolveLeadingAndTrailingSpaces();
                    if (nextPos.character !== "") {
                        return nextPos;
                    }
                }
                return null;
            }),

            previousVisible: createCachingGetter("previousVisible", function(pos) {
                var previous = pos.previous();
                if (!previous) {
                    return null;
                }
                var nodeWrapper = previous.nodeWrapper, node = previous.node;
                var newPos = previous;
                if (nodeWrapper.isCollapsed()) {
                    // We're skipping this node and all its descendants
                    newPos = nodeWrapper.session.getPosition(node.parentNode, nodeWrapper.getNodeIndex());
                }
                return newPos;
            })
        });

        /*----------------------------------------------------------------------------------------------------------------*/

        var currentSession = null;

        var Session = (function() {
            function createWrapperCache(nodeProperty) {
                var cache = new Cache();

                return {
                    get: function(node) {
                        var wrappersByProperty = cache.get(node[nodeProperty]);
                        if (wrappersByProperty) {
                            for (var i = 0, wrapper; wrapper = wrappersByProperty[i++]; ) {
                                if (wrapper.node === node) {
                                    return wrapper;
                                }
                            }
                        }
                        return null;
                    },

                    set: function(nodeWrapper) {
                        var property = nodeWrapper.node[nodeProperty];
                        var wrappersByProperty = cache.get(property) || cache.set(property, []);
                        wrappersByProperty.push(nodeWrapper);
                    }
                };
            }

            var uniqueIDSupported = util.isHostProperty(document.documentElement, "uniqueID");

            function Session() {
                this.initCaches();
            }

            Session.prototype = {
                initCaches: function() {
                    this.elementCache = uniqueIDSupported ? (function() {
                        var elementsCache = new Cache();

                        return {
                            get: function(el) {
                                return elementsCache.get(el.uniqueID);
                            },

                            set: function(elWrapper) {
                                elementsCache.set(elWrapper.node.uniqueID, elWrapper);
                            }
                        };
                    })() : createWrapperCache("tagName");

                    // Store text nodes keyed by data, although we may need to truncate this
                    this.textNodeCache = createWrapperCache("data");
                    this.otherNodeCache = createWrapperCache("nodeName");
                },

                getNodeWrapper: function(node) {
                    var wrapperCache;
                    switch (node.nodeType) {
                        case 1:
                            wrapperCache = this.elementCache;
                            break;
                        case 3:
                            wrapperCache = this.textNodeCache;
                            break;
                        default:
                            wrapperCache = this.otherNodeCache;
                            break;
                    }

                    var wrapper = wrapperCache.get(node);
                    if (!wrapper) {
                        wrapper = new NodeWrapper(node, this);
                        wrapperCache.set(wrapper);
                    }
                    return wrapper;
                },

                getPosition: function(node, offset) {
                    return this.getNodeWrapper(node).getPosition(offset);
                },

                getRangeBoundaryPosition: function(range, isStart) {
                    var prefix = isStart ? "start" : "end";
                    return this.getPosition(range[prefix + "Container"], range[prefix + "Offset"]);
                },

                detach: function() {
                    this.elementCache = this.textNodeCache = this.otherNodeCache = null;
                }
            };

            return Session;
        })();

        /*----------------------------------------------------------------------------------------------------------------*/

        function startSession() {
            endSession();
            return (currentSession = new Session());
        }

        function getSession() {
            return currentSession || startSession();
        }

        function endSession() {
            if (currentSession) {
                currentSession.detach();
            }
            currentSession = null;
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        // Extensions to the rangy.dom utility object

        extend(dom, {
            nextNode: nextNode,
            previousNode: previousNode
        });

        /*----------------------------------------------------------------------------------------------------------------*/

        function createCharacterIterator(startPos, backward, endPos, characterOptions) {

            // Adjust the end position to ensure that it is actually reached
            if (endPos) {
                if (backward) {
                    if (isCollapsedNode(endPos.node)) {
                        endPos = startPos.previousVisible();
                    }
                } else {
                    if (isCollapsedNode(endPos.node)) {
                        endPos = endPos.nextVisible();
                    }
                }
            }

            var pos = startPos, finished = false;

            function next() {
                var charPos = null;
                if (backward) {
                    charPos = pos;
                    if (!finished) {
                        pos = pos.previousVisible();
                        finished = !pos || (endPos && pos.equals(endPos));
                    }
                } else {
                    if (!finished) {
                        charPos = pos = pos.nextVisible();
                        finished = !pos || (endPos && pos.equals(endPos));
                    }
                }
                if (finished) {
                    pos = null;
                }
                return charPos;
            }

            var previousTextPos, returnPreviousTextPos = false;

            return {
                next: function() {
                    if (returnPreviousTextPos) {
                        returnPreviousTextPos = false;
                        return previousTextPos;
                    } else {
                        var pos, character;
                        while ( (pos = next()) ) {
                            character = pos.getCharacter(characterOptions);
                            if (character) {
                                previousTextPos = pos;
                                return pos;
                            }
                        }
                        return null;
                    }
                },

                rewind: function() {
                    if (previousTextPos) {
                        returnPreviousTextPos = true;
                    } else {
                        throw module.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");
                    }
                },

                dispose: function() {
                    startPos = endPos = null;
                }
            };
        }

        var arrayIndexOf = Array.prototype.indexOf ?
            function(arr, val) {
                return arr.indexOf(val);
            } :
            function(arr, val) {
                for (var i = 0, len = arr.length; i < len; ++i) {
                    if (arr[i] === val) {
                        return i;
                    }
                }
                return -1;
            };

        // Provides a pair of iterators over text positions, tokenized. Transparently requests more text when next()
        // is called and there is no more tokenized text
        function createTokenizedTextProvider(pos, characterOptions, wordOptions) {
            var forwardIterator = createCharacterIterator(pos, false, null, characterOptions);
            var backwardIterator = createCharacterIterator(pos, true, null, characterOptions);
            var tokenizer = wordOptions.tokenizer;

            // Consumes a word and the whitespace beyond it
            function consumeWord(forward) {
                var pos, textChar;
                var newChars = [], it = forward ? forwardIterator : backwardIterator;

                var passedWordBoundary = false, insideWord = false;

                while ( (pos = it.next()) ) {
                    textChar = pos.character;


                    if (allWhiteSpaceRegex.test(textChar)) {
                        if (insideWord) {
                            insideWord = false;
                            passedWordBoundary = true;
                        }
                    } else {
                        if (passedWordBoundary) {
                            it.rewind();
                            break;
                        } else {
                            insideWord = true;
                        }
                    }
                    newChars.push(pos);
                }


                return newChars;
            }

            // Get initial word surrounding initial position and tokenize it
            var forwardChars = consumeWord(true);
            var backwardChars = consumeWord(false).reverse();
            var tokens = tokenize(backwardChars.concat(forwardChars), wordOptions, tokenizer);

            // Create initial token buffers
            var forwardTokensBuffer = forwardChars.length ?
                tokens.slice(arrayIndexOf(tokens, forwardChars[0].token)) : [];

            var backwardTokensBuffer = backwardChars.length ?
                tokens.slice(0, arrayIndexOf(tokens, backwardChars.pop().token) + 1) : [];

            function inspectBuffer(buffer) {
                var textPositions = ["[" + buffer.length + "]"];
                for (var i = 0; i < buffer.length; ++i) {
                    textPositions.push("(word: " + buffer[i] + ", is word: " + buffer[i].isWord + ")");
                }
                return textPositions;
            }


            return {
                nextEndToken: function() {
                    var lastToken, forwardChars;

                    // If we're down to the last token, consume character chunks until we have a word or run out of
                    // characters to consume
                    while ( forwardTokensBuffer.length == 1 &&
                        !(lastToken = forwardTokensBuffer[0]).isWord &&
                        (forwardChars = consumeWord(true)).length > 0) {

                        // Merge trailing non-word into next word and tokenize
                        forwardTokensBuffer = tokenize(lastToken.chars.concat(forwardChars), wordOptions, tokenizer);
                    }

                    return forwardTokensBuffer.shift();
                },

                previousStartToken: function() {
                    var lastToken, backwardChars;

                    // If we're down to the last token, consume character chunks until we have a word or run out of
                    // characters to consume
                    while ( backwardTokensBuffer.length == 1 &&
                        !(lastToken = backwardTokensBuffer[0]).isWord &&
                        (backwardChars = consumeWord(false)).length > 0) {

                        // Merge leading non-word into next word and tokenize
                        backwardTokensBuffer = tokenize(backwardChars.reverse().concat(lastToken.chars), wordOptions, tokenizer);
                    }

                    return backwardTokensBuffer.pop();
                },

                dispose: function() {
                    forwardIterator.dispose();
                    backwardIterator.dispose();
                    forwardTokensBuffer = backwardTokensBuffer = null;
                }
            };
        }

        function movePositionBy(pos, unit, count, characterOptions, wordOptions) {
            var unitsMoved = 0, currentPos, newPos = pos, charIterator, nextPos, absCount = Math.abs(count), token;
            if (count !== 0) {
                var backward = (count < 0);

                switch (unit) {
                    case CHARACTER:
                        charIterator = createCharacterIterator(pos, backward, null, characterOptions);
                        while ( (currentPos = charIterator.next()) && unitsMoved < absCount ) {
                            ++unitsMoved;
                            newPos = currentPos;
                        }
                        nextPos = currentPos;
                        charIterator.dispose();
                        break;
                    case WORD:
                        var tokenizedTextProvider = createTokenizedTextProvider(pos, characterOptions, wordOptions);
                        var next = backward ? tokenizedTextProvider.previousStartToken : tokenizedTextProvider.nextEndToken;

                        while ( (token = next()) && unitsMoved < absCount ) {
                            if (token.isWord) {
                                ++unitsMoved;
                                newPos = backward ? token.chars[0] : token.chars[token.chars.length - 1];
                            }
                        }
                        break;
                    default:
                        throw new Error("movePositionBy: unit '" + unit + "' not implemented");
                }

                // Perform any necessary position tweaks
                if (backward) {
                    newPos = newPos.previousVisible();
                    unitsMoved = -unitsMoved;
                } else if (newPos && newPos.isLeadingSpace && !newPos.isTrailingSpace) {
                    // Tweak the position for the case of a leading space. The problem is that an uncollapsed leading space
                    // before a block element (for example, the line break between "1" and "2" in the following HTML:
                    // "1<p>2</p>") is considered to be attached to the position immediately before the block element, which
                    // corresponds with a different selection position in most browsers from the one we want (i.e. at the
                    // start of the contents of the block element). We get round this by advancing the position returned to
                    // the last possible equivalent visible position.
                    if (unit == WORD) {
                        charIterator = createCharacterIterator(pos, false, null, characterOptions);
                        nextPos = charIterator.next();
                        charIterator.dispose();
                    }
                    if (nextPos) {
                        newPos = nextPos.previousVisible();
                    }
                }
            }


            return {
                position: newPos,
                unitsMoved: unitsMoved
            };
        }

        function createRangeCharacterIterator(session, range, characterOptions, backward) {
            var rangeStart = session.getRangeBoundaryPosition(range, true);
            var rangeEnd = session.getRangeBoundaryPosition(range, false);
            var itStart = backward ? rangeEnd : rangeStart;
            var itEnd = backward ? rangeStart : rangeEnd;

            return createCharacterIterator(itStart, !!backward, itEnd, characterOptions);
        }

        function getRangeCharacters(session, range, characterOptions) {

            var chars = [], it = createRangeCharacterIterator(session, range, characterOptions), pos;
            while ( (pos = it.next()) ) {
                chars.push(pos);
            }

            it.dispose();
            return chars;
        }

        function isWholeWord(startPos, endPos, wordOptions) {
            var range = api.createRange(startPos.node);
            range.setStartAndEnd(startPos.node, startPos.offset, endPos.node, endPos.offset);
            return !range.expand("word", { wordOptions: wordOptions });
        }

        function findTextFromPosition(initialPos, searchTerm, isRegex, searchScopeRange, findOptions) {
            var backward = isDirectionBackward(findOptions.direction);
            var it = createCharacterIterator(
                initialPos,
                backward,
                initialPos.session.getRangeBoundaryPosition(searchScopeRange, backward),
                findOptions.characterOptions
            );
            var text = "", chars = [], pos, currentChar, matchStartIndex, matchEndIndex;
            var result, insideRegexMatch;
            var returnValue = null;

            function handleMatch(startIndex, endIndex) {
                var startPos = chars[startIndex].previousVisible();
                var endPos = chars[endIndex - 1];
                var valid = (!findOptions.wholeWordsOnly || isWholeWord(startPos, endPos, findOptions.wordOptions));

                return {
                    startPos: startPos,
                    endPos: endPos,
                    valid: valid
                };
            }

            while ( (pos = it.next()) ) {
                currentChar = pos.character;
                if (!isRegex && !findOptions.caseSensitive) {
                    currentChar = currentChar.toLowerCase();
                }

                if (backward) {
                    chars.unshift(pos);
                    text = currentChar + text;
                } else {
                    chars.push(pos);
                    text += currentChar;
                }

                if (isRegex) {
                    result = searchTerm.exec(text);
                    if (result) {
                        matchStartIndex = result.index;
                        matchEndIndex = matchStartIndex + result[0].length;
                        if (insideRegexMatch) {
                            // Check whether the match is now over
                            if ((!backward && matchEndIndex < text.length) || (backward && matchStartIndex > 0)) {
                                returnValue = handleMatch(matchStartIndex, matchEndIndex);
                                break;
                            }
                        } else {
                            insideRegexMatch = true;
                        }
                    }
                } else if ( (matchStartIndex = text.indexOf(searchTerm)) != -1 ) {
                    returnValue = handleMatch(matchStartIndex, matchStartIndex + searchTerm.length);
                    break;
                }
            }

            // Check whether regex match extends to the end of the range
            if (insideRegexMatch) {
                returnValue = handleMatch(matchStartIndex, matchEndIndex);
            }
            it.dispose();

            return returnValue;
        }

        function createEntryPointFunction(func) {
            return function() {
                var sessionRunning = !!currentSession;
                var session = getSession();
                var args = [session].concat( util.toArray(arguments) );
                var returnValue = func.apply(this, args);
                if (!sessionRunning) {
                    endSession();
                }
                return returnValue;
            };
        }

        /*----------------------------------------------------------------------------------------------------------------*/

        // Extensions to the Rangy Range object

        function createRangeBoundaryMover(isStart, collapse) {
            /*
             Unit can be "character" or "word"
             Options:

             - includeTrailingSpace
             - wordRegex
             - tokenizer
             - collapseSpaceBeforeLineBreak
             */
            return createEntryPointFunction(
                function(session, unit, count, moveOptions) {
                    if (typeof count == UNDEF) {
                        count = unit;
                        unit = CHARACTER;
                    }
                    moveOptions = createNestedOptions(moveOptions, defaultMoveOptions);

                    var boundaryIsStart = isStart;
                    if (collapse) {
                        boundaryIsStart = (count >= 0);
                        this.collapse(!boundaryIsStart);
                    }
                    var moveResult = movePositionBy(session.getRangeBoundaryPosition(this, boundaryIsStart), unit, count, moveOptions.characterOptions, moveOptions.wordOptions);
                    var newPos = moveResult.position;
                    this[boundaryIsStart ? "setStart" : "setEnd"](newPos.node, newPos.offset);
                    return moveResult.unitsMoved;
                }
            );
        }

        function createRangeTrimmer(isStart) {
            return createEntryPointFunction(
                function(session, characterOptions) {
                    characterOptions = createOptions(characterOptions, defaultCharacterOptions);
                    var pos;
                    var it = createRangeCharacterIterator(session, this, characterOptions, !isStart);
                    var trimCharCount = 0;
                    while ( (pos = it.next()) && allWhiteSpaceRegex.test(pos.character) ) {
                        ++trimCharCount;
                    }
                    it.dispose();
                    var trimmed = (trimCharCount > 0);
                    if (trimmed) {
                        this[isStart ? "moveStart" : "moveEnd"](
                            "character",
                            isStart ? trimCharCount : -trimCharCount,
                            { characterOptions: characterOptions }
                        );
                    }
                    return trimmed;
                }
            );
        }

        extend(api.rangePrototype, {
            moveStart: createRangeBoundaryMover(true, false),

            moveEnd: createRangeBoundaryMover(false, false),

            move: createRangeBoundaryMover(true, true),

            trimStart: createRangeTrimmer(true),

            trimEnd: createRangeTrimmer(false),

            trim: createEntryPointFunction(
                function(session, characterOptions) {
                    var startTrimmed = this.trimStart(characterOptions), endTrimmed = this.trimEnd(characterOptions);
                    return startTrimmed || endTrimmed;
                }
            ),

            expand: createEntryPointFunction(
                function(session, unit, expandOptions) {
                    var moved = false;
                    expandOptions = createNestedOptions(expandOptions, defaultExpandOptions);
                    var characterOptions = expandOptions.characterOptions;
                    if (!unit) {
                        unit = CHARACTER;
                    }
                    if (unit == WORD) {
                        var wordOptions = expandOptions.wordOptions;
                        var startPos = session.getRangeBoundaryPosition(this, true);
                        var endPos = session.getRangeBoundaryPosition(this, false);

                        var startTokenizedTextProvider = createTokenizedTextProvider(startPos, characterOptions, wordOptions);
                        var startToken = startTokenizedTextProvider.nextEndToken();
                        var newStartPos = startToken.chars[0].previousVisible();
                        var endToken, newEndPos;

                        if (this.collapsed) {
                            endToken = startToken;
                        } else {
                            var endTokenizedTextProvider = createTokenizedTextProvider(endPos, characterOptions, wordOptions);
                            endToken = endTokenizedTextProvider.previousStartToken();
                        }
                        newEndPos = endToken.chars[endToken.chars.length - 1];

                        if (!newStartPos.equals(startPos)) {
                            this.setStart(newStartPos.node, newStartPos.offset);
                            moved = true;
                        }
                        if (newEndPos && !newEndPos.equals(endPos)) {
                            this.setEnd(newEndPos.node, newEndPos.offset);
                            moved = true;
                        }

                        if (expandOptions.trim) {
                            if (expandOptions.trimStart) {
                                moved = this.trimStart(characterOptions) || moved;
                            }
                            if (expandOptions.trimEnd) {
                                moved = this.trimEnd(characterOptions) || moved;
                            }
                        }

                        return moved;
                    } else {
                        return this.moveEnd(CHARACTER, 1, expandOptions);
                    }
                }
            ),

            text: createEntryPointFunction(
                function(session, characterOptions) {
                    return this.collapsed ?
                        "" : getRangeCharacters(session, this, createOptions(characterOptions, defaultCharacterOptions)).join("");
                }
            ),

            selectCharacters: createEntryPointFunction(
                function(session, containerNode, startIndex, endIndex, characterOptions) {
                    var moveOptions = { characterOptions: characterOptions };
                    if (!containerNode) {
                        containerNode = getBody( this.getDocument() );
                    }
                    this.selectNodeContents(containerNode);
                    this.collapse(true);
                    this.moveStart("character", startIndex, moveOptions);
                    this.collapse(true);
                    this.moveEnd("character", endIndex - startIndex, moveOptions);
                }
            ),

            // Character indexes are relative to the start of node
            toCharacterRange: createEntryPointFunction(
                function(session, containerNode, characterOptions) {
                    if (!containerNode) {
                        containerNode = getBody( this.getDocument() );
                    }
                    var parent = containerNode.parentNode, nodeIndex = dom.getNodeIndex(containerNode);
                    var rangeStartsBeforeNode = (dom.comparePoints(this.startContainer, this.endContainer, parent, nodeIndex) == -1);
                    var rangeBetween = this.cloneRange();
                    var startIndex, endIndex;
                    if (rangeStartsBeforeNode) {
                        rangeBetween.setStartAndEnd(this.startContainer, this.startOffset, parent, nodeIndex);
                        startIndex = -rangeBetween.text(characterOptions).length;
                    } else {
                        rangeBetween.setStartAndEnd(parent, nodeIndex, this.startContainer, this.startOffset);
                        startIndex = rangeBetween.text(characterOptions).length;
                    }
                    endIndex = startIndex + this.text(characterOptions).length;

                    return {
                        start: startIndex,
                        end: endIndex
                    };
                }
            ),

            findText: createEntryPointFunction(
                function(session, searchTermParam, findOptions) {
                    // Set up options
                    findOptions = createNestedOptions(findOptions, defaultFindOptions);

                    // Create word options if we're matching whole words only
                    if (findOptions.wholeWordsOnly) {
                        // We don't ever want trailing spaces for search results
                        findOptions.wordOptions.includeTrailingSpace = false;
                    }

                    var backward = isDirectionBackward(findOptions.direction);

                    // Create a range representing the search scope if none was provided
                    var searchScopeRange = findOptions.withinRange;
                    if (!searchScopeRange) {
                        searchScopeRange = api.createRange();
                        searchScopeRange.selectNodeContents(this.getDocument());
                    }

                    // Examine and prepare the search term
                    var searchTerm = searchTermParam, isRegex = false;
                    if (typeof searchTerm == "string") {
                        if (!findOptions.caseSensitive) {
                            searchTerm = searchTerm.toLowerCase();
                        }
                    } else {
                        isRegex = true;
                    }

                    var initialPos = session.getRangeBoundaryPosition(this, !backward);

                    // Adjust initial position if it lies outside the search scope
                    var comparison = searchScopeRange.comparePoint(initialPos.node, initialPos.offset);

                    if (comparison === -1) {
                        initialPos = session.getRangeBoundaryPosition(searchScopeRange, true);
                    } else if (comparison === 1) {
                        initialPos = session.getRangeBoundaryPosition(searchScopeRange, false);
                    }

                    var pos = initialPos;
                    var wrappedAround = false;

                    // Try to find a match and ignore invalid ones
                    var findResult;
                    while (true) {
                        findResult = findTextFromPosition(pos, searchTerm, isRegex, searchScopeRange, findOptions);

                        if (findResult) {
                            if (findResult.valid) {
                                this.setStartAndEnd(findResult.startPos.node, findResult.startPos.offset, findResult.endPos.node, findResult.endPos.offset);
                                return true;
                            } else {
                                // We've found a match that is not a whole word, so we carry on searching from the point immediately
                                // after the match
                                pos = backward ? findResult.startPos : findResult.endPos;
                            }
                        } else if (findOptions.wrap && !wrappedAround) {
                            // No result found but we're wrapping around and limiting the scope to the unsearched part of the range
                            searchScopeRange = searchScopeRange.cloneRange();
                            pos = session.getRangeBoundaryPosition(searchScopeRange, !backward);
                            searchScopeRange.setBoundary(initialPos.node, initialPos.offset, backward);
                            wrappedAround = true;
                        } else {
                            // Nothing found and we can't wrap around, so we're done
                            return false;
                        }
                    }
                }
            ),

            pasteHtml: function(html) {
                this.deleteContents();
                if (html) {
                    var frag = this.createContextualFragment(html);
                    var lastChild = frag.lastChild;
                    this.insertNode(frag);
                    this.collapseAfter(lastChild);
                }
            }
        });

        /*----------------------------------------------------------------------------------------------------------------*/

        // Extensions to the Rangy Selection object

        function createSelectionTrimmer(methodName) {
            return createEntryPointFunction(
                function(session, characterOptions) {
                    var trimmed = false;
                    this.changeEachRange(function(range) {
                        trimmed = range[methodName](characterOptions) || trimmed;
                    });
                    return trimmed;
                }
            );
        }

        extend(api.selectionPrototype, {
            expand: createEntryPointFunction(
                function(session, unit, expandOptions) {
                    this.changeEachRange(function(range) {
                        range.expand(unit, expandOptions);
                    });
                }
            ),

            move: createEntryPointFunction(
                function(session, unit, count, options) {
                    var unitsMoved = 0;
                    if (this.focusNode) {
                        this.collapse(this.focusNode, this.focusOffset);
                        var range = this.getRangeAt(0);
                        if (!options) {
                            options = {};
                        }
                        options.characterOptions = createOptions(options.characterOptions, defaultCaretCharacterOptions);
                        unitsMoved = range.move(unit, count, options);
                        this.setSingleRange(range);
                    }
                    return unitsMoved;
                }
            ),

            trimStart: createSelectionTrimmer("trimStart"),
            trimEnd: createSelectionTrimmer("trimEnd"),
            trim: createSelectionTrimmer("trim"),

            selectCharacters: createEntryPointFunction(
                function(session, containerNode, startIndex, endIndex, direction, characterOptions) {
                    var range = api.createRange(containerNode);
                    range.selectCharacters(containerNode, startIndex, endIndex, characterOptions);
                    this.setSingleRange(range, direction);
                }
            ),

            saveCharacterRanges: createEntryPointFunction(
                function(session, containerNode, characterOptions) {
                    var ranges = this.getAllRanges(), rangeCount = ranges.length;
                    var rangeInfos = [];

                    var backward = rangeCount == 1 && this.isBackward();

                    for (var i = 0, len = ranges.length; i < len; ++i) {
                        rangeInfos[i] = {
                            characterRange: ranges[i].toCharacterRange(containerNode, characterOptions),
                            backward: backward,
                            characterOptions: characterOptions
                        };
                    }

                    return rangeInfos;
                }
            ),

            restoreCharacterRanges: createEntryPointFunction(
                function(session, containerNode, saved) {
                    this.removeAllRanges();
                    for (var i = 0, len = saved.length, range, rangeInfo, characterRange; i < len; ++i) {
                        rangeInfo = saved[i];
                        characterRange = rangeInfo.characterRange;
                        range = api.createRange(containerNode);
                        range.selectCharacters(containerNode, characterRange.start, characterRange.end, rangeInfo.characterOptions);
                        this.addRange(range, rangeInfo.backward);
                    }
                }
            ),

            text: createEntryPointFunction(
                function(session, characterOptions) {
                    var rangeTexts = [];
                    for (var i = 0, len = this.rangeCount; i < len; ++i) {
                        rangeTexts[i] = this.getRangeAt(i).text(characterOptions);
                    }
                    return rangeTexts.join("");
                }
            )
        });

        /*----------------------------------------------------------------------------------------------------------------*/

        // Extensions to the core rangy object

        api.innerText = function(el, characterOptions) {
            var range = api.createRange(el);
            range.selectNodeContents(el);
            var text = range.text(characterOptions);
            return text;
        };

        api.createWordIterator = function(startNode, startOffset, iteratorOptions) {
            var session = getSession();
            iteratorOptions = createNestedOptions(iteratorOptions, defaultWordIteratorOptions);
            var startPos = session.getPosition(startNode, startOffset);
            var tokenizedTextProvider = createTokenizedTextProvider(startPos, iteratorOptions.characterOptions, iteratorOptions.wordOptions);
            var backward = isDirectionBackward(iteratorOptions.direction);

            return {
                next: function() {
                    return backward ? tokenizedTextProvider.previousStartToken() : tokenizedTextProvider.nextEndToken();
                },

                dispose: function() {
                    tokenizedTextProvider.dispose();
                    this.next = function() {};
                }
            };
        };

        /*----------------------------------------------------------------------------------------------------------------*/

        api.noMutation = function(func) {
            var session = getSession();
            func(session);
            endSession();
        };

        api.noMutation.createEntryPointFunction = createEntryPointFunction;

        api.textRange = {
            isBlockNode: isBlockNode,
            isCollapsedWhitespaceNode: isCollapsedWhitespaceNode,

            createPosition: createEntryPointFunction(
                function(session, node, offset) {
                    return session.getPosition(node, offset);
                }
            )
        };
    });
    
    return rangy;
}, this);
/*! Hammer.JS - v2.0.4 - 2014-09-28
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2014 Jorik Tangelder;
 * Licensed under the MIT license */
(function(window, document, exportName, undefined) {
  'use strict';

var VENDOR_PREFIXES = ['', 'webkit', 'moz', 'MS', 'ms', 'o'];
var TEST_ELEMENT = document.createElement('div');

var TYPE_FUNCTION = 'function';

var round = Math.round;
var abs = Math.abs;
var now = Date.now;

/**
 * set a timeout with a given scope
 * @param {Function} fn
 * @param {Number} timeout
 * @param {Object} context
 * @returns {number}
 */
function setTimeoutContext(fn, timeout, context) {
    return setTimeout(bindFn(fn, context), timeout);
}

/**
 * if the argument is an array, we want to execute the fn on each entry
 * if it aint an array we don't want to do a thing.
 * this is used by all the methods that accept a single and array argument.
 * @param {*|Array} arg
 * @param {String} fn
 * @param {Object} [context]
 * @returns {Boolean}
 */
function invokeArrayArg(arg, fn, context) {
    if (Array.isArray(arg)) {
        each(arg, context[fn], context);
        return true;
    }
    return false;
}

/**
 * walk objects and arrays
 * @param {Object} obj
 * @param {Function} iterator
 * @param {Object} context
 */
function each(obj, iterator, context) {
    var i;

    if (!obj) {
        return;
    }

    if (obj.forEach) {
        obj.forEach(iterator, context);
    } else if (obj.length !== undefined) {
        i = 0;
        while (i < obj.length) {
            iterator.call(context, obj[i], i, obj);
            i++;
        }
    } else {
        for (i in obj) {
            obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);
        }
    }
}

/**
 * extend object.
 * means that properties in dest will be overwritten by the ones in src.
 * @param {Object} dest
 * @param {Object} src
 * @param {Boolean} [merge]
 * @returns {Object} dest
 */
function extend(dest, src, merge) {
    var keys = Object.keys(src);
    var i = 0;
    while (i < keys.length) {
        if (!merge || (merge && dest[keys[i]] === undefined)) {
            dest[keys[i]] = src[keys[i]];
        }
        i++;
    }
    return dest;
}

/**
 * merge the values from src in the dest.
 * means that properties that exist in dest will not be overwritten by src
 * @param {Object} dest
 * @param {Object} src
 * @returns {Object} dest
 */
function merge(dest, src) {
    return extend(dest, src, true);
}

/**
 * simple class inheritance
 * @param {Function} child
 * @param {Function} base
 * @param {Object} [properties]
 */
function inherit(child, base, properties) {
    var baseP = base.prototype,
        childP;

    childP = child.prototype = Object.create(baseP);
    childP.constructor = child;
    childP._super = baseP;

    if (properties) {
        extend(childP, properties);
    }
}

/**
 * simple function bind
 * @param {Function} fn
 * @param {Object} context
 * @returns {Function}
 */
function bindFn(fn, context) {
    return function boundFn() {
        return fn.apply(context, arguments);
    };
}

/**
 * let a boolean value also be a function that must return a boolean
 * this first item in args will be used as the context
 * @param {Boolean|Function} val
 * @param {Array} [args]
 * @returns {Boolean}
 */
function boolOrFn(val, args) {
    if (typeof val == TYPE_FUNCTION) {
        return val.apply(args ? args[0] || undefined : undefined, args);
    }
    return val;
}

/**
 * use the val2 when val1 is undefined
 * @param {*} val1
 * @param {*} val2
 * @returns {*}
 */
function ifUndefined(val1, val2) {
    return (val1 === undefined) ? val2 : val1;
}

/**
 * addEventListener with multiple events at once
 * @param {EventTarget} target
 * @param {String} types
 * @param {Function} handler
 */
function addEventListeners(target, types, handler) {
    each(splitStr(types), function(type) {
        target.addEventListener(type, handler, false);
    });
}

/**
 * removeEventListener with multiple events at once
 * @param {EventTarget} target
 * @param {String} types
 * @param {Function} handler
 */
function removeEventListeners(target, types, handler) {
    each(splitStr(types), function(type) {
        target.removeEventListener(type, handler, false);
    });
}

/**
 * find if a node is in the given parent
 * @method hasParent
 * @param {HTMLElement} node
 * @param {HTMLElement} parent
 * @return {Boolean} found
 */
function hasParent(node, parent) {
    while (node) {
        if (node == parent) {
            return true;
        }
        node = node.parentNode;
    }
    return false;
}

/**
 * small indexOf wrapper
 * @param {String} str
 * @param {String} find
 * @returns {Boolean} found
 */
function inStr(str, find) {
    return str.indexOf(find) > -1;
}

/**
 * split string on whitespace
 * @param {String} str
 * @returns {Array} words
 */
function splitStr(str) {
    return str.trim().split(/\s+/g);
}

/**
 * find if a array contains the object using indexOf or a simple polyFill
 * @param {Array} src
 * @param {String} find
 * @param {String} [findByKey]
 * @return {Boolean|Number} false when not found, or the index
 */
function inArray(src, find, findByKey) {
    if (src.indexOf && !findByKey) {
        return src.indexOf(find);
    } else {
        var i = 0;
        while (i < src.length) {
            if ((findByKey && src[i][findByKey] == find) || (!findByKey && src[i] === find)) {
                return i;
            }
            i++;
        }
        return -1;
    }
}

/**
 * convert array-like objects to real arrays
 * @param {Object} obj
 * @returns {Array}
 */
function toArray(obj) {
    return Array.prototype.slice.call(obj, 0);
}

/**
 * unique array with objects based on a key (like 'id') or just by the array's value
 * @param {Array} src [{id:1},{id:2},{id:1}]
 * @param {String} [key]
 * @param {Boolean} [sort=False]
 * @returns {Array} [{id:1},{id:2}]
 */
function uniqueArray(src, key, sort) {
    var results = [];
    var values = [];
    var i = 0;

    while (i < src.length) {
        var val = key ? src[i][key] : src[i];
        if (inArray(values, val) < 0) {
            results.push(src[i]);
        }
        values[i] = val;
        i++;
    }

    if (sort) {
        if (!key) {
            results = results.sort();
        } else {
            results = results.sort(function sortUniqueArray(a, b) {
                return a[key] > b[key];
            });
        }
    }

    return results;
}

/**
 * get the prefixed property
 * @param {Object} obj
 * @param {String} property
 * @returns {String|Undefined} prefixed
 */
function prefixed(obj, property) {
    var prefix, prop;
    var camelProp = property[0].toUpperCase() + property.slice(1);

    var i = 0;
    while (i < VENDOR_PREFIXES.length) {
        prefix = VENDOR_PREFIXES[i];
        prop = (prefix) ? prefix + camelProp : property;

        if (prop in obj) {
            return prop;
        }
        i++;
    }
    return undefined;
}

/**
 * get a unique id
 * @returns {number} uniqueId
 */
var _uniqueId = 1;
function uniqueId() {
    return _uniqueId++;
}

/**
 * get the window object of an element
 * @param {HTMLElement} element
 * @returns {DocumentView|Window}
 */
function getWindowForElement(element) {
    var doc = element.ownerDocument;
    return (doc.defaultView || doc.parentWindow);
}

var MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;

var SUPPORT_TOUCH = ('ontouchstart' in window);
var SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;
var SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);

var INPUT_TYPE_TOUCH = 'touch';
var INPUT_TYPE_PEN = 'pen';
var INPUT_TYPE_MOUSE = 'mouse';
var INPUT_TYPE_KINECT = 'kinect';

var COMPUTE_INTERVAL = 25;

var INPUT_START = 1;
var INPUT_MOVE = 2;
var INPUT_END = 4;
var INPUT_CANCEL = 8;

var DIRECTION_NONE = 1;
var DIRECTION_LEFT = 2;
var DIRECTION_RIGHT = 4;
var DIRECTION_UP = 8;
var DIRECTION_DOWN = 16;

var DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;
var DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;
var DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;

var PROPS_XY = ['x', 'y'];
var PROPS_CLIENT_XY = ['clientX', 'clientY'];

/**
 * create new input type manager
 * @param {Manager} manager
 * @param {Function} callback
 * @returns {Input}
 * @constructor
 */
function Input(manager, callback) {
    var self = this;
    this.manager = manager;
    this.callback = callback;
    this.element = manager.element;
    this.target = manager.options.inputTarget;

    // smaller wrapper around the handler, for the scope and the enabled state of the manager,
    // so when disabled the input events are completely bypassed.
    this.domHandler = function(ev) {
        if (boolOrFn(manager.options.enable, [manager])) {
            self.handler(ev);
        }
    };

    this.init();

}

Input.prototype = {
    /**
     * should handle the inputEvent data and trigger the callback
     * @virtual
     */
    handler: function() { },

    /**
     * bind the events
     */
    init: function() {
        this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);
        this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);
        this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);
    },

    /**
     * unbind the events
     */
    destroy: function() {
        this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);
        this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);
        this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);
    }
};

/**
 * create new input type manager
 * called by the Manager constructor
 * @param {Hammer} manager
 * @returns {Input}
 */
function createInputInstance(manager) {
    var Type;
    var inputClass = manager.options.inputClass;

    if (inputClass) {
        Type = inputClass;
    } else if (SUPPORT_POINTER_EVENTS) {
        Type = PointerEventInput;
    } else if (SUPPORT_ONLY_TOUCH) {
        Type = TouchInput;
    } else if (!SUPPORT_TOUCH) {
        Type = MouseInput;
    } else {
        Type = TouchMouseInput;
    }
    return new (Type)(manager, inputHandler);
}

/**
 * handle input events
 * @param {Manager} manager
 * @param {String} eventType
 * @param {Object} input
 */
function inputHandler(manager, eventType, input) {
    var pointersLen = input.pointers.length;
    var changedPointersLen = input.changedPointers.length;
    var isFirst = (eventType & INPUT_START && (pointersLen - changedPointersLen === 0));
    var isFinal = (eventType & (INPUT_END | INPUT_CANCEL) && (pointersLen - changedPointersLen === 0));

    input.isFirst = !!isFirst;
    input.isFinal = !!isFinal;

    if (isFirst) {
        manager.session = {};
    }

    // source event is the normalized value of the domEvents
    // like 'touchstart, mouseup, pointerdown'
    input.eventType = eventType;

    // compute scale, rotation etc
    computeInputData(manager, input);

    // emit secret event
    manager.emit('hammer.input', input);

    manager.recognize(input);
    manager.session.prevInput = input;
}

/**
 * extend the data with some usable properties like scale, rotate, velocity etc
 * @param {Object} manager
 * @param {Object} input
 */
function computeInputData(manager, input) {
    var session = manager.session;
    var pointers = input.pointers;
    var pointersLength = pointers.length;

    // store the first input to calculate the distance and direction
    if (!session.firstInput) {
        session.firstInput = simpleCloneInputData(input);
    }

    // to compute scale and rotation we need to store the multiple touches
    if (pointersLength > 1 && !session.firstMultiple) {
        session.firstMultiple = simpleCloneInputData(input);
    } else if (pointersLength === 1) {
        session.firstMultiple = false;
    }

    var firstInput = session.firstInput;
    var firstMultiple = session.firstMultiple;
    var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;

    var center = input.center = getCenter(pointers);
    input.timeStamp = now();
    input.deltaTime = input.timeStamp - firstInput.timeStamp;

    input.angle = getAngle(offsetCenter, center);
    input.distance = getDistance(offsetCenter, center);

    computeDeltaXY(session, input);
    input.offsetDirection = getDirection(input.deltaX, input.deltaY);

    input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;
    input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;

    computeIntervalInputData(session, input);

    // find the correct target
    var target = manager.element;
    if (hasParent(input.srcEvent.target, target)) {
        target = input.srcEvent.target;
    }
    input.target = target;
}

function computeDeltaXY(session, input) {
    var center = input.center;
    var offset = session.offsetDelta || {};
    var prevDelta = session.prevDelta || {};
    var prevInput = session.prevInput || {};

    if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {
        prevDelta = session.prevDelta = {
            x: prevInput.deltaX || 0,
            y: prevInput.deltaY || 0
        };

        offset = session.offsetDelta = {
            x: center.x,
            y: center.y
        };
    }

    input.deltaX = prevDelta.x + (center.x - offset.x);
    input.deltaY = prevDelta.y + (center.y - offset.y);
}

/**
 * velocity is calculated every x ms
 * @param {Object} session
 * @param {Object} input
 */
function computeIntervalInputData(session, input) {
    var last = session.lastInterval || input,
        deltaTime = input.timeStamp - last.timeStamp,
        velocity, velocityX, velocityY, direction;

    if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {
        var deltaX = last.deltaX - input.deltaX;
        var deltaY = last.deltaY - input.deltaY;

        var v = getVelocity(deltaTime, deltaX, deltaY);
        velocityX = v.x;
        velocityY = v.y;
        velocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;
        direction = getDirection(deltaX, deltaY);

        session.lastInterval = input;
    } else {
        // use latest velocity info if it doesn't overtake a minimum period
        velocity = last.velocity;
        velocityX = last.velocityX;
        velocityY = last.velocityY;
        direction = last.direction;
    }

    input.velocity = velocity;
    input.velocityX = velocityX;
    input.velocityY = velocityY;
    input.direction = direction;
}

/**
 * create a simple clone from the input used for storage of firstInput and firstMultiple
 * @param {Object} input
 * @returns {Object} clonedInputData
 */
function simpleCloneInputData(input) {
    // make a simple copy of the pointers because we will get a reference if we don't
    // we only need clientXY for the calculations
    var pointers = [];
    var i = 0;
    while (i < input.pointers.length) {
        pointers[i] = {
            clientX: round(input.pointers[i].clientX),
            clientY: round(input.pointers[i].clientY)
        };
        i++;
    }

    return {
        timeStamp: now(),
        pointers: pointers,
        center: getCenter(pointers),
        deltaX: input.deltaX,
        deltaY: input.deltaY
    };
}

/**
 * get the center of all the pointers
 * @param {Array} pointers
 * @return {Object} center contains `x` and `y` properties
 */
function getCenter(pointers) {
    var pointersLength = pointers.length;

    // no need to loop when only one touch
    if (pointersLength === 1) {
        return {
            x: round(pointers[0].clientX),
            y: round(pointers[0].clientY)
        };
    }

    var x = 0, y = 0, i = 0;
    while (i < pointersLength) {
        x += pointers[i].clientX;
        y += pointers[i].clientY;
        i++;
    }

    return {
        x: round(x / pointersLength),
        y: round(y / pointersLength)
    };
}

/**
 * calculate the velocity between two points. unit is in px per ms.
 * @param {Number} deltaTime
 * @param {Number} x
 * @param {Number} y
 * @return {Object} velocity `x` and `y`
 */
function getVelocity(deltaTime, x, y) {
    return {
        x: x / deltaTime || 0,
        y: y / deltaTime || 0
    };
}

/**
 * get the direction between two points
 * @param {Number} x
 * @param {Number} y
 * @return {Number} direction
 */
function getDirection(x, y) {
    if (x === y) {
        return DIRECTION_NONE;
    }

    if (abs(x) >= abs(y)) {
        return x > 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;
    }
    return y > 0 ? DIRECTION_UP : DIRECTION_DOWN;
}

/**
 * calculate the absolute distance between two points
 * @param {Object} p1 {x, y}
 * @param {Object} p2 {x, y}
 * @param {Array} [props] containing x and y keys
 * @return {Number} distance
 */
function getDistance(p1, p2, props) {
    if (!props) {
        props = PROPS_XY;
    }
    var x = p2[props[0]] - p1[props[0]],
        y = p2[props[1]] - p1[props[1]];

    return Math.sqrt((x * x) + (y * y));
}

/**
 * calculate the angle between two coordinates
 * @param {Object} p1
 * @param {Object} p2
 * @param {Array} [props] containing x and y keys
 * @return {Number} angle
 */
function getAngle(p1, p2, props) {
    if (!props) {
        props = PROPS_XY;
    }
    var x = p2[props[0]] - p1[props[0]],
        y = p2[props[1]] - p1[props[1]];
    return Math.atan2(y, x) * 180 / Math.PI;
}

/**
 * calculate the rotation degrees between two pointersets
 * @param {Array} start array of pointers
 * @param {Array} end array of pointers
 * @return {Number} rotation
 */
function getRotation(start, end) {
    return getAngle(end[1], end[0], PROPS_CLIENT_XY) - getAngle(start[1], start[0], PROPS_CLIENT_XY);
}

/**
 * calculate the scale factor between two pointersets
 * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out
 * @param {Array} start array of pointers
 * @param {Array} end array of pointers
 * @return {Number} scale
 */
function getScale(start, end) {
    return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);
}

var MOUSE_INPUT_MAP = {
    mousedown: INPUT_START,
    mousemove: INPUT_MOVE,
    mouseup: INPUT_END
};

var MOUSE_ELEMENT_EVENTS = 'mousedown';
var MOUSE_WINDOW_EVENTS = 'mousemove mouseup';

/**
 * Mouse events input
 * @constructor
 * @extends Input
 */
function MouseInput() {
    this.evEl = MOUSE_ELEMENT_EVENTS;
    this.evWin = MOUSE_WINDOW_EVENTS;

    this.allow = true; // used by Input.TouchMouse to disable mouse events
    this.pressed = false; // mousedown state

    Input.apply(this, arguments);
}

inherit(MouseInput, Input, {
    /**
     * handle mouse events
     * @param {Object} ev
     */
    handler: function MEhandler(ev) {
        var eventType = MOUSE_INPUT_MAP[ev.type];

        // on start we want to have the left mouse button down
        if (eventType & INPUT_START && ev.button === 0) {
            this.pressed = true;
        }

        if (eventType & INPUT_MOVE && ev.which !== 1) {
            eventType = INPUT_END;
        }

        // mouse must be down, and mouse events are allowed (see the TouchMouse input)
        if (!this.pressed || !this.allow) {
            return;
        }

        if (eventType & INPUT_END) {
            this.pressed = false;
        }

        this.callback(this.manager, eventType, {
            pointers: [ev],
            changedPointers: [ev],
            pointerType: INPUT_TYPE_MOUSE,
            srcEvent: ev
        });
    }
});

var POINTER_INPUT_MAP = {
    pointerdown: INPUT_START,
    pointermove: INPUT_MOVE,
    pointerup: INPUT_END,
    pointercancel: INPUT_CANCEL,
    pointerout: INPUT_CANCEL
};

// in IE10 the pointer types is defined as an enum
var IE10_POINTER_TYPE_ENUM = {
    2: INPUT_TYPE_TOUCH,
    3: INPUT_TYPE_PEN,
    4: INPUT_TYPE_MOUSE,
    5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816
};

var POINTER_ELEMENT_EVENTS = 'pointerdown';
var POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';

// IE10 has prefixed support, and case-sensitive
if (window.MSPointerEvent) {
    POINTER_ELEMENT_EVENTS = 'MSPointerDown';
    POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';
}

/**
 * Pointer events input
 * @constructor
 * @extends Input
 */
function PointerEventInput() {
    this.evEl = POINTER_ELEMENT_EVENTS;
    this.evWin = POINTER_WINDOW_EVENTS;

    Input.apply(this, arguments);

    this.store = (this.manager.session.pointerEvents = []);
}

inherit(PointerEventInput, Input, {
    /**
     * handle mouse events
     * @param {Object} ev
     */
    handler: function PEhandler(ev) {
        var store = this.store;
        var removePointer = false;

        var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');
        var eventType = POINTER_INPUT_MAP[eventTypeNormalized];
        var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;

        var isTouch = (pointerType == INPUT_TYPE_TOUCH);

        // get index of the event in the store
        var storeIndex = inArray(store, ev.pointerId, 'pointerId');

        // start and mouse must be down
        if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {
            if (storeIndex < 0) {
                store.push(ev);
                storeIndex = store.length - 1;
            }
        } else if (eventType & (INPUT_END | INPUT_CANCEL)) {
            removePointer = true;
        }

        // it not found, so the pointer hasn't been down (so it's probably a hover)
        if (storeIndex < 0) {
            return;
        }

        // update the event in the store
        store[storeIndex] = ev;

        this.callback(this.manager, eventType, {
            pointers: store,
            changedPointers: [ev],
            pointerType: pointerType,
            srcEvent: ev
        });

        if (removePointer) {
            // remove from the store
            store.splice(storeIndex, 1);
        }
    }
});

var SINGLE_TOUCH_INPUT_MAP = {
    touchstart: INPUT_START,
    touchmove: INPUT_MOVE,
    touchend: INPUT_END,
    touchcancel: INPUT_CANCEL
};

var SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';
var SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';

/**
 * Touch events input
 * @constructor
 * @extends Input
 */
function SingleTouchInput() {
    this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;
    this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;
    this.started = false;

    Input.apply(this, arguments);
}

inherit(SingleTouchInput, Input, {
    handler: function TEhandler(ev) {
        var type = SINGLE_TOUCH_INPUT_MAP[ev.type];

        // should we handle the touch events?
        if (type === INPUT_START) {
            this.started = true;
        }

        if (!this.started) {
            return;
        }

        var touches = normalizeSingleTouches.call(this, ev, type);

        // when done, reset the started state
        if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {
            this.started = false;
        }

        this.callback(this.manager, type, {
            pointers: touches[0],
            changedPointers: touches[1],
            pointerType: INPUT_TYPE_TOUCH,
            srcEvent: ev
        });
    }
});

/**
 * @this {TouchInput}
 * @param {Object} ev
 * @param {Number} type flag
 * @returns {undefined|Array} [all, changed]
 */
function normalizeSingleTouches(ev, type) {
    var all = toArray(ev.touches);
    var changed = toArray(ev.changedTouches);

    if (type & (INPUT_END | INPUT_CANCEL)) {
        all = uniqueArray(all.concat(changed), 'identifier', true);
    }

    return [all, changed];
}

var TOUCH_INPUT_MAP = {
    touchstart: INPUT_START,
    touchmove: INPUT_MOVE,
    touchend: INPUT_END,
    touchcancel: INPUT_CANCEL
};

var TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';

/**
 * Multi-user touch events input
 * @constructor
 * @extends Input
 */
function TouchInput() {
    this.evTarget = TOUCH_TARGET_EVENTS;
    this.targetIds = {};

    Input.apply(this, arguments);
}

inherit(TouchInput, Input, {
    handler: function MTEhandler(ev) {
        var type = TOUCH_INPUT_MAP[ev.type];
        var touches = getTouches.call(this, ev, type);
        if (!touches) {
            return;
        }

        this.callback(this.manager, type, {
            pointers: touches[0],
            changedPointers: touches[1],
            pointerType: INPUT_TYPE_TOUCH,
            srcEvent: ev
        });
    }
});

/**
 * @this {TouchInput}
 * @param {Object} ev
 * @param {Number} type flag
 * @returns {undefined|Array} [all, changed]
 */
function getTouches(ev, type) {
    var allTouches = toArray(ev.touches);
    var targetIds = this.targetIds;

    // when there is only one touch, the process can be simplified
    if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {
        targetIds[allTouches[0].identifier] = true;
        return [allTouches, allTouches];
    }

    var i,
        targetTouches,
        changedTouches = toArray(ev.changedTouches),
        changedTargetTouches = [],
        target = this.target;

    // get target touches from touches
    targetTouches = allTouches.filter(function(touch) {
        return hasParent(touch.target, target);
    });

    // collect touches
    if (type === INPUT_START) {
        i = 0;
        while (i < targetTouches.length) {
            targetIds[targetTouches[i].identifier] = true;
            i++;
        }
    }

    // filter changed touches to only contain touches that exist in the collected target ids
    i = 0;
    while (i < changedTouches.length) {
        if (targetIds[changedTouches[i].identifier]) {
            changedTargetTouches.push(changedTouches[i]);
        }

        // cleanup removed touches
        if (type & (INPUT_END | INPUT_CANCEL)) {
            delete targetIds[changedTouches[i].identifier];
        }
        i++;
    }

    if (!changedTargetTouches.length) {
        return;
    }

    return [
        // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'
        uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true),
        changedTargetTouches
    ];
}

/**
 * Combined touch and mouse input
 *
 * Touch has a higher priority then mouse, and while touching no mouse events are allowed.
 * This because touch devices also emit mouse events while doing a touch.
 *
 * @constructor
 * @extends Input
 */
function TouchMouseInput() {
    Input.apply(this, arguments);

    var handler = bindFn(this.handler, this);
    this.touch = new TouchInput(this.manager, handler);
    this.mouse = new MouseInput(this.manager, handler);
}

inherit(TouchMouseInput, Input, {
    /**
     * handle mouse and touch events
     * @param {Hammer} manager
     * @param {String} inputEvent
     * @param {Object} inputData
     */
    handler: function TMEhandler(manager, inputEvent, inputData) {
        var isTouch = (inputData.pointerType == INPUT_TYPE_TOUCH),
            isMouse = (inputData.pointerType == INPUT_TYPE_MOUSE);

        // when we're in a touch event, so  block all upcoming mouse events
        // most mobile browser also emit mouseevents, right after touchstart
        if (isTouch) {
            this.mouse.allow = false;
        } else if (isMouse && !this.mouse.allow) {
            return;
        }

        // reset the allowMouse when we're done
        if (inputEvent & (INPUT_END | INPUT_CANCEL)) {
            this.mouse.allow = true;
        }

        this.callback(manager, inputEvent, inputData);
    },

    /**
     * remove the event listeners
     */
    destroy: function destroy() {
        this.touch.destroy();
        this.mouse.destroy();
    }
});

var PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');
var NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;

// magical touchAction value
var TOUCH_ACTION_COMPUTE = 'compute';
var TOUCH_ACTION_AUTO = 'auto';
var TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented
var TOUCH_ACTION_NONE = 'none';
var TOUCH_ACTION_PAN_X = 'pan-x';
var TOUCH_ACTION_PAN_Y = 'pan-y';

/**
 * Touch Action
 * sets the touchAction property or uses the js alternative
 * @param {Manager} manager
 * @param {String} value
 * @constructor
 */
function TouchAction(manager, value) {
    this.manager = manager;
    this.set(value);
}

TouchAction.prototype = {
    /**
     * set the touchAction value on the element or enable the polyfill
     * @param {String} value
     */
    set: function(value) {
        // find out the touch-action by the event handlers
        if (value == TOUCH_ACTION_COMPUTE) {
            value = this.compute();
        }

        if (NATIVE_TOUCH_ACTION) {
            this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;
        }
        this.actions = value.toLowerCase().trim();
    },

    /**
     * just re-set the touchAction value
     */
    update: function() {
        this.set(this.manager.options.touchAction);
    },

    /**
     * compute the value for the touchAction property based on the recognizer's settings
     * @returns {String} value
     */
    compute: function() {
        var actions = [];
        each(this.manager.recognizers, function(recognizer) {
            if (boolOrFn(recognizer.options.enable, [recognizer])) {
                actions = actions.concat(recognizer.getTouchAction());
            }
        });
        return cleanTouchActions(actions.join(' '));
    },

    /**
     * this method is called on each input cycle and provides the preventing of the browser behavior
     * @param {Object} input
     */
    preventDefaults: function(input) {
        // not needed with native support for the touchAction property
        if (NATIVE_TOUCH_ACTION) {
            return;
        }

        var srcEvent = input.srcEvent;
        var direction = input.offsetDirection;

        // if the touch action did prevented once this session
        if (this.manager.session.prevented) {
            srcEvent.preventDefault();
            return;
        }

        var actions = this.actions;
        var hasNone = inStr(actions, TOUCH_ACTION_NONE);
        var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);
        var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);

        if (hasNone ||
            (hasPanY && direction & DIRECTION_HORIZONTAL) ||
            (hasPanX && direction & DIRECTION_VERTICAL)) {
            return this.preventSrc(srcEvent);
        }
    },

    /**
     * call preventDefault to prevent the browser's default behavior (scrolling in most cases)
     * @param {Object} srcEvent
     */
    preventSrc: function(srcEvent) {
        this.manager.session.prevented = true;
        srcEvent.preventDefault();
    }
};

/**
 * when the touchActions are collected they are not a valid value, so we need to clean things up. *
 * @param {String} actions
 * @returns {*}
 */
function cleanTouchActions(actions) {
    // none
    if (inStr(actions, TOUCH_ACTION_NONE)) {
        return TOUCH_ACTION_NONE;
    }

    var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);
    var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);

    // pan-x and pan-y can be combined
    if (hasPanX && hasPanY) {
        return TOUCH_ACTION_PAN_X + ' ' + TOUCH_ACTION_PAN_Y;
    }

    // pan-x OR pan-y
    if (hasPanX || hasPanY) {
        return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;
    }

    // manipulation
    if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {
        return TOUCH_ACTION_MANIPULATION;
    }

    return TOUCH_ACTION_AUTO;
}

/**
 * Recognizer flow explained; *
 * All recognizers have the initial state of POSSIBLE when a input session starts.
 * The definition of a input session is from the first input until the last input, with all it's movement in it. *
 * Example session for mouse-input: mousedown -> mousemove -> mouseup
 *
 * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed
 * which determines with state it should be.
 *
 * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to
 * POSSIBLE to give it another change on the next cycle.
 *
 *               Possible
 *                  |
 *            +-----+---------------+
 *            |                     |
 *      +-----+-----+               |
 *      |           |               |
 *   Failed      Cancelled          |
 *                          +-------+------+
 *                          |              |
 *                      Recognized       Began
 *                                         |
 *                                      Changed
 *                                         |
 *                                  Ended/Recognized
 */
var STATE_POSSIBLE = 1;
var STATE_BEGAN = 2;
var STATE_CHANGED = 4;
var STATE_ENDED = 8;
var STATE_RECOGNIZED = STATE_ENDED;
var STATE_CANCELLED = 16;
var STATE_FAILED = 32;

/**
 * Recognizer
 * Every recognizer needs to extend from this class.
 * @constructor
 * @param {Object} options
 */
function Recognizer(options) {
    this.id = uniqueId();

    this.manager = null;
    this.options = merge(options || {}, this.defaults);

    // default is enable true
    this.options.enable = ifUndefined(this.options.enable, true);

    this.state = STATE_POSSIBLE;

    this.simultaneous = {};
    this.requireFail = [];
}

Recognizer.prototype = {
    /**
     * @virtual
     * @type {Object}
     */
    defaults: {},

    /**
     * set options
     * @param {Object} options
     * @return {Recognizer}
     */
    set: function(options) {
        extend(this.options, options);

        // also update the touchAction, in case something changed about the directions/enabled state
        this.manager && this.manager.touchAction.update();
        return this;
    },

    /**
     * recognize simultaneous with an other recognizer.
     * @param {Recognizer} otherRecognizer
     * @returns {Recognizer} this
     */
    recognizeWith: function(otherRecognizer) {
        if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {
            return this;
        }

        var simultaneous = this.simultaneous;
        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
        if (!simultaneous[otherRecognizer.id]) {
            simultaneous[otherRecognizer.id] = otherRecognizer;
            otherRecognizer.recognizeWith(this);
        }
        return this;
    },

    /**
     * drop the simultaneous link. it doesnt remove the link on the other recognizer.
     * @param {Recognizer} otherRecognizer
     * @returns {Recognizer} this
     */
    dropRecognizeWith: function(otherRecognizer) {
        if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {
            return this;
        }

        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
        delete this.simultaneous[otherRecognizer.id];
        return this;
    },

    /**
     * recognizer can only run when an other is failing
     * @param {Recognizer} otherRecognizer
     * @returns {Recognizer} this
     */
    requireFailure: function(otherRecognizer) {
        if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {
            return this;
        }

        var requireFail = this.requireFail;
        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
        if (inArray(requireFail, otherRecognizer) === -1) {
            requireFail.push(otherRecognizer);
            otherRecognizer.requireFailure(this);
        }
        return this;
    },

    /**
     * drop the requireFailure link. it does not remove the link on the other recognizer.
     * @param {Recognizer} otherRecognizer
     * @returns {Recognizer} this
     */
    dropRequireFailure: function(otherRecognizer) {
        if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {
            return this;
        }

        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
        var index = inArray(this.requireFail, otherRecognizer);
        if (index > -1) {
            this.requireFail.splice(index, 1);
        }
        return this;
    },

    /**
     * has require failures boolean
     * @returns {boolean}
     */
    hasRequireFailures: function() {
        return this.requireFail.length > 0;
    },

    /**
     * if the recognizer can recognize simultaneous with an other recognizer
     * @param {Recognizer} otherRecognizer
     * @returns {Boolean}
     */
    canRecognizeWith: function(otherRecognizer) {
        return !!this.simultaneous[otherRecognizer.id];
    },

    /**
     * You should use `tryEmit` instead of `emit` directly to check
     * that all the needed recognizers has failed before emitting.
     * @param {Object} input
     */
    emit: function(input) {
        var self = this;
        var state = this.state;

        function emit(withState) {
            self.manager.emit(self.options.event + (withState ? stateStr(state) : ''), input);
        }

        // 'panstart' and 'panmove'
        if (state < STATE_ENDED) {
            emit(true);
        }

        emit(); // simple 'eventName' events

        // panend and pancancel
        if (state >= STATE_ENDED) {
            emit(true);
        }
    },

    /**
     * Check that all the require failure recognizers has failed,
     * if true, it emits a gesture event,
     * otherwise, setup the state to FAILED.
     * @param {Object} input
     */
    tryEmit: function(input) {
        if (this.canEmit()) {
            return this.emit(input);
        }
        // it's failing anyway
        this.state = STATE_FAILED;
    },

    /**
     * can we emit?
     * @returns {boolean}
     */
    canEmit: function() {
        var i = 0;
        while (i < this.requireFail.length) {
            if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {
                return false;
            }
            i++;
        }
        return true;
    },

    /**
     * update the recognizer
     * @param {Object} inputData
     */
    recognize: function(inputData) {
        // make a new copy of the inputData
        // so we can change the inputData without messing up the other recognizers
        var inputDataClone = extend({}, inputData);

        // is is enabled and allow recognizing?
        if (!boolOrFn(this.options.enable, [this, inputDataClone])) {
            this.reset();
            this.state = STATE_FAILED;
            return;
        }

        // reset when we've reached the end
        if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {
            this.state = STATE_POSSIBLE;
        }

        this.state = this.process(inputDataClone);

        // the recognizer has recognized a gesture
        // so trigger an event
        if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {
            this.tryEmit(inputDataClone);
        }
    },

    /**
     * return the state of the recognizer
     * the actual recognizing happens in this method
     * @virtual
     * @param {Object} inputData
     * @returns {Const} STATE
     */
    process: function(inputData) { }, // jshint ignore:line

    /**
     * return the preferred touch-action
     * @virtual
     * @returns {Array}
     */
    getTouchAction: function() { },

    /**
     * called when the gesture isn't allowed to recognize
     * like when another is being recognized or it is disabled
     * @virtual
     */
    reset: function() { }
};

/**
 * get a usable string, used as event postfix
 * @param {Const} state
 * @returns {String} state
 */
function stateStr(state) {
    if (state & STATE_CANCELLED) {
        return 'cancel';
    } else if (state & STATE_ENDED) {
        return 'end';
    } else if (state & STATE_CHANGED) {
        return 'move';
    } else if (state & STATE_BEGAN) {
        return 'start';
    }
    return '';
}

/**
 * direction cons to string
 * @param {Const} direction
 * @returns {String}
 */
function directionStr(direction) {
    if (direction == DIRECTION_DOWN) {
        return 'down';
    } else if (direction == DIRECTION_UP) {
        return 'up';
    } else if (direction == DIRECTION_LEFT) {
        return 'left';
    } else if (direction == DIRECTION_RIGHT) {
        return 'right';
    }
    return '';
}

/**
 * get a recognizer by name if it is bound to a manager
 * @param {Recognizer|String} otherRecognizer
 * @param {Recognizer} recognizer
 * @returns {Recognizer}
 */
function getRecognizerByNameIfManager(otherRecognizer, recognizer) {
    var manager = recognizer.manager;
    if (manager) {
        return manager.get(otherRecognizer);
    }
    return otherRecognizer;
}

/**
 * This recognizer is just used as a base for the simple attribute recognizers.
 * @constructor
 * @extends Recognizer
 */
function AttrRecognizer() {
    Recognizer.apply(this, arguments);
}

inherit(AttrRecognizer, Recognizer, {
    /**
     * @namespace
     * @memberof AttrRecognizer
     */
    defaults: {
        /**
         * @type {Number}
         * @default 1
         */
        pointers: 1
    },

    /**
     * Used to check if it the recognizer receives valid input, like input.distance > 10.
     * @memberof AttrRecognizer
     * @param {Object} input
     * @returns {Boolean} recognized
     */
    attrTest: function(input) {
        var optionPointers = this.options.pointers;
        return optionPointers === 0 || input.pointers.length === optionPointers;
    },

    /**
     * Process the input and return the state for the recognizer
     * @memberof AttrRecognizer
     * @param {Object} input
     * @returns {*} State
     */
    process: function(input) {
        var state = this.state;
        var eventType = input.eventType;

        var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);
        var isValid = this.attrTest(input);

        // on cancel input and we've recognized before, return STATE_CANCELLED
        if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {
            return state | STATE_CANCELLED;
        } else if (isRecognized || isValid) {
            if (eventType & INPUT_END) {
                return state | STATE_ENDED;
            } else if (!(state & STATE_BEGAN)) {
                return STATE_BEGAN;
            }
            return state | STATE_CHANGED;
        }
        return STATE_FAILED;
    }
});

/**
 * Pan
 * Recognized when the pointer is down and moved in the allowed direction.
 * @constructor
 * @extends AttrRecognizer
 */
function PanRecognizer() {
    AttrRecognizer.apply(this, arguments);

    this.pX = null;
    this.pY = null;
}

inherit(PanRecognizer, AttrRecognizer, {
    /**
     * @namespace
     * @memberof PanRecognizer
     */
    defaults: {
        event: 'pan',
        threshold: 10,
        pointers: 1,
        direction: DIRECTION_ALL
    },

    getTouchAction: function() {
        var direction = this.options.direction;
        var actions = [];
        if (direction & DIRECTION_HORIZONTAL) {
            actions.push(TOUCH_ACTION_PAN_Y);
        }
        if (direction & DIRECTION_VERTICAL) {
            actions.push(TOUCH_ACTION_PAN_X);
        }
        return actions;
    },

    directionTest: function(input) {
        var options = this.options;
        var hasMoved = true;
        var distance = input.distance;
        var direction = input.direction;
        var x = input.deltaX;
        var y = input.deltaY;

        // lock to axis?
        if (!(direction & options.direction)) {
            if (options.direction & DIRECTION_HORIZONTAL) {
                direction = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;
                hasMoved = x != this.pX;
                distance = Math.abs(input.deltaX);
            } else {
                direction = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;
                hasMoved = y != this.pY;
                distance = Math.abs(input.deltaY);
            }
        }
        input.direction = direction;
        return hasMoved && distance > options.threshold && direction & options.direction;
    },

    attrTest: function(input) {
        return AttrRecognizer.prototype.attrTest.call(this, input) &&
            (this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));
    },

    emit: function(input) {
        this.pX = input.deltaX;
        this.pY = input.deltaY;

        var direction = directionStr(input.direction);
        if (direction) {
            this.manager.emit(this.options.event + direction, input);
        }

        this._super.emit.call(this, input);
    }
});

/**
 * Pinch
 * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).
 * @constructor
 * @extends AttrRecognizer
 */
function PinchRecognizer() {
    AttrRecognizer.apply(this, arguments);
}

inherit(PinchRecognizer, AttrRecognizer, {
    /**
     * @namespace
     * @memberof PinchRecognizer
     */
    defaults: {
        event: 'pinch',
        threshold: 0,
        pointers: 2
    },

    getTouchAction: function() {
        return [TOUCH_ACTION_NONE];
    },

    attrTest: function(input) {
        return this._super.attrTest.call(this, input) &&
            (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);
    },

    emit: function(input) {
        this._super.emit.call(this, input);
        if (input.scale !== 1) {
            var inOut = input.scale < 1 ? 'in' : 'out';
            this.manager.emit(this.options.event + inOut, input);
        }
    }
});

/**
 * Press
 * Recognized when the pointer is down for x ms without any movement.
 * @constructor
 * @extends Recognizer
 */
function PressRecognizer() {
    Recognizer.apply(this, arguments);

    this._timer = null;
    this._input = null;
}

inherit(PressRecognizer, Recognizer, {
    /**
     * @namespace
     * @memberof PressRecognizer
     */
    defaults: {
        event: 'press',
        pointers: 1,
        time: 500, // minimal time of the pointer to be pressed
        threshold: 5 // a minimal movement is ok, but keep it low
    },

    getTouchAction: function() {
        return [TOUCH_ACTION_AUTO];
    },

    process: function(input) {
        var options = this.options;
        var validPointers = input.pointers.length === options.pointers;
        var validMovement = input.distance < options.threshold;
        var validTime = input.deltaTime > options.time;

        this._input = input;

        // we only allow little movement
        // and we've reached an end event, so a tap is possible
        if (!validMovement || !validPointers || (input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime)) {
            this.reset();
        } else if (input.eventType & INPUT_START) {
            this.reset();
            this._timer = setTimeoutContext(function() {
                this.state = STATE_RECOGNIZED;
                this.tryEmit();
            }, options.time, this);
        } else if (input.eventType & INPUT_END) {
            return STATE_RECOGNIZED;
        }
        return STATE_FAILED;
    },

    reset: function() {
        clearTimeout(this._timer);
    },

    emit: function(input) {
        if (this.state !== STATE_RECOGNIZED) {
            return;
        }

        if (input && (input.eventType & INPUT_END)) {
            this.manager.emit(this.options.event + 'up', input);
        } else {
            this._input.timeStamp = now();
            this.manager.emit(this.options.event, this._input);
        }
    }
});

/**
 * Rotate
 * Recognized when two or more pointer are moving in a circular motion.
 * @constructor
 * @extends AttrRecognizer
 */
function RotateRecognizer() {
    AttrRecognizer.apply(this, arguments);
}

inherit(RotateRecognizer, AttrRecognizer, {
    /**
     * @namespace
     * @memberof RotateRecognizer
     */
    defaults: {
        event: 'rotate',
        threshold: 0,
        pointers: 2
    },

    getTouchAction: function() {
        return [TOUCH_ACTION_NONE];
    },

    attrTest: function(input) {
        return this._super.attrTest.call(this, input) &&
            (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);
    }
});

/**
 * Swipe
 * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.
 * @constructor
 * @extends AttrRecognizer
 */
function SwipeRecognizer() {
    AttrRecognizer.apply(this, arguments);
}

inherit(SwipeRecognizer, AttrRecognizer, {
    /**
     * @namespace
     * @memberof SwipeRecognizer
     */
    defaults: {
        event: 'swipe',
        threshold: 10,
        velocity: 0.65,
        direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,
        pointers: 1
    },

    getTouchAction: function() {
        return PanRecognizer.prototype.getTouchAction.call(this);
    },

    attrTest: function(input) {
        var direction = this.options.direction;
        var velocity;

        if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {
            velocity = input.velocity;
        } else if (direction & DIRECTION_HORIZONTAL) {
            velocity = input.velocityX;
        } else if (direction & DIRECTION_VERTICAL) {
            velocity = input.velocityY;
        }

        return this._super.attrTest.call(this, input) &&
            direction & input.direction &&
            input.distance > this.options.threshold &&
            abs(velocity) > this.options.velocity && input.eventType & INPUT_END;
    },

    emit: function(input) {
        var direction = directionStr(input.direction);
        if (direction) {
            this.manager.emit(this.options.event + direction, input);
        }

        this.manager.emit(this.options.event, input);
    }
});

/**
 * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur
 * between the given interval and position. The delay option can be used to recognize multi-taps without firing
 * a single tap.
 *
 * The eventData from the emitted event contains the property `tapCount`, which contains the amount of
 * multi-taps being recognized.
 * @constructor
 * @extends Recognizer
 */
function TapRecognizer() {
    Recognizer.apply(this, arguments);

    // previous time and center,
    // used for tap counting
    this.pTime = false;
    this.pCenter = false;

    this._timer = null;
    this._input = null;
    this.count = 0;
}

inherit(TapRecognizer, Recognizer, {
    /**
     * @namespace
     * @memberof PinchRecognizer
     */
    defaults: {
        event: 'tap',
        pointers: 1,
        taps: 1,
        interval: 300, // max time between the multi-tap taps
        time: 250, // max time of the pointer to be down (like finger on the screen)
        threshold: 2, // a minimal movement is ok, but keep it low
        posThreshold: 10 // a multi-tap can be a bit off the initial position
    },

    getTouchAction: function() {
        return [TOUCH_ACTION_MANIPULATION];
    },

    process: function(input) {
        var options = this.options;

        var validPointers = input.pointers.length === options.pointers;
        var validMovement = input.distance < options.threshold;
        var validTouchTime = input.deltaTime < options.time;

        this.reset();

        if ((input.eventType & INPUT_START) && (this.count === 0)) {
            return this.failTimeout();
        }

        // we only allow little movement
        // and we've reached an end event, so a tap is possible
        if (validMovement && validTouchTime && validPointers) {
            if (input.eventType != INPUT_END) {
                return this.failTimeout();
            }

            var validInterval = this.pTime ? (input.timeStamp - this.pTime < options.interval) : true;
            var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;

            this.pTime = input.timeStamp;
            this.pCenter = input.center;

            if (!validMultiTap || !validInterval) {
                this.count = 1;
            } else {
                this.count += 1;
            }

            this._input = input;

            // if tap count matches we have recognized it,
            // else it has began recognizing...
            var tapCount = this.count % options.taps;
            if (tapCount === 0) {
                // no failing requirements, immediately trigger the tap event
                // or wait as long as the multitap interval to trigger
                if (!this.hasRequireFailures()) {
                    return STATE_RECOGNIZED;
                } else {
                    this._timer = setTimeoutContext(function() {
                        this.state = STATE_RECOGNIZED;
                        this.tryEmit();
                    }, options.interval, this);
                    return STATE_BEGAN;
                }
            }
        }
        return STATE_FAILED;
    },

    failTimeout: function() {
        this._timer = setTimeoutContext(function() {
            this.state = STATE_FAILED;
        }, this.options.interval, this);
        return STATE_FAILED;
    },

    reset: function() {
        clearTimeout(this._timer);
    },

    emit: function() {
        if (this.state == STATE_RECOGNIZED ) {
            this._input.tapCount = this.count;
            this.manager.emit(this.options.event, this._input);
        }
    }
});

/**
 * Simple way to create an manager with a default set of recognizers.
 * @param {HTMLElement} element
 * @param {Object} [options]
 * @constructor
 */
function Hammer(element, options) {
    options = options || {};
    options.recognizers = ifUndefined(options.recognizers, Hammer.defaults.preset);
    return new Manager(element, options);
}

/**
 * @const {string}
 */
Hammer.VERSION = '2.0.4';

/**
 * default settings
 * @namespace
 */
Hammer.defaults = {
    /**
     * set if DOM events are being triggered.
     * But this is slower and unused by simple implementations, so disabled by default.
     * @type {Boolean}
     * @default false
     */
    domEvents: false,

    /**
     * The value for the touchAction property/fallback.
     * When set to `compute` it will magically set the correct value based on the added recognizers.
     * @type {String}
     * @default compute
     */
    touchAction: TOUCH_ACTION_COMPUTE,

    /**
     * @type {Boolean}
     * @default true
     */
    enable: true,

    /**
     * EXPERIMENTAL FEATURE -- can be removed/changed
     * Change the parent input target element.
     * If Null, then it is being set the to main element.
     * @type {Null|EventTarget}
     * @default null
     */
    inputTarget: null,

    /**
     * force an input class
     * @type {Null|Function}
     * @default null
     */
    inputClass: null,

    /**
     * Default recognizer setup when calling `Hammer()`
     * When creating a new Manager these will be skipped.
     * @type {Array}
     */
    preset: [
        // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]
        [RotateRecognizer, { enable: false }],
        [PinchRecognizer, { enable: false }, ['rotate']],
        [SwipeRecognizer,{ direction: DIRECTION_HORIZONTAL }],
        [PanRecognizer, { direction: DIRECTION_HORIZONTAL }, ['swipe']],
        [TapRecognizer],
        [TapRecognizer, { event: 'doubletap', taps: 2 }, ['tap']],
        [PressRecognizer]
    ],

    /**
     * Some CSS properties can be used to improve the working of Hammer.
     * Add them to this method and they will be set when creating a new Manager.
     * @namespace
     */
    cssProps: {
        /**
         * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.
         * @type {String}
         * @default 'none'
         */
        userSelect: 'none',

        /**
         * Disable the Windows Phone grippers when pressing an element.
         * @type {String}
         * @default 'none'
         */
        touchSelect: 'none',

        /**
         * Disables the default callout shown when you touch and hold a touch target.
         * On iOS, when you touch and hold a touch target such as a link, Safari displays
         * a callout containing information about the link. This property allows you to disable that callout.
         * @type {String}
         * @default 'none'
         */
        touchCallout: 'none',

        /**
         * Specifies whether zooming is enabled. Used by IE10>
         * @type {String}
         * @default 'none'
         */
        contentZooming: 'none',

        /**
         * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.
         * @type {String}
         * @default 'none'
         */
        userDrag: 'none',

        /**
         * Overrides the highlight color shown when the user taps a link or a JavaScript
         * clickable element in iOS. This property obeys the alpha value, if specified.
         * @type {String}
         * @default 'rgba(0,0,0,0)'
         */
        tapHighlightColor: 'rgba(0,0,0,0)'
    }
};

var STOP = 1;
var FORCED_STOP = 2;

/**
 * Manager
 * @param {HTMLElement} element
 * @param {Object} [options]
 * @constructor
 */
function Manager(element, options) {
    options = options || {};

    this.options = merge(options, Hammer.defaults);
    this.options.inputTarget = this.options.inputTarget || element;

    this.handlers = {};
    this.session = {};
    this.recognizers = [];

    this.element = element;
    this.input = createInputInstance(this);
    this.touchAction = new TouchAction(this, this.options.touchAction);

    toggleCssProps(this, true);

    each(options.recognizers, function(item) {
        var recognizer = this.add(new (item[0])(item[1]));
        item[2] && recognizer.recognizeWith(item[2]);
        item[3] && recognizer.requireFailure(item[3]);
    }, this);
}

Manager.prototype = {
    /**
     * set options
     * @param {Object} options
     * @returns {Manager}
     */
    set: function(options) {
        extend(this.options, options);

        // Options that need a little more setup
        if (options.touchAction) {
            this.touchAction.update();
        }
        if (options.inputTarget) {
            // Clean up existing event listeners and reinitialize
            this.input.destroy();
            this.input.target = options.inputTarget;
            this.input.init();
        }
        return this;
    },

    /**
     * stop recognizing for this session.
     * This session will be discarded, when a new [input]start event is fired.
     * When forced, the recognizer cycle is stopped immediately.
     * @param {Boolean} [force]
     */
    stop: function(force) {
        this.session.stopped = force ? FORCED_STOP : STOP;
    },

    /**
     * run the recognizers!
     * called by the inputHandler function on every movement of the pointers (touches)
     * it walks through all the recognizers and tries to detect the gesture that is being made
     * @param {Object} inputData
     */
    recognize: function(inputData) {
        var session = this.session;
        if (session.stopped) {
            return;
        }

        // run the touch-action polyfill
        this.touchAction.preventDefaults(inputData);

        var recognizer;
        var recognizers = this.recognizers;

        // this holds the recognizer that is being recognized.
        // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED
        // if no recognizer is detecting a thing, it is set to `null`
        var curRecognizer = session.curRecognizer;

        // reset when the last recognizer is recognized
        // or when we're in a new session
        if (!curRecognizer || (curRecognizer && curRecognizer.state & STATE_RECOGNIZED)) {
            curRecognizer = session.curRecognizer = null;
        }

        var i = 0;
        while (i < recognizers.length) {
            recognizer = recognizers[i];

            // find out if we are allowed try to recognize the input for this one.
            // 1.   allow if the session is NOT forced stopped (see the .stop() method)
            // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one
            //      that is being recognized.
            // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.
            //      this can be setup with the `recognizeWith()` method on the recognizer.
            if (session.stopped !== FORCED_STOP && ( // 1
                    !curRecognizer || recognizer == curRecognizer || // 2
                    recognizer.canRecognizeWith(curRecognizer))) { // 3
                recognizer.recognize(inputData);
            } else {
                recognizer.reset();
            }

            // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the
            // current active recognizer. but only if we don't already have an active recognizer
            if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {
                curRecognizer = session.curRecognizer = recognizer;
            }
            i++;
        }
    },

    /**
     * get a recognizer by its event name.
     * @param {Recognizer|String} recognizer
     * @returns {Recognizer|Null}
     */
    get: function(recognizer) {
        if (recognizer instanceof Recognizer) {
            return recognizer;
        }

        var recognizers = this.recognizers;
        for (var i = 0; i < recognizers.length; i++) {
            if (recognizers[i].options.event == recognizer) {
                return recognizers[i];
            }
        }
        return null;
    },

    /**
     * add a recognizer to the manager
     * existing recognizers with the same event name will be removed
     * @param {Recognizer} recognizer
     * @returns {Recognizer|Manager}
     */
    add: function(recognizer) {
        if (invokeArrayArg(recognizer, 'add', this)) {
            return this;
        }

        // remove existing
        var existing = this.get(recognizer.options.event);
        if (existing) {
            this.remove(existing);
        }

        this.recognizers.push(recognizer);
        recognizer.manager = this;

        this.touchAction.update();
        return recognizer;
    },

    /**
     * remove a recognizer by name or instance
     * @param {Recognizer|String} recognizer
     * @returns {Manager}
     */
    remove: function(recognizer) {
        if (invokeArrayArg(recognizer, 'remove', this)) {
            return this;
        }

        var recognizers = this.recognizers;
        recognizer = this.get(recognizer);
        recognizers.splice(inArray(recognizers, recognizer), 1);

        this.touchAction.update();
        return this;
    },

    /**
     * bind event
     * @param {String} events
     * @param {Function} handler
     * @returns {EventEmitter} this
     */
    on: function(events, handler) {
        var handlers = this.handlers;
        each(splitStr(events), function(event) {
            handlers[event] = handlers[event] || [];
            handlers[event].push(handler);
        });
        return this;
    },

    /**
     * unbind event, leave emit blank to remove all handlers
     * @param {String} events
     * @param {Function} [handler]
     * @returns {EventEmitter} this
     */
    off: function(events, handler) {
        var handlers = this.handlers;
        each(splitStr(events), function(event) {
            if (!handler) {
                delete handlers[event];
            } else {
                handlers[event].splice(inArray(handlers[event], handler), 1);
            }
        });
        return this;
    },

    /**
     * emit event to the listeners
     * @param {String} event
     * @param {Object} data
     */
    emit: function(event, data) {
        // we also want to trigger dom events
        if (this.options.domEvents) {
            triggerDomEvent(event, data);
        }

        // no handlers, so skip it all
        var handlers = this.handlers[event] && this.handlers[event].slice();
        if (!handlers || !handlers.length) {
            return;
        }

        data.type = event;
        data.preventDefault = function() {
            data.srcEvent.preventDefault();
        };

        var i = 0;
        while (i < handlers.length) {
            handlers[i](data);
            i++;
        }
    },

    /**
     * destroy the manager and unbinds all events
     * it doesn't unbind dom events, that is the user own responsibility
     */
    destroy: function() {
        this.element && toggleCssProps(this, false);

        this.handlers = {};
        this.session = {};
        this.input.destroy();
        this.element = null;
    }
};

/**
 * add/remove the css properties as defined in manager.options.cssProps
 * @param {Manager} manager
 * @param {Boolean} add
 */
function toggleCssProps(manager, add) {
    var element = manager.element;
    each(manager.options.cssProps, function(value, name) {
        element.style[prefixed(element.style, name)] = add ? value : '';
    });
}

/**
 * trigger dom event
 * @param {String} event
 * @param {Object} data
 */
function triggerDomEvent(event, data) {
    var gestureEvent = document.createEvent('Event');
    gestureEvent.initEvent(event, true, true);
    gestureEvent.gesture = data;
    data.target.dispatchEvent(gestureEvent);
}

extend(Hammer, {
    INPUT_START: INPUT_START,
    INPUT_MOVE: INPUT_MOVE,
    INPUT_END: INPUT_END,
    INPUT_CANCEL: INPUT_CANCEL,

    STATE_POSSIBLE: STATE_POSSIBLE,
    STATE_BEGAN: STATE_BEGAN,
    STATE_CHANGED: STATE_CHANGED,
    STATE_ENDED: STATE_ENDED,
    STATE_RECOGNIZED: STATE_RECOGNIZED,
    STATE_CANCELLED: STATE_CANCELLED,
    STATE_FAILED: STATE_FAILED,

    DIRECTION_NONE: DIRECTION_NONE,
    DIRECTION_LEFT: DIRECTION_LEFT,
    DIRECTION_RIGHT: DIRECTION_RIGHT,
    DIRECTION_UP: DIRECTION_UP,
    DIRECTION_DOWN: DIRECTION_DOWN,
    DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,
    DIRECTION_VERTICAL: DIRECTION_VERTICAL,
    DIRECTION_ALL: DIRECTION_ALL,

    Manager: Manager,
    Input: Input,
    TouchAction: TouchAction,

    TouchInput: TouchInput,
    MouseInput: MouseInput,
    PointerEventInput: PointerEventInput,
    TouchMouseInput: TouchMouseInput,
    SingleTouchInput: SingleTouchInput,

    Recognizer: Recognizer,
    AttrRecognizer: AttrRecognizer,
    Tap: TapRecognizer,
    Pan: PanRecognizer,
    Swipe: SwipeRecognizer,
    Pinch: PinchRecognizer,
    Rotate: RotateRecognizer,
    Press: PressRecognizer,

    on: addEventListeners,
    off: removeEventListeners,
    each: each,
    merge: merge,
    extend: extend,
    inherit: inherit,
    bindFn: bindFn,
    prefixed: prefixed
});

if (typeof define == TYPE_FUNCTION && define.amd) {
    define(function() {
        return Hammer;
    });
} else if (typeof module != 'undefined' && module.exports) {
    module.exports = Hammer;
} else {
    window[exportName] = Hammer;
}

})(window, document, 'Hammer');

// ---- Angular Hammer ----

// Copyright (c) 2014 Ryan S Mullins <ryan@ryanmullins.org>
// Licensed under the MIT Software License

(function (window, angular, Hammer) {
  'use strict';

  // Checking to make sure Hammer and Angular are defined

  if (typeof angular === 'undefined') {
    if (typeof require !== 'undefined' && require) {
      try {
        angular = require('angular');
      } catch (e) {
        return console.log('ERROR: Angular Hammer could not require() a reference to angular');
      }
    } else if (typeof window.angular !== 'undefined') {
      angular = window.angular;
    } else {
      return console.log('ERROR: Angular Hammer could not find or require() a reference to angular');
    }
  }

  if (typeof Hammer === 'undefined') {
    if (typeof require !== 'undefined' && require) {
      try {
        Hammer = require('hammerjs');
      } catch (e) {
        return console.log('ERROR: Angular Hammer could not require() a reference to Hammer');
      }
    } else if (typeof window.Hammer !== 'undefined') {
      Hammer = window.Hammer;
    } else {
      return console.log('ERROR: Angular Hammer could not find or require() a reference to Hammer');
    }
  }

  /**
   * Mapping of the gesture event names with the Angular attribute directive
   * names. Follows the form: <directiveName>:<eventName>.
   *
   * @type {Array}
   */
  var gestureTypes = [
    'hmCustom:custom',
    'hmSwipe:swipe',
    'hmSwipeleft:swipeleft',
    'hmSwiperight:swiperight',
    'hmSwipeup:swipeup',
    'hmSwipedown:swipedown',
    'hmPan:pan',
    'hmPanstart:panstart',
    'hmPanmove:panmove',
    'hmPanend:panend',
    'hmPancancel:pancancel',
    'hmPanleft:panleft',
    'hmPanright:panright',
    'hmPanup:panup',
    'hmPandown:pandown',
    'hmPress:press',
    'hmPressup:pressup',
    'hmRotate:rotate',
    'hmRotatestart:rotatestart',
    'hmRotatemove:rotatemove',
    'hmRotateend:rotateend',
    'hmRotatecancel:rotatecancel',
    'hmPinch:pinch',
    'hmPinchstart:pinchstart',
    'hmPinchmove:pinchmove',
    'hmPinchend:pinchend',
    'hmPinchcancel:pinchcancel',
    'hmPinchin:pinchin',
    'hmPinchout:pinchout',
    'hmTap:tap',
    'hmDoubletap:doubletap'
  ];

  // ---- Module Definition ----

  /**
   * @module hmTouchEvents
   * @description Angular.js module for adding Hammer.js event listeners to HTML
   * elements using attribute directives
   * @requires angular
   * @requires hammer
   */
  angular.module('hmTouchEvents', []);

  /**
   * Iterates through each gesture type mapping and creates a directive for
   * each of the
   *
   * @param  {String} type Mapping in the form of <directiveName>:<eventName>
   * @return None
   */
  angular.forEach(gestureTypes, function (type) {
    var directive = type.split(':'),
        directiveName = directive[0],
        eventName = directive[1];

    angular.module('hmTouchEvents')
      .directive(directiveName, ['$parse', '$window', function ($parse, $window) {
        return {
          'restrict' : 'A',
          'link' : function (scope, element, attrs) {

            // Check for Hammer and required functionality
            // If no Hammer, maybe bind tap and doubletap to click and dblclick

            if (!Hammer || !$window.addEventListener) {
              if (directiveName === 'hmTap') {
                element.bind('click', handler);
              }

              if (directiveName === 'hmDoubletap') {
                element.bind('dblclick', handler);
              }

              return;
            }

            var hammer = element.data('hammer'),
                managerOpts = angular.fromJson(attrs.hmManagerOptions),
                recognizerOpts = angular.fromJson(attrs.hmRecognizerOptions);


            // Check for a manager, make one if needed and destroy it when
            // the scope is destroyed

            if (!hammer) {
              hammer = new Hammer.Manager(element[0], managerOpts);
              element.data('hammer', hammer);
              scope.$on('$destroy', function () {
                hammer.destroy();
              });
            }

            // Instantiate the handler

            var handlerName = attrs[directiveName],
                handlerExpr = $parse(handlerName),
                handler = function (event) {
                  var phase = scope.$root.$$phase,
                      recognizer = hammer.get(event.type);

                  event.element = element;

                  if (recognizer) {
                    if (recognizer.options.preventDefault) {
                      event.preventDefault();
                    }

                    if (recognizer.options.stopPropagation) {
                      event.srcEvent.stopPropagation();
                    }
                  }

                  if (phase === '$apply' || phase === '$digest') {
                    callHandler();
                  } else {
                    scope.$apply(callHandler);
                  }

                  function callHandler () {
                    var fn = handlerExpr(scope, {'$event':event});

                    if (fn) {
                      fn.call(scope, event);
                    }
                  }
                };

            // Setting up the recognizers based on the supplied options

            if (angular.isArray(recognizerOpts)) {
              // The recognizer options may be stored in an array. In this
              // case, Angular Hammer iterates through the array of options
              // trying to find an occurrence of the options.type in the event
              // name. If it find the type in the event name, it applies those
              // options to the recognizer for events with that name. If it
              // does not find the type in the event name it moves on.

              angular.forEach(recognizerOpts, function (options) {
                if (directiveName === 'hmCustom') {
                  eventName = options.event;
                } else {
                  if (!options.type) {
                    options.type = getRecognizerTypeFromeventName(eventName);
                  }

                  if (options.event) {
                    delete options.event;
                  }
                }

                if (directiveName === 'hmCustom' ||
                    eventName.indexOf(options.type) > -1) {
                  setupRecognizerWithOptions(
                    hammer,
                    applyManagerOptions(managerOpts, options),
                    element);
                }
              });
            } else if (angular.isObject(recognizerOpts)) {
              // Recognizer options may be stored as an object. In this case,
              // Angular Hammer checks to make sure that the options type
              // property is found in the event name. If the options are
              // designated for this general type of event, Angular Hammer
              // applies the options directly to the manager instance for
              // this element.

              if (directiveName === 'hmCustom') {
                eventName = recognizerOpts.event;
              } else {
                  if (!recognizerOpts.type) {
                    recognizerOpts.type = getRecognizerTypeFromeventName(eventName);
                  }

                  if (recognizerOpts.event) {
                    delete recognizerOpts.event;
                  }
              }

              if (directiveName === 'hmCustom' ||
                  eventName.indexOf(recognizerOpts.type) > -1) {
                setupRecognizerWithOptions(
                  hammer,
                  applyManagerOptions(managerOpts, recognizerOpts),
                  element);
              }
            } else if (directiveName !== 'hmCustom') {
              // If no options are supplied, or the supplied options do not
              // match any of the above conditions, Angular Hammer sets up
              // the default options that a manager instantiated using
              // Hammer() would have.

              recognizerOpts = {
                'type': getRecognizerTypeFromeventName(eventName)
              };

              if (directiveName === 'hmDoubletap') {
                recognizerOpts.event = eventName;
                recognizerOpts.taps = 2;

                if (hammer.get('tap')) {
                  recognizerOpts.recognizeWith = 'tap';
                }
              }

              if (recognizerOpts.type.indexOf('pan') > -1 &&
                  hammer.get('swipe')) {
                recognizerOpts.recognizeWith = 'swipe';
              }

              if (recognizerOpts.type.indexOf('pinch') > -1 &&
                  hammer.get('rotate')) {
                recognizerOpts.recognizeWith = 'rotate';
              }

              setupRecognizerWithOptions(
                hammer,
                applyManagerOptions(managerOpts, recognizerOpts),
                element);
            } else {
              eventName = null;
            }

            if (eventName) {
              hammer.on(eventName, handler);
            }
          }
        };
      }]);
  });

  // ---- Private Functions -----

  /**
   * Adds a gesture recognizer to a given manager. The type of recognizer to
   * add is determined by the value of the options.type property.
   *
   * @param {Object}  manager Hammer.js manager object assigned to an element
   * @param {Object}  options Options that define the recognizer to add
   * @return {Object} Reference to the new gesture recognizer, if successful,
   *                  null otherwise.
   */
  function addRecognizer (manager, options) {
    if (!manager || !options || !options.type) { return null; }

    var recognizer;

    if (options.type.indexOf('pan') > -1) {
      recognizer = new Hammer.Pan(options);
    } else if (options.type.indexOf('pinch') > -1) {
      recognizer = new Hammer.Pinch(options);
    } else if (options.type.indexOf('press') > -1) {
      recognizer = new Hammer.Press(options);
    } else if (options.type.indexOf('rotate') > -1) {
      recognizer = new Hammer.Rotate(options);
    } else if (options.type.indexOf('swipe') > -1) {
      recognizer = new Hammer.Swipe(options);
    } else {
      recognizer = new Hammer.Tap(options);
    }

    manager.add(recognizer);
    return recognizer;
  }

  /**
   * Applies certain manager options to individual recognizer options.
   *
   * @param  {Object} managerOpts    Manager options
   * @param  {Object} recognizerOpts Recognizer options
   * @return None
   */
  function applyManagerOptions (managerOpts, recognizerOpts) {
    if (managerOpts) {
      recognizerOpts.preventGhosts = managerOpts.preventGhosts;
    }

    return recognizerOpts;
  }

  /**
   * Extracts the type of recognizer that should be instantiated from a given
   * event name. Used only when no recognizer options are provided.
   *
   * @param  {String} eventName Name to derive the recognizer type from
   * @return {string}           Type of recognizer that fires events with that name
   */
  function getRecognizerTypeFromeventName (eventName) {
    if (eventName.indexOf('pan') > -1) {
      return 'pan';
    } else if (eventName.indexOf('pinch') > -1) {
      return 'pinch';
    } else if (eventName.indexOf('press') > -1) {
      return 'press';
    } else if (eventName.indexOf('rotate') > -1) {
      return 'rotate';
    } else if (eventName.indexOf('swipe') > -1) {
      return 'swipe';
    } else {
      return 'tap';
    }
  }

  /**
   * Applies the passed options object to the appropriate gesture recognizer.
   * Recognizers are created if they do not already exist. See the README for a
   * description of the options object that can be passed to this function.
   *
   * @param  {Object} manager Hammer.js manager object assigned to an element
   * @param  {Object} options Options applied to a recognizer managed by manager
   * @return None
   */
  function setupRecognizerWithOptions (manager, options, element) {
    if (!manager || !options) { return; }

    var recognizer = manager.get(options.type);

    if (!recognizer) {
      recognizer = addRecognizer(manager, options);
    }

    if (!options.directions) {
      if (options.type === 'pan' || options.type === 'swipe') {
        options.directions = 'DIRECTION_ALL';
      } else if (options.type.indexOf('left') > -1) {
        options.directions = 'DIRECTION_LEFT';
      } else if (options.type.indexOf('right') > -1) {
        options.directions = 'DIRECTION_RIGHT';
      } else if (options.type.indexOf('up') > -1) {
        options.directions = 'DIRECTION_UP';
      } else if (options.type.indexOf('down') > -1) {
        options.directions = 'DIRECTION_DOWN';
      } else {
        options.directions = '';
      }
    }

    options.direction = parseDirections(options.directions);
    recognizer.set(options);

    if (options.recognizeWith) {
      if (!manager.get(options.recognizeWith)){
        addRecognizer(manager, {type:options.recognizeWith});
      }

      recognizer.recognizeWith(manager.get(options.recognizeWith));
    }

    if (options.dropRecognizeWith && manager.get(options.dropRecognizeWith)) {
      recognizer.dropRecognizeWith(manager.get(options.dropRecognizeWith));
    }

    if (options.requireFailure) {
      if (!manager.get(options.requireFailure)){
        addRecognizer(manager, {type:options.requireFailure});
      }

      recognizer.requireFailure(manager.get(options.requireFailure));
    }

    if (options.dropRequireFailure && manager.get(options.dropRequireFailure)) {
      recognizer.dropRequireFailure(manager.get(options.dropRequireFailure));
    }

    if (options.preventGhosts && element) {
      preventGhosts(element);
    }
  }

  /**
   * Parses the value of the directions property of any Angular Hammer options
   * object and converts them into the standard Hammer.js directions values.
   *
   * @param  {String} dirs Direction names separated by '|' characters
   * @return {Number}      Hammer.js direction value
   */
  function parseDirections (dirs) {
    var directions = 0;

    angular.forEach(dirs.split('|'), function (direction) {
      if (Hammer.hasOwnProperty(direction)) {
        directions = directions | Hammer[direction];
      }
    });

    return directions;
  }

  // ---- Preventing Ghost Clicks ----

  /**
   * Modified from: https://gist.github.com/jtangelder/361052976f044200ea17
   *
   * Prevent click events after a touchend.
   *
   * Inspired/copy-paste from this article of Google by Ryan Fioravanti
   * https://developers.google.com/mobile/articles/fast_buttons#ghost
   */

  function preventGhosts (element) {
    if (!element) { return; }

    var coordinates = [],
        threshold = 25,
        timeout = 2500;

    if ('ontouchstart' in window) {
      element[0].addEventListener('touchstart', resetCoordinates, true);
      element[0].addEventListener('touchend', registerCoordinates, true);
      element[0].addEventListener('click', preventGhostClick, true);
      element[0].addEventListener('mouseup', preventGhostClick, true);
    }

    /**
     * prevent clicks if they're in a registered XY region
     * @param {MouseEvent} ev
     */
    function preventGhostClick (ev) {
      for (var i = 0; i < coordinates.length; i++) {
        var x = coordinates[i][0];
        var y = coordinates[i][1];

        // within the range, so prevent the click
        if (Math.abs(ev.clientX - x) < threshold &&
            Math.abs(ev.clientY - y) < threshold) {
          ev.stopPropagation();
          ev.preventDefault();
          break;
        }
      }
    }

    /**
     * reset the coordinates array
     */
    function resetCoordinates () {
      coordinates = [];
    }

    /**
     * remove the first coordinates set from the array
     */
    function popCoordinates () {
      coordinates.splice(0, 1);
    }

    /**
     * if it is an final touchend, we want to register it's place
     * @param {TouchEvent} ev
     */
    function registerCoordinates (ev) {
      // touchend is triggered on every releasing finger
      // changed touches always contain the removed touches on a touchend
      // the touches object might contain these also at some browsers (firefox os)
      // so touches - changedTouches will be 0 or lower, like -1, on the final touchend
      if(ev.touches.length - ev.changedTouches.length <= 0) {
        var touch = ev.changedTouches[0];
        coordinates.push([touch.clientX, touch.clientY]);

        setTimeout(popCoordinates, timeout);
      }
    }
  }
})(window, window.angular, window.Hammer);

/*
 AngularJS v1.4.7
 (c) 2010-2015 Google, Inc. http://angularjs.org
 License: MIT
*/
(function(G,t,Ra){'use strict';function va(a,b,c){if(!a)throw ngMinErr("areq",b||"?",c||"required");return a}function wa(a,b){if(!a&&!b)return"";if(!a)return b;if(!b)return a;W(a)&&(a=a.join(" "));W(b)&&(b=b.join(" "));return a+" "+b}function Ha(a){var b={};a&&(a.to||a.from)&&(b.to=a.to,b.from=a.from);return b}function S(a,b,c){var d="";a=W(a)?a:a&&M(a)&&a.length?a.split(/\s+/):[];q(a,function(a,u){a&&0<a.length&&(d+=0<u?" ":"",d+=c?b+a:a+b)});return d}function Ia(a){if(a instanceof J)switch(a.length){case 0:return[];
case 1:if(1===a[0].nodeType)return a;break;default:return J(la(a))}if(1===a.nodeType)return J(a)}function la(a){if(!a[0])return a;for(var b=0;b<a.length;b++){var c=a[b];if(1==c.nodeType)return c}}function Ja(a,b,c){q(b,function(b){a.addClass(b,c)})}function Ka(a,b,c){q(b,function(b){a.removeClass(b,c)})}function P(a){return function(b,c){c.addClass&&(Ja(a,b,c.addClass),c.addClass=null);c.removeClass&&(Ka(a,b,c.removeClass),c.removeClass=null)}}function ha(a){a=a||{};if(!a.$$prepared){var b=a.domOperation||
L;a.domOperation=function(){a.$$domOperationFired=!0;b();b=L};a.$$prepared=!0}return a}function da(a,b){xa(a,b);ya(a,b)}function xa(a,b){b.from&&(a.css(b.from),b.from=null)}function ya(a,b){b.to&&(a.css(b.to),b.to=null)}function Q(a,b,c){var d=(b.addClass||"")+" "+(c.addClass||""),g=(b.removeClass||"")+" "+(c.removeClass||"");a=La(a.attr("class"),d,g);c.preparationClasses&&(b.preparationClasses=X(c.preparationClasses,b.preparationClasses),delete c.preparationClasses);d=b.domOperation!==L?b.domOperation:
null;za(b,c);d&&(b.domOperation=d);b.addClass=a.addClass?a.addClass:null;b.removeClass=a.removeClass?a.removeClass:null;return b}function La(a,b,c){function d(a){M(a)&&(a=a.split(" "));var b={};q(a,function(a){a.length&&(b[a]=!0)});return b}var g={};a=d(a);b=d(b);q(b,function(a,b){g[b]=1});c=d(c);q(c,function(a,b){g[b]=1===g[b]?null:-1});var u={addClass:"",removeClass:""};q(g,function(b,c){var g,d;1===b?(g="addClass",d=!a[c]):-1===b&&(g="removeClass",d=a[c]);d&&(u[g].length&&(u[g]+=" "),u[g]+=c)});
return u}function H(a){return a instanceof t.element?a[0]:a}function Ma(a,b,c){var d="";b&&(d=S(b,"ng-",!0));c.addClass&&(d=X(d,S(c.addClass,"-add")));c.removeClass&&(d=X(d,S(c.removeClass,"-remove")));d.length&&(c.preparationClasses=d,a.addClass(d))}function ia(a,b){var c=b?"-"+b+"s":"";ea(a,[fa,c]);return[fa,c]}function ma(a,b){var c=b?"paused":"",d=T+"PlayState";ea(a,[d,c]);return[d,c]}function ea(a,b){a.style[b[0]]=b[1]}function X(a,b){return a?b?a+" "+b:a:b}function Aa(a,b,c){var d=Object.create(null),
g=a.getComputedStyle(b)||{};q(c,function(a,b){var c=g[a];if(c){var f=c.charAt(0);if("-"===f||"+"===f||0<=f)c=Na(c);0===c&&(c=null);d[b]=c}});return d}function Na(a){var b=0;a=a.split(/\s*,\s*/);q(a,function(a){"s"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));a=parseFloat(a)||0;b=b?Math.max(a,b):a});return b}function na(a){return 0===a||null!=a}function Ba(a,b){var c=N,d=a+"s";b?c+="Duration":d+=" linear all";return[c,d]}function Ca(){var a=Object.create(null);return{flush:function(){a=Object.create(null)},
count:function(b){return(b=a[b])?b.total:0},get:function(b){return(b=a[b])&&b.value},put:function(b,c){a[b]?a[b].total++:a[b]={total:1,value:c}}}}function Da(a,b,c){q(c,function(c){a[c]=U(a[c])?a[c]:b.style.getPropertyValue(c)})}var L=t.noop,za=t.extend,J=t.element,q=t.forEach,W=t.isArray,M=t.isString,oa=t.isObject,pa=t.isUndefined,U=t.isDefined,Ea=t.isFunction,qa=t.isElement,N,ra,T,sa;pa(G.ontransitionend)&&U(G.onwebkittransitionend)?(N="WebkitTransition",ra="webkitTransitionEnd transitionend"):
(N="transition",ra="transitionend");pa(G.onanimationend)&&U(G.onwebkitanimationend)?(T="WebkitAnimation",sa="webkitAnimationEnd animationend"):(T="animation",sa="animationend");var ja=T+"Delay",ta=T+"Duration",fa=N+"Delay";G=N+"Duration";var Oa={transitionDuration:G,transitionDelay:fa,transitionProperty:N+"Property",animationDuration:ta,animationDelay:ja,animationIterationCount:T+"IterationCount"},Pa={transitionDuration:G,transitionDelay:fa,animationDuration:ta,animationDelay:ja};t.module("ngAnimate",
[]).directive("ngAnimateChildren",[function(){return function(a,b,c){a=c.ngAnimateChildren;t.isString(a)&&0===a.length?b.data("$$ngAnimateChildren",!0):c.$observe("ngAnimateChildren",function(a){b.data("$$ngAnimateChildren","on"===a||"true"===a)})}}]).factory("$$rAFScheduler",["$$rAF",function(a){function b(a){d=d.concat(a);c()}function c(){if(d.length){for(var b=d.shift(),z=0;z<b.length;z++)b[z]();g||a(function(){g||c()})}}var d,g;d=b.queue=[];b.waitUntilQuiet=function(b){g&&g();g=a(function(){g=
null;b();c()})};return b}]).factory("$$AnimateRunner",["$q","$sniffer","$$animateAsyncRun",function(a,b,c){function d(a){this.setHost(a);this._doneCallbacks=[];this._runInAnimationFrame=c();this._state=0}d.chain=function(a,b){function c(){if(d===a.length)b(!0);else a[d](function(a){!1===a?b(!1):(d++,c())})}var d=0;c()};d.all=function(a,b){function c(z){f=f&&z;++d===a.length&&b(f)}var d=0,f=!0;q(a,function(a){a.done(c)})};d.prototype={setHost:function(a){this.host=a||{}},done:function(a){2===this._state?
a():this._doneCallbacks.push(a)},progress:L,getPromise:function(){if(!this.promise){var b=this;this.promise=a(function(a,c){b.done(function(b){!1===b?c():a()})})}return this.promise},then:function(a,b){return this.getPromise().then(a,b)},"catch":function(a){return this.getPromise()["catch"](a)},"finally":function(a){return this.getPromise()["finally"](a)},pause:function(){this.host.pause&&this.host.pause()},resume:function(){this.host.resume&&this.host.resume()},end:function(){this.host.end&&this.host.end();
this._resolve(!0)},cancel:function(){this.host.cancel&&this.host.cancel();this._resolve(!1)},complete:function(a){var b=this;0===b._state&&(b._state=1,b._runInAnimationFrame(function(){b._resolve(a)}))},_resolve:function(a){2!==this._state&&(q(this._doneCallbacks,function(b){b(a)}),this._doneCallbacks.length=0,this._state=2)}};return d}]).factory("$$animateAsyncRun",["$$rAF",function(a){function b(b){c.push(b);1<c.length||a(function(){for(var a=0;a<c.length;a++)c[a]();c=[]})}var c=[];return function(){var a=
!1;b(function(){a=!0});return function(c){a?c():b(c)}}}]).provider("$$animateQueue",["$animateProvider",function(a){function b(a,b,c,q){return d[a].some(function(a){return a(b,c,q)})}function c(a,b){a=a||{};var c=0<(a.addClass||"").length,d=0<(a.removeClass||"").length;return b?c&&d:c||d}var d=this.rules={skip:[],cancel:[],join:[]};d.join.push(function(a,b,d){return!b.structural&&c(b.options)});d.skip.push(function(a,b,d){return!b.structural&&!c(b.options)});d.skip.push(function(a,b,c){return"leave"==
c.event&&b.structural});d.skip.push(function(a,b,c){return c.structural&&2===c.state&&!b.structural});d.cancel.push(function(a,b,c){return c.structural&&b.structural});d.cancel.push(function(a,b,c){return 2===c.state&&b.structural});d.cancel.push(function(a,b,c){a=b.options;c=c.options;return a.addClass&&a.addClass===c.removeClass||a.removeClass&&a.removeClass===c.addClass});this.$get=["$$rAF","$rootScope","$rootElement","$document","$$HashMap","$$animation","$$AnimateRunner","$templateRequest","$$jqLite",
"$$forceReflow",function(d,u,z,x,f,k,$,t,h,I){function A(){var a=!1;return function(b){a?b():u.$$postDigest(function(){a=!0;b()})}}function Y(a,b){var c=H(a),e=[],d=v[b];d&&q(d,function(a){a.node.contains(c)&&e.push(a.callback)});return e}function E(a,e,l){function n(b,c,e,v){z(function(){var b=Y(a,c);b.length&&d(function(){q(b,function(b){b(a,e,v)})})});b.progress(c,e,v)}function v(b){var c=a,e=l;e.preparationClasses&&(c.removeClass(e.preparationClasses),e.preparationClasses=null);e.activeClasses&&
(c.removeClass(e.activeClasses),e.activeClasses=null);Ga(a,l);da(a,l);l.domOperation();f.complete(!b)}var s,C;if(a=Ia(a))s=H(a),C=a.parent();l=ha(l);var f=new $,z=A();W(l.addClass)&&(l.addClass=l.addClass.join(" "));l.addClass&&!M(l.addClass)&&(l.addClass=null);W(l.removeClass)&&(l.removeClass=l.removeClass.join(" "));l.removeClass&&!M(l.removeClass)&&(l.removeClass=null);l.from&&!oa(l.from)&&(l.from=null);l.to&&!oa(l.to)&&(l.to=null);if(!s)return v(),f;var h=[s.className,l.addClass,l.removeClass].join(" ");
if(!Qa(h))return v(),f;var E=0<=["enter","move","leave"].indexOf(e),x=!F||D.get(s),h=!x&&m.get(s)||{},I=!!h.state;x||I&&1==h.state||(x=!ka(a,C,e));if(x)return v(),f;E&&w(a);C={structural:E,element:a,event:e,close:v,options:l,runner:f};if(I){if(b("skip",a,C,h)){if(2===h.state)return v(),f;Q(a,h.options,l);return h.runner}if(b("cancel",a,C,h))if(2===h.state)h.runner.end();else if(h.structural)h.close();else return Q(a,h.options,C.options),h.runner;else if(b("join",a,C,h))if(2===h.state)Q(a,l,{});else return Ma(a,
E?e:null,l),e=C.event=h.event,l=Q(a,h.options,C.options),h.runner}else Q(a,l,{});(I=C.structural)||(I="animate"===C.event&&0<Object.keys(C.options.to||{}).length||c(C.options));if(!I)return v(),y(a),f;var t=(h.counter||0)+1;C.counter=t;r(a,1,C);u.$$postDigest(function(){var b=m.get(s),d=!b,b=b||{},h=0<(a.parent()||[]).length&&("animate"===b.event||b.structural||c(b.options));if(d||b.counter!==t||!h){d&&(Ga(a,l),da(a,l));if(d||E&&b.event!==e)l.domOperation(),f.end();h||y(a)}else e=!b.structural&&c(b.options,
!0)?"setClass":b.event,r(a,2),b=k(a,e,b.options),b.done(function(b){v(!b);(b=m.get(s))&&b.counter===t&&y(H(a));n(f,e,"close",{})}),f.setHost(b),n(f,e,"start",{})});return f}function w(a){a=H(a).querySelectorAll("[data-ng-animate]");q(a,function(a){var b=parseInt(a.getAttribute("data-ng-animate")),c=m.get(a);switch(b){case 2:c.runner.end();case 1:c&&m.remove(a)}})}function y(a){a=H(a);a.removeAttribute("data-ng-animate");m.remove(a)}function e(a,b){return H(a)===H(b)}function ka(a,b,c){c=J(x[0].body);
var d=e(a,c)||"HTML"===a[0].nodeName,v=e(a,z),n=!1,y;for((a=a.data("$ngAnimatePin"))&&(b=a);b&&b.length;){v||(v=e(b,z));a=b[0];if(1!==a.nodeType)break;var r=m.get(a)||{};n||(n=r.structural||D.get(a));if(pa(y)||!0===y)a=b.data("$$ngAnimateChildren"),U(a)&&(y=a);if(n&&!1===y)break;v||(v=e(b,z),v||(a=b.data("$ngAnimatePin"))&&(b=a));d||(d=e(b,c));b=b.parent()}return(!n||y)&&v&&d}function r(a,b,c){c=c||{};c.state=b;a=H(a);a.setAttribute("data-ng-animate",b);c=(b=m.get(a))?za(b,c):c;m.put(a,c)}var m=new f,
D=new f,F=null,s=u.$watch(function(){return 0===t.totalPendingRequests},function(a){a&&(s(),u.$$postDigest(function(){u.$$postDigest(function(){null===F&&(F=!0)})}))}),v={},n=a.classNameFilter(),Qa=n?function(a){return n.test(a)}:function(){return!0},Ga=P(h);return{on:function(a,b,c){b=la(b);v[a]=v[a]||[];v[a].push({node:b,callback:c})},off:function(a,b,c){function e(a,b,c){var d=la(b);return a.filter(function(a){return!(a.node===d&&(!c||a.callback===c))})}var d=v[a];d&&(v[a]=1===arguments.length?
null:e(d,b,c))},pin:function(a,b){va(qa(a),"element","not an element");va(qa(b),"parentElement","not an element");a.data("$ngAnimatePin",b)},push:function(a,b,c,e){c=c||{};c.domOperation=e;return E(a,b,c)},enabled:function(a,b){var c=arguments.length;if(0===c)b=!!F;else if(qa(a)){var e=H(a),d=D.get(e);1===c?b=!d:(b=!!b)?d&&D.remove(e):D.put(e,!0)}else b=F=!!a;return b}}}]}]).provider("$$animation",["$animateProvider",function(a){function b(a){return a.data("$$animationRunner")}var c=this.drivers=
[];this.$get=["$$jqLite","$rootScope","$injector","$$AnimateRunner","$$HashMap","$$rAFScheduler",function(a,g,u,z,x,f){function k(a){function b(a){if(a.processed)return a;a.processed=!0;var e=a.domNode,d=e.parentNode;f.put(e,a);for(var r;d;){if(r=f.get(d)){r.processed||(r=b(r));break}d=d.parentNode}(r||c).children.push(a);return a}var c={children:[]},d,f=new x;for(d=0;d<a.length;d++){var g=a[d];f.put(g.domNode,a[d]={domNode:g.domNode,fn:g.fn,children:[]})}for(d=0;d<a.length;d++)b(a[d]);return function(a){var b=
[],c=[],d;for(d=0;d<a.children.length;d++)c.push(a.children[d]);a=c.length;var m=0,f=[];for(d=0;d<c.length;d++){var g=c[d];0>=a&&(a=m,m=0,b.push(f),f=[]);f.push(g.fn);g.children.forEach(function(a){m++;c.push(a)});a--}f.length&&b.push(f);return b}(c)}var $=[],t=P(a);return function(h,x,A){function Y(a){a=a.hasAttribute("ng-animate-ref")?[a]:a.querySelectorAll("[ng-animate-ref]");var b=[];q(a,function(a){var c=a.getAttribute("ng-animate-ref");c&&c.length&&b.push(a)});return b}function E(a){var b=[],
c={};q(a,function(a,e){var d=H(a.element),v=0<=["enter","move"].indexOf(a.event),d=a.structural?Y(d):[];if(d.length){var m=v?"to":"from";q(d,function(a){var b=a.getAttribute("ng-animate-ref");c[b]=c[b]||{};c[b][m]={animationID:e,element:J(a)}})}else b.push(a)});var e={},d={};q(c,function(c,m){var f=c.from,y=c.to;if(f&&y){var g=a[f.animationID],r=a[y.animationID],s=f.animationID.toString();if(!d[s]){var h=d[s]={structural:!0,beforeStart:function(){g.beforeStart();r.beforeStart()},close:function(){g.close();
r.close()},classes:w(g.classes,r.classes),from:g,to:r,anchors:[]};h.classes.length?b.push(h):(b.push(g),b.push(r))}d[s].anchors.push({out:f.element,"in":y.element})}else f=f?f.animationID:y.animationID,y=f.toString(),e[y]||(e[y]=!0,b.push(a[f]))});return b}function w(a,b){a=a.split(" ");b=b.split(" ");for(var c=[],e=0;e<a.length;e++){var d=a[e];if("ng-"!==d.substring(0,3))for(var m=0;m<b.length;m++)if(d===b[m]){c.push(d);break}}return c.join(" ")}function y(a){for(var b=c.length-1;0<=b;b--){var e=
c[b];if(u.has(e)&&(e=u.get(e)(a)))return e}}function e(a,c){a.from&&a.to?(b(a.from.element).setHost(c),b(a.to.element).setHost(c)):b(a.element).setHost(c)}function ka(){var a=b(h);!a||"leave"===x&&A.$$domOperationFired||a.end()}function r(b){h.off("$destroy",ka);h.removeData("$$animationRunner");t(h,A);da(h,A);A.domOperation();s&&a.removeClass(h,s);h.removeClass("ng-animate");D.complete(!b)}A=ha(A);var m=0<=["enter","move","leave"].indexOf(x),D=new z({end:function(){r()},cancel:function(){r(!0)}});
if(!c.length)return r(),D;h.data("$$animationRunner",D);var F=wa(h.attr("class"),wa(A.addClass,A.removeClass)),s=A.tempClasses;s&&(F+=" "+s,A.tempClasses=null);$.push({element:h,classes:F,event:x,structural:m,options:A,beforeStart:function(){h.addClass("ng-animate");s&&a.addClass(h,s)},close:r});h.on("$destroy",ka);if(1<$.length)return D;g.$$postDigest(function(){var a=[];q($,function(c){b(c.element)?a.push(c):c.close()});$.length=0;var c=E(a),d=[];q(c,function(a){d.push({domNode:H(a.from?a.from.element:
a.element),fn:function(){a.beforeStart();var c,d=a.close;if(b(a.anchors?a.from.element||a.to.element:a.element)){var m=y(a);m&&(c=m.start)}c?(c=c(),c.done(function(a){d(!a)}),e(a,c)):d()}})});f(k(d))});return D}}]}]).provider("$animateCss",["$animateProvider",function(a){var b=Ca(),c=Ca();this.$get=["$window","$$jqLite","$$AnimateRunner","$timeout","$$forceReflow","$sniffer","$$rAFScheduler","$animate",function(a,g,u,z,x,f,k,t){function Fa(a,b){var c=a.parentNode;return(c.$$ngAnimateParentKey||(c.$$ngAnimateParentKey=
++E))+"-"+a.getAttribute("class")+"-"+b}function h(f,e,h,r){var m;0<b.count(h)&&(m=c.get(h),m||(e=S(e,"-stagger"),g.addClass(f,e),m=Aa(a,f,r),m.animationDuration=Math.max(m.animationDuration,0),m.transitionDuration=Math.max(m.transitionDuration,0),g.removeClass(f,e),c.put(h,m)));return m||{}}function I(a){w.push(a);k.waitUntilQuiet(function(){b.flush();c.flush();for(var a=x(),d=0;d<w.length;d++)w[d](a);w.length=0})}function A(c,e,f){e=b.get(f);e||(e=Aa(a,c,Oa),"infinite"===e.animationIterationCount&&
(e.animationIterationCount=1));b.put(f,e);c=e;f=c.animationDelay;e=c.transitionDelay;c.maxDelay=f&&e?Math.max(f,e):f||e;c.maxDuration=Math.max(c.animationDuration*c.animationIterationCount,c.transitionDuration);return c}var Y=P(g),E=0,w=[];return function(a,c){function d(){m()}function r(){m(!0)}function m(b){if(!(E||ua&&l)){E=!0;l=!1;c.$$skipPreparationClasses||g.removeClass(a,Z);g.removeClass(a,X);ma(n,!1);ia(n,!1);q(w,function(a){n.style[a[0]]=""});Y(a,c);da(a,c);Object.keys(v).length&&q(v,function(a,
b){a?n.style.setProperty(b,a):n.style.removeProperty(b)});if(c.onDone)c.onDone();G&&G.complete(!b)}}function D(a){p.blockTransition&&ia(n,a);p.blockKeyframeAnimation&&ma(n,!!a)}function F(){G=new u({end:d,cancel:r});I(L);m();return{$$willAnimate:!1,start:function(){return G},end:d}}function s(){function b(){if(!E){D(!1);q(w,function(a){n.style[a[0]]=a[1]});Y(a,c);g.addClass(a,X);if(p.recalculateTimingStyles){ga=n.className+" "+Z;aa=Fa(n,ga);B=A(n,ga,aa);V=B.maxDelay;C=Math.max(V,0);K=B.maxDuration;
if(0===K){m();return}p.hasTransitions=0<B.transitionDuration;p.hasAnimations=0<B.animationDuration}p.applyAnimationDelay&&(V="boolean"!==typeof c.delay&&na(c.delay)?parseFloat(c.delay):V,C=Math.max(V,0),B.animationDelay=V,ca=[ja,V+"s"],w.push(ca),n.style[ca[0]]=ca[1]);M=1E3*C;P=1E3*K;if(c.easing){var s,k=c.easing;p.hasTransitions&&(s=N+"TimingFunction",w.push([s,k]),n.style[s]=k);p.hasAnimations&&(s=T+"TimingFunction",w.push([s,k]),n.style[s]=k)}B.transitionDuration&&h.push(ra);B.animationDuration&&
h.push(sa);r=Date.now();var l=M+1.5*P;s=r+l;var k=a.data("$$animateCss")||[],x=!0;if(k.length){var F=k[0];(x=s>F.expectedEndTime)?z.cancel(F.timer):k.push(m)}x&&(l=z(d,l,!1),k[0]={timer:l,expectedEndTime:s},k.push(m),a.data("$$animateCss",k));a.on(h.join(" "),f);c.to&&(c.cleanupStyles&&Da(v,n,Object.keys(c.to)),ya(a,c))}}function d(){var b=a.data("$$animateCss");if(b){for(var c=1;c<b.length;c++)b[c]();a.removeData("$$animateCss")}}function f(a){a.stopPropagation();var b=a.originalEvent||a;a=b.$manualTimeStamp||
b.timeStamp||Date.now();b=parseFloat(b.elapsedTime.toFixed(3));Math.max(a-r,0)>=M&&b>=K&&(ua=!0,m())}if(!E)if(n.parentNode){var r,h=[],s=function(a){if(ua)l&&a&&(l=!1,m());else if(l=!a,B.animationDuration)if(a=ma(n,l),l)w.push(a);else{var b=w,c=b.indexOf(a);0<=a&&b.splice(c,1)}},k=0<U&&(B.transitionDuration&&0===R.transitionDuration||B.animationDuration&&0===R.animationDuration)&&Math.max(R.animationDelay,R.transitionDelay);k?z(b,Math.floor(k*U*1E3),!1):b();J.resume=function(){s(!0)};J.pause=function(){s(!1)}}else m()}
var v={},n=H(a);if(!n||!n.parentNode||!t.enabled())return F();c=ha(c);var w=[],x=a.attr("class"),k=Ha(c),E,l,ua,G,J,C,M,K,P;if(0===c.duration||!f.animations&&!f.transitions)return F();var ba=c.event&&W(c.event)?c.event.join(" "):c.event,Q="",O="";ba&&c.structural?Q=S(ba,"ng-",!0):ba&&(Q=ba);c.addClass&&(O+=S(c.addClass,"-add"));c.removeClass&&(O.length&&(O+=" "),O+=S(c.removeClass,"-remove"));c.applyClassesEarly&&O.length&&Y(a,c);var Z=[Q,O].join(" ").trim(),ga=x+" "+Z,X=S(Z,"-active"),x=k.to&&0<
Object.keys(k.to).length;if(!(0<(c.keyframeStyle||"").length||x||Z))return F();var aa,R;0<c.stagger?(k=parseFloat(c.stagger),R={transitionDelay:k,animationDelay:k,transitionDuration:0,animationDuration:0}):(aa=Fa(n,ga),R=h(n,Z,aa,Pa));c.$$skipPreparationClasses||g.addClass(a,Z);c.transitionStyle&&(k=[N,c.transitionStyle],ea(n,k),w.push(k));0<=c.duration&&(k=0<n.style[N].length,k=Ba(c.duration,k),ea(n,k),w.push(k));c.keyframeStyle&&(k=[T,c.keyframeStyle],ea(n,k),w.push(k));var U=R?0<=c.staggerIndex?
c.staggerIndex:b.count(aa):0;(ba=0===U)&&!c.skipBlocking&&ia(n,9999);var B=A(n,ga,aa),V=B.maxDelay;C=Math.max(V,0);K=B.maxDuration;var p={};p.hasTransitions=0<B.transitionDuration;p.hasAnimations=0<B.animationDuration;p.hasTransitionAll=p.hasTransitions&&"all"==B.transitionProperty;p.applyTransitionDuration=x&&(p.hasTransitions&&!p.hasTransitionAll||p.hasAnimations&&!p.hasTransitions);p.applyAnimationDuration=c.duration&&p.hasAnimations;p.applyTransitionDelay=na(c.delay)&&(p.applyTransitionDuration||
p.hasTransitions);p.applyAnimationDelay=na(c.delay)&&p.hasAnimations;p.recalculateTimingStyles=0<O.length;if(p.applyTransitionDuration||p.applyAnimationDuration)K=c.duration?parseFloat(c.duration):K,p.applyTransitionDuration&&(p.hasTransitions=!0,B.transitionDuration=K,k=0<n.style[N+"Property"].length,w.push(Ba(K,k))),p.applyAnimationDuration&&(p.hasAnimations=!0,B.animationDuration=K,w.push([ta,K+"s"]));if(0===K&&!p.recalculateTimingStyles)return F();if(null!=c.delay){var ca=parseFloat(c.delay);
p.applyTransitionDelay&&w.push([fa,ca+"s"]);p.applyAnimationDelay&&w.push([ja,ca+"s"])}null==c.duration&&0<B.transitionDuration&&(p.recalculateTimingStyles=p.recalculateTimingStyles||ba);M=1E3*C;P=1E3*K;c.skipBlocking||(p.blockTransition=0<B.transitionDuration,p.blockKeyframeAnimation=0<B.animationDuration&&0<R.animationDelay&&0===R.animationDuration);c.from&&(c.cleanupStyles&&Da(v,n,Object.keys(c.from)),xa(a,c));p.blockTransition||p.blockKeyframeAnimation?D(K):c.skipBlocking||ia(n,!1);return{$$willAnimate:!0,
end:d,start:function(){if(!E)return J={end:d,cancel:r,resume:null,pause:null},G=new u(J),I(s),G}}}}]}]).provider("$$animateCssDriver",["$$animationProvider",function(a){a.drivers.push("$$animateCssDriver");this.$get=["$animateCss","$rootScope","$$AnimateRunner","$rootElement","$sniffer","$$jqLite","$document",function(a,c,d,g,u,z,x){function f(a){return a.replace(/\bng-\S+\b/g,"")}function k(a,b){M(a)&&(a=a.split(" "));M(b)&&(b=b.split(" "));return a.filter(function(a){return-1===b.indexOf(a)}).join(" ")}
function t(c,h,g){function x(a){var b={},c=H(a).getBoundingClientRect();q(["width","height","top","left"],function(a){var d=c[a];switch(a){case "top":d+=I.scrollTop;break;case "left":d+=I.scrollLeft}b[a]=Math.floor(d)+"px"});return b}function e(){var c=f(g.attr("class")||""),d=k(c,m),c=k(m,c),d=a(r,{to:x(g),addClass:"ng-anchor-in "+d,removeClass:"ng-anchor-out "+c,delay:!0});return d.$$willAnimate?d:null}function z(){r.remove();h.removeClass("ng-animate-shim");g.removeClass("ng-animate-shim")}var r=
J(H(h).cloneNode(!0)),m=f(r.attr("class")||"");h.addClass("ng-animate-shim");g.addClass("ng-animate-shim");r.addClass("ng-anchor");A.append(r);var D;c=function(){var c=a(r,{addClass:"ng-anchor-out",delay:!0,from:x(h)});return c.$$willAnimate?c:null}();if(!c&&(D=e(),!D))return z();var F=c||D;return{start:function(){function a(){c&&c.end()}var b,c=F.start();c.done(function(){c=null;if(!D&&(D=e()))return c=D.start(),c.done(function(){c=null;z();b.complete()}),c;z();b.complete()});return b=new d({end:a,
cancel:a})}}}function G(a,b,c,f){var e=h(a,L),g=h(b,L),k=[];q(f,function(a){(a=t(c,a.out,a["in"]))&&k.push(a)});if(e||g||0!==k.length)return{start:function(){function a(){q(b,function(a){a.end()})}var b=[];e&&b.push(e.start());g&&b.push(g.start());q(k,function(a){b.push(a.start())});var c=new d({end:a,cancel:a});d.all(b,function(a){c.complete(a)});return c}}}function h(c){var d=c.element,f=c.options||{};c.structural&&(f.event=c.event,f.structural=!0,f.applyClassesEarly=!0,"leave"===c.event&&(f.onDone=
f.domOperation));f.preparationClasses&&(f.event=X(f.event,f.preparationClasses));c=a(d,f);return c.$$willAnimate?c:null}if(!u.animations&&!u.transitions)return L;var I=x[0].body;c=H(g);var A=J(c.parentNode&&11===c.parentNode.nodeType||I.contains(c)?c:I);P(z);return function(a){return a.from&&a.to?G(a.from,a.to,a.classes,a.anchors):h(a)}}]}]).provider("$$animateJs",["$animateProvider",function(a){this.$get=["$injector","$$AnimateRunner","$$jqLite",function(b,c,d){function g(c){c=W(c)?c:c.split(" ");
for(var d=[],f={},g=0;g<c.length;g++){var q=c[g],u=a.$$registeredAnimations[q];u&&!f[q]&&(d.push(b.get(u)),f[q]=!0)}return d}var u=P(d);return function(a,b,d,k){function t(){k.domOperation();u(a,k)}function G(a,b,d,f,e){switch(d){case "animate":b=[b,f.from,f.to,e];break;case "setClass":b=[b,A,H,e];break;case "addClass":b=[b,A,e];break;case "removeClass":b=[b,H,e];break;default:b=[b,e]}b.push(f);if(a=a.apply(a,b))if(Ea(a.start)&&(a=a.start()),a instanceof c)a.done(e);else if(Ea(a))return a;return L}
function h(a,b,d,e,f){var g=[];q(e,function(e){var h=e[f];h&&g.push(function(){var e,f,g=!1,k=function(a){g||(g=!0,(f||L)(a),e.complete(!a))};e=new c({end:function(){k()},cancel:function(){k(!0)}});f=G(h,a,b,d,function(a){k(!1===a)});return e})});return g}function I(a,b,d,e,f){var g=h(a,b,d,e,f);if(0===g.length){var k,u;"beforeSetClass"===f?(k=h(a,"removeClass",d,e,"beforeRemoveClass"),u=h(a,"addClass",d,e,"beforeAddClass")):"setClass"===f&&(k=h(a,"removeClass",d,e,"removeClass"),u=h(a,"addClass",
d,e,"addClass"));k&&(g=g.concat(k));u&&(g=g.concat(u))}if(0!==g.length)return function(a){var b=[];g.length&&q(g,function(a){b.push(a())});b.length?c.all(b,a):a();return function(a){q(b,function(b){a?b.cancel():b.end()})}}}3===arguments.length&&oa(d)&&(k=d,d=null);k=ha(k);d||(d=a.attr("class")||"",k.addClass&&(d+=" "+k.addClass),k.removeClass&&(d+=" "+k.removeClass));var A=k.addClass,H=k.removeClass,E=g(d),w,y;if(E.length){var e,J;"leave"==b?(J="leave",e="afterLeave"):(J="before"+b.charAt(0).toUpperCase()+
b.substr(1),e=b);"enter"!==b&&"move"!==b&&(w=I(a,b,k,E,J));y=I(a,b,k,E,e)}if(w||y)return{start:function(){function b(c){f=!0;t();da(a,k);g.complete(c)}var d,e=[];w&&e.push(function(a){d=w(a)});e.length?e.push(function(a){t();a(!0)}):t();y&&e.push(function(a){d=y(a)});var f=!1,g=new c({end:function(){f||((d||L)(void 0),b(void 0))},cancel:function(){f||((d||L)(!0),b(!0))}});c.chain(e,b);return g}}}}]}]).provider("$$animateJsDriver",["$$animationProvider",function(a){a.drivers.push("$$animateJsDriver");
this.$get=["$$animateJs","$$AnimateRunner",function(a,c){function d(c){return a(c.element,c.event,c.classes,c.options)}return function(a){if(a.from&&a.to){var b=d(a.from),t=d(a.to);if(b||t)return{start:function(){function a(){return function(){q(d,function(a){a.end()})}}var d=[];b&&d.push(b.start());t&&d.push(t.start());c.all(d,function(a){g.complete(a)});var g=new c({end:a(),cancel:a()});return g}}}else return d(a)}}]}])})(window,window.angular);
//# sourceMappingURL=angular-animate.min.js.map

/*! 7.2.2 */
!window.XMLHttpRequest||window.FileAPI&&FileAPI.shouldLoad||(window.XMLHttpRequest.prototype.setRequestHeader=function(a){return function(b,c){if("__setXHR_"===b){var d=c(this);d instanceof Function&&d(this)}else a.apply(this,arguments)}}(window.XMLHttpRequest.prototype.setRequestHeader));var ngFileUpload=angular.module("ngFileUpload",[]);ngFileUpload.version="7.2.2",ngFileUpload.service("UploadBase",["$http","$q","$timeout",function(a,b,c){function d(d){d.method=d.method||"POST",d.headers=d.headers||{};var e=b.defer(),f=e.promise;return d.headers.__setXHR_=function(){return function(a){a&&(d.__XHR=a,d.xhrFn&&d.xhrFn(a),a.upload.addEventListener("progress",function(a){a.config=d,e.notify?e.notify(a):f.progressFunc&&c(function(){f.progressFunc(a)})},!1),a.upload.addEventListener("load",function(a){a.lengthComputable&&(a.config=d,e.notify?e.notify(a):f.progressFunc&&c(function(){f.progressFunc(a)}))},!1))}},a(d).then(function(a){e.resolve(a)},function(a){e.reject(a)},function(a){e.notify(a)}),f.success=function(a){return f.then(function(b){a(b.data,b.status,b.headers,d)}),f},f.error=function(a){return f.then(null,function(b){a(b.data,b.status,b.headers,d)}),f},f.progress=function(a){return f.progressFunc=a,f.then(null,null,function(b){a(b)}),f},f.abort=function(){return d.__XHR&&c(function(){d.__XHR.abort()}),f},f.xhr=function(a){return d.xhrFn=function(b){return function(){b&&b.apply(f,arguments),a.apply(f,arguments)}}(d.xhrFn),f},f}this.upload=function(a){function b(c,d,e){if(void 0!==d)if(angular.isDate(d)&&(d=d.toISOString()),angular.isString(d))c.append(e,d);else if("form"===a.sendFieldsAs)if(angular.isObject(d))for(var f in d)d.hasOwnProperty(f)&&b(c,d[f],e+"["+f+"]");else c.append(e,d);else d=angular.isString(d)?d:angular.toJson(d),"json-blob"===a.sendFieldsAs?c.append(e,new Blob([d],{type:"application/json"})):c.append(e,d)}function c(a){return a instanceof Blob||a.flashId&&a.name&&a.size}function e(a,b,d){if(c(b))a.append(d,b,b.fileName||b.name);else{if(!angular.isObject(b))throw"Expected file object in Upload.upload file option: "+b.toString();for(var f in b)if(b.hasOwnProperty(f)){var g=f.split(",");g[1]&&(b[f].fileName=g[1].replace(/^\s+|\s+$/g,"")),e(a,b[f],g[0])}}}return a.headers=a.headers||{},a.headers["Content-Type"]=void 0,a.transformRequest=a.transformRequest?angular.isArray(a.transformRequest)?a.transformRequest:[a.transformRequest]:[],a.transformRequest.push(function(c){var d,f=new FormData,g={};for(d in a.fields)a.fields.hasOwnProperty(d)&&(g[d]=a.fields[d]);c&&(g.data=c);for(d in g)if(g.hasOwnProperty(d)){var h=g[d];a.formDataAppender?a.formDataAppender(f,d,h):b(f,h,d)}if(null!=a.file)if(angular.isArray(a.file))for(var i=0;i<a.file.length;i++)e(f,a.file[i],"file");else e(f,a.file,"file");return f}),d(a)},this.http=function(b){return b.transformRequest=b.transformRequest||function(b){return window.ArrayBuffer&&b instanceof window.ArrayBuffer||b instanceof Blob?b:a.defaults.transformRequest[0].apply(this,arguments)},d(b)},this.setDefaults=function(a){this.defaults=a||{}},this.defaults={},this.version=ngFileUpload.version}]),ngFileUpload.service("Upload",["$parse","$timeout","$compile","UploadResize",function(a,b,c,d){var e=d;return e.getAttrWithDefaults=function(a,b){return null!=a[b]?a[b]:null==e.defaults[b]?e.defaults[b]:e.defaults[b].toString()},e.attrGetter=function(b,c,d,e){if(!d)return this.getAttrWithDefaults(c,b);try{return e?a(this.getAttrWithDefaults(c,b))(d,e):a(this.getAttrWithDefaults(c,b))(d)}catch(f){if(b.search(/min|max|pattern/i))return this.getAttrWithDefaults(c,b);throw f}},e.updateModel=function(c,d,f,g,h,i,j){function k(){var j=h&&h.length?h[0]:null;if(c){var k=!e.attrGetter("ngfMultiple",d,f)&&!e.attrGetter("multiple",d)&&!m;a(e.attrGetter("ngModel",d)).assign(f,k?j:h)}var l=e.attrGetter("ngfModel",d);l&&a(l).assign(f,h),g&&a(g)(f,{$files:h,$file:j,$event:i}),b(function(){})}function l(a,b){var c=e.attrGetter("ngfResize",d,f);if(!c)return b();for(var g=a.length,h=function(){g--,0===g&&b()},i=function(b){return function(c){a.splice(b,1,c),h()}},j=function(a){return function(b){h(),a.$error="resize",a.$errorParam=(b?(b.message?b.message:b)+": ":"")+(a&&a.name)}},k=0;k<a.length;k++){var l=a[k];l.$error||0!==l.type.indexOf("image")?h():e.resize(l,c.width,c.height,c.quality).then(i(k),j(l))}}var m=e.attrGetter("ngfKeep",d,f);if(m===!0){if(!h||!h.length)return;var n=(c&&c.$modelValue||d.$$ngfPrevFiles||[]).slice(0),o=!1;if(e.attrGetter("ngfKeepDistinct",d,f)===!0){for(var p=n.length,q=0;q<h.length;q++){for(var r=0;p>r&&h[q].name!==n[r].name;r++);r===p&&(n.push(h[q]),o=!0)}if(!o)return;h=n}else h=n.concat(h)}d.$$ngfPrevFiles=h,j?k():e.validate(h,c,d,f,e.attrGetter("ngfValidateLater",d),function(){l(h,function(){b(function(){k()})})})},e}]),ngFileUpload.directive("ngfSelect",["$parse","$timeout","$compile","Upload",function(a,b,c,d){function e(a){var b=a.match(/Android[^\d]*(\d+)\.(\d+)/);if(b&&b.length>2){var c=d.defaults.androidFixMinorVersion||4;return parseInt(b[1])<4||parseInt(b[1])===c&&parseInt(b[2])<c}return-1===a.indexOf("Chrome")&&/.*Windows.*Safari.*/.test(a)}function f(a,b,c,d,f,h,i,j){function k(){return"input"===b[0].tagName.toLowerCase()&&c.type&&"file"===c.type.toLowerCase()}function l(){return t("ngfChange")||t("ngfSelect")}function m(b){for(var e=b.__files_||b.target&&b.target.files,f=[],g=0;g<e.length;g++)f.push(e[g]);j.updateModel(d,c,a,l(),f.length?f:null,b)}function n(a){if(b!==a)for(var c=0;c<b[0].attributes.length;c++){var d=b[0].attributes[c];"type"!==d.name&&"class"!==d.name&&"id"!==d.name&&"style"!==d.name&&((null==d.value||""===d.value)&&("required"===d.name&&(d.value="required"),"multiple"===d.name&&(d.value="multiple")),a.attr(d.name,d.value))}}function o(){if(k())return b;var a=angular.element('<input type="file">');return n(a),a.css("visibility","hidden").css("position","absolute").css("overflow","hidden").css("width","0px").css("height","0px").css("border","none").css("margin","0px").css("padding","0px").attr("tabindex","-1"),g.push({el:b,ref:a}),document.body.appendChild(a[0]),a}function p(c){if(b.attr("disabled")||t("ngfSelectDisabled",a))return!1;var d=q(c);return null!=d?d:(r(c),e(navigator.userAgent)?setTimeout(function(){w[0].click()},0):w[0].click(),!1)}function q(a){var b=a.changedTouches||a.originalEvent&&a.originalEvent.changedTouches;if("touchstart"===a.type)return v=b?b[0].clientY:0,!0;if(a.stopPropagation(),a.preventDefault(),"touchend"===a.type){var c=b?b[0].clientY:0;if(Math.abs(c-v)>20)return!1}}function r(b){w.val()&&(w.val(null),j.updateModel(d,c,a,l(),null,b,!0))}function s(a){if(w&&!w.attr("__ngf_ie10_Fix_")){if(!w[0].parentNode)return void(w=null);a.preventDefault(),a.stopPropagation(),w.unbind("click");var b=w.clone();return w.replaceWith(b),w=b,w.attr("__ngf_ie10_Fix_","true"),w.bind("change",m),w.bind("click",s),w[0].click(),!1}w.removeAttr("__ngf_ie10_Fix_")}var t=function(a,b){return j.attrGetter(a,c,b)},u=[];u.push(a.$watch(t("ngfMultiple"),function(){w.attr("multiple",t("ngfMultiple",a))})),u.push(a.$watch(t("ngfCapture"),function(){w.attr("capture",t("ngfCapture",a))})),c.$observe("accept",function(){w.attr("accept",t("accept"))}),u.push(function(){c.$$observers&&delete c.$$observers.accept});var v=0,w=b;k()||(w=o()),w.bind("change",m),k()?b.bind("click",r):b.bind("click touchstart touchend",p),j.registerValidators(d,w,c,a),-1!==navigator.appVersion.indexOf("MSIE 10")&&w.bind("click",s),a.$on("$destroy",function(){k()||w.remove(),angular.forEach(u,function(a){a()})}),h(function(){for(var a=0;a<g.length;a++){var b=g[a];document.body.contains(b.el[0])||(g.splice(a,1),b.ref.remove())}}),window.FileAPI&&window.FileAPI.ngfFixIE&&window.FileAPI.ngfFixIE(b,w,m)}var g=[];return{restrict:"AEC",require:"?ngModel",link:function(e,g,h,i){f(e,g,h,i,a,b,c,d)}}}]),function(){function a(a){return"img"===a.tagName.toLowerCase()?"image":"audio"===a.tagName.toLowerCase()?"audio":"video"===a.tagName.toLowerCase()?"video":/\./}ngFileUpload.service("UploadDataUrl",["UploadBase","$timeout","$q",function(a,b,c){var d=a;return d.dataUrl=function(a,d){if(d&&null!=a.dataUrl||!d&&null!=a.blobUrl){var e=c.defer();return b(function(){e.resolve(d?a.dataUrl:a.blobUrl)}),e.promise}var f=d?a.$ngfDataUrlPromise:a.$ngfBlobUrlPromise;if(f)return f;var g=c.defer();return b(function(){if(window.FileReader&&a&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 8")||a.size<2e4)&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 9")||a.size<4e6)){var c=window.URL||window.webkitURL;if(c&&c.createObjectURL&&!d){var e;try{e=c.createObjectURL(a)}catch(f){return void b(function(){a.blobUrl="",g.reject()})}b(function(){a.blobUrl=e,e&&g.resolve(e)})}else{var h=new FileReader;h.onload=function(c){b(function(){a.dataUrl=c.target.result,g.resolve(c.target.result)})},h.onerror=function(){b(function(){a.dataUrl="",g.reject()})},h.readAsDataURL(a)}}else b(function(){a[d?"dataUrl":"blobUrl"]="",g.reject()})}),f=d?a.$ngfDataUrlPromise=g.promise:a.$ngfBlobUrlPromise=g.promise,f["finally"](function(){delete a[d?"$ngfDataUrlPromise":"$ngfBlobUrlPromise"]}),f},d}]);var b=angular.element("<style>.ngf-hide{display:none !important}</style>");document.getElementsByTagName("head")[0].appendChild(b[0]),ngFileUpload.directive("ngfSrc",["$compile","$timeout","Upload",function(b,c,d){return{restrict:"AE",link:function(b,e,f){c(function(){var g=b.$watch(f.ngfSrc,function(g){if(angular.isString(g))return e.removeClass("ngf-hide"),e.attr("src",g);if(g&&g.type&&0===g.type.indexOf(a(e[0]))){var h=d.attrGetter("ngfNoObjectUrl",f,b);d.dataUrl(g,h)["finally"](function(){c(function(){g.blobUrl||g.dataUrl?(e.removeClass("ngf-hide"),e.attr("src",(h?g.dataUrl:g.blobUrl)||g.dataUrl)):e.addClass("ngf-hide")})})}else e.addClass("ngf-hide")});b.$on("$destroy",function(){g()})})}}}]),ngFileUpload.directive("ngfBackground",["Upload","$compile","$timeout",function(a,b,c){return{restrict:"AE",link:function(b,d,e){c(function(){var f=b.$watch(e.ngfBackground,function(f){if(angular.isString(f))return d.css("background-image","url('"+f+"')");if(f&&f.type&&0===f.type.indexOf("image")){var g=a.attrGetter("ngfNoObjectUrl",e,b);a.dataUrl(f,g)["finally"](function(){c(function(){g&&f.dataUrl||!g&&f.blobUrl?d.css("background-image","url('"+(g?f.dataUrl:f.blobUrl)+"')"):d.css("background-image","")})})}else d.css("background-image","")});b.$on("$destroy",function(){f()})})}}}])}(),ngFileUpload.service("UploadValidate",["UploadDataUrl","$q","$timeout",function(a,b,c){function d(a){if(a.length>2&&"/"===a[0]&&"/"===a[a.length-1])return a.substring(1,a.length-1);var b=a.split(","),c="";if(b.length>1)for(var e=0;e<b.length;e++)c+="("+d(b[e])+")",e<b.length-1&&(c+="|");else 0===a.indexOf(".")&&(a="*"+a),c="^"+a.replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&")+"$",c=c.replace(/\\\*/g,".*").replace(/\\\?/g,".");return c}function e(a){if(angular.isString(a)){if(a.search(/kb/i)===a.length-2)return parseFloat(1e3*a.substring(0,a.length-2));if(a.search(/mb/i)===a.length-2)return parseFloat(1e6*a.substring(0,a.length-2));if(a.search(/gb/i)===a.length-2)return parseFloat(1e9*a.substring(0,a.length-2));if(a.search(/b/i)===a.length-1)return parseFloat(a.substring(0,a.length-1));if(a.search(/s/i)===a.length-1)return parseFloat(a.substring(0,a.length-1));if(a.search(/m/i)===a.length-1)return parseFloat(60*a.substring(0,a.length-1));if(a.search(/h/i)===a.length-1)return parseFloat(3600*a.substring(0,a.length-1))}return a}var f=a;return f.registerValidators=function(a,b,c,d){function e(a){angular.forEach(a.$ngfValidations,function(b){a.$setValidity(b.name,b.valid)})}a&&(a.$ngfValidations=[],a.$formatters.push(function(g){return f.attrGetter("ngfValidateLater",c,d)||!a.$$ngfValidated?(f.validate(g,a,c,d,!1,function(){e(a),a.$$ngfValidated=!1}),g&&0===g.length&&(g=null),!b||null!=g&&0!==g.length||b.val()&&b.val(null)):(e(a),a.$$ngfValidated=!1),g}))},f.validatePattern=function(a,b){if(!b)return!0;var c=new RegExp(d(b),"gi");return null!=a.type&&c.test(a.type.toLowerCase())||null!=a.name&&c.test(a.name.toLowerCase())},f.validate=function(a,b,c,d,g,h){function i(c,d,e){if(a){for(var f="ngf"+c[0].toUpperCase()+c.substr(1),g=a.length,h=null;g--;){var i=a[g],j=k(f,{$file:i});null==j&&(j=d(k("ngfValidate")||{}),h=null==h?!0:h),null!=j&&(e(i,j)||(i.$error=c,i.$errorParam=j,a.splice(g,1),h=!1))}null!==h&&b.$ngfValidations.push({name:c,valid:h})}}function j(c,d,e,f,g){if(a){var i=0,j=!1,m="ngf"+c[0].toUpperCase()+c.substr(1);a=void 0===a.length?[a]:a,angular.forEach(a,function(a){if(0!==a.type.search(e))return!0;var n=k(m,{$file:a})||d(k("ngfValidate",{$file:a})||{});n&&(l++,i++,f(a,n).then(function(b){g(b,n)||(a.$error=c,a.$errorParam=n,j=!0)},function(){k("ngfValidateForce",{$file:a})&&(a.$error=c,a.$errorParam=n,j=!0)})["finally"](function(){l--,i--,i||b.$ngfValidations.push({name:c,valid:!j}),l||h.call(b,b.$ngfValidations)}))})}}b=b||{},b.$ngfValidations=b.$ngfValidations||[],angular.forEach(b.$ngfValidations,function(a){a.valid=!0});var k=function(a,b){return f.attrGetter(a,c,d,b)};if(g)return void h.call(b);if(b.$$ngfValidated=!0,null==a||0===a.length)return void h.call(b);if(a=void 0===a.length?[a]:a.slice(0),i("pattern",function(a){return a.pattern},f.validatePattern),i("minSize",function(a){return a.size&&a.size.min},function(a,b){return a.size>=e(b)}),i("maxSize",function(a){return a.size&&a.size.max},function(a,b){return a.size<=e(b)}),i("validateFn",function(){return null},function(a,b){return b===!0||null===b||""===b}),!a.length)return void h.call(b,b.$ngfValidations);var l=0;j("maxHeight",function(a){return a.height&&a.height.max},/image/,this.imageDimensions,function(a,b){return a.height<=b}),j("minHeight",function(a){return a.height&&a.height.min},/image/,this.imageDimensions,function(a,b){return a.height>=b}),j("maxWidth",function(a){return a.width&&a.width.max},/image/,this.imageDimensions,function(a,b){return a.width<=b}),j("minWidth",function(a){return a.width&&a.width.min},/image/,this.imageDimensions,function(a,b){return a.width>=b}),j("ratio",function(a){return a.ratio},/image/,this.imageDimensions,function(a,b){for(var c=b.toString().split(","),d=!1,e=0;e<c.length;e++){var f=c[e],g=f.search(/x/i);f=g>-1?parseFloat(f.substring(0,g))/parseFloat(f.substring(g+1)):parseFloat(f),Math.abs(a.width/a.height-f)<1e-4&&(d=!0)}return d}),j("maxDuration",function(a){return a.duration&&a.duration.max},/audio|video/,this.mediaDuration,function(a,b){return a<=e(b)}),j("minDuration",function(a){return a.duration&&a.duration.min},/audio|video/,this.mediaDuration,function(a,b){return a>=e(b)}),j("validateAsyncFn",function(){return null},/./,function(a,b){return b},function(a){return a===!0||null===a||""===a}),l||h.call(b,b.$ngfValidations)},f.imageDimensions=function(a){if(a.width&&a.height){var d=b.defer();return c(function(){d.resolve({width:a.width,height:a.height})}),d.promise}if(a.$ngfDimensionPromise)return a.$ngfDimensionPromise;var e=b.defer();return c(function(){return 0!==a.type.indexOf("image")?void e.reject("not image"):void f.dataUrl(a).then(function(b){function d(){var b=h[0].clientWidth,c=h[0].clientHeight;h.remove(),a.width=b,a.height=c,e.resolve({width:b,height:c})}function f(){h.remove(),e.reject("load error")}function g(){c(function(){h[0].parentNode&&(h[0].clientWidth?d():i>10?f():g())},1e3)}var h=angular.element("<img>").attr("src",b).css("visibility","hidden").css("position","fixed");h.on("load",d),h.on("error",f);var i=0;g(),angular.element(document.getElementsByTagName("body")[0]).append(h)},function(){e.reject("load error")})}),a.$ngfDimensionPromise=e.promise,a.$ngfDimensionPromise["finally"](function(){delete a.$ngfDimensionPromise}),a.$ngfDimensionPromise},f.mediaDuration=function(a){if(a.duration){var d=b.defer();return c(function(){d.resolve(a.duration)}),d.promise}if(a.$ngfDurationPromise)return a.$ngfDurationPromise;var e=b.defer();return c(function(){return 0!==a.type.indexOf("audio")&&0!==a.type.indexOf("video")?void e.reject("not media"):void f.dataUrl(a).then(function(b){function d(){var b=h[0].duration;a.duration=b,h.remove(),e.resolve(b)}function f(){h.remove(),e.reject("load error")}function g(){c(function(){h[0].parentNode&&(h[0].duration?d():i>10?f():g())},1e3)}var h=angular.element(0===a.type.indexOf("audio")?"<audio>":"<video>").attr("src",b).css("visibility","none").css("position","fixed");h.on("loadedmetadata",d),h.on("error",f);var i=0;g(),angular.element(document.body).append(h)},function(){e.reject("load error")})}),a.$ngfDurationPromise=e.promise,a.$ngfDurationPromise["finally"](function(){delete a.$ngfDurationPromise}),a.$ngfDurationPromise},f}]),ngFileUpload.service("UploadResize",["UploadValidate","$q","$timeout",function(a,b,c){var d=a,e=function(a,b,c,d){var e=Math.min(c/a,d/b);return{width:a*e,height:b*e}},f=function(a,c,d,f,g){var h=b.defer(),i=document.createElement("canvas"),j=document.createElement("img");return j.onload=function(){try{var a=e(j.width,j.height,c,d);i.width=a.width,i.height=a.height;var b=i.getContext("2d");b.drawImage(j,0,0,a.width,a.height),h.resolve(i.toDataURL(g||"image/WebP",f||1))}catch(k){h.reject(k)}},j.onerror=function(){h.reject()},j.src=a,h.promise},g=function(a){for(var b=a.split(","),c=b[0].match(/:(.*?);/)[1],d=atob(b[1]),e=d.length,f=new Uint8Array(e);e--;)f[e]=d.charCodeAt(e);return new Blob([f],{type:c})};return d.resize=function(a,e,h,i){var j=b.defer();return 0!==a.type.indexOf("image")?(c(function(){j.resolve("Only images are allowed for resizing!")}),j.promise):(d.dataUrl(a,!0).then(function(b){f(b,e,h,i,a.type).then(function(b){var c=g(b);c.name=a.name,j.resolve(c)},function(){j.reject()})},function(){j.reject()}),j.promise)},d}]),function(){function a(a,c,d,e,f,g,h,i){function j(){return c.attr("disabled")||n("ngfDropDisabled",a)}function k(a,b,c,d){var e=n("ngfDragOverClass",a,{$event:c}),f=n("ngfDragOverClass")||"dragover";if(angular.isString(e))return void d(e);if(e&&(e.delay&&(r=e.delay),e.accept||e.reject)){var g=c.dataTransfer.items;if(null!=g)for(var h=n("ngfPattern",a,{$event:c}),j=0;j<g.length;j++)if("file"===g[j].kind||""===g[j].kind){if(!i.validatePattern(g[j],h)){f=e.reject;break}f=e.accept}}d(f)}function l(a,b,c,d){function e(a,b,c){if(null!=b)if(b.isDirectory){var d=(c||"")+b.name;a.push({name:b.name,type:"directory",path:d});var f=b.createReader(),g=[];i++;var h=function(){f.readEntries(function(d){try{if(d.length)g=g.concat(Array.prototype.slice.call(d||[],0)),h();else{for(var f=0;f<g.length;f++)e(a,g[f],(c?c:"")+b.name+"/");i--}}catch(j){i--,console.error(j)}},function(){i--})};h()}else i++,b.file(function(b){try{i--,b.path=(c?c:"")+b.name,a.push(b)}catch(d){i--,console.error(d)}},function(){i--})}var f=[],i=0,j=a.dataTransfer.items;if(j&&j.length>0&&"file"!==h.protocol())for(var k=0;k<j.length;k++){if(j[k].webkitGetAsEntry&&j[k].webkitGetAsEntry()&&j[k].webkitGetAsEntry().isDirectory){var l=j[k].webkitGetAsEntry();if(l.isDirectory&&!c)continue;null!=l&&e(f,l)}else{var m=j[k].getAsFile();null!=m&&f.push(m)}if(!d&&f.length>0)break}else{var n=a.dataTransfer.files;if(null!=n)for(var o=0;o<n.length&&(f.push(n.item(o)),d||!(f.length>0));o++);}var p=0;!function q(a){g(function(){if(i)10*p++<2e4&&q(10);else{if(!d&&f.length>1){for(k=0;"directory"===f[k].type;)k++;f=[f[k]]}b(f)}},a||0)}()}var m=b(),n=function(a,b,c){return i.attrGetter(a,d,b,c)};if(n("dropAvailable")&&g(function(){a[n("dropAvailable")]?a[n("dropAvailable")].value=m:a[n("dropAvailable")]=m}),!m)return void(n("ngfHideOnDropNotAvailable",a)===!0&&c.css("display","none"));i.registerValidators(e,null,d,a);var o,p=null,q=f(n("ngfStopPropagation")),r=1;c[0].addEventListener("dragover",function(b){if(!j()){if(b.preventDefault(),q(a)&&b.stopPropagation(),navigator.userAgent.indexOf("Chrome")>-1){var e=b.dataTransfer.effectAllowed;b.dataTransfer.dropEffect="move"===e||"linkMove"===e?"move":"copy"}g.cancel(p),o||(o="C",k(a,d,b,function(a){o=a,c.addClass(o)}))}},!1),c[0].addEventListener("dragenter",function(b){j()||(b.preventDefault(),q(a)&&b.stopPropagation())},!1),c[0].addEventListener("dragleave",function(){j()||(p=g(function(){c.removeClass(o),o=null},r||1))},!1),c[0].addEventListener("drop",function(b){j()||(b.preventDefault(),q(a)&&b.stopPropagation(),c.removeClass(o),o=null,l(b,function(c){i.updateModel(e,d,a,n("ngfChange")||n("ngfDrop"),c,b)},n("ngfAllowDir",a)!==!1,n("multiple")||n("ngfMultiple",a)))},!1),c[0].addEventListener("paste",function(b){if(!j()){var c=[],f=b.clipboardData||b.originalEvent.clipboardData;if(f&&f.items){for(var g=0;g<f.items.length;g++)-1!==f.items[g].type.indexOf("image")&&c.push(f.items[g].getAsFile());i.updateModel(e,d,a,n("ngfChange")||n("ngfDrop"),c,b)}}},!1)}function b(){var a=document.createElement("div");return"draggable"in a&&"ondrop"in a&&!/Edge\/12./i.test(navigator.userAgent)}ngFileUpload.directive("ngfDrop",["$parse","$timeout","$location","Upload",function(b,c,d,e){return{restrict:"AEC",require:"?ngModel",link:function(f,g,h,i){a(f,g,h,i,b,c,d,e)}}}]),ngFileUpload.directive("ngfNoFileDrop",function(){return function(a,c){b()&&c.css("display","none")}}),ngFileUpload.directive("ngfDropAvailable",["$parse","$timeout","Upload",function(a,c,d){return function(e,f,g){if(b()){var h=a(d.attrGetter("ngfDropAvailable",g));c(function(){h(e),h.assign&&h.assign(e,!0)})}}}])}();
/*! 7.2.2 */
!function(){function a(a,b){window.XMLHttpRequest.prototype[a]=b(window.XMLHttpRequest.prototype[a])}function b(a,b,c){try{Object.defineProperty(a,b,{get:c})}catch(d){}}if(window.FileAPI||(window.FileAPI={}),FileAPI.shouldLoad=window.XMLHttpRequest&&!window.FormData||FileAPI.forceLoad,FileAPI.shouldLoad){var c=function(a){if(!a.__listeners){a.upload||(a.upload={}),a.__listeners=[];var b=a.upload.addEventListener;a.upload.addEventListener=function(c,d){a.__listeners[c]=d,b&&b.apply(this,arguments)}}};a("open",function(a){return function(b,d,e){c(this),this.__url=d;try{a.apply(this,[b,d,e])}catch(f){f.message.indexOf("Access is denied")>-1&&(this.__origError=f,a.apply(this,[b,"_fix_for_ie_crossdomain__",e]))}}}),a("getResponseHeader",function(a){return function(b){return this.__fileApiXHR&&this.__fileApiXHR.getResponseHeader?this.__fileApiXHR.getResponseHeader(b):null==a?null:a.apply(this,[b])}}),a("getAllResponseHeaders",function(a){return function(){return this.__fileApiXHR&&this.__fileApiXHR.getAllResponseHeaders?this.__fileApiXHR.getAllResponseHeaders():null==a?null:a.apply(this)}}),a("abort",function(a){return function(){return this.__fileApiXHR&&this.__fileApiXHR.abort?this.__fileApiXHR.abort():null==a?null:a.apply(this)}}),a("setRequestHeader",function(a){return function(b,d){if("__setXHR_"===b){c(this);var e=d(this);e instanceof Function&&e(this)}else this.__requestHeaders=this.__requestHeaders||{},this.__requestHeaders[b]=d,a.apply(this,arguments)}}),a("send",function(a){return function(){var c=this;if(arguments[0]&&arguments[0].__isFileAPIShim){var d=arguments[0],e={url:c.__url,jsonp:!1,cache:!0,complete:function(a,d){a&&angular.isString(a)&&-1!==a.indexOf("#2174")&&(a=null),c.__completed=!0,!a&&c.__listeners.load&&c.__listeners.load({type:"load",loaded:c.__loaded,total:c.__total,target:c,lengthComputable:!0}),!a&&c.__listeners.loadend&&c.__listeners.loadend({type:"loadend",loaded:c.__loaded,total:c.__total,target:c,lengthComputable:!0}),"abort"===a&&c.__listeners.abort&&c.__listeners.abort({type:"abort",loaded:c.__loaded,total:c.__total,target:c,lengthComputable:!0}),void 0!==d.status&&b(c,"status",function(){return 0===d.status&&a&&"abort"!==a?500:d.status}),void 0!==d.statusText&&b(c,"statusText",function(){return d.statusText}),b(c,"readyState",function(){return 4}),void 0!==d.response&&b(c,"response",function(){return d.response});var e=d.responseText||(a&&0===d.status&&"abort"!==a?a:void 0);b(c,"responseText",function(){return e}),b(c,"response",function(){return e}),a&&b(c,"err",function(){return a}),c.__fileApiXHR=d,c.onreadystatechange&&c.onreadystatechange(),c.onload&&c.onload()},progress:function(a){if(a.target=c,c.__listeners.progress&&c.__listeners.progress(a),c.__total=a.total,c.__loaded=a.loaded,a.total===a.loaded){var b=this;setTimeout(function(){c.__completed||(c.getAllResponseHeaders=function(){},b.complete(null,{status:204,statusText:"No Content"}))},FileAPI.noContentTimeout||1e4)}},headers:c.__requestHeaders};e.data={},e.files={};for(var f=0;f<d.data.length;f++){var g=d.data[f];null!=g.val&&null!=g.val.name&&null!=g.val.size&&null!=g.val.type?e.files[g.key]=g.val:e.data[g.key]=g.val}setTimeout(function(){if(!FileAPI.hasFlash)throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';c.__fileApiXHR=FileAPI.upload(e)},1)}else{if(this.__origError)throw this.__origError;a.apply(c,arguments)}}}),window.XMLHttpRequest.__isFileAPIShim=!0,window.FormData=FormData=function(){return{append:function(a,b,c){b.__isFileAPIBlobShim&&(b=b.data[0]),this.data.push({key:a,val:b,name:c})},data:[],__isFileAPIShim:!0}},window.Blob=Blob=function(a){return{data:a,__isFileAPIBlobShim:!0}}}}(),function(){function a(a){return"input"===a[0].tagName.toLowerCase()&&a.attr("type")&&"file"===a.attr("type").toLowerCase()}function b(){try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(a)return!0}catch(b){if(void 0!==navigator.mimeTypes["application/x-shockwave-flash"])return!0}return!1}function c(a){var b=0,c=0;if(window.jQuery)return jQuery(a).offset();if(a.offsetParent)do b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;while(a);return{left:b,top:c}}if(FileAPI.shouldLoad){if(FileAPI.forceLoad&&(FileAPI.html5=!1),!FileAPI.upload){var d,e,f,g,h,i=document.createElement("script"),j=document.getElementsByTagName("script");if(window.FileAPI.jsUrl)d=window.FileAPI.jsUrl;else if(window.FileAPI.jsPath)e=window.FileAPI.jsPath;else for(f=0;f<j.length;f++)if(h=j[f].src,g=h.search(/\/ng\-file\-upload[\-a-zA-z0-9\.]*\.js/),g>-1){e=h.substring(0,g+1);break}null==FileAPI.staticPath&&(FileAPI.staticPath=e),i.setAttribute("src",d||e+"FileAPI.min.js"),document.getElementsByTagName("head")[0].appendChild(i),FileAPI.hasFlash=b()}FileAPI.ngfFixIE=function(d,e,f){if(!b())throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';var g=function(){d.attr("disabled")?e&&e.removeClass("js-fileapi-wrapper"):(e.attr("__ngf_flash_")||(e.unbind("change"),e.unbind("click"),e.bind("change",function(a){h.apply(this,[a]),f.apply(this,[a])}),e.attr("__ngf_flash_","true")),e.addClass("js-fileapi-wrapper"),a(d)||e.css("position","absolute").css("top",c(d[0]).top+"px").css("left",c(d[0]).left+"px").css("width",d[0].offsetWidth+"px").css("height",d[0].offsetHeight+"px").css("filter","alpha(opacity=0)").css("display",d.css("display")).css("overflow","hidden").css("z-index","900000").css("visibility","visible"))};d.bind("mouseenter",g);var h=function(a){for(var b=FileAPI.getFiles(a),c=0;c<b.length;c++)void 0===b[c].size&&(b[c].size=0),void 0===b[c].name&&(b[c].name="file"),void 0===b[c].type&&(b[c].type="undefined");a.target||(a.target={}),a.target.files=b,a.target.files!==b&&(a.__files_=b),(a.__files_||a.target.files).item=function(b){return(a.__files_||a.target.files)[b]||null}}},FileAPI.disableFileInput=function(a,b){b?a.removeClass("js-fileapi-wrapper"):a.addClass("js-fileapi-wrapper")}}}(),window.FileReader||(window.FileReader=function(){var a=this,b=!1;this.listeners={},this.addEventListener=function(b,c){a.listeners[b]=a.listeners[b]||[],a.listeners[b].push(c)},this.removeEventListener=function(b,c){a.listeners[b]&&a.listeners[b].splice(a.listeners[b].indexOf(c),1)},this.dispatchEvent=function(b){var c=a.listeners[b.type];if(c)for(var d=0;d<c.length;d++)c[d].call(a,b)},this.onabort=this.onerror=this.onload=this.onloadstart=this.onloadend=this.onprogress=null;var c=function(b,c){var d={type:b,target:a,loaded:c.loaded,total:c.total,error:c.error};return null!=c.result&&(d.target.result=c.result),d},d=function(d){b||(b=!0,a.onloadstart&&a.onloadstart(c("loadstart",d)));var e;"load"===d.type?(a.onloadend&&a.onloadend(c("loadend",d)),e=c("load",d),a.onload&&a.onload(e),a.dispatchEvent(e)):"progress"===d.type?(e=c("progress",d),a.onprogress&&a.onprogress(e),a.dispatchEvent(e)):(e=c("error",d),a.onerror&&a.onerror(e),a.dispatchEvent(e))};this.readAsArrayBuffer=function(a){FileAPI.readAsBinaryString(a,d)},this.readAsBinaryString=function(a){FileAPI.readAsBinaryString(a,d)},this.readAsDataURL=function(a){FileAPI.readAsDataURL(a,d)},this.readAsText=function(a){FileAPI.readAsText(a,d)}});
//! moment.js
//! version : 2.10.6
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com

(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    global.moment = factory()
}(this, function () { 'use strict';

    var hookCallback;

    function utils_hooks__hooks () {
        return hookCallback.apply(null, arguments);
    }

    // This is done to register the method called with moment()
    // without creating circular dependencies.
    function setHookCallback (callback) {
        hookCallback = callback;
    }

    function isArray(input) {
        return Object.prototype.toString.call(input) === '[object Array]';
    }

    function isDate(input) {
        return input instanceof Date || Object.prototype.toString.call(input) === '[object Date]';
    }

    function map(arr, fn) {
        var res = [], i;
        for (i = 0; i < arr.length; ++i) {
            res.push(fn(arr[i], i));
        }
        return res;
    }

    function hasOwnProp(a, b) {
        return Object.prototype.hasOwnProperty.call(a, b);
    }

    function extend(a, b) {
        for (var i in b) {
            if (hasOwnProp(b, i)) {
                a[i] = b[i];
            }
        }

        if (hasOwnProp(b, 'toString')) {
            a.toString = b.toString;
        }

        if (hasOwnProp(b, 'valueOf')) {
            a.valueOf = b.valueOf;
        }

        return a;
    }

    function create_utc__createUTC (input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, true).utc();
    }

    function defaultParsingFlags() {
        // We need to deep clone this object.
        return {
            empty           : false,
            unusedTokens    : [],
            unusedInput     : [],
            overflow        : -2,
            charsLeftOver   : 0,
            nullInput       : false,
            invalidMonth    : null,
            invalidFormat   : false,
            userInvalidated : false,
            iso             : false
        };
    }

    function getParsingFlags(m) {
        if (m._pf == null) {
            m._pf = defaultParsingFlags();
        }
        return m._pf;
    }

    function valid__isValid(m) {
        if (m._isValid == null) {
            var flags = getParsingFlags(m);
            m._isValid = !isNaN(m._d.getTime()) &&
                flags.overflow < 0 &&
                !flags.empty &&
                !flags.invalidMonth &&
                !flags.invalidWeekday &&
                !flags.nullInput &&
                !flags.invalidFormat &&
                !flags.userInvalidated;

            if (m._strict) {
                m._isValid = m._isValid &&
                    flags.charsLeftOver === 0 &&
                    flags.unusedTokens.length === 0 &&
                    flags.bigHour === undefined;
            }
        }
        return m._isValid;
    }

    function valid__createInvalid (flags) {
        var m = create_utc__createUTC(NaN);
        if (flags != null) {
            extend(getParsingFlags(m), flags);
        }
        else {
            getParsingFlags(m).userInvalidated = true;
        }

        return m;
    }

    var momentProperties = utils_hooks__hooks.momentProperties = [];

    function copyConfig(to, from) {
        var i, prop, val;

        if (typeof from._isAMomentObject !== 'undefined') {
            to._isAMomentObject = from._isAMomentObject;
        }
        if (typeof from._i !== 'undefined') {
            to._i = from._i;
        }
        if (typeof from._f !== 'undefined') {
            to._f = from._f;
        }
        if (typeof from._l !== 'undefined') {
            to._l = from._l;
        }
        if (typeof from._strict !== 'undefined') {
            to._strict = from._strict;
        }
        if (typeof from._tzm !== 'undefined') {
            to._tzm = from._tzm;
        }
        if (typeof from._isUTC !== 'undefined') {
            to._isUTC = from._isUTC;
        }
        if (typeof from._offset !== 'undefined') {
            to._offset = from._offset;
        }
        if (typeof from._pf !== 'undefined') {
            to._pf = getParsingFlags(from);
        }
        if (typeof from._locale !== 'undefined') {
            to._locale = from._locale;
        }

        if (momentProperties.length > 0) {
            for (i in momentProperties) {
                prop = momentProperties[i];
                val = from[prop];
                if (typeof val !== 'undefined') {
                    to[prop] = val;
                }
            }
        }

        return to;
    }

    var updateInProgress = false;

    // Moment prototype object
    function Moment(config) {
        copyConfig(this, config);
        this._d = new Date(config._d != null ? config._d.getTime() : NaN);
        // Prevent infinite loop in case updateOffset creates new moment
        // objects.
        if (updateInProgress === false) {
            updateInProgress = true;
            utils_hooks__hooks.updateOffset(this);
            updateInProgress = false;
        }
    }

    function isMoment (obj) {
        return obj instanceof Moment || (obj != null && obj._isAMomentObject != null);
    }

    function absFloor (number) {
        if (number < 0) {
            return Math.ceil(number);
        } else {
            return Math.floor(number);
        }
    }

    function toInt(argumentForCoercion) {
        var coercedNumber = +argumentForCoercion,
            value = 0;

        if (coercedNumber !== 0 && isFinite(coercedNumber)) {
            value = absFloor(coercedNumber);
        }

        return value;
    }

    function compareArrays(array1, array2, dontConvert) {
        var len = Math.min(array1.length, array2.length),
            lengthDiff = Math.abs(array1.length - array2.length),
            diffs = 0,
            i;
        for (i = 0; i < len; i++) {
            if ((dontConvert && array1[i] !== array2[i]) ||
                (!dontConvert && toInt(array1[i]) !== toInt(array2[i]))) {
                diffs++;
            }
        }
        return diffs + lengthDiff;
    }

    function Locale() {
    }

    var locales = {};
    var globalLocale;

    function normalizeLocale(key) {
        return key ? key.toLowerCase().replace('_', '-') : key;
    }

    // pick the locale from the array
    // try ['en-au', 'en-gb'] as 'en-au', 'en-gb', 'en', as in move through the list trying each
    // substring from most specific to least, but move to the next array item if it's a more specific variant than the current root
    function chooseLocale(names) {
        var i = 0, j, next, locale, split;

        while (i < names.length) {
            split = normalizeLocale(names[i]).split('-');
            j = split.length;
            next = normalizeLocale(names[i + 1]);
            next = next ? next.split('-') : null;
            while (j > 0) {
                locale = loadLocale(split.slice(0, j).join('-'));
                if (locale) {
                    return locale;
                }
                if (next && next.length >= j && compareArrays(split, next, true) >= j - 1) {
                    //the next array item is better than a shallower substring of this one
                    break;
                }
                j--;
            }
            i++;
        }
        return null;
    }

    function loadLocale(name) {
        var oldLocale = null;
        // TODO: Find a better way to register and load all the locales in Node
        if (!locales[name] && typeof module !== 'undefined' &&
                module && module.exports) {
            try {
                oldLocale = globalLocale._abbr;
                require('./locale/' + name);
                // because defineLocale currently also sets the global locale, we
                // want to undo that for lazy loaded locales
                locale_locales__getSetGlobalLocale(oldLocale);
            } catch (e) { }
        }
        return locales[name];
    }

    // This function will load locale and then set the global locale.  If
    // no arguments are passed in, it will simply return the current global
    // locale key.
    function locale_locales__getSetGlobalLocale (key, values) {
        var data;
        if (key) {
            if (typeof values === 'undefined') {
                data = locale_locales__getLocale(key);
            }
            else {
                data = defineLocale(key, values);
            }

            if (data) {
                // moment.duration._locale = moment._locale = data;
                globalLocale = data;
            }
        }

        return globalLocale._abbr;
    }

    function defineLocale (name, values) {
        if (values !== null) {
            values.abbr = name;
            locales[name] = locales[name] || new Locale();
            locales[name].set(values);

            // backwards compat for now: also set the locale
            locale_locales__getSetGlobalLocale(name);

            return locales[name];
        } else {
            // useful for testing
            delete locales[name];
            return null;
        }
    }

    // returns locale data
    function locale_locales__getLocale (key) {
        var locale;

        if (key && key._locale && key._locale._abbr) {
            key = key._locale._abbr;
        }

        if (!key) {
            return globalLocale;
        }

        if (!isArray(key)) {
            //short-circuit everything else
            locale = loadLocale(key);
            if (locale) {
                return locale;
            }
            key = [key];
        }

        return chooseLocale(key);
    }

    var aliases = {};

    function addUnitAlias (unit, shorthand) {
        var lowerCase = unit.toLowerCase();
        aliases[lowerCase] = aliases[lowerCase + 's'] = aliases[shorthand] = unit;
    }

    function normalizeUnits(units) {
        return typeof units === 'string' ? aliases[units] || aliases[units.toLowerCase()] : undefined;
    }

    function normalizeObjectUnits(inputObject) {
        var normalizedInput = {},
            normalizedProp,
            prop;

        for (prop in inputObject) {
            if (hasOwnProp(inputObject, prop)) {
                normalizedProp = normalizeUnits(prop);
                if (normalizedProp) {
                    normalizedInput[normalizedProp] = inputObject[prop];
                }
            }
        }

        return normalizedInput;
    }

    function makeGetSet (unit, keepTime) {
        return function (value) {
            if (value != null) {
                get_set__set(this, unit, value);
                utils_hooks__hooks.updateOffset(this, keepTime);
                return this;
            } else {
                return get_set__get(this, unit);
            }
        };
    }

    function get_set__get (mom, unit) {
        return mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]();
    }

    function get_set__set (mom, unit, value) {
        return mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);
    }

    // MOMENTS

    function getSet (units, value) {
        var unit;
        if (typeof units === 'object') {
            for (unit in units) {
                this.set(unit, units[unit]);
            }
        } else {
            units = normalizeUnits(units);
            if (typeof this[units] === 'function') {
                return this[units](value);
            }
        }
        return this;
    }

    function zeroFill(number, targetLength, forceSign) {
        var absNumber = '' + Math.abs(number),
            zerosToFill = targetLength - absNumber.length,
            sign = number >= 0;
        return (sign ? (forceSign ? '+' : '') : '-') +
            Math.pow(10, Math.max(0, zerosToFill)).toString().substr(1) + absNumber;
    }

    var formattingTokens = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;

    var localFormattingTokens = /(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;

    var formatFunctions = {};

    var formatTokenFunctions = {};

    // token:    'M'
    // padded:   ['MM', 2]
    // ordinal:  'Mo'
    // callback: function () { this.month() + 1 }
    function addFormatToken (token, padded, ordinal, callback) {
        var func = callback;
        if (typeof callback === 'string') {
            func = function () {
                return this[callback]();
            };
        }
        if (token) {
            formatTokenFunctions[token] = func;
        }
        if (padded) {
            formatTokenFunctions[padded[0]] = function () {
                return zeroFill(func.apply(this, arguments), padded[1], padded[2]);
            };
        }
        if (ordinal) {
            formatTokenFunctions[ordinal] = function () {
                return this.localeData().ordinal(func.apply(this, arguments), token);
            };
        }
    }

    function removeFormattingTokens(input) {
        if (input.match(/\[[\s\S]/)) {
            return input.replace(/^\[|\]$/g, '');
        }
        return input.replace(/\\/g, '');
    }

    function makeFormatFunction(format) {
        var array = format.match(formattingTokens), i, length;

        for (i = 0, length = array.length; i < length; i++) {
            if (formatTokenFunctions[array[i]]) {
                array[i] = formatTokenFunctions[array[i]];
            } else {
                array[i] = removeFormattingTokens(array[i]);
            }
        }

        return function (mom) {
            var output = '';
            for (i = 0; i < length; i++) {
                output += array[i] instanceof Function ? array[i].call(mom, format) : array[i];
            }
            return output;
        };
    }

    // format date using native date object
    function formatMoment(m, format) {
        if (!m.isValid()) {
            return m.localeData().invalidDate();
        }

        format = expandFormat(format, m.localeData());
        formatFunctions[format] = formatFunctions[format] || makeFormatFunction(format);

        return formatFunctions[format](m);
    }

    function expandFormat(format, locale) {
        var i = 5;

        function replaceLongDateFormatTokens(input) {
            return locale.longDateFormat(input) || input;
        }

        localFormattingTokens.lastIndex = 0;
        while (i >= 0 && localFormattingTokens.test(format)) {
            format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);
            localFormattingTokens.lastIndex = 0;
            i -= 1;
        }

        return format;
    }

    var match1         = /\d/;            //       0 - 9
    var match2         = /\d\d/;          //      00 - 99
    var match3         = /\d{3}/;         //     000 - 999
    var match4         = /\d{4}/;         //    0000 - 9999
    var match6         = /[+-]?\d{6}/;    // -999999 - 999999
    var match1to2      = /\d\d?/;         //       0 - 99
    var match1to3      = /\d{1,3}/;       //       0 - 999
    var match1to4      = /\d{1,4}/;       //       0 - 9999
    var match1to6      = /[+-]?\d{1,6}/;  // -999999 - 999999

    var matchUnsigned  = /\d+/;           //       0 - inf
    var matchSigned    = /[+-]?\d+/;      //    -inf - inf

    var matchOffset    = /Z|[+-]\d\d:?\d\d/gi; // +00:00 -00:00 +0000 -0000 or Z

    var matchTimestamp = /[+-]?\d+(\.\d{1,3})?/; // 123456789 123456789.123

    // any word (or two) characters or numbers including two/three word month in arabic.
    var matchWord = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i;

    var regexes = {};

    function isFunction (sth) {
        // https://github.com/moment/moment/issues/2325
        return typeof sth === 'function' &&
            Object.prototype.toString.call(sth) === '[object Function]';
    }


    function addRegexToken (token, regex, strictRegex) {
        regexes[token] = isFunction(regex) ? regex : function (isStrict) {
            return (isStrict && strictRegex) ? strictRegex : regex;
        };
    }

    function getParseRegexForToken (token, config) {
        if (!hasOwnProp(regexes, token)) {
            return new RegExp(unescapeFormat(token));
        }

        return regexes[token](config._strict, config._locale);
    }

    // Code from http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
    function unescapeFormat(s) {
        return s.replace('\\', '').replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function (matched, p1, p2, p3, p4) {
            return p1 || p2 || p3 || p4;
        }).replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    }

    var tokens = {};

    function addParseToken (token, callback) {
        var i, func = callback;
        if (typeof token === 'string') {
            token = [token];
        }
        if (typeof callback === 'number') {
            func = function (input, array) {
                array[callback] = toInt(input);
            };
        }
        for (i = 0; i < token.length; i++) {
            tokens[token[i]] = func;
        }
    }

    function addWeekParseToken (token, callback) {
        addParseToken(token, function (input, array, config, token) {
            config._w = config._w || {};
            callback(input, config._w, config, token);
        });
    }

    function addTimeToArrayFromToken(token, input, config) {
        if (input != null && hasOwnProp(tokens, token)) {
            tokens[token](input, config._a, config, token);
        }
    }

    var YEAR = 0;
    var MONTH = 1;
    var DATE = 2;
    var HOUR = 3;
    var MINUTE = 4;
    var SECOND = 5;
    var MILLISECOND = 6;

    function daysInMonth(year, month) {
        return new Date(Date.UTC(year, month + 1, 0)).getUTCDate();
    }

    // FORMATTING

    addFormatToken('M', ['MM', 2], 'Mo', function () {
        return this.month() + 1;
    });

    addFormatToken('MMM', 0, 0, function (format) {
        return this.localeData().monthsShort(this, format);
    });

    addFormatToken('MMMM', 0, 0, function (format) {
        return this.localeData().months(this, format);
    });

    // ALIASES

    addUnitAlias('month', 'M');

    // PARSING

    addRegexToken('M',    match1to2);
    addRegexToken('MM',   match1to2, match2);
    addRegexToken('MMM',  matchWord);
    addRegexToken('MMMM', matchWord);

    addParseToken(['M', 'MM'], function (input, array) {
        array[MONTH] = toInt(input) - 1;
    });

    addParseToken(['MMM', 'MMMM'], function (input, array, config, token) {
        var month = config._locale.monthsParse(input, token, config._strict);
        // if we didn't find a month name, mark the date as invalid.
        if (month != null) {
            array[MONTH] = month;
        } else {
            getParsingFlags(config).invalidMonth = input;
        }
    });

    // LOCALES

    var defaultLocaleMonths = 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_');
    function localeMonths (m) {
        return this._months[m.month()];
    }

    var defaultLocaleMonthsShort = 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_');
    function localeMonthsShort (m) {
        return this._monthsShort[m.month()];
    }

    function localeMonthsParse (monthName, format, strict) {
        var i, mom, regex;

        if (!this._monthsParse) {
            this._monthsParse = [];
            this._longMonthsParse = [];
            this._shortMonthsParse = [];
        }

        for (i = 0; i < 12; i++) {
            // make the regex if we don't have it already
            mom = create_utc__createUTC([2000, i]);
            if (strict && !this._longMonthsParse[i]) {
                this._longMonthsParse[i] = new RegExp('^' + this.months(mom, '').replace('.', '') + '$', 'i');
                this._shortMonthsParse[i] = new RegExp('^' + this.monthsShort(mom, '').replace('.', '') + '$', 'i');
            }
            if (!strict && !this._monthsParse[i]) {
                regex = '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');
                this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');
            }
            // test the regex
            if (strict && format === 'MMMM' && this._longMonthsParse[i].test(monthName)) {
                return i;
            } else if (strict && format === 'MMM' && this._shortMonthsParse[i].test(monthName)) {
                return i;
            } else if (!strict && this._monthsParse[i].test(monthName)) {
                return i;
            }
        }
    }

    // MOMENTS

    function setMonth (mom, value) {
        var dayOfMonth;

        // TODO: Move this out of here!
        if (typeof value === 'string') {
            value = mom.localeData().monthsParse(value);
            // TODO: Another silent failure?
            if (typeof value !== 'number') {
                return mom;
            }
        }

        dayOfMonth = Math.min(mom.date(), daysInMonth(mom.year(), value));
        mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);
        return mom;
    }

    function getSetMonth (value) {
        if (value != null) {
            setMonth(this, value);
            utils_hooks__hooks.updateOffset(this, true);
            return this;
        } else {
            return get_set__get(this, 'Month');
        }
    }

    function getDaysInMonth () {
        return daysInMonth(this.year(), this.month());
    }

    function checkOverflow (m) {
        var overflow;
        var a = m._a;

        if (a && getParsingFlags(m).overflow === -2) {
            overflow =
                a[MONTH]       < 0 || a[MONTH]       > 11  ? MONTH :
                a[DATE]        < 1 || a[DATE]        > daysInMonth(a[YEAR], a[MONTH]) ? DATE :
                a[HOUR]        < 0 || a[HOUR]        > 24 || (a[HOUR] === 24 && (a[MINUTE] !== 0 || a[SECOND] !== 0 || a[MILLISECOND] !== 0)) ? HOUR :
                a[MINUTE]      < 0 || a[MINUTE]      > 59  ? MINUTE :
                a[SECOND]      < 0 || a[SECOND]      > 59  ? SECOND :
                a[MILLISECOND] < 0 || a[MILLISECOND] > 999 ? MILLISECOND :
                -1;

            if (getParsingFlags(m)._overflowDayOfYear && (overflow < YEAR || overflow > DATE)) {
                overflow = DATE;
            }

            getParsingFlags(m).overflow = overflow;
        }

        return m;
    }

    function warn(msg) {
        if (utils_hooks__hooks.suppressDeprecationWarnings === false && typeof console !== 'undefined' && console.warn) {
            console.warn('Deprecation warning: ' + msg);
        }
    }

    function deprecate(msg, fn) {
        var firstTime = true;

        return extend(function () {
            if (firstTime) {
                warn(msg + '\n' + (new Error()).stack);
                firstTime = false;
            }
            return fn.apply(this, arguments);
        }, fn);
    }

    var deprecations = {};

    function deprecateSimple(name, msg) {
        if (!deprecations[name]) {
            warn(msg);
            deprecations[name] = true;
        }
    }

    utils_hooks__hooks.suppressDeprecationWarnings = false;

    var from_string__isoRegex = /^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;

    var isoDates = [
        ['YYYYYY-MM-DD', /[+-]\d{6}-\d{2}-\d{2}/],
        ['YYYY-MM-DD', /\d{4}-\d{2}-\d{2}/],
        ['GGGG-[W]WW-E', /\d{4}-W\d{2}-\d/],
        ['GGGG-[W]WW', /\d{4}-W\d{2}/],
        ['YYYY-DDD', /\d{4}-\d{3}/]
    ];

    // iso time formats and regexes
    var isoTimes = [
        ['HH:mm:ss.SSSS', /(T| )\d\d:\d\d:\d\d\.\d+/],
        ['HH:mm:ss', /(T| )\d\d:\d\d:\d\d/],
        ['HH:mm', /(T| )\d\d:\d\d/],
        ['HH', /(T| )\d\d/]
    ];

    var aspNetJsonRegex = /^\/?Date\((\-?\d+)/i;

    // date from iso format
    function configFromISO(config) {
        var i, l,
            string = config._i,
            match = from_string__isoRegex.exec(string);

        if (match) {
            getParsingFlags(config).iso = true;
            for (i = 0, l = isoDates.length; i < l; i++) {
                if (isoDates[i][1].exec(string)) {
                    config._f = isoDates[i][0];
                    break;
                }
            }
            for (i = 0, l = isoTimes.length; i < l; i++) {
                if (isoTimes[i][1].exec(string)) {
                    // match[6] should be 'T' or space
                    config._f += (match[6] || ' ') + isoTimes[i][0];
                    break;
                }
            }
            if (string.match(matchOffset)) {
                config._f += 'Z';
            }
            configFromStringAndFormat(config);
        } else {
            config._isValid = false;
        }
    }

    // date from iso format or fallback
    function configFromString(config) {
        var matched = aspNetJsonRegex.exec(config._i);

        if (matched !== null) {
            config._d = new Date(+matched[1]);
            return;
        }

        configFromISO(config);
        if (config._isValid === false) {
            delete config._isValid;
            utils_hooks__hooks.createFromInputFallback(config);
        }
    }

    utils_hooks__hooks.createFromInputFallback = deprecate(
        'moment construction falls back to js Date. This is ' +
        'discouraged and will be removed in upcoming major ' +
        'release. Please refer to ' +
        'https://github.com/moment/moment/issues/1407 for more info.',
        function (config) {
            config._d = new Date(config._i + (config._useUTC ? ' UTC' : ''));
        }
    );

    function createDate (y, m, d, h, M, s, ms) {
        //can't just apply() to create a date:
        //http://stackoverflow.com/questions/181348/instantiating-a-javascript-object-by-calling-prototype-constructor-apply
        var date = new Date(y, m, d, h, M, s, ms);

        //the date constructor doesn't accept years < 1970
        if (y < 1970) {
            date.setFullYear(y);
        }
        return date;
    }

    function createUTCDate (y) {
        var date = new Date(Date.UTC.apply(null, arguments));
        if (y < 1970) {
            date.setUTCFullYear(y);
        }
        return date;
    }

    addFormatToken(0, ['YY', 2], 0, function () {
        return this.year() % 100;
    });

    addFormatToken(0, ['YYYY',   4],       0, 'year');
    addFormatToken(0, ['YYYYY',  5],       0, 'year');
    addFormatToken(0, ['YYYYYY', 6, true], 0, 'year');

    // ALIASES

    addUnitAlias('year', 'y');

    // PARSING

    addRegexToken('Y',      matchSigned);
    addRegexToken('YY',     match1to2, match2);
    addRegexToken('YYYY',   match1to4, match4);
    addRegexToken('YYYYY',  match1to6, match6);
    addRegexToken('YYYYYY', match1to6, match6);

    addParseToken(['YYYYY', 'YYYYYY'], YEAR);
    addParseToken('YYYY', function (input, array) {
        array[YEAR] = input.length === 2 ? utils_hooks__hooks.parseTwoDigitYear(input) : toInt(input);
    });
    addParseToken('YY', function (input, array) {
        array[YEAR] = utils_hooks__hooks.parseTwoDigitYear(input);
    });

    // HELPERS

    function daysInYear(year) {
        return isLeapYear(year) ? 366 : 365;
    }

    function isLeapYear(year) {
        return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
    }

    // HOOKS

    utils_hooks__hooks.parseTwoDigitYear = function (input) {
        return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);
    };

    // MOMENTS

    var getSetYear = makeGetSet('FullYear', false);

    function getIsLeapYear () {
        return isLeapYear(this.year());
    }

    addFormatToken('w', ['ww', 2], 'wo', 'week');
    addFormatToken('W', ['WW', 2], 'Wo', 'isoWeek');

    // ALIASES

    addUnitAlias('week', 'w');
    addUnitAlias('isoWeek', 'W');

    // PARSING

    addRegexToken('w',  match1to2);
    addRegexToken('ww', match1to2, match2);
    addRegexToken('W',  match1to2);
    addRegexToken('WW', match1to2, match2);

    addWeekParseToken(['w', 'ww', 'W', 'WW'], function (input, week, config, token) {
        week[token.substr(0, 1)] = toInt(input);
    });

    // HELPERS

    // firstDayOfWeek       0 = sun, 6 = sat
    //                      the day of the week that starts the week
    //                      (usually sunday or monday)
    // firstDayOfWeekOfYear 0 = sun, 6 = sat
    //                      the first week is the week that contains the first
    //                      of this day of the week
    //                      (eg. ISO weeks use thursday (4))
    function weekOfYear(mom, firstDayOfWeek, firstDayOfWeekOfYear) {
        var end = firstDayOfWeekOfYear - firstDayOfWeek,
            daysToDayOfWeek = firstDayOfWeekOfYear - mom.day(),
            adjustedMoment;


        if (daysToDayOfWeek > end) {
            daysToDayOfWeek -= 7;
        }

        if (daysToDayOfWeek < end - 7) {
            daysToDayOfWeek += 7;
        }

        adjustedMoment = local__createLocal(mom).add(daysToDayOfWeek, 'd');
        return {
            week: Math.ceil(adjustedMoment.dayOfYear() / 7),
            year: adjustedMoment.year()
        };
    }

    // LOCALES

    function localeWeek (mom) {
        return weekOfYear(mom, this._week.dow, this._week.doy).week;
    }

    var defaultLocaleWeek = {
        dow : 0, // Sunday is the first day of the week.
        doy : 6  // The week that contains Jan 1st is the first week of the year.
    };

    function localeFirstDayOfWeek () {
        return this._week.dow;
    }

    function localeFirstDayOfYear () {
        return this._week.doy;
    }

    // MOMENTS

    function getSetWeek (input) {
        var week = this.localeData().week(this);
        return input == null ? week : this.add((input - week) * 7, 'd');
    }

    function getSetISOWeek (input) {
        var week = weekOfYear(this, 1, 4).week;
        return input == null ? week : this.add((input - week) * 7, 'd');
    }

    addFormatToken('DDD', ['DDDD', 3], 'DDDo', 'dayOfYear');

    // ALIASES

    addUnitAlias('dayOfYear', 'DDD');

    // PARSING

    addRegexToken('DDD',  match1to3);
    addRegexToken('DDDD', match3);
    addParseToken(['DDD', 'DDDD'], function (input, array, config) {
        config._dayOfYear = toInt(input);
    });

    // HELPERS

    //http://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday
    function dayOfYearFromWeeks(year, week, weekday, firstDayOfWeekOfYear, firstDayOfWeek) {
        var week1Jan = 6 + firstDayOfWeek - firstDayOfWeekOfYear, janX = createUTCDate(year, 0, 1 + week1Jan), d = janX.getUTCDay(), dayOfYear;
        if (d < firstDayOfWeek) {
            d += 7;
        }

        weekday = weekday != null ? 1 * weekday : firstDayOfWeek;

        dayOfYear = 1 + week1Jan + 7 * (week - 1) - d + weekday;

        return {
            year: dayOfYear > 0 ? year : year - 1,
            dayOfYear: dayOfYear > 0 ?  dayOfYear : daysInYear(year - 1) + dayOfYear
        };
    }

    // MOMENTS

    function getSetDayOfYear (input) {
        var dayOfYear = Math.round((this.clone().startOf('day') - this.clone().startOf('year')) / 864e5) + 1;
        return input == null ? dayOfYear : this.add((input - dayOfYear), 'd');
    }

    // Pick the first defined of two or three arguments.
    function defaults(a, b, c) {
        if (a != null) {
            return a;
        }
        if (b != null) {
            return b;
        }
        return c;
    }

    function currentDateArray(config) {
        var now = new Date();
        if (config._useUTC) {
            return [now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()];
        }
        return [now.getFullYear(), now.getMonth(), now.getDate()];
    }

    // convert an array to a date.
    // the array should mirror the parameters below
    // note: all values past the year are optional and will default to the lowest possible value.
    // [year, month, day , hour, minute, second, millisecond]
    function configFromArray (config) {
        var i, date, input = [], currentDate, yearToUse;

        if (config._d) {
            return;
        }

        currentDate = currentDateArray(config);

        //compute day of the year from weeks and weekdays
        if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {
            dayOfYearFromWeekInfo(config);
        }

        //if the day of the year is set, figure out what it is
        if (config._dayOfYear) {
            yearToUse = defaults(config._a[YEAR], currentDate[YEAR]);

            if (config._dayOfYear > daysInYear(yearToUse)) {
                getParsingFlags(config)._overflowDayOfYear = true;
            }

            date = createUTCDate(yearToUse, 0, config._dayOfYear);
            config._a[MONTH] = date.getUTCMonth();
            config._a[DATE] = date.getUTCDate();
        }

        // Default to current date.
        // * if no year, month, day of month are given, default to today
        // * if day of month is given, default month and year
        // * if month is given, default only year
        // * if year is given, don't default anything
        for (i = 0; i < 3 && config._a[i] == null; ++i) {
            config._a[i] = input[i] = currentDate[i];
        }

        // Zero out whatever was not defaulted, including time
        for (; i < 7; i++) {
            config._a[i] = input[i] = (config._a[i] == null) ? (i === 2 ? 1 : 0) : config._a[i];
        }

        // Check for 24:00:00.000
        if (config._a[HOUR] === 24 &&
                config._a[MINUTE] === 0 &&
                config._a[SECOND] === 0 &&
                config._a[MILLISECOND] === 0) {
            config._nextDay = true;
            config._a[HOUR] = 0;
        }

        config._d = (config._useUTC ? createUTCDate : createDate).apply(null, input);
        // Apply timezone offset from input. The actual utcOffset can be changed
        // with parseZone.
        if (config._tzm != null) {
            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);
        }

        if (config._nextDay) {
            config._a[HOUR] = 24;
        }
    }

    function dayOfYearFromWeekInfo(config) {
        var w, weekYear, week, weekday, dow, doy, temp;

        w = config._w;
        if (w.GG != null || w.W != null || w.E != null) {
            dow = 1;
            doy = 4;

            // TODO: We need to take the current isoWeekYear, but that depends on
            // how we interpret now (local, utc, fixed offset). So create
            // a now version of current config (take local/utc/offset flags, and
            // create now).
            weekYear = defaults(w.GG, config._a[YEAR], weekOfYear(local__createLocal(), 1, 4).year);
            week = defaults(w.W, 1);
            weekday = defaults(w.E, 1);
        } else {
            dow = config._locale._week.dow;
            doy = config._locale._week.doy;

            weekYear = defaults(w.gg, config._a[YEAR], weekOfYear(local__createLocal(), dow, doy).year);
            week = defaults(w.w, 1);

            if (w.d != null) {
                // weekday -- low day numbers are considered next week
                weekday = w.d;
                if (weekday < dow) {
                    ++week;
                }
            } else if (w.e != null) {
                // local weekday -- counting starts from begining of week
                weekday = w.e + dow;
            } else {
                // default to begining of week
                weekday = dow;
            }
        }
        temp = dayOfYearFromWeeks(weekYear, week, weekday, doy, dow);

        config._a[YEAR] = temp.year;
        config._dayOfYear = temp.dayOfYear;
    }

    utils_hooks__hooks.ISO_8601 = function () {};

    // date from string and format string
    function configFromStringAndFormat(config) {
        // TODO: Move this to another part of the creation flow to prevent circular deps
        if (config._f === utils_hooks__hooks.ISO_8601) {
            configFromISO(config);
            return;
        }

        config._a = [];
        getParsingFlags(config).empty = true;

        // This array is used to make a Date, either with `new Date` or `Date.UTC`
        var string = '' + config._i,
            i, parsedInput, tokens, token, skipped,
            stringLength = string.length,
            totalParsedInputLength = 0;

        tokens = expandFormat(config._f, config._locale).match(formattingTokens) || [];

        for (i = 0; i < tokens.length; i++) {
            token = tokens[i];
            parsedInput = (string.match(getParseRegexForToken(token, config)) || [])[0];
            if (parsedInput) {
                skipped = string.substr(0, string.indexOf(parsedInput));
                if (skipped.length > 0) {
                    getParsingFlags(config).unusedInput.push(skipped);
                }
                string = string.slice(string.indexOf(parsedInput) + parsedInput.length);
                totalParsedInputLength += parsedInput.length;
            }
            // don't parse if it's not a known token
            if (formatTokenFunctions[token]) {
                if (parsedInput) {
                    getParsingFlags(config).empty = false;
                }
                else {
                    getParsingFlags(config).unusedTokens.push(token);
                }
                addTimeToArrayFromToken(token, parsedInput, config);
            }
            else if (config._strict && !parsedInput) {
                getParsingFlags(config).unusedTokens.push(token);
            }
        }

        // add remaining unparsed input length to the string
        getParsingFlags(config).charsLeftOver = stringLength - totalParsedInputLength;
        if (string.length > 0) {
            getParsingFlags(config).unusedInput.push(string);
        }

        // clear _12h flag if hour is <= 12
        if (getParsingFlags(config).bigHour === true &&
                config._a[HOUR] <= 12 &&
                config._a[HOUR] > 0) {
            getParsingFlags(config).bigHour = undefined;
        }
        // handle meridiem
        config._a[HOUR] = meridiemFixWrap(config._locale, config._a[HOUR], config._meridiem);

        configFromArray(config);
        checkOverflow(config);
    }


    function meridiemFixWrap (locale, hour, meridiem) {
        var isPm;

        if (meridiem == null) {
            // nothing to do
            return hour;
        }
        if (locale.meridiemHour != null) {
            return locale.meridiemHour(hour, meridiem);
        } else if (locale.isPM != null) {
            // Fallback
            isPm = locale.isPM(meridiem);
            if (isPm && hour < 12) {
                hour += 12;
            }
            if (!isPm && hour === 12) {
                hour = 0;
            }
            return hour;
        } else {
            // this is not supposed to happen
            return hour;
        }
    }

    function configFromStringAndArray(config) {
        var tempConfig,
            bestMoment,

            scoreToBeat,
            i,
            currentScore;

        if (config._f.length === 0) {
            getParsingFlags(config).invalidFormat = true;
            config._d = new Date(NaN);
            return;
        }

        for (i = 0; i < config._f.length; i++) {
            currentScore = 0;
            tempConfig = copyConfig({}, config);
            if (config._useUTC != null) {
                tempConfig._useUTC = config._useUTC;
            }
            tempConfig._f = config._f[i];
            configFromStringAndFormat(tempConfig);

            if (!valid__isValid(tempConfig)) {
                continue;
            }

            // if there is any input that was not parsed add a penalty for that format
            currentScore += getParsingFlags(tempConfig).charsLeftOver;

            //or tokens
            currentScore += getParsingFlags(tempConfig).unusedTokens.length * 10;

            getParsingFlags(tempConfig).score = currentScore;

            if (scoreToBeat == null || currentScore < scoreToBeat) {
                scoreToBeat = currentScore;
                bestMoment = tempConfig;
            }
        }

        extend(config, bestMoment || tempConfig);
    }

    function configFromObject(config) {
        if (config._d) {
            return;
        }

        var i = normalizeObjectUnits(config._i);
        config._a = [i.year, i.month, i.day || i.date, i.hour, i.minute, i.second, i.millisecond];

        configFromArray(config);
    }

    function createFromConfig (config) {
        var res = new Moment(checkOverflow(prepareConfig(config)));
        if (res._nextDay) {
            // Adding is smart enough around DST
            res.add(1, 'd');
            res._nextDay = undefined;
        }

        return res;
    }

    function prepareConfig (config) {
        var input = config._i,
            format = config._f;

        config._locale = config._locale || locale_locales__getLocale(config._l);

        if (input === null || (format === undefined && input === '')) {
            return valid__createInvalid({nullInput: true});
        }

        if (typeof input === 'string') {
            config._i = input = config._locale.preparse(input);
        }

        if (isMoment(input)) {
            return new Moment(checkOverflow(input));
        } else if (isArray(format)) {
            configFromStringAndArray(config);
        } else if (format) {
            configFromStringAndFormat(config);
        } else if (isDate(input)) {
            config._d = input;
        } else {
            configFromInput(config);
        }

        return config;
    }

    function configFromInput(config) {
        var input = config._i;
        if (input === undefined) {
            config._d = new Date();
        } else if (isDate(input)) {
            config._d = new Date(+input);
        } else if (typeof input === 'string') {
            configFromString(config);
        } else if (isArray(input)) {
            config._a = map(input.slice(0), function (obj) {
                return parseInt(obj, 10);
            });
            configFromArray(config);
        } else if (typeof(input) === 'object') {
            configFromObject(config);
        } else if (typeof(input) === 'number') {
            // from milliseconds
            config._d = new Date(input);
        } else {
            utils_hooks__hooks.createFromInputFallback(config);
        }
    }

    function createLocalOrUTC (input, format, locale, strict, isUTC) {
        var c = {};

        if (typeof(locale) === 'boolean') {
            strict = locale;
            locale = undefined;
        }
        // object construction must be done this way.
        // https://github.com/moment/moment/issues/1423
        c._isAMomentObject = true;
        c._useUTC = c._isUTC = isUTC;
        c._l = locale;
        c._i = input;
        c._f = format;
        c._strict = strict;

        return createFromConfig(c);
    }

    function local__createLocal (input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, false);
    }

    var prototypeMin = deprecate(
         'moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548',
         function () {
             var other = local__createLocal.apply(null, arguments);
             return other < this ? this : other;
         }
     );

    var prototypeMax = deprecate(
        'moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548',
        function () {
            var other = local__createLocal.apply(null, arguments);
            return other > this ? this : other;
        }
    );

    // Pick a moment m from moments so that m[fn](other) is true for all
    // other. This relies on the function fn to be transitive.
    //
    // moments should either be an array of moment objects or an array, whose
    // first element is an array of moment objects.
    function pickBy(fn, moments) {
        var res, i;
        if (moments.length === 1 && isArray(moments[0])) {
            moments = moments[0];
        }
        if (!moments.length) {
            return local__createLocal();
        }
        res = moments[0];
        for (i = 1; i < moments.length; ++i) {
            if (!moments[i].isValid() || moments[i][fn](res)) {
                res = moments[i];
            }
        }
        return res;
    }

    // TODO: Use [].sort instead?
    function min () {
        var args = [].slice.call(arguments, 0);

        return pickBy('isBefore', args);
    }

    function max () {
        var args = [].slice.call(arguments, 0);

        return pickBy('isAfter', args);
    }

    function Duration (duration) {
        var normalizedInput = normalizeObjectUnits(duration),
            years = normalizedInput.year || 0,
            quarters = normalizedInput.quarter || 0,
            months = normalizedInput.month || 0,
            weeks = normalizedInput.week || 0,
            days = normalizedInput.day || 0,
            hours = normalizedInput.hour || 0,
            minutes = normalizedInput.minute || 0,
            seconds = normalizedInput.second || 0,
            milliseconds = normalizedInput.millisecond || 0;

        // representation for dateAddRemove
        this._milliseconds = +milliseconds +
            seconds * 1e3 + // 1000
            minutes * 6e4 + // 1000 * 60
            hours * 36e5; // 1000 * 60 * 60
        // Because of dateAddRemove treats 24 hours as different from a
        // day when working around DST, we need to store them separately
        this._days = +days +
            weeks * 7;
        // It is impossible translate months into days without knowing
        // which months you are are talking about, so we have to store
        // it separately.
        this._months = +months +
            quarters * 3 +
            years * 12;

        this._data = {};

        this._locale = locale_locales__getLocale();

        this._bubble();
    }

    function isDuration (obj) {
        return obj instanceof Duration;
    }

    function offset (token, separator) {
        addFormatToken(token, 0, 0, function () {
            var offset = this.utcOffset();
            var sign = '+';
            if (offset < 0) {
                offset = -offset;
                sign = '-';
            }
            return sign + zeroFill(~~(offset / 60), 2) + separator + zeroFill(~~(offset) % 60, 2);
        });
    }

    offset('Z', ':');
    offset('ZZ', '');

    // PARSING

    addRegexToken('Z',  matchOffset);
    addRegexToken('ZZ', matchOffset);
    addParseToken(['Z', 'ZZ'], function (input, array, config) {
        config._useUTC = true;
        config._tzm = offsetFromString(input);
    });

    // HELPERS

    // timezone chunker
    // '+10:00' > ['10',  '00']
    // '-1530'  > ['-15', '30']
    var chunkOffset = /([\+\-]|\d\d)/gi;

    function offsetFromString(string) {
        var matches = ((string || '').match(matchOffset) || []);
        var chunk   = matches[matches.length - 1] || [];
        var parts   = (chunk + '').match(chunkOffset) || ['-', 0, 0];
        var minutes = +(parts[1] * 60) + toInt(parts[2]);

        return parts[0] === '+' ? minutes : -minutes;
    }

    // Return a moment from input, that is local/utc/zone equivalent to model.
    function cloneWithOffset(input, model) {
        var res, diff;
        if (model._isUTC) {
            res = model.clone();
            diff = (isMoment(input) || isDate(input) ? +input : +local__createLocal(input)) - (+res);
            // Use low-level api, because this fn is low-level api.
            res._d.setTime(+res._d + diff);
            utils_hooks__hooks.updateOffset(res, false);
            return res;
        } else {
            return local__createLocal(input).local();
        }
    }

    function getDateOffset (m) {
        // On Firefox.24 Date#getTimezoneOffset returns a floating point.
        // https://github.com/moment/moment/pull/1871
        return -Math.round(m._d.getTimezoneOffset() / 15) * 15;
    }

    // HOOKS

    // This function will be called whenever a moment is mutated.
    // It is intended to keep the offset in sync with the timezone.
    utils_hooks__hooks.updateOffset = function () {};

    // MOMENTS

    // keepLocalTime = true means only change the timezone, without
    // affecting the local hour. So 5:31:26 +0300 --[utcOffset(2, true)]-->
    // 5:31:26 +0200 It is possible that 5:31:26 doesn't exist with offset
    // +0200, so we adjust the time as needed, to be valid.
    //
    // Keeping the time actually adds/subtracts (one hour)
    // from the actual represented time. That is why we call updateOffset
    // a second time. In case it wants us to change the offset again
    // _changeInProgress == true case, then we have to adjust, because
    // there is no such time in the given timezone.
    function getSetOffset (input, keepLocalTime) {
        var offset = this._offset || 0,
            localAdjust;
        if (input != null) {
            if (typeof input === 'string') {
                input = offsetFromString(input);
            }
            if (Math.abs(input) < 16) {
                input = input * 60;
            }
            if (!this._isUTC && keepLocalTime) {
                localAdjust = getDateOffset(this);
            }
            this._offset = input;
            this._isUTC = true;
            if (localAdjust != null) {
                this.add(localAdjust, 'm');
            }
            if (offset !== input) {
                if (!keepLocalTime || this._changeInProgress) {
                    add_subtract__addSubtract(this, create__createDuration(input - offset, 'm'), 1, false);
                } else if (!this._changeInProgress) {
                    this._changeInProgress = true;
                    utils_hooks__hooks.updateOffset(this, true);
                    this._changeInProgress = null;
                }
            }
            return this;
        } else {
            return this._isUTC ? offset : getDateOffset(this);
        }
    }

    function getSetZone (input, keepLocalTime) {
        if (input != null) {
            if (typeof input !== 'string') {
                input = -input;
            }

            this.utcOffset(input, keepLocalTime);

            return this;
        } else {
            return -this.utcOffset();
        }
    }

    function setOffsetToUTC (keepLocalTime) {
        return this.utcOffset(0, keepLocalTime);
    }

    function setOffsetToLocal (keepLocalTime) {
        if (this._isUTC) {
            this.utcOffset(0, keepLocalTime);
            this._isUTC = false;

            if (keepLocalTime) {
                this.subtract(getDateOffset(this), 'm');
            }
        }
        return this;
    }

    function setOffsetToParsedOffset () {
        if (this._tzm) {
            this.utcOffset(this._tzm);
        } else if (typeof this._i === 'string') {
            this.utcOffset(offsetFromString(this._i));
        }
        return this;
    }

    function hasAlignedHourOffset (input) {
        input = input ? local__createLocal(input).utcOffset() : 0;

        return (this.utcOffset() - input) % 60 === 0;
    }

    function isDaylightSavingTime () {
        return (
            this.utcOffset() > this.clone().month(0).utcOffset() ||
            this.utcOffset() > this.clone().month(5).utcOffset()
        );
    }

    function isDaylightSavingTimeShifted () {
        if (typeof this._isDSTShifted !== 'undefined') {
            return this._isDSTShifted;
        }

        var c = {};

        copyConfig(c, this);
        c = prepareConfig(c);

        if (c._a) {
            var other = c._isUTC ? create_utc__createUTC(c._a) : local__createLocal(c._a);
            this._isDSTShifted = this.isValid() &&
                compareArrays(c._a, other.toArray()) > 0;
        } else {
            this._isDSTShifted = false;
        }

        return this._isDSTShifted;
    }

    function isLocal () {
        return !this._isUTC;
    }

    function isUtcOffset () {
        return this._isUTC;
    }

    function isUtc () {
        return this._isUTC && this._offset === 0;
    }

    var aspNetRegex = /(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/;

    // from http://docs.closure-library.googlecode.com/git/closure_goog_date_date.js.source.html
    // somewhat more in line with 4.4.3.2 2004 spec, but allows decimal anywhere
    var create__isoRegex = /^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;

    function create__createDuration (input, key) {
        var duration = input,
            // matching against regexp is expensive, do it on demand
            match = null,
            sign,
            ret,
            diffRes;

        if (isDuration(input)) {
            duration = {
                ms : input._milliseconds,
                d  : input._days,
                M  : input._months
            };
        } else if (typeof input === 'number') {
            duration = {};
            if (key) {
                duration[key] = input;
            } else {
                duration.milliseconds = input;
            }
        } else if (!!(match = aspNetRegex.exec(input))) {
            sign = (match[1] === '-') ? -1 : 1;
            duration = {
                y  : 0,
                d  : toInt(match[DATE])        * sign,
                h  : toInt(match[HOUR])        * sign,
                m  : toInt(match[MINUTE])      * sign,
                s  : toInt(match[SECOND])      * sign,
                ms : toInt(match[MILLISECOND]) * sign
            };
        } else if (!!(match = create__isoRegex.exec(input))) {
            sign = (match[1] === '-') ? -1 : 1;
            duration = {
                y : parseIso(match[2], sign),
                M : parseIso(match[3], sign),
                d : parseIso(match[4], sign),
                h : parseIso(match[5], sign),
                m : parseIso(match[6], sign),
                s : parseIso(match[7], sign),
                w : parseIso(match[8], sign)
            };
        } else if (duration == null) {// checks for null or undefined
            duration = {};
        } else if (typeof duration === 'object' && ('from' in duration || 'to' in duration)) {
            diffRes = momentsDifference(local__createLocal(duration.from), local__createLocal(duration.to));

            duration = {};
            duration.ms = diffRes.milliseconds;
            duration.M = diffRes.months;
        }

        ret = new Duration(duration);

        if (isDuration(input) && hasOwnProp(input, '_locale')) {
            ret._locale = input._locale;
        }

        return ret;
    }

    create__createDuration.fn = Duration.prototype;

    function parseIso (inp, sign) {
        // We'd normally use ~~inp for this, but unfortunately it also
        // converts floats to ints.
        // inp may be undefined, so careful calling replace on it.
        var res = inp && parseFloat(inp.replace(',', '.'));
        // apply sign while we're at it
        return (isNaN(res) ? 0 : res) * sign;
    }

    function positiveMomentsDifference(base, other) {
        var res = {milliseconds: 0, months: 0};

        res.months = other.month() - base.month() +
            (other.year() - base.year()) * 12;
        if (base.clone().add(res.months, 'M').isAfter(other)) {
            --res.months;
        }

        res.milliseconds = +other - +(base.clone().add(res.months, 'M'));

        return res;
    }

    function momentsDifference(base, other) {
        var res;
        other = cloneWithOffset(other, base);
        if (base.isBefore(other)) {
            res = positiveMomentsDifference(base, other);
        } else {
            res = positiveMomentsDifference(other, base);
            res.milliseconds = -res.milliseconds;
            res.months = -res.months;
        }

        return res;
    }

    function createAdder(direction, name) {
        return function (val, period) {
            var dur, tmp;
            //invert the arguments, but complain about it
            if (period !== null && !isNaN(+period)) {
                deprecateSimple(name, 'moment().' + name  + '(period, number) is deprecated. Please use moment().' + name + '(number, period).');
                tmp = val; val = period; period = tmp;
            }

            val = typeof val === 'string' ? +val : val;
            dur = create__createDuration(val, period);
            add_subtract__addSubtract(this, dur, direction);
            return this;
        };
    }

    function add_subtract__addSubtract (mom, duration, isAdding, updateOffset) {
        var milliseconds = duration._milliseconds,
            days = duration._days,
            months = duration._months;
        updateOffset = updateOffset == null ? true : updateOffset;

        if (milliseconds) {
            mom._d.setTime(+mom._d + milliseconds * isAdding);
        }
        if (days) {
            get_set__set(mom, 'Date', get_set__get(mom, 'Date') + days * isAdding);
        }
        if (months) {
            setMonth(mom, get_set__get(mom, 'Month') + months * isAdding);
        }
        if (updateOffset) {
            utils_hooks__hooks.updateOffset(mom, days || months);
        }
    }

    var add_subtract__add      = createAdder(1, 'add');
    var add_subtract__subtract = createAdder(-1, 'subtract');

    function moment_calendar__calendar (time, formats) {
        // We want to compare the start of today, vs this.
        // Getting start-of-today depends on whether we're local/utc/offset or not.
        var now = time || local__createLocal(),
            sod = cloneWithOffset(now, this).startOf('day'),
            diff = this.diff(sod, 'days', true),
            format = diff < -6 ? 'sameElse' :
                diff < -1 ? 'lastWeek' :
                diff < 0 ? 'lastDay' :
                diff < 1 ? 'sameDay' :
                diff < 2 ? 'nextDay' :
                diff < 7 ? 'nextWeek' : 'sameElse';
        return this.format(formats && formats[format] || this.localeData().calendar(format, this, local__createLocal(now)));
    }

    function clone () {
        return new Moment(this);
    }

    function isAfter (input, units) {
        var inputMs;
        units = normalizeUnits(typeof units !== 'undefined' ? units : 'millisecond');
        if (units === 'millisecond') {
            input = isMoment(input) ? input : local__createLocal(input);
            return +this > +input;
        } else {
            inputMs = isMoment(input) ? +input : +local__createLocal(input);
            return inputMs < +this.clone().startOf(units);
        }
    }

    function isBefore (input, units) {
        var inputMs;
        units = normalizeUnits(typeof units !== 'undefined' ? units : 'millisecond');
        if (units === 'millisecond') {
            input = isMoment(input) ? input : local__createLocal(input);
            return +this < +input;
        } else {
            inputMs = isMoment(input) ? +input : +local__createLocal(input);
            return +this.clone().endOf(units) < inputMs;
        }
    }

    function isBetween (from, to, units) {
        return this.isAfter(from, units) && this.isBefore(to, units);
    }

    function isSame (input, units) {
        var inputMs;
        units = normalizeUnits(units || 'millisecond');
        if (units === 'millisecond') {
            input = isMoment(input) ? input : local__createLocal(input);
            return +this === +input;
        } else {
            inputMs = +local__createLocal(input);
            return +(this.clone().startOf(units)) <= inputMs && inputMs <= +(this.clone().endOf(units));
        }
    }

    function diff (input, units, asFloat) {
        var that = cloneWithOffset(input, this),
            zoneDelta = (that.utcOffset() - this.utcOffset()) * 6e4,
            delta, output;

        units = normalizeUnits(units);

        if (units === 'year' || units === 'month' || units === 'quarter') {
            output = monthDiff(this, that);
            if (units === 'quarter') {
                output = output / 3;
            } else if (units === 'year') {
                output = output / 12;
            }
        } else {
            delta = this - that;
            output = units === 'second' ? delta / 1e3 : // 1000
                units === 'minute' ? delta / 6e4 : // 1000 * 60
                units === 'hour' ? delta / 36e5 : // 1000 * 60 * 60
                units === 'day' ? (delta - zoneDelta) / 864e5 : // 1000 * 60 * 60 * 24, negate dst
                units === 'week' ? (delta - zoneDelta) / 6048e5 : // 1000 * 60 * 60 * 24 * 7, negate dst
                delta;
        }
        return asFloat ? output : absFloor(output);
    }

    function monthDiff (a, b) {
        // difference in months
        var wholeMonthDiff = ((b.year() - a.year()) * 12) + (b.month() - a.month()),
            // b is in (anchor - 1 month, anchor + 1 month)
            anchor = a.clone().add(wholeMonthDiff, 'months'),
            anchor2, adjust;

        if (b - anchor < 0) {
            anchor2 = a.clone().add(wholeMonthDiff - 1, 'months');
            // linear across the month
            adjust = (b - anchor) / (anchor - anchor2);
        } else {
            anchor2 = a.clone().add(wholeMonthDiff + 1, 'months');
            // linear across the month
            adjust = (b - anchor) / (anchor2 - anchor);
        }

        return -(wholeMonthDiff + adjust);
    }

    utils_hooks__hooks.defaultFormat = 'YYYY-MM-DDTHH:mm:ssZ';

    function toString () {
        return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');
    }

    function moment_format__toISOString () {
        var m = this.clone().utc();
        if (0 < m.year() && m.year() <= 9999) {
            if ('function' === typeof Date.prototype.toISOString) {
                // native implementation is ~50x faster, use it when we can
                return this.toDate().toISOString();
            } else {
                return formatMoment(m, 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
            }
        } else {
            return formatMoment(m, 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
        }
    }

    function format (inputString) {
        var output = formatMoment(this, inputString || utils_hooks__hooks.defaultFormat);
        return this.localeData().postformat(output);
    }

    function from (time, withoutSuffix) {
        if (!this.isValid()) {
            return this.localeData().invalidDate();
        }
        return create__createDuration({to: this, from: time}).locale(this.locale()).humanize(!withoutSuffix);
    }

    function fromNow (withoutSuffix) {
        return this.from(local__createLocal(), withoutSuffix);
    }

    function to (time, withoutSuffix) {
        if (!this.isValid()) {
            return this.localeData().invalidDate();
        }
        return create__createDuration({from: this, to: time}).locale(this.locale()).humanize(!withoutSuffix);
    }

    function toNow (withoutSuffix) {
        return this.to(local__createLocal(), withoutSuffix);
    }

    function locale (key) {
        var newLocaleData;

        if (key === undefined) {
            return this._locale._abbr;
        } else {
            newLocaleData = locale_locales__getLocale(key);
            if (newLocaleData != null) {
                this._locale = newLocaleData;
            }
            return this;
        }
    }

    var lang = deprecate(
        'moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.',
        function (key) {
            if (key === undefined) {
                return this.localeData();
            } else {
                return this.locale(key);
            }
        }
    );

    function localeData () {
        return this._locale;
    }

    function startOf (units) {
        units = normalizeUnits(units);
        // the following switch intentionally omits break keywords
        // to utilize falling through the cases.
        switch (units) {
        case 'year':
            this.month(0);
            /* falls through */
        case 'quarter':
        case 'month':
            this.date(1);
            /* falls through */
        case 'week':
        case 'isoWeek':
        case 'day':
            this.hours(0);
            /* falls through */
        case 'hour':
            this.minutes(0);
            /* falls through */
        case 'minute':
            this.seconds(0);
            /* falls through */
        case 'second':
            this.milliseconds(0);
        }

        // weeks are a special case
        if (units === 'week') {
            this.weekday(0);
        }
        if (units === 'isoWeek') {
            this.isoWeekday(1);
        }

        // quarters are also special
        if (units === 'quarter') {
            this.month(Math.floor(this.month() / 3) * 3);
        }

        return this;
    }

    function endOf (units) {
        units = normalizeUnits(units);
        if (units === undefined || units === 'millisecond') {
            return this;
        }
        return this.startOf(units).add(1, (units === 'isoWeek' ? 'week' : units)).subtract(1, 'ms');
    }

    function to_type__valueOf () {
        return +this._d - ((this._offset || 0) * 60000);
    }

    function unix () {
        return Math.floor(+this / 1000);
    }

    function toDate () {
        return this._offset ? new Date(+this) : this._d;
    }

    function toArray () {
        var m = this;
        return [m.year(), m.month(), m.date(), m.hour(), m.minute(), m.second(), m.millisecond()];
    }

    function toObject () {
        var m = this;
        return {
            years: m.year(),
            months: m.month(),
            date: m.date(),
            hours: m.hours(),
            minutes: m.minutes(),
            seconds: m.seconds(),
            milliseconds: m.milliseconds()
        };
    }

    function moment_valid__isValid () {
        return valid__isValid(this);
    }

    function parsingFlags () {
        return extend({}, getParsingFlags(this));
    }

    function invalidAt () {
        return getParsingFlags(this).overflow;
    }

    addFormatToken(0, ['gg', 2], 0, function () {
        return this.weekYear() % 100;
    });

    addFormatToken(0, ['GG', 2], 0, function () {
        return this.isoWeekYear() % 100;
    });

    function addWeekYearFormatToken (token, getter) {
        addFormatToken(0, [token, token.length], 0, getter);
    }

    addWeekYearFormatToken('gggg',     'weekYear');
    addWeekYearFormatToken('ggggg',    'weekYear');
    addWeekYearFormatToken('GGGG',  'isoWeekYear');
    addWeekYearFormatToken('GGGGG', 'isoWeekYear');

    // ALIASES

    addUnitAlias('weekYear', 'gg');
    addUnitAlias('isoWeekYear', 'GG');

    // PARSING

    addRegexToken('G',      matchSigned);
    addRegexToken('g',      matchSigned);
    addRegexToken('GG',     match1to2, match2);
    addRegexToken('gg',     match1to2, match2);
    addRegexToken('GGGG',   match1to4, match4);
    addRegexToken('gggg',   match1to4, match4);
    addRegexToken('GGGGG',  match1to6, match6);
    addRegexToken('ggggg',  match1to6, match6);

    addWeekParseToken(['gggg', 'ggggg', 'GGGG', 'GGGGG'], function (input, week, config, token) {
        week[token.substr(0, 2)] = toInt(input);
    });

    addWeekParseToken(['gg', 'GG'], function (input, week, config, token) {
        week[token] = utils_hooks__hooks.parseTwoDigitYear(input);
    });

    // HELPERS

    function weeksInYear(year, dow, doy) {
        return weekOfYear(local__createLocal([year, 11, 31 + dow - doy]), dow, doy).week;
    }

    // MOMENTS

    function getSetWeekYear (input) {
        var year = weekOfYear(this, this.localeData()._week.dow, this.localeData()._week.doy).year;
        return input == null ? year : this.add((input - year), 'y');
    }

    function getSetISOWeekYear (input) {
        var year = weekOfYear(this, 1, 4).year;
        return input == null ? year : this.add((input - year), 'y');
    }

    function getISOWeeksInYear () {
        return weeksInYear(this.year(), 1, 4);
    }

    function getWeeksInYear () {
        var weekInfo = this.localeData()._week;
        return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);
    }

    addFormatToken('Q', 0, 0, 'quarter');

    // ALIASES

    addUnitAlias('quarter', 'Q');

    // PARSING

    addRegexToken('Q', match1);
    addParseToken('Q', function (input, array) {
        array[MONTH] = (toInt(input) - 1) * 3;
    });

    // MOMENTS

    function getSetQuarter (input) {
        return input == null ? Math.ceil((this.month() + 1) / 3) : this.month((input - 1) * 3 + this.month() % 3);
    }

    addFormatToken('D', ['DD', 2], 'Do', 'date');

    // ALIASES

    addUnitAlias('date', 'D');

    // PARSING

    addRegexToken('D',  match1to2);
    addRegexToken('DD', match1to2, match2);
    addRegexToken('Do', function (isStrict, locale) {
        return isStrict ? locale._ordinalParse : locale._ordinalParseLenient;
    });

    addParseToken(['D', 'DD'], DATE);
    addParseToken('Do', function (input, array) {
        array[DATE] = toInt(input.match(match1to2)[0], 10);
    });

    // MOMENTS

    var getSetDayOfMonth = makeGetSet('Date', true);

    addFormatToken('d', 0, 'do', 'day');

    addFormatToken('dd', 0, 0, function (format) {
        return this.localeData().weekdaysMin(this, format);
    });

    addFormatToken('ddd', 0, 0, function (format) {
        return this.localeData().weekdaysShort(this, format);
    });

    addFormatToken('dddd', 0, 0, function (format) {
        return this.localeData().weekdays(this, format);
    });

    addFormatToken('e', 0, 0, 'weekday');
    addFormatToken('E', 0, 0, 'isoWeekday');

    // ALIASES

    addUnitAlias('day', 'd');
    addUnitAlias('weekday', 'e');
    addUnitAlias('isoWeekday', 'E');

    // PARSING

    addRegexToken('d',    match1to2);
    addRegexToken('e',    match1to2);
    addRegexToken('E',    match1to2);
    addRegexToken('dd',   matchWord);
    addRegexToken('ddd',  matchWord);
    addRegexToken('dddd', matchWord);

    addWeekParseToken(['dd', 'ddd', 'dddd'], function (input, week, config) {
        var weekday = config._locale.weekdaysParse(input);
        // if we didn't get a weekday name, mark the date as invalid
        if (weekday != null) {
            week.d = weekday;
        } else {
            getParsingFlags(config).invalidWeekday = input;
        }
    });

    addWeekParseToken(['d', 'e', 'E'], function (input, week, config, token) {
        week[token] = toInt(input);
    });

    // HELPERS

    function parseWeekday(input, locale) {
        if (typeof input !== 'string') {
            return input;
        }

        if (!isNaN(input)) {
            return parseInt(input, 10);
        }

        input = locale.weekdaysParse(input);
        if (typeof input === 'number') {
            return input;
        }

        return null;
    }

    // LOCALES

    var defaultLocaleWeekdays = 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_');
    function localeWeekdays (m) {
        return this._weekdays[m.day()];
    }

    var defaultLocaleWeekdaysShort = 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_');
    function localeWeekdaysShort (m) {
        return this._weekdaysShort[m.day()];
    }

    var defaultLocaleWeekdaysMin = 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_');
    function localeWeekdaysMin (m) {
        return this._weekdaysMin[m.day()];
    }

    function localeWeekdaysParse (weekdayName) {
        var i, mom, regex;

        this._weekdaysParse = this._weekdaysParse || [];

        for (i = 0; i < 7; i++) {
            // make the regex if we don't have it already
            if (!this._weekdaysParse[i]) {
                mom = local__createLocal([2000, 1]).day(i);
                regex = '^' + this.weekdays(mom, '') + '|^' + this.weekdaysShort(mom, '') + '|^' + this.weekdaysMin(mom, '');
                this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');
            }
            // test the regex
            if (this._weekdaysParse[i].test(weekdayName)) {
                return i;
            }
        }
    }

    // MOMENTS

    function getSetDayOfWeek (input) {
        var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
        if (input != null) {
            input = parseWeekday(input, this.localeData());
            return this.add(input - day, 'd');
        } else {
            return day;
        }
    }

    function getSetLocaleDayOfWeek (input) {
        var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;
        return input == null ? weekday : this.add(input - weekday, 'd');
    }

    function getSetISODayOfWeek (input) {
        // behaves the same as moment#day except
        // as a getter, returns 7 instead of 0 (1-7 range instead of 0-6)
        // as a setter, sunday should belong to the previous week.
        return input == null ? this.day() || 7 : this.day(this.day() % 7 ? input : input - 7);
    }

    addFormatToken('H', ['HH', 2], 0, 'hour');
    addFormatToken('h', ['hh', 2], 0, function () {
        return this.hours() % 12 || 12;
    });

    function meridiem (token, lowercase) {
        addFormatToken(token, 0, 0, function () {
            return this.localeData().meridiem(this.hours(), this.minutes(), lowercase);
        });
    }

    meridiem('a', true);
    meridiem('A', false);

    // ALIASES

    addUnitAlias('hour', 'h');

    // PARSING

    function matchMeridiem (isStrict, locale) {
        return locale._meridiemParse;
    }

    addRegexToken('a',  matchMeridiem);
    addRegexToken('A',  matchMeridiem);
    addRegexToken('H',  match1to2);
    addRegexToken('h',  match1to2);
    addRegexToken('HH', match1to2, match2);
    addRegexToken('hh', match1to2, match2);

    addParseToken(['H', 'HH'], HOUR);
    addParseToken(['a', 'A'], function (input, array, config) {
        config._isPm = config._locale.isPM(input);
        config._meridiem = input;
    });
    addParseToken(['h', 'hh'], function (input, array, config) {
        array[HOUR] = toInt(input);
        getParsingFlags(config).bigHour = true;
    });

    // LOCALES

    function localeIsPM (input) {
        // IE8 Quirks Mode & IE7 Standards Mode do not allow accessing strings like arrays
        // Using charAt should be more compatible.
        return ((input + '').toLowerCase().charAt(0) === 'p');
    }

    var defaultLocaleMeridiemParse = /[ap]\.?m?\.?/i;
    function localeMeridiem (hours, minutes, isLower) {
        if (hours > 11) {
            return isLower ? 'pm' : 'PM';
        } else {
            return isLower ? 'am' : 'AM';
        }
    }


    // MOMENTS

    // Setting the hour should keep the time, because the user explicitly
    // specified which hour he wants. So trying to maintain the same hour (in
    // a new timezone) makes sense. Adding/subtracting hours does not follow
    // this rule.
    var getSetHour = makeGetSet('Hours', true);

    addFormatToken('m', ['mm', 2], 0, 'minute');

    // ALIASES

    addUnitAlias('minute', 'm');

    // PARSING

    addRegexToken('m',  match1to2);
    addRegexToken('mm', match1to2, match2);
    addParseToken(['m', 'mm'], MINUTE);

    // MOMENTS

    var getSetMinute = makeGetSet('Minutes', false);

    addFormatToken('s', ['ss', 2], 0, 'second');

    // ALIASES

    addUnitAlias('second', 's');

    // PARSING

    addRegexToken('s',  match1to2);
    addRegexToken('ss', match1to2, match2);
    addParseToken(['s', 'ss'], SECOND);

    // MOMENTS

    var getSetSecond = makeGetSet('Seconds', false);

    addFormatToken('S', 0, 0, function () {
        return ~~(this.millisecond() / 100);
    });

    addFormatToken(0, ['SS', 2], 0, function () {
        return ~~(this.millisecond() / 10);
    });

    addFormatToken(0, ['SSS', 3], 0, 'millisecond');
    addFormatToken(0, ['SSSS', 4], 0, function () {
        return this.millisecond() * 10;
    });
    addFormatToken(0, ['SSSSS', 5], 0, function () {
        return this.millisecond() * 100;
    });
    addFormatToken(0, ['SSSSSS', 6], 0, function () {
        return this.millisecond() * 1000;
    });
    addFormatToken(0, ['SSSSSSS', 7], 0, function () {
        return this.millisecond() * 10000;
    });
    addFormatToken(0, ['SSSSSSSS', 8], 0, function () {
        return this.millisecond() * 100000;
    });
    addFormatToken(0, ['SSSSSSSSS', 9], 0, function () {
        return this.millisecond() * 1000000;
    });


    // ALIASES

    addUnitAlias('millisecond', 'ms');

    // PARSING

    addRegexToken('S',    match1to3, match1);
    addRegexToken('SS',   match1to3, match2);
    addRegexToken('SSS',  match1to3, match3);

    var token;
    for (token = 'SSSS'; token.length <= 9; token += 'S') {
        addRegexToken(token, matchUnsigned);
    }

    function parseMs(input, array) {
        array[MILLISECOND] = toInt(('0.' + input) * 1000);
    }

    for (token = 'S'; token.length <= 9; token += 'S') {
        addParseToken(token, parseMs);
    }
    // MOMENTS

    var getSetMillisecond = makeGetSet('Milliseconds', false);

    addFormatToken('z',  0, 0, 'zoneAbbr');
    addFormatToken('zz', 0, 0, 'zoneName');

    // MOMENTS

    function getZoneAbbr () {
        return this._isUTC ? 'UTC' : '';
    }

    function getZoneName () {
        return this._isUTC ? 'Coordinated Universal Time' : '';
    }

    var momentPrototype__proto = Moment.prototype;

    momentPrototype__proto.add          = add_subtract__add;
    momentPrototype__proto.calendar     = moment_calendar__calendar;
    momentPrototype__proto.clone        = clone;
    momentPrototype__proto.diff         = diff;
    momentPrototype__proto.endOf        = endOf;
    momentPrototype__proto.format       = format;
    momentPrototype__proto.from         = from;
    momentPrototype__proto.fromNow      = fromNow;
    momentPrototype__proto.to           = to;
    momentPrototype__proto.toNow        = toNow;
    momentPrototype__proto.get          = getSet;
    momentPrototype__proto.invalidAt    = invalidAt;
    momentPrototype__proto.isAfter      = isAfter;
    momentPrototype__proto.isBefore     = isBefore;
    momentPrototype__proto.isBetween    = isBetween;
    momentPrototype__proto.isSame       = isSame;
    momentPrototype__proto.isValid      = moment_valid__isValid;
    momentPrototype__proto.lang         = lang;
    momentPrototype__proto.locale       = locale;
    momentPrototype__proto.localeData   = localeData;
    momentPrototype__proto.max          = prototypeMax;
    momentPrototype__proto.min          = prototypeMin;
    momentPrototype__proto.parsingFlags = parsingFlags;
    momentPrototype__proto.set          = getSet;
    momentPrototype__proto.startOf      = startOf;
    momentPrototype__proto.subtract     = add_subtract__subtract;
    momentPrototype__proto.toArray      = toArray;
    momentPrototype__proto.toObject     = toObject;
    momentPrototype__proto.toDate       = toDate;
    momentPrototype__proto.toISOString  = moment_format__toISOString;
    momentPrototype__proto.toJSON       = moment_format__toISOString;
    momentPrototype__proto.toString     = toString;
    momentPrototype__proto.unix         = unix;
    momentPrototype__proto.valueOf      = to_type__valueOf;

    // Year
    momentPrototype__proto.year       = getSetYear;
    momentPrototype__proto.isLeapYear = getIsLeapYear;

    // Week Year
    momentPrototype__proto.weekYear    = getSetWeekYear;
    momentPrototype__proto.isoWeekYear = getSetISOWeekYear;

    // Quarter
    momentPrototype__proto.quarter = momentPrototype__proto.quarters = getSetQuarter;

    // Month
    momentPrototype__proto.month       = getSetMonth;
    momentPrototype__proto.daysInMonth = getDaysInMonth;

    // Week
    momentPrototype__proto.week           = momentPrototype__proto.weeks        = getSetWeek;
    momentPrototype__proto.isoWeek        = momentPrototype__proto.isoWeeks     = getSetISOWeek;
    momentPrototype__proto.weeksInYear    = getWeeksInYear;
    momentPrototype__proto.isoWeeksInYear = getISOWeeksInYear;

    // Day
    momentPrototype__proto.date       = getSetDayOfMonth;
    momentPrototype__proto.day        = momentPrototype__proto.days             = getSetDayOfWeek;
    momentPrototype__proto.weekday    = getSetLocaleDayOfWeek;
    momentPrototype__proto.isoWeekday = getSetISODayOfWeek;
    momentPrototype__proto.dayOfYear  = getSetDayOfYear;

    // Hour
    momentPrototype__proto.hour = momentPrototype__proto.hours = getSetHour;

    // Minute
    momentPrototype__proto.minute = momentPrototype__proto.minutes = getSetMinute;

    // Second
    momentPrototype__proto.second = momentPrototype__proto.seconds = getSetSecond;

    // Millisecond
    momentPrototype__proto.millisecond = momentPrototype__proto.milliseconds = getSetMillisecond;

    // Offset
    momentPrototype__proto.utcOffset            = getSetOffset;
    momentPrototype__proto.utc                  = setOffsetToUTC;
    momentPrototype__proto.local                = setOffsetToLocal;
    momentPrototype__proto.parseZone            = setOffsetToParsedOffset;
    momentPrototype__proto.hasAlignedHourOffset = hasAlignedHourOffset;
    momentPrototype__proto.isDST                = isDaylightSavingTime;
    momentPrototype__proto.isDSTShifted         = isDaylightSavingTimeShifted;
    momentPrototype__proto.isLocal              = isLocal;
    momentPrototype__proto.isUtcOffset          = isUtcOffset;
    momentPrototype__proto.isUtc                = isUtc;
    momentPrototype__proto.isUTC                = isUtc;

    // Timezone
    momentPrototype__proto.zoneAbbr = getZoneAbbr;
    momentPrototype__proto.zoneName = getZoneName;

    // Deprecations
    momentPrototype__proto.dates  = deprecate('dates accessor is deprecated. Use date instead.', getSetDayOfMonth);
    momentPrototype__proto.months = deprecate('months accessor is deprecated. Use month instead', getSetMonth);
    momentPrototype__proto.years  = deprecate('years accessor is deprecated. Use year instead', getSetYear);
    momentPrototype__proto.zone   = deprecate('moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779', getSetZone);

    var momentPrototype = momentPrototype__proto;

    function moment__createUnix (input) {
        return local__createLocal(input * 1000);
    }

    function moment__createInZone () {
        return local__createLocal.apply(null, arguments).parseZone();
    }

    var defaultCalendar = {
        sameDay : '[Today at] LT',
        nextDay : '[Tomorrow at] LT',
        nextWeek : 'dddd [at] LT',
        lastDay : '[Yesterday at] LT',
        lastWeek : '[Last] dddd [at] LT',
        sameElse : 'L'
    };

    function locale_calendar__calendar (key, mom, now) {
        var output = this._calendar[key];
        return typeof output === 'function' ? output.call(mom, now) : output;
    }

    var defaultLongDateFormat = {
        LTS  : 'h:mm:ss A',
        LT   : 'h:mm A',
        L    : 'MM/DD/YYYY',
        LL   : 'MMMM D, YYYY',
        LLL  : 'MMMM D, YYYY h:mm A',
        LLLL : 'dddd, MMMM D, YYYY h:mm A'
    };

    function longDateFormat (key) {
        var format = this._longDateFormat[key],
            formatUpper = this._longDateFormat[key.toUpperCase()];

        if (format || !formatUpper) {
            return format;
        }

        this._longDateFormat[key] = formatUpper.replace(/MMMM|MM|DD|dddd/g, function (val) {
            return val.slice(1);
        });

        return this._longDateFormat[key];
    }

    var defaultInvalidDate = 'Invalid date';

    function invalidDate () {
        return this._invalidDate;
    }

    var defaultOrdinal = '%d';
    var defaultOrdinalParse = /\d{1,2}/;

    function ordinal (number) {
        return this._ordinal.replace('%d', number);
    }

    function preParsePostFormat (string) {
        return string;
    }

    var defaultRelativeTime = {
        future : 'in %s',
        past   : '%s ago',
        s  : 'a few seconds',
        m  : 'a minute',
        mm : '%d minutes',
        h  : 'an hour',
        hh : '%d hours',
        d  : 'a day',
        dd : '%d days',
        M  : 'a month',
        MM : '%d months',
        y  : 'a year',
        yy : '%d years'
    };

    function relative__relativeTime (number, withoutSuffix, string, isFuture) {
        var output = this._relativeTime[string];
        return (typeof output === 'function') ?
            output(number, withoutSuffix, string, isFuture) :
            output.replace(/%d/i, number);
    }

    function pastFuture (diff, output) {
        var format = this._relativeTime[diff > 0 ? 'future' : 'past'];
        return typeof format === 'function' ? format(output) : format.replace(/%s/i, output);
    }

    function locale_set__set (config) {
        var prop, i;
        for (i in config) {
            prop = config[i];
            if (typeof prop === 'function') {
                this[i] = prop;
            } else {
                this['_' + i] = prop;
            }
        }
        // Lenient ordinal parsing accepts just a number in addition to
        // number + (possibly) stuff coming from _ordinalParseLenient.
        this._ordinalParseLenient = new RegExp(this._ordinalParse.source + '|' + (/\d{1,2}/).source);
    }

    var prototype__proto = Locale.prototype;

    prototype__proto._calendar       = defaultCalendar;
    prototype__proto.calendar        = locale_calendar__calendar;
    prototype__proto._longDateFormat = defaultLongDateFormat;
    prototype__proto.longDateFormat  = longDateFormat;
    prototype__proto._invalidDate    = defaultInvalidDate;
    prototype__proto.invalidDate     = invalidDate;
    prototype__proto._ordinal        = defaultOrdinal;
    prototype__proto.ordinal         = ordinal;
    prototype__proto._ordinalParse   = defaultOrdinalParse;
    prototype__proto.preparse        = preParsePostFormat;
    prototype__proto.postformat      = preParsePostFormat;
    prototype__proto._relativeTime   = defaultRelativeTime;
    prototype__proto.relativeTime    = relative__relativeTime;
    prototype__proto.pastFuture      = pastFuture;
    prototype__proto.set             = locale_set__set;

    // Month
    prototype__proto.months       =        localeMonths;
    prototype__proto._months      = defaultLocaleMonths;
    prototype__proto.monthsShort  =        localeMonthsShort;
    prototype__proto._monthsShort = defaultLocaleMonthsShort;
    prototype__proto.monthsParse  =        localeMonthsParse;

    // Week
    prototype__proto.week = localeWeek;
    prototype__proto._week = defaultLocaleWeek;
    prototype__proto.firstDayOfYear = localeFirstDayOfYear;
    prototype__proto.firstDayOfWeek = localeFirstDayOfWeek;

    // Day of Week
    prototype__proto.weekdays       =        localeWeekdays;
    prototype__proto._weekdays      = defaultLocaleWeekdays;
    prototype__proto.weekdaysMin    =        localeWeekdaysMin;
    prototype__proto._weekdaysMin   = defaultLocaleWeekdaysMin;
    prototype__proto.weekdaysShort  =        localeWeekdaysShort;
    prototype__proto._weekdaysShort = defaultLocaleWeekdaysShort;
    prototype__proto.weekdaysParse  =        localeWeekdaysParse;

    // Hours
    prototype__proto.isPM = localeIsPM;
    prototype__proto._meridiemParse = defaultLocaleMeridiemParse;
    prototype__proto.meridiem = localeMeridiem;

    function lists__get (format, index, field, setter) {
        var locale = locale_locales__getLocale();
        var utc = create_utc__createUTC().set(setter, index);
        return locale[field](utc, format);
    }

    function list (format, index, field, count, setter) {
        if (typeof format === 'number') {
            index = format;
            format = undefined;
        }

        format = format || '';

        if (index != null) {
            return lists__get(format, index, field, setter);
        }

        var i;
        var out = [];
        for (i = 0; i < count; i++) {
            out[i] = lists__get(format, i, field, setter);
        }
        return out;
    }

    function lists__listMonths (format, index) {
        return list(format, index, 'months', 12, 'month');
    }

    function lists__listMonthsShort (format, index) {
        return list(format, index, 'monthsShort', 12, 'month');
    }

    function lists__listWeekdays (format, index) {
        return list(format, index, 'weekdays', 7, 'day');
    }

    function lists__listWeekdaysShort (format, index) {
        return list(format, index, 'weekdaysShort', 7, 'day');
    }

    function lists__listWeekdaysMin (format, index) {
        return list(format, index, 'weekdaysMin', 7, 'day');
    }

    locale_locales__getSetGlobalLocale('en', {
        ordinalParse: /\d{1,2}(th|st|nd|rd)/,
        ordinal : function (number) {
            var b = number % 10,
                output = (toInt(number % 100 / 10) === 1) ? 'th' :
                (b === 1) ? 'st' :
                (b === 2) ? 'nd' :
                (b === 3) ? 'rd' : 'th';
            return number + output;
        }
    });

    // Side effect imports
    utils_hooks__hooks.lang = deprecate('moment.lang is deprecated. Use moment.locale instead.', locale_locales__getSetGlobalLocale);
    utils_hooks__hooks.langData = deprecate('moment.langData is deprecated. Use moment.localeData instead.', locale_locales__getLocale);

    var mathAbs = Math.abs;

    function duration_abs__abs () {
        var data           = this._data;

        this._milliseconds = mathAbs(this._milliseconds);
        this._days         = mathAbs(this._days);
        this._months       = mathAbs(this._months);

        data.milliseconds  = mathAbs(data.milliseconds);
        data.seconds       = mathAbs(data.seconds);
        data.minutes       = mathAbs(data.minutes);
        data.hours         = mathAbs(data.hours);
        data.months        = mathAbs(data.months);
        data.years         = mathAbs(data.years);

        return this;
    }

    function duration_add_subtract__addSubtract (duration, input, value, direction) {
        var other = create__createDuration(input, value);

        duration._milliseconds += direction * other._milliseconds;
        duration._days         += direction * other._days;
        duration._months       += direction * other._months;

        return duration._bubble();
    }

    // supports only 2.0-style add(1, 's') or add(duration)
    function duration_add_subtract__add (input, value) {
        return duration_add_subtract__addSubtract(this, input, value, 1);
    }

    // supports only 2.0-style subtract(1, 's') or subtract(duration)
    function duration_add_subtract__subtract (input, value) {
        return duration_add_subtract__addSubtract(this, input, value, -1);
    }

    function absCeil (number) {
        if (number < 0) {
            return Math.floor(number);
        } else {
            return Math.ceil(number);
        }
    }

    function bubble () {
        var milliseconds = this._milliseconds;
        var days         = this._days;
        var months       = this._months;
        var data         = this._data;
        var seconds, minutes, hours, years, monthsFromDays;

        // if we have a mix of positive and negative values, bubble down first
        // check: https://github.com/moment/moment/issues/2166
        if (!((milliseconds >= 0 && days >= 0 && months >= 0) ||
                (milliseconds <= 0 && days <= 0 && months <= 0))) {
            milliseconds += absCeil(monthsToDays(months) + days) * 864e5;
            days = 0;
            months = 0;
        }

        // The following code bubbles up values, see the tests for
        // examples of what that means.
        data.milliseconds = milliseconds % 1000;

        seconds           = absFloor(milliseconds / 1000);
        data.seconds      = seconds % 60;

        minutes           = absFloor(seconds / 60);
        data.minutes      = minutes % 60;

        hours             = absFloor(minutes / 60);
        data.hours        = hours % 24;

        days += absFloor(hours / 24);

        // convert days to months
        monthsFromDays = absFloor(daysToMonths(days));
        months += monthsFromDays;
        days -= absCeil(monthsToDays(monthsFromDays));

        // 12 months -> 1 year
        years = absFloor(months / 12);
        months %= 12;

        data.days   = days;
        data.months = months;
        data.years  = years;

        return this;
    }

    function daysToMonths (days) {
        // 400 years have 146097 days (taking into account leap year rules)
        // 400 years have 12 months === 4800
        return days * 4800 / 146097;
    }

    function monthsToDays (months) {
        // the reverse of daysToMonths
        return months * 146097 / 4800;
    }

    function as (units) {
        var days;
        var months;
        var milliseconds = this._milliseconds;

        units = normalizeUnits(units);

        if (units === 'month' || units === 'year') {
            days   = this._days   + milliseconds / 864e5;
            months = this._months + daysToMonths(days);
            return units === 'month' ? months : months / 12;
        } else {
            // handle milliseconds separately because of floating point math errors (issue #1867)
            days = this._days + Math.round(monthsToDays(this._months));
            switch (units) {
                case 'week'   : return days / 7     + milliseconds / 6048e5;
                case 'day'    : return days         + milliseconds / 864e5;
                case 'hour'   : return days * 24    + milliseconds / 36e5;
                case 'minute' : return days * 1440  + milliseconds / 6e4;
                case 'second' : return days * 86400 + milliseconds / 1000;
                // Math.floor prevents floating point math errors here
                case 'millisecond': return Math.floor(days * 864e5) + milliseconds;
                default: throw new Error('Unknown unit ' + units);
            }
        }
    }

    // TODO: Use this.as('ms')?
    function duration_as__valueOf () {
        return (
            this._milliseconds +
            this._days * 864e5 +
            (this._months % 12) * 2592e6 +
            toInt(this._months / 12) * 31536e6
        );
    }

    function makeAs (alias) {
        return function () {
            return this.as(alias);
        };
    }

    var asMilliseconds = makeAs('ms');
    var asSeconds      = makeAs('s');
    var asMinutes      = makeAs('m');
    var asHours        = makeAs('h');
    var asDays         = makeAs('d');
    var asWeeks        = makeAs('w');
    var asMonths       = makeAs('M');
    var asYears        = makeAs('y');

    function duration_get__get (units) {
        units = normalizeUnits(units);
        return this[units + 's']();
    }

    function makeGetter(name) {
        return function () {
            return this._data[name];
        };
    }

    var milliseconds = makeGetter('milliseconds');
    var seconds      = makeGetter('seconds');
    var minutes      = makeGetter('minutes');
    var hours        = makeGetter('hours');
    var days         = makeGetter('days');
    var months       = makeGetter('months');
    var years        = makeGetter('years');

    function weeks () {
        return absFloor(this.days() / 7);
    }

    var round = Math.round;
    var thresholds = {
        s: 45,  // seconds to minute
        m: 45,  // minutes to hour
        h: 22,  // hours to day
        d: 26,  // days to month
        M: 11   // months to year
    };

    // helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize
    function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {
        return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture);
    }

    function duration_humanize__relativeTime (posNegDuration, withoutSuffix, locale) {
        var duration = create__createDuration(posNegDuration).abs();
        var seconds  = round(duration.as('s'));
        var minutes  = round(duration.as('m'));
        var hours    = round(duration.as('h'));
        var days     = round(duration.as('d'));
        var months   = round(duration.as('M'));
        var years    = round(duration.as('y'));

        var a = seconds < thresholds.s && ['s', seconds]  ||
                minutes === 1          && ['m']           ||
                minutes < thresholds.m && ['mm', minutes] ||
                hours   === 1          && ['h']           ||
                hours   < thresholds.h && ['hh', hours]   ||
                days    === 1          && ['d']           ||
                days    < thresholds.d && ['dd', days]    ||
                months  === 1          && ['M']           ||
                months  < thresholds.M && ['MM', months]  ||
                years   === 1          && ['y']           || ['yy', years];

        a[2] = withoutSuffix;
        a[3] = +posNegDuration > 0;
        a[4] = locale;
        return substituteTimeAgo.apply(null, a);
    }

    // This function allows you to set a threshold for relative time strings
    function duration_humanize__getSetRelativeTimeThreshold (threshold, limit) {
        if (thresholds[threshold] === undefined) {
            return false;
        }
        if (limit === undefined) {
            return thresholds[threshold];
        }
        thresholds[threshold] = limit;
        return true;
    }

    function humanize (withSuffix) {
        var locale = this.localeData();
        var output = duration_humanize__relativeTime(this, !withSuffix, locale);

        if (withSuffix) {
            output = locale.pastFuture(+this, output);
        }

        return locale.postformat(output);
    }

    var iso_string__abs = Math.abs;

    function iso_string__toISOString() {
        // for ISO strings we do not use the normal bubbling rules:
        //  * milliseconds bubble up until they become hours
        //  * days do not bubble at all
        //  * months bubble up until they become years
        // This is because there is no context-free conversion between hours and days
        // (think of clock changes)
        // and also not between days and months (28-31 days per month)
        var seconds = iso_string__abs(this._milliseconds) / 1000;
        var days         = iso_string__abs(this._days);
        var months       = iso_string__abs(this._months);
        var minutes, hours, years;

        // 3600 seconds -> 60 minutes -> 1 hour
        minutes           = absFloor(seconds / 60);
        hours             = absFloor(minutes / 60);
        seconds %= 60;
        minutes %= 60;

        // 12 months -> 1 year
        years  = absFloor(months / 12);
        months %= 12;


        // inspired by https://github.com/dordille/moment-isoduration/blob/master/moment.isoduration.js
        var Y = years;
        var M = months;
        var D = days;
        var h = hours;
        var m = minutes;
        var s = seconds;
        var total = this.asSeconds();

        if (!total) {
            // this is the same as C#'s (Noda) and python (isodate)...
            // but not other JS (goog.date)
            return 'P0D';
        }

        return (total < 0 ? '-' : '') +
            'P' +
            (Y ? Y + 'Y' : '') +
            (M ? M + 'M' : '') +
            (D ? D + 'D' : '') +
            ((h || m || s) ? 'T' : '') +
            (h ? h + 'H' : '') +
            (m ? m + 'M' : '') +
            (s ? s + 'S' : '');
    }

    var duration_prototype__proto = Duration.prototype;

    duration_prototype__proto.abs            = duration_abs__abs;
    duration_prototype__proto.add            = duration_add_subtract__add;
    duration_prototype__proto.subtract       = duration_add_subtract__subtract;
    duration_prototype__proto.as             = as;
    duration_prototype__proto.asMilliseconds = asMilliseconds;
    duration_prototype__proto.asSeconds      = asSeconds;
    duration_prototype__proto.asMinutes      = asMinutes;
    duration_prototype__proto.asHours        = asHours;
    duration_prototype__proto.asDays         = asDays;
    duration_prototype__proto.asWeeks        = asWeeks;
    duration_prototype__proto.asMonths       = asMonths;
    duration_prototype__proto.asYears        = asYears;
    duration_prototype__proto.valueOf        = duration_as__valueOf;
    duration_prototype__proto._bubble        = bubble;
    duration_prototype__proto.get            = duration_get__get;
    duration_prototype__proto.milliseconds   = milliseconds;
    duration_prototype__proto.seconds        = seconds;
    duration_prototype__proto.minutes        = minutes;
    duration_prototype__proto.hours          = hours;
    duration_prototype__proto.days           = days;
    duration_prototype__proto.weeks          = weeks;
    duration_prototype__proto.months         = months;
    duration_prototype__proto.years          = years;
    duration_prototype__proto.humanize       = humanize;
    duration_prototype__proto.toISOString    = iso_string__toISOString;
    duration_prototype__proto.toString       = iso_string__toISOString;
    duration_prototype__proto.toJSON         = iso_string__toISOString;
    duration_prototype__proto.locale         = locale;
    duration_prototype__proto.localeData     = localeData;

    // Deprecations
    duration_prototype__proto.toIsoString = deprecate('toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)', iso_string__toISOString);
    duration_prototype__proto.lang = lang;

    // Side effect imports

    addFormatToken('X', 0, 0, 'unix');
    addFormatToken('x', 0, 0, 'valueOf');

    // PARSING

    addRegexToken('x', matchSigned);
    addRegexToken('X', matchTimestamp);
    addParseToken('X', function (input, array, config) {
        config._d = new Date(parseFloat(input, 10) * 1000);
    });
    addParseToken('x', function (input, array, config) {
        config._d = new Date(toInt(input));
    });

    // Side effect imports


    utils_hooks__hooks.version = '2.10.6';

    setHookCallback(local__createLocal);

    utils_hooks__hooks.fn                    = momentPrototype;
    utils_hooks__hooks.min                   = min;
    utils_hooks__hooks.max                   = max;
    utils_hooks__hooks.utc                   = create_utc__createUTC;
    utils_hooks__hooks.unix                  = moment__createUnix;
    utils_hooks__hooks.months                = lists__listMonths;
    utils_hooks__hooks.isDate                = isDate;
    utils_hooks__hooks.locale                = locale_locales__getSetGlobalLocale;
    utils_hooks__hooks.invalid               = valid__createInvalid;
    utils_hooks__hooks.duration              = create__createDuration;
    utils_hooks__hooks.isMoment              = isMoment;
    utils_hooks__hooks.weekdays              = lists__listWeekdays;
    utils_hooks__hooks.parseZone             = moment__createInZone;
    utils_hooks__hooks.localeData            = locale_locales__getLocale;
    utils_hooks__hooks.isDuration            = isDuration;
    utils_hooks__hooks.monthsShort           = lists__listMonthsShort;
    utils_hooks__hooks.weekdaysMin           = lists__listWeekdaysMin;
    utils_hooks__hooks.defineLocale          = defineLocale;
    utils_hooks__hooks.weekdaysShort         = lists__listWeekdaysShort;
    utils_hooks__hooks.normalizeUnits        = normalizeUnits;
    utils_hooks__hooks.relativeTimeThreshold = duration_humanize__getSetRelativeTimeThreshold;

    var _moment = utils_hooks__hooks;

    return _moment;

}));
/**
 * carouselar v0.1.0 (http://tamerayd.in/carouselar)
 * Copyright 2015 Tamer Aydin (http://tamerayd.in)
 * Licensed under MIT
 */
(function(window, angular, undefined) {
  'use strict';

  angular
    .module('carouselar.constants', [])
    .constant('CarouselarConstants', {
      RESIZE_TIMEOUT: 300,
      MAX_DISPLAYING_IMAGE: 5,
      BREAKPOINTS: {
        LANDSCAPE: 960,
        PORTRAIT: 640
      }
    });

})(window, window.angular);

(function(window, angular, undefined) {
  'use strict';

  angular
    .module('carouselar.controllers', ['carouselar.constants'])
    .controller('CarouselarController', [
      '$scope', '$timeout', '$window', 'CarouselarConstants',
      function($scope, $timeout, $window, CarouselarConstants) {
        $scope.visibleImages = [];
        $scope.maxImageCount = 1;
        $scope.displayingImageCount = 0;

        $scope.activeSection = 0;
        $scope.sectionCount = 5;
        $scope.containerPosition = 'translateX(0)';
        $scope.singleImageWidth = '100%';

        $scope.createArray = function(num) {
          return new Array(num || 0);
        };

        $scope.prev = function() {
          $scope.moveToSection($scope.activeSection - 1);
        };

        $scope.next = function() {
          $scope.moveToSection($scope.activeSection + 1);
        };

        $scope.moveToSection = function(sectionIndex) {
          if (sectionIndex >= $scope.sectionCount) {
            $scope.activeSection = 0;

          } else if (sectionIndex < 0) {
            $scope.activeSection = $scope.sectionCount - 1;

          } else {
            $scope.activeSection = sectionIndex;
          }

          // update container position & visible images:
          var pos;
          var imagePercentage = 100 / $scope.displayingImageCount;
          var visibleImages = [];
          var i;

          if ($scope.activeSection === $scope.sectionCount - 1) { // last section
            pos = ($scope.images.length - $scope.displayingImageCount) * imagePercentage;

            for (i = 0; i < $scope.displayingImageCount + 1; i++) {
              visibleImages.push($scope.images.length - i);
            }

          } else {
            var firstVisibleImageIndex = $scope.activeSection * $scope.displayingImageCount;

            visibleImages.push(firstVisibleImageIndex);
            for (i = 1; i < $scope.displayingImageCount; i++) {
              visibleImages.push(firstVisibleImageIndex + i);
            }

            pos = firstVisibleImageIndex * imagePercentage;
          }

          $scope.containerPosition = 'translateX(-' + pos + '%)';
          $scope.visibleImages = visibleImages;
        };

        $scope.resizeTimer = null;
        $scope.onResize = function(event, _width) {
          $timeout.cancel($scope.resizeTimer);
          $scope.resizeTimer = $timeout(function() {
            var displayingImageCount = $scope.maxImageCount;
            var windowWidth = _width || $window.innerWidth;

            if (windowWidth < CarouselarConstants.BREAKPOINTS.LANDSCAPE) {
              displayingImageCount = Math.ceil($scope.maxImageCount / 2);

              if (windowWidth < CarouselarConstants.BREAKPOINTS.PORTRAIT) {
                displayingImageCount = 1;
              }
            }

            $scope.displayingImageCount = displayingImageCount;
          }, CarouselarConstants.RESIZE_TIMEOUT);
        };

        $scope.$watch('displayingImageCount', function(newValue) {
          if (newValue) {
            $scope.sectionCount = Math.ceil(
              $scope.images.length / $scope.displayingImageCount);
            $scope.moveToSection($scope.activeSection); //TODO: keep first image in sight
            $scope.singleImageWidth = (100 / newValue) + '%';
          }
        });

        $scope.isImageVisible = function(imageIndex) {
          return $scope.visibleImages.indexOf(imageIndex) > -1;
        };
      }
    ])
    .controller('CarouselarImageController', ['$scope',
      function($scope) {
        $scope.isLoading = true;
        $scope.onLoad = function() {
          $scope.isLoading = false;
          $scope.$apply();
        };

        var unwatch = $scope.$watch('isVisible', function(isVisible) {
          if (isVisible) {
            $scope.compileImage();
            unwatch();
          }
        });
      }
    ]);

})(window, window.angular);

(function(window, angular, undefined) {
  'use strict';

  angular
    .module('carouselar.directives', [
      'carouselar.controllers', 'carouselar.constants'])
    .directive('carouselar', ['$window', 'CarouselarConstants',
      function($window, CarouselarConstants) {
        return {
          replace: true,
          restrict: 'E',
          scope: {
            images: '='
          },
          controller: 'CarouselarController',
          template:
            '<div class="carouselar">' +
              '<div class="carouselar__container">' +
                '<div class="carouselar__inner-container" ' +
                'ng-style="{\'transform\': containerPosition}">' +
                  '<div class="carouselar__image-container" ' +
                    'ng-style="{\'width\': singleImageWidth}" ' +
                    'ng-repeat="image in images" ' +
                    'is-visible="isImageVisible($index)" ' +
                    'img-url="{{image}}" ' +
                    'carouselar-image>' +
                  '</div>' +
                '</div>' +
              '</div>' +
              '<div class="carouselar__navigation">' +
                '<span class="carouselar__navigation__button ' +
                'carouselar__navigation__button--prev" ng-click="prev()">PREV</span>' +
                '<div class="carouselar__navigation__index">' +
                  '<span class="carouselar__navigation__button ' +
                    'carouselar__navigation__button--index" ' +
                    'ng-repeat="i in createArray(sectionCount) track by $index" ' +
                    'ng-class="{\'carouselar__navigation__button--active\':$index === activeSection}"' +
                    'ng-click="moveToSection($index)">' +
                      '{{$index + 1}}' +
                  '</span>' +
                '</div>' +
                '<span class="carouselar__navigation__button ' +
                'carouselar__navigation__button--next" ng-click="next()">NEXT</span>' +
              '</div>' +
            '</div>',
          link: function(scope, element, attrs) {
            scope.maxImageCount = Math.min(
              parseInt(attrs.displayingImageCount), CarouselarConstants.MAX_DISPLAYING_IMAGE) || 1;

            var win = angular.element($window);
            win.bind('resize', scope.onResize);
            scope.onResize();

            scope.$on('$destroy', function() {
              win.unbind('resize', scope.onResize);
            });
          }
        };
      }
    ])
    .directive('carouselarImage', ['$compile',
      function($compile) {
        return {
          restrict: 'A',
          controller: 'CarouselarImageController',
          scope: {
            isVisible: '=',
            imgUrl: '@'
          },
          template: '<div class="carouselar__loader" ng-if="isLoading"></div>',
          link: function(scope, element) {
            scope.compileImage = function() {
              element.append(
                '<img ' +
                  'class="carouselar__image" ' +
                  'carouselar-loader ' +
                  'on-load="onLoad()" ' +
                  'ng-src="{{imgUrl}}" />');
              $compile(element.contents())(scope);
            };
          }
        };
      }
    ])
    .directive('carouselarLoader', [
      function() {
        return {
          restrict: 'A',
          scope: {
            onLoad: '&'
          },
          link: function(scope, element) {
            element.bind('load', scope.onLoad);
          }
        };
      }
    ]);

})(window, window.angular);

(function(window, angular, undefined) {
  'use strict';

  angular
    .module('carouselar', [
      'carouselar.controllers',
      'carouselar.directives',
      'carouselar.constants'
    ]);

})(window, window.angular);

/*global define:true*/
(function(root, factory) {

	'use strict';

	if (typeof define === 'function' && define.amd) {
		// AMD
		define(['angular'], factory);
	} else if (typeof exports === 'object') {
		// CommonJS
		module.exports = factory(require('angular'));
	} else {
		// Browser, nothing "exported". Only registered as a module with angular.
		factory(root.angular);
	}
}(this, function(angular) {

	'use strict';

	// This returned angular module 'gridster' is what is exported.
	return angular.module('gridster', [])

	.constant('gridsterConfig', {
		columns: 6, // number of columns in the grid
		pushing: true, // whether to push other items out of the way
		floating: true, // whether to automatically float items up so they stack
		swapping: false, // whether or not to have items switch places instead of push down if they are the same size
		width: 'auto', // width of the grid. "auto" will expand the grid to its parent container
		colWidth: 'auto', // width of grid columns. "auto" will divide the width of the grid evenly among the columns
		rowHeight: 'match', // height of grid rows. 'match' will make it the same as the column width, a numeric value will be interpreted as pixels, '/2' is half the column width, '*5' is five times the column width, etc.
		margins: [10, 10], // margins in between grid items
		outerMargin: true,
		isMobile: false, // toggle mobile view
		mobileBreakPoint: 600, // width threshold to toggle mobile mode
		mobileModeEnabled: true, // whether or not to toggle mobile mode when screen width is less than mobileBreakPoint
		minColumns: 1, // minimum amount of columns the grid can scale down to
		minRows: 1, // minimum amount of rows to show if the grid is empty
		maxRows: 100, // maximum amount of rows in the grid
		defaultSizeX: 2, // default width of an item in columns
		defaultSizeY: 1, // default height of an item in rows
		minSizeX: 1, // minimum column width of an item
		maxSizeX: null, // maximum column width of an item
		minSizeY: 1, // minumum row height of an item
		maxSizeY: null, // maximum row height of an item
		saveGridItemCalculatedHeightInMobile: false, // grid item height in mobile display. true- to use the calculated height by sizeY given
		resizable: { // options to pass to resizable handler
			enabled: true,
			handles: ['s', 'e', 'n', 'w', 'se', 'ne', 'sw', 'nw']
		},
		draggable: { // options to pass to draggable handler
			enabled: true,
			scrollSensitivity: 20, // Distance in pixels from the edge of the viewport after which the viewport should scroll, relative to pointer
			scrollSpeed: 15 // Speed at which the window should scroll once the mouse pointer gets within scrollSensitivity distance
		}
	})

	.controller('GridsterCtrl', ['gridsterConfig', '$timeout',
		function(gridsterConfig, $timeout) {

			var gridster = this;

			/**
			 * Create options from gridsterConfig constant
			 */
			angular.extend(this, gridsterConfig);

			this.resizable = angular.extend({}, gridsterConfig.resizable || {});
			this.draggable = angular.extend({}, gridsterConfig.draggable || {});

			var flag = false;
			this.layoutChanged = function() {
				if (flag) {
					return;
				}
				flag = true;
				$timeout(function() {
					flag = false;
					if (gridster.loaded) {
						gridster.floatItemsUp();
					}
					gridster.updateHeight(gridster.movingItem ? gridster.movingItem.sizeY : 0);
				}, 30);
			};

			/**
			 * A positional array of the items in the grid
			 */
			this.grid = [];

			/**
			 * Clean up after yourself
			 */
			this.destroy = function() {
				// empty the grid to cut back on the possibility
				// of circular references
				if (this.grid) {
					this.grid = [];
				}
				this.$element = null;
			};

			/**
			 * Overrides default options
			 *
			 * @param {Object} options The options to override
			 */
			this.setOptions = function(options) {
				if (!options) {
					return;
				}

				options = angular.extend({}, options);

				// all this to avoid using jQuery...
				if (options.draggable) {
					angular.extend(this.draggable, options.draggable);
					delete(options.draggable);
				}
				if (options.resizable) {
					angular.extend(this.resizable, options.resizable);
					delete(options.resizable);
				}

				angular.extend(this, options);

				if (!this.margins || this.margins.length !== 2) {
					this.margins = [0, 0];
				} else {
					for (var x = 0, l = this.margins.length; x < l; ++x) {
						this.margins[x] = parseInt(this.margins[x], 10);
						if (isNaN(this.margins[x])) {
							this.margins[x] = 0;
						}
					}
				}
			};

			/**
			 * Check if item can occupy a specified position in the grid
			 *
			 * @param {Object} item The item in question
			 * @param {Number} row The row index
			 * @param {Number} column The column index
			 * @returns {Boolean} True if if item fits
			 */
			this.canItemOccupy = function(item, row, column) {
				return row > -1 && column > -1 && item.sizeX + column <= this.columns && item.sizeY + row <= this.maxRows;
			};

			/**
			 * Set the item in the first suitable position
			 *
			 * @param {Object} item The item to insert
			 */
			this.autoSetItemPosition = function(item) {
				// walk through each row and column looking for a place it will fit
				for (var rowIndex = 0; rowIndex < this.maxRows; ++rowIndex) {
					for (var colIndex = 0; colIndex < this.columns; ++colIndex) {
						// only insert if position is not already taken and it can fit
						var items = this.getItems(rowIndex, colIndex, item.sizeX, item.sizeY, item);
						if (items.length === 0 && this.canItemOccupy(item, rowIndex, colIndex)) {
							this.putItem(item, rowIndex, colIndex);
							return;
						}
					}
				}
				throw new Error('Unable to place item!');
			};

			/**
			 * Gets items at a specific coordinate
			 *
			 * @param {Number} row
			 * @param {Number} column
			 * @param {Number} sizeX
			 * @param {Number} sizeY
			 * @param {Array} excludeItems An array of items to exclude from selection
			 * @returns {Array} Items that match the criteria
			 */
			this.getItems = function(row, column, sizeX, sizeY, excludeItems) {
				var items = [];
				if (!sizeX || !sizeY) {
					sizeX = sizeY = 1;
				}
				if (excludeItems && !(excludeItems instanceof Array)) {
					excludeItems = [excludeItems];
				}
				for (var h = 0; h < sizeY; ++h) {
					for (var w = 0; w < sizeX; ++w) {
						var item = this.getItem(row + h, column + w, excludeItems);
						if (item && (!excludeItems || excludeItems.indexOf(item) === -1) && items.indexOf(item) === -1) {
							items.push(item);
						}
					}
				}
				return items;
			};

			/**
			 * @param {Array} items
			 * @returns {Object} An item that represents the bounding box of the items
			 */
			this.getBoundingBox = function(items) {

				if (items.length === 0) {
					return null;
				}
				if (items.length === 1) {
					return {
						row: items[0].row,
						col: items[0].col,
						sizeY: items[0].sizeY,
						sizeX: items[0].sizeX
					};
				}

				var maxRow = 0;
				var maxCol = 0;
				var minRow = 9999;
				var minCol = 9999;

				for (var i = 0, l = items.length; i < l; ++i) {
					var item = items[i];
					minRow = Math.min(item.row, minRow);
					minCol = Math.min(item.col, minCol);
					maxRow = Math.max(item.row + item.sizeY, maxRow);
					maxCol = Math.max(item.col + item.sizeX, maxCol);
				}

				return {
					row: minRow,
					col: minCol,
					sizeY: maxRow - minRow,
					sizeX: maxCol - minCol
				};
			};


			/**
			 * Removes an item from the grid
			 *
			 * @param {Object} item
			 */
			this.removeItem = function(item) {
				for (var rowIndex = 0, l = this.grid.length; rowIndex < l; ++rowIndex) {
					var columns = this.grid[rowIndex];
					if (!columns) {
						continue;
					}
					var index = columns.indexOf(item);
					if (index !== -1) {
						columns[index] = null;
						break;
					}
				}
				this.layoutChanged();
			};

			/**
			 * Returns the item at a specified coordinate
			 *
			 * @param {Number} row
			 * @param {Number} column
			 * @param {Array} excludeItems Items to exclude from selection
			 * @returns {Object} The matched item or null
			 */
			this.getItem = function(row, column, excludeItems) {
				if (excludeItems && !(excludeItems instanceof Array)) {
					excludeItems = [excludeItems];
				}
				var sizeY = 1;
				while (row > -1) {
					var sizeX = 1,
						col = column;
					while (col > -1) {
						var items = this.grid[row];
						if (items) {
							var item = items[col];
							if (item && (!excludeItems || excludeItems.indexOf(item) === -1) && item.sizeX >= sizeX && item.sizeY >= sizeY) {
								return item;
							}
						}
						++sizeX;
						--col;
					}
					--row;
					++sizeY;
				}
				return null;
			};

			/**
			 * Insert an array of items into the grid
			 *
			 * @param {Array} items An array of items to insert
			 */
			this.putItems = function(items) {
				for (var i = 0, l = items.length; i < l; ++i) {
					this.putItem(items[i]);
				}
			};

			/**
			 * Insert a single item into the grid
			 *
			 * @param {Object} item The item to insert
			 * @param {Number} row (Optional) Specifies the items row index
			 * @param {Number} column (Optional) Specifies the items column index
			 * @param {Array} ignoreItems
			 */
			this.putItem = function(item, row, column, ignoreItems) {
				// auto place item if no row specified
				if (typeof row === 'undefined' || row === null) {
					row = item.row;
					column = item.col;
					if (typeof row === 'undefined' || row === null) {
						this.autoSetItemPosition(item);
						return;
					}
				}

				// keep item within allowed bounds
				if (!this.canItemOccupy(item, row, column)) {
					column = Math.min(this.columns - item.sizeX, Math.max(0, column));
					row = Math.min(this.maxRows - item.sizeY, Math.max(0, row));
				}

				// check if item is already in grid
				if (item.oldRow !== null && typeof item.oldRow !== 'undefined') {
					var samePosition = item.oldRow === row && item.oldColumn === column;
					var inGrid = this.grid[row] && this.grid[row][column] === item;
					if (samePosition && inGrid) {
						item.row = row;
						item.col = column;
						return;
					} else {
						// remove from old position
						var oldRow = this.grid[item.oldRow];
						if (oldRow && oldRow[item.oldColumn] === item) {
							delete oldRow[item.oldColumn];
						}
					}
				}

				item.oldRow = item.row = row;
				item.oldColumn = item.col = column;

				this.moveOverlappingItems(item, ignoreItems);

				if (!this.grid[row]) {
					this.grid[row] = [];
				}
				this.grid[row][column] = item;

				if (this.movingItem === item) {
					this.floatItemUp(item);
				}
				this.layoutChanged();
			};

			/**
			 * Trade row and column if item1 with item2
			 *
			 * @param {Object} item1
			 * @param {Object} item2
			 */
			this.swapItems = function(item1, item2) {
				this.grid[item1.row][item1.col] = item2;
				this.grid[item2.row][item2.col] = item1;

				var item1Row = item1.row;
				var item1Col = item1.col;
				item1.row = item2.row;
				item1.col = item2.col;
				item2.row = item1Row;
				item2.col = item1Col;
			};

			/**
			 * Prevents items from being overlapped
			 *
			 * @param {Object} item The item that should remain
			 * @param {Array} ignoreItems
			 */
			this.moveOverlappingItems = function(item, ignoreItems) {
				// don't move item, so ignore it
				if (!ignoreItems) {
					ignoreItems = [item];
				} else if (ignoreItems.indexOf(item) === -1) {
					ignoreItems = ignoreItems.slice(0);
					ignoreItems.push(item);
				}

				// get the items in the space occupied by the item's coordinates
				var overlappingItems = this.getItems(
					item.row,
					item.col,
					item.sizeX,
					item.sizeY,
					ignoreItems
				);
				this.moveItemsDown(overlappingItems, item.row + item.sizeY, ignoreItems);
			};

			/**
			 * Moves an array of items to a specified row
			 *
			 * @param {Array} items The items to move
			 * @param {Number} newRow The target row
			 * @param {Array} ignoreItems
			 */
			this.moveItemsDown = function(items, newRow, ignoreItems) {
				if (!items || items.length === 0) {
					return;
				}
				items.sort(function(a, b) {
					return a.row - b.row;
				});

				ignoreItems = ignoreItems ? ignoreItems.slice(0) : [];
				var topRows = {},
					item, i, l;

				// calculate the top rows in each column
				for (i = 0, l = items.length; i < l; ++i) {
					item = items[i];
					var topRow = topRows[item.col];
					if (typeof topRow === 'undefined' || item.row < topRow) {
						topRows[item.col] = item.row;
					}
				}

				// move each item down from the top row in its column to the row
				for (i = 0, l = items.length; i < l; ++i) {
					item = items[i];
					var rowsToMove = newRow - topRows[item.col];
					this.moveItemDown(item, item.row + rowsToMove, ignoreItems);
					ignoreItems.push(item);
				}
			};

			/**
			 * Moves an item down to a specified row
			 *
			 * @param {Object} item The item to move
			 * @param {Number} newRow The target row
			 * @param {Array} ignoreItems
			 */
			this.moveItemDown = function(item, newRow, ignoreItems) {
				if (item.row >= newRow) {
					return;
				}
				while (item.row < newRow) {
					++item.row;
					this.moveOverlappingItems(item, ignoreItems);
				}
				this.putItem(item, item.row, item.col, ignoreItems);
			};

			/**
			 * Moves all items up as much as possible
			 */
			this.floatItemsUp = function() {
				if (this.floating === false) {
					return;
				}
				for (var rowIndex = 0, l = this.grid.length; rowIndex < l; ++rowIndex) {
					var columns = this.grid[rowIndex];
					if (!columns) {
						continue;
					}
					for (var colIndex = 0, len = columns.length; colIndex < len; ++colIndex) {
						var item = columns[colIndex];
						if (item) {
							this.floatItemUp(item);
						}
					}
				}
			};

			/**
			 * Float an item up to the most suitable row
			 *
			 * @param {Object} item The item to move
			 */
			this.floatItemUp = function(item) {
				if (this.floating === false) {
					return;
				}
				var colIndex = item.col,
					sizeY = item.sizeY,
					sizeX = item.sizeX,
					bestRow = null,
					bestColumn = null,
					rowIndex = item.row - 1;

				while (rowIndex > -1) {
					var items = this.getItems(rowIndex, colIndex, sizeX, sizeY, item);
					if (items.length !== 0) {
						break;
					}
					bestRow = rowIndex;
					bestColumn = colIndex;
					--rowIndex;
				}
				if (bestRow !== null) {
					this.putItem(item, bestRow, bestColumn);
				}
			};

			/**
			 * Update gridsters height
			 *
			 * @param {Number} plus (Optional) Additional height to add
			 */
			this.updateHeight = function(plus) {
				var maxHeight = this.minRows;
				plus = plus || 0;
				for (var rowIndex = this.grid.length; rowIndex >= 0; --rowIndex) {
					var columns = this.grid[rowIndex];
					if (!columns) {
						continue;
					}
					for (var colIndex = 0, len = columns.length; colIndex < len; ++colIndex) {
						if (columns[colIndex]) {
							maxHeight = Math.max(maxHeight, rowIndex + plus + columns[colIndex].sizeY);
						}
					}
				}
				this.gridHeight = this.maxRows - maxHeight > 0 ? Math.min(this.maxRows, maxHeight) : Math.max(this.maxRows, maxHeight);
			};

			/**
			 * Returns the number of rows that will fit in given amount of pixels
			 *
			 * @param {Number} pixels
			 * @param {Boolean} ceilOrFloor (Optional) Determines rounding method
			 */
			this.pixelsToRows = function(pixels, ceilOrFloor) {
				if (!this.outerMargin) {
					pixels += this.margins[0] / 2;
				}

				if (ceilOrFloor === true) {
					return Math.ceil(pixels / this.curRowHeight);
				} else if (ceilOrFloor === false) {
					return Math.floor(pixels / this.curRowHeight);
				}

				return Math.round(pixels / this.curRowHeight);
			};

			/**
			 * Returns the number of columns that will fit in a given amount of pixels
			 *
			 * @param {Number} pixels
			 * @param {Boolean} ceilOrFloor (Optional) Determines rounding method
			 * @returns {Number} The number of columns
			 */
			this.pixelsToColumns = function(pixels, ceilOrFloor) {
				if (!this.outerMargin) {
					pixels += this.margins[1] / 2;
				}

				if (ceilOrFloor === true) {
					return Math.ceil(pixels / this.curColWidth);
				} else if (ceilOrFloor === false) {
					return Math.floor(pixels / this.curColWidth);
				}

				return Math.round(pixels / this.curColWidth);
			};
		}
	])

	.directive('gridsterPreview', function() {
		return {
			replace: true,
			scope: true,
			require: '^gridster',
			template: '<div ng-style="previewStyle()" class="gridster-item gridster-preview-holder"></div>',
			link: function(scope, $el, attrs, gridster) {

				/**
				 * @returns {Object} style object for preview element
				 */
				scope.previewStyle = function() {
					if (!gridster.movingItem) {
						return {
							display: 'none'
						};
					}

					return {
						display: 'block',
						height: (gridster.movingItem.sizeY * gridster.curRowHeight - gridster.margins[0]) + 'px',
						width: (gridster.movingItem.sizeX * gridster.curColWidth - gridster.margins[1]) + 'px',
						top: (gridster.movingItem.row * gridster.curRowHeight + (gridster.outerMargin ? gridster.margins[0] : 0)) + 'px',
						left: (gridster.movingItem.col * gridster.curColWidth + (gridster.outerMargin ? gridster.margins[1] : 0)) + 'px'
					};
				};
			}
		};
	})

	/**
	 * The gridster directive
	 *
	 * @param {Function} $timeout
	 * @param {Object} $window
	 * @param {Object} $rootScope
	 * @param {Function} gridsterDebounce
	 */
	.directive('gridster', ['$timeout', '$window', '$rootScope', 'gridsterDebounce',
		function($timeout, $window, $rootScope, gridsterDebounce) {
			return {
				scope: true,
				restrict: 'EAC',
				controller: 'GridsterCtrl',
				controllerAs: 'gridster',
				compile: function($tplElem) {

					$tplElem.prepend('<div ng-if="gridster.movingItem" gridster-preview></div>');

					return function(scope, $elem, attrs, gridster) {
						gridster.loaded = false;

						gridster.$element = $elem;

						scope.gridster = gridster;

						$elem.addClass('gridster');

						var isVisible = function(ele) {
							return ele.style.visibility !== 'hidden' && ele.style.display !== 'none';
						};

						function refresh(config) {
							gridster.setOptions(config);

							if (!isVisible($elem[0])) {
								return;
							}

							// resolve "auto" & "match" values
							if (gridster.width === 'auto') {
								gridster.curWidth = $elem[0].offsetWidth || parseInt($elem.css('width'), 10);
							} else {
								gridster.curWidth = gridster.width;
							}

							if (gridster.colWidth === 'auto') {
								gridster.curColWidth = (gridster.curWidth + (gridster.outerMargin ? -gridster.margins[1] : gridster.margins[1])) / gridster.columns;
							} else {
								gridster.curColWidth = gridster.colWidth;
							}

							gridster.curRowHeight = gridster.rowHeight;
							if (typeof gridster.rowHeight === 'string') {
								if (gridster.rowHeight === 'match') {
									gridster.curRowHeight = Math.round(gridster.curColWidth);
								} else if (gridster.rowHeight.indexOf('*') !== -1) {
									gridster.curRowHeight = Math.round(gridster.curColWidth * gridster.rowHeight.replace('*', '').replace(' ', ''));
								} else if (gridster.rowHeight.indexOf('/') !== -1) {
									gridster.curRowHeight = Math.round(gridster.curColWidth / gridster.rowHeight.replace('/', '').replace(' ', ''));
								}
							}

							gridster.isMobile = gridster.mobileModeEnabled && gridster.curWidth <= gridster.mobileBreakPoint;

							// loop through all items and reset their CSS
							for (var rowIndex = 0, l = gridster.grid.length; rowIndex < l; ++rowIndex) {
								var columns = gridster.grid[rowIndex];
								if (!columns) {
									continue;
								}

								for (var colIndex = 0, len = columns.length; colIndex < len; ++colIndex) {
									if (columns[colIndex]) {
										var item = columns[colIndex];
										item.setElementPosition();
										item.setElementSizeY();
										item.setElementSizeX();
									}
								}
							}

							updateHeight();
						}

						var optionsKey = attrs.gridster;
						if (optionsKey) {
							scope.$parent.$watch(optionsKey, function(newConfig) {
								refresh(newConfig);
							}, true);
						} else {
							refresh({});
						}

						scope.$watch(function() {
							return gridster.loaded;
						}, function() {
							if (gridster.loaded) {
								$elem.addClass('gridster-loaded');
							} else {
								$elem.removeClass('gridster-loaded');
							}
						});

						scope.$watch(function() {
							return gridster.isMobile;
						}, function() {
							if (gridster.isMobile) {
								$elem.addClass('gridster-mobile').removeClass('gridster-desktop');
							} else {
								$elem.removeClass('gridster-mobile').addClass('gridster-desktop');
							}
							$rootScope.$broadcast('gridster-mobile-changed', gridster);
						});

						scope.$watch(function() {
							return gridster.draggable;
						}, function() {
							$rootScope.$broadcast('gridster-draggable-changed', gridster);
						}, true);

						scope.$watch(function() {
							return gridster.resizable;
						}, function() {
							$rootScope.$broadcast('gridster-resizable-changed', gridster);
						}, true);

						function updateHeight() {
							$elem.css('height', (gridster.gridHeight * gridster.curRowHeight) + (gridster.outerMargin ? gridster.margins[0] : -gridster.margins[0]) + 'px');
						}

						scope.$watch(function() {
							return gridster.gridHeight;
						}, updateHeight);

						scope.$watch(function() {
							return gridster.movingItem;
						}, function() {
							gridster.updateHeight(gridster.movingItem ? gridster.movingItem.sizeY : 0);
						});

						var prevWidth = $elem[0].offsetWidth || parseInt($elem.css('width'), 10);

						var resize = function() {
							var width = $elem[0].offsetWidth || parseInt($elem.css('width'), 10);

							if (!width || width === prevWidth || gridster.movingItem) {
								return;
							}
							prevWidth = width;

							if (gridster.loaded) {
								$elem.removeClass('gridster-loaded');
							}

							refresh();

							if (gridster.loaded) {
								$elem.addClass('gridster-loaded');
							}

							$rootScope.$broadcast('gridster-resized', [width, $elem[0].offsetHeight], gridster);
						};

						// track element width changes any way we can
						var onResize = gridsterDebounce(function onResize() {
							resize();
							$timeout(function() {
								scope.$apply();
							});
						}, 100);

						scope.$watch(function() {
							return isVisible($elem[0]);
						}, onResize);

						// see https://github.com/sdecima/javascript-detect-element-resize
						if (typeof window.addResizeListener === 'function') {
							window.addResizeListener($elem[0], onResize);
						} else {
							scope.$watch(function() {
								return $elem[0].offsetWidth || parseInt($elem.css('width'), 10);
							}, resize);
						}
						var $win = angular.element($window);
						$win.on('resize', onResize);

						// be sure to cleanup
						scope.$on('$destroy', function() {
							gridster.destroy();
							$win.off('resize', onResize);
							if (typeof window.removeResizeListener === 'function') {
								window.removeResizeListener($elem[0], onResize);
							}
						});

						// allow a little time to place items before floating up
						$timeout(function() {
							scope.$watch('gridster.floating', function() {
								gridster.floatItemsUp();
							});
							gridster.loaded = true;
						}, 100);
					};
				}
			};
		}
	])

	.controller('GridsterItemCtrl', function() {
		this.$element = null;
		this.gridster = null;
		this.row = null;
		this.col = null;
		this.sizeX = null;
		this.sizeY = null;
		this.minSizeX = 0;
		this.minSizeY = 0;
		this.maxSizeX = null;
		this.maxSizeY = null;

		this.init = function($element, gridster) {
			this.$element = $element;
			this.gridster = gridster;
			this.sizeX = gridster.defaultSizeX;
			this.sizeY = gridster.defaultSizeY;
		};

		this.destroy = function() {
			// set these to null to avoid the possibility of circular references
			this.gridster = null;
			this.$element = null;
		};

		/**
		 * Returns the items most important attributes
		 */
		this.toJSON = function() {
			return {
				row: this.row,
				col: this.col,
				sizeY: this.sizeY,
				sizeX: this.sizeX
			};
		};

		this.isMoving = function() {
			return this.gridster.movingItem === this;
		};

		/**
		 * Set the items position
		 *
		 * @param {Number} row
		 * @param {Number} column
		 */
		this.setPosition = function(row, column) {
			this.gridster.putItem(this, row, column);

			if (!this.isMoving()) {
				this.setElementPosition();
			}
		};

		/**
		 * Sets a specified size property
		 *
		 * @param {String} key Can be either "x" or "y"
		 * @param {Number} value The size amount
		 * @param {Boolean} preventMove
		 */
		this.setSize = function(key, value, preventMove) {
			key = key.toUpperCase();
			var camelCase = 'size' + key,
				titleCase = 'Size' + key;
			if (value === '') {
				return;
			}
			value = parseInt(value, 10);
			if (isNaN(value) || value === 0) {
				value = this.gridster['default' + titleCase];
			}
			var max = key === 'X' ? this.gridster.columns : this.gridster.maxRows;
			if (this['max' + titleCase]) {
				max = Math.min(this['max' + titleCase], max);
			}
			if (this.gridster['max' + titleCase]) {
				max = Math.min(this.gridster['max' + titleCase], max);
			}
			if (key === 'X' && this.cols) {
				max -= this.cols;
			} else if (key === 'Y' && this.rows) {
				max -= this.rows;
			}

			var min = 0;
			if (this['min' + titleCase]) {
				min = Math.max(this['min' + titleCase], min);
			}
			if (this.gridster['min' + titleCase]) {
				min = Math.max(this.gridster['min' + titleCase], min);
			}

			value = Math.max(Math.min(value, max), min);

			var changed = (this[camelCase] !== value || (this['old' + titleCase] && this['old' + titleCase] !== value));
			this['old' + titleCase] = this[camelCase] = value;

			if (!this.isMoving()) {
				this['setElement' + titleCase]();
			}
			if (!preventMove && changed) {
				this.gridster.moveOverlappingItems(this);
				this.gridster.layoutChanged();
			}

			return changed;
		};

		/**
		 * Sets the items sizeY property
		 *
		 * @param {Number} rows
		 * @param {Boolean} preventMove
		 */
		this.setSizeY = function(rows, preventMove) {
			return this.setSize('Y', rows, preventMove);
		};

		/**
		 * Sets the items sizeX property
		 *
		 * @param {Number} columns
		 * @param {Boolean} preventMove
		 */
		this.setSizeX = function(columns, preventMove) {
			return this.setSize('X', columns, preventMove);
		};

		/**
		 * Sets an elements position on the page
		 */
		this.setElementPosition = function() {
			if (this.gridster.isMobile) {
				this.$element.css({
					marginLeft: this.gridster.margins[0] + 'px',
					marginRight: this.gridster.margins[0] + 'px',
					marginTop: this.gridster.margins[1] + 'px',
					marginBottom: this.gridster.margins[1] + 'px',
					top: '',
					left: ''
				});
			} else {
				this.$element.css({
					margin: 0,
					top: (this.row * this.gridster.curRowHeight + (this.gridster.outerMargin ? this.gridster.margins[0] : 0)) + 'px',
					left: (this.col * this.gridster.curColWidth + (this.gridster.outerMargin ? this.gridster.margins[1] : 0)) + 'px'
				});
			}
		};

		/**
		 * Sets an elements height
		 */
		this.setElementSizeY = function() {
			if (this.gridster.isMobile && !this.gridster.saveGridItemCalculatedHeightInMobile) {
				this.$element.css('height', '');
			} else {
				this.$element.css('height', (this.sizeY * this.gridster.curRowHeight - this.gridster.margins[0]) + 'px');
			}
		};

		/**
		 * Sets an elements width
		 */
		this.setElementSizeX = function() {
			if (this.gridster.isMobile) {
				this.$element.css('width', '');
			} else {
				this.$element.css('width', (this.sizeX * this.gridster.curColWidth - this.gridster.margins[1]) + 'px');
			}
		};

		/**
		 * Gets an element's width
		 */
		this.getElementSizeX = function() {
			return (this.sizeX * this.gridster.curColWidth - this.gridster.margins[1]);
		};

		/**
		 * Gets an element's height
		 */
		this.getElementSizeY = function() {
			return (this.sizeY * this.gridster.curRowHeight - this.gridster.margins[0]);
		};

	})

	.factory('GridsterTouch', [function() {
		return function GridsterTouch(target, startEvent, moveEvent, endEvent) {
			var lastXYById = {};

			//  Opera doesn't have Object.keys so we use this wrapper
			var numberOfKeys = function(theObject) {
				if (Object.keys) {
					return Object.keys(theObject).length;
				}

				var n = 0,
					key;
				for (key in theObject) {
					++n;
				}

				return n;
			};

			//  this calculates the delta needed to convert pageX/Y to offsetX/Y because offsetX/Y don't exist in the TouchEvent object or in Firefox's MouseEvent object
			var computeDocumentToElementDelta = function(theElement) {
				var elementLeft = 0;
				var elementTop = 0;
				var oldIEUserAgent = navigator.userAgent.match(/\bMSIE\b/);

				for (var offsetElement = theElement; offsetElement != null; offsetElement = offsetElement.offsetParent) {
					//  the following is a major hack for versions of IE less than 8 to avoid an apparent problem on the IEBlog with double-counting the offsets
					//  this may not be a general solution to IE7's problem with offsetLeft/offsetParent
					if (oldIEUserAgent &&
						(!document.documentMode || document.documentMode < 8) &&
						offsetElement.currentStyle.position === 'relative' && offsetElement.offsetParent && offsetElement.offsetParent.currentStyle.position === 'relative' && offsetElement.offsetLeft === offsetElement.offsetParent.offsetLeft) {
						// add only the top
						elementTop += offsetElement.offsetTop;
					} else {
						elementLeft += offsetElement.offsetLeft;
						elementTop += offsetElement.offsetTop;
					}
				}

				return {
					x: elementLeft,
					y: elementTop
				};
			};

			//  cache the delta from the document to our event target (reinitialized each mousedown/MSPointerDown/touchstart)
			var documentToTargetDelta = computeDocumentToElementDelta(target);

			//  common event handler for the mouse/pointer/touch models and their down/start, move, up/end, and cancel events
			var doEvent = function(theEvtObj) {

				if (theEvtObj.type === 'mousemove' && numberOfKeys(lastXYById) === 0) {
					return;
				}

				var prevent = true;

				var pointerList = theEvtObj.changedTouches ? theEvtObj.changedTouches : [theEvtObj];
				for (var i = 0; i < pointerList.length; ++i) {
					var pointerObj = pointerList[i];
					var pointerId = (typeof pointerObj.identifier !== 'undefined') ? pointerObj.identifier : (typeof pointerObj.pointerId !== 'undefined') ? pointerObj.pointerId : 1;

					//  use the pageX/Y coordinates to compute target-relative coordinates when we have them (in ie < 9, we need to do a little work to put them there)
					if (typeof pointerObj.pageX === 'undefined') {
						//  initialize assuming our source element is our target
						pointerObj.pageX = pointerObj.offsetX + documentToTargetDelta.x;
						pointerObj.pageY = pointerObj.offsetY + documentToTargetDelta.y;

						if (pointerObj.srcElement.offsetParent === target && document.documentMode && document.documentMode === 8 && pointerObj.type === 'mousedown') {
							//  source element is a child piece of VML, we're in IE8, and we've not called setCapture yet - add the origin of the source element
							pointerObj.pageX += pointerObj.srcElement.offsetLeft;
							pointerObj.pageY += pointerObj.srcElement.offsetTop;
						} else if (pointerObj.srcElement !== target && !document.documentMode || document.documentMode < 8) {
							//  source element isn't the target (most likely it's a child piece of VML) and we're in a version of IE before IE8 -
							//  the offsetX/Y values are unpredictable so use the clientX/Y values and adjust by the scroll offsets of its parents
							//  to get the document-relative coordinates (the same as pageX/Y)
							var sx = -2,
								sy = -2; // adjust for old IE's 2-pixel border
							for (var scrollElement = pointerObj.srcElement; scrollElement !== null; scrollElement = scrollElement.parentNode) {
								sx += scrollElement.scrollLeft ? scrollElement.scrollLeft : 0;
								sy += scrollElement.scrollTop ? scrollElement.scrollTop : 0;
							}

							pointerObj.pageX = pointerObj.clientX + sx;
							pointerObj.pageY = pointerObj.clientY + sy;
						}
					}


					var pageX = pointerObj.pageX;
					var pageY = pointerObj.pageY;

					if (theEvtObj.type.match(/(start|down)$/i)) {
						//  clause for processing MSPointerDown, touchstart, and mousedown

						//  refresh the document-to-target delta on start in case the target has moved relative to document
						documentToTargetDelta = computeDocumentToElementDelta(target);

						//  protect against failing to get an up or end on this pointerId
						if (lastXYById[pointerId]) {
							if (endEvent) {
								endEvent({
									target: theEvtObj.target,
									which: theEvtObj.which,
									pointerId: pointerId,
									pageX: pageX,
									pageY: pageY
								});
							}

							delete lastXYById[pointerId];
						}

						if (startEvent) {
							if (prevent) {
								prevent = startEvent({
									target: theEvtObj.target,
									which: theEvtObj.which,
									pointerId: pointerId,
									pageX: pageX,
									pageY: pageY
								});
							}
						}

						//  init last page positions for this pointer
						lastXYById[pointerId] = {
							x: pageX,
							y: pageY
						};

						// IE pointer model
						if (target.msSetPointerCapture) {
							target.msSetPointerCapture(pointerId);
						} else if (theEvtObj.type === 'mousedown' && numberOfKeys(lastXYById) === 1) {
							if (useSetReleaseCapture) {
								target.setCapture(true);
							} else {
								document.addEventListener('mousemove', doEvent, false);
								document.addEventListener('mouseup', doEvent, false);
							}
						}
					} else if (theEvtObj.type.match(/move$/i)) {
						//  clause handles mousemove, MSPointerMove, and touchmove

						if (lastXYById[pointerId] && !(lastXYById[pointerId].x === pageX && lastXYById[pointerId].y === pageY)) {
							//  only extend if the pointer is down and it's not the same as the last point

							if (moveEvent && prevent) {
								prevent = moveEvent({
									target: theEvtObj.target,
									which: theEvtObj.which,
									pointerId: pointerId,
									pageX: pageX,
									pageY: pageY
								});
							}

							//  update last page positions for this pointer
							lastXYById[pointerId].x = pageX;
							lastXYById[pointerId].y = pageY;
						}
					} else if (lastXYById[pointerId] && theEvtObj.type.match(/(up|end|cancel)$/i)) {
						//  clause handles up/end/cancel

						if (endEvent && prevent) {
							prevent = endEvent({
								target: theEvtObj.target,
								which: theEvtObj.which,
								pointerId: pointerId,
								pageX: pageX,
								pageY: pageY
							});
						}

						//  delete last page positions for this pointer
						delete lastXYById[pointerId];

						//  in the Microsoft pointer model, release the capture for this pointer
						//  in the mouse model, release the capture or remove document-level event handlers if there are no down points
						//  nothing is required for the iOS touch model because capture is implied on touchstart
						if (target.msReleasePointerCapture) {
							target.msReleasePointerCapture(pointerId);
						} else if (theEvtObj.type === 'mouseup' && numberOfKeys(lastXYById) === 0) {
							if (useSetReleaseCapture) {
								target.releaseCapture();
							} else {
								document.removeEventListener('mousemove', doEvent, false);
								document.removeEventListener('mouseup', doEvent, false);
							}
						}
					}
				}

				if (prevent) {
					if (theEvtObj.preventDefault) {
						theEvtObj.preventDefault();
					}

					if (theEvtObj.preventManipulation) {
						theEvtObj.preventManipulation();
					}

					if (theEvtObj.preventMouseEvent) {
						theEvtObj.preventMouseEvent();
					}
				}
			};

			var useSetReleaseCapture = false;
			// saving the settings for contentZooming and touchaction before activation
			var contentZooming, msTouchAction;

			this.enable = function() {

				if (window.navigator.msPointerEnabled) {
					//  Microsoft pointer model
					target.addEventListener('MSPointerDown', doEvent, false);
					target.addEventListener('MSPointerMove', doEvent, false);
					target.addEventListener('MSPointerUp', doEvent, false);
					target.addEventListener('MSPointerCancel', doEvent, false);

					//  css way to prevent panning in our target area
					if (typeof target.style.msContentZooming !== 'undefined') {
						contentZooming = target.style.msContentZooming;
						target.style.msContentZooming = 'none';
					}

					//  new in Windows Consumer Preview: css way to prevent all built-in touch actions on our target
					//  without this, you cannot touch draw on the element because IE will intercept the touch events
					if (typeof target.style.msTouchAction !== 'undefined') {
						msTouchAction = target.style.msTouchAction;
						target.style.msTouchAction = 'none';
					}
				} else if (target.addEventListener) {
					//  iOS touch model
					target.addEventListener('touchstart', doEvent, false);
					target.addEventListener('touchmove', doEvent, false);
					target.addEventListener('touchend', doEvent, false);
					target.addEventListener('touchcancel', doEvent, false);

					//  mouse model
					target.addEventListener('mousedown', doEvent, false);

					//  mouse model with capture
					//  rejecting gecko because, unlike ie, firefox does not send events to target when the mouse is outside target
					if (target.setCapture && !window.navigator.userAgent.match(/\bGecko\b/)) {
						useSetReleaseCapture = true;

						target.addEventListener('mousemove', doEvent, false);
						target.addEventListener('mouseup', doEvent, false);
					}
				} else if (target.attachEvent && target.setCapture) {
					//  legacy IE mode - mouse with capture
					useSetReleaseCapture = true;
					target.attachEvent('onmousedown', function() {
						doEvent(window.event);
						window.event.returnValue = false;
						return false;
					});
					target.attachEvent('onmousemove', function() {
						doEvent(window.event);
						window.event.returnValue = false;
						return false;
					});
					target.attachEvent('onmouseup', function() {
						doEvent(window.event);
						window.event.returnValue = false;
						return false;
					});
				}
			};

			this.disable = function() {
				if (window.navigator.msPointerEnabled) {
					//  Microsoft pointer model
					target.removeEventListener('MSPointerDown', doEvent, false);
					target.removeEventListener('MSPointerMove', doEvent, false);
					target.removeEventListener('MSPointerUp', doEvent, false);
					target.removeEventListener('MSPointerCancel', doEvent, false);

					//  reset zooming to saved value
					if (contentZooming) {
						target.style.msContentZooming = contentZooming;
					}

					// reset touch action setting
					if (msTouchAction) {
						target.style.msTouchAction = msTouchAction;
					}
				} else if (target.removeEventListener) {
					//  iOS touch model
					target.removeEventListener('touchstart', doEvent, false);
					target.removeEventListener('touchmove', doEvent, false);
					target.removeEventListener('touchend', doEvent, false);
					target.removeEventListener('touchcancel', doEvent, false);

					//  mouse model
					target.removeEventListener('mousedown', doEvent, false);

					//  mouse model with capture
					//  rejecting gecko because, unlike ie, firefox does not send events to target when the mouse is outside target
					if (target.setCapture && !window.navigator.userAgent.match(/\bGecko\b/)) {
						useSetReleaseCapture = true;

						target.removeEventListener('mousemove', doEvent, false);
						target.removeEventListener('mouseup', doEvent, false);
					}
				} else if (target.detachEvent && target.setCapture) {
					//  legacy IE mode - mouse with capture
					useSetReleaseCapture = true;
					target.detachEvent('onmousedown');
					target.detachEvent('onmousemove');
					target.detachEvent('onmouseup');
				}
			};

			return this;
		};
	}])

	.factory('GridsterDraggable', ['$document', '$window', 'GridsterTouch',
		function($document, $window, GridsterTouch) {
			function GridsterDraggable($el, scope, gridster, item, itemOptions) {

				var elmX, elmY, elmW, elmH,

					mouseX = 0,
					mouseY = 0,
					lastMouseX = 0,
					lastMouseY = 0,
					mOffX = 0,
					mOffY = 0,

					minTop = 0,
					maxTop = 9999,
					minLeft = 0,
					realdocument = $document[0];

				var originalCol, originalRow;
				var inputTags = ['select', 'input', 'textarea', 'button'];

				function mouseDown(e) {
					if (inputTags.indexOf(e.target.nodeName.toLowerCase()) !== -1) {
						return false;
					}

					var $target = angular.element(e.target);

					// exit, if a resize handle was hit
					if ($target.hasClass('gridster-item-resizable-handler')) {
						return false;
					}

					// exit, if the target has it's own click event
					if ($target.attr('onclick') || $target.attr('ng-click')) {
						return false;
					}

					// only works if you have jQuery
					if ($target.closest && $target.closest('.gridster-no-drag').length) {
						return false;
					}

					switch (e.which) {
						case 1:
							// left mouse button
							break;
						case 2:
						case 3:
							// right or middle mouse button
							return;
					}

					lastMouseX = e.pageX;
					lastMouseY = e.pageY;

					elmX = parseInt($el.css('left'), 10);
					elmY = parseInt($el.css('top'), 10);
					elmW = $el[0].offsetWidth;
					elmH = $el[0].offsetHeight;

					originalCol = item.col;
					originalRow = item.row;

					dragStart(e);

					return true;
				}

				function mouseMove(e) {
					if (!$el.hasClass('gridster-item-moving') || $el.hasClass('gridster-item-resizing')) {
						return false;
					}

					var maxLeft = gridster.curWidth - 1;

					// Get the current mouse position.
					mouseX = e.pageX;
					mouseY = e.pageY;

					// Get the deltas
					var diffX = mouseX - lastMouseX + mOffX;
					var diffY = mouseY - lastMouseY + mOffY;
					mOffX = mOffY = 0;

					// Update last processed mouse positions.
					lastMouseX = mouseX;
					lastMouseY = mouseY;

					var dX = diffX,
						dY = diffY;
					if (elmX + dX < minLeft) {
						diffX = minLeft - elmX;
						mOffX = dX - diffX;
					} else if (elmX + elmW + dX > maxLeft) {
						diffX = maxLeft - elmX - elmW;
						mOffX = dX - diffX;
					}

					if (elmY + dY < minTop) {
						diffY = minTop - elmY;
						mOffY = dY - diffY;
					} else if (elmY + elmH + dY > maxTop) {
						diffY = maxTop - elmY - elmH;
						mOffY = dY - diffY;
					}
					elmX += diffX;
					elmY += diffY;

					// set new position
					$el.css({
						'top': elmY + 'px',
						'left': elmX + 'px'
					});

					drag(e);

					return true;
				}

				function mouseUp(e) {
					if (!$el.hasClass('gridster-item-moving') || $el.hasClass('gridster-item-resizing')) {
						return false;
					}

					mOffX = mOffY = 0;

					dragStop(e);

					return true;
				}

				function dragStart(event) {
					$el.addClass('gridster-item-moving');
					gridster.movingItem = item;

					gridster.updateHeight(item.sizeY);
					scope.$apply(function() {
						if (gridster.draggable && gridster.draggable.start) {
							gridster.draggable.start(event, $el, itemOptions);
						}
					});
				}

				function drag(event) {
					var oldRow = item.row,
						oldCol = item.col,
						hasCallback = gridster.draggable && gridster.draggable.drag,
						scrollSensitivity = gridster.draggable.scrollSensitivity,
						scrollSpeed = gridster.draggable.scrollSpeed;

					var row = gridster.pixelsToRows(elmY);
					var col = gridster.pixelsToColumns(elmX);

					var itemsInTheWay = gridster.getItems(row, col, item.sizeX, item.sizeY, item);
					var hasItemsInTheWay = itemsInTheWay.length !== 0;

					if (gridster.swapping === true && hasItemsInTheWay) {
						var boundingBoxItem = gridster.getBoundingBox(itemsInTheWay),
							sameSize = boundingBoxItem.sizeX === item.sizeX && boundingBoxItem.sizeY === item.sizeY,
							sameRow = boundingBoxItem.row === oldRow,
							sameCol = boundingBoxItem.col === oldCol,
							samePosition = boundingBoxItem.row === row && boundingBoxItem.col === col,
							inline = sameRow || sameCol;

						if (sameSize && itemsInTheWay.length === 1) {
							if (samePosition) {
								gridster.swapItems(item, itemsInTheWay[0]);
							} else if (inline) {
								return;
							}
						} else if (boundingBoxItem.sizeX <= item.sizeX && boundingBoxItem.sizeY <= item.sizeY && inline) {
							var emptyRow = item.row <= row ? item.row : row + item.sizeY,
								emptyCol = item.col <= col ? item.col : col + item.sizeX,
								rowOffset = emptyRow - boundingBoxItem.row,
								colOffset = emptyCol - boundingBoxItem.col;

							for (var i = 0, l = itemsInTheWay.length; i < l; ++i) {
								var itemInTheWay = itemsInTheWay[i];

								var itemsInFreeSpace = gridster.getItems(
									itemInTheWay.row + rowOffset,
									itemInTheWay.col + colOffset,
									itemInTheWay.sizeX,
									itemInTheWay.sizeY,
									item
								);

								if (itemsInFreeSpace.length === 0) {
									gridster.putItem(itemInTheWay, itemInTheWay.row + rowOffset, itemInTheWay.col + colOffset);
								}
							}
						}
					}

					if (gridster.pushing !== false || !hasItemsInTheWay) {
						item.row = row;
						item.col = col;
					}

					if (event.pageY - realdocument.body.scrollTop < scrollSensitivity) {
						realdocument.body.scrollTop = realdocument.body.scrollTop - scrollSpeed;
					} else if ($window.innerHeight - (event.pageY - realdocument.body.scrollTop) < scrollSensitivity) {
						realdocument.body.scrollTop = realdocument.body.scrollTop + scrollSpeed;
					}

					if (event.pageX - realdocument.body.scrollLeft < scrollSensitivity) {
						realdocument.body.scrollLeft = realdocument.body.scrollLeft - scrollSpeed;
					} else if ($window.innerWidth - (event.pageX - realdocument.body.scrollLeft) < scrollSensitivity) {
						realdocument.body.scrollLeft = realdocument.body.scrollLeft + scrollSpeed;
					}

					if (hasCallback || oldRow !== item.row || oldCol !== item.col) {
						scope.$apply(function() {
							if (hasCallback) {
								gridster.draggable.drag(event, $el, itemOptions);
							}
						});
					}
				}

				function dragStop(event) {
					$el.removeClass('gridster-item-moving');
					var row = gridster.pixelsToRows(elmY);
					var col = gridster.pixelsToColumns(elmX);
					if (gridster.pushing !== false || gridster.getItems(row, col, item.sizeX, item.sizeY, item).length === 0) {
						item.row = row;
						item.col = col;
					}
					gridster.movingItem = null;
					item.setPosition(item.row, item.col);

					scope.$apply(function() {
						if (gridster.draggable && gridster.draggable.stop) {
							gridster.draggable.stop(event, $el, itemOptions);
						}
					});
				}

				var enabled = null;
				var $dragHandles = null;
				var unifiedInputs = [];

				this.enable = function() {
					if (enabled === true) {
						return;
					}

					enabled = true;

					// timeout required for some template rendering
					$el.ready(function() {
						if (enabled !== true) {
							return;
						}

						// disable any existing draghandles
						for (var u = 0, ul = unifiedInputs.length; u < ul; ++u) {
							unifiedInputs[u].disable();
						}
						unifiedInputs = [];

						if (gridster.draggable && gridster.draggable.handle) {
							$dragHandles = angular.element($el[0].querySelectorAll(gridster.draggable.handle));
							if ($dragHandles.length === 0) {
								// fall back to element if handle not found...
								$dragHandles = $el;
							}
						} else {
							$dragHandles = $el;
						}

						for (var h = 0, hl = $dragHandles.length; h < hl; ++h) {
							unifiedInputs[h] = new GridsterTouch($dragHandles[h], mouseDown, mouseMove, mouseUp);
							unifiedInputs[h].enable();
						}
					});
				};

				this.disable = function() {
					if (enabled === false) {
						return;
					}

					enabled = false;

					for (var u = 0, ul = unifiedInputs.length; u < ul; ++u) {
						unifiedInputs[u].disable();
					}

					unifiedInputs = [];
				};

				this.toggle = function(enabled) {
					if (enabled) {
						this.enable();
					} else {
						this.disable();
					}
				};

				this.destroy = function() {
					this.disable();
				};
			}

			return GridsterDraggable;
		}
	])

	.factory('GridsterResizable', ['GridsterTouch', function(GridsterTouch) {
		function GridsterResizable($el, scope, gridster, item, itemOptions) {

			function ResizeHandle(handleClass) {

				var hClass = handleClass;

				var elmX, elmY, elmW, elmH,

					mouseX = 0,
					mouseY = 0,
					lastMouseX = 0,
					lastMouseY = 0,
					mOffX = 0,
					mOffY = 0,

					minTop = 0,
					maxTop = 9999,
					minLeft = 0;

				var getMinHeight = function() {
					return (item.minSizeY ? item.minSizeY : 1) * gridster.curRowHeight - gridster.margins[0];
				};
				var getMinWidth = function() {
					return (item.minSizeX ? item.minSizeX : 1) * gridster.curColWidth - gridster.margins[1];
				};

				var originalWidth, originalHeight;
				var savedDraggable;

				function mouseDown(e) {
					switch (e.which) {
						case 1:
							// left mouse button
							break;
						case 2:
						case 3:
							// right or middle mouse button
							return;
					}

					// save the draggable setting to restore after resize
					savedDraggable = gridster.draggable.enabled;
					if (savedDraggable) {
						gridster.draggable.enabled = false;
						scope.$broadcast('gridster-draggable-changed', gridster);
					}

					// Get the current mouse position.
					lastMouseX = e.pageX;
					lastMouseY = e.pageY;

					// Record current widget dimensions
					elmX = parseInt($el.css('left'), 10);
					elmY = parseInt($el.css('top'), 10);
					elmW = $el[0].offsetWidth;
					elmH = $el[0].offsetHeight;

					originalWidth = item.sizeX;
					originalHeight = item.sizeY;

					resizeStart(e);

					return true;
				}

				function resizeStart(e) {
					$el.addClass('gridster-item-moving');
					$el.addClass('gridster-item-resizing');

					gridster.movingItem = item;

					item.setElementSizeX();
					item.setElementSizeY();
					item.setElementPosition();
					gridster.updateHeight(1);

					scope.$apply(function() {
						// callback
						if (gridster.resizable && gridster.resizable.start) {
							gridster.resizable.start(e, $el, itemOptions); // options is the item model
						}
					});
				}

				function mouseMove(e) {
					var maxLeft = gridster.curWidth - 1;

					// Get the current mouse position.
					mouseX = e.pageX;
					mouseY = e.pageY;

					// Get the deltas
					var diffX = mouseX - lastMouseX + mOffX;
					var diffY = mouseY - lastMouseY + mOffY;
					mOffX = mOffY = 0;

					// Update last processed mouse positions.
					lastMouseX = mouseX;
					lastMouseY = mouseY;

					var dY = diffY,
						dX = diffX;

					if (hClass.indexOf('n') >= 0) {
						if (elmH - dY < getMinHeight()) {
							diffY = elmH - getMinHeight();
							mOffY = dY - diffY;
						} else if (elmY + dY < minTop) {
							diffY = minTop - elmY;
							mOffY = dY - diffY;
						}
						elmY += diffY;
						elmH -= diffY;
					}
					if (hClass.indexOf('s') >= 0) {
						if (elmH + dY < getMinHeight()) {
							diffY = getMinHeight() - elmH;
							mOffY = dY - diffY;
						} else if (elmY + elmH + dY > maxTop) {
							diffY = maxTop - elmY - elmH;
							mOffY = dY - diffY;
						}
						elmH += diffY;
					}
					if (hClass.indexOf('w') >= 0) {
						if (elmW - dX < getMinWidth()) {
							diffX = elmW - getMinWidth();
							mOffX = dX - diffX;
						} else if (elmX + dX < minLeft) {
							diffX = minLeft - elmX;
							mOffX = dX - diffX;
						}
						elmX += diffX;
						elmW -= diffX;
					}
					if (hClass.indexOf('e') >= 0) {
						if (elmW + dX < getMinWidth()) {
							diffX = getMinWidth() - elmW;
							mOffX = dX - diffX;
						} else if (elmX + elmW + dX > maxLeft) {
							diffX = maxLeft - elmX - elmW;
							mOffX = dX - diffX;
						}
						elmW += diffX;
					}

					// set new position
					$el.css({
						'top': elmY + 'px',
						'left': elmX + 'px',
						'width': elmW + 'px',
						'height': elmH + 'px'
					});

					resize(e);

					return true;
				}

				function mouseUp(e) {
					// restore draggable setting to its original state
					if (gridster.draggable.enabled !== savedDraggable) {
						gridster.draggable.enabled = savedDraggable;
						scope.$broadcast('gridster-draggable-changed', gridster);
					}

					mOffX = mOffY = 0;

					resizeStop(e);

					return true;
				}

				function resize(e) {
					var oldRow = item.row,
						oldCol = item.col,
						oldSizeX = item.sizeX,
						oldSizeY = item.sizeY,
						hasCallback = gridster.resizable && gridster.resizable.resize;

					var col = item.col;
					// only change column if grabbing left edge
					if (['w', 'nw', 'sw'].indexOf(handleClass) !== -1) {
						col = gridster.pixelsToColumns(elmX, false);
					}

					var row = item.row;
					// only change row if grabbing top edge
					if (['n', 'ne', 'nw'].indexOf(handleClass) !== -1) {
						row = gridster.pixelsToRows(elmY, false);
					}

					var sizeX = item.sizeX;
					// only change row if grabbing left or right edge
					if (['n', 's'].indexOf(handleClass) === -1) {
						sizeX = gridster.pixelsToColumns(elmW, true);
					}

					var sizeY = item.sizeY;
					// only change row if grabbing top or bottom edge
					if (['e', 'w'].indexOf(handleClass) === -1) {
						sizeY = gridster.pixelsToRows(elmH, true);
					}


					var canOccupy = row > -1 && col > -1 && sizeX + col <= gridster.columns && sizeY + row <= gridster.maxRows;
					if (canOccupy && (gridster.pushing !== false || gridster.getItems(row, col, sizeX, sizeY, item).length === 0)) {
						item.row = row;
						item.col = col;
						item.sizeX = sizeX;
						item.sizeY = sizeY;
					}
					var isChanged = item.row !== oldRow || item.col !== oldCol || item.sizeX !== oldSizeX || item.sizeY !== oldSizeY;

					if (hasCallback || isChanged) {
						scope.$apply(function() {
							if (hasCallback) {
								gridster.resizable.resize(e, $el, itemOptions); // options is the item model
							}
						});
					}
				}

				function resizeStop(e) {
					$el.removeClass('gridster-item-moving');
					$el.removeClass('gridster-item-resizing');

					gridster.movingItem = null;

					item.setPosition(item.row, item.col);
					item.setSizeY(item.sizeY);
					item.setSizeX(item.sizeX);

					scope.$apply(function() {
						if (gridster.resizable && gridster.resizable.stop) {
							gridster.resizable.stop(e, $el, itemOptions); // options is the item model
						}
					});
				}

				var $dragHandle = null;
				var unifiedInput;

				this.enable = function() {
					if (!$dragHandle) {
						$dragHandle = angular.element('<div class="gridster-item-resizable-handler handle-' + hClass + '"></div>');
						$el.append($dragHandle);
					}

					unifiedInput = new GridsterTouch($dragHandle[0], mouseDown, mouseMove, mouseUp);
					unifiedInput.enable();
				};

				this.disable = function() {
					if ($dragHandle) {
						$dragHandle.remove();
						$dragHandle = null;
					}

					unifiedInput.disable();
					unifiedInput = undefined;
				};

				this.destroy = function() {
					this.disable();
				};
			}

			var handles = [];
			var handlesOpts = gridster.resizable.handles;
			if (typeof handlesOpts === 'string') {
				handlesOpts = gridster.resizable.handles.split(',');
			}
			var enabled = false;

			for (var c = 0, l = handlesOpts.length; c < l; c++) {
				handles.push(new ResizeHandle(handlesOpts[c]));
			}

			this.enable = function() {
				if (enabled) {
					return;
				}
				for (var c = 0, l = handles.length; c < l; c++) {
					handles[c].enable();
				}
				enabled = true;
			};

			this.disable = function() {
				if (!enabled) {
					return;
				}
				for (var c = 0, l = handles.length; c < l; c++) {
					handles[c].disable();
				}
				enabled = false;
			};

			this.toggle = function(enabled) {
				if (enabled) {
					this.enable();
				} else {
					this.disable();
				}
			};

			this.destroy = function() {
				for (var c = 0, l = handles.length; c < l; c++) {
					handles[c].destroy();
				}
			};
		}
		return GridsterResizable;
	}])

	.factory('gridsterDebounce', function() {
		return function gridsterDebounce(func, wait, immediate) {
			var timeout;
			return function() {
				var context = this,
					args = arguments;
				var later = function() {
					timeout = null;
					if (!immediate) {
						func.apply(context, args);
					}
				};
				var callNow = immediate && !timeout;
				clearTimeout(timeout);
				timeout = setTimeout(later, wait);
				if (callNow) {
					func.apply(context, args);
				}
			};
		};
	})

	/**
	 * GridsterItem directive
	 * @param $parse
	 * @param GridsterDraggable
	 * @param GridsterResizable
	 * @param gridsterDebounce
	 */
	.directive('gridsterItem', ['$parse', 'GridsterDraggable', 'GridsterResizable', 'gridsterDebounce',
		function($parse, GridsterDraggable, GridsterResizable, gridsterDebounce) {
			return {
				scope: true,
				restrict: 'EA',
				controller: 'GridsterItemCtrl',
				controllerAs: 'gridsterItem',
				require: ['^gridster', 'gridsterItem'],
				link: function(scope, $el, attrs, controllers) {
					var optionsKey = attrs.gridsterItem,
						options;

					var gridster = controllers[0],
						item = controllers[1];

					scope.gridster = gridster;

					// bind the item's position properties
					// options can be an object specified by gridster-item="object"
					// or the options can be the element html attributes object
					if (optionsKey) {
						var $optionsGetter = $parse(optionsKey);
						options = $optionsGetter(scope) || {};
						if (!options && $optionsGetter.assign) {
							options = {
								row: item.row,
								col: item.col,
								sizeX: item.sizeX,
								sizeY: item.sizeY,
								minSizeX: 0,
								minSizeY: 0,
								maxSizeX: null,
								maxSizeY: null
							};
							$optionsGetter.assign(scope, options);
						}
					} else {
						options = attrs;
					}

					item.init($el, gridster);

					$el.addClass('gridster-item');

					var aspects = ['minSizeX', 'maxSizeX', 'minSizeY', 'maxSizeY', 'sizeX', 'sizeY', 'row', 'col'],
						$getters = {};

					var expressions = [];
					var aspectFn = function(aspect) {
						var expression;
						if (typeof options[aspect] === 'string') {
							// watch the expression in the scope
							expression = options[aspect];
						} else if (typeof options[aspect.toLowerCase()] === 'string') {
							// watch the expression in the scope
							expression = options[aspect.toLowerCase()];
						} else if (optionsKey) {
							// watch the expression on the options object in the scope
							expression = optionsKey + '.' + aspect;
						} else {
							return;
						}
						expressions.push('"' + aspect + '":' + expression);
						$getters[aspect] = $parse(expression);

						// initial set
						var val = $getters[aspect](scope);
						if (typeof val === 'number') {
							item[aspect] = val;
						}
					};

					for (var i = 0, l = aspects.length; i < l; ++i) {
						aspectFn(aspects[i]);
					}

					var watchExpressions = '{' + expressions.join(',') + '}';
					// when the value changes externally, update the internal item object
					scope.$watchCollection(watchExpressions, function(newVals, oldVals) {
						for (var aspect in newVals) {
							var newVal = newVals[aspect];
							var oldVal = oldVals[aspect];
							if (oldVal === newVal) {
								continue;
							}
							newVal = parseInt(newVal, 10);
							if (!isNaN(newVal)) {
								item[aspect] = newVal;
							}
						}
					});

					function positionChanged() {
						// call setPosition so the element and gridster controller are updated
						item.setPosition(item.row, item.col);

						// when internal item position changes, update externally bound values
						if ($getters.row && $getters.row.assign) {
							$getters.row.assign(scope, item.row);
						}
						if ($getters.col && $getters.col.assign) {
							$getters.col.assign(scope, item.col);
						}
					}
					scope.$watch(function() {
						return item.row + ',' + item.col;
					}, positionChanged);

					function sizeChanged() {
						var changedX = item.setSizeX(item.sizeX, true);
						if (changedX && $getters.sizeX && $getters.sizeX.assign) {
							$getters.sizeX.assign(scope, item.sizeX);
						}
						var changedY = item.setSizeY(item.sizeY, true);
						if (changedY && $getters.sizeY && $getters.sizeY.assign) {
							$getters.sizeY.assign(scope, item.sizeY);
						}

						if (changedX || changedY) {
							item.gridster.moveOverlappingItems(item);
							gridster.layoutChanged();
							scope.$broadcast('gridster-item-resized', item);
						}
					}

					scope.$watch(function() {
						return item.sizeY + ',' + item.sizeX + ',' + item.minSizeX + ',' + item.maxSizeX + ',' + item.minSizeY + ',' + item.maxSizeY;
					}, sizeChanged);

					var draggable = new GridsterDraggable($el, scope, gridster, item, options);
					var resizable = new GridsterResizable($el, scope, gridster, item, options);

					var updateResizable = function() {
						resizable.toggle(!gridster.isMobile && gridster.resizable && gridster.resizable.enabled);
					};
					updateResizable();

					var updateDraggable = function() {
						draggable.toggle(!gridster.isMobile && gridster.draggable && gridster.draggable.enabled);
					};
					updateDraggable();

					scope.$on('gridster-draggable-changed', updateDraggable);
					scope.$on('gridster-resizable-changed', updateResizable);
					scope.$on('gridster-resized', updateResizable);
					scope.$on('gridster-mobile-changed', function() {
						updateResizable();
						updateDraggable();
					});

					function whichTransitionEvent() {
						var el = document.createElement('div');
						var transitions = {
							'transition': 'transitionend',
							'OTransition': 'oTransitionEnd',
							'MozTransition': 'transitionend',
							'WebkitTransition': 'webkitTransitionEnd'
						};
						for (var t in transitions) {
							if (el.style[t] !== undefined) {
								return transitions[t];
							}
						}
					}

					var debouncedTransitionEndPublisher = gridsterDebounce(function() {
						scope.$apply(function() {
							scope.$broadcast('gridster-item-transition-end', item);
						});
					}, 50);

					$el.on(whichTransitionEvent(), debouncedTransitionEndPublisher);

					scope.$broadcast('gridster-item-initialized', item);

					return scope.$on('$destroy', function() {
						try {
							resizable.destroy();
							draggable.destroy();
						} catch (e) {}

						try {
							gridster.removeItem(item);
						} catch (e) {}

						try {
							item.destroy();
						} catch (e) {}
					});
				}
			};
		}
	])

	.directive('gridsterNoDrag', function() {
		return {
			restrict: 'A',
			link: function(scope, $element) {
				$element.addClass('gridster-no-drag');
			}
		};
	})

	;

}));

/*
@license textAngular
Author : Austin Anderson
License : 2013 MIT
Version 1.4.6

See README.md or https://github.com/fraywing/textAngular/wiki for requirements and use.
*/

/*
Commonjs package manager support (eg componentjs).
*/

/* istanbul ignore next:  */
'undefined'!=typeof module&&'undefined'!=typeof exports&&module.exports===exports&&(module.exports='textAngular');

(function(){ // encapsulate all variables so they don't become global vars
"use strict";
// IE version detection - http://stackoverflow.com/questions/4169160/javascript-ie-detection-why-not-use-simple-conditional-comments
// We need this as IE sometimes plays funny tricks with the contenteditable.
// ----------------------------------------------------------
// If you're not in IE (or IE version is less than 5) then:
// ie === undefined
// If you're in IE (>=5) then you can determine which version:
// ie === 7; // IE7
// Thus, to detect IE:
// if (ie) {}
// And to detect the version:
// ie === 6 // IE6
// ie > 7 // IE8, IE9, IE10 ...
// ie < 9 // Anything less than IE9
// ----------------------------------------------------------
/* istanbul ignore next: untestable browser check */
var _browserDetect = {
	ie: (function(){
		var undef,
			v = 3,
			div = document.createElement('div'),
			all = div.getElementsByTagName('i');

		while (
			div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->',
			all[0]
		);

		return v > 4 ? v : undef;
	}()),
	webkit: /AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)
};

// fix a webkit bug, see: https://gist.github.com/shimondoodkin/1081133
// this is set true when a blur occurs as the blur of the ta-bind triggers before the click
var globalContentEditableBlur = false;
/* istanbul ignore next: Browser Un-Focus fix for webkit */
if(_browserDetect.webkit) {
	document.addEventListener("mousedown", function(_event){
		var e = _event || window.event;
		var curelement = e.target;
		if(globalContentEditableBlur && curelement !== null){
			var isEditable = false;
			var tempEl = curelement;
			while(tempEl !== null && tempEl.tagName.toLowerCase() !== 'html' && !isEditable){
				isEditable = tempEl.contentEditable === 'true';
				tempEl = tempEl.parentNode;
			}
			if(!isEditable){
				document.getElementById('textAngular-editableFix-010203040506070809').setSelectionRange(0, 0); // set caret focus to an element that handles caret focus correctly.
				curelement.focus(); // focus the wanted element.
				if (curelement.select) {
					curelement.select(); // use select to place cursor for input elements.
				}
			}
		}
		globalContentEditableBlur = false;
	}, false); // add global click handler
	angular.element(document).ready(function () {
		angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" aria-hidden="true" unselectable="on" tabIndex="-1">'));
	});
}

// Gloabl to textAngular REGEXP vars for block and list elements.

var BLOCKELEMENTS = /^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i;
var LISTELEMENTS = /^(ul|li|ol)$/i;
var VALIDELEMENTS = /^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;

// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Compatibility
/* istanbul ignore next: trim shim for older browsers */
if (!String.prototype.trim) {
	String.prototype.trim = function () {
		return this.replace(/^\s+|\s+$/g, '');
	};
}

/*
	Custom stylesheet for the placeholders rules.
	Credit to: http://davidwalsh.name/add-rules-stylesheets
*/
var sheet, addCSSRule, removeCSSRule, _addCSSRule, _removeCSSRule, _getRuleIndex;
/* istanbul ignore else: IE <8 test*/
if(_browserDetect.ie > 8 || _browserDetect.ie === undefined){
	var _sheets = document.styleSheets;
	/* istanbul ignore next: preference for stylesheet loaded externally */
	for(var i = 0; i < _sheets.length; i++){
		if(_sheets[i].media.length === 0 || _sheets[i].media.mediaText.match(/(all|screen)/ig)){
			if(_sheets[i].href){
				if(_sheets[i].href.match(/textangular\.(min\.|)css/ig)){
					sheet = _sheets[i];
					break;
				}
			}
		}
	}
	/* istanbul ignore next: preference for stylesheet loaded externally */
	if(!sheet){
		// this sheet is used for the placeholders later on.
		sheet = (function() {
			// Create the <style> tag
			var style = document.createElement("style");
			/* istanbul ignore else : WebKit hack :( */
			if(_browserDetect.webkit) style.appendChild(document.createTextNode(""));

			// Add the <style> element to the page, add as first so the styles can be overridden by custom stylesheets
			document.getElementsByTagName('head')[0].appendChild(style);

			return style.sheet;
		})();
	}

	// use as: addCSSRule("header", "float: left");
	addCSSRule = function(selector, rules) {
		return _addCSSRule(sheet, selector, rules);
	};
	_addCSSRule = function(_sheet, selector, rules){
		var insertIndex;
		var insertedRule;
		// This order is important as IE 11 has both cssRules and rules but they have different lengths - cssRules is correct, rules gives an error in IE 11
		/* istanbul ignore next: browser catches */
		if(_sheet.cssRules) insertIndex = Math.max(_sheet.cssRules.length - 1, 0);
		else if(_sheet.rules) insertIndex = Math.max(_sheet.rules.length - 1, 0);

		/* istanbul ignore else: untestable IE option */
		if(_sheet.insertRule) {
			_sheet.insertRule(selector + "{" + rules + "}", insertIndex);
		}
		else {
			_sheet.addRule(selector, rules, insertIndex);
		}
		/* istanbul ignore next: browser catches */
		if(sheet.rules) insertedRule = sheet.rules[insertIndex];
		else if(sheet.cssRules) insertedRule = sheet.cssRules[insertIndex];
		// return the inserted stylesheet rule
		return insertedRule;
	};

	_getRuleIndex = function(rule, rules) {
		var i, ruleIndex;
		for (i=0; i < rules.length; i++) {
			/* istanbul ignore else: check for correct rule */
			if (rules[i].cssText === rule.cssText) {
				ruleIndex = i;
				break;
			}
		}
		return ruleIndex;
	};

	removeCSSRule = function(rule){
		_removeCSSRule(sheet, rule);
	};
	/* istanbul ignore next: tests are browser specific */
	_removeCSSRule = function(sheet, rule){
		var rules = sheet.cssRules || sheet.rules;
		if(!rules || rules.length === 0) return;
		var ruleIndex = _getRuleIndex(rule, rules);
		if(sheet.removeRule){
			sheet.removeRule(ruleIndex);
		}else{
			sheet.deleteRule(ruleIndex);
		}
	};
}

angular.module('textAngular.factories', [])
.factory('taBrowserTag', [function(){
	return function(tag){
		/* istanbul ignore next: ie specific test */
		if(!tag) return (_browserDetect.ie <= 8)? 'P' : 'p';
		else if(tag === '') return (_browserDetect.ie === undefined)? 'div' : (_browserDetect.ie <= 8)? 'P' : 'p';
		else return (_browserDetect.ie <= 8)? tag.toUpperCase() : tag;
	};
}]).factory('taApplyCustomRenderers', ['taCustomRenderers', 'taDOM', function(taCustomRenderers, taDOM){
	return function(val){
		var element = angular.element('<div></div>');
		element[0].innerHTML = val;

		angular.forEach(taCustomRenderers, function(renderer){
			var elements = [];
			// get elements based on what is defined. If both defined do secondary filter in the forEach after using selector string
			if(renderer.selector && renderer.selector !== '')
				elements = element.find(renderer.selector);
			/* istanbul ignore else: shouldn't fire, if it does we're ignoring everything */
			else if(renderer.customAttribute && renderer.customAttribute !== '')
				elements = taDOM.getByAttribute(element, renderer.customAttribute);
			// process elements if any found
			angular.forEach(elements, function(_element){
				_element = angular.element(_element);
				if(renderer.selector && renderer.selector !== '' && renderer.customAttribute && renderer.customAttribute !== ''){
					if(_element.attr(renderer.customAttribute) !== undefined) renderer.renderLogic(_element);
				} else renderer.renderLogic(_element);
			});
		});

		return element[0].innerHTML;
	};
}]).factory('taFixChrome', function(){
	// get whaterever rubbish is inserted in chrome
	// should be passed an html string, returns an html string
	var taFixChrome = function(html){
		if(!html || !angular.isString(html) || html.length <= 0) return html;
		// grab all elements with a style attibute
		var spanMatch = /<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/ig;
		var match, styleVal, newTag, finalHtml = '', lastIndex = 0;
		while(match = spanMatch.exec(html)){
			// one of the quoted values ' or "
			/* istanbul ignore next: quotations match */
			styleVal = match[3] || match[4];
			// test for chrome inserted junk
			if(styleVal && styleVal.match(/line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;/i)){
				// replace original tag with new tag
				styleVal = styleVal.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;/ig, '');
				newTag = '<' + match[1].trim();
				if(styleVal.trim().length > 0) newTag += ' style=' + match[2].substring(0,1) + styleVal + match[2].substring(0,1);
				newTag += match[5].trim() + ">";
				finalHtml += html.substring(lastIndex, match.index) + newTag;
				lastIndex = match.index + match[0].length;
			}
		}
		finalHtml += html.substring(lastIndex);
		// only replace when something has changed, else we get focus problems on inserting lists
		if(lastIndex > 0){
			// replace all empty strings
			return finalHtml.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/ig, '$1');
		} else return html;
	};
	return taFixChrome;
}).factory('taSanitize', ['$sanitize', function taSanitizeFactory($sanitize){

	var convert_infos = [
		{
			property: 'font-weight',
			values: [ 'bold' ],
			tag: 'b'
		},
		{
			property: 'font-style',
			values: [ 'italic' ],
			tag: 'i'
		}
	];
	
	var styleMatch = [];
	for(var i = 0; i < convert_infos.length; i++){
		var _partialStyle = '(' + convert_infos[i].property + ':\\s*(';
		for(var j = 0; j < convert_infos[i].values.length; j++){
			/* istanbul ignore next: not needed to be tested yet */
			if(j > 0) _partialStyle += '|';
			_partialStyle += convert_infos[i].values[j];
		}
		_partialStyle += ');)';
		styleMatch.push(_partialStyle);
	}
	var styleRegexString = '(' + styleMatch.join('|') + ')';
	
	function wrapNested(html, wrapTag) {
		var depth = 0;
		var lastIndex = 0;
		var match;
		var tagRegex = /<[^>]*>/ig;
		while(match = tagRegex.exec(html)){
			lastIndex = match.index;
			if(match[0].substr(1, 1) === '/'){
				if(depth === 0) break;
				else depth--;
			}else depth++;
		}
		return wrapTag +
			html.substring(0, lastIndex) +
			// get the start tags reversed - this is safe as we construct the strings with no content except the tags
			angular.element(wrapTag)[0].outerHTML.substring(wrapTag.length) +
			html.substring(lastIndex);
	}
	
	function transformLegacyStyles(html){
		if(!html || !angular.isString(html) || html.length <= 0) return html;
		var i;
		var styleElementMatch = /<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/ig;
		var match, subMatch, styleVal, newTag, lastNewTag = '', newHtml, finalHtml = '', lastIndex = 0;
		while(match = styleElementMatch.exec(html)){
			// one of the quoted values ' or "
			/* istanbul ignore next: quotations match */
			styleVal = match[3] || match[4];
			var styleRegex = new RegExp(styleRegexString, 'i');
			// test for style values to change
			if(angular.isString(styleVal) && styleRegex.test(styleVal)){
				// remove build tag list
				newTag = '';
				// init regex here for exec
				var styleRegexExec = new RegExp(styleRegexString, 'ig');
				// find relevand tags and build a string of them
				while(subMatch = styleRegexExec.exec(styleVal)){
					for(i = 0; i < convert_infos.length; i++){
						if(!!subMatch[(i*2) + 2]){
							newTag += '<' + convert_infos[i].tag + '>';
						}
					}
				}
				// recursively find more legacy styles in html before this tag and after the previous match (if any)
				newHtml = transformLegacyStyles(html.substring(lastIndex, match.index));
				// build up html
				if(lastNewTag.length > 0){
					finalHtml += wrapNested(newHtml, lastNewTag);
				}else finalHtml += newHtml;
				// grab the style val without the transformed values
				styleVal = styleVal.replace(new RegExp(styleRegexString, 'ig'), '');
				// build the html tag
				finalHtml += '<' + match[1].trim();
				if(styleVal.length > 0) finalHtml += ' style="' + styleVal + '"';
				finalHtml += match[5] + '>';
				// update the start index to after this tag
				lastIndex = match.index + match[0].length;
				lastNewTag = newTag;
			}
		}
		if(lastNewTag.length > 0){
			finalHtml += wrapNested(html.substring(lastIndex), lastNewTag);
		}
		else finalHtml += html.substring(lastIndex);
		return finalHtml;
	}
	
	function transformLegacyAttributes(html){
		if(!html || !angular.isString(html) || html.length <= 0) return html;
		// replace all align='...' tags with text-align attributes
		var attrElementMatch = /<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/ig;
		var match, finalHtml = '', lastIndex = 0;
		// match all attr tags
		while(match = attrElementMatch.exec(html)){
			// add all html before this tag
			finalHtml += html.substring(lastIndex, match.index);
			// record last index after this tag
			lastIndex = match.index + match[0].length;
			// construct tag without the align attribute
			var newTag = '<' + match[1] + match[5];
			// add the style attribute
			if(/style=("([^"]+)"|'([^']+)')/ig.test(newTag)){
				/* istanbul ignore next: quotations match */
				newTag = newTag.replace(/style=("([^"]+)"|'([^']+)')/i, 'style="$2$3 text-align:' + (match[3] || match[4]) + ';"');
			}else{
				/* istanbul ignore next: quotations match */
				newTag += ' style="text-align:' + (match[3] || match[4]) + ';"';
			}
			newTag += '>';
			// add to html
			finalHtml += newTag;
		}
		// return with remaining html
		return finalHtml + html.substring(lastIndex);
	}
	
	return function taSanitize(unsafe, oldsafe, ignore){
		// unsafe html should NEVER built into a DOM object via angular.element. This allows XSS to be inserted and run.
		if ( !ignore ) {
			try {
				unsafe = transformLegacyStyles(unsafe);
			} catch (e) {
			}
		}

		// unsafe and oldsafe should be valid HTML strings
		// any exceptions (lets say, color for example) should be made here but with great care
		// setup unsafe element for modification
		unsafe = transformLegacyAttributes(unsafe);
		
		var safe;
		try {
			safe = $sanitize(unsafe);
			// do this afterwards, then the $sanitizer should still throw for bad markup
			if(ignore) safe = unsafe;
		} catch (e){
			safe = oldsafe || '';
		}
		
		// Do processing for <pre> tags, removing tabs and return carriages outside of them
		
		var _preTags = safe.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/ig);
		var processedSafe = safe.replace(/(&#(9|10);)*/ig, '');
		var re = /<pre[^>]*>.*?<\/pre[^>]*>/ig;
		var index = 0;
		var lastIndex = 0;
		var origTag;
		safe = '';
		while((origTag = re.exec(processedSafe)) !== null && index < _preTags.length){
			safe += processedSafe.substring(lastIndex, origTag.index) + _preTags[index];
			lastIndex = origTag.index + origTag[0].length;
			index++;
		}
		return safe + processedSafe.substring(lastIndex);
	};
}]).factory('taToolExecuteAction', ['$q', '$log', function($q, $log){
	// this must be called on a toolScope or instance
	return function(editor){
		if(editor !== undefined) this.$editor = function(){ return editor; };
		var deferred = $q.defer(),
			promise = deferred.promise,
			_editor = this.$editor();
		// pass into the action the deferred function and also the function to reload the current selection if rangy available
		var result;
		try{
			result = this.action(deferred, _editor.startAction());
			// We set the .finally callback here to make sure it doesn't get executed before any other .then callback.
			promise['finally'](function(){
				_editor.endAction.call(_editor);
			});
		}catch(exc){
			$log.error(exc);
		}
		if(result || result === undefined){
			// if true or undefined is returned then the action has finished. Otherwise the deferred action will be resolved manually.
			deferred.resolve();
		}
	};
}]);
angular.module('textAngular.DOM', ['textAngular.factories'])
.factory('taExecCommand', ['taSelection', 'taBrowserTag', '$document', function(taSelection, taBrowserTag, $document){
	var listToDefault = function(listElement, defaultWrap){
		var $target, i;
		// if all selected then we should remove the list
		// grab all li elements and convert to taDefaultWrap tags
		var children = listElement.find('li');
		for(i = children.length - 1; i >= 0; i--){
			$target = angular.element('<' + defaultWrap + '>' + children[i].innerHTML + '</' + defaultWrap + '>');
			listElement.after($target);
		}
		listElement.remove();
		taSelection.setSelectionToElementEnd($target[0]);
	};
	var selectLi = function(liElement){
		if(/(<br(|\/)>)$/i.test(liElement.innerHTML.trim())) taSelection.setSelectionBeforeElement(angular.element(liElement).find("br")[0]);
		else taSelection.setSelectionToElementEnd(liElement);
	};
	var listToList = function(listElement, newListTag){
		var $target = angular.element('<' + newListTag + '>' + listElement[0].innerHTML + '</' + newListTag + '>');
		listElement.after($target);
		listElement.remove();
		selectLi($target.find('li')[0]);
	};
	var childElementsToList = function(elements, listElement, newListTag){
		var html = '';
		for(var i = 0; i < elements.length; i++){
			html += '<' + taBrowserTag('li') + '>' + elements[i].innerHTML + '</' + taBrowserTag('li') + '>';
		}
		var $target = angular.element('<' + newListTag + '>' + html + '</' + newListTag + '>');
		listElement.after($target);
		listElement.remove();
		selectLi($target.find('li')[0]);
	};
	return function(taDefaultWrap, topNode){
		taDefaultWrap = taBrowserTag(taDefaultWrap);
		return function(command, showUI, options, defaultTagAttributes){
			var i, $target, html, _nodes, next, optionsTagName, selectedElement;
			var defaultWrapper = angular.element('<' + taDefaultWrap + '>');
			try{
				selectedElement = taSelection.getSelectionElement();
			}catch(e){}
			var $selected = angular.element(selectedElement);
			if(selectedElement !== undefined){
				var tagName = selectedElement.tagName.toLowerCase();
				if(command.toLowerCase() === 'insertorderedlist' || command.toLowerCase() === 'insertunorderedlist'){
					var selfTag = taBrowserTag((command.toLowerCase() === 'insertorderedlist')? 'ol' : 'ul');
					if(tagName === selfTag){
						// if all selected then we should remove the list
						// grab all li elements and convert to taDefaultWrap tags
						return listToDefault($selected, taDefaultWrap);
					}else if(tagName === 'li' && $selected.parent()[0].tagName.toLowerCase() === selfTag && $selected.parent().children().length === 1){
						// catch for the previous statement if only one li exists
						return listToDefault($selected.parent(), taDefaultWrap);
					}else if(tagName === 'li' && $selected.parent()[0].tagName.toLowerCase() !== selfTag && $selected.parent().children().length === 1){
						// catch for the previous statement if only one li exists
						return listToList($selected.parent(), selfTag);
					}else if(tagName.match(BLOCKELEMENTS) && !$selected.hasClass('ta-bind')){
						// if it's one of those block elements we have to change the contents
						// if it's a ol/ul we are changing from one to the other
						if(tagName === 'ol' || tagName === 'ul'){
							return listToList($selected, selfTag);
						}else{
							var childBlockElements = false;
							angular.forEach($selected.children(), function(elem){
								if(elem.tagName.match(BLOCKELEMENTS)) {
									childBlockElements = true;
								}
							});
							if(childBlockElements){
								return childElementsToList($selected.children(), $selected, selfTag);
							}else{
								return childElementsToList([angular.element('<div>' + selectedElement.innerHTML + '</div>')[0]], $selected, selfTag);
							}
						}
					}else if(tagName.match(BLOCKELEMENTS)){
						// if we get here then all the contents of the ta-bind are selected
						_nodes = taSelection.getOnlySelectedElements();
						if(_nodes.length === 0){
							// here is if there is only text in ta-bind ie <div ta-bind>test content</div>
							$target = angular.element('<' + selfTag + '><li>' + selectedElement.innerHTML + '</li></' + selfTag + '>');
							$selected.html('');
							$selected.append($target);
						}else if(_nodes.length === 1 && (_nodes[0].tagName.toLowerCase() === 'ol' || _nodes[0].tagName.toLowerCase() === 'ul')){
							if(_nodes[0].tagName.toLowerCase() === selfTag){
								// remove
								return listToDefault(angular.element(_nodes[0]), taDefaultWrap);
							}else{
								return listToList(angular.element(_nodes[0]), selfTag);
							}
						}else{
							html = '';
							var $nodes = [];
							for(i = 0; i < _nodes.length; i++){
								/* istanbul ignore else: catch for real-world can't make it occur in testing */
								if(_nodes[i].nodeType !== 3){
									var $n = angular.element(_nodes[i]);
									/* istanbul ignore if: browser check only, phantomjs doesn't return children nodes but chrome at least does */
									if(_nodes[i].tagName.toLowerCase() === 'li') continue;
									else if(_nodes[i].tagName.toLowerCase() === 'ol' || _nodes[i].tagName.toLowerCase() === 'ul'){
										html += $n[0].innerHTML; // if it's a list, add all it's children
									}else if(_nodes[i].tagName.toLowerCase() === 'span' && (_nodes[i].childNodes[0].tagName.toLowerCase() === 'ol' || _nodes[i].childNodes[0].tagName.toLowerCase() === 'ul')){
										html += $n[0].childNodes[0].innerHTML; // if it's a list, add all it's children
									}else{
										html += '<' + taBrowserTag('li') + '>' + $n[0].innerHTML + '</' + taBrowserTag('li') + '>';
									}
									$nodes.unshift($n);
								}
							}
							$target = angular.element('<' + selfTag + '>' + html + '</' + selfTag + '>');
							$nodes.pop().replaceWith($target);
							angular.forEach($nodes, function($node){ $node.remove(); });
						}
						taSelection.setSelectionToElementEnd($target[0]);
						return;
					}
				}else if(command.toLowerCase() === 'formatblock'){
					optionsTagName = options.toLowerCase().replace(/[<>]/ig, '');
					if(optionsTagName.trim() === 'default') {
						optionsTagName = taDefaultWrap;
						options = '<' + taDefaultWrap + '>';
					}
					if(tagName === 'li') $target = $selected.parent();
					else $target = $selected;
					// find the first blockElement
					while(!$target[0].tagName || !$target[0].tagName.match(BLOCKELEMENTS) && !$target.parent().attr('contenteditable')){
						$target = $target.parent();
						/* istanbul ignore next */
						tagName = ($target[0].tagName || '').toLowerCase();
					}
					if(tagName === optionsTagName){
						// $target is wrap element
						_nodes = $target.children();
						var hasBlock = false;
						for(i = 0; i < _nodes.length; i++){
							hasBlock = hasBlock || _nodes[i].tagName.match(BLOCKELEMENTS);
						}
						if(hasBlock){
							$target.after(_nodes);
							next = $target.next();
							$target.remove();
							$target = next;
						}else{
							defaultWrapper.append($target[0].childNodes);
							$target.after(defaultWrapper);
							$target.remove();
							$target = defaultWrapper;
						}
					}else if($target.parent()[0].tagName.toLowerCase() === optionsTagName && !$target.parent().hasClass('ta-bind')){
						//unwrap logic for parent
						var blockElement = $target.parent();
						var contents = blockElement.contents();
						for(i = 0; i < contents.length; i ++){
							/* istanbul ignore next: can't test - some wierd thing with how phantomjs works */
							if(blockElement.parent().hasClass('ta-bind') && contents[i].nodeType === 3){
								defaultWrapper = angular.element('<' + taDefaultWrap + '>');
								defaultWrapper[0].innerHTML = contents[i].outerHTML;
								contents[i] = defaultWrapper[0];
							}
							blockElement.parent()[0].insertBefore(contents[i], blockElement[0]);
						}
						blockElement.remove();
					}else if(tagName.match(LISTELEMENTS)){
						// wrapping a list element
						$target.wrap(options);
					}else{
						// default wrap behaviour
						_nodes = taSelection.getOnlySelectedElements();
						if(_nodes.length === 0) _nodes = [$target[0]];
						// find the parent block element if any of the nodes are inline or text
						for(i = 0; i < _nodes.length; i++){
							if(_nodes[i].nodeType === 3 || !_nodes[i].tagName.match(BLOCKELEMENTS)){
								while(_nodes[i].nodeType === 3 || !_nodes[i].tagName || !_nodes[i].tagName.match(BLOCKELEMENTS)){
									_nodes[i] = _nodes[i].parentNode;
								}
							}
						}
						if(angular.element(_nodes[0]).hasClass('ta-bind')){
							$target = angular.element(options);
							$target[0].innerHTML = _nodes[0].innerHTML;
							_nodes[0].innerHTML = $target[0].outerHTML;
						}else if(optionsTagName === 'blockquote'){
							// blockquotes wrap other block elements
							html = '';
							for(i = 0; i < _nodes.length; i++){
								html += _nodes[i].outerHTML;
							}
							$target = angular.element(options);
							$target[0].innerHTML = html;
							_nodes[0].parentNode.insertBefore($target[0],_nodes[0]);
							for(i = _nodes.length - 1; i >= 0; i--){
								/* istanbul ignore else:  */
								if(_nodes[i].parentNode) _nodes[i].parentNode.removeChild(_nodes[i]);
							}
						}
						else {
							// regular block elements replace other block elements
							for(i = 0; i < _nodes.length; i++){
								$target = angular.element(options);
								$target[0].innerHTML = _nodes[i].innerHTML;
								_nodes[i].parentNode.insertBefore($target[0],_nodes[i]);
								_nodes[i].parentNode.removeChild(_nodes[i]);
							}
						}
					}
					taSelection.setSelectionToElementEnd($target[0]);
					return;
				}else if(command.toLowerCase() === 'createlink'){
					var tagBegin = '<a href="' + options + '" target="' +
							(defaultTagAttributes.a.target ? defaultTagAttributes.a.target : '') +
							'">',
						tagEnd = '</a>',
						_selection = taSelection.getSelection();
					if(_selection.collapsed){
						// insert text at selection, then select then just let normal exec-command run
						taSelection.insertHtml(tagBegin + options + tagEnd, topNode);
					}else if(rangy.getSelection().getRangeAt(0).canSurroundContents()){
						var node = angular.element(tagBegin + tagEnd)[0];
						rangy.getSelection().getRangeAt(0).surroundContents(node);
					}
					return;
				}else if(command.toLowerCase() === 'inserthtml'){
					taSelection.insertHtml(options, topNode);
					return;
				}
			}
			try{
				$document[0].execCommand(command, showUI, options);
			}catch(e){}
		};
	};
}]).service('taSelection', ['$window', '$document', 'taDOM',
/* istanbul ignore next: all browser specifics and PhantomJS dosen't seem to support half of it */
function($window, $document, taDOM){
	// need to dereference the document else the calls don't work correctly
	var _document = $document[0];
	var rangy = $window.rangy;
	var brException = function (element, offset) {
		/* check if selection is a BR element at the beginning of a container. If so, get
		* the parentNode instead.
		* offset should be zero in this case. Otherwise, return the original
		* element.
		*/
		if (element.tagName && element.tagName.match(/^br$/i) && offset === 0 && !element.previousSibling) {
            return {
                element: element.parentNode,
                offset: 0
            };
		} else {
			return {
				element: element,
				offset: offset
			};
		}
	};
	var api = {
		getSelection: function(){
			var range = rangy.getSelection().getRangeAt(0);
			var container = range.commonAncestorContainer;
			var selection = {
				start: brException(range.startContainer, range.startOffset),
				end: brException(range.endContainer, range.endOffset),
				collapsed: range.collapsed
			};
			// Check if the container is a text node and return its parent if so
			container = container.nodeType === 3 ? container.parentNode : container;
			if (container.parentNode === selection.start.element ||
				container.parentNode === selection.end.element) {
				selection.container = container.parentNode;
			} else {
				selection.container = container;
			}
			return selection;
		},
		getOnlySelectedElements: function(){
			var range = rangy.getSelection().getRangeAt(0);
			var container = range.commonAncestorContainer;
			// Check if the container is a text node and return its parent if so
			container = container.nodeType === 3 ? container.parentNode : container;
			return range.getNodes([1], function(node){
				return node.parentNode === container;
			});
		},
		// Some basic selection functions
		getSelectionElement: function () {
			return api.getSelection().container;
		},
		setSelection: function(el, start, end){
			var range = rangy.createRange();
			
			range.setStart(el, start);
			range.setEnd(el, end);
			
			rangy.getSelection().setSingleRange(range);
		},
		setSelectionBeforeElement: function (el){
			var range = rangy.createRange();
			
			range.selectNode(el);
			range.collapse(true);
			
			rangy.getSelection().setSingleRange(range);
		},
		setSelectionAfterElement: function (el){
			var range = rangy.createRange();
			
			range.selectNode(el);
			range.collapse(false);
			
			rangy.getSelection().setSingleRange(range);
		},
		setSelectionToElementStart: function (el){
			var range = rangy.createRange();
			
			range.selectNodeContents(el);
			range.collapse(true);
			
			rangy.getSelection().setSingleRange(range);
		},
		setSelectionToElementEnd: function (el){
			var range = rangy.createRange();
			
			range.selectNodeContents(el);
			range.collapse(false);
			if(el.childNodes && el.childNodes[el.childNodes.length - 1] && el.childNodes[el.childNodes.length - 1].nodeName === 'br'){
				range.startOffset = range.endOffset = range.startOffset - 1;
			}
			rangy.getSelection().setSingleRange(range);
		},
		// from http://stackoverflow.com/questions/6690752/insert-html-at-caret-in-a-contenteditable-div
		// topNode is the contenteditable normally, all manipulation MUST be inside this.
		insertHtml: function(html, topNode){
			var parent, secondParent, _childI, nodes, i, lastNode, _tempFrag;
			var element = angular.element("<div>" + html + "</div>");
			var range = rangy.getSelection().getRangeAt(0);
			var frag = _document.createDocumentFragment();
			var children = element[0].childNodes;
			var isInline = true;
			
			if(children.length > 0){
				// NOTE!! We need to do the following:
				// check for blockelements - if they exist then we have to split the current element in half (and all others up to the closest block element) and insert all children in-between.
				// If there are no block elements, or there is a mixture we need to create textNodes for the non wrapped text (we don't want them spans messing up the picture).
				nodes = [];
				for(_childI = 0; _childI < children.length; _childI++){
					if(!(
						(children[_childI].nodeName.toLowerCase() === 'p' && children[_childI].innerHTML.trim() === '') || // empty p element
						(children[_childI].nodeType === 3 && children[_childI].nodeValue.trim() === '') // empty text node
					)){
						isInline = isInline && !BLOCKELEMENTS.test(children[_childI].nodeName);
						nodes.push(children[_childI]);
					}
				}
				for(var _n = 0; _n < nodes.length; _n++) lastNode = frag.appendChild(nodes[_n]);
				if(!isInline && range.collapsed && /^(|<br(|\/)>)$/i.test(range.startContainer.innerHTML)) range.selectNode(range.startContainer);
			}else{
				isInline = true;
				// paste text of some sort
				lastNode = frag = _document.createTextNode(html);
			}
			
			// Other Edge case - selected data spans multiple blocks.
			if(isInline){
				range.deleteContents();
			}else{ // not inline insert
				if(range.collapsed && range.startContainer !== topNode){
					if(range.startContainer.innerHTML && range.startContainer.innerHTML.match(/^<[^>]*>$/i)){
						// this log is to catch when innerHTML is something like `<img ...>`
						parent = range.startContainer;
						if(range.startOffset === 1){
							// before single tag
							range.setStartAfter(parent);
							range.setEndAfter(parent);
						}else{
							// after single tag
							range.setStartBefore(parent);
							range.setEndBefore(parent);
						}
					}else{
						// split element into 2 and insert block element in middle
						if(range.startContainer.nodeType === 3 && range.startContainer.parentNode !== topNode){ // if text node
							parent = range.startContainer.parentNode;
							secondParent = parent.cloneNode();
							// split the nodes into two lists - before and after, splitting the node with the selection into 2 text nodes.
							taDOM.splitNodes(parent.childNodes, parent, secondParent, range.startContainer, range.startOffset);
							
							// Escape out of the inline tags like b
							while(!VALIDELEMENTS.test(parent.nodeName)){
								angular.element(parent).after(secondParent);
								parent = parent.parentNode;
								var _lastSecondParent = secondParent;
								secondParent = parent.cloneNode();
								// split the nodes into two lists - before and after, splitting the node with the selection into 2 text nodes.
								taDOM.splitNodes(parent.childNodes, parent, secondParent, _lastSecondParent);
							}
						}else{
							parent = range.startContainer;
							secondParent = parent.cloneNode();
							taDOM.splitNodes(parent.childNodes, parent, secondParent, undefined, undefined, range.startOffset);
						}
						
						angular.element(parent).after(secondParent);
						// put cursor to end of inserted content
						range.setStartAfter(parent);
						range.setEndAfter(parent);
						
						if(/^(|<br(|\/)>)$/i.test(parent.innerHTML.trim())){
							range.setStartBefore(parent);
							range.setEndBefore(parent);
							angular.element(parent).remove();
						}
						if(/^(|<br(|\/)>)$/i.test(secondParent.innerHTML.trim())) angular.element(secondParent).remove();
						if(parent.nodeName.toLowerCase() === 'li'){
							_tempFrag = _document.createDocumentFragment();
							for(i = 0; i < frag.childNodes.length; i++){
								element = angular.element('<li>');
								taDOM.transferChildNodes(frag.childNodes[i], element[0]);
								taDOM.transferNodeAttributes(frag.childNodes[i], element[0]);
								_tempFrag.appendChild(element[0]);
							}
							frag = _tempFrag;
							if(lastNode){
								lastNode = frag.childNodes[frag.childNodes.length - 1];
								lastNode = lastNode.childNodes[lastNode.childNodes.length - 1];
							}
						}
					}
				}else{
					range.deleteContents();
				}
			}
			
			range.insertNode(frag);
			if(lastNode){
				api.setSelectionToElementEnd(lastNode);
			}
		}
	};
	return api;
}]).service('taDOM', function(){
	var taDOM = {
		// recursive function that returns an array of angular.elements that have the passed attribute set on them
		getByAttribute: function(element, attribute){
			var resultingElements = [];
			var childNodes = element.children();
			if(childNodes.length){
				angular.forEach(childNodes, function(child){
					resultingElements = resultingElements.concat(taDOM.getByAttribute(angular.element(child), attribute));
				});
			}
			if(element.attr(attribute) !== undefined) resultingElements.push(element);
			return resultingElements;
		},
		
		transferChildNodes: function(source, target){
			// clear out target
			target.innerHTML = '';
			while(source.childNodes.length > 0) target.appendChild(source.childNodes[0]);
			return target;
		},
		
		splitNodes: function(nodes, target1, target2, splitNode, subSplitIndex, splitIndex){
			if(!splitNode && isNaN(splitIndex)) throw new Error('taDOM.splitNodes requires a splitNode or splitIndex');
			var startNodes = document.createDocumentFragment();
			var endNodes = document.createDocumentFragment();
			var index = 0;
			
			while(nodes.length > 0 && (isNaN(splitIndex) || splitIndex !== index) && nodes[0] !== splitNode){
				startNodes.appendChild(nodes[0]); // this removes from the nodes array (if proper childNodes object.
				index++;
			}
			
			if(!isNaN(subSplitIndex) && subSplitIndex >= 0 && nodes[0]){
				startNodes.appendChild(document.createTextNode(nodes[0].nodeValue.substring(0, subSplitIndex)));
				nodes[0].nodeValue = nodes[0].nodeValue.substring(subSplitIndex);
			}
			while(nodes.length > 0) endNodes.appendChild(nodes[0]);
			
			taDOM.transferChildNodes(startNodes, target1);
			taDOM.transferChildNodes(endNodes, target2);
		},
		
		transferNodeAttributes: function(source, target){
			for(var i = 0; i < source.attributes.length; i++) target.setAttribute(source.attributes[i].name, source.attributes[i].value);
			return target;
		}
	};
	return taDOM;
});
angular.module('textAngular.validators', [])
.directive('taMaxText', function(){
	return {
		restrict: 'A',
		require: 'ngModel',
		link: function(scope, elem, attrs, ctrl){
			var max = parseInt(scope.$eval(attrs.taMaxText));
			if (isNaN(max)){
				throw('Max text must be an integer');
			}
			attrs.$observe('taMaxText', function(value){
				max = parseInt(value);
				if (isNaN(max)){
					throw('Max text must be an integer');
				}
				if (ctrl.$dirty){
					ctrl.$validate();
				}
			});
			ctrl.$validators.taMaxText = function(viewValue){
				var source = angular.element('<div/>');
				source.html(viewValue);
				return source.text().length <= max;
			};
		}
	};
}).directive('taMinText', function(){
	return {
		restrict: 'A',
		require: 'ngModel',
		link: function(scope, elem, attrs, ctrl){
			var min = parseInt(scope.$eval(attrs.taMinText));
			if (isNaN(min)){
				throw('Min text must be an integer');
			}
			attrs.$observe('taMinText', function(value){
				min = parseInt(value);
				if (isNaN(min)){
					throw('Min text must be an integer');
				}
				if (ctrl.$dirty){
					ctrl.$validate();
				}
			});
			ctrl.$validators.taMinText = function(viewValue){
				var source = angular.element('<div/>');
				source.html(viewValue);
				return !source.text().length || source.text().length >= min;
			};
		}
	};
});
angular.module('textAngular.taBind', ['textAngular.factories', 'textAngular.DOM'])
.service('_taBlankTest', [function(){
	var INLINETAGS_NONBLANK = /<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;
	return function(_defaultTest){
		return function(_blankVal){
			if(!_blankVal) return true;
			// find first non-tag match - ie start of string or after tag that is not whitespace
			var _firstMatch = /(^[^<]|>)[^<]/i.exec(_blankVal);
			var _firstTagIndex;
			if(!_firstMatch){
				// find the end of the first tag removing all the
				// Don't do a global replace as that would be waaayy too long, just replace the first 4 occurences should be enough
				_blankVal = _blankVal.toString().replace(/="[^"]*"/i, '').replace(/="[^"]*"/i, '').replace(/="[^"]*"/i, '').replace(/="[^"]*"/i, '');
				_firstTagIndex = _blankVal.indexOf('>');
			}else{
				_firstTagIndex = _firstMatch.index;
			}
			_blankVal = _blankVal.trim().substring(_firstTagIndex, _firstTagIndex + 100);
			// check for no tags entry
			if(/^[^<>]+$/i.test(_blankVal)) return false;
			// this regex is to match any number of whitespace only between two tags
			if (_blankVal.length === 0 || _blankVal === _defaultTest || /^>(\s|&nbsp;)*<\/[^>]+>$/ig.test(_blankVal)) return true;
			// this regex tests if there is a tag followed by some optional whitespace and some text after that
			else if (/>\s*[^\s<]/i.test(_blankVal) || INLINETAGS_NONBLANK.test(_blankVal)) return false;
			else return true;
		};
	};
}])
.directive('taButton', [function(){
	return {
		link: function(scope, element, attrs){
			element.attr('unselectable', 'on');
			element.on('mousedown', function(e, eventData){
				/* istanbul ignore else: this is for catching the jqLite testing*/
				if(eventData) angular.extend(e, eventData);
				// this prevents focusout from firing on the editor when clicking toolbar buttons
				e.preventDefault();
				return false;
			});
		}
	};
}])
.directive('taBind', [
		'taSanitize', '$timeout', '$window', '$document', 'taFixChrome', 'taBrowserTag',
		'taSelection', 'taSelectableElements', 'taApplyCustomRenderers', 'taOptions',
		'_taBlankTest', '$parse', 'taDOM', 'textAngularManager',
		function(
			taSanitize, $timeout, $window, $document, taFixChrome, taBrowserTag,
			taSelection, taSelectableElements, taApplyCustomRenderers, taOptions,
			_taBlankTest, $parse, taDOM, textAngularManager){
	// Uses for this are textarea or input with ng-model and ta-bind='text'
	// OR any non-form element with contenteditable="contenteditable" ta-bind="html|text" ng-model
	return {
		priority: 2, // So we override validators correctly
		require: ['ngModel','?ngModelOptions'],
		link: function(scope, element, attrs, controller){
			var ngModel = controller[0];
			var ngModelOptions = controller[1] || {};
			// the option to use taBind on an input or textarea is required as it will sanitize all input into it correctly.
			var _isContentEditable = element.attr('contenteditable') !== undefined && element.attr('contenteditable');
			var _isInputFriendly = _isContentEditable || element[0].tagName.toLowerCase() === 'textarea' || element[0].tagName.toLowerCase() === 'input';
			var _isReadonly = false;
			var _focussed = false;
			var _skipRender = false;
			var _disableSanitizer = attrs.taUnsafeSanitizer || taOptions.disableSanitizer;
			var _lastKey;
			// see http://www.javascripter.net/faq/keycodes.htm for good information
			// NOTE Mute On|Off 173 (Opera MSIE Safari Chrome) 181 (Firefox)
			// BLOCKED_KEYS are special keys...
			// Tab, pause/break, CapsLock, Esc, Page Up, End, Home,
			// Left arrow, Up arrow, Right arrow, Down arrow, Insert, Delete,
			// f1, f2, f3, f4, f5, f6, f7, f8, f9, f10, f11, f12
			// NumLock, ScrollLock
			var BLOCKED_KEYS = /^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i;
			// UNDO_TRIGGER_KEYS - spaces, enter, delete, backspace, all punctuation
			// Backspace, Enter, Space, Delete, (; :) (Firefox), (= +) (Firefox),
			// Numpad +, Numpad -, (; :), (= +),
			// (, <), (- _), (. >), (/ ?), (` ~), ([ {), (\ |), (] }), (' ")
			// NOTE - Firefox: 173 = (- _) -- adding this to UNDO_TRIGGER_KEYS
			var UNDO_TRIGGER_KEYS = /^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i;
			var _pasteHandler;

			// defaults to the paragraph element, but we need the line-break or it doesn't allow you to type into the empty element
			// non IE is '<p><br/></p>', ie is '<p></p>' as for once IE gets it correct...
			var _defaultVal, _defaultTest;

			var _CTRL_KEY = 0x0001;
			var _META_KEY = 0x0002;
			var _ALT_KEY = 0x0004;
			var _SHIFT_KEY = 0x0008;
			// map events to special keys...
			// mappings is an array of maps from events to specialKeys as declared in textAngularSetup
			var _keyMappings = [
				//		ctrl/command + z
				{
					specialKey: 'UndoKey',
					forbiddenModifiers: _ALT_KEY + _SHIFT_KEY,
					mustHaveModifiers: [_META_KEY + _CTRL_KEY],
					keyCode: 90
				},
				//		ctrl/command + shift + z
				{
					specialKey: 'RedoKey',
					forbiddenModifiers: _ALT_KEY,
					mustHaveModifiers: [_META_KEY + _CTRL_KEY, _SHIFT_KEY],
					keyCode: 90
				},
				//		ctrl/command + y
				{
					specialKey: 'RedoKey',
					forbiddenModifiers: _ALT_KEY + _SHIFT_KEY,
					mustHaveModifiers: [_META_KEY + _CTRL_KEY],
					keyCode: 89
				},
				//		TabKey
				{
					specialKey: 'TabKey',
					forbiddenModifiers: _META_KEY + _SHIFT_KEY + _ALT_KEY + _CTRL_KEY,
					mustHaveModifiers: [],
					keyCode: 9
				},
				//		shift + TabKey
				{
					specialKey: 'ShiftTabKey',
					forbiddenModifiers: _META_KEY + _ALT_KEY + _CTRL_KEY,
					mustHaveModifiers: [_SHIFT_KEY],
					keyCode: 9
				}
			];
			function _mapKeys(event) {
				var specialKey;
				_keyMappings.forEach(function (map){
					if (map.keyCode === event.keyCode) {
						var netModifiers = (event.metaKey ? _META_KEY: 0) +
							(event.ctrlKey ? _CTRL_KEY: 0) +
							(event.shiftKey ? _SHIFT_KEY: 0) +
							(event.altKey ? _ALT_KEY: 0);
						if (map.forbiddenModifiers & netModifiers) return;
						if (map.mustHaveModifiers.every(function (modifier) { return netModifiers & modifier; })){
							specialKey = map.specialKey;
						}
					}
				});
				return specialKey;
			}

			// set the default to be a paragraph value
			if(attrs.taDefaultWrap === undefined) attrs.taDefaultWrap = 'p';
			/* istanbul ignore next: ie specific test */
			if(attrs.taDefaultWrap === ''){
				_defaultVal = '';
				_defaultTest = (_browserDetect.ie === undefined)? '<div><br></div>' : (_browserDetect.ie >= 11)? '<p><br></p>' : (_browserDetect.ie <= 8)? '<P>&nbsp;</P>' : '<p>&nbsp;</p>';
			}else{
				_defaultVal = (_browserDetect.ie === undefined || _browserDetect.ie >= 11)?
					'<' + attrs.taDefaultWrap + '><br></' + attrs.taDefaultWrap + '>' :
					(_browserDetect.ie <= 8)?
						'<' + attrs.taDefaultWrap.toUpperCase() + '></' + attrs.taDefaultWrap.toUpperCase() + '>' :
						'<' + attrs.taDefaultWrap + '></' + attrs.taDefaultWrap + '>';
				_defaultTest = (_browserDetect.ie === undefined || _browserDetect.ie >= 11)?
					'<' + attrs.taDefaultWrap + '><br></' + attrs.taDefaultWrap + '>' :
					(_browserDetect.ie <= 8)?
						'<' + attrs.taDefaultWrap.toUpperCase() + '>&nbsp;</' + attrs.taDefaultWrap.toUpperCase() + '>' :
						'<' + attrs.taDefaultWrap + '>&nbsp;</' + attrs.taDefaultWrap + '>';
			}

			/* istanbul ignore else */
			if(!ngModelOptions.$options) ngModelOptions.$options = {}; // ng-model-options support

			var _blankTest = _taBlankTest(_defaultTest);

			var _ensureContentWrapped = function(value) {
				if (_blankTest(value)) return value;
				var domTest = angular.element("<div>" + value + "</div>");
				//console.log('domTest.children().length():', domTest.children().length);
				if (domTest.children().length === 0) {
					value = "<" + attrs.taDefaultWrap + ">" + value + "</" + attrs.taDefaultWrap + ">";
				} else {
					var _children = domTest[0].childNodes;
					var i;
					var _foundBlockElement = false;
					for (i = 0; i < _children.length; i++) {
						if (_foundBlockElement = _children[i].nodeName.toLowerCase().match(BLOCKELEMENTS)) break;
					}
					if (!_foundBlockElement) {
						value = "<" + attrs.taDefaultWrap + ">" + value + "</" + attrs.taDefaultWrap + ">";
					}
					else{
						value = "";
						for(i = 0; i < _children.length; i++){
							var node = _children[i];
							var nodeName = node.nodeName.toLowerCase();
							//console.log(nodeName);
							if(nodeName === '#comment') {
								value += '<!--' + node.nodeValue + '-->';
							} else if(nodeName === '#text') {
								// determine if this is all whitespace, if so, we will leave it as it is.
								// otherwise, we will wrap it as it is
								var text = node.textContent;
								if (!text.trim()) {
									// just whitespace
									value += text;
								} else {
									// not pure white space so wrap in <p>...</p> or whatever attrs.taDefaultWrap is set to.
									value += "<" + attrs.taDefaultWrap + ">" + text + "</" + attrs.taDefaultWrap + ">";
								}
							} else if(!nodeName.match(BLOCKELEMENTS)){
								/* istanbul ignore  next: Doesn't seem to trigger on tests */
								var _subVal = (node.outerHTML || node.nodeValue);
								/* istanbul ignore else: Doesn't seem to trigger on tests, is tested though */
								if(_subVal.trim() !== '')
									value += "<" + attrs.taDefaultWrap + ">" + _subVal + "</" + attrs.taDefaultWrap + ">";
								else value += _subVal;
							} else {
								value += node.outerHTML;
							}
						}
					}
				}
				//console.log(value);
				return value;
			};

			if(attrs.taPaste) _pasteHandler = $parse(attrs.taPaste);

			element.addClass('ta-bind');

			var _undoKeyupTimeout;

			scope['$undoManager' + (attrs.id || '')] = ngModel.$undoManager = {
				_stack: [],
				_index: 0,
				_max: 1000,
				push: function(value){
					if((typeof value === "undefined" || value === null) ||
						((typeof this.current() !== "undefined" && this.current() !== null) && value === this.current())) return value;
					if(this._index < this._stack.length - 1){
						this._stack = this._stack.slice(0,this._index+1);
					}
					this._stack.push(value);
					if(_undoKeyupTimeout) $timeout.cancel(_undoKeyupTimeout);
					if(this._stack.length > this._max) this._stack.shift();
					this._index = this._stack.length - 1;
					return value;
				},
				undo: function(){
					return this.setToIndex(this._index-1);
				},
				redo: function(){
					return this.setToIndex(this._index+1);
				},
				setToIndex: function(index){
					if(index < 0 || index > this._stack.length - 1){
						return undefined;
					}
					this._index = index;
					return this.current();
				},
				current: function(){
					return this._stack[this._index];
				}
			};

			var _redoUndoTimeout;
			var _undo = scope['$undoTaBind' + (attrs.id || '')] = function(){
				/* istanbul ignore else: can't really test it due to all changes being ignored as well in readonly */
				if(!_isReadonly && _isContentEditable){
					var content = ngModel.$undoManager.undo();
					if(typeof content !== "undefined" && content !== null){
						_setInnerHTML(content);
						_setViewValue(content, false);
						if(_redoUndoTimeout) $timeout.cancel(_redoUndoTimeout);
						_redoUndoTimeout = $timeout(function(){
							element[0].focus();
							taSelection.setSelectionToElementEnd(element[0]);
						}, 1);
					}
				}
			};

			var _redo = scope['$redoTaBind' + (attrs.id || '')] = function(){
				/* istanbul ignore else: can't really test it due to all changes being ignored as well in readonly */
				if(!_isReadonly && _isContentEditable){
					var content = ngModel.$undoManager.redo();
					if(typeof content !== "undefined" && content !== null){
						_setInnerHTML(content);
						_setViewValue(content, false);
						/* istanbul ignore next */
						if(_redoUndoTimeout) $timeout.cancel(_redoUndoTimeout);
						_redoUndoTimeout = $timeout(function(){
							element[0].focus();
							taSelection.setSelectionToElementEnd(element[0]);
						}, 1);
					}
				}
			};

			// in here we are undoing the converts used elsewhere to prevent the < > and & being displayed when they shouldn't in the code.
			var _compileHtml = function(){
				if(_isContentEditable) return element[0].innerHTML;
				if(_isInputFriendly) return element.val();
				throw ('textAngular Error: attempting to update non-editable taBind');
			};

			var _setViewValue = function(_val, triggerUndo, skipRender){
				_skipRender = skipRender || false;
				if(typeof triggerUndo === "undefined" || triggerUndo === null) triggerUndo = true && _isContentEditable; // if not contentEditable then the native undo/redo is fine
				if(typeof _val === "undefined" || _val === null) _val = _compileHtml();
				if(_blankTest(_val)){
					// this avoids us from tripping the ng-pristine flag if we click in and out with out typing
					if(ngModel.$viewValue !== '') ngModel.$setViewValue('');
					if(triggerUndo && ngModel.$undoManager.current() !== '') ngModel.$undoManager.push('');
				}else{
					_reApplyOnSelectorHandlers();
					if(ngModel.$viewValue !== _val){
						ngModel.$setViewValue(_val);
						if(triggerUndo) ngModel.$undoManager.push(_val);
					}
				}
				ngModel.$render();
			};

			//used for updating when inserting wrapped elements
			scope['updateTaBind' + (attrs.id || '')] = function(){
				if(!_isReadonly) _setViewValue(undefined, undefined, true);
			};

			// catch DOM XSS via taSanitize
			// Sanitizing both ways is identical
			var _sanitize = function(unsafe){
				return (ngModel.$oldViewValue = taSanitize(taFixChrome(unsafe), ngModel.$oldViewValue, _disableSanitizer));
			};

			// trigger the validation calls
			if(element.attr('required')) ngModel.$validators.required = function(modelValue, viewValue) {
				return !_blankTest(modelValue || viewValue);
			};
			// parsers trigger from the above keyup function or any other time that the viewValue is updated and parses it for storage in the ngModel
			ngModel.$parsers.push(_sanitize);
			ngModel.$parsers.unshift(_ensureContentWrapped);
			// because textAngular is bi-directional (which is awesome) we need to also sanitize values going in from the server
			ngModel.$formatters.push(_sanitize);
			ngModel.$formatters.unshift(_ensureContentWrapped);
			ngModel.$formatters.unshift(function(value){
				return ngModel.$undoManager.push(value || '');
			});

			//this code is used to update the models when data is entered/deleted
			if(_isInputFriendly){
				scope.events = {};
				if(!_isContentEditable){
					// if a textarea or input just add in change and blur handlers, everything else is done by angulars input directive
					element.on('change blur', scope.events.change = scope.events.blur = function(){
						if(!_isReadonly) ngModel.$setViewValue(_compileHtml());
					});

					element.on('keydown', scope.events.keydown = function(event, eventData){
						/* istanbul ignore else: this is for catching the jqLite testing*/
						if(eventData) angular.extend(event, eventData);
						// Reference to http://stackoverflow.com/questions/6140632/how-to-handle-tab-in-textarea
						/* istanbul ignore else: otherwise normal functionality */
						if(event.keyCode === 9){ // tab was pressed
							// get caret position/selection
							var start = this.selectionStart;
							var end = this.selectionEnd;

							var value = element.val();
							if(event.shiftKey){
								// find \t
								var _linebreak = value.lastIndexOf('\n', start), _tab = value.lastIndexOf('\t', start);
								if(_tab !== -1 && _tab >= _linebreak){
									// set textarea value to: text before caret + tab + text after caret
									element.val(value.substring(0, _tab) + value.substring(_tab + 1));

									// put caret at right position again (add one for the tab)
									this.selectionStart = this.selectionEnd = start - 1;
								}
							}else{
								// set textarea value to: text before caret + tab + text after caret
								element.val(value.substring(0, start) + "\t" + value.substring(end));

								// put caret at right position again (add one for the tab)
								this.selectionStart = this.selectionEnd = start + 1;
							}
							// prevent the focus lose
							event.preventDefault();
						}
					});

					var _repeat = function(string, n){
						var result = '';
						for(var _n = 0; _n < n; _n++) result += string;
						return result;
					};

					// add a forEach function that will work on a NodeList, etc..
					var forEach = function (array, callback, scope) {
						for (var i= 0; i<array.length; i++) {
							callback.call(scope, i, array[i]);
						}
					};

					// handle <ul> or <ol> nodes
					var recursiveListFormat = function(listNode, tablevel){
						var _html = '';
						var _subnodes = listNode.childNodes;
						tablevel++;
						// tab out and add the <ul> or <ol> html piece
						_html += _repeat('\t', tablevel-1) + listNode.outerHTML.substring(0, 4);
						forEach(_subnodes, function (index, node) {
							/* istanbul ignore next: browser catch */
							var nodeName = node.nodeName.toLowerCase();
							if (nodeName === '#comment') {
								_html += '<!--' + node.nodeValue + '-->';
								return;
							}
							if (nodeName === '#text') {
								_html += node.textContent;
								return;
							}
							/* istanbul ignore next: not tested, and this was original code -- so not wanting to possibly cause an issue, leaving it... */
							if(!node.outerHTML) {
								// no html to add
								return;
							}
							if(nodeName === 'ul' || nodeName === 'ol') {
								_html += '\n' + recursiveListFormat(node, tablevel);
							}
							else {
								// no reformatting within this subnode, so just do the tabing...
								_html += '\n' + _repeat('\t', tablevel) + node.outerHTML;
							}
						});
						// now add on the </ol> or </ul> piece
						_html += '\n' + _repeat('\t', tablevel-1) + listNode.outerHTML.substring(listNode.outerHTML.lastIndexOf('<'));
						return _html;
					};
					// handle formating of something like:
					// <ol><!--First comment-->
					//  <li>Test Line 1<!--comment test list 1--></li>
					//    <ul><!--comment ul-->
					//      <li>Nested Line 1</li>
					//        <!--comment between nested lines--><li>Nested Line 2</li>
					//    </ul>
					//  <li>Test Line 3</li>
					// </ol>
					ngModel.$formatters.unshift(function(htmlValue){
						// tabulate the HTML so it looks nicer
						//
						// first get a list of the nodes...
						// we do this by using the element parser...
						//
						// doing this -- which is simpiler -- breaks our tests...
						//var _nodes=angular.element(htmlValue);
						var _nodes = angular.element('<div>' + htmlValue + '</div>')[0].childNodes;
						if(_nodes.length > 0){
							// do the reformatting of the layout...
							htmlValue = '';
							forEach(_nodes, function (index, node) {
								var nodeName = node.nodeName.toLowerCase();
								if (nodeName === '#comment') {
									htmlValue += '<!--' + node.nodeValue + '-->';
									return;
								}
								if (nodeName === '#text') {
									htmlValue += node.textContent;
									return;
								}
								/* istanbul ignore next: not tested, and this was original code -- so not wanting to possibly cause an issue, leaving it... */
								if(!node.outerHTML)
								{
									// nothing to format!
									return;
								}
								if(htmlValue.length > 0) {
									// we aready have some content, so drop to a new line
									htmlValue += '\n';
								}
								if(nodeName === 'ul' || nodeName === 'ol') {
									// okay a set of list stuff we want to reformat in a nested way
									htmlValue += '' + recursiveListFormat(node, 0);
								}
								else {
									// just use the original without any additional formating
									htmlValue += '' + node.outerHTML;
								}
							});
						}
						return htmlValue;
					});
				}else{
					// all the code specific to contenteditable divs
					var _processingPaste = false;
					/* istanbul ignore next: phantom js cannot test this for some reason */
					var processpaste = function(text) {
						/* istanbul ignore else: don't care if nothing pasted */
						if(text && text.trim().length){
							// test paste from word/microsoft product
							if(text.match(/class=["']*Mso(Normal|List)/i)){
								var textFragment = text.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);
								if(!textFragment) textFragment = text;
								else textFragment = textFragment[1];
								textFragment = textFragment.replace(/<o:p>[\s\S]*?<\/o:p>/ig, '').replace(/class=(["']|)MsoNormal(["']|)/ig, '');
								var dom = angular.element("<div>" + textFragment + "</div>");
								var targetDom = angular.element("<div></div>");
								var _list = {
									element: null,
									lastIndent: [],
									lastLi: null,
									isUl: false
								};
								_list.lastIndent.peek = function(){
									var n = this.length;
									if (n>0) return this[n-1];
								};
								var _resetList = function(isUl){
									_list.isUl = isUl;
									_list.element = angular.element(isUl ? "<ul>" : "<ol>");
									_list.lastIndent = [];
									_list.lastIndent.peek = function(){
										var n = this.length;
										if (n>0) return this[n-1];
									};
									_list.lastLevelMatch = null;
								};
								for(var i = 0; i <= dom[0].childNodes.length; i++){
									if(!dom[0].childNodes[i] || dom[0].childNodes[i].nodeName === "#text" || dom[0].childNodes[i].tagName.toLowerCase() !== "p") continue;
									var el = angular.element(dom[0].childNodes[i]);
									var _listMatch = (el.attr('class') || '').match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);

									if(_listMatch){
										if(el[0].childNodes.length < 2 || el[0].childNodes[1].childNodes.length < 1){
											continue;
										}
										var isUl = _listMatch[1].toLowerCase() === "bullet" || (_listMatch[1].toLowerCase() !== "number" && !(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(el[0].childNodes[1].innerHTML) || /^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(el[0].childNodes[1].childNodes[0].innerHTML)));
										var _indentMatch = (el.attr('style') || '').match(/margin-left:([\-\.0-9]*)/i);
										var indent = parseFloat((_indentMatch)?_indentMatch[1]:0);
										var _levelMatch = (el.attr('style') || '').match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);
										// prefers the mso-list syntax

										if(_levelMatch && _levelMatch[2]) indent = parseInt(_levelMatch[2]);

										if ((_levelMatch && (!_list.lastLevelMatch || _levelMatch[1] !== _list.lastLevelMatch[1])) || !_listMatch[3] || _listMatch[3].toLowerCase() === "first" || (_list.lastIndent.peek() === null) || (_list.isUl !== isUl && _list.lastIndent.peek() === indent)) {
											_resetList(isUl);
											targetDom.append(_list.element);
										} else if (_list.lastIndent.peek() != null && _list.lastIndent.peek() < indent){
											_list.element = angular.element(isUl ? "<ul>" : "<ol>");
											_list.lastLi.append(_list.element);
										} else if (_list.lastIndent.peek() != null && _list.lastIndent.peek() > indent){
											while(_list.lastIndent.peek() != null && _list.lastIndent.peek() > indent){
												if(_list.element.parent()[0].tagName.toLowerCase() === 'li'){
													_list.element = _list.element.parent();
													continue;
												}else if(/[uo]l/i.test(_list.element.parent()[0].tagName.toLowerCase())){
													_list.element = _list.element.parent();
												}else{ // else it's it should be a sibling
													break;
												}
												_list.lastIndent.pop();
											}
											_list.isUl = _list.element[0].tagName.toLowerCase() === "ul";
											if (isUl !== _list.isUl) {
												_resetList(isUl);
												targetDom.append(_list.element);
											}
										}

										_list.lastLevelMatch = _levelMatch;
										if(indent !== _list.lastIndent.peek()) _list.lastIndent.push(indent);
										_list.lastLi = angular.element("<li>");
										_list.element.append(_list.lastLi);
										_list.lastLi.html(el.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/ig, ''));
										el.remove();
									}else{
										_resetList(false);
										targetDom.append(el);
									}
								}
								var _unwrapElement = function(node){
									node = angular.element(node);
									for(var _n = node[0].childNodes.length - 1; _n >= 0; _n--) node.after(node[0].childNodes[_n]);
									node.remove();
								};

								angular.forEach(targetDom.find('span'), function(node){
									node.removeAttribute('lang');
									if(node.attributes.length <= 0) _unwrapElement(node);
								});
								angular.forEach(targetDom.find('font'), _unwrapElement);
								text = targetDom.html();
							}else{
								// remove unnecessary chrome insert
								text = text.replace(/<(|\/)meta[^>]*?>/ig, '');
								if(text.match(/<[^>]*?(ta-bind)[^>]*?>/)){
									// entire text-angular or ta-bind has been pasted, REMOVE AT ONCE!!
									if(text.match(/<[^>]*?(text-angular)[^>]*?>/)){
										var _el = angular.element("<div>" + text + "</div>");
										_el.find('textarea').remove();
										var binds = taDOM.getByAttribute(_el, 'ta-bind');
										for(var _b = 0; _b < binds.length; _b++){
											var _target = binds[_b][0].parentNode.parentNode;
											for(var _c = 0; _c < binds[_b][0].childNodes.length; _c++){
												_target.parentNode.insertBefore(binds[_b][0].childNodes[_c], _target);
											}
											_target.parentNode.removeChild(_target);
										}
										text = _el.html().replace('<br class="Apple-interchange-newline">', '');
									}
								}else if(text.match(/^<span/)){
									// in case of pasting only a span - chrome paste, remove them. THis is just some wierd formatting
									// if we remove the '<span class="Apple-converted-space"> </span>' here we destroy the spacing
									// on paste from even ourselves!
									if (!text.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/ig)) {
										text = text.replace(/<(|\/)span[^>]*?>/ig, '');
									}
								}
								// Webkit on Apple tags
								text = text.replace(/<br class="Apple-interchange-newline"[^>]*?>/ig, '').replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/ig, '&nbsp;');
							}

							if (/<li(\s.*)?>/i.test(text) && /(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(text) === false) {
								// insert missing parent of li element
								text = text.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i, '<ul>$&</ul>');
							}

							// parse whitespace from plaintext input, starting with preceding spaces that get stripped on paste
							text = text.replace(/^[ |\u00A0]+/gm, function (match) {
								var result = '';
								for (var i = 0; i < match.length; i++) {
									result += '&nbsp;';
								}
								return result;
							}).replace(/\n|\r\n|\r/g, '<br />').replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');

							if(_pasteHandler) text = _pasteHandler(scope, {$html: text}) || text;

							text = taSanitize(text, '', _disableSanitizer);

							taSelection.insertHtml(text, element[0]);
							$timeout(function(){
								ngModel.$setViewValue(_compileHtml());
								_processingPaste = false;
								element.removeClass('processing-paste');
							}, 0);
						}else{
							_processingPaste = false;
							element.removeClass('processing-paste');
						}
					};

					element.on('paste', scope.events.paste = function(e, eventData){
						/* istanbul ignore else: this is for catching the jqLite testing*/
						if(eventData) angular.extend(e, eventData);
						if(_isReadonly || _processingPaste){
							e.stopPropagation();
							e.preventDefault();
							return false;
						}

						// Code adapted from http://stackoverflow.com/questions/2176861/javascript-get-clipboard-data-on-paste-event-cross-browser/6804718#6804718
						_processingPaste = true;
						element.addClass('processing-paste');
						var pastedContent;
						var clipboardData = (e.originalEvent || e).clipboardData;
						if (clipboardData && clipboardData.getData && clipboardData.types.length > 0) {// Webkit - get data from clipboard, put into editdiv, cleanup, then cancel event
							var _types = "";
							for(var _t = 0; _t < clipboardData.types.length; _t++){
								_types += " " + clipboardData.types[_t];
							}
							/* istanbul ignore next: browser tests */
							if (/text\/html/i.test(_types)) {
								pastedContent = clipboardData.getData('text/html');
							} else if (/text\/plain/i.test(_types)) {
								pastedContent = clipboardData.getData('text/plain');
							}

							processpaste(pastedContent);
							e.stopPropagation();
							e.preventDefault();
							return false;
						} else {// Everything else - empty editdiv and allow browser to paste content into it, then cleanup
							var _savedSelection = $window.rangy.saveSelection(),
								_tempDiv = angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');
							$document.find('body').append(_tempDiv);
							_tempDiv[0].focus();
							$timeout(function(){
								// restore selection
								$window.rangy.restoreSelection(_savedSelection);
								processpaste(_tempDiv[0].innerHTML);
								element[0].focus();
								_tempDiv.remove();
							}, 0);
						}
					});
					element.on('cut', scope.events.cut = function(e){
						// timeout to next is needed as otherwise the paste/cut event has not finished actually changing the display
						if(!_isReadonly) $timeout(function(){
							ngModel.$setViewValue(_compileHtml());
						}, 0);
						else e.preventDefault();
					});

					element.on('keydown', scope.events.keydown = function(event, eventData){
						/* istanbul ignore else: this is for catching the jqLite testing*/
						if(eventData) angular.extend(event, eventData);
						event.specialKey = _mapKeys(event);
						var userSpecialKey;
						/* istanbul ignore next: difficult to test */
						taOptions.keyMappings.forEach(function (mapping) {
							if (event.specialKey === mapping.commandKeyCode) {
								// taOptions has remapped this binding... so
								// we disable our own
								event.specialKey = undefined;
							}
							if (mapping.testForKey(event)) {
								userSpecialKey = mapping.commandKeyCode;
							}
							if ((mapping.commandKeyCode === 'UndoKey') || (mapping.commandKeyCode === 'RedoKey')) {
								// this is necessary to fully stop the propagation.
								if (!mapping.enablePropagation) {
									event.preventDefault();
								}
							}
						});
						/* istanbul ignore next: difficult to test */
						if (typeof userSpecialKey !== 'undefined') {
							event.specialKey = userSpecialKey;
						}
						/* istanbul ignore next: difficult to test as can't seem to select */
						if ((typeof event.specialKey !== 'undefined') && (
								event.specialKey !== 'UndoKey' || event.specialKey !== 'RedoKey'
							)) {
							event.preventDefault();
							textAngularManager.sendKeyCommand(scope, event);
						}
						/* istanbul ignore else: readonly check */
						if(!_isReadonly){
							if (event.specialKey==='UndoKey') {
								_undo();
								event.preventDefault();
							}
							if (event.specialKey==='RedoKey') {
								_redo();
								event.preventDefault();
							}
							/* istanbul ignore next: difficult to test as can't seem to select */
							if(event.keyCode === 13 && !event.shiftKey){
								var $selection;
								var selection = taSelection.getSelectionElement();
								if(!selection.tagName.match(VALIDELEMENTS)) return;
								var _new = angular.element(_defaultVal);
								if (/^<br(|\/)>$/i.test(selection.innerHTML.trim()) && selection.parentNode.tagName.toLowerCase() === 'blockquote' && !selection.nextSibling) {
									// if last element in blockquote and element is blank, pull element outside of blockquote.
									$selection = angular.element(selection);
									var _parent = $selection.parent();
									_parent.after(_new);
									$selection.remove();
									if(_parent.children().length === 0) _parent.remove();
									taSelection.setSelectionToElementStart(_new[0]);
									event.preventDefault();
								}else if (/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(selection.innerHTML.trim()) && selection.tagName.toLowerCase() === 'blockquote'){
									$selection = angular.element(selection);
									$selection.after(_new);
									$selection.remove();
									taSelection.setSelectionToElementStart(_new[0]);
									event.preventDefault();
								}
							}
						}
					});
					var _keyupTimeout;
					element.on('keyup', scope.events.keyup = function(event, eventData){
						/* istanbul ignore else: this is for catching the jqLite testing*/
						if(eventData) angular.extend(event, eventData);
						/* istanbul ignore next: FF specific bug fix */
						if (event.keyCode === 9) {
							var _selection = taSelection.getSelection();
							if(_selection.start.element === element[0] && element.children().length) taSelection.setSelectionToElementStart(element.children()[0]);
							return;
						}
						if(_undoKeyupTimeout) $timeout.cancel(_undoKeyupTimeout);
						if(!_isReadonly && !BLOCKED_KEYS.test(event.keyCode)){
							// if enter - insert new taDefaultWrap, if shift+enter insert <br/>
							if(_defaultVal !== '' && event.keyCode === 13){
								if(!event.shiftKey){
									// new paragraph, br should be caught correctly
									var selection = taSelection.getSelectionElement();
									while(!selection.tagName.match(VALIDELEMENTS) && selection !== element[0]){
										selection = selection.parentNode;
									}

									if(selection.tagName.toLowerCase() !== attrs.taDefaultWrap && selection.tagName.toLowerCase() !== 'li' && (selection.innerHTML.trim() === '' || selection.innerHTML.trim() === '<br>')){
										var _new = angular.element(_defaultVal);
										angular.element(selection).replaceWith(_new);
										taSelection.setSelectionToElementStart(_new[0]);
									}
								}
							}
							var val = _compileHtml();
							if(_defaultVal !== '' && val.trim() === ''){
								_setInnerHTML(_defaultVal);
								taSelection.setSelectionToElementStart(element.children()[0]);
							}else if(val.substring(0, 1) !== '<' && attrs.taDefaultWrap !== ''){
								/* we no longer do this, since there can be comments here and white space
								var _savedSelection = $window.rangy.saveSelection();
								val = _compileHtml();
								val = "<" + attrs.taDefaultWrap + ">" + val + "</" + attrs.taDefaultWrap + ">";
								_setInnerHTML(val);
								$window.rangy.restoreSelection(_savedSelection);
								*/
							}
							var triggerUndo = _lastKey !== event.keyCode && UNDO_TRIGGER_KEYS.test(event.keyCode);
							if(_keyupTimeout) $timeout.cancel(_keyupTimeout);
							_keyupTimeout = $timeout(function() {
								_setViewValue(val, triggerUndo, true);
							}, ngModelOptions.$options.debounce || 400);
							if(!triggerUndo) _undoKeyupTimeout = $timeout(function(){ ngModel.$undoManager.push(val); }, 250);
							_lastKey = event.keyCode;
						}
					});

					element.on('blur', scope.events.blur = function(){
						_focussed = false;
						/* istanbul ignore else: if readonly don't update model */
						if(!_isReadonly){
							_setViewValue(undefined, undefined, true);
						}else{
							_skipRender = true; // don't redo the whole thing, just check the placeholder logic
							ngModel.$render();
						}
					});

					// Placeholders not supported on ie 8 and below
					if(attrs.placeholder && (_browserDetect.ie > 8 || _browserDetect.ie === undefined)){
						var rule;
						if(attrs.id) rule = addCSSRule('#' + attrs.id + '.placeholder-text:before', 'content: "' + attrs.placeholder + '"');
						else throw('textAngular Error: An unique ID is required for placeholders to work');

						scope.$on('$destroy', function(){
							removeCSSRule(rule);
						});
					}

					element.on('focus', scope.events.focus = function(){
						_focussed = true;
						element.removeClass('placeholder-text');
						_reApplyOnSelectorHandlers();
					});

					element.on('mouseup', scope.events.mouseup = function(){
						var _selection = taSelection.getSelection();
						if(_selection.start.element === element[0] && element.children().length) taSelection.setSelectionToElementStart(element.children()[0]);
					});

					// prevent propagation on mousedown in editor, see #206
					element.on('mousedown', scope.events.mousedown = function(event, eventData){
						/* istanbul ignore else: this is for catching the jqLite testing*/
						if(eventData) angular.extend(event, eventData);
						event.stopPropagation();
					});
				}
			}

			var selectorClickHandler = function(event){
				// emit the element-select event, pass the element
				scope.$emit('ta-element-select', this);
				event.preventDefault();
				return false;
			};
			var fileDropHandler = function(event, eventData){
				/* istanbul ignore else: this is for catching the jqLite testing*/
				if(eventData) angular.extend(event, eventData);
				// emit the drop event, pass the element, preventing should be done elsewhere
				if(!dropFired && !_isReadonly){
					dropFired = true;
					var dataTransfer;
					if(event.originalEvent) dataTransfer = event.originalEvent.dataTransfer;
					else dataTransfer = event.dataTransfer;
					scope.$emit('ta-drop-event', this, event, dataTransfer);
					$timeout(function(){
						dropFired = false;
						_setViewValue(undefined, undefined, true);
					}, 100);
				}
			};

			//used for updating when inserting wrapped elements
			var _reApplyOnSelectorHandlers = scope['reApplyOnSelectorHandlers' + (attrs.id || '')] = function(){
				/* istanbul ignore else */
				if(!_isReadonly) angular.forEach(taSelectableElements, function(selector){
						// check we don't apply the handler twice
						element.find(selector)
							.off('click', selectorClickHandler)
							.on('click', selectorClickHandler);
					});
			};

			var _setInnerHTML = function(newval){
				element[0].innerHTML = newval;
			};
			var _renderTimeout;
			var _renderInProgress = false;
			// changes to the model variable from outside the html/text inputs
			ngModel.$render = function(){
				/* istanbul ignore if: Catches rogue renders, hard to replicate in tests */
				if(_renderInProgress) return;
				else _renderInProgress = true;
				// catch model being null or undefined
				var val = ngModel.$viewValue || '';
				// if the editor isn't focused it needs to be updated, otherwise it's receiving user input
				if(!_skipRender){
					/* istanbul ignore else: in other cases we don't care */
					if(_isContentEditable && _focussed){
						// update while focussed
						element.removeClass('placeholder-text');
						if(_renderTimeout) $timeout.cancel(_renderTimeout);
						_renderTimeout = $timeout(function(){
							/* istanbul ignore if: Can't be bothered testing this... */
							if(!_focussed){
								element[0].focus();
								taSelection.setSelectionToElementEnd(element.children()[element.children().length - 1]);
							}
							_renderTimeout = undefined;
						}, 1);
					}
					if(_isContentEditable){
						// WYSIWYG Mode
						if(attrs.placeholder){
							if(val === ''){
								// blank
								_setInnerHTML(_defaultVal);
							}else{
								// not-blank
								_setInnerHTML(val);
							}
						}else{
							_setInnerHTML((val === '') ? _defaultVal : val);
						}
						// if in WYSIWYG and readOnly we kill the use of links by clicking
						if(!_isReadonly){
							_reApplyOnSelectorHandlers();
							element.on('drop', fileDropHandler);
						}else{
							element.off('drop', fileDropHandler);
						}
					}else if(element[0].tagName.toLowerCase() !== 'textarea' && element[0].tagName.toLowerCase() !== 'input'){
						// make sure the end user can SEE the html code as a display. This is a read-only display element
						_setInnerHTML(taApplyCustomRenderers(val));
					}else{
						// only for input and textarea inputs
						element.val(val);
					}
				}
				if(_isContentEditable && attrs.placeholder){
					if(val === ''){
						if(_focussed) element.removeClass('placeholder-text');
						else element.addClass('placeholder-text');
					}else{
						element.removeClass('placeholder-text');
					}
				}
				_renderInProgress = _skipRender = false;
			};

			if(attrs.taReadonly){
				//set initial value
				_isReadonly = scope.$eval(attrs.taReadonly);
				if(_isReadonly){
					element.addClass('ta-readonly');
					// we changed to readOnly mode (taReadonly='true')
					if(element[0].tagName.toLowerCase() === 'textarea' || element[0].tagName.toLowerCase() === 'input'){
						element.attr('disabled', 'disabled');
					}
					if(element.attr('contenteditable') !== undefined && element.attr('contenteditable')){
						element.removeAttr('contenteditable');
					}
				}else{
					element.removeClass('ta-readonly');
					// we changed to NOT readOnly mode (taReadonly='false')
					if(element[0].tagName.toLowerCase() === 'textarea' || element[0].tagName.toLowerCase() === 'input'){
						element.removeAttr('disabled');
					}else if(_isContentEditable){
						element.attr('contenteditable', 'true');
					}
				}
				// taReadonly only has an effect if the taBind element is an input or textarea or has contenteditable='true' on it.
				// Otherwise it is readonly by default
				scope.$watch(attrs.taReadonly, function(newVal, oldVal){
					if(oldVal === newVal) return;
					if(newVal){
						element.addClass('ta-readonly');
						// we changed to readOnly mode (taReadonly='true')
						if(element[0].tagName.toLowerCase() === 'textarea' || element[0].tagName.toLowerCase() === 'input'){
							element.attr('disabled', 'disabled');
						}
						if(element.attr('contenteditable') !== undefined && element.attr('contenteditable')){
							element.removeAttr('contenteditable');
						}
						// turn ON selector click handlers
						angular.forEach(taSelectableElements, function(selector){
							element.find(selector).on('click', selectorClickHandler);
						});
						element.off('drop', fileDropHandler);
					}else{
						element.removeClass('ta-readonly');
						// we changed to NOT readOnly mode (taReadonly='false')
						if(element[0].tagName.toLowerCase() === 'textarea' || element[0].tagName.toLowerCase() === 'input'){
							element.removeAttr('disabled');
						}else if(_isContentEditable){
							element.attr('contenteditable', 'true');
						}
						// remove the selector click handlers
						angular.forEach(taSelectableElements, function(selector){
							element.find(selector).off('click', selectorClickHandler);
						});
						element.on('drop', fileDropHandler);
					}
					_isReadonly = newVal;
				});
			}

			// Initialise the selectableElements
			// if in WYSIWYG and readOnly we kill the use of links by clicking
			if(_isContentEditable && !_isReadonly){
				angular.forEach(taSelectableElements, function(selector){
					element.find(selector).on('click', selectorClickHandler);
				});
				element.on('drop', fileDropHandler);
				element.on('blur', function(){
					/* istanbul ignore next: webkit fix */
					if(_browserDetect.webkit) { // detect webkit
						globalContentEditableBlur = true;
					}
				});
			}
		}
	};
}]);

// this global var is used to prevent multiple fires of the drop event. Needs to be global to the textAngular file.
var dropFired = false;
var textAngular = angular.module("textAngular", ['ngSanitize', 'textAngularSetup', 'textAngular.factories', 'textAngular.DOM', 'textAngular.validators', 'textAngular.taBind']); //This makes ngSanitize required

textAngular.config([function(){
	// clear taTools variable. Just catches testing and any other time that this config may run multiple times...
	angular.forEach(taTools, function(value, key){ delete taTools[key];	});
}]);

textAngular.run([function(){
	/* istanbul ignore next: not sure how to test this */
	// Require Rangy and rangy savedSelection module.
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as an anonymous module.
		define(function(require) {
			window.rangy = require('rangy');
			window.rangy.saveSelection = require('rangy/lib/rangy-selectionsaverestore');
		});
	} else if (typeof require ==='function' && typeof module !== 'undefined' && typeof exports === 'object') {
		// Node/CommonJS style
		window.rangy = require('rangy');
		window.rangy.saveSelection = require('rangy/lib/rangy-selectionsaverestore');
	} else {
		// Ensure that rangy and rangy.saveSelection exists on the window (global scope).
		// TODO: Refactor so that the global scope is no longer used.
		if(!window.rangy){
			throw("rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.");
		}else{
			window.rangy.init();
			if(!window.rangy.saveSelection){
				throw("rangy-selectionsaverestore.js is required for textAngular to work correctly.");
			}
		}
	}
}]);

textAngular.directive("textAngular", [
	'$compile', '$timeout', 'taOptions', 'taSelection', 'taExecCommand',
	'textAngularManager', '$window', '$document', '$animate', '$log', '$q', '$parse',
	function($compile, $timeout, taOptions, taSelection, taExecCommand,
		textAngularManager, $window, $document, $animate, $log, $q, $parse){
		return {
			require: '?ngModel',
			scope: {},
			restrict: "EA",
			priority: 2, // So we override validators correctly
			link: function(scope, element, attrs, ngModel){
				// all these vars should not be accessable outside this directive
				var _keydown, _keyup, _keypress, _mouseup, _focusin, _focusout,
					_originalContents, _toolbars,
					_serial = (attrs.serial) ? attrs.serial : Math.floor(Math.random() * 10000000000000000),
					_taExecCommand, _resizeMouseDown, _updateSelectedStylesTimeout;

				scope._name = (attrs.name) ? attrs.name : 'textAngularEditor' + _serial;

				var oneEvent = function(_element, event, action){
					$timeout(function(){
						// shim the .one till fixed
						var _func = function(){
							_element.off(event, _func);
							action.apply(this, arguments);
						};
						_element.on(event, _func);
					}, 100);
				};
				_taExecCommand = taExecCommand(attrs.taDefaultWrap);
				// get the settings from the defaults and add our specific functions that need to be on the scope
				angular.extend(scope, angular.copy(taOptions), {
					// wraps the selection in the provided tag / execCommand function. Should only be called in WYSIWYG mode.
					wrapSelection: function(command, opt, isSelectableElementTool){
						if(command.toLowerCase() === "undo"){
							scope['$undoTaBindtaTextElement' + _serial]();
						}else if(command.toLowerCase() === "redo"){
							scope['$redoTaBindtaTextElement' + _serial]();
						}else{
							// catch errors like FF erroring when you try to force an undo with nothing done
							_taExecCommand(command, false, opt, scope.defaultTagAttributes);
							if(isSelectableElementTool){
								// re-apply the selectable tool events
								scope['reApplyOnSelectorHandlerstaTextElement' + _serial]();
							}
							// refocus on the shown display element, this fixes a display bug when using :focus styles to outline the box.
							// You still have focus on the text/html input it just doesn't show up
							scope.displayElements.text[0].focus();
						}
					},
					showHtml: scope.$eval(attrs.taShowHtml) || false
				});
				// setup the options from the optional attributes
				if(attrs.taFocussedClass)			scope.classes.focussed = attrs.taFocussedClass;
				if(attrs.taTextEditorClass)			scope.classes.textEditor = attrs.taTextEditorClass;
				if(attrs.taHtmlEditorClass)			scope.classes.htmlEditor = attrs.taHtmlEditorClass;
				if(attrs.taDefaultTagAttributes){
					try	{
						//	TODO: This should use angular.merge to enhance functionality once angular 1.4 is required
						angular.extend(scope.defaultTagAttributes, angular.fromJson(attrs.taDefaultTagAttributes));
					} catch (error) {
						$log.error(error);
					}
				}
				// optional setup functions
				if(attrs.taTextEditorSetup)			scope.setup.textEditorSetup = scope.$parent.$eval(attrs.taTextEditorSetup);
				if(attrs.taHtmlEditorSetup)			scope.setup.htmlEditorSetup = scope.$parent.$eval(attrs.taHtmlEditorSetup);
				// optional fileDropHandler function
				if(attrs.taFileDrop)				scope.fileDropHandler = scope.$parent.$eval(attrs.taFileDrop);
				else								scope.fileDropHandler = scope.defaultFileDropHandler;

				_originalContents = element[0].innerHTML;
				// clear the original content
				element[0].innerHTML = '';

				// Setup the HTML elements as variable references for use later
				scope.displayElements = {
					// we still need the hidden input even with a textarea as the textarea may have invalid/old input in it,
					// wheras the input will ALLWAYS have the correct value.
					forminput: angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),
					html: angular.element("<textarea></textarea>"),
					text: angular.element("<div></div>"),
					// other toolbased elements
					scrollWindow: angular.element("<div class='ta-scroll-window'></div>"),
					popover: angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),
					popoverArrow: angular.element('<div class="arrow"></div>'),
					popoverContainer: angular.element('<div class="popover-content"></div>'),
					resize: {
						overlay: angular.element('<div class="ta-resizer-handle-overlay"></div>'),
						background: angular.element('<div class="ta-resizer-handle-background"></div>'),
						anchors: [
							angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),
							angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),
							angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),
							angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')
						],
						info: angular.element('<div class="ta-resizer-handle-info"></div>')
					}
				};

				// Setup the popover
				scope.displayElements.popover.append(scope.displayElements.popoverArrow);
				scope.displayElements.popover.append(scope.displayElements.popoverContainer);
				scope.displayElements.scrollWindow.append(scope.displayElements.popover);

				scope.displayElements.popover.on('mousedown', function(e, eventData){
					/* istanbul ignore else: this is for catching the jqLite testing*/
					if(eventData) angular.extend(e, eventData);
					// this prevents focusout from firing on the editor when clicking anything in the popover
					e.preventDefault();
					return false;
				});

				// define the popover show and hide functions
				scope.showPopover = function(_el){
					scope.displayElements.popover.css('display', 'block');
					scope.reflowPopover(_el);
					$animate.addClass(scope.displayElements.popover, 'in');
					oneEvent($document.find('body'), 'click keyup', function(){scope.hidePopover();});
				};
				scope.reflowPopover = function(_el){
					/* istanbul ignore if: catches only if near bottom of editor */
					if(scope.displayElements.text[0].offsetHeight - 51 > _el[0].offsetTop){
						scope.displayElements.popover.css('top', _el[0].offsetTop + _el[0].offsetHeight + scope.displayElements.scrollWindow[0].scrollTop + 'px');
						scope.displayElements.popover.removeClass('top').addClass('bottom');
					}else{
						scope.displayElements.popover.css('top', _el[0].offsetTop - 54 + scope.displayElements.scrollWindow[0].scrollTop + 'px');
						scope.displayElements.popover.removeClass('bottom').addClass('top');
					}
					var _maxLeft = scope.displayElements.text[0].offsetWidth - scope.displayElements.popover[0].offsetWidth;
					var _targetLeft = _el[0].offsetLeft + (_el[0].offsetWidth / 2.0) - (scope.displayElements.popover[0].offsetWidth / 2.0);
					scope.displayElements.popover.css('left', Math.max(0, Math.min(_maxLeft, _targetLeft)) + 'px');
					scope.displayElements.popoverArrow.css('margin-left', (Math.min(_targetLeft, (Math.max(0, _targetLeft - _maxLeft))) - 11) + 'px');
				};
				scope.hidePopover = function(){
					scope.displayElements.popover.css('display', '');
					scope.displayElements.popoverContainer.attr('style', '');
					scope.displayElements.popoverContainer.attr('class', 'popover-content');
					scope.displayElements.popover.removeClass('in');
				};

				// setup the resize overlay
				scope.displayElements.resize.overlay.append(scope.displayElements.resize.background);
				angular.forEach(scope.displayElements.resize.anchors, function(anchor){ scope.displayElements.resize.overlay.append(anchor);});
				scope.displayElements.resize.overlay.append(scope.displayElements.resize.info);
				scope.displayElements.scrollWindow.append(scope.displayElements.resize.overlay);

				// define the show and hide events
				scope.reflowResizeOverlay = function(_el){
					_el = angular.element(_el)[0];
					scope.displayElements.resize.overlay.css({
						'display': 'block',
						'left': _el.offsetLeft - 5 + 'px',
						'top': _el.offsetTop - 5 + 'px',
						'width': _el.offsetWidth + 10 + 'px',
						'height': _el.offsetHeight + 10 + 'px'
					});
					scope.displayElements.resize.info.text(_el.offsetWidth + ' x ' + _el.offsetHeight);
				};
				/* istanbul ignore next: pretty sure phantomjs won't test this */
				scope.showResizeOverlay = function(_el){
					var _body = $document.find('body');
					_resizeMouseDown = function(event){
						var startPosition = {
							width: parseInt(_el.attr('width')),
							height: parseInt(_el.attr('height')),
							x: event.clientX,
							y: event.clientY
						};
						if(startPosition.width === undefined || isNaN(startPosition.width)) startPosition.width = _el[0].offsetWidth;
						if(startPosition.height === undefined || isNaN(startPosition.height)) startPosition.height = _el[0].offsetHeight;
						scope.hidePopover();
						var ratio = startPosition.height / startPosition.width;
						var mousemove = function(event){
							// calculate new size
							var pos = {
								x: Math.max(0, startPosition.width + (event.clientX - startPosition.x)),
								y: Math.max(0, startPosition.height + (event.clientY - startPosition.y))
							};

							// DEFAULT: the aspect ratio is not locked unless the Shift key is pressed.
							//
							// attribute: ta-resize-force-aspect-ratio -- locks resize into maintaing the aspect ratio
							var bForceAspectRatio = (attrs.taResizeForceAspectRatio !== undefined);
							// attribute: ta-resize-maintain-aspect-ratio=true causes the space ratio to remain locked
							// unless the Shift key is pressed
							var bFlipKeyBinding = attrs.taResizeMaintainAspectRatio;
							var bKeepRatio =  bForceAspectRatio || (bFlipKeyBinding && !event.shiftKey);
							if(bKeepRatio) {
								var newRatio = pos.y / pos.x;
								pos.x = ratio > newRatio ? pos.x : pos.y / ratio;
								pos.y = ratio > newRatio ? pos.x * ratio : pos.y;
							}
							var el = angular.element(_el);
							function roundedMaxVal(val) {
								return Math.round(Math.max(0, val));
							}
							el.css('height', roundedMaxVal(pos.y) + 'px');
							el.css('width', roundedMaxVal(pos.x) + 'px');

							// reflow the popover tooltip
							scope.reflowResizeOverlay(_el);
						};
						_body.on('mousemove', mousemove);
						oneEvent(_body, 'mouseup', function(event){
							event.preventDefault();
							event.stopPropagation();
							_body.off('mousemove', mousemove);
							scope.showPopover(_el);
						});
						event.stopPropagation();
						event.preventDefault();
					};

					scope.displayElements.resize.anchors[3].off('mousedown');
					scope.displayElements.resize.anchors[3].on('mousedown', _resizeMouseDown);

					scope.reflowResizeOverlay(_el);
					oneEvent(_body, 'click', function(){scope.hideResizeOverlay();});
				};
				/* istanbul ignore next: pretty sure phantomjs won't test this */
				scope.hideResizeOverlay = function(){
					scope.displayElements.resize.anchors[3].off('mousedown', _resizeMouseDown);
					scope.displayElements.resize.overlay.css('display', '');
				};

				// allow for insertion of custom directives on the textarea and div
				scope.setup.htmlEditorSetup(scope.displayElements.html);
				scope.setup.textEditorSetup(scope.displayElements.text);
				scope.displayElements.html.attr({
					'id': 'taHtmlElement' + _serial,
					'ng-show': 'showHtml',
					'ta-bind': 'ta-bind',
					'ng-model': 'html',
					'ng-model-options': element.attr('ng-model-options')
				});
				scope.displayElements.text.attr({
					'id': 'taTextElement' + _serial,
					'contentEditable': 'true',
					'ta-bind': 'ta-bind',
					'ng-model': 'html',
					'ng-model-options': element.attr('ng-model-options')
				});
				scope.displayElements.scrollWindow.attr({'ng-hide': 'showHtml'});
				if(attrs.taDefaultWrap) scope.displayElements.text.attr('ta-default-wrap', attrs.taDefaultWrap);

				if(attrs.taUnsafeSanitizer){
					scope.displayElements.text.attr('ta-unsafe-sanitizer', attrs.taUnsafeSanitizer);
					scope.displayElements.html.attr('ta-unsafe-sanitizer', attrs.taUnsafeSanitizer);
				}

				// add the main elements to the origional element
				scope.displayElements.scrollWindow.append(scope.displayElements.text);
				element.append(scope.displayElements.scrollWindow);
				element.append(scope.displayElements.html);

				scope.displayElements.forminput.attr('name', scope._name);
				element.append(scope.displayElements.forminput);

				if(attrs.tabindex){
					element.removeAttr('tabindex');
					scope.displayElements.text.attr('tabindex', attrs.tabindex);
					scope.displayElements.html.attr('tabindex', attrs.tabindex);
				}

				if (attrs.placeholder) {
					scope.displayElements.text.attr('placeholder', attrs.placeholder);
					scope.displayElements.html.attr('placeholder', attrs.placeholder);
				}

				if(attrs.taDisabled){
					scope.displayElements.text.attr('ta-readonly', 'disabled');
					scope.displayElements.html.attr('ta-readonly', 'disabled');
					scope.disabled = scope.$parent.$eval(attrs.taDisabled);
					scope.$parent.$watch(attrs.taDisabled, function(newVal){
						scope.disabled = newVal;
						if(scope.disabled){
							element.addClass(scope.classes.disabled);
						}else{
							element.removeClass(scope.classes.disabled);
						}
					});
				}

				if(attrs.taPaste){
					scope._pasteHandler = function(_html){
						return $parse(attrs.taPaste)(scope.$parent, {$html: _html});
					};
					scope.displayElements.text.attr('ta-paste', '_pasteHandler($html)');
				}

				// compile the scope with the text and html elements only - if we do this with the main element it causes a compile loop
				$compile(scope.displayElements.scrollWindow)(scope);
				$compile(scope.displayElements.html)(scope);

				scope.updateTaBindtaTextElement = scope['updateTaBindtaTextElement' + _serial];
				scope.updateTaBindtaHtmlElement = scope['updateTaBindtaHtmlElement' + _serial];

				// add the classes manually last
				element.addClass("ta-root");
				scope.displayElements.scrollWindow.addClass("ta-text ta-editor " + scope.classes.textEditor);
				scope.displayElements.html.addClass("ta-html ta-editor " + scope.classes.htmlEditor);

				// used in the toolbar actions
				scope._actionRunning = false;
				var _savedSelection = false;
				scope.startAction = function(){
					scope._actionRunning = true;
					// if rangy library is loaded return a function to reload the current selection
					_savedSelection = $window.rangy.saveSelection();
					return function(){
						if(_savedSelection) $window.rangy.restoreSelection(_savedSelection);
					};
				};
				scope.endAction = function(){
					scope._actionRunning = false;
					if(_savedSelection){
						if(scope.showHtml){
							scope.displayElements.html[0].focus();
						}else{
							scope.displayElements.text[0].focus();
						}
						// $window.rangy.restoreSelection(_savedSelection);
						$window.rangy.removeMarkers(_savedSelection);
					}
					_savedSelection = false;
					scope.updateSelectedStyles();
					// only update if in text or WYSIWYG mode
					if(!scope.showHtml) scope['updateTaBindtaTextElement' + _serial]();
				};

				// note that focusout > focusin is called everytime we click a button - except bad support: http://www.quirksmode.org/dom/events/blurfocus.html
				// cascades to displayElements.text and displayElements.html automatically.
				_focusin = function(){
					scope.focussed = true;
					element.addClass(scope.classes.focussed);
					_toolbars.focus();
					element.triggerHandler('focus');
				};
				scope.displayElements.html.on('focus', _focusin);
				scope.displayElements.text.on('focus', _focusin);
				_focusout = function(e){
					// if we are NOT runnig an action and have NOT focussed again on the text etc then fire the blur events
					if(!scope._actionRunning && $document[0].activeElement !== scope.displayElements.html[0] && $document[0].activeElement !== scope.displayElements.text[0]){
						element.removeClass(scope.classes.focussed);
						_toolbars.unfocus();
						// to prevent multiple apply error defer to next seems to work.
						$timeout(function(){
							scope._bUpdateSelectedStyles = false;
							element.triggerHandler('blur');
							scope.focussed = false;
						}, 0);
					}
					e.preventDefault();
					return false;
				};
				scope.displayElements.html.on('blur', _focusout);
				scope.displayElements.text.on('blur', _focusout);

				scope.displayElements.text.on('paste', function(event){
					element.triggerHandler('paste', event);
				});

				// Setup the default toolbar tools, this way allows the user to add new tools like plugins.
				// This is on the editor for future proofing if we find a better way to do this.
				scope.queryFormatBlockState = function(command){
					// $document[0].queryCommandValue('formatBlock') errors in Firefox if we call this when focussed on the textarea
					return !scope.showHtml && command.toLowerCase() === $document[0].queryCommandValue('formatBlock').toLowerCase();
				};
				scope.queryCommandState = function(command){
					// $document[0].queryCommandValue('formatBlock') errors in Firefox if we call this when focussed on the textarea
					return (!scope.showHtml) ? $document[0].queryCommandState(command) : '';
				};
				scope.switchView = function(){
					scope.showHtml = !scope.showHtml;
					$animate.enabled(false, scope.displayElements.html);
					$animate.enabled(false, scope.displayElements.text);
					//Show the HTML view
					if(scope.showHtml){
						//defer until the element is visible
						$timeout(function(){
							$animate.enabled(true, scope.displayElements.html);
							$animate.enabled(true, scope.displayElements.text);
							// [0] dereferences the DOM object from the angular.element
							return scope.displayElements.html[0].focus();
						}, 100);
					}else{
						//Show the WYSIWYG view
						//defer until the element is visible
						$timeout(function(){
							$animate.enabled(true, scope.displayElements.html);
							$animate.enabled(true, scope.displayElements.text);
							// [0] dereferences the DOM object from the angular.element
							return scope.displayElements.text[0].focus();
						}, 100);
					}
				};

				// changes to the model variable from outside the html/text inputs
				// if no ngModel, then the only input is from inside text-angular
				if(attrs.ngModel){
					var _firstRun = true;
					ngModel.$render = function(){
						if(_firstRun){
							// we need this firstRun to set the originalContents otherwise it gets overrided by the setting of ngModel to undefined from NaN
							_firstRun = false;
							// if view value is null or undefined initially and there was original content, set to the original content
							var _initialValue = scope.$parent.$eval(attrs.ngModel);
							if((_initialValue === undefined || _initialValue === null) && (_originalContents && _originalContents !== '')){
								// on passing through to taBind it will be sanitised
								ngModel.$setViewValue(_originalContents);
							}
						}
						scope.displayElements.forminput.val(ngModel.$viewValue);
						// if the editors aren't focused they need to be updated, otherwise they are doing the updating
						scope.html = ngModel.$viewValue || '';
					};
					// trigger the validation calls
					if(element.attr('required')) ngModel.$validators.required = function(modelValue, viewValue) {
						var value = modelValue || viewValue;
						return !(!value || value.trim() === '');
					};
				}else{
					// if no ngModel then update from the contents of the origional html.
					scope.displayElements.forminput.val(_originalContents);
					scope.html = _originalContents;
				}

				// changes from taBind back up to here
				scope.$watch('html', function(newValue, oldValue){
					if(newValue !== oldValue){
						if(attrs.ngModel && ngModel.$viewValue !== newValue) ngModel.$setViewValue(newValue);
						scope.displayElements.forminput.val(newValue);
					}
				});

				if(attrs.taTargetToolbars) _toolbars = textAngularManager.registerEditor(scope._name, scope, attrs.taTargetToolbars.split(','));
				else{
					var _toolbar = angular.element('<div text-angular-toolbar name="textAngularToolbar' + _serial + '">');
					// passthrough init of toolbar options
					if(attrs.taToolbar)						_toolbar.attr('ta-toolbar', attrs.taToolbar);
					if(attrs.taToolbarClass)				_toolbar.attr('ta-toolbar-class', attrs.taToolbarClass);
					if(attrs.taToolbarGroupClass)			_toolbar.attr('ta-toolbar-group-class', attrs.taToolbarGroupClass);
					if(attrs.taToolbarButtonClass)			_toolbar.attr('ta-toolbar-button-class', attrs.taToolbarButtonClass);
					if(attrs.taToolbarActiveButtonClass)	_toolbar.attr('ta-toolbar-active-button-class', attrs.taToolbarActiveButtonClass);
					if(attrs.taFocussedClass)				_toolbar.attr('ta-focussed-class', attrs.taFocussedClass);

					element.prepend(_toolbar);
					$compile(_toolbar)(scope.$parent);
					_toolbars = textAngularManager.registerEditor(scope._name, scope, ['textAngularToolbar' + _serial]);
				}

				scope.$on('$destroy', function(){
					textAngularManager.unregisterEditor(scope._name);
					angular.element(window).off('blur');
				});

				// catch element select event and pass to toolbar tools
				scope.$on('ta-element-select', function(event, element){
					if(_toolbars.triggerElementSelect(event, element)){
						scope['reApplyOnSelectorHandlerstaTextElement' + _serial]();
					}
				});

				scope.$on('ta-drop-event', function(event, element, dropEvent, dataTransfer){
					scope.displayElements.text[0].focus();
					if(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0){
						angular.forEach(dataTransfer.files, function(file){
							// taking advantage of boolean execution, if the fileDropHandler returns true, nothing else after it is executed
							// If it is false then execute the defaultFileDropHandler if the fileDropHandler is NOT the default one
							// Once one of these has been executed wrap the result as a promise, if undefined or variable update the taBind, else we should wait for the promise
							try{
								$q.when(scope.fileDropHandler(file, scope.wrapSelection) ||
									(scope.fileDropHandler !== scope.defaultFileDropHandler &&
									$q.when(scope.defaultFileDropHandler(file, scope.wrapSelection)))).then(function(){
										scope['updateTaBindtaTextElement' + _serial]();
									});
							}catch(error){
								$log.error(error);
							}
						});
						dropEvent.preventDefault();
						dropEvent.stopPropagation();
					/* istanbul ignore else, the updates if moved text */
					}else{
						$timeout(function(){
							scope['updateTaBindtaTextElement' + _serial]();
						}, 0);
					}
				});

				// the following is for applying the active states to the tools that support it
				scope._bUpdateSelectedStyles = false;
				/* istanbul ignore next: browser window/tab leave check */
				angular.element(window).on('blur', function(){
					scope._bUpdateSelectedStyles = false;
					scope.focussed = false;
				});
				// loop through all the tools polling their activeState function if it exists
				scope.updateSelectedStyles = function(){
					var _selection;
					/* istanbul ignore next: This check is to ensure multiple timeouts don't exist */
					if(_updateSelectedStylesTimeout) $timeout.cancel(_updateSelectedStylesTimeout);
					// test if the common element ISN'T the root ta-text node
					if((_selection = taSelection.getSelectionElement()) !== undefined && _selection.parentNode !== scope.displayElements.text[0]){
						_toolbars.updateSelectedStyles(angular.element(_selection));
					}else _toolbars.updateSelectedStyles();
					// used to update the active state when a key is held down, ie the left arrow
					/* istanbul ignore else: browser only check */
					if(scope._bUpdateSelectedStyles) _updateSelectedStylesTimeout = $timeout(scope.updateSelectedStyles, 200);
				};
				// start updating on keydown
				_keydown = function(){
					/* istanbul ignore next: ie catch */
					if(!scope.focussed){
						scope._bUpdateSelectedStyles = false;
						return;
					}
					/* istanbul ignore else: don't run if already running */
					if(!scope._bUpdateSelectedStyles){
						scope._bUpdateSelectedStyles = true;
						scope.$apply(function(){
							scope.updateSelectedStyles();
						});
					}
				};
				scope.displayElements.html.on('keydown', _keydown);
				scope.displayElements.text.on('keydown', _keydown);
				// stop updating on key up and update the display/model
				_keyup = function(){
					scope._bUpdateSelectedStyles = false;
				};
				scope.displayElements.html.on('keyup', _keyup);
				scope.displayElements.text.on('keyup', _keyup);
				// stop updating on key up and update the display/model
				_keypress = function(event, eventData){
					/* istanbul ignore else: this is for catching the jqLite testing*/
					if(eventData) angular.extend(event, eventData);
					scope.$apply(function(){
						if(_toolbars.sendKeyCommand(event)){
							/* istanbul ignore else: don't run if already running */
							if(!scope._bUpdateSelectedStyles){
								scope.updateSelectedStyles();
							}
							event.preventDefault();
							return false;
						}
					});
				};
				scope.displayElements.html.on('keypress', _keypress);
				scope.displayElements.text.on('keypress', _keypress);
				// update the toolbar active states when we click somewhere in the text/html boxed
				_mouseup = function(){
					// ensure only one execution of updateSelectedStyles()
					scope._bUpdateSelectedStyles = false;
					scope.$apply(function(){
						scope.updateSelectedStyles();
					});
				};
				scope.displayElements.html.on('mouseup', _mouseup);
				scope.displayElements.text.on('mouseup', _mouseup);
			}
		};
	}
]);
textAngular.service('textAngularManager', ['taToolExecuteAction', 'taTools', 'taRegisterTool', function(taToolExecuteAction, taTools, taRegisterTool){
	// this service is used to manage all textAngular editors and toolbars.
	// All publicly published functions that modify/need to access the toolbar or editor scopes should be in here
	// these contain references to all the editors and toolbars that have been initialised in this app
	var toolbars = {}, editors = {};
	// when we focus into a toolbar, we need to set the TOOLBAR's $parent to be the toolbars it's linked to.
	// We also need to set the tools to be updated to be the toolbars...
	return {
		// register an editor and the toolbars that it is affected by
		registerEditor: function(name, scope, targetToolbars){
			// targetToolbars are optional, we don't require a toolbar to function
			if(!name || name === '') throw('textAngular Error: An editor requires a name');
			if(!scope) throw('textAngular Error: An editor requires a scope');
			if(editors[name]) throw('textAngular Error: An Editor with name "' + name + '" already exists');
			// _toolbars is an ARRAY of toolbar scopes
			var _toolbars = [];
			angular.forEach(targetToolbars, function(_name){
				if(toolbars[_name]) _toolbars.push(toolbars[_name]);
				// if it doesn't exist it may not have been compiled yet and it will be added later
			});
			editors[name] = {
				scope: scope,
				toolbars: targetToolbars,
				_registerToolbar: function(toolbarScope){
					// add to the list late
					if(this.toolbars.indexOf(toolbarScope.name) >= 0) _toolbars.push(toolbarScope);
				},
				// this is a suite of functions the editor should use to update all it's linked toolbars
				editorFunctions: {
					disable: function(){
						// disable all linked toolbars
						angular.forEach(_toolbars, function(toolbarScope){ toolbarScope.disabled = true; });
					},
					enable: function(){
						// enable all linked toolbars
						angular.forEach(_toolbars, function(toolbarScope){ toolbarScope.disabled = false; });
					},
					focus: function(){
						// this should be called when the editor is focussed
						angular.forEach(_toolbars, function(toolbarScope){
							toolbarScope._parent = scope;
							toolbarScope.disabled = false;
							toolbarScope.focussed = true;
							scope.focussed = true;
						});
					},
					unfocus: function(){
						// this should be called when the editor becomes unfocussed
						angular.forEach(_toolbars, function(toolbarScope){
							toolbarScope.disabled = true;
							toolbarScope.focussed = false;
						});
						scope.focussed = false;
					},
					updateSelectedStyles: function(selectedElement){
						// update the active state of all buttons on liked toolbars
						angular.forEach(_toolbars, function(toolbarScope){
							angular.forEach(toolbarScope.tools, function(toolScope){
								if(toolScope.activeState){
									toolbarScope._parent = scope;
									toolScope.active = toolScope.activeState(selectedElement);
								}
							});
						});
					},
					sendKeyCommand: function(event){
						// we return true if we applied an action, false otherwise
						var result = false;
						if(event.ctrlKey || event.metaKey || event.specialKey) angular.forEach(taTools, function(tool, name){
							if(tool.commandKeyCode && (tool.commandKeyCode === event.which || tool.commandKeyCode === event.specialKey)){
								for(var _t = 0; _t < _toolbars.length; _t++){
									if(_toolbars[_t].tools[name] !== undefined){
										taToolExecuteAction.call(_toolbars[_t].tools[name], scope);
										result = true;
										break;
									}
								}
							}
						});
						return result;
					},
					triggerElementSelect: function(event, element){
						// search through the taTools to see if a match for the tag is made.
						// if there is, see if the tool is on a registered toolbar and not disabled.
						// NOTE: This can trigger on MULTIPLE tools simultaneously.
						var elementHasAttrs = function(_element, attrs){
							var result = true;
							for(var i = 0; i < attrs.length; i++) result = result && _element.attr(attrs[i]);
							return result;
						};
						var workerTools = [];
						var unfilteredTools = {};
						var result = false;
						element = angular.element(element);
						// get all valid tools by element name, keep track if one matches the
						var onlyWithAttrsFilter = false;
						angular.forEach(taTools, function(tool, name){
							if(
								tool.onElementSelect &&
								tool.onElementSelect.element &&
								tool.onElementSelect.element.toLowerCase() === element[0].tagName.toLowerCase() &&
								(!tool.onElementSelect.filter || tool.onElementSelect.filter(element))
							){
								// this should only end up true if the element matches the only attributes
								onlyWithAttrsFilter = onlyWithAttrsFilter ||
									(angular.isArray(tool.onElementSelect.onlyWithAttrs) && elementHasAttrs(element, tool.onElementSelect.onlyWithAttrs));
								if(!tool.onElementSelect.onlyWithAttrs || elementHasAttrs(element, tool.onElementSelect.onlyWithAttrs)) unfilteredTools[name] = tool;
							}
						});
						// if we matched attributes to filter on, then filter, else continue
						if(onlyWithAttrsFilter){
							angular.forEach(unfilteredTools, function(tool, name){
								if(tool.onElementSelect.onlyWithAttrs && elementHasAttrs(element, tool.onElementSelect.onlyWithAttrs)) workerTools.push({'name': name, 'tool': tool});
							});
							// sort most specific (most attrs to find) first
							workerTools.sort(function(a,b){
								return b.tool.onElementSelect.onlyWithAttrs.length - a.tool.onElementSelect.onlyWithAttrs.length;
							});
						}else{
							angular.forEach(unfilteredTools, function(tool, name){
								workerTools.push({'name': name, 'tool': tool});
							});
						}
						// Run the actions on the first visible filtered tool only
						if(workerTools.length > 0){
							for(var _i = 0; _i < workerTools.length; _i++){
								var tool = workerTools[_i].tool;
								var name = workerTools[_i].name;
								for(var _t = 0; _t < _toolbars.length; _t++){
									if(_toolbars[_t].tools[name] !== undefined){
										tool.onElementSelect.action.call(_toolbars[_t].tools[name], event, element, scope);
										result = true;
										break;
									}
								}
								if(result) break;
							}
						}
						return result;
					}
				}
			};
			return editors[name].editorFunctions;
		},
		// retrieve editor by name, largely used by testing suites only
		retrieveEditor: function(name){
			return editors[name];
		},
		unregisterEditor: function(name){
			delete editors[name];
		},
		// registers a toolbar such that it can be linked to editors
		registerToolbar: function(scope){
			if(!scope) throw('textAngular Error: A toolbar requires a scope');
			if(!scope.name || scope.name === '') throw('textAngular Error: A toolbar requires a name');
			if(toolbars[scope.name]) throw('textAngular Error: A toolbar with name "' + scope.name + '" already exists');
			toolbars[scope.name] = scope;
			angular.forEach(editors, function(_editor){
				_editor._registerToolbar(scope);
			});
		},
		// retrieve toolbar by name, largely used by testing suites only
		retrieveToolbar: function(name){
			return toolbars[name];
		},
		// retrieve toolbars by editor name, largely used by testing suites only
		retrieveToolbarsViaEditor: function(name){
			var result = [], _this = this;
			angular.forEach(this.retrieveEditor(name).toolbars, function(name){
				result.push(_this.retrieveToolbar(name));
			});
			return result;
		},
		unregisterToolbar: function(name){
			delete toolbars[name];
		},
		// functions for updating the toolbar buttons display
		updateToolsDisplay: function(newTaTools){
			// pass a partial struct of the taTools, this allows us to update the tools on the fly, will not change the defaults.
			var _this = this;
			angular.forEach(newTaTools, function(_newTool, key){
				_this.updateToolDisplay(key, _newTool);
			});
		},
		// this function resets all toolbars to their default tool definitions
		resetToolsDisplay: function(){
			var _this = this;
			angular.forEach(taTools, function(_newTool, key){
				_this.resetToolDisplay(key);
			});
		},
		// update a tool on all toolbars
		updateToolDisplay: function(toolKey, _newTool){
			var _this = this;
			angular.forEach(toolbars, function(toolbarScope, toolbarKey){
				_this.updateToolbarToolDisplay(toolbarKey, toolKey, _newTool);
			});
		},
		// resets a tool to the default/starting state on all toolbars
		resetToolDisplay: function(toolKey){
			var _this = this;
			angular.forEach(toolbars, function(toolbarScope, toolbarKey){
				_this.resetToolbarToolDisplay(toolbarKey, toolKey);
			});
		},
		// update a tool on a specific toolbar
		updateToolbarToolDisplay: function(toolbarKey, toolKey, _newTool){
			if(toolbars[toolbarKey]) toolbars[toolbarKey].updateToolDisplay(toolKey, _newTool);
			else throw('textAngular Error: No Toolbar with name "' + toolbarKey + '" exists');
		},
		// reset a tool on a specific toolbar to it's default starting value
		resetToolbarToolDisplay: function(toolbarKey, toolKey){
			if(toolbars[toolbarKey]) toolbars[toolbarKey].updateToolDisplay(toolKey, taTools[toolKey], true);
			else throw('textAngular Error: No Toolbar with name "' + toolbarKey + '" exists');
		},
		// removes a tool from all toolbars and it's definition
		removeTool: function(toolKey){
			delete taTools[toolKey];
			angular.forEach(toolbars, function(toolbarScope){
				delete toolbarScope.tools[toolKey];
				for(var i = 0; i < toolbarScope.toolbar.length; i++){
					var toolbarIndex;
					for(var j = 0; j < toolbarScope.toolbar[i].length; j++){
						if(toolbarScope.toolbar[i][j] === toolKey){
							toolbarIndex = {
								group: i,
								index: j
							};
							break;
						}
						if(toolbarIndex !== undefined) break;
					}
					if(toolbarIndex !== undefined){
						toolbarScope.toolbar[toolbarIndex.group].slice(toolbarIndex.index, 1);
						toolbarScope._$element.children().eq(toolbarIndex.group).children().eq(toolbarIndex.index).remove();
					}
				}
			});
		},
		// toolkey, toolDefinition are required. If group is not specified will pick the last group, if index isnt defined will append to group
		addTool: function(toolKey, toolDefinition, group, index){
			taRegisterTool(toolKey, toolDefinition);
			angular.forEach(toolbars, function(toolbarScope){
				toolbarScope.addTool(toolKey, toolDefinition, group, index);
			});
		},
		// adds a Tool but only to one toolbar not all
		addToolToToolbar: function(toolKey, toolDefinition, toolbarKey, group, index){
			taRegisterTool(toolKey, toolDefinition);
			toolbars[toolbarKey].addTool(toolKey, toolDefinition, group, index);
		},
		// this is used when externally the html of an editor has been changed and textAngular needs to be notified to update the model.
		// this will call a $digest if not already happening
		refreshEditor: function(name){
			if(editors[name]){
				editors[name].scope.updateTaBindtaTextElement();
				/* istanbul ignore else: phase catch */
				if(!editors[name].scope.$$phase) editors[name].scope.$digest();
			}else throw('textAngular Error: No Editor with name "' + name + '" exists');
		},
		// this is used by taBind to send a key command in response to a special key event
		sendKeyCommand: function(scope, event){
			angular.forEach(editors, function(_editor){
				/* istanbul ignore else: if nothing to do, do nothing */
				if (_editor.editorFunctions.sendKeyCommand(event)){
					/* istanbul ignore else: don't run if already running */
					if(!scope._bUpdateSelectedStyles){
						scope.updateSelectedStyles();
					}
					event.preventDefault();
					return false;
				}
			});
		}
	};
}]);
textAngular.directive('textAngularToolbar', [
	'$compile', 'textAngularManager', 'taOptions', 'taTools', 'taToolExecuteAction', '$window',
	function($compile, textAngularManager, taOptions, taTools, taToolExecuteAction, $window){
		return {
			scope: {
				name: '@' // a name IS required
			},
			restrict: "EA",
			link: function(scope, element, attrs){
				if(!scope.name || scope.name === '') throw('textAngular Error: A toolbar requires a name');
				angular.extend(scope, angular.copy(taOptions));
				if(attrs.taToolbar)						scope.toolbar = scope.$parent.$eval(attrs.taToolbar);
				if(attrs.taToolbarClass)				scope.classes.toolbar = attrs.taToolbarClass;
				if(attrs.taToolbarGroupClass)			scope.classes.toolbarGroup = attrs.taToolbarGroupClass;
				if(attrs.taToolbarButtonClass)			scope.classes.toolbarButton = attrs.taToolbarButtonClass;
				if(attrs.taToolbarActiveButtonClass)	scope.classes.toolbarButtonActive = attrs.taToolbarActiveButtonClass;
				if(attrs.taFocussedClass)				scope.classes.focussed = attrs.taFocussedClass;

				scope.disabled = true;
				scope.focussed = false;
				scope._$element = element;
				element[0].innerHTML = '';
				element.addClass("ta-toolbar " + scope.classes.toolbar);

				scope.$watch('focussed', function(){
					if(scope.focussed) element.addClass(scope.classes.focussed);
					else element.removeClass(scope.classes.focussed);
				});

				var setupToolElement = function(toolDefinition, toolScope){
					var toolElement;
					if(toolDefinition && toolDefinition.display){
						toolElement = angular.element(toolDefinition.display);
					}
					else toolElement = angular.element("<button type='button'>");

					if(toolDefinition && toolDefinition["class"]) toolElement.addClass(toolDefinition["class"]);
					else toolElement.addClass(scope.classes.toolbarButton);

					toolElement.attr('name', toolScope.name);
					// important to not take focus from the main text/html entry
					toolElement.attr('ta-button', 'ta-button');
					toolElement.attr('ng-disabled', 'isDisabled()');
					toolElement.attr('tabindex', '-1');
					toolElement.attr('ng-click', 'executeAction()');
					toolElement.attr('ng-class', 'displayActiveToolClass(active)');

					if (toolDefinition && toolDefinition.tooltiptext) {
						toolElement.attr('title', toolDefinition.tooltiptext);
					}
					if(toolDefinition && !toolDefinition.display && !toolScope._display){
						// first clear out the current contents if any
						toolElement[0].innerHTML = '';
						// add the buttonText
						if(toolDefinition.buttontext) toolElement[0].innerHTML = toolDefinition.buttontext;
						// add the icon to the front of the button if there is content
						if(toolDefinition.iconclass){
							var icon = angular.element('<i>'), content = toolElement[0].innerHTML;
							icon.addClass(toolDefinition.iconclass);
							toolElement[0].innerHTML = '';
							toolElement.append(icon);
							if(content && content !== '') toolElement.append('&nbsp;' + content);
						}
					}

					toolScope._lastToolDefinition = angular.copy(toolDefinition);

					return $compile(toolElement)(toolScope);
				};

				// Keep a reference for updating the active states later
				scope.tools = {};
				// create the tools in the toolbar
				// default functions and values to prevent errors in testing and on init
				scope._parent = {
					disabled: true,
					showHtml: false,
					queryFormatBlockState: function(){ return false; },
					queryCommandState: function(){ return false; }
				};
				var defaultChildScope = {
					$window: $window,
					$editor: function(){
						// dynamically gets the editor as it is set
						return scope._parent;
					},
					isDisabled: function(){
						// to set your own disabled logic set a function or boolean on the tool called 'disabled'
						return ( // this bracket is important as without it it just returns the first bracket and ignores the rest
							// when the button's disabled function/value evaluates to true
							(typeof this.$eval('disabled') !== 'function' && this.$eval('disabled')) || this.$eval('disabled()') ||
							// all buttons except the HTML Switch button should be disabled in the showHtml (RAW html) mode
							(this.name !== 'html' && this.$editor().showHtml) ||
							// if the toolbar is disabled
							this.$parent.disabled ||
							// if the current editor is disabled
							this.$editor().disabled
						);
					},
					displayActiveToolClass: function(active){
						return (active)? scope.classes.toolbarButtonActive : '';
					},
					executeAction: taToolExecuteAction
				};

				angular.forEach(scope.toolbar, function(group){
					// setup the toolbar group
					var groupElement = angular.element("<div>");
					groupElement.addClass(scope.classes.toolbarGroup);
					angular.forEach(group, function(tool){
						// init and add the tools to the group
						// a tool name (key name from taTools struct)
						//creates a child scope of the main angularText scope and then extends the childScope with the functions of this particular tool
						// reference to the scope and element kept
						scope.tools[tool] = angular.extend(scope.$new(true), taTools[tool], defaultChildScope, {name: tool});
						scope.tools[tool].$element = setupToolElement(taTools[tool], scope.tools[tool]);
						// append the tool compiled with the childScope to the group element
						groupElement.append(scope.tools[tool].$element);
					});
					// append the group to the toolbar
					element.append(groupElement);
				});

				// update a tool
				// if a value is set to null, remove from the display
				// when forceNew is set to true it will ignore all previous settings, used to reset to taTools definition
				// to reset to defaults pass in taTools[key] as _newTool and forceNew as true, ie `updateToolDisplay(key, taTools[key], true);`
				scope.updateToolDisplay = function(key, _newTool, forceNew){
					var toolInstance = scope.tools[key];
					if(toolInstance){
						// get the last toolDefinition, then override with the new definition
						if(toolInstance._lastToolDefinition && !forceNew) _newTool = angular.extend({}, toolInstance._lastToolDefinition, _newTool);
						if(_newTool.buttontext === null && _newTool.iconclass === null && _newTool.display === null)
							throw('textAngular Error: Tool Definition for updating "' + key + '" does not have a valid display/iconclass/buttontext value');

						// if tool is defined on this toolbar, update/redo the tool
						if(_newTool.buttontext === null){
							delete _newTool.buttontext;
						}
						if(_newTool.iconclass === null){
							delete _newTool.iconclass;
						}
						if(_newTool.display === null){
							delete _newTool.display;
						}

						var toolElement = setupToolElement(_newTool, toolInstance);
						toolInstance.$element.replaceWith(toolElement);
						toolInstance.$element = toolElement;
					}
				};

				// we assume here that all values passed are valid and correct
				scope.addTool = function(key, _newTool, groupIndex, index){
					scope.tools[key] = angular.extend(scope.$new(true), taTools[key], defaultChildScope, {name: key});
					scope.tools[key].$element = setupToolElement(taTools[key], scope.tools[key]);
					var group;
					if(groupIndex === undefined) groupIndex = scope.toolbar.length - 1;
					group = angular.element(element.children()[groupIndex]);

					if(index === undefined){
						group.append(scope.tools[key].$element);
						scope.toolbar[groupIndex][scope.toolbar[groupIndex].length - 1] = key;
					}else{
						group.children().eq(index).after(scope.tools[key].$element);
						scope.toolbar[groupIndex][index] = key;
					}
				};

				textAngularManager.registerToolbar(scope);

				scope.$on('$destroy', function(){
					textAngularManager.unregisterToolbar(scope.name);
				});
			}
		};
	}
]);
})();
/**
 * @license AngularJS v1.3.10
 * (c) 2010-2014 Google, Inc. http://angularjs.org
 * License: MIT
 */
(function(window, angular, undefined) {'use strict';

var $sanitizeMinErr = angular.$$minErr('$sanitize');

/**
 * @ngdoc module
 * @name ngSanitize
 * @description
 *
 * # ngSanitize
 *
 * The `ngSanitize` module provides functionality to sanitize HTML.
 *
 *
 * <div doc-module-components="ngSanitize"></div>
 *
 * See {@link ngSanitize.$sanitize `$sanitize`} for usage.
 */

/*
 * HTML Parser By Misko Hevery (misko@hevery.com)
 * based on:  HTML Parser By John Resig (ejohn.org)
 * Original code by Erik Arvidsson, Mozilla Public License
 * http://erik.eae.net/simplehtmlparser/simplehtmlparser.js
 *
 * // Use like so:
 * htmlParser(htmlString, {
 *     start: function(tag, attrs, unary) {},
 *     end: function(tag) {},
 *     chars: function(text) {},
 *     comment: function(text) {}
 * });
 *
 */


/**
 * @ngdoc service
 * @name $sanitize
 * @kind function
 *
 * @description
 *   The input is sanitized by parsing the HTML into tokens. All safe tokens (from a whitelist) are
 *   then serialized back to properly escaped html string. This means that no unsafe input can make
 *   it into the returned string, however, since our parser is more strict than a typical browser
 *   parser, it's possible that some obscure input, which would be recognized as valid HTML by a
 *   browser, won't make it through the sanitizer. The input may also contain SVG markup.
 *   The whitelist is configured using the functions `aHrefSanitizationWhitelist` and
 *   `imgSrcSanitizationWhitelist` of {@link ng.$compileProvider `$compileProvider`}.
 *
 * @param {string} html HTML input.
 * @returns {string} Sanitized HTML.
 *
 * @example
   <example module="sanitizeExample" deps="angular-sanitize.js">
   <file name="index.html">
     <script>
         angular.module('sanitizeExample', ['ngSanitize'])
           .controller('ExampleController', ['$scope', '$sce', function($scope, $sce) {
             $scope.snippet =
               '<p style="color:blue">an html\n' +
               '<em onmouseover="this.textContent=\'PWN3D!\'">click here</em>\n' +
               'snippet</p>';
             $scope.deliberatelyTrustDangerousSnippet = function() {
               return $sce.trustAsHtml($scope.snippet);
             };
           }]);
     </script>
     <div ng-controller="ExampleController">
        Snippet: <textarea ng-model="snippet" cols="60" rows="3"></textarea>
       <table>
         <tr>
           <td>Directive</td>
           <td>How</td>
           <td>Source</td>
           <td>Rendered</td>
         </tr>
         <tr id="bind-html-with-sanitize">
           <td>ng-bind-html</td>
           <td>Automatically uses $sanitize</td>
           <td><pre>&lt;div ng-bind-html="snippet"&gt;<br/>&lt;/div&gt;</pre></td>
           <td><div ng-bind-html="snippet"></div></td>
         </tr>
         <tr id="bind-html-with-trust">
           <td>ng-bind-html</td>
           <td>Bypass $sanitize by explicitly trusting the dangerous value</td>
           <td>
           <pre>&lt;div ng-bind-html="deliberatelyTrustDangerousSnippet()"&gt;
&lt;/div&gt;</pre>
           </td>
           <td><div ng-bind-html="deliberatelyTrustDangerousSnippet()"></div></td>
         </tr>
         <tr id="bind-default">
           <td>ng-bind</td>
           <td>Automatically escapes</td>
           <td><pre>&lt;div ng-bind="snippet"&gt;<br/>&lt;/div&gt;</pre></td>
           <td><div ng-bind="snippet"></div></td>
         </tr>
       </table>
       </div>
   </file>
   <file name="protractor.js" type="protractor">
     it('should sanitize the html snippet by default', function() {
       expect(element(by.css('#bind-html-with-sanitize div')).getInnerHtml()).
         toBe('<p>an html\n<em>click here</em>\nsnippet</p>');
     });

     it('should inline raw snippet if bound to a trusted value', function() {
       expect(element(by.css('#bind-html-with-trust div')).getInnerHtml()).
         toBe("<p style=\"color:blue\">an html\n" +
              "<em onmouseover=\"this.textContent='PWN3D!'\">click here</em>\n" +
              "snippet</p>");
     });

     it('should escape snippet without any filter', function() {
       expect(element(by.css('#bind-default div')).getInnerHtml()).
         toBe("&lt;p style=\"color:blue\"&gt;an html\n" +
              "&lt;em onmouseover=\"this.textContent='PWN3D!'\"&gt;click here&lt;/em&gt;\n" +
              "snippet&lt;/p&gt;");
     });

     it('should update', function() {
       element(by.model('snippet')).clear();
       element(by.model('snippet')).sendKeys('new <b onclick="alert(1)">text</b>');
       expect(element(by.css('#bind-html-with-sanitize div')).getInnerHtml()).
         toBe('new <b>text</b>');
       expect(element(by.css('#bind-html-with-trust div')).getInnerHtml()).toBe(
         'new <b onclick="alert(1)">text</b>');
       expect(element(by.css('#bind-default div')).getInnerHtml()).toBe(
         "new &lt;b onclick=\"alert(1)\"&gt;text&lt;/b&gt;");
     });
   </file>
   </example>
 */
function $SanitizeProvider() {
  this.$get = ['$$sanitizeUri', function($$sanitizeUri) {
    return function(html) {
      if (typeof arguments[1] != 'undefined') {
        arguments[1].version = 'taSanitize';
      }
      var buf = [];
      htmlParser(html, htmlSanitizeWriter(buf, function(uri, isImage) {
        return !/^unsafe/.test($$sanitizeUri(uri, isImage));
      }));
      return buf.join('');
    };
  }];
}

function sanitizeText(chars) {
  var buf = [];
  var writer = htmlSanitizeWriter(buf, angular.noop);
  writer.chars(chars);
  return buf.join('');
}


// Regular Expressions for parsing tags and attributes
var START_TAG_REGEXP =
       /^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,
  END_TAG_REGEXP = /^<\/\s*([\w:-]+)[^>]*>/,
  ATTR_REGEXP = /([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,
  BEGIN_TAG_REGEXP = /^</,
  BEGING_END_TAGE_REGEXP = /^<\//,
  COMMENT_REGEXP = /<!--(.*?)-->/g,
  SINGLE_COMMENT_REGEXP = /(^<!--.*?-->)/,
  DOCTYPE_REGEXP = /<!DOCTYPE([^>]*?)>/i,
  CDATA_REGEXP = /<!\[CDATA\[(.*?)]]>/g,
  SURROGATE_PAIR_REGEXP = /[\uD800-\uDBFF][\uDC00-\uDFFF]/g,
  // Match everything outside of normal chars and " (quote character)
  NON_ALPHANUMERIC_REGEXP = /([^\#-~| |!])/g,
  WHITE_SPACE_REGEXP = /^(\s+)/;


// Good source of info about elements and attributes
// http://dev.w3.org/html5/spec/Overview.html#semantics
// http://simon.html5.org/html-elements

// Safe Void Elements - HTML5
// http://dev.w3.org/html5/spec/Overview.html#void-elements
var voidElements = makeMap("area,br,col,hr,img,wbr,input");

// Elements that you can, intentionally, leave open (and which close themselves)
// http://dev.w3.org/html5/spec/Overview.html#optional-tags
var optionalEndTagBlockElements = makeMap("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),
    optionalEndTagInlineElements = makeMap("rp,rt"),
    optionalEndTagElements = angular.extend({},
                                            optionalEndTagInlineElements,
                                            optionalEndTagBlockElements);

// Safe Block Elements - HTML5
var blockElements = angular.extend({}, optionalEndTagBlockElements, makeMap("address,article," +
        "aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5," +
        "h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul"));

// Inline Elements - HTML5
var inlineElements = angular.extend({}, optionalEndTagInlineElements, makeMap("a,abbr,acronym,b," +
        "bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s," +
        "samp,small,span,strike,strong,sub,sup,time,tt,u,var"));

// SVG Elements
// https://wiki.whatwg.org/wiki/Sanitization_rules#svg_Elements
var svgElements = makeMap("animate,animateColor,animateMotion,animateTransform,circle,defs," +
        "desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient," +
        "line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set," +
        "stop,svg,switch,text,title,tspan,use");

// Special Elements (can contain anything)
var specialElements = makeMap("script,style");

var validElements = angular.extend({},
                                   voidElements,
                                   blockElements,
                                   inlineElements,
                                   optionalEndTagElements,
                                   svgElements);

//Attributes that have href and hence need to be sanitized
var uriAttrs = makeMap("background,cite,href,longdesc,src,usemap,xlink:href");

var htmlAttrs = makeMap('abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,'+
    'color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,'+
    'id,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,'+
    'scope,scrolling,shape,size,span,start,summary,target,title,type,'+
    'valign,value,vspace,width');

// SVG attributes (without "id" and "name" attributes)
// https://wiki.whatwg.org/wiki/Sanitization_rules#svg_Attributes
var svgAttrs = makeMap('accent-height,accumulate,additive,alphabetic,arabic-form,ascent,' +
    'attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,' +
    'color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,' +
    'font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,' +
    'gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,' +
    'keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,' +
    'markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,' +
    'overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,' +
    'repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,' +
    'stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,' +
    'stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,' +
    'stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,' +
    'underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,' +
    'viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,' +
    'xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,' +
    'zoomAndPan');

var validAttrs = angular.extend({},
                                uriAttrs,
                                svgAttrs,
                                htmlAttrs);

function makeMap(str) {
  var obj = {}, items = str.split(','), i;
  for (i = 0; i < items.length; i++) obj[items[i]] = true;
  return obj;
}


/**
 * @example
 * htmlParser(htmlString, {
 *     start: function(tag, attrs, unary) {},
 *     end: function(tag) {},
 *     chars: function(text) {},
 *     comment: function(text) {}
 * });
 *
 * @param {string} html string
 * @param {object} handler
 */
function htmlParser(html, handler) {
  if (typeof html !== 'string') {
    if (html === null || typeof html === 'undefined') {
      html = '';
    } else {
      html = '' + html;
    }
  }
  var index, chars, match, stack = [], last = html, text;
  stack.last = function() { return stack[ stack.length - 1 ]; };

  while (html) {
    text = '';
    chars = true;

    // Make sure we're not in a script or style element
    if (!stack.last() || !specialElements[ stack.last() ]) {

      // White space
      if (WHITE_SPACE_REGEXP.test(html)) {
        match = html.match(WHITE_SPACE_REGEXP);

        if (match) {
          var mat = match[0];
          if (handler.whitespace) handler.whitespace(match[0]);
          html = html.replace(match[0], '');
          chars = false;
        }
      //Comment
      } else if (SINGLE_COMMENT_REGEXP.test(html)) {
        match = html.match(SINGLE_COMMENT_REGEXP);

        if (match) {
          if (handler.comment) handler.comment(match[1]);
          html = html.replace(match[0], '');
          chars = false;
        }
      // DOCTYPE
      } else if (DOCTYPE_REGEXP.test(html)) {
        match = html.match(DOCTYPE_REGEXP);

        if (match) {
          html = html.replace(match[0], '');
          chars = false;
        }
      // end tag
      } else if (BEGING_END_TAGE_REGEXP.test(html)) {
        match = html.match(END_TAG_REGEXP);

        if (match) {
          html = html.substring(match[0].length);
          match[0].replace(END_TAG_REGEXP, parseEndTag);
          chars = false;
        }

      // start tag
      } else if (BEGIN_TAG_REGEXP.test(html)) {
        match = html.match(START_TAG_REGEXP);

        if (match) {
          // We only have a valid start-tag if there is a '>'.
          if (match[4]) {
            html = html.substring(match[0].length);
            match[0].replace(START_TAG_REGEXP, parseStartTag);
          }
          chars = false;
        } else {
          // no ending tag found --- this piece should be encoded as an entity.
          text += '<';
          html = html.substring(1);
        }
      }

      if (chars) {
        index = html.indexOf("<");

        text += index < 0 ? html : html.substring(0, index);
        html = index < 0 ? "" : html.substring(index);

        if (handler.chars) handler.chars(decodeEntities(text));
      }

    } else {
      html = html.replace(new RegExp("([^]*)<\\s*\\/\\s*" + stack.last() + "[^>]*>", 'i'),
        function(all, text) {
          text = text.replace(COMMENT_REGEXP, "$1").replace(CDATA_REGEXP, "$1");

          if (handler.chars) handler.chars(decodeEntities(text));

          return "";
      });

      parseEndTag("", stack.last());
    }

    if (html == last) {
      throw $sanitizeMinErr('badparse', "The sanitizer was unable to parse the following block " +
                                        "of html: {0}", html);
    }
    last = html;
  }

  // Clean up any remaining tags
  parseEndTag();

  function parseStartTag(tag, tagName, rest, unary) {
    tagName = angular.lowercase(tagName);
    if (blockElements[ tagName ]) {
      while (stack.last() && inlineElements[ stack.last() ]) {
        parseEndTag("", stack.last());
      }
    }

    if (optionalEndTagElements[ tagName ] && stack.last() == tagName) {
      parseEndTag("", tagName);
    }

    unary = voidElements[ tagName ] || !!unary;

    if (!unary)
      stack.push(tagName);

    var attrs = {};

    rest.replace(ATTR_REGEXP,
      function(match, name, doubleQuotedValue, singleQuotedValue, unquotedValue) {
        var value = doubleQuotedValue
          || singleQuotedValue
          || unquotedValue
          || '';

        attrs[name] = decodeEntities(value);
    });
    if (handler.start) handler.start(tagName, attrs, unary);
  }

  function parseEndTag(tag, tagName) {
    var pos = 0, i;
    tagName = angular.lowercase(tagName);
    if (tagName)
      // Find the closest opened tag of the same type
      for (pos = stack.length - 1; pos >= 0; pos--)
        if (stack[ pos ] == tagName)
          break;

    if (pos >= 0) {
      // Close all the open elements, up the stack
      for (i = stack.length - 1; i >= pos; i--)
        if (handler.end) handler.end(stack[ i ]);

      // Remove the open elements from the stack
      stack.length = pos;
    }
  }
}

var hiddenPre=document.createElement("pre");
var spaceRe = /^(\s*)([\s\S]*?)(\s*)$/;
/**
 * decodes all entities into regular string
 * @param value
 * @returns {string} A string with decoded entities.
 */
function decodeEntities(value) {
  if (!value) { return ''; }

  // Note: IE8 does not preserve spaces at the start/end of innerHTML
  // so we must capture them and reattach them afterward
  var parts = spaceRe.exec(value);
  var spaceBefore = parts[1];
  var spaceAfter = parts[3];
  var content = parts[2];
  if (content) {
    hiddenPre.innerHTML=content.replace(/</g,"&lt;");
    // innerText depends on styling as it doesn't display hidden elements.
    // Therefore, it's better to use textContent not to cause unnecessary
    // reflows. However, IE<9 don't support textContent so the innerText
    // fallback is necessary.
    content = 'textContent' in hiddenPre ?
      hiddenPre.textContent : hiddenPre.innerText;
  }
  return spaceBefore + content + spaceAfter;
}

/**
 * Escapes all potentially dangerous characters, so that the
 * resulting string can be safely inserted into attribute or
 * element text.
 * @param value
 * @returns {string} escaped text
 */
function encodeEntities(value) {
  return value.
    replace(/&/g, '&amp;').
    replace(SURROGATE_PAIR_REGEXP, function(value) {
      var hi = value.charCodeAt(0);
      var low = value.charCodeAt(1);
      return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';
    }).
    replace(NON_ALPHANUMERIC_REGEXP, function(value) {
      // unsafe chars are: \u0000-\u001f \u007f-\u009f \u00ad \u0600-\u0604 \u070f \u17b4 \u17b5 \u200c-\u200f \u2028-\u202f \u2060-\u206f \ufeff \ufff0-\uffff from jslint.com/lint.html
      // decimal values are: 0-31, 127-159, 173, 1536-1540, 1807, 6068, 6069, 8204-8207, 8232-8239, 8288-8303, 65279, 65520-65535
      var c = value.charCodeAt(0);
      // if unsafe character encode
      if(c <= 159 ||
        c == 173 ||
        (c >= 1536 && c <= 1540) ||
        c == 1807 ||
        c == 6068 ||
        c == 6069 ||
        (c >= 8204 && c <= 8207) ||
        (c >= 8232 && c <= 8239) ||
        (c >= 8288 && c <= 8303) ||
        c == 65279 ||
        (c >= 65520 && c <= 65535)) return '&#' + c + ';';
      return value; // avoids multilingual issues
    }).
    replace(/</g, '&lt;').
    replace(/>/g, '&gt;');
}

var trim = (function() {
  // native trim is way faster: http://jsperf.com/angular-trim-test
  // but IE doesn't have it... :-(
  // TODO: we should move this into IE/ES5 polyfill
  if (!String.prototype.trim) {
    return function(value) {
      return angular.isString(value) ? value.replace(/^\s\s*/, '').replace(/\s\s*$/, '') : value;
    };
  }
  return function(value) {
    return angular.isString(value) ? value.trim() : value;
  };
})();

// Custom logic for accepting certain style options only - textAngular
// Currently allows only the color, background-color, text-align, float, width and height attributes
// all other attributes should be easily done through classes.
function validStyles(styleAttr){
	var result = '';
	var styleArray = styleAttr.split(';');
	angular.forEach(styleArray, function(value){
		var v = value.split(':');
		if(v.length == 2){
			var key = trim(angular.lowercase(v[0]));
			var value = trim(angular.lowercase(v[1]));
			if(
				(key === 'color' || key === 'background-color') && (
					value.match(/^rgb\([0-9%,\. ]*\)$/i)
					|| value.match(/^rgba\([0-9%,\. ]*\)$/i)
					|| value.match(/^hsl\([0-9%,\. ]*\)$/i)
					|| value.match(/^hsla\([0-9%,\. ]*\)$/i)
					|| value.match(/^#[0-9a-f]{3,6}$/i)
					|| value.match(/^[a-z]*$/i)
				)
			||
				key === 'text-align' && (
					value === 'left'
					|| value === 'right'
					|| value === 'center'
					|| value === 'justify'
				)
			||
				key === 'float' && (
					value === 'left'
					|| value === 'right'
					|| value === 'none'
				)
			||
				(key === 'width' || key === 'height') && (
					value.match(/[0-9\.]*(px|em|rem|%)/)
				)
			|| // Reference #520
				(key === 'direction' && value.match(/^ltr|rtl|initial|inherit$/))
			) result += key + ': ' + value + ';';
		}
	});
	return result;
}

// this function is used to manually allow specific attributes on specific tags with certain prerequisites
function validCustomTag(tag, attrs, lkey, value){
	// catch the div placeholder for the iframe replacement
    if (tag === 'img' && attrs['ta-insert-video']){
        if(lkey === 'ta-insert-video' || lkey === 'allowfullscreen' || lkey === 'frameborder' || (lkey === 'contenteditable' && value === 'false')) return true;
    }
    return false;
}

/**
 * create an HTML/XML writer which writes to buffer
 * @param {Array} buf use buf.jain('') to get out sanitized html string
 * @returns {object} in the form of {
 *     start: function(tag, attrs, unary) {},
 *     end: function(tag) {},
 *     chars: function(text) {},
 *     comment: function(text) {}
 * }
 */
function htmlSanitizeWriter(buf, uriValidator) {
  var ignore = false;
  var out = angular.bind(buf, buf.push);
  return {
    start: function(tag, attrs, unary) {
      tag = angular.lowercase(tag);
      if (!ignore && specialElements[tag]) {
        ignore = tag;
      }
      if (!ignore && validElements[tag] === true) {
        out('<');
        out(tag);
        angular.forEach(attrs, function(value, key) {
          var lkey=angular.lowercase(key);
          var isImage=(tag === 'img' && lkey === 'src') || (lkey === 'background');
          if ((lkey === 'style' && (value = validStyles(value)) !== '') || validCustomTag(tag, attrs, lkey, value) || validAttrs[lkey] === true &&
            (uriAttrs[lkey] !== true || uriValidator(value, isImage))) {
            out(' ');
            out(key);
            out('="');
            out(encodeEntities(value));
            out('"');
          }
        });
        out(unary ? '/>' : '>');
      }
    },
    comment: function (com) {
      out(com);
    },
    whitespace: function (ws) {
      out(encodeEntities(ws));
    },
    end: function(tag) {
        tag = angular.lowercase(tag);
        if (!ignore && validElements[tag] === true) {
          out('</');
          out(tag);
          out('>');
        }
        if (tag == ignore) {
          ignore = false;
        }
      },
    chars: function(chars) {
        if (!ignore) {
          out(encodeEntities(chars));
        }
      }
  };
}


// define ngSanitize module and register $sanitize service
angular.module('ngSanitize', []).provider('$sanitize', $SanitizeProvider);

/* global sanitizeText: false */

/**
 * @ngdoc filter
 * @name linky
 * @kind function
 *
 * @description
 * Finds links in text input and turns them into html links. Supports http/https/ftp/mailto and
 * plain email address links.
 *
 * Requires the {@link ngSanitize `ngSanitize`} module to be installed.
 *
 * @param {string} text Input text.
 * @param {string} target Window (_blank|_self|_parent|_top) or named frame to open links in.
 * @returns {string} Html-linkified text.
 *
 * @usage
   <span ng-bind-html="linky_expression | linky"></span>
 *
 * @example
   <example module="linkyExample" deps="angular-sanitize.js">
     <file name="index.html">
       <script>
         angular.module('linkyExample', ['ngSanitize'])
           .controller('ExampleController', ['$scope', function($scope) {
             $scope.snippet =
               'Pretty text with some links:\n'+
               'http://angularjs.org/,\n'+
               'mailto:us@somewhere.org,\n'+
               'another@somewhere.org,\n'+
               'and one more: ftp://127.0.0.1/.';
             $scope.snippetWithTarget = 'http://angularjs.org/';
           }]);
       </script>
       <div ng-controller="ExampleController">
       Snippet: <textarea ng-model="snippet" cols="60" rows="3"></textarea>
       <table>
         <tr>
           <td>Filter</td>
           <td>Source</td>
           <td>Rendered</td>
         </tr>
         <tr id="linky-filter">
           <td>linky filter</td>
           <td>
             <pre>&lt;div ng-bind-html="snippet | linky"&gt;<br>&lt;/div&gt;</pre>
           </td>
           <td>
             <div ng-bind-html="snippet | linky"></div>
           </td>
         </tr>
         <tr id="linky-target">
          <td>linky target</td>
          <td>
            <pre>&lt;div ng-bind-html="snippetWithTarget | linky:'_blank'"&gt;<br>&lt;/div&gt;</pre>
          </td>
          <td>
            <div ng-bind-html="snippetWithTarget | linky:'_blank'"></div>
          </td>
         </tr>
         <tr id="escaped-html">
           <td>no filter</td>
           <td><pre>&lt;div ng-bind="snippet"&gt;<br>&lt;/div&gt;</pre></td>
           <td><div ng-bind="snippet"></div></td>
         </tr>
       </table>
     </file>
     <file name="protractor.js" type="protractor">
       it('should linkify the snippet with urls', function() {
         expect(element(by.id('linky-filter')).element(by.binding('snippet | linky')).getText()).
             toBe('Pretty text with some links: http://angularjs.org/, us@somewhere.org, ' +
                  'another@somewhere.org, and one more: ftp://127.0.0.1/.');
         expect(element.all(by.css('#linky-filter a')).count()).toEqual(4);
       });

       it('should not linkify snippet without the linky filter', function() {
         expect(element(by.id('escaped-html')).element(by.binding('snippet')).getText()).
             toBe('Pretty text with some links: http://angularjs.org/, mailto:us@somewhere.org, ' +
                  'another@somewhere.org, and one more: ftp://127.0.0.1/.');
         expect(element.all(by.css('#escaped-html a')).count()).toEqual(0);
       });

       it('should update', function() {
         element(by.model('snippet')).clear();
         element(by.model('snippet')).sendKeys('new http://link.');
         expect(element(by.id('linky-filter')).element(by.binding('snippet | linky')).getText()).
             toBe('new http://link.');
         expect(element.all(by.css('#linky-filter a')).count()).toEqual(1);
         expect(element(by.id('escaped-html')).element(by.binding('snippet')).getText())
             .toBe('new http://link.');
       });

       it('should work with the target property', function() {
        expect(element(by.id('linky-target')).
            element(by.binding("snippetWithTarget | linky:'_blank'")).getText()).
            toBe('http://angularjs.org/');
        expect(element(by.css('#linky-target a')).getAttribute('target')).toEqual('_blank');
       });
     </file>
   </example>
 */
angular.module('ngSanitize').filter('linky', ['$sanitize', function($sanitize) {
  var LINKY_URL_REGEXP =
        /((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"”’]/,
      MAILTO_REGEXP = /^mailto:/;

  return function(text, target) {
    if (!text) return text;
    var match;
    var raw = text;
    var html = [];
    var url;
    var i;
    while ((match = raw.match(LINKY_URL_REGEXP))) {
      // We can not end in these as they are sometimes found at the end of the sentence
      url = match[0];
      // if we did not match ftp/http/www/mailto then assume mailto
      if (!match[2] && !match[4]) {
        url = (match[3] ? 'http://' : 'mailto:') + url;
      }
      i = match.index;
      addText(raw.substr(0, i));
      addLink(url, match[0].replace(MAILTO_REGEXP, ''));
      raw = raw.substring(i + match[0].length);
    }
    addText(raw);
    return $sanitize(html.join(''));

    function addText(text) {
      if (!text) {
        return;
      }
      html.push(sanitizeText(text));
    }

    function addLink(url, text) {
      html.push('<a ');
      if (angular.isDefined(target)) {
        html.push('target="',
                  target,
                  '" ');
      }
      html.push('href="',
                url.replace(/"/g, '&quot;'),
                '">');
      addText(text);
      html.push('</a>');
    }
  };
}]);


})(window, window.angular);


// tests against the current jqLite/jquery implementation if this can be an element
function validElementString(string){
	try{
		return angular.element(string).length !== 0;
	}catch(any){
		return false;
	}
}
// setup the global contstant functions for setting up the toolbar

// all tool definitions
var taTools = {};
/*
	A tool definition is an object with the following key/value parameters:
		action: [function(deferred, restoreSelection)]
				a function that is executed on clicking on the button - this will allways be executed using ng-click and will
				overwrite any ng-click value in the display attribute.
				The function is passed a deferred object ($q.defer()), if this is wanted to be used `return false;` from the action and
				manually call `deferred.resolve();` elsewhere to notify the editor that the action has finished.
				restoreSelection is only defined if the rangy library is included and it can be called as `restoreSelection()` to restore the users
				selection in the WYSIWYG editor.
		display: [string]?
				Optional, an HTML element to be displayed as the button. The `scope` of the button is the tool definition object with some additional functions
				If set this will cause buttontext and iconclass to be ignored
		class: [string]?
				Optional, if set will override the taOptions.classes.toolbarButton class.
		buttontext: [string]?
				if this is defined it will replace the contents of the element contained in the `display` element
		iconclass: [string]?
				if this is defined an icon (<i>) will be appended to the `display` element with this string as it's class
		tooltiptext: [string]?
				Optional, a plain text description of the action, used for the title attribute of the action button in the toolbar by default.
		activestate: [function(commonElement)]?
				this function is called on every caret movement, if it returns true then the class taOptions.classes.toolbarButtonActive
				will be applied to the `display` element, else the class will be removed
		disabled: [function()]?
				if this function returns true then the tool will have the class taOptions.classes.disabled applied to it, else it will be removed
	Other functions available on the scope are:
		name: [string]
				the name of the tool, this is the first parameter passed into taRegisterTool
		isDisabled: [function()]
				returns true if the tool is disabled, false if it isn't
		displayActiveToolClass: [function(boolean)]
				returns true if the tool is 'active' in the currently focussed toolbar
		onElementSelect: [Object]
				This object contains the following key/value pairs and is used to trigger the ta-element-select event
				element: [String]
					an element name, will only trigger the onElementSelect action if the tagName of the element matches this string
				filter: [function(element)]?
					an optional filter that returns a boolean, if true it will trigger the onElementSelect.
				action: [function(event, element, editorScope)]
					the action that should be executed if the onElementSelect function runs
*/
// name and toolDefinition to add into the tools available to be added on the toolbar
function registerTextAngularTool(name, toolDefinition){
	if(!name || name === '' || taTools.hasOwnProperty(name)) throw('textAngular Error: A unique name is required for a Tool Definition');
	if(
		(toolDefinition.display && (toolDefinition.display === '' || !validElementString(toolDefinition.display))) ||
		(!toolDefinition.display && !toolDefinition.buttontext && !toolDefinition.iconclass)
	)
		throw('textAngular Error: Tool Definition for "' + name + '" does not have a valid display/iconclass/buttontext value');
	taTools[name] = toolDefinition;
}

angular.module('textAngularSetup', [])
.constant('taRegisterTool', registerTextAngularTool)
.value('taTools', taTools)
// Here we set up the global display defaults, to set your own use a angular $provider#decorator.
.value('taOptions',  {
	//////////////////////////////////////////////////////////////////////////////////////
    // forceTextAngularSanitize
    // set false to allow the textAngular-sanitize provider to be replaced
    // with angular-sanitize or a custom provider.
	forceTextAngularSanitize: true,
	///////////////////////////////////////////////////////////////////////////////////////
	// keyMappings
	// allow customizable keyMappings for specialized key boards or languages
	//
	// keyMappings provides key mappings that are attached to a given commandKeyCode.
	// To modify a specific keyboard binding, simply provide function which returns true
	// for the event you wish to map to.
	// Or to disable a specific keyboard binding, provide a function which returns false.
	// Note: 'RedoKey' and 'UndoKey' are internally bound to the redo and undo functionality.
	// At present, the following commandKeyCodes are in use:
	// 98, 'TabKey', 'ShiftTabKey', 105, 117, 'UndoKey', 'RedoKey'
	//
	// To map to an new commandKeyCode, add a new key mapping such as:
	// {commandKeyCode: 'CustomKey', testForKey: function (event) {
	//  if (event.keyCode=57 && event.ctrlKey && !event.shiftKey && !event.altKey) return true;
	// } }
	// to the keyMappings. This example maps ctrl+9 to 'CustomKey'
	// Then where taRegisterTool(...) is called, add a commandKeyCode: 'CustomKey' and your
	// tool will be bound to ctrl+9.
	//
	// To disble one of the already bound commandKeyCodes such as 'RedoKey' or 'UndoKey' add:
	// {commandKeyCode: 'RedoKey', testForKey: function (event) { return false; } },
	// {commandKeyCode: 'UndoKey', testForKey: function (event) { return false; } },
	// to disable them.
	//
	keyMappings : [],
	toolbar: [
		['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'pre', 'quote'],
		['bold', 'italics', 'underline', 'strikeThrough', 'ul', 'ol', 'redo', 'undo', 'clear'],
		['justifyLeft','justifyCenter','justifyRight','justifyFull','indent','outdent'],
		['html', 'insertImage', 'insertLink', 'insertVideo', 'wordcount', 'charcount']
	],
	classes: {
		focussed: "focussed",
		toolbar: "btn-toolbar",
		toolbarGroup: "btn-group",
		toolbarButton: "btn btn-default",
		toolbarButtonActive: "active",
		disabled: "disabled",
		textEditor: 'form-control',
		htmlEditor: 'form-control'
	},
	defaultTagAttributes : {
		a: {target:""}
	},
	setup: {
		// wysiwyg mode
		textEditorSetup: function($element){ /* Do some processing here */ },
		// raw html
		htmlEditorSetup: function($element){ /* Do some processing here */ }
	},
	defaultFileDropHandler:
		/* istanbul ignore next: untestable image processing */
		function(file, insertAction){
			var reader = new FileReader();
			if(file.type.substring(0, 5) === 'image'){
				reader.onload = function() {
					if(reader.result !== '') insertAction('insertImage', reader.result, true);
				};

				reader.readAsDataURL(file);
				// NOTE: For async procedures return a promise and resolve it when the editor should update the model.
				return true;
			}
			return false;
		}
})

// This is the element selector string that is used to catch click events within a taBind, prevents the default and $emits a 'ta-element-select' event
// these are individually used in an angular.element().find() call. What can go here depends on whether you have full jQuery loaded or just jQLite with angularjs.
// div is only used as div.ta-insert-video caught in filter.
.value('taSelectableElements', ['a','img'])

// This is an array of objects with the following options:
//				selector: <string> a jqLite or jQuery selector string
//				customAttribute: <string> an attribute to search for
//				renderLogic: <function(element)>
// Both or one of selector and customAttribute must be defined.
.value('taCustomRenderers', [
	{
		// Parse back out: '<div class="ta-insert-video" ta-insert-video src="' + urlLink + '" allowfullscreen="true" width="300" frameborder="0" height="250"></div>'
		// To correct video element. For now only support youtube
		selector: 'img',
		customAttribute: 'ta-insert-video',
		renderLogic: function(element){
			var iframe = angular.element('<iframe></iframe>');
			var attributes = element.prop("attributes");
			// loop through element attributes and apply them on iframe
			angular.forEach(attributes, function(attr) {
				iframe.attr(attr.name, attr.value);
			});
			iframe.attr('src', iframe.attr('ta-insert-video'));
			element.replaceWith(iframe);
		}
	}
])

.value('taTranslations', {
	// moved to sub-elements
	//toggleHTML: "Toggle HTML",
	//insertImage: "Please enter a image URL to insert",
	//insertLink: "Please enter a URL to insert",
	//insertVideo: "Please enter a youtube URL to embed",
	html: {
		tooltip: 'Toggle html / Rich Text'
	},
	// tooltip for heading - might be worth splitting
	heading: {
		tooltip: 'Heading '
	},
	p: {
		tooltip: 'Paragraph'
	},
	pre: {
		tooltip: 'Preformatted text'
	},
	ul: {
		tooltip: 'Unordered List'
	},
	ol: {
		tooltip: 'Ordered List'
	},
	quote: {
		tooltip: 'Quote/unquote selection or paragraph'
	},
	undo: {
		tooltip: 'Undo'
	},
	redo: {
		tooltip: 'Redo'
	},
	bold: {
		tooltip: 'Bold'
	},
	italic: {
		tooltip: 'Italic'
	},
	underline: {
		tooltip: 'Underline'
	},
	strikeThrough:{
		tooltip: 'Strikethrough'
	},
	justifyLeft: {
		tooltip: 'Align text left'
	},
	justifyRight: {
		tooltip: 'Align text right'
	},
	justifyFull: {
		tooltip: 'Justify text'
	},
	justifyCenter: {
		tooltip: 'Center'
	},
	indent: {
		tooltip: 'Increase indent'
	},
	outdent: {
		tooltip: 'Decrease indent'
	},
	clear: {
		tooltip: 'Clear formatting'
	},
	insertImage: {
		dialogPrompt: 'Please enter an image URL to insert',
		tooltip: 'Insert image',
		hotkey: 'the - possibly language dependent hotkey ... for some future implementation'
	},
	insertVideo: {
		tooltip: 'Insert video',
		dialogPrompt: 'Please enter a youtube URL to embed'
	},
	insertLink: {
		tooltip: 'Insert / edit link',
		dialogPrompt: "Please enter a URL to insert"
	},
	editLink: {
		reLinkButton: {
			tooltip: "Relink"
		},
		unLinkButton: {
			tooltip: "Unlink"
		},
		targetToggle: {
			buttontext: "Open in New Window"
		}
	},
	wordcount: {
		tooltip: 'Display words Count'
	},
		charcount: {
		tooltip: 'Display characters Count'
	}
})
.factory('taToolFunctions', ['$window','taTranslations', function($window, taTranslations) {
	return {
		imgOnSelectAction: function(event, $element, editorScope){
			// setup the editor toolbar
			// Credit to the work at http://hackerwins.github.io/summernote/ for this editbar logic/display
			var finishEdit = function(){
				editorScope.updateTaBindtaTextElement();
				editorScope.hidePopover();
			};
			event.preventDefault();
			editorScope.displayElements.popover.css('width', '375px');
			var container = editorScope.displayElements.popoverContainer;
			container.empty();
			var buttonGroup = angular.element('<div class="btn-group" style="padding-right: 6px;">');
			var fullButton = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');
			fullButton.on('click', function(event){
				event.preventDefault();
				$element.css({
					'width': '100%',
					'height': ''
				});
				finishEdit();
			});
			var halfButton = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');
			halfButton.on('click', function(event){
				event.preventDefault();
				$element.css({
					'width': '50%',
					'height': ''
				});
				finishEdit();
			});
			var quartButton = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');
			quartButton.on('click', function(event){
				event.preventDefault();
				$element.css({
					'width': '25%',
					'height': ''
				});
				finishEdit();
			});
			var resetButton = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');
			resetButton.on('click', function(event){
				event.preventDefault();
				$element.css({
					width: '',
					height: ''
				});
				finishEdit();
			});
			buttonGroup.append(fullButton);
			buttonGroup.append(halfButton);
			buttonGroup.append(quartButton);
			buttonGroup.append(resetButton);
			container.append(buttonGroup);

			buttonGroup = angular.element('<div class="btn-group" style="padding-right: 6px;">');
			var floatLeft = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');
			floatLeft.on('click', function(event){
				event.preventDefault();
				// webkit
				$element.css('float', 'left');
				// firefox
				$element.css('cssFloat', 'left');
				// IE < 8
				$element.css('styleFloat', 'left');
				finishEdit();
			});
			var floatRight = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');
			floatRight.on('click', function(event){
				event.preventDefault();
				// webkit
				$element.css('float', 'right');
				// firefox
				$element.css('cssFloat', 'right');
				// IE < 8
				$element.css('styleFloat', 'right');
				finishEdit();
			});
			var floatNone = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');
			floatNone.on('click', function(event){
				event.preventDefault();
				// webkit
				$element.css('float', '');
				// firefox
				$element.css('cssFloat', '');
				// IE < 8
				$element.css('styleFloat', '');
				finishEdit();
			});
			buttonGroup.append(floatLeft);
			buttonGroup.append(floatNone);
			buttonGroup.append(floatRight);
			container.append(buttonGroup);

			buttonGroup = angular.element('<div class="btn-group">');
			var remove = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');
			remove.on('click', function(event){
				event.preventDefault();
				$element.remove();
				finishEdit();
			});
			buttonGroup.append(remove);
			container.append(buttonGroup);

			editorScope.showPopover($element);
			editorScope.showResizeOverlay($element);
		},
		aOnSelectAction: function(event, $element, editorScope){
			// setup the editor toolbar
			// Credit to the work at http://hackerwins.github.io/summernote/ for this editbar logic
			event.preventDefault();
			editorScope.displayElements.popover.css('width', '436px');
			var container = editorScope.displayElements.popoverContainer;
			container.empty();
			container.css('line-height', '28px');
			var link = angular.element('<a href="' + $element.attr('href') + '" target="_blank">' + $element.attr('href') + '</a>');
			link.css({
				'display': 'inline-block',
				'max-width': '200px',
				'overflow': 'hidden',
				'text-overflow': 'ellipsis',
				'white-space': 'nowrap',
				'vertical-align': 'middle'
			});
			container.append(link);
			var buttonGroup = angular.element('<div class="btn-group pull-right">');
			var reLinkButton = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="' + taTranslations.editLink.reLinkButton.tooltip + '"><i class="fa fa-edit icon-edit"></i></button>');
			reLinkButton.on('click', function(event){
				event.preventDefault();
				var urlLink = $window.prompt(taTranslations.insertLink.dialogPrompt, $element.attr('href'));
				if(urlLink && urlLink !== '' && urlLink !== 'http://'){
					$element.attr('href', urlLink);
					editorScope.updateTaBindtaTextElement();
				}
				editorScope.hidePopover();
			});
			buttonGroup.append(reLinkButton);
			var unLinkButton = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="' + taTranslations.editLink.unLinkButton.tooltip + '"><i class="fa fa-unlink icon-unlink"></i></button>');
			// directly before this click event is fired a digest is fired off whereby the reference to $element is orphaned off
			unLinkButton.on('click', function(event){
				event.preventDefault();
				$element.replaceWith($element.contents());
				editorScope.updateTaBindtaTextElement();
				editorScope.hidePopover();
			});
			buttonGroup.append(unLinkButton);
			var targetToggle = angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">' + taTranslations.editLink.targetToggle.buttontext + '</button>');
			if($element.attr('target') === '_blank'){
				targetToggle.addClass('active');
			}
			targetToggle.on('click', function(event){
				event.preventDefault();
				$element.attr('target', ($element.attr('target') === '_blank') ? '' : '_blank');
				targetToggle.toggleClass('active');
				editorScope.updateTaBindtaTextElement();
			});
			buttonGroup.append(targetToggle);
			container.append(buttonGroup);
			editorScope.showPopover($element);
		},
		extractYoutubeVideoId: function(url) {
			var re = /(?:youtube(?:-nocookie)?\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/i;
			var match = url.match(re);
			return (match && match[1]) || null;
		}
	};
}])
.run(['taRegisterTool', '$window', 'taTranslations', 'taSelection', 'taToolFunctions', '$sanitize', 'taOptions', function(taRegisterTool, $window, taTranslations, taSelection, taToolFunctions, $sanitize, taOptions){
	// test for the version of $sanitize that is in use
	// You can disable this check by setting taOptions.textAngularSanitize == false
	var gv = {}; $sanitize('', gv);
	/* istanbul ignore next, throws error */
	if ((taOptions.forceTextAngularSanitize===true) && (gv.version !== 'taSanitize')) {
		throw angular.$$minErr('textAngular')("textAngularSetup", "The textAngular-sanitize provider has been replaced by another -- have you included angular-sanitize by mistake?");
	}
	taRegisterTool("html", {
		iconclass: 'fa fa-code',
		tooltiptext: taTranslations.html.tooltip,
		action: function(){
			this.$editor().switchView();
		},
		activeState: function(){
			return this.$editor().showHtml;
		}
	});
	// add the Header tools
	// convenience functions so that the loop works correctly
	var _retActiveStateFunction = function(q){
		return function(){ return this.$editor().queryFormatBlockState(q); };
	};
	var headerAction = function(){
		return this.$editor().wrapSelection("formatBlock", "<" + this.name.toUpperCase() +">");
	};
	angular.forEach(['h1','h2','h3','h4','h5','h6'], function(h){
		taRegisterTool(h.toLowerCase(), {
			buttontext: h.toUpperCase(),
			tooltiptext: taTranslations.heading.tooltip + h.charAt(1),
			action: headerAction,
			activeState: _retActiveStateFunction(h.toLowerCase())
		});
	});
	taRegisterTool('p', {
		buttontext: 'P',
		tooltiptext: taTranslations.p.tooltip,
		action: function(){
			return this.$editor().wrapSelection("formatBlock", "<P>");
		},
		activeState: function(){ return this.$editor().queryFormatBlockState('p'); }
	});
	// key: pre -> taTranslations[key].tooltip, taTranslations[key].buttontext
	taRegisterTool('pre', {
		buttontext: 'pre',
		tooltiptext: taTranslations.pre.tooltip,
		action: function(){
			return this.$editor().wrapSelection("formatBlock", "<PRE>");
		},
		activeState: function(){ return this.$editor().queryFormatBlockState('pre'); }
	});
	taRegisterTool('ul', {
		iconclass: 'fa fa-list-ul',
		tooltiptext: taTranslations.ul.tooltip,
		action: function(){
			return this.$editor().wrapSelection("insertUnorderedList", null);
		},
		activeState: function(){ return this.$editor().queryCommandState('insertUnorderedList'); }
	});
	taRegisterTool('ol', {
		iconclass: 'fa fa-list-ol',
		tooltiptext: taTranslations.ol.tooltip,
		action: function(){
			return this.$editor().wrapSelection("insertOrderedList", null);
		},
		activeState: function(){ return this.$editor().queryCommandState('insertOrderedList'); }
	});
	taRegisterTool('quote', {
		iconclass: 'fa fa-quote-right',
		tooltiptext: taTranslations.quote.tooltip,
		action: function(){
			return this.$editor().wrapSelection("formatBlock", "<BLOCKQUOTE>");
		},
		activeState: function(){ return this.$editor().queryFormatBlockState('blockquote'); }
	});
	taRegisterTool('undo', {
		iconclass: 'fa fa-undo',
		tooltiptext: taTranslations.undo.tooltip,
		action: function(){
			return this.$editor().wrapSelection("undo", null);
		}
	});
	taRegisterTool('redo', {
		iconclass: 'fa fa-repeat',
		tooltiptext: taTranslations.redo.tooltip,
		action: function(){
			return this.$editor().wrapSelection("redo", null);
		}
	});
	taRegisterTool('bold', {
		iconclass: 'fa fa-bold',
		tooltiptext: taTranslations.bold.tooltip,
		action: function(){
			return this.$editor().wrapSelection("bold", null);
		},
		activeState: function(){
			return this.$editor().queryCommandState('bold');
		},
		commandKeyCode: 98
	});
	taRegisterTool('justifyLeft', {
		iconclass: 'fa fa-align-left',
		tooltiptext: taTranslations.justifyLeft.tooltip,
		action: function(){
			return this.$editor().wrapSelection("justifyLeft", null);
		},
		activeState: function(commonElement){
			/* istanbul ignore next: */
			if (commonElement && commonElement.nodeName === '#document') return false;
			var result = false;
			if (commonElement)
				result =
					commonElement.css('text-align') === 'left' ||
					commonElement.attr('align') === 'left' ||
					(
						commonElement.css('text-align') !== 'right' &&
						commonElement.css('text-align') !== 'center' &&
						commonElement.css('text-align') !== 'justify' && !this.$editor().queryCommandState('justifyRight') && !this.$editor().queryCommandState('justifyCenter')
					) && !this.$editor().queryCommandState('justifyFull');
			result = result || this.$editor().queryCommandState('justifyLeft');
			return result;
		}
	});
	taRegisterTool('justifyRight', {
		iconclass: 'fa fa-align-right',
		tooltiptext: taTranslations.justifyRight.tooltip,
		action: function(){
			return this.$editor().wrapSelection("justifyRight", null);
		},
		activeState: function(commonElement){
			/* istanbul ignore next: */
			if (commonElement && commonElement.nodeName === '#document') return false;
			var result = false;
			if(commonElement) result = commonElement.css('text-align') === 'right';
			result = result || this.$editor().queryCommandState('justifyRight');
			return result;
		}
	});
	taRegisterTool('justifyFull', {
		iconclass: 'fa fa-align-justify',
		tooltiptext: taTranslations.justifyFull.tooltip,
		action: function(){
			return this.$editor().wrapSelection("justifyFull", null);
		},
		activeState: function(commonElement){
			var result = false;
			if(commonElement) result = commonElement.css('text-align') === 'justify';
			result = result || this.$editor().queryCommandState('justifyFull');
			return result;
		}
	});
	taRegisterTool('justifyCenter', {
		iconclass: 'fa fa-align-center',
		tooltiptext: taTranslations.justifyCenter.tooltip,
		action: function(){
			return this.$editor().wrapSelection("justifyCenter", null);
		},
		activeState: function(commonElement){
			/* istanbul ignore next: */
			if (commonElement && commonElement.nodeName === '#document') return false;
			var result = false;
			if(commonElement) result = commonElement.css('text-align') === 'center';
			result = result || this.$editor().queryCommandState('justifyCenter');
			return result;
		}
	});
	taRegisterTool('indent', {
		iconclass: 'fa fa-indent',
		tooltiptext: taTranslations.indent.tooltip,
		action: function(){
			return this.$editor().wrapSelection("indent", null);
		},
		activeState: function(){
			return this.$editor().queryFormatBlockState('blockquote');
		},
		commandKeyCode: 'TabKey'
	});
	taRegisterTool('outdent', {
		iconclass: 'fa fa-outdent',
		tooltiptext: taTranslations.outdent.tooltip,
		action: function(){
			return this.$editor().wrapSelection("outdent", null);
		},
		activeState: function(){
			return false;
		},
		commandKeyCode: 'ShiftTabKey'
	});
	taRegisterTool('italics', {
		iconclass: 'fa fa-italic',
		tooltiptext: taTranslations.italic.tooltip,
		action: function(){
			return this.$editor().wrapSelection("italic", null);
		},
		activeState: function(){
			return this.$editor().queryCommandState('italic');
		},
		commandKeyCode: 105
	});
	taRegisterTool('underline', {
		iconclass: 'fa fa-underline',
		tooltiptext: taTranslations.underline.tooltip,
		action: function(){
			return this.$editor().wrapSelection("underline", null);
		},
		activeState: function(){
			return this.$editor().queryCommandState('underline');
		},
		commandKeyCode: 117
	});
	taRegisterTool('strikeThrough', {
		iconclass: 'fa fa-strikethrough',
		tooltiptext: taTranslations.strikeThrough.tooltip,
		action: function(){
			return this.$editor().wrapSelection("strikeThrough", null);
		},
		activeState: function(){
			return document.queryCommandState('strikeThrough');
		}
	});
	taRegisterTool('clear', {
		iconclass: 'fa fa-ban',
		tooltiptext: taTranslations.clear.tooltip,
		action: function(deferred, restoreSelection){
			var i;
			this.$editor().wrapSelection("removeFormat", null);
			var possibleNodes = angular.element(taSelection.getSelectionElement());
			// remove lists
			var removeListElements = function(list){
				list = angular.element(list);
				var prevElement = list;
				angular.forEach(list.children(), function(liElem){
					var newElem = angular.element('<p></p>');
					newElem.html(angular.element(liElem).html());
					prevElement.after(newElem);
					prevElement = newElem;
				});
				list.remove();
			};
			angular.forEach(possibleNodes.find("ul"), removeListElements);
			angular.forEach(possibleNodes.find("ol"), removeListElements);
			if(possibleNodes[0].tagName.toLowerCase() === 'li'){
				var _list = possibleNodes[0].parentNode.childNodes;
				var _preLis = [], _postLis = [], _found = false;
				for(i = 0; i < _list.length; i++){
					if(_list[i] === possibleNodes[0]){
						_found = true;
					}else if(!_found) _preLis.push(_list[i]);
					else _postLis.push(_list[i]);
				}
				var _parent = angular.element(possibleNodes[0].parentNode);
				var newElem = angular.element('<p></p>');
				newElem.html(angular.element(possibleNodes[0]).html());
				if(_preLis.length === 0 || _postLis.length === 0){
					if(_postLis.length === 0) _parent.after(newElem);
					else _parent[0].parentNode.insertBefore(newElem[0], _parent[0]);

					if(_preLis.length === 0 && _postLis.length === 0) _parent.remove();
					else angular.element(possibleNodes[0]).remove();
				}else{
					var _firstList = angular.element('<'+_parent[0].tagName+'></'+_parent[0].tagName+'>');
					var _secondList = angular.element('<'+_parent[0].tagName+'></'+_parent[0].tagName+'>');
					for(i = 0; i < _preLis.length; i++) _firstList.append(angular.element(_preLis[i]));
					for(i = 0; i < _postLis.length; i++) _secondList.append(angular.element(_postLis[i]));
					_parent.after(_secondList);
					_parent.after(newElem);
					_parent.after(_firstList);
					_parent.remove();
				}
				taSelection.setSelectionToElementEnd(newElem[0]);
			}
			// clear out all class attributes. These do not seem to be cleared via removeFormat
			var $editor = this.$editor();
			var recursiveRemoveClass = function(node){
				node = angular.element(node);
				if(node[0] !== $editor.displayElements.text[0]) node.removeAttr('class');
				angular.forEach(node.children(), recursiveRemoveClass);
			};
			angular.forEach(possibleNodes, recursiveRemoveClass);
			// check if in list. If not in list then use formatBlock option
			if(possibleNodes[0].tagName.toLowerCase() !== 'li' &&
				possibleNodes[0].tagName.toLowerCase() !== 'ol' &&
				possibleNodes[0].tagName.toLowerCase() !== 'ul') this.$editor().wrapSelection("formatBlock", "default");
			restoreSelection();
		}
	});


	taRegisterTool('insertImage', {
		iconclass: 'fa fa-picture-o',
		tooltiptext: taTranslations.insertImage.tooltip,
		action: function(){
			var imageLink;
			imageLink = $window.prompt(taTranslations.insertImage.dialogPrompt, 'http://');
			if(imageLink && imageLink !== '' && imageLink !== 'http://'){
				return this.$editor().wrapSelection('insertImage', imageLink, true);
			}
		},
		onElementSelect: {
			element: 'img',
			action: taToolFunctions.imgOnSelectAction
		}
	});
	taRegisterTool('insertVideo', {
		iconclass: 'fa fa-youtube-play',
		tooltiptext: taTranslations.insertVideo.tooltip,
		action: function(){
			var urlPrompt;
			urlPrompt = $window.prompt(taTranslations.insertVideo.dialogPrompt, 'https://');
			if (urlPrompt && urlPrompt !== '' && urlPrompt !== 'https://') {

				videoId = taToolFunctions.extractYoutubeVideoId(urlPrompt);

				/* istanbul ignore else: if it's invalid don't worry - though probably should show some kind of error message */
				if(videoId){
					// create the embed link
					var urlLink = "https://www.youtube.com/embed/" + videoId;
					// create the HTML
					// for all options see: http://stackoverflow.com/questions/2068344/how-do-i-get-a-youtube-video-thumbnail-from-the-youtube-api
					// maxresdefault.jpg seems to be undefined on some.
					var embed = '<img class="ta-insert-video" src="https://img.youtube.com/vi/' + videoId + '/hqdefault.jpg" ta-insert-video="' + urlLink + '" contenteditable="false" allowfullscreen="true" frameborder="0" />';
					// insert
					return this.$editor().wrapSelection('insertHTML', embed, true);
				}
			}
		},
		onElementSelect: {
			element: 'img',
			onlyWithAttrs: ['ta-insert-video'],
			action: taToolFunctions.imgOnSelectAction
		}
	});
	taRegisterTool('insertLink', {
		tooltiptext: taTranslations.insertLink.tooltip,
		iconclass: 'fa fa-link',
		action: function(){
			var urlLink;
			urlLink = $window.prompt(taTranslations.insertLink.dialogPrompt, 'http://');
			if(urlLink && urlLink !== '' && urlLink !== 'http://'){
				return this.$editor().wrapSelection('createLink', urlLink, true);
			}
		},
		activeState: function(commonElement){
			if(commonElement) return commonElement[0].tagName === 'A';
			return false;
		},
		onElementSelect: {
			element: 'a',
			action: taToolFunctions.aOnSelectAction
		}
	});
	taRegisterTool('wordcount', {
		display: '<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',
		disabled: true,
		wordcount: 0,
		activeState: function(){ // this fires on keyup
			var textElement = this.$editor().displayElements.text;
			/* istanbul ignore next: will default to '' when undefined */
			var workingHTML = textElement[0].innerHTML || '';
			var noOfWords = 0;

			/* istanbul ignore if: will default to '' when undefined */
			if (workingHTML.replace(/\s*<[^>]*?>\s*/g, '') !== '') {
				noOfWords = workingHTML.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi, '') // remove inline tags without adding spaces
										.replace(/(<[^>]*?>\s*<[^>]*?>)/ig, ' ') // replace adjacent tags with possible space between with a space
										.replace(/(<[^>]*?>)/ig, '') // remove any singular tags
										.replace(/\s+/ig, ' ') // condense spacing
										.match(/\S+/g).length; // count remaining non-space strings
			}

			//Set current scope
			this.wordcount = noOfWords;
			//Set editor scope
			this.$editor().wordcount = noOfWords;

			return false;
		}
	});
	taRegisterTool('charcount', {
		display: '<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',
		disabled: true,
		charcount: 0,
		activeState: function(){ // this fires on keyup
			var textElement = this.$editor().displayElements.text;
			var sourceText = textElement[0].innerText || textElement[0].textContent; // to cover the non-jquery use case.

			// Caculate number of chars
			var noOfChars = sourceText.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g,' ').replace(/\s+$/g, ' ').length;
			//Set current scope
			this.charcount = noOfChars;
			//Set editor scope
			this.$editor().charcount = noOfChars;
			return false;
		}
	});
}]);

/**
 * angular-bootstrap-calendar - A pure AngularJS bootstrap themed responsive calendar that can display events and has views for year, month, week and day
 * @version v0.15.5
 * @link https://github.com/mattlewis92/angular-bootstrap-calendar
 * @license MIT
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory(require("angular"), (function webpackLoadOptionalExternalModule() { try { return require("interact.js"); } catch(e) {} }()), require("moment"));
	else if(typeof define === 'function' && define.amd)
		define(["angular", "interact", "moment"], factory);
	else if(typeof exports === 'object')
		exports["angularBootstrapCalendarModuleName"] = factory(require("angular"), (function webpackLoadOptionalExternalModule() { try { return require("interact.js"); } catch(e) {} }()), require("moment"));
	else
		root["angularBootstrapCalendarModuleName"] = factory(root["angular"], root["interact"], root["moment"]);
})(this, function(__WEBPACK_EXTERNAL_MODULE_13__, __WEBPACK_EXTERNAL_MODULE_46__, __WEBPACK_EXTERNAL_MODULE_48__) {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	__webpack_require__(8);

	module.exports = __webpack_require__(12);


/***/ },
/* 1 */,
/* 2 */,
/* 3 */,
/* 4 */,
/* 5 */,
/* 6 */,
/* 7 */,
/* 8 */
/***/ function(module, exports) {

	// removed by extract-text-webpack-plugin

/***/ },
/* 9 */,
/* 10 */,
/* 11 */,
/* 12 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	function requireAll(r) {
	  r.keys().forEach(r);
	}

	module.exports = angular
	  .module('mwl.calendar', [])
	  .constant('calendarUseTemplates', (false) === false)
	  .run(["$templateCache", "calendarUseTemplates", function($templateCache, calendarUseTemplates) {
	    if (calendarUseTemplates) {
	      $templateCache.put('calendarMonthCellEvents.html', __webpack_require__(14));
	      $templateCache.put('calendarMonthCell.html', __webpack_require__(15));
	    }
	  }]).name;

	requireAll(__webpack_require__(16));
	requireAll(__webpack_require__(37));
	requireAll(__webpack_require__(41));


/***/ },
/* 13 */
/***/ function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_13__;

/***/ },
/* 14 */
/***/ function(module, exports) {

	module.exports = "<div class=\"events-list\" ng-show=\"day.events.length > 0\">\n  <a\n    ng-repeat=\"event in day.events | orderBy:'startsAt' track by event.$id\"\n    href=\"javascript:;\"\n    ng-click=\"vm.onEventClick({calendarEvent: event})\"\n    class=\"pull-left event\"\n    ng-class=\"'event-' + event.type + ' ' + event.cssClass\"\n    ng-mouseenter=\"vm.highlightEvent(event, true)\"\n    ng-mouseleave=\"vm.highlightEvent(event, false)\"\n    tooltip-append-to-body=\"true\"\n    tooltip-html-unsafe=\"{{ (event.startsAt | calendarDate:'time':true) + (vm.calendarConfig.displayEventEndTimes && event.endsAt ? ' - ' + (event.endsAt | calendarDate:'time':true) : '') + ' - ' + event.title }}\"\n    mwl-draggable=\"event.draggable === true\"\n    drop-data=\"{event: event}\">\n  </a>\n</div>\n";

/***/ },
/* 15 */
/***/ function(module, exports) {

	module.exports = "<div\n  mwl-droppable\n  on-drop=\"vm.handleEventDrop(dropData.event, day.date)\"\n  class=\"cal-month-day {{ day.cssClass }}\"\n  ng-class=\"{\n            'cal-day-outmonth': !day.inMonth,\n            'cal-day-inmonth': day.inMonth,\n            'cal-day-weekend': day.isWeekend,\n            'cal-day-past': day.isPast,\n            'cal-day-today': day.isToday,\n            'cal-day-future': day.isFuture\n          }\">\n\n  <small\n    class=\"cal-events-num badge badge-important pull-left\"\n    ng-show=\"day.badgeTotal > 0\"\n    ng-bind=\"day.badgeTotal\">\n  </small>\n\n  <span\n    class=\"pull-right\"\n    data-cal-date\n    ng-click=\"vm.calendarCtrl.drillDown(day.date)\"\n    ng-bind=\"day.label\">\n  </span>\n\n  <div class=\"cal-day-tick\" ng-show=\"dayIndex === vm.openDayIndex && vm.view[vm.openDayIndex].events.length > 0\">\n    <i class=\"glyphicon glyphicon-chevron-up\"></i>\n    <i class=\"fa fa-chevron-up\"></i>\n  </div>\n\n  <ng-include src=\"vm.cellEventsTemplateUrl || 'calendarMonthCellEvents.html'\"></ng-include>\n\n  <div id=\"cal-week-box\" ng-if=\"$first && rowHovered\">\n    Week {{ day.date.week() }}\n  </div>\n\n</div>\n";

/***/ },
/* 16 */
/***/ function(module, exports, __webpack_require__) {

	var map = {
		"./mwlCalendar.js": 17,
		"./mwlCalendarDay.js": 19,
		"./mwlCalendarHourList.js": 21,
		"./mwlCalendarMonth.js": 23,
		"./mwlCalendarSlideBox.js": 25,
		"./mwlCalendarWeek.js": 27,
		"./mwlCalendarYear.js": 29,
		"./mwlCollapseFallback.js": 31,
		"./mwlDateModifier.js": 32,
		"./mwlDraggable.js": 33,
		"./mwlDroppable.js": 34,
		"./mwlElementDimensions.js": 35,
		"./mwlResizable.js": 36
	};
	function webpackContext(req) {
		return __webpack_require__(webpackContextResolve(req));
	};
	function webpackContextResolve(req) {
		return map[req] || (function() { throw new Error("Cannot find module '" + req + "'.") }());
	};
	webpackContext.keys = function webpackContextKeys() {
		return Object.keys(map);
	};
	webpackContext.resolve = webpackContextResolve;
	module.exports = webpackContext;
	webpackContext.id = 16;


/***/ },
/* 17 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlCalendarCtrl', ["$scope", "$log", "$timeout", "$attrs", "$locale", "moment", "calendarTitle", function($scope, $log, $timeout, $attrs, $locale, moment, calendarTitle) {

	    var vm = this;

	    vm.events = vm.events || [];

	    vm.changeView = function(view, newDay) {
	      vm.view = view;
	      vm.currentDay = newDay;
	    };

	    vm.drillDown = function(date) {

	      var rawDate = moment(date).toDate();

	      var nextView = {
	        year: 'month',
	        month: 'day',
	        week: 'day'
	      };

	      if (vm.onDrillDownClick({calendarDate: rawDate, calendarNextView: nextView[vm.view]}) !== false) {
	        vm.changeView(nextView[vm.view], rawDate);
	      }

	    };

	    var previousDate = moment(vm.currentDay);
	    var previousView = vm.view;

	    function eventIsValid(event) {
	      if (!event.startsAt) {
	        $log.warn('Bootstrap calendar: ', 'Event is missing the startsAt field', event);
	      }

	      if (!angular.isDate(event.startsAt)) {
	        $log.warn('Bootstrap calendar: ', 'Event startsAt should be a javascript date object', event);
	      }

	      if (angular.isDefined(event.endsAt)) {
	        if (!angular.isDate(event.endsAt)) {
	          $log.warn('Bootstrap calendar: ', 'Event endsAt should be a javascript date object', event);
	        }
	        if (moment(event.startsAt).isAfter(moment(event.endsAt))) {
	          $log.warn('Bootstrap calendar: ', 'Event cannot start after it finishes', event);
	        }
	      }

	      return true;
	    }

	    function refreshCalendar() {

	      if (calendarTitle[vm.view] && angular.isDefined($attrs.viewTitle)) {
	        vm.viewTitle = calendarTitle[vm.view](vm.currentDay);
	      }

	      vm.events = vm.events.filter(eventIsValid).map(function(event, index) {
	        Object.defineProperty(event, '$id', {enumerable: false, configurable: true, value: index});
	        return event;
	      });

	      //if on-timespan-click="calendarDay = calendarDate" is set then don't update the view as nothing needs to change
	      var currentDate = moment(vm.currentDay);
	      var shouldUpdate = true;
	      if (
	        previousDate.clone().startOf(vm.view).isSame(currentDate.clone().startOf(vm.view)) &&
	        !previousDate.isSame(currentDate) &&
	        vm.view === previousView
	      ) {
	        shouldUpdate = false;
	      }
	      previousDate = currentDate;
	      previousView = vm.view;

	      if (shouldUpdate) {
	        // a $timeout is required as $broadcast is synchronous so if a new events array is set the calendar won't update
	        $timeout(function() {
	          $scope.$broadcast('calendar.refreshView');
	        });
	      }
	    }

	    var eventsWatched = false;

	    //Refresh the calendar when any of these variables change.
	    $scope.$watchGroup([
	      'vm.currentDay',
	      'vm.view',
	      function() {
	        return moment.locale() + $locale.id; //Auto update the calendar when the locale changes
	      }
	    ], function() {
	      if (!eventsWatched) {
	        eventsWatched = true;
	        //need to deep watch events hence why it isn't included in the watch group
	        $scope.$watch('vm.events', refreshCalendar, true); //this will call refreshCalendar when the watcher starts (i.e. now)
	      } else {
	        refreshCalendar();
	      }
	    });

	  }])
	  .directive('mwlCalendar', ["calendarUseTemplates", function(calendarUseTemplates) {

	    return {
	      template: calendarUseTemplates ? __webpack_require__(18) : '',
	      restrict: 'EA',
	      scope: {
	        events: '=',
	        view: '=',
	        viewTitle: '=?',
	        currentDay: '=',
	        editEventHtml: '=',
	        deleteEventHtml: '=',
	        autoOpen: '=',
	        onEventClick: '&',
	        onEventTimesChanged: '&',
	        onEditEventClick: '&',
	        onDeleteEventClick: '&',
	        onTimespanClick: '&',
	        onDrillDownClick: '&',
	        cellModifier: '&',
	        dayViewStart: '@',
	        dayViewEnd: '@',
	        dayViewSplit: '@',
	        monthCellTemplateUrl: '@',
	        monthCellEventsTemplateUrl: '@'
	      },
	      controller: 'MwlCalendarCtrl as vm',
	      bindToController: true
	    };

	  }]);


/***/ },
/* 18 */
/***/ function(module, exports) {

	module.exports = "<div class=\"cal-context\" ng-switch=\"vm.view\">\n\n  <div class=\"alert alert-danger\" ng-switch-default>The value passed to the view attribute of the calendar is not set</div>\n\n  <div class=\"alert alert-danger\" ng-hide=\"vm.currentDay\">The value passed to current-day attribute of the calendar is not set</div>\n\n  <mwl-calendar-year\n    events=\"vm.events\"\n    current-day=\"vm.currentDay\"\n    on-event-click=\"vm.onEventClick\"\n    on-event-times-changed=\"vm.onEventTimesChanged\"\n    on-edit-event-click=\"vm.onEditEventClick\"\n    on-delete-event-click=\"vm.onDeleteEventClick\"\n    on-timespan-click=\"vm.onTimespanClick\"\n    edit-event-html=\"vm.editEventHtml\"\n    delete-event-html=\"vm.deleteEventHtml\"\n    auto-open=\"vm.autoOpen\"\n    cell-modifier=\"vm.cellModifier\"\n    ng-switch-when=\"year\"\n  ></mwl-calendar-year>\n\n  <mwl-calendar-month\n    events=\"vm.events\"\n    current-day=\"vm.currentDay\"\n    on-event-click=\"vm.onEventClick\"\n    on-event-times-changed=\"vm.onEventTimesChanged\"\n    on-edit-event-click=\"vm.onEditEventClick\"\n    on-delete-event-click=\"vm.onDeleteEventClick\"\n    on-timespan-click=\"vm.onTimespanClick\"\n    edit-event-html=\"vm.editEventHtml\"\n    delete-event-html=\"vm.deleteEventHtml\"\n    auto-open=\"vm.autoOpen\"\n    cell-modifier=\"vm.cellModifier\"\n    cell-template-url=\"{{ vm.monthCellTemplateUrl }}\"\n    cell-events-template-url=\"{{ vm.monthCellEventsTemplateUrl }}\"\n    ng-switch-when=\"month\"\n    ></mwl-calendar-month>\n\n  <mwl-calendar-week\n    events=\"vm.events\"\n    current-day=\"vm.currentDay\"\n    on-event-click=\"vm.onEventClick\"\n    on-event-times-changed=\"vm.onEventTimesChanged\"\n    day-view-start=\"vm.dayViewStart\"\n    day-view-end=\"vm.dayViewEnd\"\n    day-view-split=\"vm.dayViewSplit\"\n    ng-switch-when=\"week\"\n    ></mwl-calendar-week>\n\n  <mwl-calendar-day\n    events=\"vm.events\"\n    current-day=\"vm.currentDay\"\n    on-event-click=\"vm.onEventClick\"\n    on-event-times-changed=\"vm.onEventTimesChanged\"\n    on-timespan-click=\"vm.onTimespanClick\"\n    day-view-start=\"vm.dayViewStart\"\n    day-view-end=\"vm.dayViewEnd\"\n    day-view-split=\"vm.dayViewSplit\"\n    ng-switch-when=\"day\"\n    ></mwl-calendar-day>\n</div>\n";

/***/ },
/* 19 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlCalendarDayCtrl', ["$scope", "$sce", "moment", "calendarHelper", "calendarConfig", function($scope, $sce, moment, calendarHelper, calendarConfig) {

	    var vm = this;

	    vm.calendarConfig = calendarConfig;
	    vm.$sce = $sce;

	    $scope.$on('calendar.refreshView', function() {
	      vm.dayViewSplit = vm.dayViewSplit || 30;
	      vm.dayViewHeight = calendarHelper.getDayViewHeight(
	        vm.dayViewStart,
	        vm.dayViewEnd,
	        vm.dayViewSplit
	      );

	      vm.view = calendarHelper.getDayView(
	        vm.events,
	        vm.currentDay,
	        vm.dayViewStart,
	        vm.dayViewEnd,
	        vm.dayViewSplit
	      );

	    });

	    vm.eventDragComplete = function(event, minuteChunksMoved) {
	      var minutesDiff = minuteChunksMoved * vm.dayViewSplit;
	      var newStart = moment(event.startsAt).add(minutesDiff, 'minutes');
	      var newEnd = moment(event.endsAt).add(minutesDiff, 'minutes');
	      delete event.tempStartsAt;

	      vm.onEventTimesChanged({
	        calendarEvent: event,
	        calendarNewEventStart: newStart.toDate(),
	        calendarNewEventEnd: event.endsAt ? newEnd.toDate() : null
	      });
	    };

	    vm.eventDragged = function(event, minuteChunksMoved) {
	      var minutesDiff = minuteChunksMoved * vm.dayViewSplit;
	      event.tempStartsAt = moment(event.startsAt).add(minutesDiff, 'minutes').toDate();
	    };

	    vm.eventResizeComplete = function(event, edge, minuteChunksMoved) {
	      var minutesDiff = minuteChunksMoved * vm.dayViewSplit;
	      var start = moment(event.startsAt);
	      var end = moment(event.endsAt);
	      if (edge === 'start') {
	        start.add(minutesDiff, 'minutes');
	      } else {
	        end.add(minutesDiff, 'minutes');
	      }
	      delete event.tempStartsAt;

	      vm.onEventTimesChanged({
	        calendarEvent: event,
	        calendarNewEventStart: start.toDate(),
	        calendarNewEventEnd: end.toDate()
	      });
	    };

	    vm.eventResized = function(event, edge, minuteChunksMoved) {
	      var minutesDiff = minuteChunksMoved * vm.dayViewSplit;
	      if (edge === 'start') {
	        event.tempStartsAt = moment(event.startsAt).add(minutesDiff, 'minutes').toDate();
	      }
	    };

	  }])
	  .directive('mwlCalendarDay', ["calendarUseTemplates", function(calendarUseTemplates) {

	    return {
	      template: calendarUseTemplates ? __webpack_require__(20) : '',
	      restrict: 'EA',
	      require: '^mwlCalendar',
	      scope: {
	        events: '=',
	        currentDay: '=',
	        onEventClick: '=',
	        onEventTimesChanged: '=',
	        onTimespanClick: '=',
	        dayViewStart: '=',
	        dayViewEnd: '=',
	        dayViewSplit: '='
	      },
	      controller: 'MwlCalendarDayCtrl as vm',
	      bindToController: true
	    };

	  }]);


/***/ },
/* 20 */
/***/ function(module, exports) {

	module.exports = "<div class=\"cal-day-box\">\n  <div class=\"row-fluid clearfix cal-row-head\">\n    <div class=\"span1 col-xs-1 cal-cell\" ng-bind=\"vm.calendarConfig.i18nStrings.timeLabel\"></div>\n    <div class=\"span11 col-xs-11 cal-cell\" ng-bind=\"vm.calendarConfig.i18nStrings.eventsLabel\"></div>\n  </div>\n\n  <div class=\"cal-day-panel clearfix\" ng-style=\"{height: vm.dayViewHeight + 'px'}\">\n\n    <mwl-calendar-hour-list\n      day-view-start=\"vm.dayViewStart\"\n      day-view-end=\"vm.dayViewEnd\"\n      day-view-split=\"vm.dayViewSplit\"\n      on-timespan-click=\"vm.onTimespanClick\"\n      current-day=\"vm.currentDay\">\n    </mwl-calendar-hour-list>\n\n    <div\n      class=\"pull-left day-event day-highlight\"\n      ng-repeat=\"event in vm.view track by event.$id\"\n      ng-class=\"'dh-event-' + event.type + ' ' + event.cssClass\"\n      ng-style=\"{top: event.top + 'px', left: event.left + 60 + 'px', height: event.height + 'px'}\"\n      mwl-draggable=\"event.draggable === true\"\n      axis=\"'y'\"\n      snap-grid=\"{y: 30}\"\n      on-drag=\"vm.eventDragged(event, y)\"\n      on-drag-end=\"vm.eventDragComplete(event, y)\"\n      mwl-resizable=\"event.resizable === true && event.endsAt\"\n      resize-edges=\"{top: true, bottom: true}\"\n      on-resize=\"vm.eventResized(event, edge, y)\"\n      on-resize-end=\"vm.eventResizeComplete(event, edge, y)\">\n\n      <span class=\"cal-hours\">\n        <span ng-show=\"event.top == 0\"><span ng-bind=\"(event.tempStartsAt || event.startsAt) | calendarDate:'day':true\"></span>, </span>\n        <span ng-bind=\"(event.tempStartsAt || event.startsAt) | calendarDate:'time':true\"></span>\n      </span>\n      <a href=\"javascript:;\" class=\"event-item\" ng-click=\"vm.onEventClick({calendarEvent: event})\">\n        <span ng-bind-html=\"vm.$sce.trustAsHtml(event.title) | calendarTruncateEventTitle:20:event.height\"></span>\n      </a>\n\n    </div>\n\n  </div>\n\n</div>\n";

/***/ },
/* 21 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlCalendarHourListCtrl', ["$scope", "moment", "calendarConfig", "calendarHelper", function($scope, moment, calendarConfig, calendarHelper) {
	    var vm = this;
	    var dayViewStart, dayViewEnd;

	    function updateDays() {
	      dayViewStart = moment(vm.dayViewStart || '00:00', 'HH:mm');
	      dayViewEnd = moment(vm.dayViewEnd || '23:00', 'HH:mm');
	      vm.dayViewSplit = parseInt(vm.dayViewSplit);
	      vm.hours = [];
	      var dayCounter = moment(vm.currentDay)
	        .clone()
	        .hours(dayViewStart.hours())
	        .minutes(dayViewStart.minutes())
	        .seconds(dayViewStart.seconds());
	      for (var i = 0; i <= dayViewEnd.diff(dayViewStart, 'hours'); i++) {
	        vm.hours.push({
	          label: calendarHelper.formatDate(dayCounter, calendarConfig.dateFormats.hour),
	          date: dayCounter.clone()
	        });
	        dayCounter.add(1, 'hour');
	      }
	    }

	    var originalLocale = moment.locale();

	    $scope.$on('calendar.refreshView', function() {

	      if (originalLocale !== moment.locale()) {
	        originalLocale = moment.locale();
	        updateDays();
	      }

	    });

	    $scope.$watchGroup([
	      'vm.dayViewStart',
	      'vm.dayViewEnd',
	      'vm.dayViewSplit',
	      'vm.currentDay'
	    ], function() {
	      updateDays();
	    });

	  }])
	  .directive('mwlCalendarHourList', ["calendarUseTemplates", function(calendarUseTemplates) {

	    return {
	      restrict: 'EA',
	      template: calendarUseTemplates ? __webpack_require__(22) : '',
	      controller: 'MwlCalendarHourListCtrl as vm',
	      scope: {
	        currentDay: '=',
	        dayViewStart: '=',
	        dayViewEnd: '=',
	        dayViewSplit: '=',
	        onTimespanClick: '='
	      },
	      bindToController: true
	    };

	  }]);


/***/ },
/* 22 */
/***/ function(module, exports) {

	module.exports = "<div class=\"cal-day-panel-hour\">\n\n  <div class=\"cal-day-hour\" ng-repeat=\"hour in vm.hours track by $index\">\n\n    <div\n      class=\"row-fluid cal-day-hour-part\"\n      ng-click=\"vm.onTimespanClick({calendarDate: hour.date.toDate()})\">\n      <div class=\"span1 col-xs-1\"><strong ng-bind=\"hour.label\"></strong></div>\n      <div class=\"span11 col-xs-11\"></div>\n    </div>\n\n    <div\n      class=\"row-fluid cal-day-hour-part\"\n      ng-click=\"vm.onTimespanClick({calendarDate: hour.date.clone().add(vm.dayViewSplit, 'minutes').toDate()})\">\n      <div class=\"span1 col-xs-1\"></div>\n      <div class=\"span11 col-xs-11\"></div>\n    </div>\n\n    <div\n      class=\"row-fluid cal-day-hour-part\"\n      ng-show=\"vm.dayViewSplit < 30\"\n      ng-click=\"vm.onTimespanClick({calendarDate: hour.date.clone().add(vm.dayViewSplit * 2, 'minutes').toDate()})\">\n      <div class=\"span1 col-xs-1\"></div>\n      <div class=\"span11 col-xs-11\"></div>\n    </div>\n\n    <div\n      class=\"row-fluid cal-day-hour-part\"\n      ng-show=\"vm.dayViewSplit < 30\"\n      ng-click=\"vm.onTimespanClick({calendarDate: hour.date.clone().add(vm.dayViewSplit * 3, 'minutes').toDate()})\">\n      <div class=\"span1 col-xs-1\"></div>\n      <div class=\"span11 col-xs-11\"></div>\n    </div>\n\n    <div\n      class=\"row-fluid cal-day-hour-part\"\n      ng-show=\"vm.dayViewSplit < 15\"\n      ng-click=\"vm.onTimespanClick({calendarDate: hour.date.clone().add(vm.dayViewSplit * 4, 'minutes').toDate()})\">\n      <div class=\"span1 col-xs-1\"></div>\n      <div class=\"span11 col-xs-11\"></div>\n    </div>\n\n    <div\n      class=\"row-fluid cal-day-hour-part\"\n      ng-show=\"vm.dayViewSplit < 15\"\n      ng-click=\"vm.onTimespanClick({calendarDate: hour.date.clone().add(vm.dayViewSplit * 5, 'minutes').toDate()})\">\n      <div class=\"span1 col-xs-1\"></div>\n      <div class=\"span11 col-xs-11\"></div>\n    </div>\n\n  </div>\n\n</div>\n";

/***/ },
/* 23 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlCalendarMonthCtrl', ["$scope", "moment", "calendarHelper", "calendarConfig", function($scope, moment, calendarHelper, calendarConfig) {

	    var vm = this;
	    vm.calendarConfig = calendarConfig;

	    $scope.$on('calendar.refreshView', function() {

	      vm.weekDays = calendarHelper.getWeekDayNames();

	      vm.view = calendarHelper.getMonthView(vm.events, vm.currentDay, vm.cellModifier);
	      var rows = Math.floor(vm.view.length / 7);
	      vm.monthOffsets = [];
	      for (var i = 0; i < rows; i++) {
	        vm.monthOffsets.push(i * 7);
	      }

	      //Auto open the calendar to the current day if set
	      if (vm.autoOpen) {
	        vm.view.forEach(function(day) {
	          if (day.inMonth && moment(vm.currentDay).startOf('day').isSame(day.date) && !vm.openDayIndex) {
	            vm.dayClicked(day, true);
	          }
	        });
	      }

	    });

	    vm.dayClicked = function(day, dayClickedFirstRun, $event) {

	      if (!dayClickedFirstRun) {
	        vm.onTimespanClick({
	          calendarDate: day.date.toDate(),
	          $event: $event
	        });
	        if ($event && $event.defaultPrevented) {
	          return;
	        }
	      }

	      vm.openRowIndex = null;
	      var dayIndex = vm.view.indexOf(day);
	      if (dayIndex === vm.openDayIndex) { //the day has been clicked and is already open
	        vm.openDayIndex = null; //close the open day
	      } else {
	        vm.openDayIndex = dayIndex;
	        vm.openRowIndex = Math.floor(dayIndex / 7);
	      }

	    };

	    vm.highlightEvent = function(event, shouldAddClass) {

	      vm.view.forEach(function(day) {
	        delete day.highlightClass;
	        if (shouldAddClass) {
	          var dayContainsEvent = day.events.indexOf(event) > -1;
	          if (dayContainsEvent) {
	            day.highlightClass = 'day-highlight dh-event-' + event.type;
	          }
	        }
	      });

	    };

	    vm.handleEventDrop = function(event, newDayDate) {

	      var newStart = moment(event.startsAt)
	        .date(moment(newDayDate).date())
	        .month(moment(newDayDate).month());

	      var newEnd = calendarHelper.adjustEndDateFromStartDiff(event.startsAt, newStart, event.endsAt);

	      vm.onEventTimesChanged({
	        calendarEvent: event,
	        calendarDate: newDayDate,
	        calendarNewEventStart: newStart.toDate(),
	        calendarNewEventEnd: newEnd ? newEnd.toDate() : null
	      });
	    };

	  }])
	  .directive('mwlCalendarMonth', ["calendarUseTemplates", function(calendarUseTemplates) {

	    return {
	      template: calendarUseTemplates ? __webpack_require__(24) : '',
	      restrict: 'EA',
	      require: '^mwlCalendar',
	      scope: {
	        events: '=',
	        currentDay: '=',
	        onEventClick: '=',
	        onEditEventClick: '=',
	        onDeleteEventClick: '=',
	        onEventTimesChanged: '=',
	        editEventHtml: '=',
	        deleteEventHtml: '=',
	        autoOpen: '=',
	        onTimespanClick: '=',
	        cellModifier: '=',
	        cellTemplateUrl: '@',
	        cellEventsTemplateUrl: '@'
	      },
	      controller: 'MwlCalendarMonthCtrl as vm',
	      link: function(scope, element, attrs, calendarCtrl) {
	        scope.vm.calendarCtrl = calendarCtrl;
	      },
	      bindToController: true
	    };

	  }]);


/***/ },
/* 24 */
/***/ function(module, exports) {

	module.exports = "<div class=\"cal-row-fluid cal-row-head\">\n\n  <div class=\"cal-cell1\" ng-repeat=\"day in vm.weekDays track by $index\" ng-bind=\"day\"></div>\n\n</div>\n<div class=\"cal-month-box\">\n\n  <div\n    ng-repeat=\"rowOffset in vm.monthOffsets track by rowOffset\"\n    ng-mouseenter=\"rowHovered = true\"\n    ng-mouseleave=\"rowHovered = false\">\n    <div class=\"cal-row-fluid cal-before-eventlist\">\n      <div\n        ng-repeat=\"day in vm.view | calendarLimitTo:7:rowOffset track by $index\"\n        ng-init=\"dayIndex = vm.view.indexOf(day)\"\n        class=\"cal-cell1 cal-cell {{ day.highlightClass }}\"\n        ng-click=\"vm.dayClicked(day, false, $event)\"\n        ng-class=\"{pointer: day.events.length > 0}\">\n        <ng-include src=\"vm.cellTemplateUrl || 'calendarMonthCell.html'\"></ng-include>\n      </div>\n    </div>\n\n    <mwl-calendar-slide-box\n      is-open=\"vm.openRowIndex === $index && vm.view[vm.openDayIndex].events.length > 0\"\n      events=\"vm.view[vm.openDayIndex].events\"\n      on-event-click=\"vm.onEventClick\"\n      edit-event-html=\"vm.editEventHtml\"\n      on-edit-event-click=\"vm.onEditEventClick\"\n      delete-event-html=\"vm.deleteEventHtml\"\n      on-delete-event-click=\"vm.onDeleteEventClick\">\n    </mwl-calendar-slide-box>\n\n  </div>\n\n</div>\n";

/***/ },
/* 25 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlCalendarSlideBoxCtrl', ["$sce", "$scope", "$timeout", "calendarConfig", function($sce, $scope, $timeout, calendarConfig) {

	    var vm = this;
	    vm.$sce = $sce;
	    vm.calendarConfig = calendarConfig;

	    vm.isCollapsed = true;
	    $scope.$watch('vm.isOpen', function(isOpen) {
	      //events must be populated first to set the element height before animation will work
	      $timeout(function() {
	        vm.isCollapsed = !isOpen;
	      });
	    });

	  }])
	  .directive('mwlCalendarSlideBox', ["calendarUseTemplates", function(calendarUseTemplates) {

	    return {
	      restrict: 'EA',
	      template: calendarUseTemplates ? __webpack_require__(26) : '',
	      replace: true,
	      controller: 'MwlCalendarSlideBoxCtrl as vm',
	      require: ['^?mwlCalendarMonth', '^?mwlCalendarYear'],
	      link: function(scope, elm, attrs, ctrls) {
	        scope.isMonthView = !!ctrls[0];
	        scope.isYearView = !!ctrls[1];
	      },
	      scope: {
	        isOpen: '=',
	        events: '=',
	        onEventClick: '=',
	        editEventHtml: '=',
	        onEditEventClick: '=',
	        deleteEventHtml: '=',
	        onDeleteEventClick: '='
	      },
	      bindToController: true
	    };

	  }]);


/***/ },
/* 26 */
/***/ function(module, exports) {

	module.exports = "<div class=\"cal-slide-box\" collapse=\"vm.isCollapsed\" mwl-collapse-fallback=\"vm.isCollapsed\">\n  <div class=\"cal-slide-content cal-event-list\">\n    <ul class=\"unstyled list-unstyled\">\n\n      <li\n        ng-repeat=\"event in vm.events | orderBy:'startsAt' track by event.$id\"\n        ng-class=\"event.cssClass\"\n        mwl-draggable=\"event.draggable === true\"\n        drop-data=\"{event: event}\">\n        <span class=\"pull-left event\" ng-class=\"'event-' + event.type\"></span>\n        &nbsp;\n        <a\n          href=\"javascript:;\"\n          class=\"event-item\"\n          ng-click=\"vm.onEventClick({calendarEvent: event})\">\n          <span ng-bind-html=\"vm.$sce.trustAsHtml(event.title)\"></span>\n          (<span ng-bind=\"event.startsAt | calendarDate:(isMonthView ? 'time' : 'datetime'):true\"></span><span ng-if=\"vm.calendarConfig.displayEventEndTimes && event.endsAt\"> - <span ng-bind=\"event.endsAt | calendarDate:(isMonthView ? 'time' : 'datetime'):true\"></span></span>)\n        </a>\n\n        <a\n          href=\"javascript:;\"\n          class=\"event-item-edit\"\n          ng-if=\"vm.editEventHtml && event.editable !== false\"\n          ng-bind-html=\"vm.$sce.trustAsHtml(vm.editEventHtml)\"\n          ng-click=\"vm.onEditEventClick({calendarEvent: event})\">\n        </a>\n\n        <a\n          href=\"javascript:;\"\n          class=\"event-item-delete\"\n          ng-if=\"vm.deleteEventHtml && event.deletable !== false\"\n          ng-bind-html=\"vm.$sce.trustAsHtml(vm.deleteEventHtml)\"\n          ng-click=\"vm.onDeleteEventClick({calendarEvent: event})\">\n        </a>\n      </li>\n\n    </ul>\n  </div>\n</div>\n";

/***/ },
/* 27 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlCalendarWeekCtrl', ["$scope", "$sce", "moment", "calendarHelper", "calendarConfig", function($scope, $sce, moment, calendarHelper, calendarConfig) {

	    var vm = this;

	    vm.showTimes = calendarConfig.showTimesOnWeekView;
	    vm.$sce = $sce;

	    $scope.$on('calendar.refreshView', function() {
	      vm.dayViewSplit = vm.dayViewSplit || 30;
	      vm.dayViewHeight = calendarHelper.getDayViewHeight(
	        vm.dayViewStart,
	        vm.dayViewEnd,
	        vm.dayViewSplit
	      );
	      if (vm.showTimes) {
	        vm.view = calendarHelper.getWeekViewWithTimes(
	          vm.events,
	          vm.currentDay,
	          vm.dayViewStart,
	          vm.dayViewEnd,
	          vm.dayViewSplit
	        );
	      } else {
	        vm.view = calendarHelper.getWeekView(vm.events, vm.currentDay);
	      }
	    });

	    vm.weekDragged = function(event, daysDiff, minuteChunksMoved) {

	      var newStart = moment(event.startsAt).add(daysDiff, 'days');
	      var newEnd = moment(event.endsAt).add(daysDiff, 'days');

	      if (minuteChunksMoved) {
	        var minutesDiff = minuteChunksMoved * vm.dayViewSplit;
	        newStart = newStart.add(minutesDiff, 'minutes');
	        newEnd = newEnd.add(minutesDiff, 'minutes');
	      }

	      delete event.tempStartsAt;

	      vm.onEventTimesChanged({
	        calendarEvent: event,
	        calendarNewEventStart: newStart.toDate(),
	        calendarNewEventEnd: event.endsAt ? newEnd.toDate() : null
	      });
	    };

	    vm.weekResized = function(event, edge, daysDiff) {

	      var start = moment(event.startsAt);
	      var end = moment(event.endsAt);
	      if (edge === 'start') {
	        start.add(daysDiff, 'days');
	      } else {
	        end.add(daysDiff, 'days');
	      }

	      vm.onEventTimesChanged({
	        calendarEvent: event,
	        calendarNewEventStart: start.toDate(),
	        calendarNewEventEnd: end.toDate()
	      });

	    };

	    vm.tempTimeChanged = function(event, minuteChunksMoved) {
	      var minutesDiff = minuteChunksMoved * vm.dayViewSplit;
	      event.tempStartsAt = moment(event.startsAt).add(minutesDiff, 'minutes').toDate();
	    };

	  }])
	  .directive('mwlCalendarWeek', ["calendarUseTemplates", function(calendarUseTemplates) {

	    return {
	      template: calendarUseTemplates ? __webpack_require__(28) : '',
	      restrict: 'EA',
	      require: '^mwlCalendar',
	      scope: {
	        events: '=',
	        currentDay: '=',
	        onEventClick: '=',
	        onEventTimesChanged: '=',
	        dayViewStart: '=',
	        dayViewEnd: '=',
	        dayViewSplit: '='
	      },
	      controller: 'MwlCalendarWeekCtrl as vm',
	      link: function(scope, element, attrs, calendarCtrl) {
	        scope.vm.calendarCtrl = calendarCtrl;
	      },
	      bindToController: true
	    };

	  }]);


/***/ },
/* 28 */
/***/ function(module, exports) {

	module.exports = "<div class=\"cal-week-box\" ng-class=\"{'cal-day-box': vm.showTimes}\">\n  <div class=\"cal-row-fluid cal-row-head\">\n\n    <div\n      class=\"cal-cell1\"\n      ng-repeat=\"day in vm.view.days track by $index\"\n      ng-class=\"{\n        'cal-day-weekend': day.isWeekend,\n        'cal-day-past': day.isPast,\n        'cal-day-today': day.isToday,\n        'cal-day-future': day.isFuture}\"\n      mwl-element-dimensions=\"vm.dayColumnDimensions\">\n\n      <span ng-bind=\"day.weekDayLabel\"></span>\n      <br>\n      <small>\n        <span\n          data-cal-date\n          ng-click=\"vm.calendarCtrl.drillDown(day.date)\"\n          class=\"pointer\"\n          ng-bind=\"day.dayLabel\">\n        </span>\n      </small>\n\n    </div>\n\n  </div>\n\n  <div class=\"cal-day-panel clearfix\" ng-style=\"{height: vm.showTimes ? (vm.dayViewHeight + 'px') : 'auto'}\">\n\n    <mwl-calendar-hour-list\n      day-view-start=\"vm.dayViewStart\"\n      day-view-end=\"vm.dayViewEnd\"\n      day-view-split=\"vm.dayViewSplit\"\n      current-day=\"vm.currentDay\"\n      ng-if=\"vm.showTimes\">\n    </mwl-calendar-hour-list>\n\n    <div class=\"row\">\n      <div class=\"col-xs-12\">\n        <div\n          class=\"cal-row-fluid \"\n          ng-repeat=\"event in vm.view.events track by event.$id\">\n          <div\n            ng-class=\"'cal-cell' + (vm.showTimes ? 1 : event.daySpan) + ' cal-offset' + event.dayOffset + ' day-highlight dh-event-' + event.type + ' ' + event.cssClass\"\n            ng-style=\"{top: vm.showTimes ? ((event.top + 2) + 'px') : 'auto', position: vm.showTimes ? 'absolute' : 'inherit'}\"\n            data-event-class\n            mwl-draggable=\"event.draggable === true\"\n            axis=\"vm.showTimes ? 'xy' : 'x'\"\n            snap-grid=\"vm.showTimes ? {x: vm.dayColumnDimensions.width, y: 30} : {x: vm.dayColumnDimensions.width}\"\n            on-drag=\"vm.tempTimeChanged(event, y)\"\n            on-drag-end=\"vm.weekDragged(event, x, y)\"\n            mwl-resizable=\"event.resizable === true && event.endsAt && !vm.showTimes\"\n            resize-edges=\"{left: true, right: true}\"\n            on-resize-end=\"vm.weekResized(event, edge, x)\">\n            <strong ng-bind=\"(event.tempStartsAt || event.startsAt) | calendarDate:'time':true\" ng-show=\"vm.showTimes\"></strong>\n            <a\n              href=\"javascript:;\"\n              ng-click=\"vm.onEventClick({calendarEvent: event})\"\n              class=\"event-item\"\n              ng-bind-html=\"vm.$sce.trustAsHtml(event.title)\"\n              tooltip-html-unsafe=\"{{ event.title }}\"\n              tooltip-placement=\"left\"\n              tooltip-append-to-body=\"true\">\n            </a>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n  </div>\n</div>\n";

/***/ },
/* 29 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlCalendarYearCtrl', ["$scope", "moment", "calendarHelper", function($scope, moment, calendarHelper) {

	    var vm = this;

	    $scope.$on('calendar.refreshView', function() {
	      vm.view = calendarHelper.getYearView(vm.events, vm.currentDay, vm.cellModifier);

	      //Auto open the calendar to the current day if set
	      if (vm.autoOpen) {
	        vm.view.forEach(function(month) {
	          if (moment(vm.currentDay).startOf('month').isSame(month.date) && !vm.openMonthIndex) {
	            vm.monthClicked(month, true);
	          }
	        });
	      }

	    });

	    vm.monthClicked = function(month, monthClickedFirstRun, $event) {

	      if (!monthClickedFirstRun) {
	        vm.onTimespanClick({
	          calendarDate: month.date.toDate(),
	          $event: $event
	        });
	        if ($event && $event.defaultPrevented) {
	          return;
	        }
	      }

	      vm.openRowIndex = null;
	      var monthIndex = vm.view.indexOf(month);
	      if (monthIndex === vm.openMonthIndex) { //the month has been clicked and is already open
	        vm.openMonthIndex = null; //close the open month
	      } else {
	        vm.openMonthIndex = monthIndex;
	        vm.openRowIndex = Math.floor(monthIndex / 4);
	      }

	    };

	    vm.handleEventDrop = function(event, newMonthDate) {
	      var newStart = moment(event.startsAt).month(moment(newMonthDate).month());
	      var newEnd = calendarHelper.adjustEndDateFromStartDiff(event.startsAt, newStart, event.endsAt);

	      vm.onEventTimesChanged({
	        calendarEvent: event,
	        calendarDate: newMonthDate,
	        calendarNewEventStart: newStart.toDate(),
	        calendarNewEventEnd: newEnd ? newEnd.toDate() : null
	      });
	    };

	  }])
	  .directive('mwlCalendarYear', ["calendarUseTemplates", function(calendarUseTemplates) {

	    return {
	      template: calendarUseTemplates ? __webpack_require__(30) : '',
	      restrict: 'EA',
	      require: '^mwlCalendar',
	      scope: {
	        events: '=',
	        currentDay: '=',
	        onEventClick: '=',
	        onEventTimesChanged: '=',
	        onEditEventClick: '=',
	        onDeleteEventClick: '=',
	        editEventHtml: '=',
	        deleteEventHtml: '=',
	        autoOpen: '=',
	        onTimespanClick: '=',
	        cellModifier: '='
	      },
	      controller: 'MwlCalendarYearCtrl as vm',
	      link: function(scope, element, attrs, calendarCtrl) {
	        scope.vm.calendarCtrl = calendarCtrl;
	      },
	      bindToController: true
	    };

	  }]);


/***/ },
/* 30 */
/***/ function(module, exports) {

	module.exports = "<div class=\"cal-year-box\">\n  <div ng-repeat=\"rowOffset in [0, 4, 8] track by rowOffset\">\n    <div class=\"row cal-before-eventlist\">\n      <div\n        class=\"span3 col-md-3 col-xs-6 cal-cell {{ day.cssClass }}\"\n        ng-repeat=\"month in vm.view | calendarLimitTo:4:rowOffset track by $index\"\n        ng-init=\"monthIndex = vm.view.indexOf(month)\"\n        ng-click=\"vm.monthClicked(month, false, $event)\"\n        ng-class=\"{pointer: month.events.length > 0, 'cal-day-today': month.isToday}\"\n        mwl-droppable\n        on-drop=\"vm.handleEventDrop(dropData.event, month.date)\">\n\n        <span\n          class=\"pull-right\"\n          data-cal-date\n          ng-click=\"vm.calendarCtrl.drillDown(month.date)\"\n          ng-bind=\"month.label\">\n        </span>\n\n        <small\n          class=\"cal-events-num badge badge-important pull-left\"\n          ng-show=\"month.badgeTotal > 0\"\n          ng-bind=\"month.badgeTotal\">\n        </small>\n\n        <div\n          class=\"cal-day-tick\"\n          ng-show=\"monthIndex === vm.openMonthIndex && vm.view[vm.openMonthIndex].events.length > 0\">\n          <i class=\"glyphicon glyphicon-chevron-up\"></i>\n          <i class=\"fa fa-chevron-up\"></i>\n        </div>\n\n      </div>\n    </div>\n\n    <mwl-calendar-slide-box\n      is-open=\"vm.openRowIndex === $index && vm.view[vm.openMonthIndex].events.length > 0\"\n      events=\"vm.view[vm.openMonthIndex].events\"\n      on-event-click=\"vm.onEventClick\"\n      edit-event-html=\"vm.editEventHtml\"\n      on-edit-event-click=\"vm.onEditEventClick\"\n      delete-event-html=\"vm.deleteEventHtml\"\n      on-delete-event-click=\"vm.onDeleteEventClick\">\n    </mwl-calendar-slide-box>\n\n  </div>\n\n</div>\n";

/***/ },
/* 31 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlCollapseFallbackCtrl', ["$scope", "$attrs", "$element", function($scope, $attrs, $element) {

	    $scope.$watch($attrs.mwlCollapseFallback, function(shouldCollapse) {
	      if (shouldCollapse) {
	        $element.addClass('ng-hide');
	      } else {
	        $element.removeClass('ng-hide');
	      }
	    });

	  }])
	  .directive('mwlCollapseFallback', ["$injector", function($injector) {

	    if ($injector.has('collapseDirective')) {
	      return {};
	    }

	    return {
	      restrict: 'A',
	      controller: 'MwlCollapseFallbackCtrl'
	    };

	  }]);


/***/ },
/* 32 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlDateModifierCtrl', ["$element", "$attrs", "$scope", "moment", function($element, $attrs, $scope, moment) {

	    var vm = this;

	    function onClick() {
	      if (angular.isDefined($attrs.setToToday)) {
	        vm.date = new Date();
	      } else if (angular.isDefined($attrs.increment)) {
	        vm.date = moment(vm.date).add(1, vm.increment).toDate();
	      } else if (angular.isDefined($attrs.decrement)) {
	        vm.date = moment(vm.date).subtract(1, vm.decrement).toDate();
	      }
	      $scope.$apply();
	    }

	    $element.bind('click', onClick);

	    $scope.$on('$destroy', function() {
	      $element.unbind('click', onClick);
	    });

	  }])
	  .directive('mwlDateModifier', function() {

	    return {
	      restrict: 'A',
	      controller: 'MwlDateModifierCtrl as vm',
	      scope: {
	        date: '=',
	        increment: '=',
	        decrement: '='
	      },
	      bindToController: true
	    };

	  });


/***/ },
/* 33 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlDraggableCtrl', ["$element", "$scope", "$window", "$parse", "$attrs", "interact", function($element, $scope, $window, $parse, $attrs, interact) {

	    if (!interact) {
	      return;
	    }

	    var snap, snapGridDimensions;
	    if ($attrs.snapGrid) {
	      snapGridDimensions = $parse($attrs.snapGrid)($scope);
	      snap = {
	        targets: [
	          interact.createSnapGrid(snapGridDimensions)
	        ]
	      };
	    }

	    function translateElement(elm, transformValue) {
	      return elm
	        .css('-ms-transform', transformValue)
	        .css('-webkit-transform', transformValue)
	        .css('transform', transformValue);
	    }

	    function canDrag() {
	      return $parse($attrs.mwlDraggable)($scope);
	    }

	    function getUnitsMoved(x, y, gridDimensions) {

	      var result = {x: x, y: y};

	      if (gridDimensions && gridDimensions.x) {
	        result.x /= gridDimensions.x;
	      }

	      if (gridDimensions && gridDimensions.y) {
	        result.y /= gridDimensions.y;
	      }

	      return result;

	    }

	    interact($element[0]).draggable({
	      snap: snap,
	      onstart: function(event) {
	        if (canDrag()) {
	          angular.element(event.target).addClass('dragging-active');
	          event.target.dropData = $parse($attrs.dropData)($scope);
	          event.target.style.pointerEvents = 'none';
	          if ($attrs.onDragStart) {
	            $parse($attrs.onDragStart)($scope);
	            $scope.$apply();
	          }
	        }
	      },
	      onmove: function(event) {

	        if (canDrag()) {
	          var elm = angular.element(event.target);
	          var x = (parseFloat(elm.attr('data-x')) || 0) + (event.dx || 0);
	          var y = (parseFloat(elm.attr('data-y')) || 0) + (event.dy || 0);

	          switch ($parse($attrs.axis)($scope)) {
	            case 'x':
	              y = 0;
	              break;

	            case 'y':
	              x = 0;
	              break;

	            default:
	          }

	          if ($window.getComputedStyle(elm[0]).position === 'static') {
	            elm.css('position', 'relative');
	          }

	          translateElement(elm, 'translate(' + x + 'px, ' + y + 'px)')
	            .css('z-index', 1000)
	            .attr('data-x', x)
	            .attr('data-y', y);

	          if ($attrs.onDrag) {
	            $parse($attrs.onDrag)($scope, getUnitsMoved(x, y, snapGridDimensions));
	            $scope.$apply();
	          }
	        }

	      },
	      onend: function(event) {

	        if (canDrag()) {
	          var elm = angular.element(event.target);
	          var x = elm.attr('data-x');
	          var y = elm.attr('data-y');

	          event.target.style.pointerEvents = 'auto';
	          if ($attrs.onDragEnd) {
	            $parse($attrs.onDragEnd)($scope, getUnitsMoved(x, y, snapGridDimensions));
	            $scope.$apply();
	          }

	          translateElement(elm, '')
	            .removeAttr('data-x')
	            .removeAttr('data-y')
	            .removeClass('dragging-active');
	        }

	      }
	    });

	    $scope.$on('$destroy', function() {
	      interact($element[0]).unset();
	    });

	  }])
	  .directive('mwlDraggable', function() {

	    return {
	      restrict: 'A',
	      controller: 'MwlDraggableCtrl'
	    };

	  });


/***/ },
/* 34 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlDroppableCtrl', ["$element", "$scope", "$parse", "$attrs", "interact", function($element, $scope, $parse, $attrs, interact) {

	    if (!interact) {
	      return;
	    }

	    interact($element[0]).dropzone({
	      ondragenter: function(event) {
	        angular.element(event.target).addClass('drop-active');
	      },
	      ondragleave: function(event) {
	        angular.element(event.target).removeClass('drop-active');
	      },
	      ondropdeactivate: function(event) {
	        angular.element(event.target).removeClass('drop-active');
	      },
	      ondrop: function(event) {
	        if (event.relatedTarget.dropData) {
	          $parse($attrs.onDrop)($scope, {dropData: event.relatedTarget.dropData});
	          $scope.$apply();
	        }
	      }
	    });

	    $scope.$on('$destroy', function() {
	      interact($element[0]).unset();
	    });

	  }])
	  .directive('mwlDroppable', function() {

	    return {
	      restrict: 'A',
	      controller: 'MwlDroppableCtrl'
	    };

	  });


/***/ },
/* 35 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlElementDimensionsCtrl', ["$element", "$scope", "$parse", "$attrs", function($element, $scope, $parse, $attrs) {

	    $parse($attrs.mwlElementDimensions).assign($scope, {
	      width: $element[0].offsetWidth,
	      height: $element[0].offsetHeight
	    });

	  }])
	  .directive('mwlElementDimensions', function() {

	    return {
	      restrict: 'A',
	      controller: 'MwlElementDimensionsCtrl'
	    };

	  });


/***/ },
/* 36 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .controller('MwlResizableCtrl', ["$element", "$scope", "$parse", "$attrs", "interact", function($element, $scope, $parse, $attrs, interact) {

	    if (!interact) {
	      return;
	    }

	    var snap, snapGridDimensions;
	    if ($attrs.snapGrid) {
	      snapGridDimensions = $parse($attrs.snapGrid)($scope);
	      snap = {
	        targets: [
	          interact.createSnapGrid(snapGridDimensions)
	        ]
	      };
	    }

	    var originalDimensions = {};
	    var originalDimensionsStyle = {};
	    var resizeEdge;

	    function canResize() {
	      return $parse($attrs.mwlResizable)($scope);
	    }

	    function getUnitsResized(edge, elm, gridDimensions) {
	      var unitsResized = {};
	      unitsResized.edge = edge;
	      if (edge === 'start') {
	        unitsResized.x = elm.data('x');
	        unitsResized.y = elm.data('y');
	      } else if (edge === 'end') {
	        unitsResized.x = parseFloat(elm.css('width').replace('px', '')) - originalDimensions.width;
	        unitsResized.y = parseFloat(elm.css('height').replace('px', '')) - originalDimensions.height;
	      }
	      if (gridDimensions && gridDimensions.x) {
	        unitsResized.x = Math.round(unitsResized.x / gridDimensions.x);
	      }
	      if (gridDimensions && gridDimensions.y) {
	        unitsResized.y = Math.round(unitsResized.y / gridDimensions.y);
	      }
	      return unitsResized;
	    }

	    interact($element[0]).resizable({
	      edges: $parse($attrs.resizeEdges)($scope),
	      snap: snap,
	      onstart: function(event) {

	        if (canResize()) {
	          resizeEdge = 'end';
	          var elm = angular.element(event.target);
	          originalDimensions.height = elm[0].offsetHeight;
	          originalDimensions.width = elm[0].offsetWidth;
	          originalDimensionsStyle.height = elm.css('height');
	          originalDimensionsStyle.width = elm.css('width');
	        }

	      },
	      onmove: function(event) {

	        if (canResize()) {
	          var elm = angular.element(event.target);
	          var x = parseFloat(elm.data('x') || 0);
	          var y = parseFloat(elm.data('y') || 0);

	          elm.css({
	            width: event.rect.width + 'px',
	            height: event.rect.height + 'px'
	          });

	          // translate when resizing from top or left edges
	          x += event.deltaRect.left;
	          y += event.deltaRect.top;

	          elm.css('transform', 'translate(' + x + 'px,' + y + 'px)');

	          elm.data('x', x);
	          elm.data('y', y);

	          if (event.deltaRect.left !== 0 || event.deltaRect.top !== 0) {
	            resizeEdge = 'start';
	          }

	          if ($attrs.onResize) {
	            $parse($attrs.onResize)($scope, getUnitsResized(resizeEdge, elm, snapGridDimensions));
	            $scope.$apply();
	          }

	        }

	      },
	      onend: function(event) {

	        if (canResize()) {

	          var elm = angular.element(event.target);
	          var unitsResized = getUnitsResized(resizeEdge, elm, snapGridDimensions);

	          elm
	            .data('x', null)
	            .data('y', null)
	            .css({
	              transform: '',
	              width: originalDimensionsStyle.width,
	              height: originalDimensionsStyle.height
	            });

	          if ($attrs.onResizeEnd) {
	            $parse($attrs.onResizeEnd)($scope, unitsResized);
	            $scope.$apply();
	          }
	        }

	      }
	    });

	    $scope.$on('$destroy', function() {
	      interact($element[0]).unset();
	    });

	  }])
	  .directive('mwlResizable', function() {

	    return {
	      restrict: 'A',
	      controller: 'MwlResizableCtrl'
	    };

	  });


/***/ },
/* 37 */
/***/ function(module, exports, __webpack_require__) {

	var map = {
		"./calendarDate.js": 38,
		"./calendarLimitTo.js": 39,
		"./calendarTruncateEventTitle.js": 40
	};
	function webpackContext(req) {
		return __webpack_require__(webpackContextResolve(req));
	};
	function webpackContextResolve(req) {
		return map[req] || (function() { throw new Error("Cannot find module '" + req + "'.") }());
	};
	webpackContext.keys = function webpackContextKeys() {
		return Object.keys(map);
	};
	webpackContext.resolve = webpackContextResolve;
	module.exports = webpackContext;
	webpackContext.id = 37;


/***/ },
/* 38 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .filter('calendarDate', ["calendarHelper", "calendarConfig", function(calendarHelper, calendarConfig) {

	    function calendarDate(date, format, getFromConfig) {

	      if (getFromConfig === true) {
	        format = calendarConfig.dateFormats[format];
	      }

	      return calendarHelper.formatDate(date, format);

	    }

	    // This is stateful because the locale can change as well
	    // as calendarConfig.dateFormats which would change the value outside of this filter
	    calendarDate.$stateful = true;

	    return calendarDate;

	  }]);


/***/ },
/* 39 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .filter('calendarLimitTo', ["limitToFilter", function(limitToFilter) {

	    if (angular.version.minor >= 4) { //1.4+ supports the begin attribute
	      return limitToFilter;
	    }

	    //Copied from the angular source. Only 1.4 has the begin functionality.
	    return function(input, limit, begin) {
	      if (Math.abs(Number(limit)) === Infinity) {
	        limit = Number(limit);
	      } else {
	        limit = parseInt(limit);
	      }
	      if (isNaN(limit)) {
	        return input;
	      }

	      if (angular.isNumber(input)) {
	        input = input.toString();
	      }
	      if (!angular.isArray(input) && !angular.isString(input)) {
	        return input;
	      }

	      begin = (!begin || isNaN(begin)) ? 0 : parseInt(begin);
	      begin = (begin < 0 && begin >= -input.length) ? input.length + begin : begin;

	      if (limit >= 0) {
	        return input.slice(begin, begin + limit);
	      } else if (begin === 0) {
	        return input.slice(limit, input.length);
	      } else {
	        return input.slice(Math.max(0, begin + limit), begin);
	      }
	    };

	  }]);


/***/ },
/* 40 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .filter('calendarTruncateEventTitle', function() {

	    return function(string, length, boxHeight) {
	      if (!string) {
	        return '';
	      }

	      //Only truncate if if actually needs truncating
	      if (string.length >= length && string.length / 20 > boxHeight / 30) {
	        return string.substr(0, length) + '...';
	      } else {
	        return string;
	      }
	    };

	  });


/***/ },
/* 41 */
/***/ function(module, exports, __webpack_require__) {

	var map = {
		"./calendarConfig.js": 42,
		"./calendarHelper.js": 43,
		"./calendarTitle.js": 44,
		"./interact.js": 45,
		"./moment.js": 47
	};
	function webpackContext(req) {
		return __webpack_require__(webpackContextResolve(req));
	};
	function webpackContextResolve(req) {
		return map[req] || (function() { throw new Error("Cannot find module '" + req + "'.") }());
	};
	webpackContext.keys = function webpackContextKeys() {
		return Object.keys(map);
	};
	webpackContext.resolve = webpackContextResolve;
	module.exports = webpackContext;
	webpackContext.id = 41;


/***/ },
/* 42 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .provider('calendarConfig', function() {

	    var defaultFormats = {
	      angular: {
	        date: {
	          hour: 'ha',
	          day: 'd MMM',
	          month: 'MMMM',
	          weekDay: 'EEEE',
	          time: 'HH:mm',
	          datetime: 'MMM d, h:mm a'
	        },
	        title: {
	          day: 'EEEE d MMMM, yyyy',
	          week: 'Week {week} of {year}',
	          month: 'MMMM yyyy',
	          year: 'yyyy'
	        }
	      },
	      moment: {
	        date: {
	          hour: 'ha',
	          day: 'D MMM',
	          month: 'MMMM',
	          weekDay: 'dddd',
	          time: 'HH:mm',
	          datetime: 'MMM D, h:mm a'
	        },
	        title: {
	          day: 'dddd D MMMM, YYYY',
	          week: 'Week {week} of {year}',
	          month: 'MMMM YYYY',
	          year: 'YYYY'
	        }
	      }
	    };

	    var dateFormatter = 'angular';
	    var defaultDateFormats = angular.copy(defaultFormats[dateFormatter].date);
	    var defaultTitleFormats = angular.copy(defaultFormats[dateFormatter].title);
	    var displayEventEndTimes = false;
	    var showTimesOnWeekView = false;
	    var displayAllMonthEvents = false;

	    var i18nStrings = {
	      eventsLabel: 'Events',
	      timeLabel: 'Time'
	    };

	    var configProvider = this;

	    configProvider.setDateFormats = function(formats) {
	      angular.extend(defaultDateFormats, formats);
	      return configProvider;
	    };

	    configProvider.setTitleFormats = function(formats) {
	      angular.extend(defaultTitleFormats, formats);
	      return configProvider;
	    };

	    configProvider.setI18nStrings = function(strings) {
	      angular.extend(i18nStrings, strings);
	      return configProvider;
	    };

	    configProvider.setDisplayAllMonthEvents = function(value) {
	      displayAllMonthEvents = value;
	      return configProvider;
	    };

	    configProvider.setDisplayEventEndTimes = function(value) {
	      displayEventEndTimes = value;
	      return configProvider;
	    };

	    configProvider.setDateFormatter = function(value) {
	      if (['angular', 'moment'].indexOf(value) === -1) {
	        throw new Error('Invalid date formatter. Allowed types are angular and moment.');
	      }
	      dateFormatter = value;
	      defaultDateFormats = angular.copy(defaultFormats[dateFormatter].date);
	      defaultTitleFormats = angular.copy(defaultFormats[dateFormatter].title);
	      return configProvider;
	    };

	    configProvider.showTimesOnWeekView = function(value) {
	      showTimesOnWeekView = value; //experimental, and ignores the event end date
	      return configProvider;
	    };

	    configProvider.$get = function() {
	      return {
	        dateFormats: defaultDateFormats,
	        titleFormats: defaultTitleFormats,
	        i18nStrings: i18nStrings,
	        displayAllMonthEvents: displayAllMonthEvents,
	        displayEventEndTimes: displayEventEndTimes,
	        dateFormatter: dateFormatter,
	        showTimesOnWeekView: showTimesOnWeekView
	      };
	    };

	  });


/***/ },
/* 43 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .factory('calendarHelper', ["dateFilter", "moment", "calendarConfig", function(dateFilter, moment, calendarConfig) {

	    function formatDate(date, format) {
	      if (calendarConfig.dateFormatter === 'angular') {
	        return dateFilter(moment(date).toDate(), format);
	      } else if (calendarConfig.dateFormatter === 'moment') {
	        return moment(date).format(format);
	      }
	    }

	    function adjustEndDateFromStartDiff(oldStart, newStart, oldEnd) {
	      if (!oldEnd) {
	        return oldEnd;
	      }
	      var diffInSeconds = moment(newStart).diff(moment(oldStart));
	      return moment(oldEnd).add(diffInSeconds);
	    }

	    function eventIsInPeriod(event, periodStart, periodEnd) {

	      var eventStart = moment(event.startsAt);
	      var eventEnd = moment(event.endsAt || event.startsAt);
	      periodStart = moment(periodStart);
	      periodEnd = moment(periodEnd);

	      if (angular.isDefined(event.recursOn)) {

	        switch (event.recursOn) {
	          case 'year':
	            eventStart.set({
	              year: periodStart.year()
	            });
	            break;

	          case 'month':
	            eventStart.set({
	              year: periodStart.year(),
	              month: periodStart.month()
	            });
	            break;

	          default:
	            throw new Error('Invalid value (' + event.recursOn + ') given for recurs on. Can only be year or month.');
	        }

	        eventEnd = adjustEndDateFromStartDiff(event.startsAt, eventStart, eventEnd);

	      }

	      return (eventStart.isAfter(periodStart) && eventStart.isBefore(periodEnd)) ||
	        (eventEnd.isAfter(periodStart) && eventEnd.isBefore(periodEnd)) ||
	        (eventStart.isBefore(periodStart) && eventEnd.isAfter(periodEnd)) ||
	        eventStart.isSame(periodStart) ||
	        eventEnd.isSame(periodEnd);

	    }

	    function filterEventsInPeriod(events, startPeriod, endPeriod) {
	      return events.filter(function(event) {
	        return eventIsInPeriod(event, startPeriod, endPeriod);
	      });
	    }

	    function getEventsInPeriod(calendarDate, period, allEvents) {
	      var startPeriod = moment(calendarDate).startOf(period);
	      var endPeriod = moment(calendarDate).endOf(period);
	      return filterEventsInPeriod(allEvents, startPeriod, endPeriod);
	    }

	    function getBadgeTotal(events) {
	      return events.filter(function(event) {
	        return event.incrementsBadgeTotal !== false;
	      }).length;
	    }

	    function getWeekDayNames() {
	      var weekdays = [];
	      var count = 0;
	      while (count < 7) {
	        weekdays.push(formatDate(moment().weekday(count++), calendarConfig.dateFormats.weekDay));
	      }
	      return weekdays;
	    }

	    function getYearView(events, currentDay, cellModifier) {

	      var view = [];
	      var eventsInPeriod = getEventsInPeriod(currentDay, 'year', events);
	      var month = moment(currentDay).startOf('year');
	      var count = 0;
	      while (count < 12) {
	        var startPeriod = month.clone();
	        var endPeriod = startPeriod.clone().endOf('month');
	        var periodEvents = filterEventsInPeriod(eventsInPeriod, startPeriod, endPeriod);
	        var cell = {
	          label: formatDate(startPeriod, calendarConfig.dateFormats.month),
	          isToday: startPeriod.isSame(moment().startOf('month')),
	          events: periodEvents,
	          date: startPeriod,
	          badgeTotal: getBadgeTotal(periodEvents)
	        };

	        cellModifier({calendarCell: cell});
	        view.push(cell);
	        month.add(1, 'month');
	        count++;
	      }

	      return view;

	    }

	    function getMonthView(events, currentDay, cellModifier) {

	      var startOfMonth = moment(currentDay).startOf('month');
	      var day = startOfMonth.clone().startOf('week');
	      var endOfMonthView = moment(currentDay).endOf('month').endOf('week');
	      var eventsInPeriod;
	      if (calendarConfig.displayAllMonthEvents) {
	        eventsInPeriod = filterEventsInPeriod(events, day, endOfMonthView);
	      } else {
	        eventsInPeriod = filterEventsInPeriod(events, startOfMonth, startOfMonth.clone().endOf('month'));
	      }
	      var view = [];
	      var today = moment().startOf('day');

	      while (day.isBefore(endOfMonthView)) {

	        var inMonth = day.month() === moment(currentDay).month();
	        var monthEvents = [];
	        if (inMonth || calendarConfig.displayAllMonthEvents) {
	          monthEvents = filterEventsInPeriod(eventsInPeriod, day, day.clone().endOf('day'));
	        }

	        var cell = {
	          label: day.date(),
	          date: day.clone(),
	          inMonth: inMonth,
	          isPast: today.isAfter(day),
	          isToday: today.isSame(day),
	          isFuture: today.isBefore(day),
	          isWeekend: [0, 6].indexOf(day.day()) > -1,
	          events: monthEvents,
	          badgeTotal: getBadgeTotal(monthEvents)
	        };

	        cellModifier({calendarCell: cell});

	        view.push(cell);

	        day.add(1, 'day');
	      }

	      return view;

	    }

	    function getWeekView(events, currentDay) {

	      var startOfWeek = moment(currentDay).startOf('week');
	      var endOfWeek = moment(currentDay).endOf('week');
	      var dayCounter = startOfWeek.clone();
	      var days = [];
	      var today = moment().startOf('day');
	      while (days.length < 7) {
	        days.push({
	          weekDayLabel: formatDate(dayCounter, calendarConfig.dateFormats.weekDay),
	          date: dayCounter.clone(),
	          dayLabel: formatDate(dayCounter, calendarConfig.dateFormats.day),
	          isPast: dayCounter.isBefore(today),
	          isToday: dayCounter.isSame(today),
	          isFuture: dayCounter.isAfter(today),
	          isWeekend: [0, 6].indexOf(dayCounter.day()) > -1
	        });
	        dayCounter.add(1, 'day');
	      }

	      var eventsSorted = filterEventsInPeriod(events, startOfWeek, endOfWeek).map(function(event) {

	        var eventStart = moment(event.startsAt).startOf('day');
	        var eventEnd = moment(event.endsAt || event.startsAt).startOf('day');
	        var weekViewStart = moment(startOfWeek).startOf('day');
	        var weekViewEnd = moment(endOfWeek).startOf('day');
	        var offset, span;

	        if (eventStart.isBefore(weekViewStart) || eventStart.isSame(weekViewStart)) {
	          offset = 0;
	        } else {
	          offset = eventStart.diff(weekViewStart, 'days');
	        }

	        if (eventEnd.isAfter(weekViewEnd)) {
	          eventEnd = weekViewEnd;
	        }

	        if (eventStart.isBefore(weekViewStart)) {
	          eventStart = weekViewStart;
	        }

	        span = moment(eventEnd).diff(eventStart, 'days') + 1;

	        event.daySpan = span;
	        event.dayOffset = offset;

	        return event;
	      });

	      return {days: days, events: eventsSorted};

	    }

	    function getDayView(events, currentDay, dayViewStart, dayViewEnd, dayViewSplit) {

	      var dayStartHour = moment(dayViewStart || '00:00', 'HH:mm').hours();
	      var dayEndHour = moment(dayViewEnd || '23:00', 'HH:mm').hours();
	      var hourHeight = (60 / dayViewSplit) * 30;
	      var calendarStart = moment(currentDay).startOf('day').add(dayStartHour, 'hours');
	      var calendarEnd = moment(currentDay).startOf('day').add(dayEndHour, 'hours');
	      var calendarHeight = (dayEndHour - dayStartHour + 1) * hourHeight;
	      var hourHeightMultiplier = hourHeight / 60;
	      var buckets = [];
	      var eventsInPeriod = filterEventsInPeriod(
	        events,
	        moment(currentDay).startOf('day').toDate(),
	        moment(currentDay).endOf('day').toDate()
	      );

	      return eventsInPeriod.map(function(event) {
	        if (moment(event.startsAt).isBefore(calendarStart)) {
	          event.top = 0;
	        } else {
	          event.top = (moment(event.startsAt).startOf('minute').diff(calendarStart.startOf('minute'), 'minutes') * hourHeightMultiplier) - 2;
	        }

	        if (moment(event.endsAt || event.startsAt).isAfter(calendarEnd)) {
	          event.height = calendarHeight - event.top;
	        } else {
	          var diffStart = event.startsAt;
	          if (moment(event.startsAt).isBefore(calendarStart)) {
	            diffStart = calendarStart.toDate();
	          }
	          if (!event.endsAt) {
	            event.height = 30;
	          } else {
	            event.height = moment(event.endsAt || event.startsAt).diff(diffStart, 'minutes') * hourHeightMultiplier;
	          }
	        }

	        if (event.top - event.height > calendarHeight) {
	          event.height = 0;
	        }

	        event.left = 0;

	        return event;
	      }).filter(function(event) {
	        return event.height > 0;
	      }).map(function(event) {

	        var cannotFitInABucket = true;
	        buckets.forEach(function(bucket, bucketIndex) {
	          var canFitInThisBucket = true;

	          bucket.forEach(function(bucketItem) {
	            if (eventIsInPeriod(event, bucketItem.startsAt, bucketItem.endsAt || bucketItem.startsAt) ||
	              eventIsInPeriod(bucketItem, event.startsAt, event.endsAt || event.startsAt)) {
	              canFitInThisBucket = false;
	            }
	          });

	          if (canFitInThisBucket && cannotFitInABucket) {
	            cannotFitInABucket = false;
	            event.left = bucketIndex * 150;
	            buckets[bucketIndex].push(event);
	          }

	        });

	        if (cannotFitInABucket) {
	          event.left = buckets.length * 150;
	          buckets.push([event]);
	        }

	        return event;

	      });

	    }

	    function getWeekViewWithTimes(events, currentDay, dayViewStart, dayViewEnd, dayViewSplit) {
	      var weekView = getWeekView(events, currentDay);
	      var newEvents = [];
	      weekView.days.forEach(function(day) {
	        var dayEvents = weekView.events.filter(function(event) {
	          return moment(event.startsAt).startOf('day').isSame(moment(day.date).startOf('day'));
	        });
	        var newDayEvents = getDayView(
	          dayEvents,
	          day.date,
	          dayViewStart,
	          dayViewEnd,
	          dayViewSplit
	        );
	        newEvents = newEvents.concat(newDayEvents);
	      });
	      weekView.events = newEvents;
	      return weekView;
	    }

	    function getDayViewHeight(dayViewStart, dayViewEnd, dayViewSplit) {
	      var dayViewStartM = moment(dayViewStart || '00:00', 'HH:mm');
	      var dayViewEndM = moment(dayViewEnd || '23:00', 'HH:mm');
	      var hourHeight = (60 / dayViewSplit) * 30;
	      return ((dayViewEndM.diff(dayViewStartM, 'hours') + 1) * hourHeight) + 2;
	    }

	    return {
	      getWeekDayNames: getWeekDayNames,
	      getYearView: getYearView,
	      getMonthView: getMonthView,
	      getWeekView: getWeekView,
	      getDayView: getDayView,
	      getWeekViewWithTimes: getWeekViewWithTimes,
	      getDayViewHeight: getDayViewHeight,
	      adjustEndDateFromStartDiff: adjustEndDateFromStartDiff,
	      formatDate: formatDate,
	      eventIsInPeriod: eventIsInPeriod //expose for testing only
	    };

	  }]);


/***/ },
/* 44 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);

	angular
	  .module('mwl.calendar')
	  .factory('calendarTitle', ["moment", "calendarConfig", "calendarHelper", function(moment, calendarConfig, calendarHelper) {

	    function day(currentDay) {
	      return calendarHelper.formatDate(currentDay, calendarConfig.titleFormats.day);
	    }

	    function week(currentDay) {
	      var weekTitleLabel = calendarConfig.titleFormats.week;
	      return weekTitleLabel.replace('{week}', moment(currentDay).week()).replace('{year}', moment(currentDay).format('YYYY'));
	    }

	    function month(currentDay) {
	      return calendarHelper.formatDate(currentDay, calendarConfig.titleFormats.month);
	    }

	    function year(currentDay) {
	      return calendarHelper.formatDate(currentDay, calendarConfig.titleFormats.year);
	    }

	    return {
	      day: day,
	      week: week,
	      month: month,
	      year: year
	    };

	  }]);


/***/ },
/* 45 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);
	var interact;
	try {
	  interact = __webpack_require__(46);
	} catch (e) {
	  /* istanbul ignore next */
	  interact = null;
	}

	angular
	  .module('mwl.calendar')
	  .constant('interact', interact);


/***/ },
/* 46 */
/***/ function(module, exports) {

	if(typeof __WEBPACK_EXTERNAL_MODULE_46__ === 'undefined') {var e = new Error("Cannot find module \"undefined\""); e.code = 'MODULE_NOT_FOUND'; throw e;}
	module.exports = __WEBPACK_EXTERNAL_MODULE_46__;

/***/ },
/* 47 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var angular = __webpack_require__(13);
	var moment = __webpack_require__(48);

	angular
	  .module('mwl.calendar')
	  .constant('moment', moment);


/***/ },
/* 48 */
/***/ function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_48__;

/***/ }
/******/ ])
});
;
!function () { "use strict"; var e = angular.module("pasvaz.bindonce", []); e.directive("bindonce", function () { var e = function (e) { if (e && 0 !== e.length) { var t = angular.lowercase("" + e); e = !("f" === t || "0" === t || "false" === t || "no" === t || "n" === t || "[]" === t) } else e = !1; return e }, t = parseInt((/msie (\d+)/.exec(angular.lowercase(navigator.userAgent)) || [])[1], 10); isNaN(t) && (t = parseInt((/trident\/.*; rv:(\d+)/.exec(angular.lowercase(navigator.userAgent)) || [])[1], 10)); var r = { restrict: "AM", controller: ["$scope", "$element", "$attrs", "$interpolate", function (r, a, i, n) { var c = function (t, r, a) { var i = "show" === r ? "" : "none", n = "hide" === r ? "" : "none"; t.css("display", e(a) ? i : n) }, o = function (e, t) { if (angular.isObject(t) && !angular.isArray(t)) { var r = []; angular.forEach(t, function (e, t) { e && r.push(t) }), t = r } t && e.addClass(angular.isArray(t) ? t.join(" ") : t) }, s = function (e, t) { e.transclude(t, function (t) { var r = e.element.parent(), a = e.element && e.element[e.element.length - 1], i = r && r[0] || a && a.parentNode, n = a && a.nextSibling || null; angular.forEach(t, function (e) { i.insertBefore(e, n) }) }) }, l = { watcherRemover: void 0, binders: [], group: i.boName, element: a, ran: !1, addBinder: function (e) { this.binders.push(e), this.ran && this.runBinders() }, setupWatcher: function (e) { var t = this; this.watcherRemover = r.$watch(e, function (e) { void 0 !== e && (t.removeWatcher(), t.checkBindonce(e)) }, !0) }, checkBindonce: function (e) { var t = this, r = e.$promise ? e.$promise.then : e.then; "function" == typeof r ? r(function () { t.runBinders() }) : t.runBinders() }, removeWatcher: function () { void 0 !== this.watcherRemover && (this.watcherRemover(), this.watcherRemover = void 0) }, runBinders: function () { for (; this.binders.length > 0;) { var r = this.binders.shift(); if (!this.group || this.group == r.group) { var a = r.scope.$eval(r.interpolate ? n(r.value) : r.value); switch (r.attr) { case "boIf": e(a) && s(r, r.scope.$new()); break; case "boSwitch": var i, l = r.controller[0]; (i = l.cases["!" + a] || l.cases["?"]) && (r.scope.$eval(r.attrs.change), angular.forEach(i, function (e) { s(e, r.scope.$new()) })); break; case "boSwitchWhen": var u = r.controller[0]; u.cases["!" + r.attrs.boSwitchWhen] = u.cases["!" + r.attrs.boSwitchWhen] || [], u.cases["!" + r.attrs.boSwitchWhen].push({ transclude: r.transclude, element: r.element }); break; case "boSwitchDefault": var u = r.controller[0]; u.cases["?"] = u.cases["?"] || [], u.cases["?"].push({ transclude: r.transclude, element: r.element }); break; case "hide": case "show": c(r.element, r.attr, a); break; case "class": o(r.element, a); break; case "text": r.element.text(a); break; case "html": r.element.html(a); break; case "style": r.element.css(a); break; case "src": r.element.attr(r.attr, a), t && r.element.prop("src", a); break; case "attr": angular.forEach(r.attrs, function (e, t) { var a, i; t.match(/^boAttr./) && r.attrs[t] && (a = t.replace(/^boAttr/, "").replace(/([a-z])([A-Z])/g, "$1-$2").toLowerCase(), i = r.scope.$eval(r.attrs[t]), r.element.attr(a, i)) }); break; case "href": case "alt": case "title": case "id": case "value": r.element.attr(r.attr, a) } } } this.ran = !0 } }; return l }], link: function (e, t, r, a) { var i = r.bindonce && e.$eval(r.bindonce); void 0 !== i ? a.checkBindonce(i) : (a.setupWatcher(r.bindonce), t.bind("$destroy", a.removeWatcher)) } }; return r }), angular.forEach([{ directiveName: "boShow", attribute: "show" }, { directiveName: "boHide", attribute: "hide" }, { directiveName: "boClass", attribute: "class" }, { directiveName: "boText", attribute: "text" }, { directiveName: "boBind", attribute: "text" }, { directiveName: "boHtml", attribute: "html" }, { directiveName: "boSrcI", attribute: "src", interpolate: !0 }, { directiveName: "boSrc", attribute: "src" }, { directiveName: "boHrefI", attribute: "href", interpolate: !0 }, { directiveName: "boHref", attribute: "href" }, { directiveName: "boAlt", attribute: "alt" }, { directiveName: "boTitle", attribute: "title" }, { directiveName: "boId", attribute: "id" }, { directiveName: "boStyle", attribute: "style" }, { directiveName: "boValue", attribute: "value" }, { directiveName: "boAttr", attribute: "attr" }, { directiveName: "boIf", transclude: "element", terminal: !0, priority: 1e3 }, { directiveName: "boSwitch", require: "boSwitch", controller: function () { this.cases = {} } }, { directiveName: "boSwitchWhen", transclude: "element", priority: 800, require: "^boSwitch" }, { directiveName: "boSwitchDefault", transclude: "element", priority: 800, require: "^boSwitch" }], function (t) { var r = 200; return e.directive(t.directiveName, function () { var e = { priority: t.priority || r, transclude: t.transclude || !1, terminal: t.terminal || !1, require: ["^bindonce"].concat(t.require || []), controller: t.controller, compile: function (e, r, a) { return function (e, r, i, n) { var c = n[0], o = i.boParent; if (o && c.group !== o) { var s = c.element.parent(); c = void 0; for (var l; 9 !== s[0].nodeType && s.length;) { if ((l = s.data("$bindonceController")) && l.group === o) { c = l; break } s = s.parent() } if (!c) throw new Error("No bindonce controller: " + o) } c.addBinder({ element: r, attr: t.attribute || t.directiveName, attrs: i, value: i[t.directiveName], interpolate: t.interpolate, group: o, transclude: a, controller: n.slice(1), scope: e }) } } }; return e }) }) }();
/*
 * GoJS v1.4.13 JavaScript Library for HTML Canvas Diagrams
 * Northwoods Software, http://www.nwoods.com/
 * GoJS and Northwoods Software are registered trademarks of Northwoods Software Corporation.
 * Copyright (C) 1998-2014 by Northwoods Software Corporation.  All Rights Reserved.
 * THIS SOFTWARE IS LICENSED.  THE LICENSE AGREEMENT IS AT: http://www.gojs.net/1.4.13/doc/license.html.
 */
(function(window) { var aa,ca={};if(void 0===document.createElement("canvas").getContext)throw window.console&&window.console.log("The HTML Canvas element is not supported in this browser,or this browser is in Compatibility mode."),Error("The HTML Canvas element is not supported in this browser,or this browser is in Compatibility mode.");if(!Object.prototype.__defineGetter__&&!Object.defineProperty)throw Error("GoJS requires a newer version of JavaScript");
Object.prototype.__defineGetter__&&!Object.defineProperty&&(Object.defineProperty=function(a,b,c){c.get&&a.__defineGetter__(b,c.get);c.set&&a.__defineSetter__(b,c.set)});Object.prototype.__lookupGetter__&&!Object.getOwnPropertyDescriptor&&(Object.getOwnPropertyDescriptor=function(a,b){return{get:a.__lookupGetter__(b),set:a.__lookupSetter__(b)}});Object.getPrototypeOf||(Object.getPrototypeOf=function(a){return a.__proto__});Object.isFrozen||(Object.isFrozen=function(a){return!0===a.GH});
Object.freeze||(Object.freeze=function(a){a.GH=!0});Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});Function.prototype.bind||(Function.prototype.bind=function(a){function b(){return g.apply(a,f.concat(d.call(arguments)))}function c(){}var d=Array.prototype.slice,f=d.call(arguments,1),g=this;c.prototype=this.prototype;b.prototype=new c;return b});
(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),g=Math.max(8,16-(c-a)),h=window.setTimeout(function(){b(c+g)},g);a=c+g;return h});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();
var e={gj:!1,rA:!1,XE:!1,WI:!1,YI:!1,cG:!1,pF:!1,mE:!1,assert:function(a,b){if(!a&&e.mE)throw window&&(t.trace(b),window.alert(b)),Error(b);},lt:null,enableBoundsInfo:function(a){e.gj=!0;a&&a.Yt()},disableBoundsInfo:function(a){e.gj=!1;a&&(da(a),a.Yt())},UE:function(a,b){void 0===a&&(a=e.lt);void 0===b&&(b=a.sl("").mb);var c=b.length,d=a.Za.getContext("2d");d.fillStyle="rgba(255,255,0,.3)";for(var f=0;f<c;f++){var g=b.wa(f),h=g.pa;if(null!==g.va)e.UE(a,g.va);else{var k=g.Ch.copy();k.XA(g.Oc);d.save();
d.transform(k.m11,k.m12,k.m21,k.m22,k.dx,k.dy);d.fillRect(h.x,h.y,h.width,h.height);d.restore()}}},VE:function(a,b){a||(a=e.lt);b||(b=a.sl("").mb);var c=a.Za.getContext("2d"),d=b.length;c.fillStyle="rgba(0,0,255,.3)";for(var f=0;f<d;f++){var g=b.wa(f),h=g.Ja,k=g.Ch;null!==g.va?e.VE(a,g.va):(c.save(),c.transform(k.m11,k.m12,k.m21,k.m22,k.dx,k.dy),c.fillRect(h.x,h.y,h.width,h.height),c.restore())}},RI:function(a,b){a||(a=e.lt);b||(b=a.sl("").mb);var c=a.Za.getContext("2d"),d=b.length;c.fillStyle="rgba(0,0,255,.3)";
for(var f=0;f<d;f++){var g=b.wa(f),h=g.Ha,k=g.Ch;null!==g.va?e.RI(a,g.va):(c.save(),c.transform(k.m11,k.m12,k.m21,k.m22,k.dx,k.dy),c.fillRect(h.x||0,h.y||0,h.width,h.height),c.restore())}},EK:function(){e.VE();e.UE()},FK:function(a){a||(a=e.lt);var b=a.Lc;a=a.Za.getContext("2d");a.strokeStyle="rgba(0,255,0,.9)";a.strokeRect(b.x,b.y,b.width,b.height)},WE:function(a,b){b.fillStyle="red";b.fillRect(0,0,8,8);b.lineWidth=8;b.strokeStyle="rgba(255,255,0,.6)";var c=a.Ab;b.strokeRect(c.x,c.y,c.width,c.height);
b.fillStyle="rgba(0,255,0,.2)";b.fillRect(a.Lc.x,a.Lc.y,a.Lc.width,a.Lc.height)},SI:function(a,b){b instanceof ea||(a.lineWidth=2,a.strokeStyle="rgba(255,0,0,.5)",a.strokeRect(b.Pb.x,b.Pb.y,b.Pb.width,b.Pb.height),void 0!==b.stroke&&(a.strokeStyle=b.stroke),void 0!==b.qe&&(a.lineWidth=b.qe),null!==b.ia&&b.ia.type===fa&&(a.lineWidth=1,a.strokeStyle="rgba(10,200,10,.6)",void 0!==b.stroke&&(a.strokeStyle=b.stroke),void 0!==b.qe&&(a.lineWidth=b.qe)))},TI:function(a,b){a.lineWidth=1;a.strokeStyle="rgba(0,0,255,.5)";
a.strokeRect(b.Ja.x,b.Ja.y,b.Ja.width,b.Ja.height);void 0!==b.stroke&&(a.strokeStyle=b.stroke);void 0!==b.qe&&(a.lineWidth=b.qe)},qA:function(a,b,c){a.setTransform(c.m11,c.m12,c.m21,c.m22,c.dx,c.dy);c=b.Wb.length;for(var d=0;d<c;d++)for(var f=b.Wb.wa(d),g=f.mb.length,h=0;h<g;h++){var k=f.mb.wa(h);if(void 0!==k.location&&null!==k.location){if(k.location.P()){var l=k.location.x,m=k.location.y;a.beginPath();a.strokeStyle="limegreen";a.lineWidth=2;a.moveTo(l,m+6);a.lineTo(l,m);a.lineTo(l+6,m);a.moveTo(l,
m);a.lineTo(l+10,m+20);a.stroke()}l=k.position.x;m=k.position.y;a.beginPath();a.strokeStyle="red";a.lineWidth=2;a.moveTo(l,m+6);a.lineTo(l,m);a.lineTo(l+6,m);a.moveTo(l,m);a.lineTo(l+20,m+10);a.stroke()}}a.setTransform(1,0,0,1,0,0)},XI:function(a,b,c){var d=a.length;b.fillStyle="rgba(255,0,0,.1)";for(var f=0;f<d;f++){var g=ga(c,a[f]);b.fillRect(g[0],g[1],g[2],g[3])}},UI:function(a,b,c,d,f){a.fillStyle="rgba(0,255,0,.2)";a.fillRect(b,c,d,f)},VI:function(a,b,c){a.save();var d=b.Oc;d.reset();1!==b.fc&&
d.scale(b.fc);b=b.Pa;0===b.x&&0===b.y||d.translate(-b.x,-b.y);a.setTransform(d.m11,d.m12,d.m21,d.m22,d.dx,d.dy);c=c.Bc.n;d=c.length;for(b=0;b<d;b++){var f=c[b];a.beginPath();a.moveTo(f.x-4,f.y);a.lineTo(f.x+4,f.y);a.moveTo(f.x,f.y-4);a.lineTo(f.x,f.y+4);a.lineWidth=2;a.strokeStyle="rgba(255,0,0,.9)";a.stroke()}a.restore()},DK:function(a){a||(a=e.lt);for(a=a.pn;a.next();)t.trace(a.value.toString())},YK:function(a,b){var c=b.dm(a),d=b.dc;d.Wd=b.JB(c);d.da=c;return ha(b,d,a)},VK:function(a,b){b.de(a.da)&&
(b.of.fillStyle="lime",b.of.Rl="lime",b.of.fillRect(a.Wd.x,a.Wd.y,1*b.scale,1*b.scale))},WK:function(a){var b=ia(a,!1,null);if(!b.Ap){a=a.of;for(var c=0;c<=b.Lm;c++)for(var d=0;d<=b.Mm;d++){var f=b.rc[c][d];if(f!==ja){var g=c*b.Fd+b.Of,h=d*b.xd+b.Pf;0!==f&&(a.fillStyle="rgba(255, 0, 0, .2)",a.fillRect(g,h,b.Fd,b.xd));f>=ka||(f%=10,a.fillStyle="blue",a.fillText(f.toString(),g,h+b.xd))}}}},$I:function(a){if(a instanceof v)for(a=a.pn;a.next();){var b=a.value;t.trace(b.toString());for(b=b.vj;b.next();)e.$I(b.value)}else if(a instanceof
x){t.trace("References for "+a);a.layer&&t.trace("  "+a.layer.toString()+' LayerName: "'+a.Ne+'"');a.An!==a&&t.trace("  SelectionObject: "+a.An.toString()+' SelectionObjectName: "'+a.du+'"');a.Zb!==a&&t.trace("  LocationObject: "+a.Zb.toString()+' LocationObjectName: "'+a.Jt+'"');if(a.Vg){for(var c="",b=a.Vg.k;b.next();)c+=b.key+" ";t.trace("  Adornments: "+c)}a.fb&&t.trace("  ContainingGroup: "+a.fb.toString());if(a instanceof y){if(a.Ad)for(b=a.Ad.k;b.next(););if(0<a.Td.count){c="";for(b=a.Td;b.next();)c+=
b.value.toString()+", ";t.trace("  Links: "+c)}a.Dd&&t.trace("  LabeledLink: "+a.Dd.toString());if(a instanceof z){t.trace("  Placeholder: "+a.placeholder);c="";for(b=a.Vc;b.next();)c+=b.value.toString()+", ";t.trace("  Members: "+c);c="";for(b=a.um.k;b.next();)c+=b.value.toString()+", ";t.trace("  NestedGroups: "+c);t.trace("  Layout: "+a.ic)}}else if(a instanceof B){t.trace("  Path: "+a.path);t.trace("  From: "+a.ca+" "+a.sd+' "'+a.Af+'"');t.trace("  To: "+a.fa+" "+a.Vd+' "'+a.dg+'"');c="";for(b=
a.sj;b.next();)c+=b.value.toString()+", ";t.trace("  LabelNodes: "+c)}}},aJ:function(a){if(a instanceof v)for(a=a.pn;a.next();){var b=a.value;t.trace(b.toString());for(b=b.vj;b.next();)e.aJ(b.value)}else a instanceof x&&(b=" ",a.lA&&(b+="c"),a.nA&&(b+="d"),a.DA&&(b+="g"),a.WA&&(b+="m"),a.oB&&(b+="h"),a.pB&&(b+="z"),a.qB&&(b+="o"),a.uk&&(b+="s"),a.DB&&(b+="t"),a.tB&&(b+="A"),a.hx&&(b+="B"),a.jx&&(b+="L"),a.ib&&(b+="S"),a.qi&&(b+="H"),e.DC(a,1,b))},DC:function(a,b,c){for(var d="",f=0;f<b;f++)d+="  ";
d+=a.toString();c&&(d+=c);c=" ";c=a.visible?c+"v":c+"~";a.kf&&(c+="p");a.oi&&(c+="m");a.Bt&&(c+="a");d=d+c+(" "+a.pa.toString());a.Ea.P()&&(d+=" d:"+a.Ea.toString());a.Ja.P()&&(d+=" n:"+a.Ja.toString());1!==a.scale&&(d+=" s:"+a.scale);0!==a.angle&&(d+=" a:"+a.angle);null!==a.background&&(d+=" b:"+a.background.toString());null!==a.hk&&(d+=" a:"+a.background.toString());a instanceof C&&(d+=" elts:"+a.va.count,0!==a.IB&&(d+=" top:"+a.IB),0!==a.OA&&(d+=" left:"+a.OA),null!==a.Ht&&(d+=" itemArray#:"+t.ub(a.Ht)),
a.zJ&&(d+=" cat:"+a.zJ),null!==a.data&&(d+=" data:"+a.data));t.trace(d);if(a instanceof C)for(a=a.elements;a.next();)e.DC(a.value,b+1,"")},GK:function(a){t.trace("DelayedReferences ("+a.hg.count+")");for(a=a.hg.k;a.next();){for(var b="",c=a.value.k;c.next();)b+=na(c.value)+", ";t.trace("  "+a.key+": "+b)}}};ca.Debug=e;
var t={xi:Object.freeze([]),xA:{},dF:0,Uw:{},wA:0,ot:"...",yt:{},$w:0,KB:[],zx:null,Dn:document.createElement("canvas").getContext("2d"),fq:"",BK:document.createElement("img"),oA:[],CB:"ontouchstart"in window,aL:"ongesturestart"in window,KE:!1,ht:null,it:null,gt:null,yw:"",kn:window.navigator&&0<window.navigator.userAgent.indexOf("534.30")&&0<window.navigator.userAgent.indexOf("Android"),gx:window.navigator&&0<window.navigator.userAgent.indexOf("MSIE 10.0"),LA:window.navigator&&0<window.navigator.userAgent.indexOf("Trident/7"),
ln:0<=navigator.platform.toUpperCase().indexOf("MAC"),iH:!1,lH:!1,kH:!1,jH:!1,LE:null,mq:!1,gH:!1,hH:!1,HE:function(a,b,c){var d;return function(){var f=this,g=arguments;clearTimeout(d);d=setTimeout(function(){d=null;c||a.apply(f,g)},b);c&&!d&&a.apply(f,g)}},m:function(a){e&&e.mE&&alert(a);throw Error(a);},J:function(a,b){if(a.tb){var c="The object is frozen, so its properties cannot be set: "+a.toString();void 0!==b&&(c+="  to value: "+b);t.m(c)}},l:function(a,b,c,d){a instanceof b||(c=t.li(c),void 0!==
d&&(c+="."+d),t.jc(a,b,c))},i:function(a,b,c,d){typeof a!==b&&(c=t.li(c),void 0!==d&&(c+="."+d),t.jc(a,b,c))},q:function(a,b,c){"number"===typeof a&&isFinite(a)||(b=t.li(b),void 0!==c&&(b+="."+c),t.m(b+" must be a real number type, and not NaN or Infinity: "+a))},Fa:function(a,b,c,d){a instanceof oa&&a.Xe===b||(c=t.li(c),void 0!==d&&(c+="."+d),t.jc(a,"a constant of class "+t.Dg(b),c))},fp:function(a,b){"string"===typeof a?pa(a)||t.m('Color "'+a+'" is not a valid color string for '+b):a instanceof
qa||t.m("Value for "+b+" must be a color string or a Brush, not "+a)},jc:function(a,b,c,d){b=t.li(b);c=t.li(c);void 0!==d&&(c+="."+d);"string"===typeof a?t.m(c+" value is not an instance of "+b+': "'+a+'"'):t.m(c+" value is not an instance of "+b+": "+a)},ha:function(a,b,c,d){c=t.li(c);void 0!==d&&(c+="."+d);t.m(c+" is not in the range "+b+": "+a)},fd:function(a){t.m(t.Dg(a)+" constructor cannot take any arguments.")},Ub:function(a){t.m("Collection was modified during iteration: "+a.toString()+"\n  Perhaps you should iterate over a copy of the collection,\n  or you could collect items to be removed from the collection after the iteration.")},
trace:function(a){/*window&&window.console&&window.console.log(a)*/},xb:function(a){return"object"===typeof a&&null!==a},Ec:null,on:function(a,b,c,d){for(b=0;b<a.length;b++){var f=a[b];t.xb(f)&&(f=t.Df(f,c,d));a[b]=f}return d||t.Ec(a)?a:window.ko.observableArray(a)},Df:function(a,b,c){if(a)for(var d in a)"__gohashid"!==d&&(a[d]=t.FJ(a,d,b,c));return a},FJ:function(a,b,c,d){var f=a[b],g;g=t.Ec(f)?f:Array.isArray(f)?t.on(f,b,c,d):window.ko.observable(f);if(d){if(d=g.bC){h=c.__gohashid;d[h]&&(d[h].dispose(),
delete d[h]);var h=!1,k;for(k in d){h=!0;break}}!h&&g.Eu&&(g.Eu.dispose(),delete g.Eu)}else{g.Eu||(g.Eu=g.subscribe(function(a){g.Jo=a},null,"beforeChange"));d=g.bC;d||(g.bC=d={});var h=c.__gohashid;d[h]||(d[h]=g.subscribe(function(d){c.Ax(a,b,g.Jo,d)}))}return g},isArray:function(a){return Array.isArray(a)||t.Ec&&t.Ec(a)||a instanceof NodeList||a instanceof HTMLCollection},uJ:function(a){return Array.isArray(a)||t.Ec&&t.Ec(a)},ft:function(a,b,c){t.isArray(a)||t.jc(a,"Array or NodeList or HTMLCollection",
b,c)},ub:function(a){t.Ec&&t.Ec(a)&&(a=a());return a.length},rb:function(a,b){t.Ec&&t.Ec(a)&&(a=a());Array.isArray(a);return a[b]},kE:function(a,b,c){t.Ec&&t.Ec(a)&&(a=a());Array.isArray(a)?a[b]=c:t.m("Cannot replace an object in an HTMLCollection or NodeList at "+b)},cA:function(a,b){t.Ec&&t.Ec(a)&&(a=a());if(Array.isArray(a))return a.indexOf(b);for(var c=a.length,d=0;d<c;d++)if(a[d]===b)return d;return-1},ej:function(a,b,c){t.Ec&&t.Ec(a)&&(a=a());Array.isArray(a)?b>=a.length?a.push(c):a.splice(b,
0,c):t.m("Cannot insert an object into an HTMLCollection or NodeList: "+c+" at "+b)},fj:function(a,b){t.Ec&&t.Ec(a)&&(a=a());Array.isArray(a)?b>=a.length?a.pop():a.splice(b,1):t.m("Cannot remove an object from an HTMLCollection or NodeList at "+b)},sy:[],N:function(){var a=t.sy.pop();return void 0===a?new E:a},qc:function(a,b){var c=t.sy.pop();if(void 0===c)return new E(a,b);c.x=a;c.y=b;return c},B:function(a){t.sy.push(a)},YB:[],Ml:function(){var a=t.YB.pop();return void 0===a?new ra:a},qk:function(a){t.YB.push(a)},
ty:[],Jf:function(){var a=t.ty.pop();return void 0===a?new F:a},wk:function(a,b,c,d){var f=t.ty.pop();if(void 0===f)return new F(a,b,c,d);f.x=a;f.y=b;f.width=c;f.height=d;return f},oc:function(a){t.ty.push(a)},ZB:[],Ah:function(){var a=t.ZB.pop();return void 0===a?new ta:a},bf:function(a){t.ZB.push(a)},uy:null,u:function(){var a=t.uy;return null!==a?(t.uy=null,a):new ua},v:function(a){a.reset();t.uy=a},XB:[],Hb:function(){var a=t.XB.pop();return void 0===a?[]:a},Ca:function(a){a.length=0;t.XB.push(a)},
$B:1,Fc:function(a){a.__gohashid=t.$B++},xt:function(a){var b=a.__gohashid;void 0===b&&(b=t.$B++,a.__gohashid=b);return b},ud:function(a){return a.__gohashid},g:function(a,b,c){"name"!==b&&"length"!==b&&(a[b]=c)},ka:function(a,b){b.Cy=a;ca[a]=b},Qa:function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a},ii:function(a){a.KH=!0},defineProperty:function(a,b,c,d,f){t.i(a,"function","Util.defineProperty:classfunc");t.i(b,"object","Util.defineProperty:propobj");
t.i(c,"function","Util.defineProperty:getter");t.i(d,"function","Util.defineProperty:setter");for(var g in b){var h=b[g];b={get:c,set:d};if(void 0!==f)for(var k in f)b[k]=f[k];Object.defineProperty(a.prototype,g,b);f=Object.getOwnPropertyDescriptor(a.prototype,g);h&&f&&Object.defineProperty(a.prototype,h,f);if(e&&h){var l=h.charAt(0).toUpperCase()+h.slice(1);h===l&&t.m('Defining capitalized property "'+l+'"!?');Object.defineProperty(a.prototype,l,{get:function(){t.gx||t.LA||t.trace('Getting the property "'+
l+'" is probably not what you intended: it is capitalized but should be spelled "'+h+'"')},set:function(){t.m('Setting the property "'+l+'" is probably not what you intended: it is capitalized but should be spelled "'+h+'"')}})}break}},A:function(a,b,c,d){t.i(a,"function","Util.defineReadOnlyProperty:classfunc");t.i(b,"object","Util.defineReadOnlyProperty:propobj");t.i(c,"function","Util.defineReadOnlyProperty:getter");for(var f in b){var g=b[f];b={get:c,set:function(a){t.m('The property "'+g+'" is read-only and cannot be set to '+
a)}};if(void 0!==d)for(var h in d)b[h]=d[h];Object.defineProperty(a.prototype,f,b);d=Object.getOwnPropertyDescriptor(a.prototype,f);g&&d&&Object.defineProperty(a.prototype,g,d);if(e&&g){var k=g.charAt(0).toUpperCase()+g.slice(1);Object.defineProperty(a.prototype,k,{get:function(){t.gx||t.LA||t.trace('Getting the property "'+k+'" is probably not what you intended: it is capitalized but should be spelled "'+g+'"')},set:function(){t.m('Setting the read-only property "'+k+'" is probably not what you intended: it is capitalized but should be spelled "'+
g+'", and cannot be set anyway')}})}break}},ce:function(a,b){for(var c in b)b[c]=!0;a.prototype.uD=b},li:function(a){return void 0===a?"":"string"===typeof a?a:"function"===typeof a?t.Dg(a):null===a?"*":""},Dg:function(a){if("function"===typeof a){if(a.Cy)return a.Cy;if(a.name)return a.name;var b=a.toString(),c=b.indexOf("(");if(b=b.substring(9,c).trim())return a.Cy=b}else if("object"===typeof a&&a.constructor)return t.Dg(a.constructor);return typeof a},w:function(a,b,c){t.i(a,"function","Util.defineEnumValue:classfunc");
t.i(b,"string","Util.defineEnumValue:name");t.i(c,"number","Util.defineEnumValue:num");c=new oa(a,b,c);Object.freeze(c);a[b]=c;var d=a.ru;d||(d=new wa("string",oa),a.ru=d);d.add(b,c);return c},en:function(a,b){if(!b)return null;t.i(a,"function","Util.findEnumValueForName:classfunc");t.i(b,"string","Util.findEnumValueForName:name");var c=a.ru;return c?c.Da(b):null},wI:function(a,b,c,d){var f={},g;for(g in a){for(var h=!1,k=1;k<arguments.length;k++)if(arguments[k]===g){h=!0;break}h||(f[g]=a[g])}return f},
nb:function(a,b){if(!a||!b)return null;var c=void 0;try{"function"===typeof b?c=b(a):"function"===typeof a.getAttribute?(c=a.getAttribute(b),null===c&&(c=void 0)):(c=a[b],t.Ec&&t.Ec(c)&&(c=c()))}catch(d){e&&t.trace("property get error: "+d.toString())}return c},Va:function(a,b,c){if(a&&b)try{if("function"===typeof b)b(a,c);else if("function"===typeof a.setAttribute)a.setAttribute(b,c);else if(t.Ec){var d=a[b];t.Ec(d)?d(c):a[b]=c}else a[b]=c}catch(f){e&&t.trace("property set error: "+f.toString())}},
Gx:function(a,b){t.i(a,"object","Setting properties requires Objects as arguments");t.i(b,"object","Setting properties requires Objects as arguments");var c=e;c||(e=t);var d=a instanceof C,f=a instanceof v,g;for(g in b){g||t.m("Setting properties requires non-empty property names");var h=a,k=g;if(d||f){var l=g.indexOf(".");if(0<l){var m=g.substring(0,l);d?h=a.ue(m):(h=a[m])||(h=a.Cb[m]);h?k=g.substr(l+1):t.m("Unable to find object named: "+m+" in "+a.toString()+" when trying to set property: "+g)}}if("_"!==
k[0]&&!t.Yw(h,k))if(f&&t.Yw(a.Cb,k))h=a.Cb;else if(f&&xa(a,k)){a.Xz(k,b[k]);continue}else t.m('Trying to set undefined property "'+k+'" on object: '+h.toString());h[k]=b[g];"_"===k[0]&&(l=h.Xl,l||(l=[],h.Xl=l),l.push(k))}e=c;return a},Yw:function(a,b){for(var c=Object.getPrototypeOf(a);c&&c!==Function;){if(c.hasOwnProperty(b))return!0;var d=c.uD;if(d&&d[b])return!0;c=Object.getPrototypeOf(c)}return!1},rE:function(a,b){if(!t.xb(b)||b instanceof Element||b instanceof CanvasRenderingContext2D)return"";
var c="",d;for(d in b)if("string"!==typeof d)""===c&&(c=b+"\n"),c+="  "+d+" is not a string property\n";else if("_"!==d.charAt(0)&&!(2>=d.length)){var f=t.nb(b,d);null===f||"function"===typeof f||t.Yw(b,d)||(""===c&&(c=b+"\n"),c+='  unknown property "'+d+'" has value: '+f+" at "+a+"\n")}return c},ww:function(a,b){if(b&&"number"!==typeof b&&"string"!==typeof b&&"boolean"!==typeof b&&"function"!==typeof b)if(void 0!==t.ud(b)){if(!t.Vv.contains(b))if(t.Vv.add(b),t.vv.add(t.rE(a,b)),b instanceof H||b instanceof
I||b instanceof wa)for(var c=b.k;c.next();)t.ww(a+"["+c.key+"]",c.value);else for(c in b){var d=t.nb(b,c);if(void 0!==d&&null!==d&&t.xb(d)&&d!==b.uD){if(b instanceof za){if(d===b.Eo)continue}else if(b instanceof C){if("data"===c||d===b.Zl)continue;if("itemArray"===c||d===b.Li)continue;if(b instanceof x&&d===b.Uj)continue}else if(!(b instanceof v))if(b instanceof Ba){if("archetypeGroupData"===c||d===b.xy)continue}else if(b instanceof Ca){if("archetypeLinkData"===c||d===b.zy)continue;if("archetypeLabelNodeData"===
c||d===b.yy)continue}else if(b instanceof Da){if("archetypeNodeData"===c||d===b.Kk)continue}else if(b instanceof J){if("nodeDataArray"===c||d===b.Se)continue;if("linkDataArray"===c||d===b.gh||d===b.pm)continue;if(d===b.Gc)continue;if(d===b.hg)continue}else if(b instanceof Ea||b instanceof Fa||b instanceof Ha)continue;t.ww(a+"."+c,d)}}}else if(Array.isArray(b))for(c=0;c<b.length;c++)t.ww(a+"["+c+"]",b[c]);else t.vv.add(t.rE(a,b))},rI:function(a){void 0===t.Vv?t.Vv=new I:t.Vv.clear();t.vv=new Ka;t.ww("",
a);a=t.vv.toString();t.vv=null;return a},aK:function(a){for(var b=[],c=0;256>c;c++)b[c]=c;for(var d=0,f,c=0;256>c;c++)d=(d+b[c]+119)%256,f=b[c],b[c]=b[d],b[d]=f;for(var d=c=0,g="",h=0;h<a.length;h++)c=(c+1)%256,d=(d+b[c])%256,f=b[c],b[c]=b[d],b[d]=f,g+=String.fromCharCode(a.charCodeAt(h)^b[(b[c]+b[d])%256]);return g},mJ:function(a){for(var b=[],c=0;256>c;c++)b["0123456789abcdef".charAt(c>>4)+"0123456789abcdef".charAt(c&15)]=String.fromCharCode(c);a.length%2&&(a="0"+a);for(var d=[],f=0,c=0;c<a.length;c+=
2)d[f++]=b[a.substr(c,2)];a=d.join("");return""===a?"0":a},Ma:function(a){return t.aK(t.mJ(a))},Ql:null,qw:"69bd1ba7ec221a8850924c6711642ef45bfd21",sI:"28fb41",tI:"2bf147"};
t.Ql=function(){var a=document.createElement("canvas"),b=a.getContext("2d");b[t.Ma("7ca11abfd022028846")]=t.Ma("398c3597c01238");for(var c=["5da73c80a3330d854f9e5e671d6633","32ab5ff3b26f42dc0ed90f22402913b54ae6247590da4bb21c324ba3a84e385776","54a702f3e53909c447824c6706603faf4cfb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387","74bf19bce72555874c86"],d=1;5>d;d++)b[t.Ma("7ca11abfd7330390")](t.Ma(c[d-1]),10,15*d+0);b[t.Ma("7ca11abfd022028846")]=t.Ma("39f046ebb36e4b");for(d=1;5>d;d++)b[t.Ma("7ca11abfd7330390")](t.Ma(c[d-
1]),10,15*d+0);if(4!==c.length||"5"!==c[0][0]||"7"!==c[3][0])t.w=function(a,b){var c=new oa(a,b,2);Object.freeze(c);a[b]=c;var d=a.ru;d||(d=new wa("string",oa),a.ru=d);d.add(b,c);return c};return a}();function oa(a,b,c){t.Fc(this);this.hC=a;this.ec=b;this.PH=c}oa.prototype.toString=function(){return t.Dg(this.hC)+"."+this.ec};t.A(oa,{Xe:"classType"},function(){return this.hC});t.A(oa,{name:"name"},function(){return this.ec});t.A(oa,{value:"value"},function(){return this.PH});
function Ka(){this.gC=[]}Ka.prototype.toString=function(){return this.gC.join("")};Ka.prototype.add=function(a){a&&this.gC.push(a)};function La(){}t.A(La,{k:"iterator"},function(){return this});La.prototype.reset=La.prototype.reset=function(){};La.prototype.next=La.prototype.hasNext=La.prototype.next=function(){return!1};La.prototype.first=La.prototype.gb=function(){return null};La.prototype.any=function(){return!1};La.prototype.all=function(){return!0};La.prototype.each=function(){};
t.A(La,{count:"count"},function(){return 0});La.prototype.ig=function(){};La.prototype.toString=function(){return"EmptyIterator"};t.fg=new La;function Ma(a){this.key=-1;this.value=a}t.ce(Ma,{key:!0,value:!0});t.A(Ma,{k:"iterator"},function(){return this});Ma.prototype.reset=Ma.prototype.reset=function(){this.key=-1};Ma.prototype.next=Ma.prototype.hasNext=Ma.prototype.next=function(){return-1===this.key?(this.key=0,!0):!1};Ma.prototype.first=Ma.prototype.gb=function(){this.key=0;return this.value};
Ma.prototype.any=function(a){this.key=-1;return a(this.value)};Ma.prototype.all=function(a){this.key=-1;return a(this.value)};Ma.prototype.each=function(a){this.key=-1;a(this.value)};t.A(Ma,{count:"count"},function(){return 1});Ma.prototype.ig=function(){this.value=null};Ma.prototype.toString=function(){return"SingletonIterator("+this.value+")"};function Oa(a){this.Ld=a;this.Xj=null;this.reset()}t.ce(Oa,{key:!0,value:!0});t.A(Oa,{k:"iterator"},function(){return this});t.g(Oa,"predicate",Oa.prototype.Fl);
t.defineProperty(Oa,{Fl:"predicate"},function(){return this.Xj},function(a){this.Xj=a});Oa.prototype.reset=Oa.prototype.reset=function(){var a=this.Ld;a.Kd=null;this.cb=a.Y;this.Zc=-1};Oa.prototype.next=Oa.prototype.hasNext=Oa.prototype.next=function(){var a=this.Ld;a.Y!==this.cb&&t.Ub(a);var a=a.n,b=a.length,c=++this.Zc,d=this.Xj;if(null!==d)for(;c<b;){var f=a[c];if(d(f))return this.key=this.Zc=c,this.value=f,!0;c++}else{if(c<b)return this.key=c,this.value=a[c],!0;this.ig()}return!1};
Oa.prototype.first=Oa.prototype.gb=function(){var a=this.Ld;this.cb=a.Y;this.Zc=0;var a=a.n,b=a.length,c=this.Xj;if(null!==c){for(var d=0;d<b;){var f=a[d];if(c(f))return this.key=this.Zc=d,this.value=f;d++}return null}return 0<b?(f=a[0],this.key=0,this.value=f):null};Oa.prototype.any=function(a){var b=this.Ld;b.Kd=null;var c=b.Y;this.Zc=-1;for(var d=b.n,f=d.length,g=this.Xj,h=0;h<f;h++){var k=d[h];if(null===g||g(k)){if(a(k))return!0;b.Y!==c&&t.Ub(b)}}return!1};
Oa.prototype.all=function(a){var b=this.Ld;b.Kd=null;var c=b.Y;this.Zc=-1;for(var d=b.n,f=d.length,g=this.Xj,h=0;h<f;h++){var k=d[h];if(null===g||g(k)){if(!a(k))return!1;b.Y!==c&&t.Ub(b)}}return!0};Oa.prototype.each=function(a){var b=this.Ld;b.Kd=null;var c=b.Y;this.Zc=-1;for(var d=b.n,f=d.length,g=this.Xj,h=0;h<f;h++){var k=d[h];if(null===g||g(k))a(k),b.Y!==c&&t.Ub(b)}};t.A(Oa,{count:"count"},function(){var a=this.Xj;if(null!==a){for(var b=0,c=this.Ld.n,d=c.length,f=0;f<d;f++)a(c[f])&&b++;return b}return this.Ld.n.length});
Oa.prototype.ig=function(){this.key=-1;this.value=null;this.cb=-1;this.Xj=null;this.Ld.Kd=this};Oa.prototype.toString=function(){return"ListIterator@"+this.Zc+"/"+this.Ld.count};function Qa(a){this.Ld=a;this.reset()}t.ce(Qa,{key:!0,value:!0});t.A(Qa,{k:"iterator"},function(){return this});Qa.prototype.reset=Qa.prototype.reset=function(){var a=this.Ld;a.yo=null;this.cb=a.Y;this.Zc=a.n.length};
Qa.prototype.next=Qa.prototype.hasNext=Qa.prototype.next=function(){var a=this.Ld;a.Y!==this.cb&&t.Ub(a);var b=--this.Zc;if(0<=b)return this.key=b,this.value=a.n[b],!0;this.ig();return!1};Qa.prototype.first=Qa.prototype.gb=function(){var a=this.Ld;this.cb=a.Y;var b=a.n;this.Zc=a=b.length-1;return 0<=a?(b=b[a],this.key=a,this.value=b):null};Qa.prototype.any=function(a){var b=this.Ld;b.yo=null;var c=b.Y,d=b.n,f=d.length;this.Zc=f;for(f-=1;0<=f;f++){if(a(d[f]))return!0;b.Y!==c&&t.Ub(b)}return!1};
Qa.prototype.all=function(a){var b=this.Ld;b.yo=null;var c=b.Y,d=b.n,f=d.length;this.Zc=f;for(f-=1;0<=f;f++){if(!a(d[f]))return!1;b.Y!==c&&t.Ub(b)}return!0};Qa.prototype.each=function(a){var b=this.Ld;b.yo=null;var c=b.Y,d=b.n,f=d.length;this.Zc=f;for(f-=1;0<=f;f++)a(d[f]),b.Y!==c&&t.Ub(b)};t.A(Qa,{count:"count"},function(){return this.Ld.n.length});Qa.prototype.ig=function(){this.key=-1;this.value=null;this.cb=-1;this.Ld.yo=this};
Qa.prototype.toString=function(){return"ListIteratorBackwards("+this.Zc+"/"+this.Ld.count+")"};
function H(a){t.Fc(this);this.tb=!1;this.n=[];this.Y=0;this.yo=this.Kd=null;void 0===a||null===a?this.ga=null:"string"===typeof a?"object"===a||"string"===a||"number"===a||"boolean"===a||"function"===a?this.ga=a:t.ha(a,"the string 'object', 'number', 'string', 'boolean', or 'function'","List constructor: type"):"function"===typeof a?this.ga=a===Object?"object":a===String?"string":a===Number?"number":a===Boolean?"boolean":a===Function?"function":a:t.ha(a,"null, a primitive type name, or a class type",
"List constructor: type")}t.ka("List",H);H.prototype.Xg=function(a){null!==this.ga&&("string"===typeof this.ga?typeof a===this.ga&&null!==a||t.jc(a,this.ga):a instanceof this.ga||t.jc(a,this.ga))};H.prototype.Zd=function(){var a=this.Y;a++;999999999<a&&(a=0);this.Y=a};H.prototype.freeze=H.prototype.freeze=function(){this.tb=!0;return this};H.prototype.thaw=H.prototype.Ra=function(){this.tb=!1;return this};H.prototype.toString=function(){return"List("+t.li(this.ga)+")#"+t.ud(this)};
H.prototype.add=H.prototype.add=function(a){null!==a&&(e&&this.Xg(a),t.J(this,a),this.n.push(a),this.Zd())};H.prototype.addAll=H.prototype.Ue=function(a){if(null===a)return this;t.J(this);var b=this.n;if(t.isArray(a))for(var c=t.ub(a),d=0;d<c;d++){var f=t.rb(a,d);e&&this.Xg(f);b.push(f)}else for(a=a.k;a.next();)f=a.value,e&&this.Xg(f),b.push(f);this.Zd();return this};H.prototype.clear=H.prototype.clear=function(){t.J(this);this.n.length=0;this.Zd()};
H.prototype.contains=H.prototype.has=H.prototype.contains=function(a){if(null===a)return!1;e&&this.Xg(a);return-1!==this.n.indexOf(a)};H.prototype.indexOf=H.prototype.indexOf=function(a){if(null===a)return-1;e&&this.Xg(a);return this.n.indexOf(a)};H.prototype.elt=H.prototype.get=H.prototype.wa=function(a){e&&t.q(a,H,"elt:i");var b=this.n;(0>a||a>=b.length)&&t.ha(a,"0 <= i < length",H,"elt:i");return b[a]};
H.prototype.setElt=H.prototype.set=H.prototype.Tg=function(a,b){e&&(this.Xg(b),t.q(a,H,"setElt:i"));var c=this.n;(0>a||a>=c.length)&&t.ha(a,"0 <= i < length",H,"setElt:i");t.J(this,a);c[a]=b};H.prototype.first=H.prototype.gb=function(){var a=this.n;return 0===a.length?null:a[0]};H.prototype.any=function(a){for(var b=this.n,c=this.Y,d=b.length,f=0;f<d;f++){if(a(b[f]))return!0;this.Y!==c&&t.Ub(this)}return!1};
H.prototype.all=function(a){for(var b=this.n,c=this.Y,d=b.length,f=0;f<d;f++){if(!a(b[f]))return!1;this.Y!==c&&t.Ub(this)}return!0};H.prototype.each=function(a){for(var b=this.n,c=this.Y,d=b.length,f=0;f<d;f++)a(b[f]),this.Y!==c&&t.Ub(this)};H.prototype.insertAt=H.prototype.Pd=function(a,b){e&&(this.Xg(b),t.q(a,H,"insertAt:i"));0>a&&t.ha(a,">= 0",H,"insertAt:i");t.J(this,a);var c=this.n;a>=c.length?c.push(b):c.splice(a,0,b);this.Zd();return!0};
H.prototype.remove=H.prototype["delete"]=H.prototype.remove=function(a){if(null===a)return!1;e&&this.Xg(a);t.J(this,a);var b=this.n;a=b.indexOf(a);if(-1===a)return!1;a===b.length-1?b.pop():b.splice(a,1);this.Zd();return!0};H.prototype.removeAt=H.prototype.wd=function(a){e&&t.q(a,H,"removeAt:i");var b=this.n;(0>a||a>=b.length)&&t.ha(a,"0 <= i < length",H,"removeAt:i");t.J(this,a);a===b.length-1?b.pop():b.splice(a,1);this.Zd()};
H.prototype.removeRange=H.prototype.removeRange=function(a,b){e&&(t.q(a,H,"removeRange:from"),t.q(b,H,"removeRange:to"));var c=this.n;(0>a||a>=c.length)&&t.ha(a,"0 <= from < length",H,"elt:from");(0>b||b>=c.length)&&t.ha(b,"0 <= to < length",H,"elt:to");t.J(this,a);var d=c.slice((b||a)+1||c.length);c.length=0>a?c.length+a:a;c.push.apply(c,d);this.Zd()};H.prototype.copy=function(){for(var a=new H(this.ga),b=this.n,c=this.count,d=0;d<c;d++)a.add(b[d]);return a};
H.prototype.toArray=H.prototype.Pe=function(){for(var a=this.n,b=this.count,c=Array(b),d=0;d<b;d++)c[d]=a[d];return c};H.prototype.toSet=function(){for(var a=new I(this.ga),b=this.n,c=this.count,d=0;d<c;d++)a.add(b[d]);return a};H.prototype.sort=H.prototype.sort=function(a){e&&t.i(a,"function",H,"sort:sortfunc");t.J(this);this.n.sort(a);this.Zd();return this};
H.prototype.sortRange=H.prototype.gq=function(a,b,c){var d=this.n,f=d.length;void 0===b&&(b=0);void 0===c&&(c=f);e&&(t.i(a,"function",H,"sortRange:sortfunc"),t.q(b,H,"sortRange:from"),t.q(c,H,"sortRange:to"));t.J(this);var g=c-b;if(1>=g)return this;(0>b||b>=f-1)&&t.ha(b,"0 <= from < length",H,"sortRange:from");if(2===g)return c=d[b],f=d[b+1],0<a(c,f)&&(d[b]=f,d[b+1]=c,this.Zd()),this;if(0===b)if(c>=f)d.sort(a);else for(g=d.slice(0,c),g.sort(a),a=0;a<c;a++)d[a]=g[a];else if(c>=f)for(g=d.slice(b),g.sort(a),
a=b;a<f;a++)d[a]=g[a-b];else for(g=d.slice(b,c),g.sort(a),a=b;a<c;a++)d[a]=g[a-b];this.Zd();return this};H.prototype.reverse=H.prototype.reverse=function(){t.J(this);this.n.reverse();this.Zd();return this};t.A(H,{count:"count"},function(){return this.n.length});t.A(H,{size:"size"},function(){return this.n.length});t.A(H,{length:"length"},function(){return this.n.length});t.A(H,{k:"iterator"},function(){if(0>=this.n.length)return t.fg;var a=this.Kd;return null!==a?(a.reset(),a):new Oa(this)});
t.A(H,{nn:"iteratorBackwards"},function(){if(0>=this.n.length)return t.fg;var a=this.yo;return null!==a?(a.reset(),a):new Qa(this)});function Ra(a){this.p=a;this.reset()}t.ce(Ra,{key:!0,value:!0});t.A(Ra,{k:"iterator"},function(){return this});Ra.prototype.reset=Ra.prototype.reset=function(){var a=this.p;a.Kd=null;this.cb=a.Y;this.Db=null};
Ra.prototype.next=Ra.prototype.hasNext=Ra.prototype.next=function(){var a=this.p;a.Y!==this.cb&&t.Ub(a);var b=this.Db,b=null===b?a.kb:b.Yb;if(null!==b)return this.Db=b,this.value=b.value,this.key=b.key,!0;this.ig();return!1};Ra.prototype.first=Ra.prototype.gb=function(){var a=this.p;this.cb=a.Y;a=a.kb;if(null!==a){this.Db=a;var b=a.value;this.key=a.key;return this.value=b}return null};
Ra.prototype.any=function(a){var b=this.p;b.Kd=null;var c=b.Y;this.Db=null;for(var d=b.kb;null!==d;){if(a(d.value))return!0;b.Y!==c&&t.Ub(b);d=d.Yb}return!1};Ra.prototype.all=function(a){var b=this.p;b.Kd=null;var c=b.Y;this.Db=null;for(var d=b.kb;null!==d;){if(!a(d.value))return!1;b.Y!==c&&t.Ub(b);d=d.Yb}return!0};Ra.prototype.each=function(a){var b=this.p;b.Kd=null;var c=b.Y;this.Db=null;for(var d=b.kb;null!==d;)a(d.value),b.Y!==c&&t.Ub(b),d=d.Yb};t.A(Ra,{count:"count"},function(){return this.p.kd});
Ra.prototype.ig=function(){this.value=this.key=null;this.cb=-1;this.p.Kd=this};Ra.prototype.toString=function(){return null!==this.Db?"SetIterator@"+this.Db.value:"SetIterator"};
function I(a){t.Fc(this);this.tb=!1;void 0===a||null===a?this.ga=null:"string"===typeof a?"object"===a||"string"===a||"number"===a?this.ga=a:t.ha(a,"the string 'object', 'number' or 'string'","Set constructor: type"):"function"===typeof a?this.ga=a===Object?"object":a===String?"string":a===Number?"number":a:t.ha(a,"null, a primitive type name, or a class type","Set constructor: type");this.ld={};this.kd=0;this.Kd=null;this.Y=0;this.Uh=this.kb=null}t.ka("Set",I);
I.prototype.Xg=function(a){null!==this.ga&&("string"===typeof this.ga?typeof a===this.ga&&null!==a||t.jc(a,this.ga):a instanceof this.ga||t.jc(a,this.ga))};I.prototype.Zd=function(){var a=this.Y;a++;999999999<a&&(a=0);this.Y=a};I.prototype.freeze=I.prototype.freeze=function(){this.tb=!0;return this};I.prototype.thaw=I.prototype.Ra=function(){this.tb=!1;return this};I.prototype.toString=function(){return"Set("+t.li(this.ga)+")#"+t.ud(this)};
I.prototype.add=I.prototype.add=function(a){if(null===a)return!1;e&&this.Xg(a);t.J(this,a);var b=a;t.xb(a)&&(b=t.xt(a));return void 0===this.ld[b]?(this.kd++,a=new Sa(a,a),this.ld[b]=a,b=this.Uh,null===b?this.kb=a:(a.Ko=b,b.Yb=a),this.Uh=a,this.Zd(),!0):!1};I.prototype.addAll=I.prototype.Ue=function(a){if(null===a)return this;t.J(this);if(t.isArray(a))for(var b=t.ub(a),c=0;c<b;c++)this.add(t.rb(a,c));else for(a=a.k;a.next();)this.add(a.value);return this};
I.prototype.contains=I.prototype.has=I.prototype.contains=function(a){if(null===a)return!1;e&&this.Xg(a);var b=a;return t.xb(a)&&(b=t.ud(a),void 0===b)?!1:void 0!==this.ld[b]};I.prototype.containsAll=function(a){if(null===a)return!0;for(a=a.k;a.next();)if(!this.contains(a.value))return!1;return!0};I.prototype.containsAny=function(a){if(null===a)return!0;for(a=a.k;a.next();)if(this.contains(a.value))return!0;return!1};I.prototype.first=I.prototype.gb=function(){var a=this.kb;return null===a?null:a.value};
I.prototype.any=function(a){for(var b=this.Y,c=this.kb;null!==c;){if(a(c.value))return!0;this.Y!==b&&t.Ub(this);c=c.Yb}return!1};I.prototype.all=function(a){for(var b=this.Y,c=this.kb;null!==c;){if(!a(c.value))return!1;this.Y!==b&&t.Ub(this);c=c.Yb}return!0};I.prototype.each=function(a){for(var b=this.Y,c=this.kb;null!==c;)a(c.value),this.Y!==b&&t.Ub(this),c=c.Yb};
I.prototype.remove=I.prototype["delete"]=I.prototype.remove=function(a){if(null===a)return!1;e&&this.Xg(a);t.J(this,a);var b=a;if(t.xb(a)&&(b=t.ud(a),void 0===b))return!1;a=this.ld[b];if(void 0===a)return!1;var c=a.Yb,d=a.Ko;null!==c&&(c.Ko=d);null!==d&&(d.Yb=c);this.kb===a&&(this.kb=c);this.Uh===a&&(this.Uh=d);delete this.ld[b];this.kd--;this.Zd();return!0};
I.prototype.removeAll=function(a){if(null===a)return this;t.J(this);if(t.isArray(a))for(var b=t.ub(a),c=0;c<b;c++)this.remove(t.rb(a,c));else for(a=a.k;a.next();)this.remove(a.value);return this};I.prototype.retainAll=function(a){if(null===a||0===this.count)return this;t.J(this);var b=new I(this.ga);b.Ue(a);a=new H(this.ga);for(var c=this.k;c.next();)b.contains(c.value)||a.add(c.value);for(b=a.k;b.next();)this.remove(b.value);return this};
I.prototype.clear=I.prototype.clear=function(){t.J(this);this.ld={};this.kd=0;this.Uh=this.kb=null;this.Zd()};I.prototype.copy=function(){var a=new I(this.ga),b=this.ld,c;for(c in b)a.add(b[c].value);return a};I.prototype.toArray=I.prototype.Pe=function(){var a=Array(this.kd),b=this.ld,c=0,d;for(d in b)a[c]=b[d].value,c++;return a};I.prototype.toList=function(){var a=new H(this.ga),b=this.ld,c;for(c in b)a.add(b[c].value);return a};t.A(I,{count:"count"},function(){return this.kd});
t.A(I,{size:"size"},function(){return this.kd});t.A(I,{k:"iterator"},function(){if(0>=this.kd)return t.fg;var a=this.Kd;return null!==a?(a.reset(),a):new Ra(this)});function Ua(a){this.bb=a;this.reset()}t.ce(Ua,{key:!0,value:!0});t.A(Ua,{k:"iterator"},function(){return this});Ua.prototype.reset=Ua.prototype.reset=function(){this.cb=this.bb.Y;this.Db=null};
Ua.prototype.next=Ua.prototype.hasNext=Ua.prototype.next=function(){var a=this.bb;a.Y!==this.cb&&t.Ub(a);var b=this.Db,b=null===b?a.kb:b.Yb;if(null!==b)return this.Db=b,this.value=this.key=a=b.key,!0;this.ig();return!1};Ua.prototype.first=Ua.prototype.gb=function(){var a=this.bb;this.cb=a.Y;a=a.kb;return null!==a?(this.Db=a,this.value=this.key=a=a.key):null};Ua.prototype.any=function(a){var b=this.bb,c=b.Y;this.Db=null;for(var d=b.kb;null!==d;){if(a(d.key))return!0;b.Y!==c&&t.Ub(b);d=d.Yb}return!1};
Ua.prototype.all=function(a){var b=this.bb,c=b.Y;this.Db=null;for(var d=b.kb;null!==d;){if(!a(d.key))return!1;b.Y!==c&&t.Ub(b);d=d.Yb}return!0};Ua.prototype.each=function(a){var b=this.bb,c=b.Y;this.Db=null;for(var d=b.kb;null!==d;)a(d.key),b.Y!==c&&t.Ub(b),d=d.Yb};t.A(Ua,{count:"count"},function(){return this.bb.kd});Ua.prototype.ig=function(){this.value=this.key=null;this.cb=-1};Ua.prototype.toString=function(){return null!==this.Db?"MapKeySetIterator@"+this.Db.value:"MapKeySetIterator"};
function Va(a){t.Fc(this);this.tb=!0;this.bb=a}t.Qa(Va,I);Va.prototype.freeze=function(){return this};Va.prototype.Ra=function(){return this};Va.prototype.toString=function(){return"MapKeySet("+this.bb.toString()+")"};Va.prototype.add=Va.prototype.set=Va.prototype.add=function(){t.m("This Set is read-only: "+this.toString());return!1};Va.prototype.contains=Va.prototype.has=Va.prototype.contains=function(a){return this.bb.contains(a)};
Va.prototype.remove=Va.prototype["delete"]=Va.prototype.remove=function(){t.m("This Set is read-only: "+this.toString());return!1};Va.prototype.clear=Va.prototype.clear=function(){t.m("This Set is read-only: "+this.toString())};Va.prototype.first=Va.prototype.gb=function(){var a=this.bb.kb;return null!==a?a.key:null};Va.prototype.any=function(a){for(var b=this.bb.kb;null!==b;){if(a(b.key))return!0;b=b.Yb}return!1};
Va.prototype.all=function(a){for(var b=this.bb.kb;null!==b;){if(!a(b.key))return!1;b=b.Yb}return!0};Va.prototype.each=function(a){for(var b=this.bb.kb;null!==b;)a(b.key),b=b.Yb};Va.prototype.copy=function(){return new Va(this.bb)};Va.prototype.toSet=function(){var a=new I(this.bb.Th),b=this.bb.ld,c;for(c in b)a.add(b[c].key);return a};Va.prototype.toArray=Va.prototype.Pe=function(){var a=this.bb.ld,b=Array(this.bb.kd),c=0,d;for(d in a)b[c]=a[d].key,c++;return b};
Va.prototype.toList=function(){var a=new H(this.ga),b=this.bb.ld,c;for(c in b)a.add(b[c].key);return a};t.A(Va,{count:"count"},function(){return this.bb.kd});t.A(Va,{size:"size"},function(){return this.bb.kd});t.A(Va,{k:"iterator"},function(){return 0>=this.bb.kd?t.fg:new Ua(this.bb)});function Wa(a){this.bb=a;this.reset()}t.ce(Wa,{key:!0,value:!0});t.A(Wa,{k:"iterator"},function(){return this});Wa.prototype.reset=Wa.prototype.reset=function(){var a=this.bb;a.zo=null;this.cb=a.Y;this.Db=null};
Wa.prototype.next=Wa.prototype.hasNext=Wa.prototype.next=function(){var a=this.bb;a.Y!==this.cb&&t.Ub(a);var b=this.Db,b=null===b?a.kb:b.Yb;if(null!==b)return this.Db=b,this.value=b.value,this.key=b.key,!0;this.ig();return!1};Wa.prototype.first=Wa.prototype.gb=function(){var a=this.bb;this.cb=a.Y;a=a.kb;if(null!==a){this.Db=a;var b=a.value;this.key=a.key;return this.value=b}return null};
Wa.prototype.any=function(a){var b=this.bb;b.zo=null;var c=b.Y;this.Db=null;for(var d=b.kb;null!==d;){if(a(d.value))return!0;b.Y!==c&&t.Ub(b);d=d.Yb}return!1};Wa.prototype.all=function(a){var b=this.bb;b.zo=null;var c=b.Y;this.Db=null;for(var d=b.kb;null!==d;){if(!a(d.value))return!1;b.Y!==c&&t.Ub(b);d=d.Yb}return!0};Wa.prototype.each=function(a){var b=this.bb;b.zo=null;var c=b.Y;this.Db=null;for(var d=b.kb;null!==d;)a(d.value),b.Y!==c&&t.Ub(b),d=d.Yb};t.A(Wa,{count:"count"},function(){return this.bb.kd});
Wa.prototype.ig=function(){this.value=this.key=null;this.cb=-1;this.bb.zo=this};Wa.prototype.toString=function(){return null!==this.Db?"MapValueSetIterator@"+this.Db.value:"MapValueSetIterator"};function Sa(a,b){this.key=a;this.value=b;this.Ko=this.Yb=null}t.ce(Sa,{key:!0,value:!0});Sa.prototype.toString=function(){return"{"+this.key+":"+this.value+"}"};function ab(a){this.bb=a;this.reset()}t.ce(ab,{key:!0,value:!0});t.A(ab,{k:"iterator"},function(){return this});
ab.prototype.reset=ab.prototype.reset=function(){var a=this.bb;a.Kd=null;this.cb=a.Y;this.Db=null};ab.prototype.next=ab.prototype.hasNext=ab.prototype.next=function(){var a=this.bb;a.Y!==this.cb&&t.Ub(a);var b=this.Db,b=null===b?a.kb:b.Yb;if(null!==b)return this.Db=b,this.key=b.key,this.value=b.value,!0;this.ig();return!1};ab.prototype.first=ab.prototype.gb=function(){var a=this.bb;this.cb=a.Y;a=a.kb;return null!==a?(this.Db=a,this.key=a.key,this.value=a.value,a):null};
ab.prototype.any=function(a){var b=this.bb;b.Kd=null;var c=b.Y;this.Db=null;for(var d=b.kb;null!==d;){if(a(d))return!0;b.Y!==c&&t.Ub(b);d=d.Yb}return!1};ab.prototype.all=function(a){var b=this.bb;b.Kd=null;var c=b.Y;this.Db=null;for(var d=b.kb;null!==d;){if(!a(d))return!1;b.Y!==c&&t.Ub(b);d=d.Yb}return!0};ab.prototype.each=function(a){var b=this.bb;b.Kd=null;var c=b.Y;this.Db=null;for(var d=b.kb;null!==d;)a(d),b.Y!==c&&t.Ub(b),d=d.Yb};t.A(ab,{count:"count"},function(){return this.bb.kd});
ab.prototype.ig=function(){this.value=this.key=null;this.cb=-1;this.bb.Kd=this};ab.prototype.toString=function(){return null!==this.Db?"MapIterator@"+this.Db:"MapIterator"};
function wa(a,b){t.Fc(this);this.tb=!1;void 0===a||null===a?this.Th=null:"string"===typeof a?"object"===a||"string"===a||"number"===a?this.Th=a:t.ha(a,"the string 'object', 'number' or 'string'","Map constructor: keytype"):"function"===typeof a?this.Th=a===Object?"object":a===String?"string":a===Number?"number":a:t.ha(a,"null, a primitive type name, or a class type","Map constructor: keytype");void 0===b||null===b?this.cj=null:"string"===typeof b?"object"===b||"string"===b||"boolean"===b||"number"===
b||"function"===b?this.cj=b:t.ha(b,"the string 'object', 'number', 'string', 'boolean', or 'function'","Map constructor: valtype"):"function"===typeof b?this.cj=b===Object?"object":b===String?"string":b===Number?"number":b===Boolean?"boolean":b===Function?"function":b:t.ha(b,"null, a primitive type name, or a class type","Map constructor: valtype");this.ld={};this.kd=0;this.zo=this.Kd=null;this.Y=0;this.Uh=this.kb=null}t.ka("Map",wa);
function cb(a,b){null!==a.Th&&("string"===typeof a.Th?typeof b===a.Th&&null!==b||t.jc(b,a.Th):b instanceof a.Th||t.jc(b,a.Th))}wa.prototype.Zd=function(){var a=this.Y;a++;999999999<a&&(a=0);this.Y=a};wa.prototype.freeze=wa.prototype.freeze=function(){this.tb=!0;return this};wa.prototype.thaw=wa.prototype.Ra=function(){this.tb=!1;return this};wa.prototype.toString=function(){return"Map("+t.li(this.Th)+","+t.li(this.cj)+")#"+t.ud(this)};
wa.prototype.add=wa.prototype.set=wa.prototype.add=function(a,b){e&&(cb(this,a),null!==this.cj&&("string"===typeof this.cj?typeof b===this.cj&&null!==b||t.jc(b,this.cj):b instanceof this.cj||t.jc(b,this.cj)));t.J(this,a);var c=a;t.xb(a)&&(c=t.xt(a));var d=this.ld[c];if(void 0===d)return this.kd++,d=new Sa(a,b),this.ld[c]=d,c=this.Uh,null===c?this.kb=d:(d.Ko=c,c.Yb=d),this.Uh=d,this.Zd(),!0;d.value=b;return!1};
wa.prototype.addAll=wa.prototype.Ue=function(a){if(null===a)return this;if(t.isArray(a))for(var b=t.ub(a),c=0;c<b;c++){var d=t.rb(a,c);this.add(d.key,d.value)}else for(e&&t.l(a,wa,wa,"addAll:map"),a=a.k;a.next();)this.add(a.key,a.value);return this};wa.prototype.first=wa.prototype.gb=function(){return this.kb};wa.prototype.any=function(a){for(var b=this.Y,c=this.kb;null!==c;){if(a(c))return!0;this.Y!==b&&t.Ub(this);c=c.Yb}return!1};
wa.prototype.all=function(a){for(var b=this.Y,c=this.kb;null!==c;){if(!a(c))return!1;this.Y!==b&&t.Ub(this);c=c.Yb}return!0};wa.prototype.each=function(a){for(var b=this.Y,c=this.kb;null!==c;)a(c),this.Y!==b&&t.Ub(this),c=c.Yb};wa.prototype.contains=wa.prototype.has=wa.prototype.contains=function(a){e&&cb(this,a);var b=a;return t.xb(a)&&(b=t.ud(a),void 0===b)?!1:void 0!==this.ld[b]};
wa.prototype.getValue=wa.prototype.get=wa.prototype.Da=function(a){e&&cb(this,a);var b=a;if(t.xb(a)&&(b=t.ud(a),void 0===b))return null;a=this.ld[b];return void 0===a?null:a.value};
wa.prototype.remove=wa.prototype["delete"]=wa.prototype.remove=function(a){if(null===a)return!1;e&&cb(this,a);t.J(this,a);var b=a;if(t.xb(a)&&(b=t.ud(a),void 0===b))return!1;a=this.ld[b];if(void 0===a)return!1;var c=a.Yb,d=a.Ko;null!==c&&(c.Ko=d);null!==d&&(d.Yb=c);this.kb===a&&(this.kb=c);this.Uh===a&&(this.Uh=d);delete this.ld[b];this.kd--;this.Zd();return!0};wa.prototype.clear=wa.prototype.clear=function(){t.J(this);this.ld={};this.kd=0;this.Uh=this.kb=null;this.Zd()};
wa.prototype.copy=function(){var a=new wa(this.Th,this.cj),b=this.ld,c;for(c in b){var d=b[c];a.add(d.key,d.value)}return a};wa.prototype.toArray=wa.prototype.Pe=function(){var a=this.ld,b=Array(this.kd),c=0,d;for(d in a){var f=a[d];b[c]=new Sa(f.key,f.value);c++}return b};wa.prototype.toKeySet=wa.prototype.Pl=function(){return new Va(this)};t.A(wa,{count:"count"},function(){return this.kd});t.A(wa,{size:"size"},function(){return this.kd});
t.A(wa,{k:"iterator"},function(){if(0>=this.count)return t.fg;var a=this.Kd;return null!==a?(a.reset(),a):new ab(this)});t.A(wa,{LK:"iteratorKeys"},function(){return 0>=this.count?t.fg:new Ua(this)});t.A(wa,{JF:"iteratorValues"},function(){if(0>=this.count)return t.fg;var a=this.zo;return null!==a?(a.reset(),a):new Wa(this)});function E(a,b){void 0===a?this.L=this.K=0:"number"===typeof a&&"number"===typeof b?(this.K=a,this.L=b):t.m("Invalid arguments to Point constructor")}t.ka("Point",E);t.ii(E);
t.ce(E,{x:!0,y:!0});E.prototype.assign=function(a){this.K=a.K;this.L=a.L};E.prototype.p=function(a,b){this.K=a;this.L=b};E.prototype.setTo=E.prototype.eq=function(a,b){e&&(t.i(a,"number",E,"setTo:x"),t.i(b,"number",E,"setTo:y"));t.J(this);this.K=a;this.L=b;return this};E.prototype.set=E.prototype.set=function(a){e&&t.l(a,E,E,"set:p");t.J(this);this.K=a.K;this.L=a.L;return this};E.prototype.copy=function(){var a=new E;a.K=this.K;a.L=this.L;return a};
E.prototype.Oa=function(){this.tb=!0;Object.freeze(this);return this};E.prototype.ba=function(){return Object.isFrozen(this)?this:this.copy().freeze()};E.prototype.freeze=function(){this.tb=!0;return this};E.prototype.Ra=function(){Object.isFrozen(this)&&t.m("cannot thaw constant: "+this);this.tb=!1;return this};
E.parse=function(a){if("string"===typeof a){a=a.split(" ");for(var b=0,c=0;""===a[b];)b++;var d=a[b++];d&&(c=parseFloat(d));for(var f=0;""===a[b];)b++;(d=a[b++])&&(f=parseFloat(d));return new E(c,f)}return new E};E.stringify=function(a){return a instanceof E?a.x.toString()+" "+a.y.toString():a.toString()};E.prototype.toString=function(){return"Point("+this.x+","+this.y+")"};E.prototype.equals=E.prototype.O=function(a){return a instanceof E?this.K===a.x&&this.L===a.y:!1};
E.prototype.equalTo=function(a,b){return this.K===a&&this.L===b};E.prototype.equalsApprox=E.prototype.yf=function(a){return K.I(this.K,a.x)&&K.I(this.L,a.y)};E.prototype.add=E.prototype.add=function(a){e&&t.l(a,E,E,"add:p");t.J(this);this.K+=a.x;this.L+=a.y;return this};E.prototype.subtract=E.prototype.ju=function(a){e&&t.l(a,E,E,"subtract:p");t.J(this);this.K-=a.x;this.L-=a.y;return this};
E.prototype.offset=E.prototype.offset=function(a,b){e&&(t.q(a,E,"offset:dx"),t.q(b,E,"offset:dy"));t.J(this);this.K+=a;this.L+=b;return this};E.prototype.rotate=E.prototype.rotate=function(a){e&&t.q(a,E,"rotate:angle");t.J(this);if(0===a)return this;var b=this.K,c=this.L;if(0===b&&0===c)return this;var d;90===a?(a=0,d=1):180===a?(a=-1,d=0):270===a?(a=0,d=-1):(d=a*Math.PI/180,a=Math.cos(d),d=Math.sin(d));this.K=a*b-d*c;this.L=d*b+a*c;return this};
E.prototype.scale=E.prototype.scale=function(a,b){e&&(t.q(a,E,"scale:sx"),t.q(b,E,"scale:sy"));this.K*=a;this.L*=b;return this};E.prototype.distanceSquaredPoint=E.prototype.nk=function(a){e&&t.l(a,E,E,"distanceSquaredPoint:p");var b=a.x-this.K;a=a.y-this.L;return b*b+a*a};E.prototype.distanceSquared=E.prototype.nt=function(a,b){e&&(t.q(a,E,"distanceSquared:px"),t.q(b,E,"distanceSquared:py"));var c=a-this.K,d=b-this.L;return c*c+d*d};
E.prototype.normalize=E.prototype.normalize=function(){t.J(this);var a=this.K,b=this.L,c=Math.sqrt(a*a+b*b);0<c&&(this.K=a/c,this.L=b/c);return this};E.prototype.directionPoint=E.prototype.mj=function(a){e&&t.l(a,E,E,"directionPoint:p");return eb(a.x-this.K,a.y-this.L)};E.prototype.direction=E.prototype.direction=function(a,b){e&&(t.q(a,E,"direction:px"),t.q(b,E,"direction:py"));return eb(a-this.K,b-this.L)};
function eb(a,b){if(0===a)return 0<b?90:0>b?270:0;if(0===b)return 0<a?0:180;if(isNaN(a)||isNaN(b))return 0;var c=180*Math.atan(Math.abs(b/a))/Math.PI;0>a?c=0>b?c+180:180-c:0>b&&(c=360-c);return c}E.prototype.projectOntoLineSegment=function(a,b,c,d){e&&(t.q(a,E,"projectOntoLineSegment:px"),t.q(b,E,"projectOntoLineSegment:py"),t.q(c,E,"projectOntoLineSegment:qx"),t.q(d,E,"projectOntoLineSegment:qy"));K.vn(a,b,c,d,this.K,this.L,this);return this};
E.prototype.projectOntoLineSegmentPoint=function(a,b){e&&(t.l(a,E,E,"projectOntoLineSegmentPoint:p"),t.l(b,E,E,"projectOntoLineSegmentPoint:q"));K.vn(a.x,a.y,b.x,b.y,this.K,this.L,this);return this};E.prototype.snapToGrid=function(a,b,c,d){e&&(t.q(a,E,"snapToGrid:originx"),t.q(b,E,"snapToGrid:originy"),t.q(c,E,"snapToGrid:cellwidth"),t.q(d,E,"snapToGrid:cellheight"));K.rt(this.K,this.L,a,b,c,d,this);return this};
E.prototype.snapToGridPoint=function(a,b){e&&(t.l(a,E,E,"snapToGridPoint:p"),t.l(b,ra,E,"snapToGridPoint:q"));K.rt(this.K,this.L,a.x,a.y,b.width,b.height,this);return this};E.prototype.setRectSpot=E.prototype.eu=function(a,b){e&&(t.l(a,F,E,"setRectSpot:r"),t.l(b,L,E,"setRectSpot:spot"));t.J(this);this.K=a.x+b.x*a.width+b.offsetX;this.L=a.y+b.y*a.height+b.offsetY;return this};
E.prototype.setSpot=E.prototype.fu=function(a,b,c,d,f){e&&(t.q(a,E,"setSpot:x"),t.q(b,E,"setSpot:y"),t.q(c,E,"setSpot:w"),t.q(d,E,"setSpot:h"),(0>c||0>d)&&t.m("Point.setSpot:Width and height cannot be negative"),t.l(f,L,E,"setSpot:spot"));t.J(this);this.K=a+f.x*c+f.offsetX;this.L=b+f.y*d+f.offsetY;return this};E.prototype.transform=function(a){e&&t.l(a,ta,E,"transform:t");a.Xa(this);return this};function lb(a,b){e&&t.l(b,ta,E,"transformInverted:t");b.mi(a);return a}var nb;
E.distanceLineSegmentSquared=nb=function(a,b,c,d,f,g){e&&(t.q(a,E,"distanceLineSegmentSquared:px"),t.q(b,E,"distanceLineSegmentSquared:py"),t.q(c,E,"distanceLineSegmentSquared:ax"),t.q(d,E,"distanceLineSegmentSquared:ay"),t.q(f,E,"distanceLineSegmentSquared:bx"),t.q(g,E,"distanceLineSegmentSquared:by"));var h=f-c,k=g-d,l=h*h+k*k;c-=a;d-=b;var m=-c*h-d*k;if(0>=m||m>=l)return h=f-a,k=g-b,Math.min(c*c+d*d,h*h+k*k);a=h*d-k*c;return a*a/l};var ob;
E.distanceSquared=ob=function(a,b,c,d){e&&(t.q(a,E,"distanceSquared:px"),t.q(b,E,"distanceSquared:py"),t.q(c,E,"distanceSquared:qx"),t.q(d,E,"distanceSquared:qy"));a=c-a;b=d-b;return a*a+b*b};var pb;
E.direction=pb=function(a,b,c,d){e&&(t.q(a,E,"direction:px"),t.q(b,E,"direction:py"),t.q(c,E,"direction:qx"),t.q(d,E,"direction:qy"));a=c-a;b=d-b;if(0===a)return 0<b?90:0>b?270:0;if(0===b)return 0<a?0:180;if(isNaN(a)||isNaN(b))return 0;d=180*Math.atan(Math.abs(b/a))/Math.PI;0>a?d=0>b?d+180:180-d:0>b&&(d=360-d);return d};t.g(E,"x",E.prototype.x);t.defineProperty(E,{x:"x"},function(){return this.K},function(a){t.J(this,a);e&&t.i(a,"number",E,"x");this.K=a});t.g(E,"y",E.prototype.y);
t.defineProperty(E,{y:"y"},function(){return this.L},function(a){t.J(this,a);e&&t.i(a,"number",E,"y");this.L=a});E.prototype.isReal=E.prototype.P=function(){return isFinite(this.x)&&isFinite(this.y)};function ra(a,b){void 0===a?this.Aa=this.Ba=0:"number"===typeof a&&(0<=a||isNaN(a))&&"number"===typeof b&&(0<=b||isNaN(b))?(this.Ba=a,this.Aa=b):t.m("Invalid arguments to Size constructor")}t.ka("Size",ra);t.ii(ra);t.ce(ra,{width:!0,height:!0});ra.prototype.assign=function(a){this.Ba=a.Ba;this.Aa=a.Aa};
ra.prototype.p=function(a,b){this.Ba=a;this.Aa=b};ra.prototype.setTo=ra.prototype.eq=function(a,b){e&&(t.i(a,"number",ra,"setTo:w"),t.i(b,"number",ra,"setTo:h"));0>a&&t.ha(a,">= 0",ra,"setTo:w");0>b&&t.ha(b,">= 0",ra,"setTo:h");t.J(this);this.Ba=a;this.Aa=b;return this};ra.prototype.set=ra.prototype.set=function(a){e&&t.l(a,ra,ra,"set:s");t.J(this);this.Ba=a.Ba;this.Aa=a.Aa;return this};ra.prototype.copy=function(){var a=new ra;a.Ba=this.Ba;a.Aa=this.Aa;return a};
ra.prototype.Oa=function(){this.tb=!0;Object.freeze(this);return this};ra.prototype.ba=function(){return Object.isFrozen(this)?this:this.copy().freeze()};ra.prototype.freeze=function(){this.tb=!0;return this};ra.prototype.Ra=function(){Object.isFrozen(this)&&t.m("cannot thaw constant: "+this);this.tb=!1;return this};
ra.parse=function(a){if("string"===typeof a){a=a.split(" ");for(var b=0,c=0;""===a[b];)b++;var d=a[b++];d&&(c=parseFloat(d));for(var f=0;""===a[b];)b++;(d=a[b++])&&(f=parseFloat(d));return new ra(c,f)}return new ra};ra.stringify=function(a){return a instanceof ra?a.width.toString()+" "+a.height.toString():a.toString()};ra.prototype.toString=function(){return"Size("+this.width+","+this.height+")"};
ra.prototype.equals=ra.prototype.O=function(a){return a instanceof ra?this.Ba===a.width&&this.Aa===a.height:!1};ra.prototype.equalTo=function(a,b){return this.Ba===a&&this.Aa===b};ra.prototype.equalsApprox=ra.prototype.yf=function(a){return K.I(this.Ba,a.width)&&K.I(this.Aa,a.height)};t.g(ra,"width",ra.prototype.width);t.defineProperty(ra,{width:"width"},function(){return this.Ba},function(a){t.J(this,a);e&&t.i(a,"number",ra,"width");0>a&&t.ha(a,">= 0",ra,"width");this.Ba=a});t.g(ra,"height",ra.prototype.height);
t.defineProperty(ra,{height:"height"},function(){return this.Aa},function(a){t.J(this,a);e&&t.i(a,"number",ra,"height");0>a&&t.ha(a,">= 0",ra,"height");this.Aa=a});ra.prototype.isReal=ra.prototype.P=function(){return isFinite(this.width)&&isFinite(this.height)};
function F(a,b,c,d){void 0===a?this.Aa=this.Ba=this.L=this.K=0:a instanceof E?b instanceof E?(this.K=Math.min(a.K,b.K),this.L=Math.min(a.L,b.L),this.Ba=Math.abs(a.K-b.K),this.Aa=Math.abs(a.L-b.L)):b instanceof ra?(this.K=a.K,this.L=a.L,this.Ba=b.Ba,this.Aa=b.Aa):t.m("Incorrect arguments supplied"):"number"===typeof a&&"number"===typeof b&&"number"===typeof c&&(0<=c||isNaN(c))&&"number"===typeof d&&(0<=d||isNaN(d))?(this.K=a,this.L=b,this.Ba=c,this.Aa=d):t.m("Invalid arguments to Rect constructor")}
t.ka("Rect",F);t.ii(F);t.ce(F,{x:!0,y:!0,width:!0,height:!0});F.prototype.assign=function(a){this.K=a.K;this.L=a.L;this.Ba=a.Ba;this.Aa=a.Aa};F.prototype.p=function(a,b,c,d){this.K=a;this.L=b;this.Ba=c;this.Aa=d};function ub(a,b,c){a.Ba=b;a.Aa=c}
F.prototype.setTo=F.prototype.eq=function(a,b,c,d){e&&(t.i(a,"number",F,"setTo:x"),t.i(b,"number",F,"setTo:y"),t.i(c,"number",F,"setTo:w"),t.i(d,"number",F,"setTo:h"));0>c&&t.ha(c,">= 0",F,"setTo:w");0>d&&t.ha(d,">= 0",F,"setTo:h");t.J(this);this.K=a;this.L=b;this.Ba=c;this.Aa=d;return this};F.prototype.set=F.prototype.set=function(a){e&&t.l(a,F,F,"set:r");t.J(this);this.K=a.K;this.L=a.L;this.Ba=a.Ba;this.Aa=a.Aa;return this};
F.prototype.setPoint=F.prototype.Hf=function(a){e&&t.l(a,E,F,"setPoint:p");t.J(this);this.K=a.K;this.L=a.L;return this};F.prototype.setSize=function(a){e&&t.l(a,ra,F,"setSize:s");t.J(this);this.Ba=a.Ba;this.Aa=a.Aa;return this};F.prototype.copy=function(){var a=new F;a.K=this.K;a.L=this.L;a.Ba=this.Ba;a.Aa=this.Aa;return a};F.prototype.Oa=function(){this.tb=!0;Object.freeze(this);return this};F.prototype.ba=function(){return Object.isFrozen(this)?this:this.copy().freeze()};
F.prototype.freeze=function(){this.tb=!0;return this};F.prototype.Ra=function(){Object.isFrozen(this)&&t.m("cannot thaw constant: "+this);this.tb=!1;return this};F.parse=function(a){if("string"===typeof a){a=a.split(" ");for(var b=0,c=0;""===a[b];)b++;var d=a[b++];d&&(c=parseFloat(d));for(var f=0;""===a[b];)b++;(d=a[b++])&&(f=parseFloat(d));for(var g=0;""===a[b];)b++;(d=a[b++])&&(g=parseFloat(d));for(var h=0;""===a[b];)b++;(d=a[b++])&&(h=parseFloat(d));return new F(c,f,g,h)}return new F};
F.stringify=function(a){return a instanceof F?a.x.toString()+" "+a.y.toString()+" "+a.width.toString()+" "+a.height.toString():a.toString()};F.prototype.toString=function(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"};F.prototype.equals=F.prototype.O=function(a){return a instanceof F?this.K===a.x&&this.L===a.y&&this.Ba===a.width&&this.Aa===a.height:!1};F.prototype.equalTo=function(a,b,c,d){return this.K===a&&this.L===b&&this.Ba===c&&this.Aa===d};
F.prototype.equalsApprox=F.prototype.yf=function(a){return K.I(this.K,a.x)&&K.I(this.L,a.y)&&K.I(this.Ba,a.width)&&K.I(this.Aa,a.height)};F.prototype.containsPoint=F.prototype.La=function(a){e&&t.l(a,E,F,"containsPoint:p");return this.K<=a.x&&this.K+this.Ba>=a.x&&this.L<=a.y&&this.L+this.Aa>=a.y};F.prototype.containsRect=F.prototype.kk=function(a){e&&t.l(a,F,F,"containsRect:r");return this.K<=a.x&&a.x+a.width<=this.K+this.Ba&&this.L<=a.y&&a.y+a.height<=this.L+this.Aa};
F.prototype.contains=F.prototype.contains=function(a,b,c,d){e?(t.q(a,F,"contains:x"),t.q(b,F,"contains:y"),void 0===c?c=0:t.q(c,F,"contains:w"),void 0===d?d=0:t.q(d,F,"contains:h"),(0>c||0>d)&&t.m("Rect.contains:Width and height cannot be negative")):(void 0===c&&(c=0),void 0===d&&(d=0));return this.K<=a&&a+c<=this.K+this.Ba&&this.L<=b&&b+d<=this.L+this.Aa};F.prototype.reset=function(){t.J(this);this.Aa=this.Ba=this.L=this.K=0};
F.prototype.offset=F.prototype.offset=function(a,b){e&&(t.q(a,F,"offset:dx"),t.q(b,F,"offset:dy"));t.J(this);this.K+=a;this.L+=b;return this};F.prototype.inflate=F.prototype.Wf=function(a,b){e&&(t.q(a,F,"inflate:w"),t.q(b,F,"inflate:h"));return vb(this,b,a,b,a)};F.prototype.addMargin=F.prototype.ow=function(a){e&&t.l(a,wb,F,"addMargin:m");return vb(this,a.top,a.right,a.bottom,a.left)};
F.prototype.subtractMargin=F.prototype.tK=function(a){e&&t.l(a,wb,F,"subtractMargin:m");return vb(this,-a.top,-a.right,-a.bottom,-a.left)};F.prototype.grow=function(a,b,c,d){e&&(t.q(a,F,"grow:t"),t.q(b,F,"grow:r"),t.q(c,F,"grow:b"),t.q(d,F,"grow:l"));return vb(this,a,b,c,d)};function vb(a,b,c,d,f){t.J(a);var g=a.Ba;c+f<=-g?(a.K+=g/2,a.Ba=0):(a.K-=f,a.Ba+=c+f);c=a.Aa;b+d<=-c?(a.L+=c/2,a.Aa=0):(a.L-=b,a.Aa+=b+d);return a}
F.prototype.intersectRect=function(a){e&&t.l(a,F,F,"intersectRect:r");return xb(this,a.x,a.y,a.width,a.height)};F.prototype.intersect=function(a,b,c,d){e&&(t.q(a,F,"intersect:x"),t.q(b,F,"intersect:y"),t.q(c,F,"intersect:w"),t.q(d,F,"intersect:h"),(0>c||0>d)&&t.m("Rect.intersect:Width and height cannot be negative"));return xb(this,a,b,c,d)};
function xb(a,b,c,d,f){t.J(a);var g=Math.max(a.K,b),h=Math.max(a.L,c);b=Math.min(a.K+a.Ba,b+d);c=Math.min(a.L+a.Aa,c+f);a.K=g;a.L=h;a.Ba=Math.max(0,b-g);a.Aa=Math.max(0,c-h);return a}F.prototype.intersectsRect=F.prototype.Xf=function(a){e&&t.l(a,F,F,"intersectsRect:r");return this.zF(a.x,a.y,a.width,a.height)};
F.prototype.intersects=F.prototype.zF=function(a,b,c,d){e&&(t.q(a,F,"intersects:x"),t.q(b,F,"intersects:y"),t.q(a,F,"intersects:w"),t.q(b,F,"intersects:h"),(0>c||0>d)&&t.m("Rect.intersects:Width and height cannot be negative"));var f=this.Ba,g=this.K;if(Infinity!==f&&Infinity!==c&&(f+=g,c+=a,isNaN(c)||isNaN(f)||g>c||a>f))return!1;a=this.Aa;c=this.L;return Infinity!==a&&Infinity!==d&&(a+=c,d+=b,isNaN(d)||isNaN(a)||c>d||b>a)?!1:!0};
function Eb(a,b){var c=a.Ba,d=b.width+10+10,f=a.K,g=b.x-10;if(f>d+g||g>c+f)return!1;c=a.Aa;d=b.height+10+10;f=a.L;g=b.y-10;return f>d+g||g>c+f?!1:!0}F.prototype.unionPoint=F.prototype.xj=function(a){e&&t.l(a,E,F,"unionPoint:p");return Fb(this,a.x,a.y,0,0)};F.prototype.unionRect=F.prototype.yj=function(a){e&&t.l(a,F,F,"unionRect:r");return Fb(this,a.K,a.L,a.Ba,a.Aa)};
F.prototype.union=F.prototype.dH=function(a,b,c,d){t.J(this);e?(t.q(a,F,"union:x"),t.q(b,F,"union:y"),void 0===c?c=0:t.q(c,F,"union:w"),void 0===d?d=0:t.q(d,F,"union:h"),(0>c||0>d)&&t.m("Rect.union:Width and height cannot be negative")):(void 0===c&&(c=0),void 0===d&&(d=0));return Fb(this,a,b,c,d)};function Fb(a,b,c,d,f){var g=Math.min(a.K,b),h=Math.min(a.L,c);b=Math.max(a.K+a.Ba,b+d);c=Math.max(a.L+a.Aa,c+f);a.K=g;a.L=h;a.Ba=b-g;a.Aa=c-h;return a}
F.prototype.setSpot=F.prototype.fu=function(a,b,c){e&&(t.q(a,F,"setSpot:x"),t.q(b,F,"setSpot:y"),t.l(c,L,F,"setSpot:spot"));t.J(this);this.K=a-c.offsetX-c.x*this.Ba;this.L=b-c.offsetY-c.y*this.Aa;return this};var Gb;
F.contains=Gb=function(a,b,c,d,f,g,h,k){e?(t.q(a,F,"contains:rx"),t.q(b,F,"contains:ry"),t.q(c,F,"contains:rw"),t.q(d,F,"contains:rh"),t.q(f,F,"contains:x"),t.q(g,F,"contains:y"),void 0===h?h=0:t.q(h,F,"contains:w"),void 0===k?k=0:t.q(k,F,"contains:h"),(0>c||0>d||0>h||0>k)&&t.m("Rect.contains:Width and height cannot be negative")):(void 0===h&&(h=0),void 0===k&&(k=0));return a<=f&&f+h<=a+c&&b<=g&&g+k<=b+d};
F.intersects=function(a,b,c,d,f,g,h,k){e&&(t.q(a,F,"intersects:rx"),t.q(b,F,"intersects:ry"),t.q(c,F,"intersects:rw"),t.q(d,F,"intersects:rh"),t.q(f,F,"intersects:x"),t.q(g,F,"intersects:y"),t.q(h,F,"intersects:w"),t.q(k,F,"intersects:h"),(0>c||0>d||0>h||0>k)&&t.m("Rect.intersects:Width and height cannot be negative"));c+=a;h+=f;if(a>h||f>c)return!1;a=d+b;k+=g;return b>k||g>a?!1:!0};t.g(F,"x",F.prototype.x);
t.defineProperty(F,{x:"x"},function(){return this.K},function(a){t.J(this,a);e&&t.i(a,"number",F,"x");this.K=a});t.g(F,"y",F.prototype.y);t.defineProperty(F,{y:"y"},function(){return this.L},function(a){t.J(this,a);e&&t.i(a,"number",F,"y");this.L=a});t.g(F,"width",F.prototype.width);t.defineProperty(F,{width:"width"},function(){return this.Ba},function(a){t.J(this,a);e&&t.i(a,"number",F,"width");0>a&&t.ha(a,">= 0",F,"width");this.Ba=a});t.g(F,"height",F.prototype.height);
t.defineProperty(F,{height:"height"},function(){return this.Aa},function(a){t.J(this,a);e&&t.i(a,"number",F,"height");0>a&&t.ha(a,">= 0",F,"height");this.Aa=a});t.g(F,"left",F.prototype.left);t.defineProperty(F,{left:"left"},function(){return this.K},function(a){t.J(this,a);e&&t.i(a,"number",F,"left");this.K=a});t.g(F,"top",F.prototype.top);t.defineProperty(F,{top:"top"},function(){return this.L},function(a){t.J(this,a);e&&t.i(a,"number",F,"top");this.L=a});t.g(F,"right",F.prototype.right);
t.defineProperty(F,{right:"right"},function(){return this.K+this.Ba},function(a){t.J(this,a);e&&t.q(a,F,"right");this.K+=a-(this.K+this.Ba)});t.g(F,"bottom",F.prototype.bottom);t.defineProperty(F,{bottom:"bottom"},function(){return this.L+this.Aa},function(a){t.J(this,a);e&&t.q(a,F,"top");this.L+=a-(this.L+this.Aa)});t.g(F,"position",F.prototype.position);
t.defineProperty(F,{position:"position"},function(){return new E(this.K,this.L)},function(a){t.J(this,a);e&&t.l(a,E,F,"position");this.K=a.x;this.L=a.y});t.g(F,"size",F.prototype.size);t.defineProperty(F,{size:"size"},function(){return new ra(this.Ba,this.Aa)},function(a){t.J(this,a);e&&t.l(a,ra,F,"size");this.Ba=a.width;this.Aa=a.height});t.g(F,"center",F.prototype.eA);
t.defineProperty(F,{eA:"center"},function(){return new E(this.K+this.Ba/2,this.L+this.Aa/2)},function(a){t.J(this,a);e&&t.l(a,E,F,"center");this.K=a.x-this.Ba/2;this.L=a.y-this.Aa/2});t.g(F,"centerX",F.prototype.Ia);t.defineProperty(F,{Ia:"centerX"},function(){return this.K+this.Ba/2},function(a){t.J(this,a);e&&t.q(a,F,"centerX");this.K=a-this.Ba/2});t.g(F,"centerY",F.prototype.Ua);
t.defineProperty(F,{Ua:"centerY"},function(){return this.L+this.Aa/2},function(a){t.J(this,a);e&&t.q(a,F,"centerY");this.L=a-this.Aa/2});F.prototype.isReal=F.prototype.P=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)};F.prototype.isEmpty=function(){return 0===this.width&&0===this.height};
function wb(a,b,c,d){void 0===a?this.eh=this.Wg=this.kh=this.mh=0:void 0===b?this.left=this.bottom=this.right=this.top=a:void 0===c?(d=b,this.top=a,this.right=b,this.bottom=a,this.left=d):void 0!==d?(this.top=a,this.right=b,this.bottom=c,this.left=d):t.m("Invalid arguments to Margin constructor")}t.ka("Margin",wb);t.ii(wb);t.ce(wb,{top:!0,right:!0,bottom:!0,left:!0});wb.prototype.assign=function(a){this.mh=a.mh;this.kh=a.kh;this.Wg=a.Wg;this.eh=a.eh};
wb.prototype.setTo=wb.prototype.eq=function(a,b,c,d){e&&(t.i(a,"number",wb,"setTo:t"),t.i(b,"number",wb,"setTo:r"),t.i(c,"number",wb,"setTo:b"),t.i(d,"number",wb,"setTo:l"));t.J(this);this.mh=a;this.kh=b;this.Wg=c;this.eh=d;return this};wb.prototype.set=wb.prototype.set=function(a){e&&t.l(a,wb,wb,"assign:m");t.J(this);this.mh=a.mh;this.kh=a.kh;this.Wg=a.Wg;this.eh=a.eh;return this};wb.prototype.copy=function(){var a=new wb;a.mh=this.mh;a.kh=this.kh;a.Wg=this.Wg;a.eh=this.eh;return a};
wb.prototype.Oa=function(){this.tb=!0;Object.freeze(this);return this};wb.prototype.ba=function(){return Object.isFrozen(this)?this:this.copy().freeze()};wb.prototype.freeze=function(){this.tb=!0;return this};wb.prototype.Ra=function(){Object.isFrozen(this)&&t.m("cannot thaw constant: "+this);this.tb=!1;return this};
wb.parse=function(a){if("string"===typeof a){a=a.split(" ");for(var b=0,c=0;""===a[b];)b++;var d=a[b++];d&&(c=parseFloat(d));for(var f=void 0;""===a[b];)b++;(d=a[b++])&&(f=parseFloat(d));for(var g=void 0;""===a[b];)b++;(d=a[b++])&&(g=parseFloat(d));for(var h=void 0;""===a[b];)b++;(d=a[b++])&&(h=parseFloat(d));return new wb(c,f,g,h)}return new wb};wb.stringify=function(a){return a instanceof wb?a.top.toString()+" "+a.right.toString()+" "+a.bottom.toString()+" "+a.left.toString():a.toString()};
wb.prototype.toString=function(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"};wb.prototype.equals=wb.prototype.O=function(a){return a instanceof wb?this.mh===a.top&&this.kh===a.right&&this.Wg===a.bottom&&this.eh===a.left:!1};wb.prototype.equalTo=function(a,b,c,d){return this.mh===a&&this.kh===b&&this.Wg===c&&this.eh===d};wb.prototype.equalsApprox=wb.prototype.yf=function(a){return K.I(this.mh,a.top)&&K.I(this.kh,a.right)&&K.I(this.Wg,a.bottom)&&K.I(this.eh,a.left)};
t.g(wb,"top",wb.prototype.top);t.defineProperty(wb,{top:"top"},function(){return this.mh},function(a){t.J(this,a);e&&t.q(a,wb,"top");this.mh=a});t.g(wb,"right",wb.prototype.right);t.defineProperty(wb,{right:"right"},function(){return this.kh},function(a){t.J(this,a);e&&t.q(a,wb,"right");this.kh=a});t.g(wb,"bottom",wb.prototype.bottom);t.defineProperty(wb,{bottom:"bottom"},function(){return this.Wg},function(a){t.J(this,a);e&&t.q(a,wb,"bottom");this.Wg=a});t.g(wb,"left",wb.prototype.left);
t.defineProperty(wb,{left:"left"},function(){return this.eh},function(a){t.J(this,a);e&&t.q(a,wb,"left");this.eh=a});wb.prototype.isReal=wb.prototype.P=function(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)};function ta(){this.m11=1;this.m21=this.m12=0;this.m22=1;this.dy=this.dx=0}t.ii(ta);t.ce(ta,{m11:!0,m12:!0,m21:!0,m22:!0,dx:!0,dy:!0});
ta.prototype.set=ta.prototype.set=function(a){e&&t.l(a,ta,ta,"set:t");this.m11=a.m11;this.m12=a.m12;this.m21=a.m21;this.m22=a.m22;this.dx=a.dx;this.dy=a.dy;return this};ta.prototype.copy=function(){var a=new ta;a.m11=this.m11;a.m12=this.m12;a.m21=this.m21;a.m22=this.m22;a.dx=this.dx;a.dy=this.dy;return a};ta.prototype.toString=function(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"};
ta.prototype.equals=ta.prototype.O=function(a){return a instanceof ta?this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.dx===a.dx&&this.dy===a.dy:!1};ta.prototype.reset=ta.prototype.reset=function(){this.m11=1;this.m21=this.m12=0;this.m22=1;this.dy=this.dx=0};
ta.prototype.multiply=ta.prototype.multiply=function(a){e&&t.l(a,ta,ta,"multiply:matrix");var b=this.m12*a.m11+this.m22*a.m12,c=this.m11*a.m21+this.m21*a.m22,d=this.m12*a.m21+this.m22*a.m22,f=this.m11*a.dx+this.m21*a.dy+this.dx,g=this.m12*a.dx+this.m22*a.dy+this.dy;this.m11=this.m11*a.m11+this.m21*a.m12;this.m12=b;this.m21=c;this.m22=d;this.dx=f;this.dy=g;return this};
ta.prototype.multiplyInverted=ta.prototype.XA=function(a){e&&t.l(a,ta,ta,"multiplyInverted:matrix");var b=1/(a.m11*a.m22-a.m12*a.m21),c=a.m22*b,d=-a.m12*b,f=-a.m21*b,g=a.m11*b,h=b*(a.m21*a.dy-a.m22*a.dx),k=b*(a.m12*a.dx-a.m11*a.dy);a=this.m12*c+this.m22*d;b=this.m11*f+this.m21*g;f=this.m12*f+this.m22*g;g=this.m11*h+this.m21*k+this.dx;h=this.m12*h+this.m22*k+this.dy;this.m11=this.m11*c+this.m21*d;this.m12=a;this.m21=b;this.m22=f;this.dx=g;this.dy=h;return this};
ta.prototype.invert=ta.prototype.FA=function(){var a=1/(this.m11*this.m22-this.m12*this.m21),b=-this.m12*a,c=-this.m21*a,d=this.m11*a,f=a*(this.m21*this.dy-this.m22*this.dx),g=a*(this.m12*this.dx-this.m11*this.dy);this.m11=this.m22*a;this.m12=b;this.m21=c;this.m22=d;this.dx=f;this.dy=g};
ta.prototype.rotate=ta.prototype.rotate=function(a,b,c){e&&(t.q(a,ta,"rotate:angle"),t.q(b,ta,"rotate:rx"),t.q(c,ta,"rotate:ry"));this.translate(b,c);var d;0===a?(a=1,d=0):90===a?(a=0,d=1):180===a?(a=-1,d=0):270===a?(a=0,d=-1):(d=a*Math.PI/180,a=Math.cos(d),d=Math.sin(d));var f=this.m12*a+this.m22*d,g=this.m11*-d+this.m21*a,h=this.m12*-d+this.m22*a;this.m11=this.m11*a+this.m21*d;this.m12=f;this.m21=g;this.m22=h;this.translate(-b,-c)};
ta.prototype.translate=ta.prototype.translate=function(a,b){e&&(t.q(a,ta,"translate:x"),t.q(b,ta,"translate:y"));this.dx+=this.m11*a+this.m21*b;this.dy+=this.m12*a+this.m22*b};ta.prototype.scale=ta.prototype.scale=function(a,b){void 0===b&&(b=a);e&&(t.q(a,ta,"translate:sx"),t.q(b,ta,"translate:sy"));this.m11*=a;this.m12*=a;this.m21*=b;this.m22*=b};
ta.prototype.transformPoint=ta.prototype.Xa=function(a){e&&t.l(a,E,ta,"transformPoint:p");var b=a.K,c=a.L;a.K=b*this.m11+c*this.m21+this.dx;a.L=b*this.m12+c*this.m22+this.dy;return a};ta.prototype.invertedTransformPoint=ta.prototype.mi=function(a){e&&t.l(a,E,ta,"invertedTransformPoint:p");var b=1/(this.m11*this.m22-this.m12*this.m21),c=-this.m12*b,d=this.m11*b,f=b*(this.m12*this.dx-this.m11*this.dy),g=a.K,h=a.L;a.K=g*this.m22*b+h*-this.m21*b+b*(this.m21*this.dy-this.m22*this.dx);a.L=g*c+h*d+f;return a};
ta.prototype.transformRect=ta.prototype.ZG=function(a){e&&t.l(a,F,ta,"transformRect:rect");var b=a.K,c=a.L,d=b+a.Ba,f=c+a.Aa,g=this.m11,h=this.m12,k=this.m21,l=this.m22,m=this.dx,n=this.dy,p=b*g+c*k+m,q=b*h+c*l+n,r=d*g+c*k+m,c=d*h+c*l+n,s=b*g+f*k+m,b=b*h+f*l+n,g=d*g+f*k+m,d=d*h+f*l+n,f=p,h=q,p=Math.min(p,r),f=Math.max(f,r),h=Math.min(h,c),q=Math.max(q,c),p=Math.min(p,s),f=Math.max(f,s),h=Math.min(h,b),q=Math.max(q,b),p=Math.min(p,g),f=Math.max(f,g),h=Math.min(h,d),q=Math.max(q,d);a.K=p;a.L=h;a.Ba=
f-p;a.Aa=q-h};ta.prototype.isIdentity=ta.prototype.Et=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.dx&&0===this.dy};function L(a,b,c,d){void 0===a?this.rg=this.qg=this.L=this.K=0:(void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),this.x=a,this.y=b,this.offsetX=c,this.offsetY=d)}t.ka("Spot",L);t.ii(L);t.ce(L,{x:!0,y:!0,offsetX:!0,offsetY:!0});L.prototype.assign=function(a){this.K=a.K;this.L=a.L;this.qg=a.qg;this.rg=a.rg};
L.prototype.setTo=L.prototype.eq=function(a,b,c,d){e&&(Kb(a,"setTo:x"),Kb(b,"setTo:y"),Lb(c,"setTo:offx"),Lb(d,"setTo:offy"));t.J(this);this.K=a;this.L=b;this.qg=c;this.rg=d;return this};L.prototype.set=L.prototype.set=function(a){e&&t.l(a,L,L,"set:s");t.J(this);this.K=a.K;this.L=a.L;this.qg=a.qg;this.rg=a.rg;return this};L.prototype.copy=function(){var a=new L;a.K=this.K;a.L=this.L;a.qg=this.qg;a.rg=this.rg;return a};L.prototype.Oa=function(){this.tb=!0;Object.freeze(this);return this};
L.prototype.ba=function(){return Object.isFrozen(this)?this:this.copy().freeze()};L.prototype.freeze=function(){this.tb=!0;return this};L.prototype.Ra=function(){Object.isFrozen(this)&&t.m("cannot thaw constant: "+this);this.tb=!1;return this};function Ob(a,b){a.K=NaN;a.L=NaN;a.qg=b;return a}function Kb(a,b){(isNaN(a)||1<a||0>a)&&t.ha(a,"0 <= "+b+" <= 1",L,b)}function Lb(a,b){(isNaN(a)||Infinity===a||-Infinity===a)&&t.ha(a,"real number, not NaN or Infinity",L,b)}var Pb;
L.parse=Pb=function(a){if("string"===typeof a){a=a.trim();if("None"===a)return t.NONE;if("TopLeft"===a)return t.my;if("Top"===a||"TopCenter"===a||"MiddleTop"===a)return t.sq;if("TopRight"===a)return t.oy;if("Left"===a||"LeftCenter"===a||"MiddleLeft"===a)return t.pq;if("Center"===a)return t.Yx;if("Right"===a||"RightCenter"===a||"MiddleRight"===a)return t.qq;if("BottomLeft"===a)return t.Tx;if("Bottom"===a||"BottomCenter"===a||"MiddleBottom"===a)return t.oq;if("BottomRight"===a)return t.Vx;if("TopSide"===
a)return t.qy;if("LeftSide"===a)return t.by;if("RightSide"===a)return t.ky;if("BottomSide"===a)return t.Xx;if("TopBottomSides"===a)return t.ly;if("LeftRightSides"===a)return t.ay;if("TopLeftSides"===a)return t.ny;if("TopRightSides"===a)return t.py;if("BottomLeftSides"===a)return t.Ux;if("BottomRightSides"===a)return t.Wx;if("NotTopSide"===a)return t.iy;if("NotLeftSide"===a)return t.gy;if("NotRightSide"===a)return t.hy;if("NotBottomSide"===a)return t.ey;if("AllSides"===a)return t.Sx;if("Default"===
a)return t.Zx;a=a.split(" ");for(var b=0,c=0;""===a[b];)b++;var d=a[b++];d&&(c=parseFloat(d));for(var f=0;""===a[b];)b++;(d=a[b++])&&(f=parseFloat(d));for(var g=0;""===a[b];)b++;(d=a[b++])&&(g=parseFloat(d));for(var h=0;""===a[b];)b++;(d=a[b++])&&(h=parseFloat(d));return new L(c,f,g,h)}return new L};L.stringify=function(a){return a instanceof L?a.Cd()?a.x.toString()+" "+a.y.toString()+" "+a.offsetX.toString()+" "+a.offsetY.toString():a.toString():a.toString()};
L.prototype.toString=function(){return this.Cd()?0===this.qg&&0===this.rg?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.O(t.NONE)?"None":this.O(t.my)?"TopLeft":this.O(t.sq)?"Top":this.O(t.oy)?"TopRight":this.O(t.pq)?"Left":this.O(t.Yx)?"Center":this.O(t.qq)?"Right":this.O(t.Tx)?"BottomLeft":this.O(t.oq)?"Bottom":this.O(t.Vx)?"BottomRight":this.O(t.qy)?"TopSide":this.O(t.by)?"LeftSide":this.O(t.ky)?"RightSide":this.O(t.Xx)?"BottomSide":this.O(t.ly)?
"TopBottomSides":this.O(t.ay)?"LeftRightSides":this.O(t.ny)?"TopLeftSides":this.O(t.py)?"TopRightSides":this.O(t.Ux)?"BottomLeftSides":this.O(t.Wx)?"BottomRightSides":this.O(t.iy)?"NotTopSide":this.O(t.gy)?"NotLeftSide":this.O(t.hy)?"NotRightSide":this.O(t.ey)?"NotBottomSide":this.O(t.Sx)?"AllSides":this.O(t.Zx)?"Default":"None"};
L.prototype.equals=L.prototype.O=function(a){return a instanceof L?(this.K===a.x||isNaN(this.K)&&isNaN(a.x))&&(this.L===a.y||isNaN(this.L)&&isNaN(a.y))&&this.qg===a.offsetX&&this.rg===a.offsetY:!1};L.prototype.opposite=function(){return new L(0.5-(this.K-0.5),0.5-(this.L-0.5),-this.qg,-this.rg)};L.prototype.includesSide=function(a){if(!this.Ep()||!a.Ep())return!1;a=a.offsetY;return(this.rg&a)===a};t.g(L,"x",L.prototype.x);
t.defineProperty(L,{x:"x"},function(){return this.K},function(a){t.J(this,a);e&&Kb(a,"x");this.K=a});t.g(L,"y",L.prototype.y);t.defineProperty(L,{y:"y"},function(){return this.L},function(a){t.J(this,a);e&&Kb(a,"y");this.L=a});t.g(L,"offsetX",L.prototype.offsetX);t.defineProperty(L,{offsetX:"offsetX"},function(){return this.qg},function(a){t.J(this,a);e&&Lb(a,"offsetX");this.qg=a});t.g(L,"offsetY",L.prototype.offsetY);
t.defineProperty(L,{offsetY:"offsetY"},function(){return this.rg},function(a){t.J(this,a);e&&Lb(a,"offsetY");this.rg=a});L.prototype.isSpot=L.prototype.Cd=function(){return!isNaN(this.x)&&!isNaN(this.y)};L.prototype.isNoSpot=L.prototype.Me=function(){return isNaN(this.x)||isNaN(this.y)};L.prototype.isSide=L.prototype.Ep=function(){return this.Me()&&1===this.offsetX&&0!==this.offsetY};L.prototype.isDefault=L.prototype.Tc=function(){return isNaN(this.x)&&isNaN(this.y)&&-1===this.offsetX&&0===this.offsetY};
t.gd=1;t.Mc=2;t.Xc=4;t.Wc=8;t.NONE=Ob(new L(0,0,0,0),0).Oa();t.Zx=Ob(new L(0,0,-1,0),-1).Oa();t.my=(new L(0,0,0,0)).Oa();t.sq=(new L(0.5,0,0,0)).Oa();t.oy=(new L(1,0,0,0)).Oa();t.pq=(new L(0,0.5,0,0)).Oa();t.Yx=(new L(0.5,0.5,0,0)).Oa();t.qq=(new L(1,0.5,0,0)).Oa();t.Tx=(new L(0,1,0,0)).Oa();t.oq=(new L(0.5,1,0,0)).Oa();t.Vx=(new L(1,1,0,0)).Oa();t.qy=Ob(new L(0,0,1,t.gd),1).Oa();t.by=Ob(new L(0,0,1,t.Mc),1).Oa();t.ky=Ob(new L(0,0,1,t.Xc),1).Oa();t.Xx=Ob(new L(0,0,1,t.Wc),1).Oa();
t.ly=Ob(new L(0,0,1,t.gd|t.Wc),1).Oa();t.ay=Ob(new L(0,0,1,t.Mc|t.Xc),1).Oa();t.ny=Ob(new L(0,0,1,t.gd|t.Mc),1).Oa();t.py=Ob(new L(0,0,1,t.gd|t.Xc),1).Oa();t.Ux=Ob(new L(0,0,1,t.Wc|t.Mc),1).Oa();t.Wx=Ob(new L(0,0,1,t.Wc|t.Xc),1).Oa();t.iy=Ob(new L(0,0,1,t.Mc|t.Xc|t.Wc),1).Oa();t.gy=Ob(new L(0,0,1,t.gd|t.Xc|t.Wc),1).Oa();t.hy=Ob(new L(0,0,1,t.gd|t.Mc|t.Wc),1).Oa();t.ey=Ob(new L(0,0,1,t.gd|t.Mc|t.Xc),1).Oa();t.Sx=Ob(new L(0,0,1,t.gd|t.Mc|t.Xc|t.Wc),1).Oa();var Tb;L.None=Tb=t.NONE;var Ub;
L.Default=Ub=t.Zx;var Vb;L.TopLeft=Vb=t.my;var Wb;L.TopCenter=Wb=t.sq;var Xb;L.TopRight=Xb=t.oy;L.LeftCenter=t.pq;var Yb;L.Center=Yb=t.Yx;L.RightCenter=t.qq;var $b;L.BottomLeft=$b=t.Tx;var ac;L.BottomCenter=ac=t.oq;var bc;L.BottomRight=bc=t.Vx;var cc;L.MiddleTop=cc=t.sq;var gc;L.MiddleLeft=gc=t.pq;var hc;L.MiddleRight=hc=t.qq;var mc;L.MiddleBottom=mc=t.oq;L.Top=t.sq;var nc;L.Left=nc=t.pq;var qc;L.Right=qc=t.qq;L.Bottom=t.oq;var rc;L.TopSide=rc=t.qy;var sc;L.LeftSide=sc=t.by;var tc;
L.RightSide=tc=t.ky;var uc;L.BottomSide=uc=t.Xx;L.TopBottomSides=t.ly;L.LeftRightSides=t.ay;L.TopLeftSides=t.ny;L.TopRightSides=t.py;L.BottomLeftSides=t.Ux;L.BottomRightSides=t.Wx;L.NotTopSide=t.iy;L.NotLeftSide=t.gy;L.NotRightSide=t.hy;L.NotBottomSide=t.ey;var vc;L.AllSides=vc=t.Sx;function yc(){this.hf=[1,0,0,1,0,0]}yc.prototype.copy=function(){var a=new yc;a.hf[0]=this.hf[0];a.hf[1]=this.hf[1];a.hf[2]=this.hf[2];a.hf[3]=this.hf[3];a.hf[4]=this.hf[4];a.hf[5]=this.hf[5];return a};
function zc(a){this.type=a;this.r2=this.y2=this.x2=this.r1=this.y1=this.x1=0;this.wE=[]}zc.prototype.addColorStop=function(a,b){this.wE.push({offset:a,color:b})};
function Ac(a,b,c){this.fillStyle="#000000";this.font="10px sans-serif";this.globalAlpha=1;this.lineCap="butt";this.px=0;this.lineJoin="miter";this.lineWidth=1;this.miterLimit=10;this.shadowBlur=0;this.shadowColor="rgba(0, 0, 0, 0)";this.shadowOffsetY=this.shadowOffsetX=0;this.strokeStyle="#000000";this.textAlign="start";this.document=b||document;this.YE=c;this.mx=null;this.path=[];this.lj=new yc;this.stack=[];this.Bf=[];this.IG=this.kF=this.zw=0;this.Nw=a;this.QJ="http://www.w3.org/2000/svg";this.width=
this.Nw.width;this.height=this.Nw.height;this.Ll=Bc(this,"svg",{width:this.width+"px",height:this.height+"px",cL:"0 0 "+this.Nw.width+" "+this.Nw.height});this.Ll.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg");this.Ll.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");Cc(this,1,0,0,1,0,0);a=Bc(this,"clipPath",{id:"mainClip"});a.appendChild(Bc(this,"rect",{x:0,y:0,width:this.width,height:this.height}));this.Ll.appendChild(a);
this.Bf[0].setAttributeNS(null,"clip-path","url(#mainClip)")}aa=Ac.prototype;aa.arc=function(a,b,c,d,f,g){Dc(this,a,b,c,d,f,g)};aa.beginPath=function(){this.path=[]};aa.bezierCurveTo=function(a,b,c,d,f,g){this.path.push(["C",a,b,c,d,f,g])};aa.clearRect=function(){};aa.clip=function(){Ec(this,"clipPath",this.path,new yc)};aa.closePath=function(){this.path.push(["z"])};aa.createLinearGradient=function(a,b,c,d){var f=new zc("linear");f.x1=a;f.y1=b;f.x2=c;f.y2=d;return f};aa.createPattern=function(){};
aa.createRadialGradient=function(a,b,c,d,f,g){var h=new zc("radial");h.x1=a;h.y1=b;h.r1=c;h.x2=d;h.y2=f;h.r2=g;return h};
aa.drawImage=function(a,b,c,d,f,g,h,k,l){a=[b,c,d,f,g,h,k,l,a];b=this.lj;f=a[8];c={x:0,y:0,width:f.naturalWidth,height:f.naturalHeight,href:f.src};d="";g=a[6]/a[2];h=a[7]/a[3];if(0!==a[4]||0!==a[5])d+=" translate("+a[4]+", "+a[5]+")";if(1!==g||1!==h)d+=" scale("+g+", "+h+")";if(0!==a[0]||0!==a[1])d+=" translate("+-a[0]+", "+-a[1]+")";if(0!==a[0]||0!==a[1]||a[2]!==f.naturalWidth||a[3]!==f.naturalHeight)f="CLIP"+this.zw,this.zw++,g=Bc(this,"clipPath",{id:f}),g.appendChild(Bc(this,"rect",{x:a[0],y:a[1],
width:a[2],height:a[3]})),this.Ll.appendChild(g),c["clip-path"]="url(#"+f+")";Mc(this,"image",c,b,d);this.addElement("image",c)};aa.fill=function(){Ec(this,"fill",this.path,this.lj)};aa.fillRect=function(a,b,c,d){Nc(this,"fill",[a,b,c,d],this.lj)};aa.fillText=function(a,b,c){a=[a,b,c];b=this.textAlign;"left"===b?b="start":"right"===b?b="end":"center"===b&&(b="middle");b={x:a[1],y:a[2],style:"font: "+this.font,"text-anchor":b};Mc(this,"fill",b,this.lj);this.addElement("text",b,a[0])};
aa.lineTo=function(a,b){this.path.push(["L",a,b])};aa.moveTo=function(a,b){this.path.push(["M",a,b])};aa.quadraticCurveTo=function(a,b,c,d){this.path.push(["Q",a,b,c,d])};aa.rect=function(a,b,c,d){this.path.push(["M",a,b],["L",a+c,b],["L",a+c,b+d],["L",a,b+d],["z"])};
aa.restore=function(){this.lj=this.stack.pop();this.path=this.stack.pop();var a=this.stack.pop();this.fillStyle=a.fillStyle;this.font=a.font;this.globalAlpha=a.globalAlpha;this.lineCap=a.lineCap;this.px=a.px;this.lineJoin=a.lineJoin;this.lineWidth=a.lineWidth;this.miterLimit=a.miterLimit;this.shadowBlur=a.shadowBlur;this.shadowColor=a.shadowColor;this.shadowOffsetX=a.shadowOffsetX;this.shadowOffsetY=a.shadowOffsetY;this.strokeStyle=a.strokeStyle;this.textAlign=a.textAlign};
aa.save=function(){this.stack.push({fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,px:this.px,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign});for(var a=[],b=0;b<this.path.length;b++)a.push(this.path[b]);this.stack.push(a);this.stack.push(this.lj.copy())};
aa.setTransform=function(a,b,c,d,f,g){1===a&&0===b&&0===c&&1===d&&0===f&&0===g||Cc(this,a,b,c,d,f,g)};aa.scale=function(){};aa.stroke=function(){Ec(this,"stroke",this.path,this.lj)};aa.strokeRect=function(a,b,c,d){Nc(this,"stroke",[a,b,c,d],this.lj)};function Bc(a,b,c,d){a=a.document.createElementNS(a.QJ,b);if(c)for(var f in c)a.setAttributeNS("href"===f?"http://www.w3.org/1999/xlink":"",f,c[f]);d&&(a.textContent=d);return a}
aa.addElement=function(a,b,c){a=Bc(this,a,b,c);0<this.Bf.length?this.Bf[this.Bf.length-1].appendChild(a):this.Ll.appendChild(a);return this.mx=a};
function Mc(a,b,c,d,f){1!==a.globalAlpha&&(c.opacity=a.globalAlpha);"fill"==b?(/^rgba\(/.test(a.fillStyle)?(a=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(a.fillStyle),c.fill="rgb("+a[1]+","+a[2]+","+a[3]+")",c["fill-opacity"]=a[4]):c.fill=a.fillStyle instanceof zc?Oc(a,a.fillStyle):a.fillStyle,c.stroke="none"):"stroke"==b&&(c.fill="none",/^rgba\(/.test(a.strokeStyle)?(b=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(a.strokeStyle),
c.stroke="rgb("+b[1]+","+b[2]+","+b[3]+")",c["stroke-opacity"]=b[4]):c.stroke=a.strokeStyle instanceof zc?Oc(a,a.strokeStyle):a.strokeStyle,c["stroke-width"]=a.lineWidth,c["stroke-linecap"]=a.lineCap,c["stroke-linejoin"]=a.lineJoin,c["stroke-miterlimit"]=a.miterLimit);d=d.hf;d="matrix("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+")";void 0!==f&&(d+=f);c.transform=d}
function Oc(a,b){var c="GRAD"+a.kF;a.kF++;var d;if("linear"===b.type)d={x1:b.x1,x2:b.x2,y1:b.y1,y2:b.y2,id:c,gradientUnits:"userSpaceOnUse"},d=Bc(a,"linearGradient",d);else if("radial"===b.type)d={x1:b.x1,x2:b.x2,y1:b.y1,y2:b.y2,r1:b.r1,r2:b.r2,id:c},d=Bc(a,"radialGradient",d);else throw Error("invalid gradient");for(var f=b.wE,g=f.length,h=[],k=0;k<g;k++){var l=f[k],m=l.color,l={offset:l.offset,"stop-color":m};/^rgba\(/.test(m)&&(m=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(m),
l["stop-color"]="rgb("+m[1]+","+m[2]+","+m[3]+")",l["stop-opacity"]=m[4]);h.push(l)}h.sort(function(a,b){return a.offset>b.offset?1:-1});for(k=0;k<g;k++)d.appendChild(Bc(a,"stop",h[k]));a.Ll.appendChild(d);return"url(#"+c+")"}function Nc(a,b,c,d){c={x:c[0],y:c[1],width:c[2],height:c[3]};Mc(a,b,c,d);a.addElement("rect",c)}
function Ec(a,b,c,d){for(var f=[],g=0;g<c.length;g++){var h=Array.prototype.slice.call(c[g]),k=[h.shift()];if("A"==k[0])k.push(h.shift()+","+h.shift(),h.shift(),h.shift()+","+h.shift(),h.shift()+","+h.shift());else for(;h.length;)k.push(h.shift()+","+h.shift());f.push(k.join(" "))}c={d:f.join(" ")};Mc(a,b,c,d);"clipPath"===b?(b="CLIP"+a.zw,a.zw++,d=Bc(a,"clipPath",{id:b}),d.appendChild(Bc(a,"path",c)),a.Ll.appendChild(d),0<a.Bf.length&&a.Bf[a.Bf.length-1].setAttributeNS(null,"clip-path","url(#"+b+
")")):a.addElement("path",c)}function Dc(a,b,c,d,f,g,h){var k=Math.abs(f-g);if(f!=g){var l=b+d*Math.cos(g);g=c+d*Math.sin(g);k>=2*Math.PI?(Dc(a,b,c,d,f,f+Math.PI,h),Dc(a,b,c,d,f+Math.PI,f+2*Math.PI,h),a.path.push(["M",l,g])):(b+=d*Math.cos(f),c+=d*Math.sin(f),k=180*k/Math.PI,f=h?0:1,h=180<=k==!!h?0:1,0!==a.path.length?a.path.push(["L",b,c]):a.path.push(["M",b,c]),a.path.push(["A",d,d,k,h,f,l,g]))}}
function Cc(a,b,c,d,f,g,h){var k=new yc;k.hf=[b,c,d,f,g,h];b={};Mc(a,"g",b,k);k=a.addElement("g",b);a.Bf.push(k)}
aa.jb=function(){var a="SHADOW"+this.IG;this.IG++;var b=this.addElement("filter",{id:a,width:"250%",height:"250%"},null),c,d,f,g,h;if(0!==this.shadowOffsetX||0!==this.shadowOffsetY)c=Bc(this,"feGaussianBlur",{"in":"SourceAlpha",result:"blur",$K:this.shadowBlur/2}),d=Bc(this,"feFlood",{"in":"blur",result:"flood","flood-color":this.shadowColor}),f=Bc(this,"feComposite",{"in":"flood",in2:"blur",operator:"in",result:"comp"}),g=Bc(this,"feOffset",{"in":"comp",result:"offsetBlur",dx:this.shadowOffsetX,
dy:this.shadowOffsetY}),h=Bc(this,"feMerge",{}),h.appendChild(Bc(this,"feMergeNode",{"in":"offsetBlur"})),h.appendChild(Bc(this,"feMergeNode",{"in":"SourceGraphic"})),b.appendChild(c),b.appendChild(d),b.appendChild(f),b.appendChild(g),b.appendChild(h);0<this.Bf.length&&this.Bf[this.Bf.length-1].setAttributeNS(null,"filter","url(#"+a+")")};
var K={za:4*((Math.sqrt(2)-1)/3),Aj:(new E(0,0)).Oa(),xH:(new F(0,0,0,0)).Oa(),tq:(new wb(0,0,0,0)).Oa(),vH:(new wb(2,2,2,2)).Oa(),wH:(new ra(Infinity,Infinity)).Oa(),tH:(new E(-Infinity,-Infinity)).Oa(),sH:(new E(Infinity,Infinity)).Oa(),uq:(new ra(0,0)).Oa(),jy:(new ra(1,1)).Oa(),rq:(new ra(6,6)).Oa(),$x:(new ra(8,8)).Oa(),uH:(new E(NaN,NaN)).Oa(),VB:null,sqrt:function(a){if(0>=a)return 0;var b=K.VB;if(null===b){for(var b=[],c=0;2E3>=c;c++)b[c]=Math.sqrt(c);K.VB=b}return 1>a?(c=1/a,2E3>=c?1/b[c|
0]:Math.sqrt(a)):2E3>=a?b[a|0]:Math.sqrt(a)},I:function(a,b){var c=a-b;return 0.5>c&&-0.5<c},sb:function(a,b){var c=a-b;return 5E-8>c&&-5E-8<c},Sd:function(a,b,c,d,f,g,h){0>=f&&(f=1E-6);var k,l,m,n;a<c?(l=a,k=c):(l=c,k=a);b<d?(n=b,m=d):(n=d,m=b);if(a===c)return n<=h&&h<=m&&a-f<=g&&g<=a+f;if(b===d)return l<=g&&g<=k&&b-f<=h&&h<=b+f;k+=f;l-=f;if(l<=g&&g<=k&&(m+=f,n-=f,n<=h&&h<=m))if(k-l>m-n)if(a-c>f||c-a>f){if(g=(d-b)/(c-a)*(g-a)+b,g-f<=h&&h<=g+f)return!0}else return!0;else if(b-d>f||d-b>f){if(h=(c-
a)/(d-b)*(h-b)+a,h-f<=g&&g<=h+f)return!0}else return!0;return!1},uw:function(a,b,c,d,f,g,h,k,l,m,n,p){if(K.Sd(a,b,h,k,p,c,d)&&K.Sd(a,b,h,k,p,f,g))return K.Sd(a,b,h,k,p,m,n);var q=(a+c)/2,r=(b+d)/2,s=(c+f)/2,u=(d+g)/2;f=(f+h)/2;g=(g+k)/2;d=(q+s)/2;c=(r+u)/2;var s=(s+f)/2,u=(u+g)/2,w=(d+s)/2,D=(c+u)/2;return K.uw(a,b,q,r,d,c,w,D,l,m,n,p)||K.uw(w,D,s,u,f,g,h,k,l,m,n,p)},qI:function(a,b,c,d,f,g,h,k,l){var m=(c+f)/2,n=(d+g)/2;l.x=(((a+c)/2+m)/2+(m+(f+h)/2)/2)/2;l.y=(((b+d)/2+n)/2+(n+(g+k)/2)/2)/2;return l},
pI:function(a,b,c,d,f,g,h,k){var l=(c+f)/2,m=(d+g)/2;return pb(((a+c)/2+l)/2,((b+d)/2+m)/2,(l+(f+h)/2)/2,(m+(g+k)/2)/2)},ep:function(a,b,c,d,f,g,h,k,l,m){if(K.Sd(a,b,h,k,l,c,d)&&K.Sd(a,b,h,k,l,f,g))Fb(m,a,b,0,0),Fb(m,h,k,0,0);else{var n=(a+c)/2,p=(b+d)/2,q=(c+f)/2,r=(d+g)/2;f=(f+h)/2;g=(g+k)/2;d=(n+q)/2;c=(p+r)/2;var q=(q+f)/2,r=(r+g)/2,s=(d+q)/2,u=(c+r)/2;K.ep(a,b,n,p,d,c,s,u,l,m);K.ep(s,u,q,r,f,g,h,k,l,m)}return m},Fe:function(a,b,c,d,f,g,h,k,l,m){if(K.Sd(a,b,h,k,l,c,d)&&K.Sd(a,b,h,k,l,f,g))0===
m.length&&m.push([a,b]),m.push([h,k]);else{var n=(a+c)/2,p=(b+d)/2,q=(c+f)/2,r=(d+g)/2;f=(f+h)/2;g=(g+k)/2;d=(n+q)/2;c=(p+r)/2;var q=(q+f)/2,r=(r+g)/2,s=(d+q)/2,u=(c+r)/2;K.Fe(a,b,n,p,d,c,s,u,l,m);K.Fe(s,u,q,r,f,g,h,k,l,m)}return m},gB:function(a,b,c,d,f,g,h,k,l,m){if(K.Sd(a,b,f,g,m,c,d))return K.Sd(a,b,f,g,m,k,l);var n=(a+c)/2,p=(b+d)/2;c=(c+f)/2;d=(d+g)/2;var q=(n+c)/2,r=(p+d)/2;return K.gB(a,b,n,p,q,r,h,k,l,m)||K.gB(q,r,c,d,f,g,h,k,l,m)},ZK:function(a,b,c,d,f,g,h){h.x=((a+c)/2+(c+f)/2)/2;h.y=((b+
d)/2+(d+g)/2)/2;return h},fB:function(a,b,c,d,f,g,h,k){if(K.Sd(a,b,f,g,h,c,d))Fb(k,a,b,0,0),Fb(k,f,g,0,0);else{var l=(a+c)/2,m=(b+d)/2;c=(c+f)/2;d=(d+g)/2;var n=(l+c)/2,p=(m+d)/2;K.fB(a,b,l,m,n,p,h,k);K.fB(n,p,c,d,f,g,h,k)}return k},Wp:function(a,b,c,d,f,g,h,k){if(K.Sd(a,b,f,g,h,c,d))0===k.length&&k.push([a,b]),k.push([f,g]);else{var l=(a+c)/2,m=(b+d)/2;c=(c+f)/2;d=(d+g)/2;var n=(l+c)/2,p=(m+d)/2;K.Wp(a,b,l,m,n,p,h,k);K.Wp(n,p,c,d,f,g,h,k)}return k},dt:function(a,b,c,d,f,g,h,k,l,m,n,p,q,r){0>=q&&
(q=1E-6);if(K.Sd(a,b,h,k,q,c,d)&&K.Sd(a,b,h,k,q,f,g)){var s=(a-h)*(m-p)-(b-k)*(l-n);if(!s)return!1;q=((a*k-b*h)*(l-n)-(a-h)*(l*p-m*n))/s;s=((a*k-b*h)*(m-p)-(b-k)*(l*p-m*n))/s;if((l>n?l-n:n-l)<(m>p?m-p:p-m)){if(b<k?(l=b,h=k):(l=k,h=b),s<l||s>h)return!1}else if(a<h?l=a:(l=h,h=a),q<l||q>h)return!1;r.x=q;r.y=s;return!0}var s=(a+c)/2,u=(b+d)/2;c=(c+f)/2;d=(d+g)/2;f=(f+h)/2;g=(g+k)/2;var w=(s+c)/2,D=(u+d)/2;c=(c+f)/2;d=(d+g)/2;var A=(w+c)/2,G=(D+d)/2,M=(n-l)*(n-l)+(p-m)*(p-m),N=!1;K.dt(a,b,s,u,w,D,A,G,
l,m,n,p,q,r)&&(a=(r.x-l)*(r.x-l)+(r.y-m)*(r.y-m),a<M&&(M=a,N=!0));b=r.x;s=r.y;K.dt(A,G,c,d,f,g,h,k,l,m,n,p,q,r)&&(a=(r.x-l)*(r.x-l)+(r.y-m)*(r.y-m),a<M?N=!0:(r.x=b,r.y=s));return N},et:function(a,b,c,d,f,g,h,k,l,m,n,p,q){var r=0;0>=q&&(q=1E-6);if(K.Sd(a,b,h,k,q,c,d)&&K.Sd(a,b,h,k,q,f,g)){q=(a-h)*(m-p)-(b-k)*(l-n);if(!q)return r;var s=((a*k-b*h)*(l-n)-(a-h)*(l*p-m*n))/q,u=((a*k-b*h)*(m-p)-(b-k)*(l*p-m*n))/q;if(s>=n)return r;if((l>n?l-n:n-l)<(m>p?m-p:p-m)){if(b<k?(l=b,a=k):(l=k,a=b),u<l||u>a)return r}else if(a<
h?(l=a,a=h):l=h,s<l||s>a)return r;0<q?r++:0>q&&r--}else{var s=(a+c)/2,u=(b+d)/2,w=(c+f)/2,D=(d+g)/2;f=(f+h)/2;g=(g+k)/2;d=(s+w)/2;c=(u+D)/2;var w=(w+f)/2,D=(D+g)/2,A=(d+w)/2,G=(c+D)/2,r=r+K.et(a,b,s,u,d,c,A,G,l,m,n,p,q),r=r+K.et(A,G,w,D,f,g,h,k,l,m,n,p,q)}return r},vn:function(a,b,c,d,f,g,h){if(K.sb(a,c)){var k;b<d?(k=b,c=d):(k=d,c=b);d=g;if(d<k)return h.x=a,h.y=k,!1;if(d>c)return h.x=a,h.y=c,!1;h.x=a;h.y=d;return!0}if(K.sb(b,d)){a<c?k=a:(k=c,c=a);d=f;if(d<k)return h.x=k,h.y=b,!1;if(d>c)return h.x=
c,h.y=b,!1;h.x=d;h.y=b;return!0}k=((a-f)*(a-c)+(b-g)*(b-d))/((c-a)*(c-a)+(d-b)*(d-b));if(-5E-6>k)return h.x=a,h.y=b,!1;if(1.000005<k)return h.x=c,h.y=d,!1;h.x=a+k*(c-a);h.y=b+k*(d-b);return!0},uh:function(a,b,c,d,f,g,h,k,l){if(K.I(a,c)&&K.I(b,d))return l.x=a,l.y=b,!1;if(K.sb(f,h)){if(K.sb(a,c))return K.vn(a,b,c,d,f,g,l),!1;g=(d-b)/(c-a)*(f-a)+b;return K.vn(a,b,c,d,f,g,l)}k=(k-g)/(h-f);if(K.sb(a,c)){g=k*(a-f)+g;b<d?(h=b,c=d):(h=d,c=b);if(g<h)return l.x=a,l.y=h,!1;if(g>c)return l.x=a,l.y=c,!1;l.x=a;
l.y=g;return!0}h=(d-b)/(c-a);if(K.sb(k,h))return K.vn(a,b,c,d,f,g,l),!1;f=(h*a-k*f+g-b)/(h-k);if(K.sb(h,0)){a<c?h=a:(h=c,c=a);if(f<h)return l.x=h,l.y=b,!1;if(f>c)return l.x=c,l.y=b,!1;l.x=f;l.y=b;return!0}g=h*(f-a)+b;return K.vn(a,b,c,d,f,g,l)},MK:function(a,b,c,d,f){return K.uh(c.x,c.y,d.x,d.y,a.x,a.y,b.x,b.y,f)},IK:function(a,b,c,d,f,g,h,k,l,m){function n(c,d){var f=(c-a)*(c-a)+(d-b)*(d-b);f<p&&(p=f,l.x=c,l.y=d)}var p=Infinity;n(l.x,l.y);var q,r,s,u;f<h?(q=f,r=h):(q=h,r=f);g<k?(s=f,u=h):(s=h,u=
f);q=(r-q)/2+m;m=(u-s)/2+m;f=(f+h)/2;g=(g+k)/2;if(0===q||0===m)return l;if(0.5>(c>a?c-a:a-c)){q=1-(c-f)*(c-f)/(q*q);if(0>q)return l;q=Math.sqrt(q);d=-m*q+g;n(c,m*q+g);n(c,d)}else{c=(d-b)/(c-a);d=1/(q*q)+c*c/(m*m);k=2*c*(b-c*a)/(m*m)-2*c*g/(m*m)-2*f/(q*q);q=k*k-4*d*(2*c*a*g/(m*m)-2*b*g/(m*m)+g*g/(m*m)+f*f/(q*q)-1+(b-c*a)*(b-c*a)/(m*m));if(0>q)return l;q=Math.sqrt(q);m=(-k+q)/(2*d);n(m,c*m-c*a+b);q=(-k-q)/(2*d);n(q,c*q-c*a+b)}return l},yl:function(a,b,c,d,f,g,h,k,l){var m=1E21,n=a,p=b;if(K.uh(a,b,a,
d,f,g,h,k,l)){var q=(l.x-f)*(l.x-f)+(l.y-g)*(l.y-g);q<m&&(m=q,n=l.x,p=l.y)}K.uh(c,b,c,d,f,g,h,k,l)&&(q=(l.x-f)*(l.x-f)+(l.y-g)*(l.y-g),q<m&&(m=q,n=l.x,p=l.y));K.uh(a,b,c,b,f,g,h,k,l)&&(q=(l.x-f)*(l.x-f)+(l.y-g)*(l.y-g),q<m&&(m=q,n=l.x,p=l.y));K.uh(a,d,c,d,f,g,h,k,l)&&(q=(l.x-f)*(l.x-f)+(l.y-g)*(l.y-g),q<m&&(m=q,n=l.x,p=l.y));l.x=n;l.y=p;return 1E21>m},bx:function(a,b,c){var d=b.x,f=b.y,g=c.x,h=c.y,k=a.left,l=a.right,m=a.top,n=a.bottom;return d===g?(f<h?(a=f,g=h):(a=h,g=f),k<=d&&d<=l&&a<=n&&g>=m):
f===h?(d<g?a=d:(a=g,g=d),m<=f&&f<=n&&a<=l&&g>=k):a.La(b)||a.La(c)||K.ax(k,m,l,m,d,f,g,h)||K.ax(l,m,l,n,d,f,g,h)||K.ax(l,n,k,n,d,f,g,h)||K.ax(k,n,k,m,d,f,g,h)?!0:!1},ax:function(a,b,c,d,f,g,h,k){return 0>=K.Bw(a,b,c,d,f,g)*K.Bw(a,b,c,d,h,k)&&0>=K.Bw(f,g,h,k,a,b)*K.Bw(f,g,h,k,c,d)},Bw:function(a,b,c,d,f,g){c-=a;d-=b;a=f-a;b=g-b;g=a*d-b*c;0===g&&(g=a*c+b*d,0<g&&(g=(a-c)*c+(b-d)*d,0>g&&(g=0)));return 0>g?-1:0<g?1:0},Tt:function(a){0>a&&(a+=360);360<=a&&(a-=360);return a},FE:function(a,b,c,d,f,g){var h=
Math.PI;g||(d*=h/180,f*=h/180);g=d<f?1:-1;var k=[],l=h/2,m=d;for(d=Math.min(2*h+1E-5,Math.abs(f-d));1E-5<d;)f=m+g*Math.min(d,l),k.push(K.zI(c,m,f,a,b)),d-=Math.abs(f-m),m=f;return k},zI:function(a,b,c,d,f){var g=(c-b)/2,h=a*Math.cos(g),k=a*Math.sin(g),l=0.5522847498*Math.tan(g),m=h+l*k,h=-k+l*h,k=-h,l=g+b,g=Math.cos(l),l=Math.sin(l);return{x1:d+a*Math.cos(b),y1:f+a*Math.sin(b),x2:d+m*g-h*l,y2:f+m*l+h*g,ne:d+m*g-k*l,oe:f+m*l+k*g,$b:d+a*Math.cos(c),ac:f+a*Math.sin(c)}},rt:function(a,b,c,d,f,g,h){c=
Math.floor((a-c)/f)*f+c;d=Math.floor((b-d)/g)*g+d;var k=c;c+f-a<f/2&&(k=c+f);a=d;d+g-b<g/2&&(a=d+g);h.p(k,a);return h},hF:function(a,b){var c=Math.max(a,b),d=Math.min(a,b),f=1,g=1;do f=c%d,c=g=d,d=f;while(0<f);return g},OI:function(a,b,c,d){var f=0>c,g=0>d,h,k;a<b?(h=1,k=0):(h=0,k=1);var l,m;l=0===h?a:b;m=0===h?c:d;if(0===h?f:g)m=-m;h=k;c=0===h?c:d;if(0===h?f:g)c=-c;return K.QI(l,0===h?a:b,m,c,0,0)},QI:function(a,b,c,d,f,g){if(0<d)if(0<c){g=a*a;f=b*b;a*=c;var h=b*d,k=-f+h,l=-f+Math.sqrt(a*a+h*h);
b=k;for(var m=0;9999999999>m;++m){b=0.5*(k+l);if(b===k||b===l)break;var n=a/(b+g),p=h/(b+f),n=n*n+p*p-1;if(0<n)k=b;else if(0>n)l=b;else break}c=g*c/(b+g)-c;d=f*d/(b+f)-d;c=Math.sqrt(c*c+d*d)}else c=Math.abs(d-b);else d=a*a-b*b,f=a*c,f<d?(d=f/d,f=a*d,g=b*Math.sqrt(Math.abs(1-d*d)),c=f-c,c=Math.sqrt(c*c+g*g)):c=Math.abs(c-a);return c}};
function Pc(a){1<arguments.length&&t.m("Geometry constructor can take at most one optional argument, the Geometry type.");t.Fc(this);void 0===a?a=Qc:e&&t.Fa(a,Pc,Pc,"constructor:type");this.ga=a;this.Bb=this.pb=this.Cc=this.tc=0;this.Pk=new H(Rc);this.Xu=this.Pk.Y;this.Iu=(new F).freeze();this.$a=!0;this.Yi=Vb;this.Zi=bc;this.so=this.to=NaN;this.Ac=Sc}t.ka("Geometry",Pc);t.ii(Pc);
Pc.prototype.copy=function(){var a=new Pc;a.ga=this.ga;a.tc=this.tc;a.Cc=this.Cc;a.pb=this.pb;a.Bb=this.Bb;for(var b=this.Pk,c=b.length,d=a.Pk,f=0;f<c;f++){var g=b.n[f].copy();d.add(g)}a.Xu=this.Xu;a.Iu.assign(this.Iu);a.$a=this.$a;a.Yi=this.Yi.ba();a.Zi=this.Zi.ba();a.to=this.to;a.so=this.so;a.Ac=this.Ac;return a};var Tc;Pc.Line=Tc=t.w(Pc,"Line",0);var Uc;Pc.Rectangle=Uc=t.w(Pc,"Rectangle",1);var $c;Pc.Ellipse=$c=t.w(Pc,"Ellipse",2);var Qc;Pc.Path=Qc=t.w(Pc,"Path",3);
Pc.prototype.Oa=function(){this.freeze();Object.freeze(this);return this};Pc.prototype.freeze=function(){this.tb=!0;var a=this.Fb;a.freeze();for(var b=a.length,c=0;c<b;c++)a.n[c].freeze();return this};Pc.prototype.Ra=function(){Object.isFrozen(this)&&t.m("cannot thaw constant: "+this);this.tb=!1;var a=this.Fb;a.Ra();for(var b=a.length,c=0;c<b;c++)a.n[c].Ra();return this};
Pc.prototype.equalsApprox=Pc.prototype.yf=function(a){if(!(a instanceof Pc))return!1;if(this.type!==a.type)return this.type===Tc&&a.type===Qc?ad(this,a):a.type===Tc&&this.type===Qc?ad(a,this):!1;if(this.type===Qc){var b=this.Fb;a=a.Fb;var c=b.length;if(c!==a.length)return!1;for(var d=0;d<c;d++)if(!b.n[d].yf(a.n[d]))return!1;return!0}return K.I(this.sa,a.sa)&&K.I(this.ta,a.ta)&&K.I(this.D,a.D)&&K.I(this.F,a.F)};
function ad(a,b){if(a.type!==Tc||b.type!==Qc)return!1;if(1===b.Fb.count){var c=b.Fb.wa(0);if(1===c.Ka.count&&K.I(a.sa,c.sa)&&K.I(a.ta,c.ta)&&(c=c.Ka.wa(0),c.type===bd&&K.I(a.D,c.D)&&K.I(a.F,c.F)))return!0}return!1}var cd;Pc.stringify=cd=function(a){return a.toString()};
Pc.prototype.toString=function(a){switch(this.type){case Tc:return void 0===a?"M"+this.sa.toString()+" "+this.ta.toString()+"L"+this.D.toString()+" "+this.F.toString():"M"+this.sa.toFixed(a)+" "+this.ta.toFixed(a)+"L"+this.D.toFixed(a)+" "+this.F.toFixed(a);case Uc:var b=new F(this.sa,this.ta,0,0);b.dH(this.D,this.F,0,0);return void 0===a?"M"+b.x.toString()+" "+b.y.toString()+"H"+b.right.toString()+"V"+b.bottom.toString()+"H"+b.left.toString()+"z":"M"+b.x.toFixed(a)+" "+b.y.toFixed(a)+"H"+b.right.toFixed(a)+
"V"+b.bottom.toFixed(a)+"H"+b.left.toFixed(a)+"z";case $c:b=new F(this.sa,this.ta,0,0);b.dH(this.D,this.F,0,0);if(void 0===a){var c=b.left.toString()+" "+(b.y+b.height/2).toString(),d=b.right.toString()+" "+(b.y+b.height/2).toString();return"M"+c+"A"+(b.width/2).toString()+" "+(b.height/2).toString()+" 0 0 1 "+d+"A"+(b.width/2).toString()+" "+(b.height/2).toString()+" 0 0 1 "+c}c=b.left.toFixed(a)+" "+(b.y+b.height/2).toFixed(a);d=b.right.toFixed(a)+" "+(b.y+b.height/2).toFixed(a);return"M"+c+"A"+
(b.width/2).toFixed(a)+" "+(b.height/2).toFixed(a)+" 0 0 1 "+d+"A"+(b.width/2).toFixed(a)+" "+(b.height/2).toFixed(a)+" 0 0 1 "+c;case Qc:for(var b="",c=this.Fb,d=c.length,f=0;f<d;f++){var g=c.n[f];0<f&&(b+=" x ");g.Cp&&(b+="F ");b+=g.toString(a)}return b;default:return this.type.toString()}};var dd;
Pc.fillPath=dd=function(a){"string"!==typeof a&&t.jc(a,"string",Pc,"fillPath:str");a=a.split(/[Xx]/);for(var b=a.length,c="",d=0;d<b;d++)var f=a[d],c=null!==f.match(/[Ff]/)?0===d?c+f:c+("X"+(" "===f[0]?"":" ")+f):c+((0===d?"":"X ")+"F"+(" "===f[0]?"":" ")+f);return c};var ed;
Pc.parse=ed=function(a,b){function c(){return n>=w-1?!0:null!==m[n+1].match(/[A-Za-z]/)}function d(){n++;return m[n]}function f(){var a=new E(parseFloat(d()),parseFloat(d()));p===p.toLowerCase()&&(a.x=u.x+a.x,a.y=u.y+a.y);return a}function g(){return u=f()}function h(){return s=f()}function k(){var a=[parseFloat(d()),parseFloat(d()),parseFloat(d()),parseFloat(d()),parseFloat(d())];c()||(a.push(parseFloat(d())),c()||a.push(parseFloat(d())));p===p.toLowerCase()&&(a[2]+=u.x,a[3]+=u.y);return a}function l(){return"c"!==
q.toLowerCase()&&"s"!==q.toLowerCase()?u:new E(2*u.x-s.x,2*u.y-s.y)}void 0===b&&(b=!1);"string"!==typeof a&&t.jc(a,"string",Pc,"parse:str");a=a.replace(/,/gm," ");a=a.replace(/([UuBbMmZzLlHhVvCcSsQqTtAaFf])([UuBbMmZzLlHhVvCcSsQqTtAaFf])/gm,"$1 $2");a=a.replace(/([UuBbMmZzLlHhVvCcSsQqTtAaFf])([UuBbMmZzLlHhVvCcSsQqTtAaFf])/gm,"$1 $2");a=a.replace(/([UuBbMmZzLlHhVvCcSsQqTtAaFf])([^\s])/gm,"$1 $2");a=a.replace(/([^\s])([UuBbMmZzLlHhVvCcSsQqTtAaFf])/gm,"$1 $2");a=a.replace(/([0-9])([+\-])/gm,"$1 $2");
a=a.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");a=a.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");a=a.replace(/[\s\r\t\n]+/gm," ");a=a.replace(/^\s+|\s+$/g,"");for(var m=a.split(" "),n=-1,p="",q="",r=new E(0,0),s=new E(0,0),u=new E(0,0),w=m.length,D=t.u(),A,G=!1,M=!1,N=!0;!(n>=w-1);)if(q=p,p=d(),""!==p)switch(p.toUpperCase()){case "X":N=!0;M=G=!1;break;case "M":A=g();null===D.bc||!0===N?(P(D,A.x,A.y,G,!1,!M),N=!1):D.moveTo(A.x,A.y);for(r=u;!c();)A=g(),D.lineTo(A.x,A.y);break;case "L":for(;!c();)A=
g(),D.lineTo(A.x,A.y);break;case "H":for(;!c();)u=A=new E((p===p.toLowerCase()?u.x:0)+parseFloat(d()),u.y),D.lineTo(u.x,u.y);break;case "V":for(;!c();)u=A=new E(u.x,(p===p.toLowerCase()?u.y:0)+parseFloat(d())),D.lineTo(u.x,u.y);break;case "C":for(;!c();){var O=f(),U=h();A=g();Q(D,O.x,O.y,U.x,U.y,A.x,A.y)}break;case "S":for(;!c();)O=l(),U=h(),A=g(),Q(D,O.x,O.y,U.x,U.y,A.x,A.y);break;case "Q":for(;!c();)U=h(),A=g(),fd(D,U.x,U.y,A.x,A.y);break;case "T":for(;!c();)s=U=l(),A=g(),fd(D,U.x,U.y,A.x,A.y);
break;case "B":for(;!c();)A=k(),D.arcTo(A[0],A[1],A[2],A[3],A[4],A[5],A[6]);break;case "A":for(;!c();){var O=Math.abs(parseFloat(d())),U=Math.abs(parseFloat(d())),Y=parseFloat(d()),ba=!!parseFloat(d()),R=!!parseFloat(d());A=g();gd(D,O,U,Y,ba,R,A.x,A.y)}break;case "Z":S(D);u=r;break;case "F":A=null;for(O=1;m[n+O];)if(null!==m[n+O].match(/[Uu]/))O++;else if(null===m[n+O].match(/[A-Za-z]/))O++;else{A=m[n+O];break}A.match(/[Mm]/)?G=!0:hd(D);break;case "U":A=null;for(O=1;m[n+O];)if(null!==m[n+O].match(/[Ff]/))O++;
else if(null===m[n+O].match(/[A-Za-z]/))O++;else{A=m[n+O];break}A.match(/[Mm]/)?M=!0:D.jb(!1)}r=D.s;t.v(D);if(b)for(D=r.Fb.k;D.next();)D.value.Cp=!0;return r};function id(a,b){for(var c=a.length,d=t.N(),f=0;f<c;f++){var g=a[f];d.x=g.x1;d.y=g.y1;b.Xa(d);g.x1=d.x;g.y1=d.y;d.x=g.x2;d.y=g.y2;b.Xa(d);g.x2=d.x;g.y2=d.y;d.x=g.ne;d.y=g.oe;b.Xa(d);g.ne=d.x;g.oe=d.y;d.x=g.$b;d.y=g.ac;b.Xa(d);g.$b=d.x;g.ac=d.y}t.B(d)}
Pc.prototype.MA=function(){if(this.$a)return!0;var a=this.Fb;if(this.Xu!==a.Y)return!0;for(var b=a.length,c=0;c<b;c++)if(a.n[c].MA())return!0;return!1};Pc.prototype.NB=function(){this.$a=!1;var a=this.Fb;this.Xu=a.Y;for(var b=a.length,c=0;c<b;c++)a.n[c].NB()};Pc.prototype.vf=function(){var a=this.Iu;a.Ra();isNaN(this.to)||isNaN(this.so)?a.p(0,0,0,0):a.p(0,0,this.to,this.so);jd(this,a,!1);Fb(a,0,0,0,0);a.freeze()};
Pc.prototype.computeBoundsWithoutOrigin=Pc.prototype.vI=function(){var a=new F;jd(this,a,!0);return a};
function jd(a,b,c){switch(a.type){case Tc:case Uc:case $c:c?b.p(a.tc,a.Cc,0,0):Fb(b,a.tc,a.Cc,0,0);Fb(b,a.pb,a.Bb,0,0);break;case Qc:a=a.Fb;for(var d=a.length,f=0;f<d;f++){var g=a.n[f];c&&0===f?b.p(g.sa,g.ta,0,0):Fb(b,g.sa,g.ta,0,0);for(var h=g.Ka,k=h.length,l=g.sa,m=g.ta,n=0;n<k;n++){var p=h.n[n];switch(p.type){case bd:case kd:l=p.D;m=p.F;Fb(b,l,m,0,0);break;case ld:K.ep(l,m,p.Gb,p.Xb,p.ye,p.ze,p.D,p.F,0.5,b);l=p.D;m=p.F;break;case md:K.fB(l,m,p.Gb,p.Xb,p.D,p.F,0.5,b);l=p.D;m=p.F;break;case sd:case ud:for(var p=
p.type===sd?vd(p,g):wd(p,g,l,m),q=p.length,r=null,s=0;s<q;s++)r=p[s],K.ep(r.x1,r.y1,r.x2,r.y2,r.ne,r.oe,r.$b,r.ac,0.5,b);null!==r&&(l=r.$b,m=r.ac);break;default:t.m("Unknown Segment type: "+p.type)}}}break;default:t.m("Unknown Geometry type: "+a.type)}}Pc.prototype.normalize=Pc.prototype.normalize=function(){t.J(this);var a=this.vI();this.offset(-a.x,-a.y);return new E(-a.x,-a.y)};
Pc.prototype.offset=Pc.prototype.offset=function(a,b){t.J(this);e&&(t.q(a,Pc,"offset"),t.q(b,Pc,"offset"));this.transform(1,0,0,1,a,b)};Pc.prototype.scale=Pc.prototype.scale=function(a,b){t.J(this);e&&(t.q(a,Pc,"scale:x"),t.q(b,Pc,"scale:y"),0>=a&&t.ha(a,"scale must be greater than zero",Pc,"scale:x"),0>=b&&t.ha(b,"scale must be greater than zero",Pc,"scale:y"));this.transform(a,0,0,b,0,0)};
Pc.prototype.rotate=Pc.prototype.rotate=function(a,b,c){t.J(this);void 0===b&&(b=0);void 0===c&&(c=0);e&&(t.q(a,Pc,"rotate:angle"),t.q(b,Pc,"rotate:x"),t.q(c,Pc,"rotate:y"));var d=t.Ah();d.reset();d.rotate(a,b,c);this.transform(d.m11,d.m12,d.m21,d.m22,d.dx,d.dy);t.bf(d)};
Pc.prototype.transform=Pc.prototype.transform=function(a,b,c,d,f,g){var h,k;switch(this.type){case Tc:case Uc:case $c:h=this.tc;k=this.Cc;this.tc=h*a+k*c+f;this.Cc=h*b+k*d+g;h=this.pb;k=this.Bb;this.pb=h*a+k*c+f;this.Bb=h*b+k*d+g;break;case Qc:for(var l=this.Fb,m=l.length,n=0;n<m;n++){var p=l.n[n];h=p.sa;k=p.ta;p.sa=h*a+k*c+f;p.ta=h*b+k*d+g;for(var p=p.Ka,q=p.length,r=0;r<q;r++){var s=p.n[r];switch(s.type){case bd:case kd:h=s.D;k=s.F;s.D=h*a+k*c+f;s.F=h*b+k*d+g;break;case ld:h=s.Gb;k=s.Xb;s.Gb=h*
a+k*c+f;s.Xb=h*b+k*d+g;h=s.ye;k=s.ze;s.ye=h*a+k*c+f;s.ze=h*b+k*d+g;h=s.D;k=s.F;s.D=h*a+k*c+f;s.F=h*b+k*d+g;break;case md:h=s.Gb;k=s.Xb;s.Gb=h*a+k*c+f;s.Xb=h*b+k*d+g;h=s.D;k=s.F;s.D=h*a+k*c+f;s.F=h*b+k*d+g;break;case sd:h=s.Ia;k=s.Ua;s.Ia=h*a+k*c+f;s.Ua=h*b+k*d+g;s.radiusX*=Math.sqrt(a*a+c*c);void 0!==s.radiusY&&(s.radiusY*=Math.sqrt(b*b+d*d));break;case ud:h=s.D;k=s.F;s.D=h*a+k*c+f;s.F=h*b+k*d+g;s.radiusX*=Math.sqrt(a*a+c*c);s.radiusY*=Math.sqrt(b*b+d*d);break;default:t.m("Unknown Segment type: "+
s.type)}}}}this.$a=!0};Pc.prototype.Ss=function(a,b){var c=this.tc,d=this.Cc,f=this.pb,g=this.Bb,h=Math.min(c,f),k=Math.min(d,g),c=Math.abs(f-c),d=Math.abs(g-d),g=t.N();g.x=h;g.y=k;b.Xa(g);f=new Rc(g.x,g.y);g.x=h+c;g.y=k;b.Xa(g);f.Ka.add(new xd(bd,g.x,g.y));g.x=h+c;g.y=k+d;b.Xa(g);f.Ka.add(new xd(bd,g.x,g.y));g.x=h;g.y=k+d;b.Xa(g);f.Ka.add((new xd(bd,g.x,g.y)).close());t.B(g);a.type=Qc;a.Fb.add(f);return a};
Pc.prototype.La=function(a,b,c,d){var f=a.x,g=a.y,h=this.Tb.x-20;a=a.y;for(var k=0,l,m,n,p,q,r,s,u=this.Fb.n,w=u.length,D=0;D<w;D++){var A=u[D];if(A.Cp){if(c&&A.La(f,g,b))return!0;var G=A.Ka;l=A.sa;m=A.ta;for(var M=l,N=m,O=0;O<=G.length;O++){O!==G.length?(n=G.n[O],p=n.type,r=n.D,s=n.F):(p=bd,r=M,s=N);switch(p){case kd:q=yd(f,g,h,a,l,m,M,N);if(!0===q)return!0;k+=q;M=r;N=s;break;case bd:q=yd(f,g,h,a,l,m,r,s);if(!0===q)return!0;k+=q;break;case ld:q=K.et(l,m,n.Gb,n.Xb,n.ye,n.ze,r,s,h,a,f,g,0.5);k+=q;
break;case md:q=K.et(l,m,(l+2*n.Gb)/3,(m+2*n.Xb)/3,(n.Gb+2*r)/3,(n.Gb+2*r)/3,r,s,h,a,f,g,0.5);k+=q;break;case sd:case ud:p=n.type===sd?vd(n,A):wd(n,A,l,m);for(var U=p.length,Y=null,ba=0;ba<U;ba++){Y=p[ba];if(0===ba){q=yd(f,g,h,a,l,m,Y.x1,Y.y1);if(!0===q)return!0;k+=q}q=K.et(Y.x1,Y.y1,Y.x2,Y.y2,Y.ne,Y.oe,Y.$b,Y.ac,h,a,f,g,0.5);k+=q}null!==Y&&(r=Y.$b,s=Y.ac);break;default:t.m("Unknown Segment type: "+n.type)}l=r;m=s}if(0!==k)return!0;k=0}else if(A.La(f,g,d?b:b+2))return!0}return 0!==k};
function yd(a,b,c,d,f,g,h,k){if(K.Sd(f,g,h,k,0.05,a,b))return!0;var l=(a-c)*(g-k);if(0===l)return 0;var m=((a*d-b*c)*(f-h)-(a-c)*(f*k-g*h))/l;b=(a*d-b*c)*(g-k)/l;if(m>=a)return 0;if((f>h?f-h:h-f)<(g>k?g-k:k-g)){if(g<k?(a=g,f=k):(a=k,f=g),b<a||b>f)return 0}else if(f<h?(a=f,f=h):a=h,m<a||m>f)return 0;return 0<l?1:-1}function zd(a,b,c,d){for(var f=a.Fb.length,g=0;g<f;g++)if(a.Fb.n[g].La(b,c,d))return!0;return!1}
Pc.prototype.getPointAlongPath=function(a){(0>a||1<a)&&t.ha(a,"0 <= fraction <= 1",Pc,"getPointAlongPath:fraction");var b=this.Fb.gb(),c=t.Hb(),d=[];d.push([b.sa,b.ta]);for(var f=b.sa,g=b.ta,h=f,k=g,l=b.Ka.n,m=l.length,n=0;n<m;n++){var p=l[n];switch(p.ga){case kd:c.push(d);d=[];d.push([p.D,p.F]);f=p.D;g=p.F;h=f;k=g;break;case bd:d.push([p.D,p.F]);f=p.D;g=p.F;break;case ld:K.Fe(f,g,p.od,p.Ee,p.tg,p.ug,p.pb,p.Bb,0.5,d);f=p.D;g=p.F;break;case md:K.Wp(f,g,p.od,p.Ee,p.pb,p.Bb,0.5,d);f=p.D;g=p.F;break;
case sd:for(var q=vd(p,b),r=q.length,s=0;s<r;s++){var u=q[s];K.Fe(f,g,u.x2,u.y2,u.ne,u.oe,u.$b,u.ac,0.5,d);f=u.$b;g=u.ac}break;case ud:q=wd(p,b,f,g);r=q.length;for(s=0;s<r;s++)u=q[s],K.Fe(f,g,u.x2,u.y2,u.ne,u.oe,u.$b,u.ac,0.5,d),f=u.$b,g=u.ac;break;default:t.m("Segment not of valid type")}p.Sh&&d.push([h,k])}c.push(d);m=0;f=c.length;b=null;for(g=0;g<f;g++)for(h=c[g],k=h.length,n=0;n<k;n++)d=h[n],0!==n&&(l=Math.sqrt(ob(b[0],b[1],d[0],d[1])),m+=l),b=d;a*=m;for(g=m=0;g<f;g++)for(h=c[g],k=h.length,n=
0;n<k;n++){d=h[n];if(0!==n){l=Math.sqrt(ob(b[0],b[1],d[0],d[1]));if(m+l>a)return n=(a-m)/l,t.Ca(c),new E(b[0]+(d[0]-b[0])*n,b[1]+(d[1]-b[1])*n);m+=l}b=d}t.Ca(c);return null};t.g(Pc,"type",Pc.prototype.type);t.defineProperty(Pc,{type:"type"},function(){return this.ga},function(a){this.ga!==a&&(e&&t.Fa(a,Pc,Pc,"type"),t.J(this,a),this.ga=a,this.$a=!0)});t.g(Pc,"startX",Pc.prototype.sa);
t.defineProperty(Pc,{sa:"startX"},function(){return this.tc},function(a){this.tc!==a&&(e&&t.q(a,Pc,"startX"),t.J(this,a),this.tc=a,this.$a=!0)});t.g(Pc,"startY",Pc.prototype.ta);t.defineProperty(Pc,{ta:"startY"},function(){return this.Cc},function(a){this.Cc!==a&&(e&&t.q(a,Pc,"startY"),t.J(this,a),this.Cc=a,this.$a=!0)});t.g(Pc,"endX",Pc.prototype.D);t.defineProperty(Pc,{D:"endX"},function(){return this.pb},function(a){this.pb!==a&&(e&&t.q(a,Pc,"endX"),t.J(this,a),this.pb=a,this.$a=!0)});
t.g(Pc,"endY",Pc.prototype.F);t.defineProperty(Pc,{F:"endY"},function(){return this.Bb},function(a){this.Bb!==a&&(e&&t.q(a,Pc,"endY"),t.J(this,a),this.Bb=a,this.$a=!0)});t.g(Pc,"figures",Pc.prototype.Fb);t.defineProperty(Pc,{Fb:"figures"},function(){return this.Pk},function(a){this.Pk!==a&&(e&&t.l(a,H,Pc,"figures"),t.J(this,a),this.Pk=a,this.$a=!0)});t.defineProperty(Pc,{G:"spot1"},function(){return this.Yi},function(a){e&&t.l(a,L,Pc,"spot1");t.J(this,a);this.Yi=a.ba()});
t.defineProperty(Pc,{H:"spot2"},function(){return this.Zi},function(a){e&&t.l(a,L,Pc,"spot2");t.J(this,a);this.Zi=a.ba()});t.A(Pc,{Tb:"bounds"},function(){this.MA()&&(this.NB(),this.vf());return this.Iu});function Rc(a,b,c){t.Fc(this);void 0===c&&(c=!0);this.gm=c;this.vo=!0;void 0!==a?(e&&t.q(a,Rc,"sx"),this.tc=a):this.tc=0;void 0!==b?(e&&t.q(b,Rc,"sy"),this.Cc=b):this.Cc=0;this.vs=new H(xd);this.Wv=this.vs.Y;this.$a=!0}t.ka("PathFigure",Rc);t.ii(Rc);
Rc.prototype.copy=function(){var a=new Rc;a.gm=this.gm;a.vo=this.vo;a.tc=this.tc;a.Cc=this.Cc;for(var b=this.vs,c=b.length,d=a.vs,f=0;f<c;f++){var g=b.n[f].copy();d.add(g)}a.Wv=this.Wv;a.$a=this.$a;return a};Rc.prototype.equalsApprox=Rc.prototype.yf=function(a){if(!(a instanceof Rc&&K.I(this.sa,a.sa)&&K.I(this.ta,a.ta)))return!1;var b=this.Ka;a=a.Ka;var c=b.length;if(c!==a.length)return!1;for(var d=0;d<c;d++)if(!b.n[d].yf(a.n[d]))return!1;return!0};aa=Rc.prototype;
aa.toString=function(a){for(var b=void 0===a?"M"+this.sa.toString()+" "+this.ta.toString():"M"+this.sa.toFixed(a)+" "+this.ta.toFixed(a),c=this.Ka,d=c.length,f=0;f<d;f++)b+=" "+c.n[f].toString(a);return b};aa.freeze=function(){this.tb=!0;var a=this.Ka;a.freeze();for(var b=a.length,c=0;c<b;c++)a.n[c].freeze();return this};aa.Ra=function(){this.tb=!1;var a=this.Ka;a.Ra();for(var b=a.length,c=0;c<b;c++)a.n[c].Ra();return this};
aa.MA=function(){if(this.$a)return!0;var a=this.Ka;if(this.Wv!==a.Y)return!0;for(var b=a.length,c=0;c<b;c++)if(a.n[c].$a)return!0;return!1};aa.NB=function(){this.$a=!1;var a=this.Ka;this.Wv=a.Y;for(var b=a.length,c=0;c<b;c++){var d=a.n[c];d.$a=!1;d.Bj=null}};t.g(Rc,"isFilled",Rc.prototype.Cp);t.defineProperty(Rc,{Cp:"isFilled"},function(){return this.gm},function(a){e&&t.i(a,"boolean",Rc,"isFilled");t.J(this,a);this.gm=a});t.g(Rc,"isShadowed",Rc.prototype.qi);
t.defineProperty(Rc,{qi:"isShadowed"},function(){return this.vo},function(a){e&&t.i(a,"boolean",Rc,"isShadowed");t.J(this,a);this.vo=a});t.g(Rc,"startX",Rc.prototype.sa);t.defineProperty(Rc,{sa:"startX"},function(){return this.tc},function(a){e&&t.q(a,Rc,"startX");t.J(this,a);this.tc=a;this.$a=!0});t.g(Rc,"startY",Rc.prototype.ta);t.defineProperty(Rc,{ta:"startY"},function(){return this.Cc},function(a){e&&t.q(a,Rc,"startY");t.J(this,a);this.Cc=a;this.$a=!0});t.g(Rc,"segments",Rc.prototype.Ka);
t.defineProperty(Rc,{Ka:"segments"},function(){return this.vs},function(a){e&&t.l(a,H,Rc,"segments");t.J(this,a);this.vs=a;this.$a=!0});
Rc.prototype.La=function(a,b,c){for(var d=this.sa,f=this.ta,g=d,h=f,k=this.Ka.n,l=k.length,m=0;m<l;m++){var n=k[m];switch(n.type){case kd:g=n.D;h=n.F;d=n.D;f=n.F;break;case bd:if(K.Sd(d,f,n.D,n.F,c,a,b))return!0;d=n.D;f=n.F;break;case ld:if(K.uw(d,f,n.Gb,n.Xb,n.ye,n.ze,n.D,n.F,0.5,a,b,c))return!0;d=n.D;f=n.F;break;case md:if(K.gB(d,f,n.Gb,n.Xb,n.D,n.F,0.5,a,b,c))return!0;d=n.D;f=n.F;break;case sd:case ud:for(var p=n.type===sd?vd(n,this):wd(n,this,d,f),q=p.length,r=null,s=0;s<q;s++)if(r=p[s],0===s&&
K.Sd(d,f,r.x1,r.y1,c,a,b)||K.uw(r.x1,r.y1,r.x2,r.y2,r.ne,r.oe,r.$b,r.ac,0.5,a,b,c))return!0;null!==r&&(d=r.$b,f=r.ac);break;default:t.m("Unknown Segment type: "+n.type)}if(n.Ct&&(d!==g||f!==h)&&K.Sd(d,f,g,h,c,a,b))return!0}return!1};
function xd(a,b,c,d,f,g,h,k){t.Fc(this);void 0===a?a=bd:e&&t.Fa(a,xd,xd,"constructor:type");this.ga=a;void 0!==b?(e&&t.q(b,xd,"ex"),this.pb=b):this.pb=0;void 0!==c?(e&&t.q(c,xd,"ey"),this.Bb=c):this.Bb=0;a===ud?(void 0!==g&&(a=g%360,0>a&&(a+=360),this.od=a),void 0!==d&&(e&&t.q(d,xd,"x1"),this.tg=Math.max(d,0)),void 0!==f&&(e&&t.q(f,xd,"y1"),this.ug=Math.max(f,0)),this.Bo=!!h,this.Pn=!!k):(void 0!==d&&(e&&t.q(d,xd,"x1"),this.od=d),void 0!==f&&(e&&t.q(f,xd,"y1"),this.Ee=f),void 0!==g&&(e&&t.q(g,xd,
"x2"),a===sd&&(g=Math.max(g,0)),this.tg=g),void 0!==h&&"number"===typeof h&&(e&&t.q(h,xd,"y2"),a===sd&&(h=Math.max(h,0)),this.ug=h));this.Sh=!1;this.$a=!0;this.Bj=null}t.ka("PathSegment",xd);t.ii(xd);
xd.prototype.copy=function(){var a=new xd;a.ga=this.ga;a.pb=this.pb;a.Bb=this.Bb;void 0!==this.od&&(a.od=this.od);void 0!==this.Ee&&(a.Ee=this.Ee);void 0!==this.tg&&(a.tg=this.tg);void 0!==this.ug&&(a.ug=this.ug);void 0!==this.Bo&&(a.Bo=this.Bo);void 0!==this.Pn&&(a.Pn=this.Pn);a.Sh=this.Sh;a.$a=this.$a;return a};
xd.prototype.equalsApprox=xd.prototype.yf=function(a){if(!(a instanceof xd)||this.type!==a.type||this.Ct!==a.Ct)return!1;switch(this.type){case kd:case bd:return K.I(this.D,a.D)&&K.I(this.F,a.F);case ld:return K.I(this.D,a.D)&&K.I(this.F,a.F)&&K.I(this.Gb,a.Gb)&&K.I(this.Xb,a.Xb)&&K.I(this.ye,a.ye)&&K.I(this.ze,a.ze);case md:return K.I(this.D,a.D)&&K.I(this.F,a.F)&&K.I(this.Gb,a.Gb)&&K.I(this.Xb,a.Xb);case sd:return K.I(this.yh,a.yh)&&K.I(this.vi,a.vi)&&K.I(this.Ia,a.Ia)&&K.I(this.Ua,a.Ua)&&K.I(this.radiusX,
a.radiusX)&&K.I(this.radiusY,a.radiusY);case ud:return this.ex===a.ex&&this.ix===a.ix&&K.I(this.Rx,a.Rx)&&K.I(this.D,a.D)&&K.I(this.F,a.F)&&K.I(this.radiusX,a.radiusX)&&K.I(this.radiusY,a.radiusY);default:return!1}};
xd.prototype.toString=function(a){switch(this.type){case kd:a=void 0===a?"M"+this.D.toString()+" "+this.F.toString():"M"+this.D.toFixed(a)+" "+this.F.toFixed(a);break;case bd:a=void 0===a?"L"+this.D.toString()+" "+this.F.toString():"L"+this.D.toFixed(a)+" "+this.F.toFixed(a);break;case ld:a=void 0===a?"C"+this.Gb.toString()+" "+this.Xb.toString()+" "+this.ye.toString()+" "+this.ze.toString()+" "+this.D.toString()+" "+this.F.toString():"C"+this.Gb.toFixed(a)+" "+this.Xb.toFixed(a)+" "+this.ye.toFixed(a)+
" "+this.ze.toFixed(a)+" "+this.D.toFixed(a)+" "+this.F.toFixed(a);break;case md:a=void 0===a?"Q"+this.Gb.toString()+" "+this.Xb.toString()+" "+this.D.toString()+" "+this.F.toString():"Q"+this.Gb.toFixed(a)+" "+this.Xb.toFixed(a)+" "+this.D.toFixed(a)+" "+this.F.toFixed(a);break;case sd:a=void 0===a?"B"+this.yh.toString()+" "+this.vi.toString()+" "+this.Ia.toString()+" "+this.Ua.toString()+" "+this.radiusX:"B"+this.yh.toFixed(a)+" "+this.vi.toFixed(a)+" "+this.Ia.toFixed(a)+" "+this.Ua.toFixed(a)+
" "+this.radiusX;break;case ud:a=void 0===a?"A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.Rx.toString()+" "+(this.ix?1:0)+" "+(this.ex?1:0)+" "+this.D.toString()+" "+this.F.toString():"A"+this.radiusX.toFixed(a)+" "+this.radiusY.toFixed(a)+" "+this.Rx.toFixed(a)+" "+(this.ix?1:0)+" "+(this.ex?1:0)+" "+this.D.toFixed(a)+" "+this.F.toFixed(a);break;default:a=this.type.toString()}return a+(this.Sh?"z":"")};var kd;xd.Move=kd=t.w(xd,"Move",0);var bd;xd.Line=bd=t.w(xd,"Line",1);var ld;
xd.Bezier=ld=t.w(xd,"Bezier",2);var md;xd.QuadraticBezier=md=t.w(xd,"QuadraticBezier",3);var sd;xd.Arc=sd=t.w(xd,"Arc",4);var ud;xd.SvgArc=ud=t.w(xd,"SvgArc",4);xd.prototype.freeze=function(){this.tb=!0;return this};xd.prototype.Ra=function(){this.tb=!1;return this};xd.prototype.close=xd.prototype.close=function(){this.Sh=!0;return this};
function vd(a,b){if(null!==a.Bj&&!1===b.$a)return a.Bj;var c=a.radiusX,d=a.radiusY;void 0===d&&(d=c);var f=a.od,g=a.Ee,h=K.FE(0,0,c<d?c:d,a.yh,a.yh+a.vi);if(c!==d){var k=t.Ah();k.reset();c<d?k.scale(1,d/c):k.scale(c/d,1);for(var c=h.length,d=t.N(),l=0;l<c;l++){var m=h[l];d.x=m.x1;d.y=m.y1;k.Xa(d);m.x1=d.x;m.y1=d.y;d.x=m.x2;d.y=m.y2;k.Xa(d);m.x2=d.x;m.y2=d.y;d.x=m.ne;d.y=m.oe;k.Xa(d);m.ne=d.x;m.oe=d.y;d.x=m.$b;d.y=m.ac;k.Xa(d);m.$b=d.x;m.ac=d.y}t.B(d);t.bf(k)}k=h.length;for(c=0;c<k;c++)d=h[c],d.x1+=
f,d.y1+=g,d.x2+=f,d.y2+=g,d.ne+=f,d.oe+=g,d.$b+=f,d.ac+=g;a.Bj=h;return a.Bj}
function wd(a,b,c,d){function f(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(g(a,b))}function g(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))*Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)))}if(null!==a.Bj&&!1===b.$a)return a.Bj;b=a.tg;var h=a.ug,k=Math.PI/180*a.od,l=a.Bo,m=a.Pn,n=a.pb,p=a.Bb,q=Math.cos(k)*(c-n)/2+Math.sin(k)*(d-p)/2,r=-Math.sin(k)*(c-n)/2+Math.cos(k)*(d-p)/2,s=Math.pow(q,2)/Math.pow(b,2)+Math.pow(r,2)/Math.pow(h,2);1<s&&(b*=Math.sqrt(s),h*=Math.sqrt(s));
s=(l===m?-1:1)*Math.sqrt((Math.pow(b,2)*Math.pow(h,2)-Math.pow(b,2)*Math.pow(r,2)-Math.pow(h,2)*Math.pow(q,2))/(Math.pow(b,2)*Math.pow(r,2)+Math.pow(h,2)*Math.pow(q,2)));isNaN(s)&&(s=0);l=s*b*r/h;s=s*-h*q/b;isNaN(l)&&(l=0);isNaN(s)&&(s=0);c=(c+n)/2+Math.cos(k)*l-Math.sin(k)*s;d=(d+p)/2+Math.sin(k)*l+Math.cos(k)*s;k=f([1,0],[(q-l)/b,(r-s)/h]);p=[(q-l)/b,(r-s)/h];r=[(-q-l)/b,(-r-s)/h];q=f(p,r);-1>=g(p,r)&&(q=Math.PI);1<=g(p,r)&&(q=0);!m&&0<q&&(q-=2*Math.PI);m&&0>q&&(q+=2*Math.PI);m=b>h?1:b/h;r=b>h?
h/b:1;b=K.FE(0,0,b>h?b:h,k,k+q,!0);h=t.Ah();h.reset();h.translate(c,d);h.rotate(a.od,0,0);h.scale(m,r);id(b,h);t.bf(h);a.Bj=b;return a.Bj}t.g(xd,"isClosed",xd.prototype.Ct);t.defineProperty(xd,{Ct:"isClosed"},function(){return this.Sh},function(a){this.Sh!==a&&(this.Sh=a,this.$a=!0)});t.g(xd,"type",xd.prototype.type);t.defineProperty(xd,{type:"type"},function(){return this.ga},function(a){e&&t.Fa(a,xd,xd,"type");t.J(this,a);this.ga=a;this.$a=!0});t.g(xd,"endX",xd.prototype.D);
t.defineProperty(xd,{D:"endX"},function(){return this.pb},function(a){e&&t.q(a,xd,"endX");t.J(this,a);this.pb=a;this.$a=!0});t.g(xd,"endY",xd.prototype.F);t.defineProperty(xd,{F:"endY"},function(){return this.Bb},function(a){e&&t.q(a,xd,"endY");t.J(this,a);this.Bb=a;this.$a=!0});t.defineProperty(xd,{Gb:"point1X"},function(){return this.od},function(a){e&&t.q(a,xd,"point1X");t.J(this,a);this.od=a;this.$a=!0});
t.defineProperty(xd,{Xb:"point1Y"},function(){return this.Ee},function(a){e&&t.q(a,xd,"point1Y");t.J(this,a);this.Ee=a;this.$a=!0});t.defineProperty(xd,{ye:"point2X"},function(){return this.tg},function(a){e&&t.q(a,xd,"point2X");t.J(this,a);this.tg=a;this.$a=!0});t.defineProperty(xd,{ze:"point2Y"},function(){return this.ug},function(a){e&&t.q(a,xd,"point2Y");t.J(this,a);this.ug=a;this.$a=!0});
t.defineProperty(xd,{Ia:"centerX"},function(){return this.od},function(a){e&&t.q(a,xd,"centerX");t.J(this,a);this.od=a;this.$a=!0});t.defineProperty(xd,{Ua:"centerY"},function(){return this.Ee},function(a){e&&t.q(a,xd,"centerY");t.J(this,a);this.Ee=a;this.$a=!0});t.defineProperty(xd,{radiusX:"radiusX"},function(){return this.tg},function(a){e&&t.q(a,xd,"radiusX");0>a&&t.ha(a,">= zero",xd,"radiusX");t.J(this,a);this.tg=a;this.$a=!0});
t.defineProperty(xd,{radiusY:"radiusY"},function(){return this.ug},function(a){e&&t.q(a,xd,"radiusY");0>a&&t.ha(a,">= zero",xd,"radiusY");t.J(this,a);this.ug=a;this.$a=!0});t.defineProperty(xd,{yh:"startAngle"},function(){return this.pb},function(a){this.pb!==a&&(t.J(this,a),e&&t.q(a,xd,"startAngle"),a%=360,0>a&&(a+=360),this.pb=a,this.$a=!0)});
t.defineProperty(xd,{vi:"sweepAngle"},function(){return this.Bb},function(a){e&&t.q(a,xd,"sweepAngle");t.J(this,a);360<a&&(a=360);-360>a&&(a=-360);this.Bb=a;this.$a=!0});t.defineProperty(xd,{ex:"isClockwiseArc"},function(){return this.Pn},function(a){t.J(this,a);this.Pn=a;this.$a=!0});t.defineProperty(xd,{ix:"isLargeArc"},function(){return this.Bo},function(a){t.J(this,a);this.Bo=a;this.$a=!0});
t.defineProperty(xd,{Rx:"xAxisRotation"},function(){return this.od},function(a){e&&t.q(a,xd,"xAxisRotation");a%=360;0>a&&(a+=360);t.J(this,a);this.od=a;this.$a=!0});function Ad(){this.W=null;this.Pz=(new E(0,0)).freeze();this.Wy=(new E(0,0)).freeze();this.Fu=this.yv=0;this.mv="";this.iw=this.Uu=!1;this.Ru=this.Hu=0;this.Cj=this.bv=!1;this.$q=null;this.gw=0;this.vg=this.ew=null}t.ka("InputEvent",Ad);
Ad.prototype.copy=function(){var a=new Ad;a.W=this.W;a.Pz.assign(this.Wd);a.Wy.assign(this.da);a.yv=this.yv;a.Fu=this.Fu;a.mv=this.mv;a.Uu=this.Uu;a.iw=this.iw;a.Hu=this.Hu;a.Ru=this.Ru;a.bv=this.bv;a.Cj=this.Cj;a.$q=this.$q;a.gw=this.gw;a.ew=this.ew;a.vg=this.vg;return a};
Ad.prototype.toString=function(){var a="^";this.dd&&(a+="M:"+this.dd);this.button&&(a+="B:"+this.button);this.key&&(a+="K:"+this.key);this.Ge&&(a+="C:"+this.Ge);this.mk&&(a+="D:"+this.mk);this.Ke&&(a+="h");this.bubbles&&(a+="b");null!==this.da&&(a+="@"+this.da.toString());return a};t.g(Ad,"diagram",Ad.prototype.h);t.defineProperty(Ad,{h:"diagram"},function(){return this.W},function(a){this.W=a});t.g(Ad,"viewPoint",Ad.prototype.Wd);
t.defineProperty(Ad,{Wd:"viewPoint"},function(){return this.Pz},function(a){t.l(a,E,Ad,"viewPoint");this.Pz.assign(a)});t.g(Ad,"documentPoint",Ad.prototype.da);t.defineProperty(Ad,{da:"documentPoint"},function(){return this.Wy},function(a){t.l(a,E,Ad,"documentPoint");this.Wy.assign(a)});t.g(Ad,"modifiers",Ad.prototype.dd);t.defineProperty(Ad,{dd:"modifiers"},function(){return this.yv},function(a){this.yv=a});t.g(Ad,"button",Ad.prototype.button);
t.defineProperty(Ad,{button:"button"},function(){return this.Fu},function(a){this.Fu=a});t.g(Ad,"key",Ad.prototype.key);t.defineProperty(Ad,{key:"key"},function(){return this.mv},function(a){this.mv=a});t.g(Ad,"down",Ad.prototype.ok);t.defineProperty(Ad,{ok:"down"},function(){return this.Uu},function(a){this.Uu=a});t.g(Ad,"up",Ad.prototype.zj);t.defineProperty(Ad,{zj:"up"},function(){return this.iw},function(a){this.iw=a});t.g(Ad,"clickCount",Ad.prototype.Ge);
t.defineProperty(Ad,{Ge:"clickCount"},function(){return this.Hu},function(a){this.Hu=a});t.g(Ad,"delta",Ad.prototype.mk);t.defineProperty(Ad,{mk:"delta"},function(){return this.Ru},function(a){this.Ru=a});t.g(Ad,"handled",Ad.prototype.Ke);t.defineProperty(Ad,{Ke:"handled"},function(){return this.bv},function(a){this.bv=a});t.g(Ad,"bubbles",Ad.prototype.bubbles);t.defineProperty(Ad,{bubbles:"bubbles"},function(){return this.Cj},function(a){this.Cj=a});t.g(Ad,"event",Ad.prototype.event);
t.defineProperty(Ad,{event:"event"},function(){return this.$q},function(a){this.$q=a});t.A(Ad,{lx:"isTouchEvent"},function(){var a=window.TouchEvent;return a&&this.event instanceof a});t.g(Ad,"timestamp",Ad.prototype.timestamp);t.defineProperty(Ad,{timestamp:"timestamp"},function(){return this.gw},function(a){this.gw=a});t.g(Ad,"targetDiagram",Ad.prototype.zh);t.defineProperty(Ad,{zh:"targetDiagram"},function(){return this.ew},function(a){this.ew=a});t.g(Ad,"targetObject",Ad.prototype.ke);
t.defineProperty(Ad,{ke:"targetObject"},function(){return this.vg},function(a){this.vg=a});t.g(Ad,"control",Ad.prototype.control);t.defineProperty(Ad,{control:"control"},function(){return 0!==(this.dd&1)},function(a){this.dd=a?this.dd|1:this.dd&-2});t.g(Ad,"shift",Ad.prototype.shift);t.defineProperty(Ad,{shift:"shift"},function(){return 0!==(this.dd&4)},function(a){this.dd=a?this.dd|4:this.dd&-5});t.g(Ad,"alt",Ad.prototype.alt);
t.defineProperty(Ad,{alt:"alt"},function(){return 0!==(this.dd&2)},function(a){this.dd=a?this.dd|2:this.dd&-3});t.g(Ad,"meta",Ad.prototype.Op);t.defineProperty(Ad,{Op:"meta"},function(){return 0!==(this.dd&8)},function(a){this.dd=a?this.dd|8:this.dd&-9});t.g(Ad,"left",Ad.prototype.left);t.defineProperty(Ad,{left:"left"},function(){return 0===this.button},function(a){this.button=a?0:2});t.g(Ad,"middle",Ad.prototype.MJ);
t.defineProperty(Ad,{MJ:"middle"},function(){return 1===this.button},function(a){this.button=a?1:0});t.g(Ad,"right",Ad.prototype.right);t.defineProperty(Ad,{right:"right"},function(){return 2===this.button},function(a){this.button=a?2:0});function Bd(){this.W=null;this.ec="";this.Mv=this.bw=null;this.Gu=!1}t.ka("DiagramEvent",Bd);Bd.prototype.copy=function(){var a=new Bd;a.W=this.W;a.ec=this.ec;a.bw=this.bw;a.Mv=this.Mv;a.Gu=this.Gu;return a};
Bd.prototype.toString=function(){var a="*"+this.name;this.cancel&&(a+="x");null!==this.Nx&&(a+=":"+this.Nx.toString());null!==this.yx&&(a+="("+this.yx.toString()+")");return a};t.g(Bd,"diagram",Bd.prototype.h);t.defineProperty(Bd,{h:"diagram"},function(){return this.W},function(a){this.W=a});t.g(Bd,"name",Bd.prototype.name);t.defineProperty(Bd,{name:"name"},function(){return this.ec},function(a){this.ec=a});t.g(Bd,"subject",Bd.prototype.Nx);
t.defineProperty(Bd,{Nx:"subject"},function(){return this.bw},function(a){this.bw=a});t.g(Bd,"parameter",Bd.prototype.yx);t.defineProperty(Bd,{yx:"parameter"},function(){return this.Mv},function(a){this.Mv=a});t.g(Bd,"cancel",Bd.prototype.cancel);t.defineProperty(Bd,{cancel:"cancel"},function(){return this.Gu},function(a){this.Gu=a});function Cd(){this.clear()}t.ka("ChangedEvent",Cd);var Kd;Cd.Transaction=Kd=t.w(Cd,"Transaction",-1);var Ld;Cd.Property=Ld=t.w(Cd,"Property",0);var Md;
Cd.Insert=Md=t.w(Cd,"Insert",1);var Nd;Cd.Remove=Nd=t.w(Cd,"Remove",2);Cd.prototype.clear=Cd.prototype.clear=function(){this.Gq=Ld;this.Am=this.xv="";this.Bv=this.Cv=this.Iv=this.Jo=this.Hv=this.W=this.pe=null};
Cd.prototype.copy=function(){var a=new Cd;a.pe=this.pe;a.W=this.W;a.Gq=this.Gq;a.xv=this.xv;a.Am=this.Am;a.Hv=this.Hv;var b=this.Jo;a.Jo=t.xb(b)&&"function"===typeof b.ba?b.ba():b;b=this.Iv;a.Iv=t.xb(b)&&"function"===typeof b.ba?b.ba():b;b=this.Cv;a.Cv=t.xb(b)&&"function"===typeof b.ba?b.ba():b;b=this.Bv;a.Bv=t.xb(b)&&"function"===typeof b.ba?b.ba():b;return a};
Cd.prototype.toString=function(){var a="",a=this.Bd===Kd?a+"* ":this.Bd===Ld?a+(null!==this.ea?"!m":"!d"):a+((null!==this.ea?"!m":"!d")+this.Bd);this.propertyName&&"string"===typeof this.propertyName&&(a+=" "+this.propertyName);this.Ff&&this.Ff!==this.propertyName&&(a+=" "+this.Ff);a+=": ";this.Bd===Kd?null!==this.oldValue&&(a+=" "+this.oldValue):(null!==this.object&&(a+=na(this.object)),null!==this.oldValue&&(a+="  old: "+na(this.oldValue)),null!==this.ag&&(a+=" "+this.ag),null!==this.newValue&&
(a+="  new: "+na(this.newValue)),null!==this.Zf&&(a+=" "+this.Zf));return a};Cd.prototype.getValue=Cd.prototype.Da=function(a){return a?this.oldValue:this.newValue};Cd.prototype.getParam=function(a){return a?this.ag:this.Zf};Cd.prototype.canUndo=Cd.prototype.canUndo=function(){return null!==this.ea||null!==this.h?!0:!1};Cd.prototype.undo=Cd.prototype.undo=function(){this.canUndo()&&(null!==this.ea?this.ea.changeState(this,!0):null!==this.h&&this.h.changeState(this,!0))};
Cd.prototype.canRedo=Cd.prototype.canRedo=function(){return null!==this.ea||null!==this.h?!0:!1};Cd.prototype.redo=Cd.prototype.redo=function(){this.canRedo()&&(null!==this.ea?this.ea.changeState(this,!1):null!==this.h&&this.h.changeState(this,!1))};t.g(Cd,"model",Cd.prototype.ea);t.defineProperty(Cd,{ea:"model"},function(){return this.pe},function(a){this.pe=a});t.g(Cd,"diagram",Cd.prototype.h);t.defineProperty(Cd,{h:"diagram"},function(){return this.W},function(a){this.W=a});t.g(Cd,"change",Cd.prototype.Bd);
t.defineProperty(Cd,{Bd:"change"},function(){return this.Gq},function(a){e&&t.Fa(a,Cd,Cd,"change");this.Gq=a});t.g(Cd,"modelChange",Cd.prototype.Ff);t.defineProperty(Cd,{Ff:"modelChange"},function(){return this.xv},function(a){e&&t.i(a,"string",Cd,"modelChange");this.xv=a});t.g(Cd,"propertyName",Cd.prototype.propertyName);t.defineProperty(Cd,{propertyName:"propertyName"},function(){return this.Am},function(a){e&&"string"!==typeof a&&t.l(a,Function,Cd,"propertyName");this.Am=a});
t.g(Cd,"isTransactionFinished",Cd.prototype.xJ);t.A(Cd,{xJ:"isTransactionFinished"},function(){return this.Gq===Kd&&("CommittedTransaction"===this.Am||"FinishedUndo"===this.Am||"FinishedRedo"===this.Am)});t.g(Cd,"object",Cd.prototype.object);t.defineProperty(Cd,{object:"object"},function(){return this.Hv},function(a){this.Hv=a});t.g(Cd,"oldValue",Cd.prototype.oldValue);t.defineProperty(Cd,{oldValue:"oldValue"},function(){return this.Jo},function(a){this.Jo=a});t.g(Cd,"oldParam",Cd.prototype.ag);
t.defineProperty(Cd,{ag:"oldParam"},function(){return this.Iv},function(a){this.Iv=a});t.g(Cd,"newValue",Cd.prototype.newValue);t.defineProperty(Cd,{newValue:"newValue"},function(){return this.Cv},function(a){this.Cv=a});t.g(Cd,"newParam",Cd.prototype.Zf);t.defineProperty(Cd,{Zf:"newParam"},function(){return this.Bv},function(a){this.Bv=a});
function J(a){1<arguments.length&&t.m("Model constructor can only take one optional argument, the Array of node data.");t.Fc(this);this.Qy=this.ec="";this.Wk=this.XC=!1;this.uz={};this.Se=[];this.Gc=new wa(null,Object);this.vm="key";this.Lu=this.qv=null;this.Iy=this.Jy=!1;this.Wr="category";this.hg=new wa(null,I);this.Pj=null;this.Xi=!1;this.Oz=null;this.ma=new Od;void 0!==a&&(this.Ng=a)}t.ka("Model",J);
J.prototype.clear=J.prototype.clear=function(){this.ge&&t.on(this.Se,"nodeDataArray",this,!0);this.Se=[];this.Gc.clear();this.hg.clear();this.ma.clear()};aa=J.prototype;
aa.ou=function(){var a="";""!==this.name&&(a+=',\n  "name": '+this.quote(this.name));""!==this.bn&&(a+=',\n  "dataFormat": '+this.quote(this.bn));this.hb&&(a+=',\n  "isReadOnly": '+this.hb);"key"!==this.uj&&"string"===typeof this.uj&&(a+=',\n  "nodeKeyProperty": '+this.quote(this.uj));this.Fw&&(a+=',\n  "copiesArrays": true');this.Ew&&(a+=',\n  "copiesArrayObjects": true');"category"!==this.El&&"string"===typeof this.El&&(a+=',\n  "nodeCategoryProperty": '+this.quote(this.El));return a};
aa.QB=function(){var a="",b=this.SA,c=!1,d;for(d in b)if(!Zd(d,b[d])){c=!0;break}c&&(a=',\n  "modelData": '+$d(this,b));return a+',\n  "nodeDataArray": '+ae(this,this.Ng,!0)};aa.Xt=function(a){a.name&&(this.name=a.name);a.dataFormat&&(this.bn=a.dataFormat);a.isReadOnly&&(this.hb=a.isReadOnly);a.nodeKeyProperty&&(this.uj=a.nodeKeyProperty);a.copiesArrays&&(this.Fw=a.copiesArrays);a.copiesArrayObjects&&(this.Ew=a.copiesArrayObjects);a.nodeCategoryProperty&&(this.El=a.nodeCategoryProperty)};
aa.hB=function(a){var b=a.modelData;b&&(be(this,b),this.SA=b);if(a=a.nodeDataArray)be(this,a),this.Ng=a};aa.toString=function(a){void 0===a&&(a=0);if(1<a)return this.FB();var b=(""!==this.name?this.name:"")+" Model";if(0<a){b+="\n node data:";a=this.Ng;var c=t.ub(a),d;for(d=0;d<c;d++)var f=t.rb(a,d),b=b+(" "+this.Lb(f)+":"+na(f))}return b};
J.prototype.toJson=J.prototype.toJSON=J.prototype.FB=function(a){void 0===a&&(a=this.constructor===J?"go.Model":this.constructor===T?"go.GraphLinksModel":this.constructor===ce?"go.TreeModel":t.Dg(this));return'{ "class": '+this.quote(a)+this.ou()+this.QB()+"}"};
J.fromJson=J.fromJSON=function(a,b){void 0===b&&(b=null);b&&t.l(b,J,J,"fromJson:model");var c=null;if("string"===typeof a)if(window&&window.JSON&&window.JSON.parse)try{c=window.JSON.parse(a)}catch(d){e&&t.trace("JSON.parse error: "+d.toString())}else t.trace("WARNING: no JSON.parse available");else"object"===typeof a?c=a:t.m("Unable to construct a Model from: "+a);if(null===b){var f;f=null;var g=c["class"];if("string"===typeof g)try{var h=null;0===g.indexOf("go.")?(g=g.substr(3),h=ca[g]):(h=ca[g])||
(h=window[g]);"function"===typeof h&&(f=new h)}catch(k){}null===f||f instanceof J?b=f:t.m("Unable to construct a Model of declared class: "+c["class"])}null===b&&(b=new T);b.Xt(c);b.hB(c);return b};
function be(a,b){if(t.isArray(b))for(var c=t.ub(b),d=0;d<c;d++){var f=t.rb(b,d);t.xb(f)&&t.kE(b,d,be(a,f))}else if(t.xb(b)){for(d in b)if(f=b[d],t.xb(f)&&(f=be(a,f),b[d]=f,"points"===d&&Array.isArray(f))){for(var g=0===f.length%2,h=0;h<f.length;h++)if("number"!==typeof f[h]){g=!1;break}if(g){g=new H(E);for(h=0;h<f.length/2;h++){var k=new E(f[2*h],f[2*h+1]);g.add(k)}g.freeze();b[d]=g}}if("object"!==typeof b)c=b;else{d=b;f=b["class"];if("NaN"===f)d=NaN;else if("Date"===f)d=new Date(b.value);else if("go.Point"===
f)d=new E(de(b.x),de(b.y));else if("go.Size"===f)d=new ra(de(b.width),de(b.height));else if("go.Rect"===f)d=new F(de(b.x),de(b.y),de(b.width),de(b.height));else if("go.Margin"===f)d=new wb(de(b.top),de(b.right),de(b.bottom),de(b.left));else if("go.Spot"===f)d="string"===typeof b["enum"]?Pb(b["enum"]):new L(de(b.x),de(b.y),de(b.offsetX),de(b.offsetY));else if("go.Brush"===f){if(d=new qa,d.type=t.en(qa,b.type),b.start instanceof L&&(d.start=b.start),b.end instanceof L&&(d.end=b.end),"number"===typeof b.startRadius&&
(d.hq=de(b.startRadius)),"number"===typeof b.endRadius&&(d.mp=de(b.endRadius)),f=b.colorStops)for(c in f)d.addColorStop(parseFloat(c),f[c])}else"go.Geometry"===f&&(d="string"===typeof b.path?ed(b.path):new Pc,d.type=t.en(Pc,b.type),"number"===typeof b.startX&&(d.sa=de(b.startX)),"number"===typeof b.startY&&(d.ta=de(b.startY)),"number"===typeof b.endX&&(d.D=de(b.endX)),"number"===typeof b.endY&&(d.F=de(b.endY)),b.spot1 instanceof L&&(d.G=b.spot1),b.spot2 instanceof L&&(d.H=b.spot2));c=d}return c}return b}
J.prototype.quote=function(a){for(var b="",c=a.length,d=0;d<c;d++)var f=a[d],b='"'===f||"\\"===f?b+("\\"+f):"\b"===f?b+"\\b":"\f"===f?b+"\\f":"\n"===f?b+"\\n":"\r"===f?b+"\\r":"\t"===f?b+"\\t":b+f;return'"'+b+'"'};
J.prototype.writeJsonValue=J.prototype.pu=function(a){return void 0===a?"undefined":null===a?"null":!0===a?"true":!1===a?"false":"string"===typeof a?this.quote(a):"number"===typeof a?Infinity===a?"9e9999":-Infinity===a?"-9e9999":isNaN(a)?'{"class":"NaN"}':a.toString():a instanceof Date?'{"class":"Date", "value":"'+a.toJSON()+'"}':a instanceof Number?this.pu(a.valueOf()):t.isArray(a)?ae(this,a):t.xb(a)?$d(this,a):"function"===typeof a?"null":a.toString()};
function ae(a,b,c){var d=t.ub(b),f="[ ";c&&1<d&&(f+="\n");for(var g=0;g<d;g++){var h=t.rb(b,g);void 0!==h&&(0<g&&(f+=",",c&&(f+="\n")),f+=a.pu(h))}c&&1<d&&(f+="\n");return f+" ]"}function Zd(a,b){return void 0===b||"__gohashid"===a||"_"===a[0]||"function"===typeof b?!0:!1}function oe(a){return isNaN(a)?"NaN":Infinity===a?"9e9999":-Infinity===a?"-9e9999":a}
function $d(a,b){var c=b;if(c instanceof E)b={"class":"go.Point",x:oe(c.x),y:oe(c.y)};else if(c instanceof ra)b={"class":"go.Size",width:oe(c.width),height:oe(c.height)};else if(c instanceof F)b={"class":"go.Rect",x:oe(c.x),y:oe(c.y),width:oe(c.width),height:oe(c.height)};else if(c instanceof wb)b={"class":"go.Margin",top:oe(c.top),right:oe(c.right),bottom:oe(c.bottom),left:oe(c.left)};else if(c instanceof L)b=c.Cd()?{"class":"go.Spot",x:oe(c.x),y:oe(c.y),offsetX:oe(c.offsetX),offsetY:oe(c.offsetY)}:
{"class":"go.Spot","enum":c.toString()};else if(c instanceof qa){b={"class":"go.Brush",type:c.type.name};if(c.type===pe)b.color=c.color;else if(c.type===qe||c.type===re)b.start=c.start,b.end=c.end,c.type===re&&(0!==c.hq&&(b.startRadius=oe(c.hq)),isNaN(c.mp)||(b.endRadius=oe(c.mp)));if(null!==c.hp){for(var d={},c=c.hp.k;c.next();)d[c.key.toString()]=c.value;b.colorStops=d}}else if(c instanceof Pc)b={"class":"go.Geometry",type:c.type.name},0!==c.sa&&(b.startX=oe(c.sa)),0!==c.ta&&(b.startY=oe(c.ta)),
0!==c.D&&(b.endX=oe(c.D)),0!==c.F&&(b.endY=oe(c.F)),c.G.O(Vb)||(b.spot1=c.G),c.H.O(bc)||(b.spot2=c.H),c.type===Qc&&(b.path=cd(c));else if(c instanceof V||c instanceof v||c instanceof se||c instanceof J||c instanceof ze||c instanceof Ba||c instanceof Ae||c instanceof Ea||c instanceof Od||c instanceof Be)return t.trace("ERROR: trying to convert a GraphObject or Diagram or Model or Tool or Layout or UndoManager into JSON text: "+c.toString()),"{}";var d="{",f=!0,g;for(g in b)if(c=t.nb(b,g),!Zd(g,c))if(f?
f=!1:d+=", ",d+='"'+g+'":',"points"===g&&c instanceof H&&c.ga===E){for(var h="[",c=c.k;c.next();){var k=c.value;1<h.length&&(h+=",");h+=a.pu(k.x);h+=",";h+=a.pu(k.y)}h+="]";d+=h}else d+=a.pu(c);return d+"}"}function de(a){return"number"===typeof a?a:"NaN"===a?NaN:"9e9999"===a?Infinity:"-9e9999"===a?-Infinity:parseFloat(a)}t.g(J,"name",J.prototype.name);t.defineProperty(J,{name:"name"},function(){return this.ec},function(a){var b=this.ec;b!==a&&(t.i(a,"string",J,"name"),this.ec=a,this.j("name",b,a))});
t.g(J,"dataFormat",J.prototype.bn);t.defineProperty(J,{bn:"dataFormat"},function(){return this.Qy},function(a){var b=this.Qy;b!==a&&(t.i(a,"string",J,"dataFormat"),this.Qy=a,this.j("dataFormat",b,a))});t.g(J,"knockoutJS",J.prototype.ge);t.defineProperty(J,{ge:"knockoutJS"},function(){return this.XC},function(a){this.XC=a;t.Ec||(t.Ec="object"===typeof window.ko&&"function"===typeof window.ko.isObservable?window.ko.isObservable:null,a&&null===t.Ec&&t.trace("No value for ko.isObservable: is KnockoutJS library not loaded?"))});
t.g(J,"isReadOnly",J.prototype.hb);t.defineProperty(J,{hb:"isReadOnly"},function(){return this.Wk},function(a){var b=this.Wk;b!==a&&(t.i(a,"boolean",J,"isReadOnly"),this.Wk=a,this.j("isReadOnly",b,a))});t.g(J,"modelData",J.prototype.SA);t.defineProperty(J,{SA:"modelData"},function(){return this.uz},function(a){var b=this.uz;b!==a&&(t.i(a,"object",J,"modelData"),this.uz=a,this.j("modelData",b,a))});
J.prototype.addChangedListener=J.prototype.Wz=function(a){t.i(a,"function",J,"addChangedListener:listener");null===this.Pj&&(this.Pj=new H("function"));this.Pj.add(a)};J.prototype.removeChangedListener=J.prototype.kB=function(a){t.i(a,"function",J,"removeChangedListener:listener");null!==this.Pj&&(this.Pj.remove(a),0===this.Pj.count&&(this.Pj=null))};
J.prototype.vw=function(a){this.ab||this.ma.oF(a);if(null!==this.Pj){var b=this.Pj,c=b.length;if(1===c)b=b.wa(0),b(a);else if(0!==c)for(var d=b.Pe(),f=0;f<c;f++)b=d[f],b(a)}};J.prototype.raiseChangedEvent=J.prototype.ed=function(a,b,c,d,f,g,h){Ce(this,"",a,b,c,d,f,g,h)};J.prototype.raiseChanged=J.prototype.j=function(a,b,c,d,f){Ce(this,"",Ld,a,this,b,c,d,f)};J.prototype.raiseDataChanged=J.prototype.Ax=function(a,b,c,d,f,g){Ce(this,"",Ld,b,a,c,d,f,g)};
function Ce(a,b,c,d,f,g,h,k,l){void 0===k&&(k=null);void 0===l&&(l=null);var m=new Cd;m.ea=a;m.Bd=c;m.Ff=b;m.propertyName=d;m.object=f;m.oldValue=g;m.ag=k;m.newValue=h;m.Zf=l;a.vw(m)}t.g(J,"undoManager",J.prototype.ma);t.defineProperty(J,{ma:"undoManager"},function(){return this.Oz},function(a){var b=this.Oz;b!==a&&(t.l(a,Od,J,"undoManager"),null!==b&&b.fK(this),this.Oz=a,null!==a&&a.VH(this))});t.g(J,"skipsUndoManager",J.prototype.ab);
t.defineProperty(J,{ab:"skipsUndoManager"},function(){return this.Xi},function(a){t.i(a,"boolean",J,"skipsUndoManager");this.Xi=a});
J.prototype.changeState=function(a,b){if(null!==a&&a.ea===this)if(a.Bd===Ld){var c=a.object,d=a.propertyName,f=a.Da(b);t.Va(c,d,f)}else a.Bd===Md?"nodeDataArray"===a.Ff?(c=a.newValue,t.xb(c)&&(d=this.Lb(c),void 0!==d&&(b?(this.ge&&t.Df(c,this,!0),t.fj(this.Se,a.Zf),this.Gc.remove(d)):(this.ge&&t.Df(c,this,!1),t.ej(this.Se,a.Zf,c),this.Gc.add(d,c))))):""===a.Ff?(c=a.object,!t.isArray(c)&&a.propertyName&&(c=t.nb(a.object,a.propertyName)),t.isArray(c)&&(d=a.newValue,f=a.Zf,b?t.fj(c,f):t.ej(c,f,d))):
t.m("unknown ChangedEvent.Insert object: "+a.toString()):a.Bd===Nd?"nodeDataArray"===a.Ff?(c=a.oldValue,t.xb(c)&&(d=this.Lb(c),void 0!==d&&(b?(this.ge&&t.Df(c,this,!1),t.ej(this.Se,a.ag,c),this.Gc.add(d,c)):(this.ge&&t.Df(c,this,!0),t.fj(this.Se,a.ag),this.Gc.remove(d))))):""===a.Ff?(c=a.object,!t.isArray(c)&&a.propertyName&&(c=t.nb(a.object,a.propertyName)),t.isArray(c)&&(d=a.oldValue,f=a.ag,b?t.ej(c,f,d):t.fj(c,f))):t.m("unknown ChangedEvent.Remove object: "+a.toString()):a.Bd!==Kd&&t.m("unknown ChangedEvent: "+
a.toString())};J.prototype.startTransaction=J.prototype.yc=function(a){return this.ma.yc(a)};J.prototype.commitTransaction=J.prototype.Ie=function(a){return this.ma.Ie(a)};J.prototype.rollbackTransaction=J.prototype.$p=function(){return this.ma.$p()};J.prototype.updateTargetBindings=J.prototype.Vb=function(a,b){void 0===b&&(b="");Ce(this,"SourceChanged",Kd,b,a,null,null)};t.g(J,"nodeKeyProperty",J.prototype.uj);
t.defineProperty(J,{uj:"nodeKeyProperty"},function(){return this.vm},function(a){var b=this.vm;b!==a&&(De(a,J,"nodeKeyProperty"),0<this.Gc.count&&t.m("Cannot set Model.nodeKeyProperty when there is existing node data"),this.vm=a,this.j("nodeKeyProperty",b,a))});function De(a,b,c){"string"!==typeof a&&"function"!==typeof a&&t.jc(a,"string or function",b,c)}
J.prototype.getKeyForNodeData=J.prototype.Lb=function(a){if(null!==a){var b=this.vm;if(""!==b&&(b=t.nb(a,b),void 0!==b)){if(Ee(b))return b;t.m("Key value for node data "+a+" is not a number or a string: "+b)}}};
J.prototype.setKeyForNodeData=J.prototype.wB=function(a,b){null===b&&(b=void 0);void 0===b||Ee(b)||t.jc(b,"number or string",J,"setKeyForNodeData:key");if(null!==a){var c=this.vm;if(""!==c)if(this.te(a)){var d=t.nb(a,c);d!==b&&null===this.zf(b)&&(t.Va(a,c,b),this.Gc.remove(d),this.Gc.add(b,a),Ce(this,"nodeKey",Ld,c,a,d,b),"string"===typeof c&&this.Vb(a,c),this.Zt(d,b))}else t.Va(a,c,b)}};t.g(J,"makeUniqueKeyFunction",J.prototype.IJ);
t.defineProperty(J,{IJ:"makeUniqueKeyFunction"},function(){return this.qv},function(a){var b=this.qv;b!==a&&(null!==a&&t.i(a,"function",J,"makeUniqueKeyFunction"),this.qv=a,this.j("makeUniqueKeyFunction",b,a))});function Ee(a){return"number"===typeof a||"string"===typeof a}J.prototype.containsNodeData=J.prototype.te=function(a){a=this.Lb(a);return void 0===a?!1:this.Gc.contains(a)};
J.prototype.findNodeDataForKey=J.prototype.zf=function(a){null===a&&t.m("Model.findNodeDataForKey:key must not be null");return void 0!==a&&Ee(a)?this.Gc.Da(a):null};t.g(J,"nodeDataArray",J.prototype.Ng);
t.defineProperty(J,{Ng:"nodeDataArray"},function(){return this.Se},function(a){var b=this.Se;if(b!==a){t.ft(a,J,"nodeDataArray");this.ge&&t.Ec&&(null!==b&&t.on(b,"nodeDataArray",this,!0),a=t.on(a,"nodeDataArray",this,!1));this.Gc.clear();this.LB();for(var c=t.ub(a),d=0;d<c;d++){var f=t.rb(a,d);if(!t.xb(f)){t.m("Model.nodeDataArray must only contain Objects, not: "+f);return}t.xt(f)}this.Se=a;for(var g=new H(Object),d=0;d<c;d++){var f=t.rb(a,d),h=this.Lb(f);void 0===h?g.add(f):null!==this.Gc.Da(h)?
g.add(f):this.Gc.add(h,f)}for(d=g.k;d.next();)f=d.value,this.SF(f),g=this.Lb(f),this.Gc.add(g,f);Ce(this,"nodeDataArray",Ld,"nodeDataArray",this,b,a);for(d=0;d<c;d++)f=t.rb(a,d),this.Zp(f),this.Yp(f);this.tE();t.uJ(a)||(this.hb=!0)}});
J.prototype.makeNodeDataKeyUnique=J.prototype.SF=function(a){if(null!==a){var b=this.vm;if(""!==b){var c=this.Lb(a);if(void 0===c||this.Gc.contains(c)){var d=this.qv;if(null!==d&&(c=d(this,a),void 0!==c&&null!==c&&!this.Gc.contains(c))){t.Va(a,b,c);return}if("string"===typeof c){for(d=2;this.Gc.contains(c+d);)d++;t.Va(a,b,c+d)}else if(void 0===c||"number"===typeof c){for(d=-this.Gc.count-1;this.Gc.contains(d);)d--;t.Va(a,b,d)}else t.m("Model.getKeyForNodeData returned something other than a string or a number: "+
c)}}}};J.prototype.addNodeData=J.prototype.Om=function(a){if(null!==a){this.ge&&t.Df(a,this,!1);t.xt(a);var b=this.Lb(a);if(void 0===b||this.Gc.Da(b)!==a)this.SF(a),b=this.Lb(a),this.Gc.add(b,a),b=t.ub(this.Se),t.ej(this.Se,b,a),Ce(this,"nodeDataArray",Md,"nodeDataArray",this,null,a,null,b),this.Zp(a),this.Yp(a)}};J.prototype.addNodeDataCollection=function(a){if(t.isArray(a))for(var b=t.ub(a),c=0;c<b;c++)this.Om(t.rb(a,c));else for(a=a.k;a.next();)this.Om(a.value)};
J.prototype.removeNodeData=J.prototype.Bx=function(a){if(null!==a){var b=this.Lb(a);void 0!==b&&this.Gc.contains(b)&&(this.ge&&t.Df(a,this,!0),this.Gc.remove(b),b=t.cA(this.Se,a),0>b||(t.fj(this.Se,b),Ce(this,"nodeDataArray",Nd,"nodeDataArray",this,a,null,b,null),this.nu(a)))}};J.prototype.removeNodeDataCollection=function(a){if(t.isArray(a))for(var b=t.ub(a),c=0;c<b;c++)this.Bx(t.rb(a,c));else for(a=a.k;a.next();)this.Bx(a.value)};aa=J.prototype;
aa.Zt=function(a,b){var c=Fe(this,a);c instanceof I&&this.hg.add(b,c)};aa.LB=function(){};aa.Zp=function(){};aa.Yp=function(){};aa.nu=function(){};function Ge(a,b,c){if(void 0!==b){var d=a.hg.Da(b);null===d&&(d=new I,a.hg.add(b,d));d.add(c)}}function He(a,b,c){if(void 0!==b){var d=a.hg.Da(b);d instanceof I&&(void 0===c||null===c?a.hg.remove(b):(d.remove(c),0===d.count&&a.hg.remove(b)))}}function Fe(a,b){if(void 0===b)return null;var c=a.hg.Da(b);return c instanceof I?c:null}
J.prototype.clearUnresolvedReferences=J.prototype.tE=function(a){void 0===a?this.hg.clear():this.hg.remove(a)};t.g(J,"copyNodeDataFunction",J.prototype.yI);t.defineProperty(J,{yI:"copyNodeDataFunction"},function(){return this.Lu},function(a){var b=this.Lu;b!==a&&(null!==a&&t.i(a,"function",J,"copyNodeDataFunction"),this.Lu=a,this.j("copyNodeDataFunction",b,a))});t.g(J,"copiesArrays",J.prototype.Fw);
t.defineProperty(J,{Fw:"copiesArrays"},function(){return this.Jy},function(a){var b=this.Jy;b!==a&&(null!==a&&t.i(a,"boolean",J,"copiesArrays"),this.Jy=a,this.j("copiesArrays",b,a))});t.g(J,"copiesArrayObjects",J.prototype.Ew);t.defineProperty(J,{Ew:"copiesArrayObjects"},function(){return this.Iy},function(a){var b=this.Iy;b!==a&&(null!==a&&t.i(a,"boolean",J,"copiesArrayObjects"),this.Iy=a,this.j("copiesArrayObjects",b,a))});
J.prototype.copyNodeData=function(a){if(null===a)return null;var b=null,b=this.Lu;if(null!==b)b=b(a,this);else{var b=new a.constructor,c;for(c in a){var d=t.nb(a,c);if((!e||!Ie(a,c,d))&&this.Fw&&Array.isArray(d)){for(var f=[],g=0;g<d.length;g++){var h=d[g];if(this.Ew&&t.xb(h)){var k=new h.constructor,l;for(l in h){var m=t.nb(h,l);e&&Ie(h,l,m);t.Va(k,l,m)}h=k}f.push(h)}d=f}t.Va(b,c,d)}this.ge&&t.Df(b,this,!1)}b&&t.Fc(b);return b};
function Ie(a,b,c){return c instanceof V||c instanceof v||c instanceof se||c instanceof Je||c instanceof Ke||c instanceof ze||c instanceof Ba||c instanceof Ae||c instanceof Ad||c instanceof Bd?("_"!==b[0]&&t.trace("Warning: found GraphObject or Diagram reference when copying model data on property '"+b+"' of data object: "+a.toString()+"  \nModel data should not have any references to a Diagram or any part of a diagram, such as: "+c.toString()),!0):c instanceof J||c instanceof Od||c instanceof Be||
c instanceof Cd?!0:!1}
J.prototype.setDataProperty=function(a,b,c){e&&(t.i(a,"object",J,"setDataProperty:data"),t.i(b,"string",J,"setDataProperty:propname"),""===b&&t.m("Model.setDataProperty: property name must not be an empty string when setting "+a+" to "+c));if(this.te(a))if(b===this.uj)this.wB(a,c);else{if(b===this.El){this.Fx(a,c);return}}else!t.mq&&a instanceof V&&(t.mq=!0,t.trace('Model.setDataProperty is modifying a GraphObject, "'+a.toString()+'"'),t.trace("  Is that really your intent?"));var d=t.nb(a,b);d!==
c&&(t.Va(a,b,c),this.Ax(a,b,d,c))};J.prototype.addArrayItem=function(a,b){this.rJ(a,-1,b)};J.prototype.insertArrayItem=J.prototype.rJ=function(a,b,c){e&&(t.ft(a,J,"insertArrayItem:arr"),t.q(b,J,"insertArrayItem:idx"));a===this.Se&&t.m("Model.insertArrayItem or Model.addArrayItem should not be called on the Model.nodeDataArray");0>b&&(b=t.ub(a));t.ej(a,b,c);Ce(this,"",Md,"",a,null,c,null,b)};
J.prototype.removeArrayItem=function(a,b){void 0===b&&(b=-1);e&&(t.ft(a,J,"removeArrayItem:arr"),t.q(b,J,"removeArrayItem:idx"));a===this.Se&&t.m("Model.removeArrayItem should not be called on the Model.nodeDataArray");-1===b&&(b=t.ub(a)-1);var c=t.rb(a,b);t.fj(a,b);Ce(this,"",Nd,"",a,c,null,b,null)};t.g(J,"nodeCategoryProperty",J.prototype.El);
t.defineProperty(J,{El:"nodeCategoryProperty"},function(){return this.Wr},function(a){var b=this.Wr;b!==a&&(De(a,J,"nodeCategoryProperty"),this.Wr=a,this.j("nodeCategoryProperty",b,a))});J.prototype.getCategoryForNodeData=J.prototype.getCategoryForNodeData=function(a){if(null===a)return"";var b=this.Wr;if(""===b)return"";b=t.nb(a,b);if(void 0===b)return"";if("string"===typeof b)return b;t.m("getCategoryForNodeData found a non-string category for "+a+": "+b);return""};
J.prototype.setCategoryForNodeData=J.prototype.Fx=function(a,b){t.i(b,"string",J,"setCategoryForNodeData:cat");if(null!==a){var c=this.Wr;if(""!==c)if(this.te(a)){var d=t.nb(a,c);void 0===d&&(d="");d!==b&&(t.Va(a,c,b),Ce(this,"nodeCategory",Ld,c,a,d,b))}else t.Va(a,c,b)}};
function T(a,b){2<arguments.length&&t.m("GraphLinksModel constructor can only take two optional arguments, the Array of node data and the Array of link data.");J.call(this);this.gh=[];this.pm=new I(Object);this.Kk=this.Ku=null;this.Lj="from";this.Oj="to";this.Dr=this.Cr="";this.zr="category";this.Vh=this.Ev="";this.Dv="isGroup";this.Vj="group";this.Ky=!1;void 0!==a&&(this.Ng=a);void 0!==b&&(this.tj=b)}t.ka("GraphLinksModel",T);t.Qa(T,J);
T.prototype.clear=T.prototype.clear=function(){J.prototype.clear.call(this);this.ge&&t.on(this.gh,"linkDataArray",this,!0);this.gh=[];this.pm.clear()};aa=T.prototype;aa.toString=function(a){void 0===a&&(a=0);if(2<=a)return this.FB();var b=(""!==this.name?this.name:"")+" GraphLinksModel";if(0<a){b+="\n node data:";a=this.Ng;var c=t.ub(a),d;for(d=0;d<c;d++)var f=t.rb(a,d),b=b+(" "+this.Lb(f)+":"+na(f));b+="\n link data:";a=this.tj;c=t.ub(a);for(d=0;d<c;d++)f=t.rb(a,d),b+=" "+this.vl(f)+"--\x3e"+this.zl(f)}return b};
aa.ou=function(){var a=J.prototype.ou.call(this),b="";"category"!==this.Hp&&"string"===typeof this.Hp&&(b+=',\n  "linkCategoryProperty": '+this.quote(this.Hp));"from"!==this.qn&&"string"===typeof this.qn&&(b+=',\n  "linkFromKeyProperty": '+this.quote(this.qn));"to"!==this.rn&&"string"===typeof this.rn&&(b+=',\n  "linkToKeyProperty": '+this.quote(this.rn));""!==this.Ip&&"string"===typeof this.Ip&&(b+=',\n  "linkFromPortIdProperty": '+this.quote(this.Ip));""!==this.Mp&&"string"===typeof this.Mp&&(b+=
',\n  "linkToPortIdProperty": '+this.quote(this.Mp));""!==this.St&&"string"===typeof this.St&&(b+=',\n  "nodeIsLinkLabelProperty": '+this.quote(this.St));""!==this.Jp&&"string"===typeof this.Jp&&(b+=',\n  "linkLabelKeysProperty": '+this.quote(this.Jp));"isGroup"!==this.Vp&&"string"===typeof this.Vp&&(b+=',\n  "nodeIsGroupProperty": '+this.quote(this.Vp));"group"!==this.wn&&"string"===typeof this.wn&&(b+=',\n  "nodeGroupKeyProperty": '+this.quote(this.wn));return a+b};
aa.QB=function(){var a=J.prototype.QB.call(this),b=',\n  "linkDataArray": '+ae(this,this.tj,!0);return a+b};
aa.Xt=function(a){J.prototype.Xt.call(this,a);a.linkFromKeyProperty&&(this.qn=a.linkFromKeyProperty);a.linkToKeyProperty&&(this.rn=a.linkToKeyProperty);a.linkFromPortIdProperty&&(this.Ip=a.linkFromPortIdProperty);a.linkToPortIdProperty&&(this.Mp=a.linkToPortIdProperty);a.linkCategoryProperty&&(this.Hp=a.linkCategoryProperty);a.nodeIsLinkLabelProperty&&(this.St=a.nodeIsLinkLabelProperty);a.linkLabelKeysProperty&&(this.Jp=a.linkLabelKeysProperty);a.nodeIsGroupProperty&&(this.Vp=a.nodeIsGroupProperty);
a.nodeGroupKeyProperty&&(this.wn=a.nodeGroupKeyProperty)};aa.hB=function(a){J.prototype.hB.call(this,a);if(a=a.linkDataArray)be(this,a),this.tj=a};
T.prototype.changeState=function(a,b){if(a.Bd===Md){var c=null;"linkDataArray"===a.Ff?c=this.gh:"linkLabelKeys"===a.Ff&&(c=this.xl(a.object));if(t.isArray(c)){b?(this.ge&&t.xb(a.newValue)&&t.Df(a.newValue,this,!0),t.fj(c,a.Zf)):(this.ge&&t.xb(a.newValue)&&t.Df(a.newValue,this,!1),t.ej(c,a.Zf,a.newValue));return}}else if(a.Bd===Nd&&(c=null,"linkDataArray"===a.Ff?c=this.gh:"linkLabelKeys"===a.Ff&&(c=this.xl(a.object)),t.isArray(c))){b?(this.ge&&t.xb(a.oldValue)&&t.Df(a.oldValue,this,!1),t.ej(c,a.ag,
a.oldValue)):(this.ge&&t.xb(a.oldValue)&&t.Df(a.oldValue,this,!0),t.fj(c,a.ag));return}J.prototype.changeState.call(this,a,b)};t.g(T,"archetypeNodeData",T.prototype.ct);t.defineProperty(T,{ct:"archetypeNodeData"},function(){return this.Kk},function(a){var b=this.Kk;b!==a&&(null!==a&&t.l(a,Object,T,"archetypeNodeData"),this.Kk=a,this.j("archetypeNodeData",b,a))});
T.prototype.tn=function(a){if(void 0!==a){var b=this.Kk;if(null!==b){var c=this.zf(a);null===c&&(c=this.copyNodeData(b),t.Va(c,this.vm,a),this.Om(c))}return a}};t.g(T,"linkFromKeyProperty",T.prototype.qn);t.defineProperty(T,{qn:"linkFromKeyProperty"},function(){return this.Lj},function(a){var b=this.Lj;b!==a&&(De(a,T,"linkFromKeyProperty"),this.Lj=a,this.j("linkFromKeyProperty",b,a))});
T.prototype.getFromKeyForLinkData=T.prototype.vl=function(a){if(null!==a){var b=this.Lj;if(""!==b&&(b=t.nb(a,b),void 0!==b)){if(Ee(b))return b;t.m("FromKey value for link data "+a+" is not a number or a string: "+b)}}};
T.prototype.setFromKeyForLinkData=T.prototype.Hx=function(a,b){null===b&&(b=void 0);void 0===b||Ee(b)||t.jc(b,"number or string",T,"setFromKeyForLinkData:key");if(null!==a){var c=this.Lj;if(""!==c)if(b=this.tn(b),this.jj(a)){var d=t.nb(a,c);d!==b&&(He(this,d,a),t.Va(a,c,b),null===this.zf(b)&&Ge(this,b,a),Ce(this,"linkFromKey",Ld,c,a,d,b),"string"===typeof c&&this.Vb(a,c))}else t.Va(a,c,b)}};t.g(T,"linkToKeyProperty",T.prototype.rn);
t.defineProperty(T,{rn:"linkToKeyProperty"},function(){return this.Oj},function(a){var b=this.Oj;b!==a&&(De(a,T,"linkToKeyProperty"),this.Oj=a,this.j("linkToKeyProperty",b,a))});T.prototype.getToKeyForLinkData=T.prototype.zl=function(a){if(null!==a){var b=this.Oj;if(""!==b&&(b=t.nb(a,b),void 0!==b)){if(Ee(b))return b;t.m("ToKey value for link data "+a+" is not a number or a string: "+b)}}};
T.prototype.setToKeyForLinkData=T.prototype.Jx=function(a,b){null===b&&(b=void 0);void 0===b||Ee(b)||t.jc(b,"number or string",T,"setToKeyForLinkData:key");if(null!==a){var c=this.Oj;if(""!==c)if(b=this.tn(b),this.jj(a)){var d=t.nb(a,c);d!==b&&(He(this,d,a),t.Va(a,c,b),null===this.zf(b)&&Ge(this,b,a),Ce(this,"linkToKey",Ld,c,a,d,b),"string"===typeof c&&this.Vb(a,c))}else t.Va(a,c,b)}};t.g(T,"linkFromPortIdProperty",T.prototype.Ip);
t.defineProperty(T,{Ip:"linkFromPortIdProperty"},function(){return this.Cr},function(a){var b=this.Cr;b!==a&&(De(a,T,"linkFromPortIdProperty"),this.Cr=a,this.j("linkFromPortIdProperty",b,a))});T.prototype.getFromPortIdForLinkData=T.prototype.fJ=function(a){if(null===a)return"";var b=this.Cr;if(""===b)return"";a=t.nb(a,b);return void 0===a?"":a};
T.prototype.setFromPortIdForLinkData=T.prototype.vB=function(a,b){t.i(b,"string",T,"setFromPortIdForLinkData:portname");if(null!==a){var c=this.Cr;if(""!==c)if(this.jj(a)){var d=t.nb(a,c);void 0===d&&(d="");d!==b&&(t.Va(a,c,b),Ce(this,"linkFromPortId",Ld,c,a,d,b),"string"===typeof c&&this.Vb(a,c))}else t.Va(a,c,b)}};t.g(T,"linkToPortIdProperty",T.prototype.Mp);
t.defineProperty(T,{Mp:"linkToPortIdProperty"},function(){return this.Dr},function(a){var b=this.Dr;b!==a&&(De(a,T,"linkToPortIdProperty"),this.Dr=a,this.j("linkToPortIdProperty",b,a))});T.prototype.getToPortIdForLinkData=T.prototype.iJ=function(a){if(null===a)return"";var b=this.Dr;if(""===b)return"";a=t.nb(a,b);return void 0===a?"":a};
T.prototype.setToPortIdForLinkData=T.prototype.yB=function(a,b){t.i(b,"string",T,"setToPortIdForLinkData:portname");if(null!==a){var c=this.Dr;if(""!==c)if(this.jj(a)){var d=t.nb(a,c);void 0===d&&(d="");d!==b&&(t.Va(a,c,b),Ce(this,"linkToPortId",Ld,c,a,d,b),"string"===typeof c&&this.Vb(a,c))}else t.Va(a,c,b)}};t.g(T,"nodeIsLinkLabelProperty",T.prototype.St);
t.defineProperty(T,{St:"nodeIsLinkLabelProperty"},function(){return this.Ev},function(a){var b=this.Ev;b!==a&&(De(a,T,"nodeIsLinkLabelProperty"),this.Ev=a,this.j("nodeIsLinkLabelProperty",b,a))});T.prototype.isLinkLabelForNodeData=T.prototype.tJ=function(a){if(null===a)return!1;var b=this.Ev;return""===b?!1:t.nb(a,b)?!0:!1};t.g(T,"linkLabelKeysProperty",T.prototype.Jp);
t.defineProperty(T,{Jp:"linkLabelKeysProperty"},function(){return this.Vh},function(a){var b=this.Vh;b!==a&&(De(a,T,"linkLabelKeysProperty"),this.Vh=a,this.j("linkLabelKeysProperty",b,a))});T.prototype.getLabelKeysForLinkData=T.prototype.xl=function(a){if(null===a)return t.xi;var b=this.Vh;if(""===b)return t.xi;a=t.nb(a,b);return void 0===a?t.xi:a};
T.prototype.setLabelKeysForLinkData=T.prototype.EG=function(a,b){t.ft(b,T,"setLabelKeysForLinkData:arr");if(null!==a){var c=this.Vh;if(""!==c)if(this.jj(a)){var d=t.nb(a,c);void 0===d&&(d=t.xi);if(d!==b){for(var f=t.ub(d),g=0;g<f;g++){var h=t.rb(d,g);He(this,h,a)}t.Va(a,c,b);f=t.ub(b);for(g=0;g<f;g++)h=t.rb(b,g),null===this.zf(h)&&Ge(this,h,a);Ce(this,"linkLabelKeys",Ld,c,a,d,b);"string"===typeof c&&this.Vb(a,c)}}else t.Va(a,c,b)}};
T.prototype.addLabelKeyForLinkData=T.prototype.fE=function(a,b){if(null!==b&&void 0!==b&&(Ee(b)||t.jc(b,"number or string",T,"addLabelKeyForLinkData:key"),null!==a)){var c=this.Vh;if(""!==c){var d=t.nb(a,c);void 0===d?this.EG(a,[b]):t.isArray(d)?0<=t.cA(d,b)||(t.ej(d,Infinity,b),this.jj(a)&&(null===this.zf(b)&&Ge(this,b,a),Ce(this,"linkLabelKeys",Md,c,a,null,b))):t.m(c+" property is not an Array; cannot addLabelKeyForLinkData: "+a)}}};
T.prototype.removeLabelKeyForLinkData=T.prototype.eK=function(a,b){if(null!==b&&void 0!==b&&(Ee(b)||t.jc(b,"number or string",T,"removeLabelKeyForLinkData:key"),null!==a)){var c=this.Vh;if(""!==c){var d=t.nb(a,c);if(t.isArray(d)){var f=t.cA(d,b);0>f||(t.fj(d,f),this.jj(a)&&(He(this,b,a),Ce(this,"linkLabelKeys",Nd,c,a,b,null)))}else void 0!==d&&t.m(c+" property is not an Array; cannot removeLabelKeyforLinkData: "+a)}}};t.g(T,"linkDataArray",T.prototype.tj);
t.defineProperty(T,{tj:"linkDataArray"},function(){return this.gh},function(a){var b=this.gh;if(b!==a){t.ft(a,T,"linkDataArray");this.ge&&t.Ec&&(null!==b&&t.on(b,"linkDataArray",this,!0),a=t.on(a,"linkDataArray",this,!1));for(var c=t.ub(a),d=0;d<c;d++){var f=t.rb(a,d);if(!t.xb(f)){t.m("GraphLinksModel.linkDataArray must only contain Objects, not: "+f);return}t.xt(f)}this.gh=a;for(var g=new I(Object),d=0;d<c;d++)f=t.rb(a,d),g.add(f);this.pm=g;Ce(this,"linkDataArray",Ld,"linkDataArray",this,b,a);for(d=
0;d<c;d++)f=t.rb(a,d),Le(this,f)}});T.prototype.containsLinkData=T.prototype.jj=function(a){return null===a?!1:this.pm.contains(a)};T.prototype.addLinkData=T.prototype.nw=function(a){if(null!==a){this.ge&&t.Df(a,this,!1);if(void 0===t.ud(a))t.Fc(a);else if(this.jj(a))return;this.pm.add(a);var b=t.ub(this.gh);t.ej(this.gh,b,a);Ce(this,"linkDataArray",Md,"linkDataArray",this,null,a,null,b);Le(this,a)}};
T.prototype.addLinkDataCollection=function(a){if(t.isArray(a))for(var b=t.ub(a),c=0;c<b;c++)this.nw(t.rb(a,c));else for(a=a.k;a.next();)this.nw(a.value)};
T.prototype.removeLinkData=T.prototype.lB=function(a){if(null!==a){this.ge&&t.Df(a,this,!0);this.pm.remove(a);var b=this.gh.indexOf(a);if(!(0>b)){t.fj(this.gh,b);Ce(this,"linkDataArray",Nd,"linkDataArray",this,a,null,b,null);b=this.vl(a);He(this,b,a);b=this.zl(a);He(this,b,a);var c=this.xl(a);if(t.isArray(c))for(var d=t.ub(c),f=0;f<d;f++)b=t.rb(c,f),He(this,b,a)}}};T.prototype.removeLinkDataCollection=function(a){if(t.isArray(a))for(var b=t.ub(a),c=0;c<b;c++)this.lB(t.rb(a,c));else for(a=a.k;a.next();)this.lB(a.value)};
function Le(a,b){var c=a.vl(b),c=a.tn(c);null===a.zf(c)&&Ge(a,c,b);c=a.zl(b);c=a.tn(c);null===a.zf(c)&&Ge(a,c,b);var d=a.xl(b);if(t.isArray(d))for(var f=t.ub(d),g=0;g<f;g++)c=t.rb(d,g),null===a.zf(c)&&Ge(a,c,b)}t.g(T,"copyLinkDataFunction",T.prototype.xI);t.defineProperty(T,{xI:"copyLinkDataFunction"},function(){return this.Ku},function(a){var b=this.Ku;b!==a&&(null!==a&&t.i(a,"function",T,"copyLinkDataFunction"),this.Ku=a,this.j("copyLinkDataFunction",b,a))});
T.prototype.copyLinkData=T.prototype.EE=function(a){if(null===a)return null;var b=null,b=this.Ku;if(null!==b)b=b(a,this);else{var b=new a.constructor,c;for(c in a){var d=t.nb(a,c);e&&Ie(a,c,d);t.Va(b,c,d)}this.ge&&t.Df(b,this,!1)}b&&(t.Fc(b),""!==this.Lj&&t.Va(b,this.Lj,void 0),""!==this.Oj&&t.Va(b,this.Oj,void 0),""!==this.Vh&&t.Va(b,this.Vh,[]));return b};t.g(T,"nodeIsGroupProperty",T.prototype.Vp);
t.defineProperty(T,{Vp:"nodeIsGroupProperty"},function(){return this.Dv},function(a){var b=this.Dv;b!==a&&(De(a,T,"nodeIsGroupProperty"),this.Dv=a,this.j("nodeIsGroupProperty",b,a))});T.prototype.isGroupForNodeData=T.prototype.KA=function(a){if(null===a)return!1;var b=this.Dv;return""===b?!1:t.nb(a,b)?!0:!1};t.g(T,"nodeGroupKeyProperty",T.prototype.wn);
t.defineProperty(T,{wn:"nodeGroupKeyProperty"},function(){return this.Vj},function(a){var b=this.Vj;b!==a&&(De(a,T,"nodeGroupKeyProperty"),this.Vj=a,this.j("nodeGroupKeyProperty",b,a))});t.g(T,"copiesGroupKeyOfNodeData",T.prototype.nl);t.defineProperty(T,{nl:"copiesGroupKeyOfNodeData"},function(){return this.Ky},function(a){this.Ky!==a&&(t.i(a,"boolean",T,"copiesGroupKeyOfNodeData"),this.Ky=a)});
T.prototype.getGroupKeyForNodeData=T.prototype.hn=function(a){if(null!==a){var b=this.Vj;if(""!==b&&(b=t.nb(a,b),void 0!==b)){if(Ee(b))return b;t.m("GroupKey value for node data "+a+" is not a number or a string: "+b)}}};
T.prototype.setGroupKeyForNodeData=T.prototype.Ix=function(a,b){null===b&&(b=void 0);void 0===b||Ee(b)||t.jc(b,"number or string",T,"setGroupKeyForNodeData:key");if(null!==a){var c=this.Vj;if(""!==c)if(this.te(a)){var d=t.nb(a,c);d!==b&&(He(this,d,a),t.Va(a,c,b),null===this.zf(b)&&Ge(this,b,a),Ce(this,"nodeGroupKey",Ld,c,a,d,b),"string"===typeof c&&this.Vb(a,c))}else t.Va(a,c,b)}};
T.prototype.copyNodeData=function(a){if(null===a)return null;a=J.prototype.copyNodeData.call(this,a);this.nl||""===this.Vj||t.Va(a,this.Vj,void 0);return a};
T.prototype.setDataProperty=function(a,b,c){e&&(t.i(a,"object",T,"setDataProperty:data"),t.i(b,"string",T,"setDataProperty:propname"),""===b&&t.m("GraphLinksModel.setDataProperty: property name must not be an empty string when setting "+a+" to "+c));if(this.te(a))if(b===this.uj)this.wB(a,c);else{if(b===this.El){this.Fx(a,c);return}if(b===this.wn){this.Ix(a,c);return}b===this.Vp&&t.m("GraphLinksModel.setDataProperty: property name must not be the nodeIsGroupProperty: "+b)}else if(this.jj(a)){if(b===
this.qn){this.Hx(a,c);return}if(b===this.rn){this.Jx(a,c);return}if(b===this.Ip){this.vB(a,c);return}if(b===this.Mp){this.yB(a,c);return}if(b===this.Hp){this.DG(a,c);return}if(b===this.Jp){this.EG(a,c);return}}else!t.mq&&a instanceof V&&(t.mq=!0,t.trace('GraphLinksModel.setDataProperty is modifying a GraphObject, "'+a.toString()+'"'),t.trace("  Is that really your intent?"));var d=t.nb(a,b);d!==c&&(t.Va(a,b,c),this.Ax(a,b,d,c))};aa=T.prototype;
aa.Zt=function(a,b){J.prototype.Zt.call(this,a,b);for(var c=this.Gc.k;c.next();)this.nB(c.value,a,b);for(c=this.pm.k;c.next();){var d=c.value,f=a,g=b;if(this.vl(d)===f){var h=this.Lj;t.Va(d,h,g);Ce(this,"linkFromKey",Ld,h,d,f,g);"string"===typeof h&&this.Vb(d,h)}this.zl(d)===f&&(h=this.Oj,t.Va(d,h,g),Ce(this,"linkToKey",Ld,h,d,f,g),"string"===typeof h&&this.Vb(d,h));var k=this.xl(d);if(t.isArray(k))for(var l=t.ub(k),h=this.Vh,m=0;m<l;m++)t.rb(k,m)===f&&(t.kE(k,m,g),Ce(this,"linkLabelKeys",Md,h,d,
f,g))}};aa.nB=function(a,b,c){if(this.hn(a)===b){var d=this.Vj;t.Va(a,d,c);Ce(this,"nodeGroupKey",Ld,d,a,b,c);"string"===typeof d&&this.Vb(a,d)}};aa.LB=function(){J.prototype.LB.call(this);for(var a=this.tj,b=t.ub(a),c=0;c<b;c++){var d=t.rb(a,c);Le(this,d)}};
aa.Zp=function(a){J.prototype.Zp.call(this,a);a=this.Lb(a);var b=Fe(this,a);if(null!==b){for(var c=new H(Object),b=b.k;b.next();){var d=b.value;if(this.te(d)){if(this.hn(d)===a){var f=this.Vj;Ce(this,"nodeGroupKey",Ld,f,d,a,a);"string"===typeof f&&this.Vb(d,f);c.add(d)}}else{this.vl(d)===a&&(f=this.Lj,Ce(this,"linkFromKey",Ld,f,d,a,a),"string"===typeof f&&this.Vb(d,f),c.add(d));this.zl(d)===a&&(f=this.Oj,Ce(this,"linkToKey",Ld,f,d,a,a),"string"===typeof f&&this.Vb(d,f),c.add(d));var g=this.xl(d);
if(t.isArray(g))for(var h=t.ub(g),f=this.Vh,k=0;k<h;k++)t.rb(g,k)===a&&(Ce(this,"linkLabelKeys",Md,f,d,a,a),c.add(d))}}for(c=c.k;c.next();)He(this,a,c.value)}};aa.Yp=function(a){J.prototype.Yp.call(this,a);var b=this.hn(a);null===this.zf(b)&&Ge(this,b,a)};aa.nu=function(a){J.prototype.nu.call(this,a);var b=this.hn(a);He(this,b,a)};t.g(T,"linkCategoryProperty",T.prototype.Hp);
t.defineProperty(T,{Hp:"linkCategoryProperty"},function(){return this.zr},function(a){var b=this.zr;b!==a&&(De(a,T,"linkCategoryProperty"),this.zr=a,this.j("linkCategoryProperty",b,a))});T.prototype.getCategoryForLinkData=T.prototype.getCategoryForLinkData=function(a){if(null===a)return"";var b=this.zr;if(""===b)return"";b=t.nb(a,b);if(void 0===b)return"";if("string"===typeof b)return b;t.m("getCategoryForLinkData found a non-string category for "+a+": "+b);return""};
T.prototype.setCategoryForLinkData=T.prototype.DG=function(a,b){t.i(b,"string",T,"setCategoryForLinkData:cat");if(null!==a){var c=this.zr;if(""===c)return"";if(this.jj(a)){var d=t.nb(a,c);void 0===d&&(d="");d!==b&&(t.Va(a,c,b),Ce(this,"linkCategory",Ld,c,a,d,b),"string"===typeof c&&this.Vb(a,c))}else t.Va(a,c,b)}};
function ce(a){1<arguments.length&&t.m("TreeModel constructor can only take one optional argument, the Array of node data.");J.call(this);this.Wj="parent";this.Ly=!1;this.$r="parentLinkCategory";void 0!==a&&(this.Ng=a)}t.ka("TreeModel",ce);t.Qa(ce,J);ce.prototype.toString=function(a){void 0===a&&(a=0);if(2<=a)return this.FB();var b=(""!==this.name?this.name:"")+" TreeModel";if(0<a){b+="\n node data:";a=this.Ng;var c=t.ub(a),d;for(d=0;d<c;d++)var f=t.rb(a,d),b=b+(" "+this.Lb(f)+":"+na(f))}return b};
ce.prototype.ou=function(){var a=J.prototype.ou.call(this),b="";"parent"!==this.xn&&"string"===typeof this.xn&&(b+=',\n  "nodeParentKeyProperty": '+this.quote(this.xn));return a+b};ce.prototype.Xt=function(a){J.prototype.Xt.call(this,a);a.nodeParentKeyProperty&&(this.xn=a.nodeParentKeyProperty)};ce.prototype.tn=function(a){return a};t.g(ce,"nodeParentKeyProperty",ce.prototype.xn);
t.defineProperty(ce,{xn:"nodeParentKeyProperty"},function(){return this.Wj},function(a){var b=this.Wj;b!==a&&(De(a,ce,"nodeParentKeyProperty"),this.Wj=a,this.j("nodeParentKeyProperty",b,a))});t.g(ce,"copiesParentKeyOfNodeData",ce.prototype.ol);t.defineProperty(ce,{ol:"copiesParentKeyOfNodeData"},function(){return this.Ly},function(a){this.Ly!==a&&(t.i(a,"boolean",ce,"copiesParentKeyOfNodeData"),this.Ly=a)});
ce.prototype.getParentKeyForNodeData=ce.prototype.jn=function(a){if(null!==a){var b=this.Wj;if(""!==b&&(b=t.nb(a,b),void 0!==b)){if(Ee(b))return b;t.m("ParentKey value for node data "+a+" is not a number or a string: "+b)}}};
ce.prototype.setParentKeyForNodeData=ce.prototype.xh=function(a,b){null===b&&(b=void 0);void 0===b||Ee(b)||t.jc(b,"number or string",ce,"setParentKeyForNodeData:key");if(null!==a){var c=this.Wj;if(""!==c)if(b=this.tn(b),this.te(a)){var d=t.nb(a,c);d!==b&&(He(this,d,a),t.Va(a,c,b),null===this.zf(b)&&Ge(this,b,a),Ce(this,"nodeParentKey",Ld,c,a,d,b),"string"===typeof c&&this.Vb(a,c))}else t.Va(a,c,b)}};t.g(ce,"parentLinkCategoryProperty",ce.prototype.ZJ);
t.defineProperty(ce,{ZJ:"parentLinkCategoryProperty"},function(){return this.$r},function(a){var b=this.$r;b!==a&&(De(a,ce,"parentLinkCategoryProperty"),this.$r=a,this.j("parentLinkCategoryProperty",b,a))});ce.prototype.getParentLinkCategoryForNodeData=ce.prototype.hJ=function(a){if(null===a)return"";var b=this.$r;if(""===b)return"";b=t.nb(a,b);if(void 0===b)return"";if("string"===typeof b)return b;t.m("getParentLinkCategoryForNodeData found a non-string category for "+a+": "+b);return""};
ce.prototype.setParentLinkCategoryForNodeData=ce.prototype.kK=function(a,b){t.i(b,"string",ce,"setParentLinkCategoryForNodeData:cat");if(null!==a){var c=this.$r;if(""===c)return"";if(this.te(a)){var d=t.nb(a,c);void 0===d&&(d="");d!==b&&(t.Va(a,c,b),Ce(this,"parentLinkCategory",Ld,c,a,d,b),"string"===typeof c&&this.Vb(a,c))}else t.Va(a,c,b)}};ce.prototype.copyNodeData=function(a){if(null===a)return null;a=J.prototype.copyNodeData.call(this,a);this.ol||""===this.Wj||t.Va(a,this.Wj,void 0);return a};
ce.prototype.setDataProperty=function(a,b,c){e&&(t.i(a,"object",ce,"setDataProperty:data"),t.i(b,"string",ce,"setDataProperty:propname"),""===b&&t.m("TreeModel.setDataProperty: property name must not be an empty string when setting "+a+" to "+c));if(this.te(a))if(b===this.uj)this.wB(a,c);else{if(b===this.El){this.Fx(a,c);return}if(b===this.xn){this.xh(a,c);return}}else!t.mq&&a instanceof V&&(t.mq=!0,t.trace('TreeModel.setDataProperty is modifying a GraphObject, "'+a.toString()+'"'),t.trace("  Is that really your intent?"));
var d=t.nb(a,b);d!==c&&(t.Va(a,b,c),this.Ax(a,b,d,c))};aa=ce.prototype;aa.Zt=function(a,b){J.prototype.Zt.call(this,a,b);for(var c=this.Gc.k;c.next();)this.nB(c.value,a,b)};aa.nB=function(a,b,c){if(this.jn(a)===b){var d=this.Wj;t.Va(a,d,c);Ce(this,"nodeParentKey",Ld,d,a,b,c);"string"===typeof d&&this.Vb(a,d)}};
aa.Zp=function(a){J.prototype.Zp.call(this,a);a=this.Lb(a);var b=Fe(this,a);if(null!==b){for(var c=new H(Object),b=b.k;b.next();){var d=b.value;if(this.te(d)&&this.jn(d)===a){var f=this.Wj;Ce(this,"nodeParentKey",Ld,f,d,a,a);"string"===typeof f&&this.Vb(d,f);c.add(d)}}for(c=c.k;c.next();)He(this,a,c.value)}};aa.Yp=function(a){J.prototype.Yp.call(this,a);var b=this.jn(a),b=this.tn(b);null===this.zf(b)&&Ge(this,b,a)};aa.nu=function(a){J.prototype.nu.call(this,a);var b=this.jn(a);He(this,b,a)};
function Me(a,b,c){t.Fc(this);void 0===a?a="":t.i(a,"string",Me,"constructor:targetprop");void 0===b?b=a:t.i(b,"string",Me,"constructor:sourceprop");void 0===c?c=null:null!==c&&t.i(c,"function",Me,"constructor:conv");this.KD="";this.vg=null;this.fw=a;this.dw=this.Kz=0;this.ED=null;this.Zv=b;this.Hy=c;this.tz=Xe;this.Ay=null}t.ka("Binding",Me);var Xe;Me.OneWay=Xe=t.w(Me,"OneWay",1);var Ye;Me.TwoWay=Ye=t.w(Me,"TwoWay",2);
Me.parseEnum=function(a,b){t.i(a,"function",Me,"parseEnum:ctor");t.Fa(b,a,Me,"parseEnum:defval");return function(c){return t.en(a,c)||b}};var na;Me.toString=na=function(a){var b=a;t.xb(a)&&(a.text?b=a.text:a.name?b=a.name:void 0!==a.key?b=a.key:void 0!==a.id?b=a.id:a.constructor===Object&&(a.Text?b=a.Text:a.Name?b=a.Name:void 0!==a.Key?b=a.Key:void 0!==a.Id?b=a.Id:void 0!==a.ID&&(b=a.ID)));return void 0===b?"undefined":null===b?"null":b.toString()};
Me.prototype.toString=function(){return"Binding("+this.Fn+" "+this.ku+":"+this.AB+")"};Me.prototype.freeze=function(){this.tb=!0;return this};Me.prototype.Ra=function(){this.tb=!1;return this};t.g(Me,"targetId",Me.prototype.Fn);t.defineProperty(Me,{Fn:null},function(){return this.KD},function(a){t.J(this);t.i(a,"string",Me,"targetId");this.KD=a});t.g(Me,"targetProperty",Me.prototype.ku);
t.defineProperty(Me,{ku:"targetProperty"},function(){return this.fw},function(a){t.J(this);t.i(a,"string",Me,"targetProperty");this.fw=a});t.g(Me,"sourceName",Me.prototype.iu);t.defineProperty(Me,{iu:"sourceName"},function(){return this.ED},function(a){t.J(this);t.i(a,"string",Me,"sourceName");this.ED=a});t.g(Me,"sourceProperty",Me.prototype.AB);t.defineProperty(Me,{AB:"sourceProperty"},function(){return this.Zv},function(a){t.J(this);t.i(a,"string",Me,"sourceProperty");this.Zv=a});
t.g(Me,"converter",Me.prototype.BE);t.defineProperty(Me,{BE:"converter"},function(){return this.Hy},function(a){t.J(this);null!==a&&t.i(a,"function",Me,"converter");this.Hy=a});t.g(Me,"backConverter",Me.prototype.pE);t.defineProperty(Me,{pE:"backConverter"},function(){return this.Ay},function(a){t.J(this);null!==a&&t.i(a,"function",Me,"backConverter");this.Ay=a});t.g(Me,"mode",Me.prototype.mode);
t.defineProperty(Me,{mode:"mode"},function(){return this.tz},function(a){t.J(this);t.Fa(a,Me,Me,"mode");this.tz=a});Me.prototype.makeTwoWay=function(a){void 0===a&&(a=null);null!==a&&t.i(a,"function",Me,"makeTwoWay");this.mode=Ye;this.pE=a;return this};Me.prototype.ofObject=Me.prototype.bB=function(a){void 0===a&&(a="");e&&t.i(a,"string",Me,"ofObject:srcname");this.iu=a;return this};
Me.prototype.updateTarget=Me.prototype.eH=function(a,b,c){var d=this.Zv;if(!c||d===c){c=this.fw;var f=this.Hy;if(null===f&&""===c)t.trace("Binding error: target property is the empty string: "+this.toString());else{e&&"string"===typeof c&&("function"!==typeof a.setAttribute&&0<c.length&&"_"!==c[0]&&!t.Yw(a,c)?t.trace("Binding error: undefined target property: "+c+" on "+a.toString()):"name"===c&&a instanceof V&&t.trace("Binding error: cannot modify GraphObject.name on "+a.toString()));var g=b;""!==
d&&(g=t.nb(b,d));if(void 0!==g)if(null===f)""!==c&&t.Va(a,c,g);else try{if(""!==c){var h=f(g,a);e&&void 0===h&&t.trace('Binding warning: conversion function returned undefined when setting target property "'+c+'" on '+a.toString()+", function is: "+f);t.Va(a,c,h)}else f(g,a)}catch(k){e&&t.trace("Binding error: "+k.toString()+' setting target property "'+c+'" on '+a.toString()+" with conversion function: "+f)}}}};
Me.prototype.updateSource=Me.prototype.MB=function(a,b,c,d){if(this.tz===Ye){var f=this.fw;if(!c||f===c){c=this.Zv;var g=this.Ay;if(null!==g||""!==c){var h=a;""!==f&&(h=t.nb(a,f));if(void 0!==h)if(null===g)d&&d.ea?(e&&d.ea.uj===c&&d.ea.te(b)&&t.trace("Binding error: cannot have TwoWay Binding on node data key property: "+this.toString()),d.ea.setDataProperty(b,c,h)):t.Va(b,c,h);else try{if(""!==c){var k=g(h,b);d&&d.ea?(e&&(d.ea.uj===c&&d.ea.te(b)&&t.trace("Binding error: cannot have TwoWay Binding on node data key property: "+
this.toString()),void 0===k&&t.trace('Binding warning: conversion function returned undefined when setting source property "'+c+'" on '+b.toString()+", function is: "+g)),d.ea.setDataProperty(b,c,k)):t.Va(b,c,k)}else g(h,b)}catch(l){e&&t.trace("Binding error: "+l.toString()+' setting source property "'+c+'" on '+b.toString()+" with conversion function: "+g)}}}}};function Be(){this.zH=(new H(Cd)).freeze();this.ec="";this.MC=!1}t.ka("Transaction",Be);
Be.prototype.toString=function(a){var b="Transaction: "+this.name+" "+this.nh.count.toString()+(this.Bp?"":", incomplete");if(void 0!==a&&0<a)for(var c=this.nh.count,d=0;d<c;d++){var f=this.nh.wa(d);null!==f&&(b+="\n  "+f.toString(a-1))}return b};Be.prototype.clear=Be.prototype.clear=function(){var a=this.nh;a.Ra();for(var b=a.count-1;0<=b;b--){var c=a.wa(b);null!==c&&c.clear()}a.clear();a.freeze()};Be.prototype.canUndo=Be.prototype.canUndo=function(){return this.Bp};
Be.prototype.undo=Be.prototype.undo=function(){if(this.canUndo())for(var a=this.nh.count-1;0<=a;a--){var b=this.nh.wa(a);null!==b&&b.undo()}};Be.prototype.canRedo=Be.prototype.canRedo=function(){return this.Bp};Be.prototype.redo=Be.prototype.redo=function(){if(this.canRedo())for(var a=this.nh.count,b=0;b<a;b++){var c=this.nh.wa(b);null!==c&&c.redo()}};t.A(Be,{nh:"changes"},function(){return this.zH});t.g(Be,"name",Be.prototype.name);
t.defineProperty(Be,{name:"name"},function(){return this.ec},function(a){this.ec=a});t.g(Be,"isComplete",Be.prototype.Bp);t.defineProperty(Be,{Bp:"isComplete"},function(){return this.MC},function(a){this.MC=a});function Od(){this.vz=new I(J);this.Re=!1;this.FH=(new H(Be)).freeze();this.ah=-1;this.aD=999;this.Ki=!1;this.Qu=null;this.hl=0;this.By=!1;e&&(this.By=!0);this.jh=(new H("string")).freeze();this.Ho=new H("number");this.dz=!0;this.pz=!1}t.ka("UndoManager",Od);
Od.prototype.toString=function(a){for(var b="UndoManager "+this.pj+"<"+this.history.count+"<="+this.RA,b=b+"[",c=this.bG.count,d=0;d<c;d++)0<d&&(b+=" "),b+=this.bG.wa(d);b+="]";if(void 0!==a&&0<a)for(c=this.history.count,d=0;d<c;d++)b+="\n "+this.history.wa(d).toString(a-1);return b};
Od.prototype.clear=Od.prototype.clear=function(){var a=this.history;a.Ra();for(var b=a.count-1;0<=b;b--){var c=a.wa(b);null!==c&&c.clear()}a.clear();this.ah=-1;a.freeze();this.Ki=!1;this.Qu=null;this.hl=0;this.jh.Ra();this.jh.clear();this.jh.freeze();this.Ho.clear()};Od.prototype.addModel=Od.prototype.VH=function(a){this.vz.add(a)};Od.prototype.removeModel=Od.prototype.fK=function(a){this.vz.remove(a)};
Od.prototype.startTransaction=Od.prototype.yc=function(a){void 0===a&&(a="");null===a&&(a="");if(this.yb)return!1;!0===this.dz&&(this.dz=!1,this.hl++,this.ad("StartingFirstTransaction",a,this.kj),0<this.hl&&this.hl--);this.isEnabled&&(this.jh.Ra(),this.jh.add(a),this.jh.freeze(),null===this.kj?this.Ho.add(0):this.Ho.add(this.kj.nh.count));this.hl++;var b=1===this.Qe;b&&this.ad("StartedTransaction",a,this.kj);return b};Od.prototype.commitTransaction=Od.prototype.Ie=function(a){return Ze(this,!0,a)};
Od.prototype.rollbackTransaction=Od.prototype.$p=function(){return Ze(this,!1,"")};
function Ze(a,b,c){if(a.yb)return!1;a.fA&&1>a.Qe&&t.trace("Ending transaction without having started a transaction: "+c);var d=1===a.Qe;d&&b&&a.isEnabled&&a.ad("CommittingTransaction",c,a.kj);var f=0;if(0<a.Qe&&(a.hl--,a.isEnabled)){var g=a.jh.count;0<g&&(""===c&&(c=a.jh.wa(0)),a.jh.Ra(),a.jh.wd(g-1),a.jh.freeze());g=a.Ho.count;0<g&&(f=a.Ho.wa(g-1),a.Ho.wd(g-1))}g=a.kj;if(d){if(b){a.pz=!1;if(a.isEnabled&&null!==g){b=g;b.Bp=!0;b.name=c;d=a.history;d.Ra();for(f=d.count-1;f>a.pj;f--)g=d.wa(f),null!==
g&&g.clear(),d.wd(f),a.pz=!0;f=a.RA;0===f&&(f=1);0<f&&d.count>=f&&(g=d.wa(0),null!==g&&g.clear(),d.wd(0),a.ah--);d.add(b);a.ah++;d.freeze();g=b}a.ad("CommittedTransaction",c,g)}else{a.Ki=!0;try{a.isEnabled&&null!==g&&(g.Bp=!0,g.undo())}finally{a.ad("RolledBackTransaction",c,g),a.Ki=!1}null!==g&&g.clear()}a.Qu=null;return!0}if(a.isEnabled&&!b&&null!==g){a=f;c=g.nh;for(b=c.count-1;b>=a;b--)d=c.wa(b),null!==d&&d.undo(),c.Ra(),c.wd(b);c.freeze()}return!1}
Od.prototype.canUndo=Od.prototype.canUndo=function(){if(!this.isEnabled||0<this.Qe||this.yb)return!1;var a=this.YG;return null!==a&&a.canUndo()?!0:!1};Od.prototype.undo=Od.prototype.undo=function(){if(this.canUndo()){var a=this.YG;try{this.ad("StartingUndo","Undo",a),this.Ki=!0,this.ah--,a.undo()}catch(b){t.trace("undo error: "+b.toString())}finally{this.Ki=!1,this.ad("FinishedUndo","Undo",a)}}};
Od.prototype.canRedo=Od.prototype.canRedo=function(){if(!this.isEnabled||0<this.Qe||this.yb)return!1;var a=this.XG;return null!==a&&a.canRedo()?!0:!1};Od.prototype.redo=Od.prototype.redo=function(){if(this.canRedo()){var a=this.XG;try{this.ad("StartingRedo","Redo",a),this.Ki=!0,this.ah++,a.redo()}catch(b){t.trace("redo error: "+b.toString())}finally{this.Ki=!1,this.ad("FinishedRedo","Redo",a)}}};
Od.prototype.ad=function(a,b,c){void 0===c&&(c=null);var d=new Cd;d.Bd=Kd;d.propertyName=a;d.object=c;d.oldValue=b;for(a=this.NJ;a.next();)b=a.value,d.ea=b,b.vw(d)};Od.prototype.handleChanged=Od.prototype.oF=function(a){if(this.isEnabled&&!this.yb&&!this.skipsEvent(a)){var b=this.kj;null===b&&(this.Qu=b=new Be);var c=a.copy(),b=b.nh;b.Ra();b.add(c);b.freeze();this.fA&&0>=this.Qe&&!this.dz&&(a=a.h,null!==a&&!1===a.rf||t.trace("Change not within a transaction: "+c.toString()))}};
Od.prototype.skipsEvent=function(a){if(null===a||0>a.Bd.value)return!0;a=a.object;if(a instanceof V){if(a=a.layer,null!==a&&a.Dc)return!0}else if(a instanceof se&&a.Dc)return!0;return!1};t.A(Od,{NJ:"models"},function(){return this.vz.k});t.g(Od,"isEnabled",Od.prototype.isEnabled);t.defineProperty(Od,{isEnabled:"isEnabled"},function(){return this.Re},function(a){this.Re=a});t.A(Od,{YG:"transactionToUndo"},function(){return 0<=this.pj&&this.pj<=this.history.count-1?this.history.wa(this.pj):null});
t.A(Od,{XG:"transactionToRedo"},function(){return this.pj<this.history.count-1?this.history.wa(this.pj+1):null});t.A(Od,{yb:"isUndoingRedoing"},function(){return this.Ki});t.A(Od,{history:"history"},function(){return this.FH});t.g(Od,"maxHistoryLength",Od.prototype.RA);t.defineProperty(Od,{RA:"maxHistoryLength"},function(){return this.aD},function(a){this.aD=a});t.A(Od,{pj:"historyIndex"},function(){return this.ah});t.A(Od,{kj:"currentTransaction"},function(){return this.Qu});
t.A(Od,{Qe:"transactionLevel"},function(){return this.hl});t.A(Od,{DF:"isInTransaction"},function(){return 0<this.hl});t.defineProperty(Od,{fA:"checksTransactionLevel"},function(){return this.By},function(a){this.By=a});t.A(Od,{bG:"nestedTransactionNames"},function(){return this.jh});function Ba(){0<arguments.length&&t.fd(Ba);t.Fc(this);this.W=null;this.kC=this.lC=this.wC=this.mC=!1;this.al=this.xy=null;this.bE=1.05;this.uC=1;this.qz=NaN;this.YC=null;this.cE=NaN}t.ka("CommandHandler",Ba);
Ba.prototype.toString=function(){return"CommandHandler"};t.A(Ba,{h:"diagram"},function(){return this.W});Ba.prototype.Ed=function(a){e&&null!==a&&t.l(a,v,Ba,"setDiagram");this.W=a};
Ba.prototype.doKeyDown=function(){var a=this.h;if(null!==a){var b=a.T,c=t.ln?b.Op:b.control,d=b.shift,f=b.alt,g=b.key;!c||"C"!==g&&"Insert"!==g?c&&"X"===g||d&&"Del"===g?this.canCutSelection()&&this.cutSelection():"Del"===g?this.canDeleteSelection()&&this.deleteSelection():c&&"V"===g||d&&"Insert"===g?this.canPasteSelection()&&this.pasteSelection():c&&"Y"===g||f&&d&&"Backspace"===g?this.canRedo()&&this.redo():c&&"Z"===g||f&&"Backspace"===g?this.canUndo()&&this.undo():c&&"A"===g?this.canSelectAll()&&
this.selectAll():"Esc"===g?this.canStopCommand()&&this.stopCommand():"Up"===g?a.uf&&(c?a.scroll("pixel","up"):a.scroll("line","up")):"Down"===g?a.uf&&(c?a.scroll("pixel","down"):a.scroll("line","down")):"Left"===g?a.tf&&(c?a.scroll("pixel","left"):a.scroll("line","left")):"Right"===g?a.tf&&(c?a.scroll("pixel","right"):a.scroll("line","right")):"PageUp"===g?d&&a.tf?a.scroll("page","left"):a.uf&&a.scroll("page","up"):"PageDown"===g?d&&a.tf?a.scroll("page","right"):a.uf&&a.scroll("page","down"):"Home"===
g?(b=a.Lc,c&&a.uf?a.position=new E(a.position.x,b.y):!c&&a.tf&&(a.position=new E(b.x,a.position.y))):"End"===g?(b=a.Lc,d=a.Ab,c&&a.uf?a.position=new E(d.x,b.bottom-d.height):!c&&a.tf&&(a.position=new E(b.right-d.width,d.y))):"Subtract"===g?this.canDecreaseZoom()&&this.decreaseZoom():"Add"===g?this.canIncreaseZoom()&&this.increaseZoom():c&&"0"===g?this.canResetZoom()&&this.resetZoom():d&&"Z"===g?this.canZoomToFit()&&this.zoomToFit():c&&!d&&"G"===g?this.canGroupSelection()&&this.groupSelection():c&&
d&&"G"===g?this.canUngroupSelection()&&this.ungroupSelection():b.event&&113===b.event.which?this.canEditTextBlock()&&this.editTextBlock():b.event&&93===b.event.which?this.canShowContextMenu()&&this.showContextMenu():b.bubbles=!0:this.canCopySelection()&&this.copySelection()}};Ba.prototype.doKeyUp=function(){var a=this.h;null!==a&&(a.T.bubbles=!0)};Ba.prototype.stopCommand=function(){var a=this.h;if(null!==a){var b=a.Ya;b instanceof $e&&a.Ve&&a.xw();null!==b&&b.doCancel()}};
Ba.prototype.canStopCommand=function(){return!0};Ba.prototype.selectAll=function(){var a=this.h;if(null!==a){a.na();try{a.gc="wait";a.Ga("ChangingSelection");for(var b=a.vj;b.next();)b.value.ib=!0;for(b=a.vh;b.next();)b.value.ib=!0;for(b=a.links;b.next();)b.value.ib=!0}finally{a.Ga("ChangedSelection"),a.gc=""}}};Ba.prototype.canSelectAll=function(){var a=this.h;return null!==a&&a.Ve};
Ba.prototype.deleteSelection=function(){var a=this.h;if(null!==a&&!a.Ga("SelectionDeleting",a.selection))try{a.gc="wait";a.yc("Delete");a.Ga("ChangingSelection");for(var b=new I(x),c=a.selection.k;c.next();)af(b,c.value,!0,this.QE?Infinity:0,function(a){return a.canDelete()});a.mB(b,!0);a.Ga("SelectionDeleted",b)}finally{a.Ga("ChangedSelection"),a.Ie("Delete"),a.gc=""}};Ba.prototype.canDeleteSelection=function(){var a=this.h;return null===a||a.hb||a.ef||!a.ll||0===a.selection.count?!1:!0};
function af(a,b,c,d,f){if(!(a.contains(b)||(void 0===f&&(f=null),null!==f&&!f(b)||b instanceof ea)))if(a.add(b),b instanceof y){if(c&&b instanceof z)for(var g=b.Vc;g.next();){var h=g.value;af(a,h,c,d,f)}for(h=b.Td;h.next();)if(g=h.value,!a.contains(g)){var k=g.ca,l=g.fa;null!==k&&a.contains(k)&&null!==l&&a.contains(l)?af(a,g,c,d,f):null!==k&&null!==l||af(a,g,c,d,f)}if(1<d)for(b=b.cF();b.next();)h=b.value,af(a,h,c,d-1,f)}else if(b instanceof B)for(h=b.sj;h.next();)af(a,h.value,c,d,f)}
Ba.prototype.Zm=function(a,b,c){var d=new wa(x,x);for(a=a.k;a.next();){var f=a.value;bf(this,f,b,d,c)}if(null!==b){c=b.ea;a=!1;null!==b.Cb.Od&&(a=b.Cb.Od.ki);for(var g=new I(B),h=new wa(B,B),k=d.k;k.next();)if(f=k.value,f instanceof B)a||null!==f.ca&&null!==f.fa||g.add(f);else if(c instanceof ce&&f instanceof y&&null!==f.data){var l=f,f=k.key,m=f.uA();null!==m&&((m=d.Da(m))?(c.xh(l.data,c.Lb(m.data)),l=b.Vf(l.data),f=f.tt(),null!==f&&null!==l&&h.add(f,l)):c.xh(l.data,void 0))}0<g.count&&b.mB(g,!1);
if(0<h.count)for(b=h.k;b.next();)d.add(b.key,b.value)}for(b=d.k;b.next();)b.value.Vb();return d};
function bf(a,b,c,d,f){if(null===b||f&&!b.canCopy())return null;if(d.contains(b))return a=d.Da(b),a instanceof x?a:null;var g=null,h=b.data;if(null!==h&&null!==c){var k=c.ea;b instanceof B?k instanceof T&&(h=k.EE(h),t.xb(h)&&(k.nw(h),g=c.Vf(h))):(h=k.copyNodeData(h),t.xb(h)&&(k.Om(h),g=c.qh(h)))}else cf(b),g=b.copy(),null!==c&&g instanceof x&&c.add(g);if(!(g instanceof x))return null;g.ib=!1;g.Fg=!1;d.add(b,g);if(b instanceof y){for(k=b.Td;k.next();){h=k.value;if(h.ca===b){var l=d.Da(h);null!==l&&
(l.ca=g)}h.fa===b&&(l=d.Da(h),null!==l&&(l.fa=g))}if(b instanceof z&&g instanceof z)for(b=b.Vc;b.next();)k=bf(a,b.value,c,d,f),k instanceof B||null===k||(k.fb=g)}else if(b instanceof B)for(k=b.ca,null!==k&&(k=d.Da(k),null!==k&&(g.ca=k)),k=b.fa,null!==k&&(k=d.Da(k),null!==k&&(g.fa=k)),b=b.sj;b.next();)k=bf(a,b.value,c,d,f),null!==k&&(k.Dd=g);return g}
Ba.prototype.copySelection=function(){var a=this.h;if(null!==a){for(var b=new I(x),a=a.selection.k;a.next();)af(b,a.value,!0,this.DE?Infinity:0,function(a){return a.canCopy()});this.copyToClipboard(b)}};Ba.prototype.canCopySelection=function(){var a=this.h;return null!==a&&a.dj&&a.rw&&0!==a.selection.count?!0:!1};Ba.prototype.cutSelection=function(){this.copySelection();this.deleteSelection()};
Ba.prototype.canCutSelection=function(){var a=this.h;return null!==a&&!a.hb&&!a.ef&&a.dj&&a.ll&&a.rw&&0!==a.selection.count?!0:!1};Ba.prototype.copyToClipboard=function(a){var b=this.h;if(null!==b){var c=null;if(null===a)t.gt=null,t.yw="";else{var c=b.ea,d=!1,f=!1,g=null;try{c instanceof ce&&(d=c.ol,c.ol=this.kA),c instanceof T&&(f=c.nl,c.nl=this.jA),g=b.Zm(a,null,!0)}finally{c instanceof ce&&(c.ol=d),c instanceof T&&(c.nl=f),c=new H(x),c.Ue(g),t.gt=c,t.yw=b.ea.bn}}b.Ga("ClipboardChanged",c)}};
Ba.prototype.pasteFromClipboard=function(){var a=new I(x),b=t.gt;if(null===b)return a;var c=this.h;if(null===c||t.yw!==c.ea.bn)return a;var d=c.ea,f=!1,g=!1,h=null;try{d instanceof ce&&(f=d.ol,d.ol=this.kA),d instanceof T&&(g=d.nl,d.nl=this.jA),h=c.Zm(b,c,!1)}finally{for(d instanceof ce&&(d.ol=f),d instanceof T&&(d.nl=g),b=h.k;b.next();)c=b.value,d=b.key,c.location.P()||(d.location.P()?c.location=d.location:!c.position.P()&&d.position.P()&&(c.position=d.position)),a.add(c)}return a};
Ba.prototype.pasteSelection=function(a){var b=this.h;if(null!==b)try{b.gc="wait";b.yc("Paste");b.Ga("ChangingSelection");var c=this.pasteFromClipboard();0<c.count&&df(b);for(var d=c.k;d.next();)d.value.ib=!0;b.Ga("ChangedSelection");if(a instanceof E){var f=b.computePartsBounds(b.selection);if(f){var g=b.Cb.Od,h=g.computeEffectiveCollection(b.selection);g.moveParts(h,new E(a.x-f.Ia,a.y-f.Ua),!1)}}b.Ga("ClipboardPasted",c)}finally{b.Ie("Paste"),b.gc=""}};
Ba.prototype.canPasteSelection=function(){var a=this.h;return null===a||a.hb||a.ef||!a.Pm||!a.rw||null===t.gt||t.yw!==a.ea.bn?!1:!0};Ba.prototype.undo=function(){var a=this.h;null!==a&&a.ma.undo()};Ba.prototype.canUndo=function(){var a=this.h;return null===a||a.hb||a.ef?!1:a.Zz&&a.ma.canUndo()};Ba.prototype.redo=function(){var a=this.h;null!==a&&a.ma.redo()};Ba.prototype.canRedo=function(){var a=this.h;return null===a||a.hb||a.ef?!1:a.Zz&&a.ma.canRedo()};
Ba.prototype.decreaseZoom=function(a){void 0===a&&(a=1/this.qu);t.q(a,Ba,"decreaseZoom:factor");var b=this.h;null!==b&&b.Tm===ef&&(a*=b.scale,a<b.Jg||a>b.Hg||(b.scale=a))};Ba.prototype.canDecreaseZoom=function(a){void 0===a&&(a=1/this.qu);t.q(a,Ba,"canDecreaseZoom:factor");var b=this.h;if(null===b||b.Tm!==ef)return!1;a*=b.scale;return a<b.Jg||a>b.Hg?!1:b.bt};
Ba.prototype.increaseZoom=function(a){void 0===a&&(a=this.qu);t.q(a,Ba,"increaseZoom:factor");var b=this.h;null!==b&&b.Tm===ef&&(a*=b.scale,a<b.Jg||a>b.Hg||(b.scale=a))};Ba.prototype.canIncreaseZoom=function(a){void 0===a&&(a=this.qu);t.q(a,Ba,"canIncreaseZoom:factor");var b=this.h;if(null===b||b.Tm!==ef)return!1;a*=b.scale;return a<b.Jg||a>b.Hg?!1:b.bt};Ba.prototype.resetZoom=function(a){void 0===a&&(a=this.mt);t.q(a,Ba,"resetZoom:newscale");var b=this.h;null===b||a<b.Jg||a>b.Hg||(b.scale=a)};
Ba.prototype.canResetZoom=function(a){void 0===a&&(a=this.mt);t.q(a,Ba,"canResetZoom:newscale");var b=this.h;return null===b||a<b.Jg||a>b.Hg?!1:b.bt};Ba.prototype.zoomToFit=function(){var a=this.h;if(null!==a){var b=a.scale,c=a.position;b!==this.cE||isNaN(this.qz)?(this.qz=b,this.YC=c.copy(),a.zoomToFit(),a.Ig(),this.cE=a.scale):(a.scale=this.qz,a.position=this.YC)}};Ba.prototype.canZoomToFit=function(){var a=this.h;return null===a?!1:a.bt};
Ba.prototype.collapseTree=function(a){void 0===a&&(a=null);var b=this.h;if(null===b)return!1;b.yc("Collapse Tree");var c=new H(y);if(a instanceof y&&a.Uc)a.collapseTree(),c.add(a);else for(a=b.selection.k;a.next();){var d=a.value;d instanceof y&&d.Uc&&(d.collapseTree(),c.add(d))}b.Ga("TreeCollapsed",c);b.Ie("Collapse Tree")};
Ba.prototype.canCollapseTree=function(a){void 0===a&&(a=null);var b=this.h;if(null===b||b.hb)return!1;if(a instanceof y){if(!a.Uc)return!1;if(0<a.Tw().count)return!0}else for(a=b.selection.k;a.next();)if(b=a.value,b instanceof y&&b.Uc&&0<b.Tw().count)return!0;return!1};
Ba.prototype.expandTree=function(a){void 0===a&&(a=null);var b=this.h;if(null===b)return!1;b.yc("Expand Tree");var c=new H(y);if(a instanceof y&&!a.Uc)a.expandTree(),c.add(a);else for(a=b.selection.k;a.next();){var d=a.value;d instanceof y&&!d.Uc&&(d.expandTree(),c.add(d))}b.Ga("TreeExpanded",c);b.Ie("Expand Tree")};
Ba.prototype.canExpandTree=function(a){void 0===a&&(a=null);var b=this.h;if(null===b||b.hb)return!1;if(a instanceof y){if(a.Uc)return!1;if(0<a.Tw().count)return!0}else for(a=b.selection.k;a.next();)if(b=a.value,b instanceof y&&!b.Uc&&0<b.Tw().count)return!0;return!1};
Ba.prototype.groupSelection=function(){var a=this.h;if(null!==a){var b=a.ea;if(null!==b&&b instanceof T){var c=this.aA;if(null!==c){var d=null;try{a.gc="wait";a.yc("Group");a.Ga("ChangingSelection");for(var f=new H(x),g=a.selection.k;g.next();){var h=g.value;h.Rd()&&h.canGroup()&&f.add(h)}for(var k=new H(x),l=f.k;l.next();){for(var m=l.value,h=!1,g=f.k;g.next();)if(m.Al(g.value)){h=!0;break}h||k.add(m)}if(0<k.count){g=k.k;g.next();var n=g.value.fb;if(null!==n)for(;null!==n;){g=k.k;g.next();for(f=
!1;g.next();)if(m=g.value,!m.Al(n)){f=!0;break}if(f)n=n.fb;else break}if(c instanceof z)cf(c),d=c.copy(),d instanceof z&&a.add(d);else if(b.KA(c)){var p=b.copyNodeData(c);t.xb(p)&&(b.Om(p),d=a.Sw(p))}if(d instanceof z){null!==n&&this.isValidMember(n,d)&&(d.fb=n);for(g=k.k;g.next();)m=g.value,this.isValidMember(d,m)&&(m.fb=d);a.select(d)}}a.Ga("ChangedSelection");a.Ga("SelectionGrouped",d)}finally{a.Ie("Group"),a.gc=""}}}}};
Ba.prototype.canGroupSelection=function(){var a=this.h;if(null===a||a.hb||a.ef||!a.Pm||!a.Zo)return!1;var b=a.ea;if(null===b||!(b instanceof T)||null===this.aA)return!1;for(a=a.selection.k;a.next();)if(b=a.value,b.Rd()&&b.canGroup())return!0;return!1};function ff(a){var b=t.Hb();for(a=a.k;a.next();){var c=a.value;c instanceof B||b.push(c)}a=new I(x);for(var c=b.length,d=0;d<c;d++){for(var f=b[d],g=!0,h=0;h<c;h++)if(f.Al(b[h])){g=!1;break}g&&a.add(f)}t.Ca(b);return a}
Ba.prototype.isValidMember=function(a,b){if(null===b||a===b||b instanceof B)return!1;if(null!==a){if(a===b||a.Al(b))return!1;var c=a.Lt;if(null!==c&&!c(a,b)||null===a.data&&null!==b.data||null!==a.data&&null===b.data)return!1}c=this.Lt;return null!==c?c(a,b):!0};
Ba.prototype.ungroupSelection=function(a){void 0===a&&(a=null);var b=this.h;if(null!==b){var c=b.ea;if(null!==c&&c instanceof T)try{b.gc="wait";b.yc("Ungroup");b.Ga("ChangingSelection");var d=new H(z);if(a instanceof z)d.add(a);else for(var f=b.selection.k;f.next();){var g=f.value;g instanceof z&&g.canUngroup()&&d.add(g)}if(0<d.count)for(b.xw(),f=d.k;f.next();){var h=f.value,k=h.data,l=h.fb,m=null!==l&&null!==l.data?c.Lb(l.data):void 0,n=new H(x);n.Ue(h.Vc);for(var p=n.k;p.next();){var q=p.value;
if(!(q instanceof B)){var r=q.data;null!==r?c.Ix(r,m):q.fb=l;q.ib=!0}}null!==k?c.Bx(k):b.remove(h)}b.Ga("ChangedSelection");b.Ga("SelectionUngrouped",d,n)}finally{b.Ie("Ungroup"),b.gc=""}}};
Ba.prototype.canUngroupSelection=function(a){void 0===a&&(a=null);var b=this.h;if(null===b||b.hb||b.ef||!b.ll||!b.dp)return!1;var c=b.ea;if(null===c||!(c instanceof T))return!1;if(a instanceof z){if(a.canUngroup())return!0}else for(a=b.selection.k;a.next();)if(b=a.value,b instanceof z&&b.canUngroup())return!0;return!1};Ba.prototype.addTopLevelParts=function(a,b){for(var c=!0,d=ff(a).k;d.next();){var f=d.value;null!==f.fb&&(!b||this.isValidMember(null,f)?f.fb=null:c=!1)}return c};
Ba.prototype.collapseSubGraph=function(a){void 0===a&&(a=null);var b=this.h;if(null===b)return!1;b.yc("Collapse SubGraph");var c=new H(z);if(a instanceof z&&a.xe)a.collapseSubGraph(),c.add(a);else for(a=b.selection.k;a.next();){var d=a.value;d instanceof z&&d.xe&&(d.collapseSubGraph(),c.add(d))}b.Ga("SubGraphCollapsed",c);b.Ie("Collapse SubGraph")};
Ba.prototype.canCollapseSubGraph=function(a){void 0===a&&(a=null);var b=this.h;if(null===b||b.hb)return!1;if(a instanceof z)return a.xe?!0:!1;for(a=b.selection.k;a.next();)if(b=a.value,b instanceof z&&b.xe)return!0;return!1};
Ba.prototype.expandSubGraph=function(a){void 0===a&&(a=null);var b=this.h;if(null===b)return!1;b.yc("Expand SubGraph");var c=new H(z);if(a instanceof z&&!a.xe)a.expandSubGraph(),c.add(a);else for(a=b.selection.k;a.next();){var d=a.value;d instanceof z&&!d.xe&&(d.expandSubGraph(),c.add(d))}b.Ga("SubGraphExpanded",c);b.Ie("Expand SubGraph")};
Ba.prototype.canExpandSubGraph=function(a){void 0===a&&(a=null);var b=this.h;if(null===b||b.hb)return!1;if(a instanceof z)return a.xe?!1:!0;for(a=b.selection.k;a.next();)if(b=a.value,b instanceof z&&!b.xe)return!0;return!1};
Ba.prototype.editTextBlock=function(a){void 0===a&&(a=null);var b=this.h;if(null!==b){var c=b.Cb.Ox;if(null!==c){if(null===a){a=b.selection.k;for(var d=null;a.next();){var f=a.value;if(f.canEdit()){d=f;break}}if(null===d)return;a=d.qt(function(a){return a instanceof za&&a.Mw})}null!==a&&a instanceof za&&(c.Ug=a,b.Ya=c)}}};
Ba.prototype.canEditTextBlock=function(a){void 0===a&&(a=null);var b=this.h;if(null===b||b.hb||b.ef||!b.cp||null===b.Cb.Ox)return!1;if(a instanceof za){if(a=a.U,null!==a&&a.canEdit())return!0}else for(b=b.selection.k;b.next();)if(a=b.value,a.canEdit()&&(a=a.qt(function(a){return a instanceof za&&a.Mw}),null!==a))return!0;return!1};
Ba.prototype.showContextMenu=function(a){var b=this.h;if(null!==b){var c=b.Cb.Dw;if(null!==c&&(void 0===a&&(a=0<b.selection.count?b.selection.gb():b),a=c.findObjectWithContextMenu(a),null!==a)){var d=new Ad,f=null;a instanceof V?f=a.wb(Yb):b.uo||(f=b.Ab,f=new E(f.x+f.width/2,f.y+f.height/2));null!==f&&(d.Wd=b.JB(f),d.da=f,b.dc=d);b.Ya=c;gf(c,!1,a)}}};
Ba.prototype.canShowContextMenu=function(a){var b=this.h;if(null===b)return!1;var c=b.Cb.Dw;if(null===c)return!1;void 0===a&&(a=0<b.selection.count?b.selection.gb():b);return null===c.findObjectWithContextMenu(a)?!1:!0};t.g(Ba,"copiesTree",Ba.prototype.DE);t.defineProperty(Ba,{DE:"copiesTree"},function(){return this.mC},function(a){t.i(a,"boolean",Ba,"copiesTree");this.mC=a});t.g(Ba,"deletesTree",Ba.prototype.QE);
t.defineProperty(Ba,{QE:"deletesTree"},function(){return this.wC},function(a){t.i(a,"boolean",Ba,"deletesTree");this.wC=a});t.g(Ba,"copiesParentKey",Ba.prototype.kA);t.defineProperty(Ba,{kA:"copiesParentKey"},function(){return this.lC},function(a){t.i(a,"boolean",Ba,"copiesParentKey");this.lC=a});t.g(Ba,"copiesGroupKey",Ba.prototype.jA);t.defineProperty(Ba,{jA:"copiesGroupKey"},function(){return this.kC},function(a){t.i(a,"boolean",Ba,"copiesGroupKey");this.kC=a});t.g(Ba,"archetypeGroupData",Ba.prototype.aA);
t.defineProperty(Ba,{aA:"archetypeGroupData"},function(){return this.xy},function(a){null!==a&&t.l(a,Object,Ba,"archetypeGroupData");var b=this.h;null!==b&&(b=b.ea,b instanceof T&&(a instanceof z||b.KA(a)||t.m("CommandHandler.archetypeGroupData must be either a Group or a data object for which GraphLinksModel.isGroupForNodeData is true: "+a)));this.xy=a});t.g(Ba,"memberValidation",Ba.prototype.Lt);
t.defineProperty(Ba,{Lt:"memberValidation"},function(){return this.al},function(a){null!==a&&t.i(a,"function",Ba,"memberValidation");this.al=a});t.g(Ba,"defaultScale",Ba.prototype.mt);t.defineProperty(Ba,{mt:"defaultScale"},function(){return this.uC},function(a){t.q(a,Ba,"defaultScale");0<a||t.m("defaultScale must be larger than zero, not: "+a);this.uC=a});t.g(Ba,"zoomFactor",Ba.prototype.qu);
t.defineProperty(Ba,{qu:"zoomFactor"},function(){return this.bE},function(a){t.q(a,Ba,"zoomFactor");1<a||t.m("zoomFactor must be larger than 1.0, not: "+a);this.bE=a});function ze(){0<arguments.length&&t.fd(ze);t.Fc(this);this.W=null;this.ec="";this.Re=!0;this.KC=!1;this.YD=null;this.lw=-1}t.ka("Tool",ze);ze.prototype.Ed=function(a){e&&null!==a&&t.l(a,v,ze,"setDiagram");this.W=a};ze.prototype.toString=function(){return""!==this.name?this.name+" Tool":t.Dg(Object.getPrototypeOf(this))};
ze.prototype.updateAdornments=function(){};ze.prototype.canStart=function(){return this.isEnabled};ze.prototype.doStart=function(){};ze.prototype.doActivate=function(){this.la=!0};ze.prototype.doDeactivate=function(){this.la=!1};ze.prototype.doStop=function(){};ze.prototype.doCancel=function(){this.stopTool()};ze.prototype.stopTool=function(){var a=this.h;null!==a&&a.Ya===this&&(a.Ya=null,a.gc="")};ze.prototype.doMouseDown=function(){!this.la&&this.canStart()&&this.doActivate()};
ze.prototype.doMouseMove=function(){};ze.prototype.doMouseUp=function(){this.stopTool()};ze.prototype.doMouseWheel=function(){};ze.prototype.doKeyDown=function(){var a=this.h;null!==a&&"Esc"===a.T.key&&this.doCancel()};ze.prototype.doKeyUp=function(){};ze.prototype.startTransaction=ze.prototype.yc=function(a){this.mf=null;var b=this.h;return null===b?!1:b.yc(a)};ze.prototype.stopTransaction=ze.prototype.vk=function(){var a=this.h;return null===a?!1:null===this.mf?a.$p():a.Ie(this.mf)};
ze.prototype.standardMouseSelect=function(){var a=this.h;if(null!==a&&a.Ve){var b=a.T,c=a.st(b.da,!1);if(null!==c)if(t.ln?b.Op:b.control){a.Ga("ChangingSelection");for(b=c;null!==b&&!b.canSelect();)b=b.fb;null!==b&&(b.ib=!b.ib);a.Ga("ChangedSelection")}else if(b.shift){if(!c.ib){a.Ga("ChangingSelection");for(b=c;null!==b&&!b.canSelect();)b=b.fb;null!==b&&(b.ib=!0);a.Ga("ChangedSelection")}}else{if(!c.ib){for(b=c;null!==b&&!b.canSelect();)b=b.fb;null!==b&&a.select(b)}}else!b.left||(t.ln?b.Op:b.control)||
b.shift||a.xw()}};ze.prototype.standardMouseClick=function(a,b){void 0===a&&(a=null);void 0===b&&(b=function(a){return!a.layer.Dc});var c=this.h;if(null!==c){var d=c.T,f=c.de(d.da,a,b);d.ke=f;hf(f,d,c)}};
function hf(a,b,c){var d=0;b.left?d=1===b.Ge?1:2===b.Ge?2:1:b.right&&1===b.Ge&&(d=3);var f="";if(null!==a){switch(d){case 1:f="ObjectSingleClicked";break;case 2:f="ObjectDoubleClicked";break;case 3:f="ObjectContextClicked"}0!==d&&c.Ga(f,a)}else{switch(d){case 1:f="BackgroundSingleClicked";break;case 2:f="BackgroundDoubleClicked";break;case 3:f="BackgroundContextClicked"}0!==d&&c.Ga(f)}if(null!==a)for(;null!==a;){f=null;switch(d){case 1:f=a.click;break;case 2:f=a.dn?a.dn:a.click;break;case 3:f=a.jt}if(null!==
f&&(f(b,a),b.Ke))break;a=a.ia}else{f=null;switch(d){case 1:f=c.click;break;case 2:f=c.dn?c.dn:c.click;break;case 3:f=c.jt}null!==f&&f(b)}}
ze.prototype.standardMouseOver=function(){var a=this.h;if(null!==a){var b=a.T;if(null!==b.h&&!0!==a.mc.zd){var c=a.ab;a.ab=!0;var d=a.de(b.da,null,null);b.ke=d;var f=!1;if(d!==a.Sn){var g=a.Sn,h=g;a.Sn=d;for(this.doCurrentObjectChanged(g,d);null!==g;){var k=g.VA;if(null!==k){if(d===g)break;if(null!==d&&d.rj(g))break;k(b,g,d);f=!0;if(b.Ke)break}g=g.ia}for(g=h;null!==d;){k=d.UA;if(null!==k){if(g===d)break;if(null!==g&&g.rj(d))break;k(b,d,g);f=!0;if(b.Ke)break}d=d.ia}d=a.Sn}if(null!==d){g=d;for(k="";null!==
g;){k=g.cursor;if(""!==k)break;g=g.ia}a.gc=k;for(g=d;null!==g;){k=g.Pt;if(null!==k&&(k(b,g),f=!0,b.Ke))break;g=g.ia}}else a.gc="",k=a.Pt,null!==k&&(k(b),f=!0);f&&a.ie();a.ab=c}}};ze.prototype.doCurrentObjectChanged=function(){};
ze.prototype.standardMouseWheel=function(){var a=this.h;if(null!==a){var b=a.T,c=b.mk;if(0!==c&&a.Lc.P()){var d=a.Ye,f=a.Cb.un;if((f===jf&&!b.shift||f===kf&&b.control)&&(0<c?d.canIncreaseZoom():d.canDecreaseZoom()))f=a.eg,a.eg=b.Wd,0<c?d.increaseZoom():d.decreaseZoom(),a.eg=f,b.bubbles=!1;else if(f===jf&&b.shift||f===kf&&!b.control){d=a.position.copy();f=0<c?c:-c;if(!b.shift&&a.uf){var g=a.dq,f=f/40*g;0<c?a.scroll("pixel","up",f):a.scroll("pixel","down",f)}else b.shift&&a.tf&&(g=a.cq,f=f/40*g,0<c?
a.scroll("pixel","left",f):a.scroll("pixel","right",f));a.position.O(d)||(b.bubbles=!1)}}}};ze.prototype.standardWaitAfter=function(a){t.i(a,"number",ze,"standardWaitAfter:delay");this.cancelWaitAfter();var b=this;this.lw=window.setTimeout(function(){b.doWaitAfter()},a)};ze.prototype.cancelWaitAfter=function(){-1!==this.lw&&window.clearTimeout(this.lw);this.lw=-1};ze.prototype.doWaitAfter=function(){};
ze.prototype.findToolHandleAt=function(a,b){var c=this.h;if(null===c)return null;c=c.de(a,null,function(a){a=a.U;return null===a?!1:null!==a.uc});if(null===c)return null;var d=c.U;return null===d||d.cd!==b?null:c};ze.prototype.isBeyondDragSize=function(a,b){var c=this.h;if(null===c)return!1;void 0===a&&(a=c.Rc.Wd);void 0===b&&(b=c.T.Wd);var d=c.Cb.SE,c=d.width,d=d.height;t.CB&&(c+=6,d+=6);return Math.abs(b.x-a.x)>c||Math.abs(b.y-a.y)>d};t.A(ze,{h:"diagram"},function(){return this.W});
t.g(ze,"name",ze.prototype.name);t.defineProperty(ze,{name:"name"},function(){return this.ec},function(a){t.i(a,"string",ze,"name");this.ec=a});t.g(ze,"isEnabled",ze.prototype.isEnabled);t.defineProperty(ze,{isEnabled:"isEnabled"},function(){return this.Re},function(a){t.i(a,"boolean",ze,"isEnabled");this.Re=a});t.g(ze,"isActive",ze.prototype.la);t.defineProperty(ze,{la:"isActive"},function(){return this.KC},function(a){t.i(a,"boolean",ze,"isActive");this.KC=a});t.g(ze,"transactionResult",ze.prototype.mf);
t.defineProperty(ze,{mf:"transactionResult"},function(){return this.YD},function(a){null!==a&&t.i(a,"string",ze,"transactionResult");this.YD=a});
function lf(){0<arguments.length&&t.fd(lf);ze.call(this);this.name="Dragging";this.jC=this.OC=!0;this.jr=this.BC=!1;this.SC=!0;this.fz=(new ra(NaN,NaN)).freeze();this.gz=Vb;this.hz=(new E(NaN,NaN)).freeze();this.AC=!1;this.yC=this.iC=this.zC=this.pC=this.Wi=null;this.Wq=this.QC=!1;this.Qo=new E(NaN,NaN);this.$v=new E;this.Is=!1;this.Yv=this.NC=!0;this.bo=100;this.Yl=this.Ov=null}t.ka("DraggingTool",lf);t.Qa(lf,ze);t.g(lf,"isCopyEnabled",lf.prototype.IA);
t.defineProperty(lf,{IA:"isCopyEnabled"},function(){return this.OC},function(a){t.i(a,"boolean",lf,"isCopyEnabled");this.OC=a});t.g(lf,"copiesEffectiveCollection",lf.prototype.CE);t.defineProperty(lf,{CE:"copiesEffectiveCollection"},function(){return this.jC},function(a){t.i(a,"boolean",lf,"copiesEffectiveCollection");this.jC=a});t.g(lf,"dragsTree",lf.prototype.TE);t.defineProperty(lf,{TE:"dragsTree"},function(){return this.BC},function(a){t.i(a,"boolean",lf,"dragsTree");this.BC=a});
t.g(lf,"isGridSnapEnabled",lf.prototype.Dp);t.defineProperty(lf,{Dp:"isGridSnapEnabled"},function(){return this.jr},function(a){t.i(a,"boolean",lf,"isGridSnapEnabled");this.jr=a});t.g(lf,"isComplexRoutingRealtime",lf.prototype.AF);t.defineProperty(lf,{AF:"isComplexRoutingRealtime"},function(){return this.NC},function(a){t.i(a,"boolean",lf,"isComplexRoutingRealtime");this.NC=a});t.g(lf,"isGridSnapRealtime",lf.prototype.CF);
t.defineProperty(lf,{CF:"isGridSnapRealtime"},function(){return this.SC},function(a){t.i(a,"boolean",lf,"isGridSnapRealtime");this.SC=a});t.g(lf,"gridSnapCellSize",lf.prototype.CA);t.defineProperty(lf,{CA:"gridSnapCellSize"},function(){return this.fz},function(a){t.l(a,ra,lf,"gridSnapCellSize");this.fz.O(a)||(this.fz=a=a.ba())});t.g(lf,"gridSnapCellSpot",lf.prototype.lF);
t.defineProperty(lf,{lF:"gridSnapCellSpot"},function(){return this.gz},function(a){t.l(a,L,lf,"gridSnapCellSpot");this.gz.O(a)||(this.gz=a=a.ba())});t.g(lf,"gridSnapOrigin",lf.prototype.mF);t.defineProperty(lf,{mF:"gridSnapOrigin"},function(){return this.hz},function(a){t.l(a,E,lf,"gridSnapOrigin");this.hz.O(a)||(this.hz=a=a.ba())});t.g(lf,"dragsLink",lf.prototype.ki);t.defineProperty(lf,{ki:"dragsLink"},function(){return this.AC},function(a){t.i(a,"boolean",lf,"dragsLink");this.AC=a});
t.g(lf,"currentPart",lf.prototype.jp);t.defineProperty(lf,{jp:"currentPart"},function(){return this.pC},function(a){null!==a&&t.l(a,x,lf,"currentPart");this.pC=a});t.g(lf,"copiedParts",lf.prototype.rd);t.defineProperty(lf,{rd:"copiedParts"},function(){return this.iC},function(a){this.iC=a});t.g(lf,"draggedParts",lf.prototype.Hc);t.defineProperty(lf,{Hc:"draggedParts"},function(){return this.zC},function(a){this.zC=a});t.g(lf,"draggedLink",lf.prototype.Qc);
t.defineProperty(lf,{Qc:"draggedLink"},function(){return this.yC},function(a){null!==a&&t.l(a,B,lf,"draggedLink");this.yC=a});t.g(lf,"isDragOutStarted",lf.prototype.Dt);t.defineProperty(lf,{Dt:"isDragOutStarted"},function(){return this.QC},function(a){this.QC=a});t.g(lf,"startPoint",lf.prototype.wj);t.defineProperty(lf,{wj:"startPoint"},function(){return this.$v},function(a){t.l(a,E,lf,"startPoint");this.$v.O(a)||(this.$v=a=a.ba())});t.g(lf,"delay",lf.prototype.Jw);
t.defineProperty(lf,{Jw:"delay"},function(){return this.bo},function(a){t.i(a,"number",lf,"delay");this.bo=a});lf.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;if(null===a||!a.fk&&!a.dj&&!a.at||!a.Ve)return!1;var b=a.T;return!b.left||a.Ya!==this&&(!this.isBeyondDragSize()||b.lx&&b.timestamp-a.Rc.timestamp<this.bo)?!1:null!==this.findDraggablePart()};
lf.prototype.findDraggablePart=function(){var a=this.h;if(null===a)return null;a=a.st(a.Rc.da,!1);if(null===a)return null;for(;null!==a&&!a.canSelect();)a=a.fb;return null!==a&&(a.canMove()||a.canCopy())?a:null};lf.prototype.standardMouseSelect=function(){var a=this.h;if(null!==a&&a.Ve){var b=a.st(a.Rc.da,!1);if(null!==b){for(;null!==b&&!b.canSelect();)b=b.fb;this.jp=b;this.jp.ib||(a.Ga("ChangingSelection"),b=a.T,(t.ln?b.Op:b.control)||b.shift||df(a),this.jp.ib=!0,a.Ga("ChangedSelection"))}}};
lf.prototype.doActivate=function(){var a=this.h;if(null!==a){this.standardMouseSelect();var b=this.jp;null!==b&&(b.canMove()||b.canCopy())&&(this.la=!0,this.Qo.set(a.position),uf(this,a.selection),this.Yl=this.Ov=null,this.Hc=this.computeEffectiveCollection(a.selection),a.Oo=!0,vf(this,this.Hc),this.yc("Drag"),this.wj=a.Rc.da,a.Qd=!0,a.at&&(this.Dt=!0,this.Wq=!1,wf=this,xf=this.h,this.doSimulatedDragOut()))}};
function uf(a,b){if(a.ki){var c=a.h;null!==c&&c.gk&&(c.ea instanceof T&&1===b.count&&b.gb()instanceof B?(a.Qc=b.gb(),a.Qc.canRelinkFrom()&&a.Qc.canRelinkTo()&&a.Qc.Uf(),a.Wi=c.Cb.jB,null===a.Wi&&(a.Wi=new yf,a.Wi.h=c)):(a.Qc=null,a.Wi=null))}}
lf.prototype.computeEffectiveCollection=function(a){var b=null!==this.h&&this.h.Ya===this,c=new wa(x,Object);if(null===a)return c;for(var d=a.k;d.next();){var f=d.value;zf(this,c,f,b)}if(null!==this.Qc&&this.ki)return c;for(d=a.k;d.next();)f=d.value,f instanceof B&&(a=f,b=a.ca,null===b||c.contains(b)?(b=a.fa,null===b||c.contains(b)||c.remove(a)):c.remove(a));return c};function Af(a){return void 0===a?{point:K.Aj,Gz:K.Aj}:{point:a.copy(),Gz:K.Aj}}
function zf(a,b,c,d){if(!b.contains(c)&&(!d||c.canMove()||c.canCopy()))if(c instanceof y){b.add(c,Af(c.location));if(c instanceof z)for(var f=c.Vc;f.next();){var g=f.value;zf(a,b,g,d)}for(g=c.Td;g.next();)if(f=g.value,!b.contains(f)){var h=f.ca,k=f.fa;null!==h&&b.contains(h)&&null!==k&&b.contains(k)&&zf(a,b,f,d)}if(a.TE)for(c=c.cF();c.next();)g=c.value,zf(a,b,g,d)}else if(c instanceof B)for(f=c,b.add(f,Af()),g=f.sj;g.next();)zf(a,b,g.value,d);else c instanceof ea||b.add(c,Af(c.location))}
lf.prototype.doDeactivate=function(){this.la=!1;var a=this.h;null!==a&&Bf(a);Cf(this);Df(this,this.Hc);this.Hc=null;this.Wq=this.Dt=!1;if(0<Ef.count){for(var b=Ef.length,c=0;c<b;c++){var d=Ef.n[c];Ff(d);Gf(d);Cf(d);null!==d.h&&Bf(d.h)}Ef.clear()}Ff(this);this.Qo.eq(NaN,NaN);wf=xf=null;Gf(this);a.Qd=!1;a.gc="";a.Oo=!1;this.vk()};
function Cf(a){var b=a.h;if(null!==b){var c=b.ab;b.ab=!0;for(var d=b.T,f=a.Yl;null!==f;){var g=f.TA;if(null!==g&&(g(d,f,null),d.Ke))break;f=f.ia}b.ab=c}a.Ov=null;a.Yl=null}function Hf(){var a=wf;Gf(a);If(a);var b=a.h;null!==b&&a.Qo.P()&&(b.position=a.Qo);null!==b&&Bf(b)}lf.prototype.doCancel=function(){Gf(this);If(this);var a=this.h;null!==a&&this.Qo.P()&&(a.position=this.Qo);this.stopTool()};function vf(a,b){if(null!==b){a.Is=!0;for(var c=b.k;c.next();){var d=c.key;d instanceof B&&(d.jq=!0)}}}
function Df(a,b){if(null!==b&&a.Is){for(var c=b.k;c.next();){var d=c.key;d instanceof B&&(d.jq=!1,d.qj?Tf(d)&&d.hc():d.ja())}a.Is=!1}}lf.prototype.doKeyDown=function(){var a=this.h;null!==a&&(a=a.T,null!==a&&this.la&&("Esc"===a.key?this.doCancel():this.doMouseMove()))};lf.prototype.doKeyUp=function(){var a=this.h;null!==a&&null!==a.T&&this.la&&this.doMouseMove()};
function Uf(a,b){for(var c=Infinity,d=Infinity,f=-Infinity,g=-Infinity,h=a.k;h.next();){var k=h.value;if(k.Rd()){var l=k.location,k=l.x,l=l.y;isNaN(k)||isNaN(l)||(k<c&&(c=k),l<d&&(d=l),k>f&&(f=k),l>g&&(g=l))}}Infinity===c?b.p(0,0,0,0):b.p(c,d,f-c,g-d)}
function Vf(a,b){if(null===a.rd){var c=a.h;if(!(null===c||b&&(c.hb||c.ef))&&null!==a.Hc){var d=c.ma;d.isEnabled&&d.DF?null!==d.kj&&0<d.kj.nh.count&&(c.ma.$p(),c.yc("Drag")):If(a);c.ab=!b;c.Ln=!b;a.wj=c.Rc.da;c=a.CE?c.Zm(a.Hc.Pl(),c,!0):c.Zm(c.selection,c,!0);for(d=c.k;d.next();)d.value.location=d.key.location;d=t.Jf();Uf(c,d);t.oc(d);for(var d=new wa(x,Object),f=a.Hc.k;f.next();){var g=f.key;g.Rd()&&g.canCopy()&&(g=c.Da(g),null!==g&&(g.xf(),d.add(g,Af(g.location))))}for(c=c.k;c.next();)f=c.value,
f instanceof B&&f.canCopy()&&d.add(f,Af());a.rd=d;uf(a,d.Pl());null!==a.Qc&&(c=a.Qc,d=c.Ij(),c.Dl(a.wj.x-(d.x+d.width/2),a.wj.y-(d.y+d.height/2)))}}}function Gf(a){var b=a.h;null!==b&&(null!==a.rd&&(b.mB(a.rd.Pl(),!1),a.rd=null),b.ab=!1,b.Ln=!1,a.wj=b.Rc.da)}function Ff(a){if(null!==a.Qc){if(a.ki&&null!==a.Wi){var b=a.Wi;b.h.remove(b.le);b.h.remove(b.me)}a.Qc=null;a.Wi=null}}function Wf(a,b,c){var d=a.h;if(null!==d){var f=a.wj,g=t.N();g.assign(d.T.da);a.moveParts(b,g.ju(f),c);t.B(g)}}
lf.prototype.moveParts=function(a,b,c){if(null!==a&&(t.l(a,wa,lf,"moveParts:parts"),0!==a.count)){var d=t.N(),f=t.N();f.assign(b);isNaN(f.x)&&(f.x=0);isNaN(f.y)&&(f.y=0);var g=this.Is;g||vf(this,a);for(var h=new H,k=new H(Sa),l=a.k;l.next();){var m=l.key;if(m.Rd()){var n=Xf(this,m,a);if(null!==n)h.add({Jc:m,info:l.value,jJ:n});else if(!c||m.canMove()){n=l.value.point;d.assign(n);var p=t.N();this.computeMove(m,d.add(f),a,p);m.location=p;t.B(p);l.value.Gz=p.ju(n)}}else l.key instanceof B&&k.add(l.Db)}for(c=
h.k;c.next();)h=c.value,n=h.info.point,d.assign(n),h.Jc.location=d.add(h.jJ.Gz);n=t.N();c=t.N();for(k=k.k;k.next();)if(p=k.value,h=p.key,h instanceof B)if(h.jq)if(l=h.ca,m=h.fa,null!==this.Qc&&this.ki)p=p.value.point,a.add(h,Af(f)),l=b.x-p.x,m=b.y-p.y,h.Dl(l,m);else{if(null!==l){n.assign(l.location);var q=a.Da(l);null!==q&&n.ju(q.point)}null!==m&&(c.assign(m.location),q=a.Da(m),null!==q&&c.ju(q.point));null!==l&&null!==m?n.yf(c)?(p=p.value.point,l=d,l.assign(n),l.ju(p),a.add(h,Af(n)),h.Dl(l.x,l.y)):
(h.jq=!1,h.hc()):(p=p.value.point,a.add(h,Af(null!==l?n:null!==m?c:b)),l=f.x-p.x,m=f.y-p.y,h.Dl(l,m))}else if(null===h.ca||null===h.fa)p=p.value.point,a.add(h,Af(b)),l=f.x-p.x,m=f.y-p.y,h.Dl(l,m);t.B(d);t.B(f);t.B(n);t.B(c);g||Df(this,a)}};function Xf(a,b,c){b=b.fb;if(null!==b){a=Xf(a,b,c);if(null!==a)return a;a=c.Da(b);if(null!==a)return a}return null}
function If(a){if(null!==a.Hc){for(var b=a.h,c=a.Hc.k;c.next();){var d=c.key;d.Rd()&&(d.location=c.value.point)}for(c=a.Hc.k;c.next();)if(d=c.key,d instanceof B&&d.jq){var f=c.value.point;a.Hc.add(d,Af());d.Dl(-f.x,-f.y)}b.Ig()}}
lf.prototype.computeMove=function(a,b,c,d){void 0===d&&(d=new E);d.assign(b);if(null===a)return d;void 0===c&&(c=null);var f=b;if(this.Dp&&(this.CF||null===c||this.h.T.zj)&&(f=t.N(),c=f,c.assign(b),null!==a)){var g=this.h;if(null!==g){var h=g.xp,k=this.CA,g=k.width,k=k.height,l=this.mF,m=l.x,l=l.y,n=this.lF;if(null!==h){var p=h.vt;isNaN(g)&&(g=p.width);isNaN(k)&&(k=p.height);h=h.BA;isNaN(m)&&(m=h.x);isNaN(l)&&(l=h.y)}h=t.qc(0,0);h.fu(0,0,g,k,n);K.rt(b.x,b.y,m+h.x,l+h.y,g,k,c);t.B(h)}}c=null!==a.pA?
a.pA(a,b,f):f;k=a.ZF;g=k.x;isNaN(g)&&(g=a.location.x);k=k.y;isNaN(k)&&(k=a.location.y);h=a.TF;m=h.x;isNaN(m)&&(m=a.location.x);h=h.y;isNaN(h)&&(h=a.location.y);d.p(Math.max(g,Math.min(c.x,m)),Math.max(k,Math.min(c.y,h)));f!==b&&t.B(f);return d};function Yf(a,b){if(null===b)return!0;var c=b.U;return null===c||c instanceof ea||c.layer.Dc||a.Hc&&a.Hc.contains(c)||a.rd&&a.rd.contains(c)?!0:!1}
function Zf(a,b,c,d){var f=a.h;if(null!==f){a.ki&&(null!==a.Qc&&(a.Qc.ca=null,a.Qc.fa=null),$f(a,!1));var g=!1;!1===a.Yv&&(g=f.ab,f.ab=!0);var h=!1,k=ag(f,b,null,function(b){return!Yf(a,b)}),l=f.T;l.ke=k;var m=f.ab;f.ab=!0;if(k!==a.Yl){var n=a.Yl;a.Ov=n;for(a.Yl=k;null!==n;){var p=n.TA;if(null!==p){if(k===n)break;if(null!==k&&k.rj(n))break;p(l,n,k);h=!0;if(l.Ke)break}n=n.ia}n=a.Ov;if(!a.la&&null===wf)return;for(;null!==k;){p=k.$F;if(null!==p){if(n===k)break;if(null!==n&&n.rj(k))break;p(l,k,n);h=!0;
if(l.Ke)break}k=k.ia}k=a.Yl;if(!a.la&&null===wf)return}null===k&&(p=f.aG,null!==p&&(p(l),h=!0));if(a.la||null!==wf)if(a.doDragOver(b,k),a.la||null!==wf)f.ab=m,h&&f.Ig(),!1===a.Yv&&(f.ab=g),(f.tf||f.uf)&&(c||d)&&bg(f,l.Wd)}}function cg(a,b,c){var d=a.Wi;if(null===d)return null;var f=a.h.fn(b,d.dB,function(a){return d.findValidLinkablePort(a,c)});a=t.N();for(var g=Infinity,h=null,f=f.k;f.next();){var k=f.value;if(null!==k.U){var l=k.wb(Yb,a),l=b.nk(l);l<g&&(h=k,g=l)}}t.B(a);return h}
function $f(a,b){var c=a.Qc;if(null!==c&&!(2>c.ra)){var d=a.h;if(null!==d&&!d.hb&&(d=a.Wi,null!==d)){var f=null,g=null;null===c.ca&&(f=cg(a,c.o(0),!1),null!==f&&(g=f.U));var h=null,k=null;null===c.fa&&(h=cg(a,c.o(c.ra-1),!0),null!==h&&(k=h.U));if((null===g||g instanceof y)&&(null===k||k instanceof y)){var l=d.isValidLink(g,f,k,h);b?(c.Wn=c.o(0).copy(),c.$n=c.o(c.ra-1).copy(),c.jq=!1,c.ca=g,null!==f&&(c.Af=f.Ud),c.fa=k,null!==h&&(c.dg=h.Ud)):l?dg(d,g,f,k,h):dg(d,null,null,null,null)}}}}
lf.prototype.doDragOver=function(){};function eg(a,b){var c=a.h;if(null!==c&&null!==c.ea){a.ki&&$f(a,!0);Cf(a);var d=ag(c,b,null,function(b){return!Yf(a,b)}),f=c.T;f.ke=d;if(null!==d)for(var g=d;null!==g;){var h=g.Mt;if(null!==h&&(h(f,g),f.Ke))break;g=g.ia}else h=c.Mt,null!==h&&h(f);if(a.la||null!==wf)if(a.doDropOnto(b,d),a.la||null!==wf)for(d=c.selection.k;d.next();)f=d.value,f instanceof y&&fg(c,f.pa)}}lf.prototype.doDropOnto=function(){};
lf.prototype.doMouseMove=function(){if(this.la){var a=this.h;if(null!==a&&null!==this.jp&&null!==this.Hc){var b=!1,c=!1;this.mayCopy()?(b=!0,a.gc="copy",Vf(this,!1),Wf(this,this.rd,!1)):this.mayMove()?(c=!0,a.gc="default",Gf(this),Wf(this,this.Hc,!0)):this.mayDragOut()?(a.gc="no-drop",Vf(this,!1),Wf(this,this.rd,!1)):Gf(this);Zf(this,a.T.da,c,b)}}};
lf.prototype.doMouseUp=function(){if(this.la){this.Wq=!0;var a=this.h;if(null!==a){var b=!1,c=this.mayCopy();c&&null!==this.rd?(Gf(this),Vf(this,!0),Wf(this,this.rd,!1),null!==this.rd&&a.zG(this.rd.Pl())):(b=!0,Gf(this),this.mayMove()&&(Wf(this,this.Hc,!0),this.Yv=!1,Zf(this,a.T.da,!0,!1),this.Yv=!0));eg(this,a.T.da);if(this.la){this.rd=null;if(b&&null!==this.Hc)for(b=this.Hc.k;b.next();){var d=b.key;d instanceof y&&(d=d.fb,null===d||null===d.placeholder||this.Hc.contains(d)||d.hA&&d.ja())}a.Sc();
Df(this,this.Hc);this.mf=c?"Copy":"Move";a.Ga(c?"SelectionCopied":"SelectionMoved",a.selection)}this.stopTool()}}};lf.prototype.mayCopy=function(){if(!this.IA)return!1;var a=this.h;if(null===a||a.hb||a.ef||!a.Pm||!a.dj||(t.ln?!a.T.alt:!a.T.control))return!1;for(a=a.selection.k;a.next();){var b=a.value;if(b.Rd()&&b.canCopy())return!0}return null!==this.Qc&&this.ki&&this.Qc.canCopy()?!0:!1};
lf.prototype.mayDragOut=function(){if(!this.IA)return!1;var a=this.h;if(null===a||!a.at||!a.dj||a.fk)return!1;for(a=a.selection.k;a.next();){var b=a.value;if(b.Rd()&&b.canCopy())return!0}return null!==this.Qc&&this.ki&&this.Qc.canCopy()?!0:!1};lf.prototype.mayMove=function(){var a=this.h;if(null===a||a.hb||!a.fk)return!1;for(a=a.selection.k;a.next();){var b=a.value;if(b.Rd()&&b.canMove())return!0}return null!==this.Qc&&this.ki&&this.Qc.canMove()?!0:!1};var Ef=new H(lf),wf=null,xf=null;
lf.prototype.mayDragIn=function(){var a=this.h;return null===a||!a.Yz||a.hb||a.ef||!a.Pm||null===a.ea?!1:!0};lf.prototype.doSimulatedDragEnter=function(){if(this.mayDragIn()){var a=wf;null!==a&&(a.h.gc="copy")}};lf.prototype.doSimulatedDragLeave=function(){var a=wf;null!==a&&a.doSimulatedDragOut();this.doCancel()};
lf.prototype.doSimulatedDragOver=function(){var a=this.h;if(null!==a){var b=wf;null!==b&&null!==b.Hc&&this.mayDragIn()&&(a.gc="copy",gg(this,b.Hc.Pl(),!1),Wf(this,this.rd,!1),Zf(this,a.T.da,!1,!0))}};
lf.prototype.doSimulatedDrop=function(){var a=this.h;if(null!==a){var b=wf;null!==b&&(b.Wq=!0,Gf(this),this.mayDragIn()&&(this.yc("Drop"),gg(this,b.Hc.Pl(),!0),Wf(this,this.rd,!1),null!==this.rd&&a.zG(this.rd.Pl()),this.mf="ExternalCopy",eg(this,a.T.da),a.Sc(),this.rd=null,a.Ga("ExternalObjectsDropped",a.selection),this.vk()))}};
function gg(a,b,c){if(null===a.rd){var d=a.h;if(null!==d&&!d.hb&&!d.ef&&null!==d.ea){d.ab=!c;d.Ln=!c;a.wj=d.T.da;d=d.Zm(b,d,!0);c=t.Jf();Uf(b,c);var f=c.x+c.width/2,g=c.y+c.height/2;t.oc(c);var h=a.$v;c=new wa(x,Object);var k=t.N();for(b=b.k;b.next();){var l=b.value;if(l.Rd()&&l.canCopy()){var m=l.location,l=d.Da(l);k.p(h.x-(f-m.x),h.y-(g-m.y));l.location=k;l.xf();c.add(l,Af(k))}}t.B(k);for(d=d.k;d.next();)f=d.value,f instanceof B&&f.canCopy()&&c.add(f,Af());a.rd=c;uf(a,c.Pl());null!==a.Qc&&(c=a.Qc,
d=c.Ij(),c.Dl(a.wj.x-(d.x+d.width/2),a.wj.y-(d.y+d.height/2)))}}}lf.prototype.doSimulatedDragOut=function(){var a=this.h;null!==a&&(this.mayCopy()||this.mayMove()?a.gc="":a.gc="no-drop")};
function ng(){0<arguments.length&&t.fd(ng);ze.call(this);this.vD=100;this.VC=!1;var a=new B,b=new W;b.oi=!0;b.stroke="blue";a.add(b);b=new W;b.Gn="Standard";b.fill="blue";b.stroke="blue";a.add(b);a.Ne="Tool";this.RD=a;a=new y;b=new W;b.Ud="";b.Eb="Rectangle";b.fill=null;b.stroke="magenta";b.lb=2;b.Ea=K.jy;a.add(b);a.uk=!1;a.Ne="Tool";this.PD=a;this.QD=b;a=new y;b=new W;b.Ud="";b.Eb="Rectangle";b.fill=null;b.stroke="magenta";b.lb=2;b.Ea=K.jy;a.add(b);a.uk=!1;a.Ne="Tool";this.SD=a;this.TD=b;this.tD=
this.sD=this.oD=this.nD=this.pD=null;this.RC=!0;this.OH=new wa(V,"boolean");this.wD=this.Yk=this.LD=null}t.ka("LinkingBaseTool",ng);t.Qa(ng,ze);ng.prototype.doStop=function(){var a=this.h;null!==a&&Bf(a);this.Rg=this.Qg=this.Pg=this.Og=this.vc=null;this.Px.clear();this.If=null};t.g(ng,"portGravity",ng.prototype.dB);t.defineProperty(ng,{dB:"portGravity"},function(){return this.vD},function(a){t.i(a,"number",ng,"portGravity");0<=a&&(this.vD=a)});t.g(ng,"isUnconnectedLinkValid",ng.prototype.mn);
t.defineProperty(ng,{mn:"isUnconnectedLinkValid"},function(){return this.VC},function(a){t.i(a,"boolean",ng,"isUnconnectedLinkValid");this.VC=a});t.g(ng,"temporaryLink",ng.prototype.cg);t.defineProperty(ng,{cg:"temporaryLink"},function(){return this.RD},function(a){t.l(a,B,ng,"temporaryLink");this.RD=a});t.g(ng,"temporaryFromNode",ng.prototype.le);t.defineProperty(ng,{le:"temporaryFromNode"},function(){return this.PD},function(a){t.l(a,y,ng,"temporaryFromNode");this.PD=a});
t.g(ng,"temporaryFromPort",ng.prototype.Nl);t.defineProperty(ng,{Nl:"temporaryFromPort"},function(){return this.QD},function(a){t.l(a,V,ng,"temporaryFromPort");this.QD=a});t.g(ng,"temporaryToNode",ng.prototype.me);t.defineProperty(ng,{me:"temporaryToNode"},function(){return this.SD},function(a){t.l(a,y,ng,"temporaryToNode");this.SD=a});t.g(ng,"temporaryToPort",ng.prototype.Ol);t.defineProperty(ng,{Ol:"temporaryToPort"},function(){return this.TD},function(a){t.l(a,V,ng,"temporaryToPort");this.TD=a});
t.g(ng,"originalLink",ng.prototype.vc);t.defineProperty(ng,{vc:"originalLink"},function(){return this.pD},function(a){null!==a&&t.l(a,B,ng,"originalLink");this.pD=a});t.g(ng,"originalFromNode",ng.prototype.Og);t.defineProperty(ng,{Og:"originalFromNode"},function(){return this.nD},function(a){null!==a&&t.l(a,y,ng,"originalFromNode");this.nD=a});t.g(ng,"originalFromPort",ng.prototype.Pg);
t.defineProperty(ng,{Pg:"originalFromPort"},function(){return this.oD},function(a){null!==a&&t.l(a,V,ng,"originalFromPort");this.oD=a});t.g(ng,"originalToNode",ng.prototype.Qg);t.defineProperty(ng,{Qg:"originalToNode"},function(){return this.sD},function(a){null!==a&&t.l(a,y,ng,"originalToNode");this.sD=a});t.g(ng,"originalToPort",ng.prototype.Rg);t.defineProperty(ng,{Rg:"originalToPort"},function(){return this.tD},function(a){null!==a&&t.l(a,V,ng,"originalToPort");this.tD=a});
t.defineProperty(ng,{fe:"isForwards"},function(){return this.RC},function(a){t.i(a,"boolean",ng,"isForwards");this.RC=a});t.A(ng,{Px:"validPortsCache"},function(){return this.OH});t.g(ng,"targetPort",ng.prototype.If);t.defineProperty(ng,{If:"targetPort"},function(){return this.LD},function(a){null!==a&&t.l(a,V,ng,"targetPort");this.LD=a});
ng.prototype.copyPortProperties=function(a,b,c,d,f){if(null!==a&&null!==b&&null!==c&&null!==d){d.Ea=b.pa.size;f?(d.zb=b.zb,d.xk=b.xk):(d.vb=b.vb,d.rk=b.rk);c.gf=Yb;var g=t.N();c.location=b.wb(Yb,g);t.B(g);d.angle=b.ul();null!==this.Wt&&this.Wt(a,b,c,d,f)}};ng.prototype.setNoTargetPortProperties=function(a,b,c){null!==b&&(b.Ea=K.jy,b.vb=Tb,b.zb=Tb);null!==a&&(a.location=this.h.T.da);null!==this.Wt&&this.Wt(null,null,a,b,c)};ng.prototype.doMouseDown=function(){this.la&&this.doMouseMove()};
ng.prototype.doMouseMove=function(){if(this.la){var a=this.h;if(null!==a){this.If=this.findTargetPort(this.fe);if(null!==this.If){var b=this.If.U;if(b instanceof y){this.fe?this.copyPortProperties(b,this.If,this.me,this.Ol,!0):this.copyPortProperties(b,this.If,this.le,this.Nl,!1);return}}this.fe?this.setNoTargetPortProperties(this.me,this.Ol,!0):this.setNoTargetPortProperties(this.le,this.Nl,!1);(a.tf||a.uf)&&bg(a,a.T.Wd)}}};
ng.prototype.findValidLinkablePort=function(a,b){if(null===a)return null;var c=a.U;if(!(c instanceof y))return null;for(;null!==a;){var d=b?a.GB:a.yA;if(!0===d&&(null!==a.Ud||a instanceof y)&&(b?this.isValidTo(c,a):this.isValidFrom(c,a)))return a;if(!1===d)break;a=a.ia}return null};
ng.prototype.findTargetPort=function(a){var b=this.h,c=b.T.da,d=this.dB;0>=d&&(d=0.1);for(var f=this,g=b.fn(c,d,function(b){return f.findValidLinkablePort(b,a)},null,!0),d=Infinity,b=null,g=g.k;g.next();){var h=g.value,k=h.U;if(k instanceof y){var l=h.wb(Yb,t.N()),m=c.x-l.x,n=c.y-l.y;t.B(l);l=m*m+n*n;l<d&&(m=this.Px.Da(h),null!==m?m&&(b=h,d=l):a&&this.isValidLink(this.Og,this.Pg,k,h)||!a&&this.isValidLink(k,h,this.Qg,this.Rg)?(this.Px.add(h,!0),b=h,d=l):this.Px.add(h,!1))}}return null!==b&&(c=b.U,
c instanceof y&&(null===c.layer||c.layer.Qm))?b:null};ng.prototype.isValidFrom=function(a,b){if(null===a||null===b)return this.mn;if(this.h.Ya===this&&(null!==a.layer&&!a.layer.Qm||!0!==b.yA))return!1;var c=b.gF;if(Infinity>c){if(null!==this.vc&&a===this.Og&&b===this.Pg)return!0;var d=b.Ud;null===d&&(d="");if(a.Qw(d).count>=c)return!1}return!0};
ng.prototype.isValidTo=function(a,b){if(null===a||null===b)return this.mn;if(this.h.Ya===this&&(null!==a.layer&&!a.layer.Qm||!0!==b.GB))return!1;var c=b.TG;if(Infinity>c){if(null!==this.vc&&a===this.Qg&&b===this.Rg)return!0;var d=b.Ud;null===d&&(d="");if(a.Cg(d).count>=c)return!1}return!0};ng.prototype.isInSameNode=function(a,b){if(null===a||null===b)return!1;if(a===b)return!0;var c=a.U,d=b.U;return null!==c&&c===d};
ng.prototype.isLinked=function(a,b){if(null===a||null===b)return!1;var c=a.U;if(!(c instanceof y))return!1;var d=a.Ud;null===d&&(d="");var f=b.U;if(!(f instanceof y))return!1;var g=b.Ud;null===g&&(g="");for(f=f.Cg(g);f.next();)if(g=f.value,g.ca===c&&g.Af===d)return!0;return!1};
ng.prototype.isValidLink=function(a,b,c,d){if(!this.isValidFrom(a,b)||!this.isValidTo(c,d)||!(null===b||null===d||(b.fF&&d.SG||!this.isInSameNode(b,d))&&(b.eF&&d.RG||!this.isLinked(b,d)))||null!==this.vc&&(null!==a&&og(this,a,this.vc)||null!==c&&og(this,c,this.vc))||null!==a&&null!==c&&(null===a.data&&null!==c.data||null!==a.data&&null===c.data)||!pg(this,a,c,this.vc))return!1;if(null!==a){var f=a.Np;if(null!==f&&!f(a,b,c,d,this.vc))return!1}if(null!==c&&(f=c.Np,null!==f&&!f(a,b,c,d,this.vc)))return!1;
f=this.Np;return null!==f?f(a,b,c,d,this.vc):!0};function og(a,b,c){if(null===b)return!1;var d=b.Dd;if(null===d)return!1;if(d===c)return!0;var f=new I(y);f.add(b);return qg(a,d,c,f)}function qg(a,b,c,d){if(b===c)return!0;var f=b.ca;if(null!==f&&f.ni&&(d.add(f),qg(a,f.Dd,c,d)))return!0;b=b.fa;return null!==b&&b.ni&&(d.add(b),qg(a,b.Dd,c,d))?!0:!1}
function pg(a,b,c,d){if(null===b||null===c)return a.mn;var f=a.h.fH;if(f!==rg){if(f===sg){if(null!==d&&!d.Ic)return!0;for(f=c.Td;f.next();){var g=f.value;if(g!==d&&g.Ic&&g.fa===c)return!1}return!tg(a,b,c,d,!0)}if(f===ug){if(null!==d&&!d.Ic)return!0;for(f=b.Td;f.next();)if(g=f.value,g!==d&&g.Ic&&g.ca===b)return!1;return!tg(a,b,c,d,!0)}if(f===vg)return b===c?a=!0:(f=new I(y),f.add(c),a=wg(a,f,b,c,d)),!a;if(f===xg)return!tg(a,b,c,d,!1);if(f===yg)return b===c?a=!0:(f=new I(y),f.add(c),a=zg(a,f,b,c,d)),
!a}return!0}function tg(a,b,c,d,f){if(b===c)return!0;if(null===b||null===c)return!1;for(var g=b.Td;g.next();){var h=g.value;if(h!==d&&(!f||h.Ic)&&h.fa===b&&(h=h.ca,h!==b&&tg(a,h,c,d,f)))return!0}return!1}function wg(a,b,c,d,f){if(c===d)return!0;if(null===c||null===d||b.contains(c))return!1;b.add(c);for(var g=c.Td;g.next();){var h=g.value;if(h!==f&&h.fa===c&&(h=h.ca,h!==c&&wg(a,b,h,d,f)))return!0}return!1}
function zg(a,b,c,d,f){if(c===d)return!0;if(null===c||null===d||b.contains(c))return!1;b.add(c);for(var g=c.Td;g.next();){var h=g.value;if(h!==f){var k=h.ca,h=h.fa,k=k===c?h:k;if(k!==c&&zg(a,b,k,d,f))return!0}}return!1}t.g(ng,"linkValidation",ng.prototype.Np);t.defineProperty(ng,{Np:"linkValidation"},function(){return this.Yk},function(a){null!==a&&t.i(a,"function",ng,"linkValidation");this.Yk=a});t.g(ng,"portTargeted",ng.prototype.Wt);
t.defineProperty(ng,{Wt:"portTargeted"},function(){return this.wD},function(a){null!==a&&t.i(a,"function",ng,"portTargeted");this.wD=a});function Ca(){0<arguments.length&&t.fd(Ca);ng.call(this);this.name="Linking";this.zy={};this.yy=null;this.ua=Ag;this.Hz=this.GD=null}t.ka("LinkingTool",Ca);t.Qa(Ca,ng);var Ag;Ca.Either=Ag=t.w(Ca,"Either",0);var Bg;Ca.ForwardsOnly=Bg=t.w(Ca,"ForwardsOnly",0);var Jg;Ca.BackwardsOnly=Jg=t.w(Ca,"BackwardsOnly",0);t.g(Ca,"archetypeLinkData",Ca.prototype.iE);
t.defineProperty(Ca,{iE:"archetypeLinkData"},function(){return this.zy},function(a){null!==a&&t.l(a,Object,Ca,"archetypeLinkData");a instanceof V&&t.l(a,B,Ca,"archetypeLinkData");this.zy=a});t.g(Ca,"archetypeLabelNodeData",Ca.prototype.bA);t.defineProperty(Ca,{bA:"archetypeLabelNodeData"},function(){return this.yy},function(a){null!==a&&t.l(a,Object,Ca,"archetypeLabelNodeData");a instanceof V&&t.l(a,y,Ca,"archetypeLabelNodeData");this.yy=a});t.g(Ca,"direction",Ca.prototype.direction);
t.defineProperty(Ca,{direction:"direction"},function(){return this.ua},function(a){t.Fa(a,Ca,Ca,"direction");this.ua=a});t.g(Ca,"startObject",Ca.prototype.BB);t.defineProperty(Ca,{BB:"startObject"},function(){return this.GD},function(a){null!==a&&t.l(a,V,Ca,"startObject");this.GD=a});t.A(Ca,{Lx:"startPort"},function(){return this.Hz});
Ca.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;if(null===a||a.hb||a.ef||!a.Qm)return!1;var b=a.ea;return null!==b&&(b instanceof T||b instanceof ce)&&a.T.left&&(a.Ya===this||this.isBeyondDragSize())?null!==this.findLinkablePort():!1};
Ca.prototype.findLinkablePort=function(){var a=this.h;if(null===a)return null;var b=this.BB;null===b&&(b=a.de(a.Rc.da,null,null));if(null===b||!(b.U instanceof y))return null;var c=this.direction;if(c===Ag||c===Bg)if(a=this.findValidLinkablePort(b,!1),null!==a)return this.fe=!0,a;if(c===Ag||c===Jg)if(a=this.findValidLinkablePort(b,!0),null!==a)return this.fe=!1,a;return null};
Ca.prototype.doActivate=function(){var a=this.h;if(null!==a&&(null===this.Lx&&(this.Hz=this.findLinkablePort()),null!==this.Lx)){this.yc(this.name);a.Qd=!0;a.gc="pointer";if(this.fe){this.Pg=this.Lx;var b=this.Pg.U;b instanceof y&&(this.Og=b);this.copyPortProperties(this.Og,this.Pg,this.le,this.Nl,!1)}else this.Rg=this.Lx,b=this.Rg.U,b instanceof y&&(this.Qg=b),this.copyPortProperties(this.Qg,this.Rg,this.me,this.Ol,!0);a.add(this.le);a.add(this.me);null!==this.cg&&(null!==this.le&&(this.cg.ca=this.le),
null!==this.me&&(this.cg.fa=this.me),this.cg.hc(),a.add(this.cg));this.la=!0}};Ca.prototype.doDeactivate=function(){this.la=!1;var a=this.h;null!==a&&(a.remove(this.cg),a.remove(this.le),a.remove(this.me),a.Qd=!1,a.gc="",this.vk())};Ca.prototype.doStop=function(){ng.prototype.doStop.call(this);this.BB=this.Hz=null};
Ca.prototype.doMouseUp=function(){if(this.la){var a=this.h;if(null===a)return;var b=this.mf=null,c=null,d=null,f=null,g=this.If=this.findTargetPort(this.fe),h=null;null!==g?(h=g.U,h instanceof y&&(this.fe?(null!==this.Og&&(b=this.Og,c=this.Pg),d=h,f=g):(b=h,c=g,null!==this.Qg&&(d=this.Qg,f=this.Rg)))):this.fe?null!==this.Og&&this.mn&&(b=this.Og,c=this.Pg):null!==this.Qg&&this.mn&&(d=this.Qg,f=this.Rg);if(null!==b||null!==d)b=this.insertLink(b,c,d,f),null!==b?(null===g&&(this.fe?b.$n=a.T.da.copy():
b.Wn=a.T.da.copy()),a.Ve&&a.select(b),this.mf=this.name,a.Ga("LinkDrawn",b)):a.ea.tE()}this.stopTool()};
Ca.prototype.insertLink=function(a,b,c,d){var f=this.h;if(null===f)return null;var g=f.ea;if(null===g)return null;if(g instanceof ce){var h=a;b=c;f.vd||(h=c,b=a);if(null!==h&&null!==b)return g.xh(b.data,g.Lb(h.data)),b.tt()}else if(g instanceof T)if(h="",null!==a&&(null===b&&(b=a),h=b.Ud,null===h&&(h="")),b="",null!==c&&(null===d&&(d=c),b=d.Ud,null===b&&(b="")),d=this.iE,d instanceof B){if(cf(d),g=d.copy(),g instanceof B)return g.ca=a,g.Af=h,g.fa=c,g.dg=b,f.add(g),a=this.bA,a instanceof y&&(cf(a),
a=a.copy(),a instanceof y&&(a.Dd=g,f.add(a))),g}else if(null!==d&&(d=g.EE(d),t.xb(d)))return null!==a&&g.Hx(d,g.Lb(a.data)),g.vB(d,h),null!==c&&g.Jx(d,g.Lb(c.data)),g.yB(d,b),g.nw(d),a=this.bA,null===a||a instanceof y||(a=g.copyNodeData(a),t.xb(a)&&(g.Om(a),a=g.Lb(a),void 0!==a&&g.fE(d,a))),g=f.Vf(d);return null};
function yf(){0<arguments.length&&t.fd(yf);ng.call(this);this.name="Relinking";var a=new W;a.Eb="Diamond";a.Ea=K.$x;a.fill="lightblue";a.stroke="dodgerblue";a.cursor="pointer";a.Gf=0;this.GC=a;a=new W;a.Eb="Diamond";a.Ea=K.$x;a.fill="lightblue";a.stroke="dodgerblue";a.cursor="pointer";a.Gf=-1;this.UD=a;this.kc=null;this.qD=new F}t.ka("RelinkingTool",yf);t.Qa(yf,ng);
yf.prototype.updateAdornments=function(a){if(null!==a&&a instanceof B){var b="RelinkFrom",c=null;if(a.ib&&!this.h.hb){var d=a.An;null!==d&&a.canRelinkFrom()&&a.pa.P()&&a.Wa()&&d.pa.P()&&d.Cl()&&(c=a.np(b),null===c&&(c=this.makeAdornment(d,!1),c.cd=b,a.il(b,c)))}null===c&&a.Hl(b);b="RelinkTo";c=null;a.ib&&!this.h.hb&&(d=a.An,null!==d&&a.canRelinkTo()&&a.pa.P()&&a.Wa()&&d.pa.P()&&d.Cl()&&(c=a.np(b),null===c&&(c=this.makeAdornment(d,!0),c.cd=b,a.il(b,c))));null===c&&a.Hl(b)}};
yf.prototype.makeAdornment=function(a,b){var c=new ea;c.type=Lg;var d=b?this.xK:this.eJ;null!==d&&c.add(d.copy());c.uc=a;return c};t.defineProperty(yf,{eJ:"fromHandleArchetype"},function(){return this.GC},function(a){null!==a&&t.l(a,V,yf,"fromHandleArchetype");this.GC=a});t.defineProperty(yf,{xK:"toHandleArchetype"},function(){return this.UD},function(a){null!==a&&t.l(a,V,yf,"toHandleArchetype");this.UD=a});t.A(yf,{handle:"handle"},function(){return this.kc});
yf.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;if(null===a||a.hb||a.ef||!a.gk)return!1;var b=a.ea;if(null===b||!(b instanceof T||b instanceof ce)||!a.T.left)return!1;b=this.findToolHandleAt(a.Rc.da,"RelinkFrom");null===b&&(b=this.findToolHandleAt(a.Rc.da,"RelinkTo"));return null!==b};
yf.prototype.doActivate=function(){var a=this.h;if(null!==a){if(null===this.vc){var b=this.findToolHandleAt(a.Rc.da,"RelinkFrom");null===b&&(b=this.findToolHandleAt(a.Rc.da,"RelinkTo"));if(null===b)return;var c=b.U;if(!(c instanceof ea&&c.hi instanceof B))return;this.kc=b;this.fe=null===c||"RelinkTo"===c.cd;this.vc=c.hi}this.yc(this.name);a.Qd=!0;a.gc="pointer";this.Pg=this.vc.sd;this.Og=this.vc.ca;this.Rg=this.vc.Vd;this.Qg=this.vc.fa;this.qD.set(this.vc.pa);null!==this.vc&&0<this.vc.ra&&(null===
this.vc.ca&&(null!==this.Nl&&(this.Nl.Ea=K.uq),null!==this.le&&(this.le.location=this.vc.o(0))),null===this.vc.fa&&(null!==this.Ol&&(this.Ol.Ea=K.uq),null!==this.me&&(this.me.location=this.vc.o(this.vc.ra-1))));this.copyPortProperties(this.Og,this.Pg,this.le,this.Nl,!1);this.copyPortProperties(this.Qg,this.Rg,this.me,this.Ol,!0);a.add(this.le);a.add(this.me);null!==this.cg&&(null!==this.le&&(this.cg.ca=this.le),null!==this.me&&(this.cg.fa=this.me),this.copyLinkProperties(this.vc,this.cg),this.cg.hc(),
a.add(this.cg));this.la=!0}};yf.prototype.copyLinkProperties=function(a,b){if(null!==a&&null!==b){b.Yo=a.Yo;b.Gw=a.Gw;var c=a.Je;if(c===Mg||c===Ng)c=Og;b.Je=c;b.kt=a.kt;b.au=a.au;b.En=a.En;b.vb=a.vb;b.rk=a.rk;b.tp=a.tp;b.up=a.up;b.zb=a.zb;b.xk=a.xk;b.kq=a.kq;b.lq=a.lq}};yf.prototype.doDeactivate=function(){this.la=!1;var a=this.h;null!==a&&(a.remove(this.cg),a.remove(this.le),a.remove(this.me),a.Qd=!1,a.gc="",this.vk())};yf.prototype.doStop=function(){ng.prototype.doStop.call(this);this.kc=null};
yf.prototype.doMouseUp=function(){if(this.la){var a=this.h;if(null===a)return;this.mf=null;var b=this.Og,c=this.Pg,d=this.Qg,f=this.Rg,g=this.vc;this.If=this.findTargetPort(this.fe);if(null!==this.If){var h=this.If.U;h instanceof y&&(this.fe?(d=h,f=this.If):(b=h,c=this.If))}else this.mn?this.fe?f=d=null:c=b=null:g=null;null!==g&&(this.reconnectLink(g,this.fe?d:b,this.fe?f:c,this.fe),null===this.If&&(this.fe?g.$n=a.T.da.copy():g.Wn=a.T.da.copy(),g.hc()),a.Ve&&(g.ib=!0),this.mf=this.name,a.Ga("LinkRelinked",
g,this.fe?this.Rg:this.Pg));Pg(this.vc,this.qD)}this.stopTool()};yf.prototype.reconnectLink=function(a,b,c,d){if(null===this.h)return!1;c=null!==c&&null!==c.Ud?c.Ud:"";d?(a.fa=b,a.dg=c):(a.ca=b,a.Af=c);return!0};function dg(a,b,c,d,f){null!==b?(a.copyPortProperties(b,c,a.le,a.Nl,!1),a.h.add(a.le)):a.h.remove(a.le);null!==d?(a.copyPortProperties(d,f,a.me,a.Ol,!0),a.h.add(a.me)):a.h.remove(a.me)}
function Qg(){0<arguments.length&&t.fd(Qg);ze.call(this);this.name="LinkReshaping";var a=new W;a.Eb="Rectangle";a.Ea=K.rq;a.fill="lightblue";a.stroke="dodgerblue";this.Sk=a;a=new W;a.Eb="Diamond";a.Ea=K.rq;a.fill="lightblue";a.stroke="dodgerblue";this.bD=a;this.xD=3;this.wy=this.kc=null;this.rD=new E;this.zz=null}t.ka("LinkReshapingTool",Qg);t.Qa(Qg,ze);var Rg;Qg.None=Rg=t.w(Qg,"None",0);var Sg;Qg.Horizontal=Sg=t.w(Qg,"Horizontal",1);var Tg;Qg.Vertical=Tg=t.w(Qg,"Vertical",2);var Ug;
Qg.All=Ug=t.w(Qg,"All",3);function Vg(a,b){t.l(a,V,Qg,"setReshapingBehavior:obj");t.Fa(b,Qg,Qg,"setReshapingBehavior:behavior");a.Pv=b}Qg.prototype.updateAdornments=function(a){if(null!==a&&a instanceof B){if(a.ib&&!this.h.hb){var b=a.path;if(null!==b&&a.canReshape()&&a.pa.P()&&a.Wa()&&b.pa.P()&&b.Cl()){var c=a.np(this.name);if(null===c||c.HH!==a.ra||c.QH!==a.Xp)c=this.makeAdornment(b),c.HH=a.ra,c.QH=a.Xp,a.il(this.name,c);if(null!==c){c.location=a.position;return}}}a.Hl(this.name)}};
Qg.prototype.makeAdornment=function(a){var b=a.U,c=b.ra,d=b.pc,f=null;if(null!==b.points&&1<c){f=new ea;f.type=Lg;var c=b.ut,g=b.nx,h=d?1:0;if(b.Xp&&b.Je!==Wg)for(var k=c+h;k<g-h;k++){var l=this.makeResegmentHandle(a,k);null!==l&&(l.Gf=k,l.bu=0.5,f.add(l))}for(k=c+1;k<g;k++)if(l=this.makeHandle(a,k),null!==l){l.Gf=k;if(k!==c)if(k===c+1&&d){var h=b.o(c),m=b.o(c+1);K.I(h.x,m.x)&&K.I(h.y,m.y)&&(m=b.o(c-1));K.I(h.x,m.x)?(Vg(l,Tg),l.cursor="n-resize"):K.I(h.y,m.y)&&(Vg(l,Sg),l.cursor="w-resize")}else k===
g-1&&d?(h=b.o(g-1),m=b.o(g),K.I(h.x,m.x)&&K.I(h.y,m.y)&&(h=b.o(g+1)),K.I(h.x,m.x)?(Vg(l,Tg),l.cursor="n-resize"):K.I(h.y,m.y)&&(Vg(l,Sg),l.cursor="w-resize")):k!==g&&(Vg(l,Ug),l.cursor="move");f.add(l)}f.cd=this.name;f.uc=a}return f};Qg.prototype.makeHandle=function(){var a=this.wt;return null===a?null:a.copy()};t.defineProperty(Qg,{wt:"handleArchetype"},function(){return this.Sk},function(a){null!==a&&t.l(a,V,Qg,"handleArchetype");this.Sk=a});
Qg.prototype.makeResegmentHandle=function(){var a=this.LJ;return null===a?null:a.copy()};t.defineProperty(Qg,{LJ:"midHandleArchetype"},function(){return this.bD},function(a){null!==a&&t.l(a,V,Qg,"midHandleArchetype");this.bD=a});t.A(Qg,{handle:"handle"},function(){return this.kc});t.A(Qg,{$s:"adornedLink"},function(){return this.wy});Qg.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;return null!==a&&!a.hb&&a.$o&&a.T.left?null!==this.findToolHandleAt(a.Rc.da,this.name):!1};
Qg.prototype.doActivate=function(){var a=this.h;if(null!==a&&(this.kc=this.findToolHandleAt(a.Rc.da,this.name),null!==this.kc)){var b=this.kc.U.hi;if(b instanceof B){this.wy=b;a.Qd=!0;this.yc(this.name);if(b.Xp&&0.5===this.kc.bu){var c=b.points.copy(),d=this.kc.wb(Yb);c.Pd(this.kc.Gf+1,d);b.pc&&c.Pd(this.kc.Gf+1,d);b.points=c;b.Uf();b.updateAdornments();this.kc=this.findToolHandleAt(a.Rc.da,this.name)}this.rD=b.o(this.kc.Gf);this.zz=b.points.copy();this.la=!0}}};
Qg.prototype.doDeactivate=function(){this.vk();this.wy=this.kc=null;var a=this.h;null!==a&&(a.Qd=!1);this.la=!1};Qg.prototype.doCancel=function(){var a=this.$s;null!==a&&(a.points=this.zz);this.stopTool()};Qg.prototype.doMouseMove=function(){var a=this.h;this.la&&null!==a&&(a=this.computeReshape(a.T.da),this.reshape(a))};
Qg.prototype.doMouseUp=function(){var a=this.h;if(this.la&&null!==a){var b=this.computeReshape(a.T.da);this.reshape(b);b=this.$s;if(null!==b&&b.Xp){var c=this.handle.Gf,d=b.o(c-1),f=b.o(c),g=b.o(c+1);if(b.pc){if(c>b.ut+1&&c<b.nx-1){var h=b.o(c-2);if(Math.abs(d.x-f.x)<this.Sg&&Math.abs(d.y-f.y)<this.Sg&&(Xg(this,h,d,f,g,!0)||Xg(this,h,d,f,g,!1))){var k=b.points.copy();Xg(this,h,d,f,g,!0)?(k.Tg(c-2,new E(h.x,(g.y+h.y)/2)),k.Tg(c+1,new E(g.x,(g.y+h.y)/2))):(k.Tg(c-2,new E((g.x+h.x)/2,h.y)),k.Tg(c+1,
new E((g.x+h.x)/2,g.y)));k.wd(c);k.wd(c-1);b.points=k;b.Uf();b.updateAdornments()}else h=b.o(c+2),Math.abs(f.x-g.x)<this.Sg&&Math.abs(f.y-g.y)<this.Sg&&(Xg(this,d,f,g,h,!0)||Xg(this,d,f,g,h,!1))&&(k=b.points.copy(),Xg(this,d,f,g,h,!0)?(k.Tg(c-1,new E(d.x,(d.y+h.y)/2)),k.Tg(c+2,new E(h.x,(d.y+h.y)/2))):(k.Tg(c-1,new E((d.x+h.x)/2,d.y)),k.Tg(c+2,new E((d.x+h.x)/2,h.y))),k.wd(c+1),k.wd(c),b.points=k,b.Uf(),b.updateAdornments())}}else h=t.N(),K.vn(d.x,d.y,g.x,g.y,f.x,f.y,h)&&h.nk(f)<this.Sg*this.Sg&&
(k=b.points.copy(),k.wd(c),b.points=k,b.Uf(),b.updateAdornments()),t.B(h)}a.Sc();this.mf=this.name;a.Ga("LinkReshaped",this.$s)}this.stopTool()};function Xg(a,b,c,d,f,g){return g?Math.abs(b.y-c.y)<a.Sg&&Math.abs(c.y-d.y)<a.Sg&&Math.abs(d.y-f.y)<a.Sg:Math.abs(b.x-c.x)<a.Sg&&Math.abs(c.x-d.x)<a.Sg&&Math.abs(d.x-f.x)<a.Sg}t.g(Qg,"resegmentingDistance",Qg.prototype.Sg);
t.defineProperty(Qg,{Sg:"resegmentingDistance"},function(){return this.xD},function(a){t.i(a,"number",Qg,"resegmentingDistance");this.xD=a});
Qg.prototype.reshape=function(a){var b=this.$s;b.Kl();var c=this.handle.Gf,d=this.handle&&this.handle.Pv?this.handle.Pv:Rg;if(b.pc)if(c===b.ut+1)c=b.ut+1,d===Tg?(b.aa(c,b.o(c-1).x,a.y),b.aa(c+1,b.o(c+2).x,a.y)):d===Sg&&(b.aa(c,a.x,b.o(c-1).y),b.aa(c+1,a.x,b.o(c+2).y));else if(c===b.nx-1)c=b.nx-1,d===Tg?(b.aa(c-1,b.o(c-2).x,a.y),b.aa(c,b.o(c+1).x,a.y)):d===Sg&&(b.aa(c-1,a.x,b.o(c-2).y),b.aa(c,a.x,b.o(c+1).y));else{var d=c,f=b.o(d),g=b.o(d-1),h=b.o(d+1);K.I(g.x,f.x)&&K.I(f.y,h.y)?(K.I(g.x,b.o(d-2).x)&&
!K.I(g.y,b.o(d-2).y)?(b.C(d,a.x,g.y),c++,d++):b.aa(d-1,a.x,g.y),K.I(h.y,b.o(d+2).y)&&!K.I(h.x,b.o(d+2).x)?b.C(d+1,h.x,a.y):b.aa(d+1,h.x,a.y)):K.I(g.y,f.y)&&K.I(f.x,h.x)?(K.I(g.y,b.o(d-2).y)&&!K.I(g.x,b.o(d-2).x)?(b.C(d,g.x,a.y),c++,d++):b.aa(d-1,g.x,a.y),K.I(h.x,b.o(d+2).x)&&!K.I(h.y,b.o(d+2).y)?b.C(d+1,a.x,h.y):b.aa(d+1,a.x,h.y)):K.I(g.x,f.x)&&K.I(f.x,h.x)?(K.I(g.x,b.o(d-2).x)&&!K.I(g.y,b.o(d-2).y)?(b.C(d,a.x,g.y),c++,d++):b.aa(d-1,a.x,g.y),K.I(h.x,b.o(d+2).x)&&!K.I(h.y,b.o(d+2).y)?b.C(d+1,a.x,h.y):
b.aa(d+1,a.x,h.y)):K.I(g.y,f.y)&&K.I(f.y,h.y)&&(K.I(g.y,b.o(d-2).y)&&!K.I(g.x,b.o(d-2).x)?(b.C(d,g.x,a.y),c++,d++):b.aa(d-1,g.x,a.y),K.I(h.y,b.o(d+2).y)&&!K.I(h.x,b.o(d+2).x)?b.C(d+1,h.x,a.y):b.aa(d+1,h.x,a.y));b.aa(c,a.x,a.y)}else b.aa(c,a.x,a.y),1===c&&b.computeSpot(!0).Me()&&(f=b.ca,g=b.sd,null===f||f.Wa()||(f=f.findVisibleNode(),f!==b.ca&&(g=f.tl(""))),d=g.wb(Yb,t.N()),f=b.getLinkPointFromPoint(f,g,d,a,!0,t.N()),b.aa(0,f.x,f.y),t.B(d),t.B(f)),c===b.ra-2&&b.computeSpot(!1).Me()&&(c=b.fa,f=b.Vd,
null===c||c.Wa()||(c=c.findVisibleNode(),c!==b.fa&&(f=c.tl(""))),d=f.wb(Yb,t.N()),f=b.getLinkPointFromPoint(c,f,d,a,!1,t.N()),b.aa(b.ra-1,f.x,f.y),t.B(d),t.B(f));b.ij()};Qg.prototype.computeReshape=function(a){var b=this.$s,c=this.handle.Gf;switch(this.handle&&this.handle.Pv?this.handle.Pv:Rg){case Ug:return a;case Tg:return b=b.o(c),new E(b.x,a.y);case Sg:return b=b.o(c),new E(a.x,b.y);default:case Rg:return b.o(c)}};t.g(Qg,"originalPoint",Qg.prototype.VJ);t.A(Qg,{VJ:"originalPoint"},function(){return this.rD});
t.g(Qg,"originalPoints",Qg.prototype.WJ);t.A(Qg,{WJ:"originalPoints"},function(){return this.zz});
function Yg(){0<arguments.length&&t.fd(Yg);ze.call(this);this.name="Resizing";this.Tj=(new ra(1,1)).freeze();this.Sj=(new ra(9999,9999)).freeze();this.Dj=(new ra(NaN,NaN)).freeze();this.jr=!1;this.ob=null;var a=new W;a.ek=Yb;a.Eb="Rectangle";a.Ea=K.rq;a.fill="lightblue";a.stroke="dodgerblue";a.lb=1;a.cursor="pointer";this.Sk=a;this.kc=null;this.Kv=new ra;this.yz=new E;this.cz=new ra(0,0);this.bz=new ra(Infinity,Infinity);this.az=new ra(1,1);this.kD=!0}t.ka("ResizingTool",Yg);t.Qa(Yg,ze);
Yg.prototype.updateAdornments=function(a){if(!(null===a||a instanceof B)){if(a.ib&&!this.h.hb){var b=a.pG;if(null!==b&&a.canResize()&&a.pa.P()&&a.Wa()&&b.pa.P()&&b.Cl()){var c=a.np(this.name);null===c&&(c=this.makeAdornment(b));if(null!==c){var d=b.ul();c.angle=d;var f=b.wb(c.gf,t.N()),g=b.sk();c.location=f;t.B(f);f=c.placeholder;if(null!==f){var b=b.Ja,h=t.Ml();h.p(b.width*g,b.height*g);f.Ea=h;t.qk(h)}Zg(this,c,d);a.il(this.name,c);return}}}a.Hl(this.name)}};
Yg.prototype.makeAdornment=function(a){var b=null,b=a.U.nG;if(null===b){b=new ea;b.type=$g;b.gf=Yb;var c=new ah;c.oi=!0;b.add(c);b.add(this.makeHandle(a,Vb));b.add(this.makeHandle(a,Xb));b.add(this.makeHandle(a,bc));b.add(this.makeHandle(a,$b));b.add(this.makeHandle(a,cc));b.add(this.makeHandle(a,hc));b.add(this.makeHandle(a,mc));b.add(this.makeHandle(a,gc))}else if(cf(b),b=b.copy(),!(b instanceof ea))return null;b.cd=this.name;b.uc=a;return b};
Yg.prototype.makeHandle=function(a,b){var c=this.wt;if(null===c)return null;c=c.copy();c.alignment=b;return c};
function Zg(a,b,c){if(null!==b)if(!b.alignment.Tc()&&""!==b.cursor)a:{a=b.alignment;a.Me()&&(a=Yb);if(0>=a.x)c=0>=a.y?c+225:1<=a.y?c+135:c+180;else if(1<=a.x)0>=a.y?c+=315:1<=a.y&&(c+=45);else if(0>=a.y)c+=270;else if(1<=a.y)c+=90;else break a;0>c?c+=360:360<=c&&(c-=360);b.cursor=22.5>c?"e-resize":67.5>c?"se-resize":112.5>c?"s-resize":157.5>c?"sw-resize":202.5>c?"w-resize":247.5>c?"nw-resize":292.5>c?"n-resize":337.5>c?"ne-resize":"e-resize"}else if(b instanceof C)for(b=b.elements;b.next();)Zg(a,
b.value,c)}t.defineProperty(Yg,{wt:"handleArchetype"},function(){return this.Sk},function(a){null!==a&&t.l(a,V,Yg,"handleArchetype");this.Sk=a});t.A(Yg,{handle:"handle"},function(){return this.kc});t.defineProperty(Yg,{uc:"adornedObject"},function(){return this.ob},function(a){null!==a&&t.l(a,V,Yg,"adornedObject");this.ob=a});Yg.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;return null!==a&&!a.hb&&a.ap&&a.T.left?null!==this.findToolHandleAt(a.Rc.da,this.name)?!0:!1:!1};
Yg.prototype.doActivate=function(){var a=this.h;null!==a&&(this.kc=this.findToolHandleAt(a.Rc.da,this.name),null!==this.kc&&(this.ob=this.kc.U.uc,this.yz.set(this.ob.U.location),this.Kv.set(this.ob.Ea),this.az=this.computeCellSize(),this.cz=this.computeMinSize(),this.bz=this.computeMaxSize(),a.Qd=!0,this.kD=a.mc.isEnabled,a.mc.isEnabled=!1,this.yc(this.name),this.la=!0))};Yg.prototype.doDeactivate=function(){var a=this.h;null!==a&&(this.vk(),this.ob=this.kc=null,this.la=a.Qd=!1,a.mc.isEnabled=this.kD)};
Yg.prototype.doCancel=function(){this.ob.Ea=this.Kv;this.ob.U.location=this.yz;this.stopTool()};Yg.prototype.doMouseMove=function(){var a=this.h;if(this.la&&null!==a){var b=this.cz,c=this.bz,d=this.az,f=this.ob.jF(a.T.da,t.N()),g=bh;this.ob instanceof W&&(g=this.ob.Ww,g===ch&&(g=this.ob.Ta.Ac));b=this.computeResize(f,this.kc.alignment,b,c,d,!(g===dh||g===eh||a.T.shift));this.resize(b);a.Ig();t.B(f)}};
Yg.prototype.doMouseUp=function(){var a=this.h;if(this.la&&null!==a){var b=this.cz,c=this.bz,d=this.az,f=this.ob.jF(a.T.da,t.N()),g=bh;this.ob instanceof W&&(g=this.ob.Ww,g===ch&&(g=this.ob.Ta.Ac));b=this.computeResize(f,this.kc.alignment,b,c,d,!(g===dh||g===eh||a.T.shift));this.resize(b);t.B(f);a.Sc();this.mf=this.name;a.Ga("PartResized",this.ob,this.Kv)}this.stopTool()};
Yg.prototype.resize=function(a){if(null!==this.h){var b=this.uc,c=b.U,d=b.ul(),f=b.sk(),g=Math.PI*d/180,h=Math.cos(g),g=Math.sin(g),k=0<d&&180>d?1:0,l=90<d&&270>d?1:0,d=180<d&&360>d?1:0,m=a.width-b.Ja.width,n=a.height-b.Ja.height,p=c.position.copy();p.x+=f*((a.x+m*l)*h-(a.y+n*k)*g);p.y+=f*((a.x+m*d)*g+(a.y+n*l)*h);b.Ea=a.size;c.xf();c.move(p)}};
Yg.prototype.computeResize=function(a,b,c,d,f,g){b.Me()&&(b=Yb);var h=this.uc.Ja,k=h.x,l=h.y,m=h.x+h.width,n=h.y+h.height,p=1;if(!g){var p=h.width,q=h.height;0>=p&&(p=1);0>=q&&(q=1);p=q/p}q=t.N();K.rt(a.x,a.y,k,l,f.width,f.height,q);a=h.copy();0>=b.x?0>=b.y?(a.x=Math.max(q.x,m-d.width),a.x=Math.min(a.x,m-c.width),a.width=Math.max(m-a.x,c.width),a.y=Math.max(q.y,n-d.height),a.y=Math.min(a.y,n-c.height),a.height=Math.max(n-a.y,c.height),g||(b=a.height/a.width,p<b?(a.height=p*a.width,a.y=n-a.height):
(a.width=a.height/p,a.x=m-a.width))):1<=b.y?(a.x=Math.max(q.x,m-d.width),a.x=Math.min(a.x,m-c.width),a.width=Math.max(m-a.x,c.width),a.height=Math.max(Math.min(q.y-l,d.height),c.height),g||(b=a.height/a.width,p<b?a.height=p*a.width:(a.width=a.height/p,a.x=m-a.width))):(a.x=Math.max(q.x,m-d.width),a.x=Math.min(a.x,m-c.width),a.width=m-a.x,g||(a.height=p*a.width,a.y=l+0.5*(n-l-a.height))):1<=b.x?0>=b.y?(a.width=Math.max(Math.min(q.x-k,d.width),c.width),a.y=Math.max(q.y,n-d.height),a.y=Math.min(a.y,
n-c.height),a.height=Math.max(n-a.y,c.height),g||(b=a.height/a.width,p<b?(a.height=p*a.width,a.y=n-a.height):a.width=a.height/p)):1<=b.y?(a.width=Math.max(Math.min(q.x-k,d.width),c.width),a.height=Math.max(Math.min(q.y-l,d.height),c.height),g||(b=a.height/a.width,p<b?a.height=p*a.width:a.width=a.height/p)):(a.width=Math.max(Math.min(q.x-k,d.width),c.width),g||(a.height=p*a.width,a.y=l+0.5*(n-l-a.height))):0>=b.y?(a.y=Math.max(q.y,n-d.height),a.y=Math.min(a.y,n-c.height),a.height=n-a.y,g||(a.width=
a.height/p,a.x=k+0.5*(m-k-a.width))):1<=b.y&&(a.height=Math.max(Math.min(q.y-l,d.height),c.height),g||(a.width=a.height/p,a.x=k+0.5*(m-k-a.width)));t.B(q);return a};Yg.prototype.computeMinSize=function(){var a=this.uc.Yf.copy(),b=this.Yf;!isNaN(b.width)&&b.width>a.width&&(a.width=b.width);!isNaN(b.height)&&b.height>a.height&&(a.height=b.height);return a};
Yg.prototype.computeMaxSize=function(){var a=this.uc.Oe.copy(),b=this.Oe;!isNaN(b.width)&&b.width<a.width&&(a.width=b.width);!isNaN(b.height)&&b.height<a.height&&(a.height=b.height);return a};
Yg.prototype.computeCellSize=function(){var a=new ra(NaN,NaN),b=this.uc.U;if(b){var c=b.oG;!isNaN(c.width)&&0<c.width&&(a.width=c.width);!isNaN(c.height)&&0<c.height&&(a.height=c.height)}c=this.ml;isNaN(a.width)&&!isNaN(c.width)&&0<c.width&&(a.width=c.width);isNaN(a.height)&&!isNaN(c.height)&&0<c.height&&(a.height=c.height);b=this.h;(isNaN(a.width)||isNaN(a.height))&&b&&(c=b.Cb.Od,null!==c&&c.Dp&&(c=c.CA,isNaN(a.width)&&!isNaN(c.width)&&0<c.width&&(a.width=c.width),isNaN(a.height)&&!isNaN(c.height)&&
0<c.height&&(a.height=c.height)),b=b.xp,null!==b&&b.visible&&this.Dp&&(c=b.vt,isNaN(a.width)&&!isNaN(c.width)&&0<c.width&&(a.width=c.width),isNaN(a.height)&&!isNaN(c.height)&&0<c.height&&(a.height=c.height)));if(isNaN(a.width)||0===a.width||Infinity===a.width)a.width=1;if(isNaN(a.height)||0===a.height||Infinity===a.height)a.height=1;return a};t.g(Yg,"minSize",Yg.prototype.Yf);
t.defineProperty(Yg,{Yf:"minSize"},function(){return this.Tj},function(a){t.l(a,ra,Yg,"minSize");if(!this.Tj.O(a)){var b=a.width;isNaN(b)&&(b=0);a=a.height;isNaN(a)&&(a=0);this.Tj.p(b,a)}});t.g(Yg,"maxSize",Yg.prototype.Oe);t.defineProperty(Yg,{Oe:"maxSize"},function(){return this.Sj},function(a){t.l(a,ra,Yg,"maxSize");if(!this.Sj.O(a)){var b=a.width;isNaN(b)&&(b=Infinity);a=a.height;isNaN(a)&&(a=Infinity);this.Sj.p(b,a)}});t.g(Yg,"cellSize",Yg.prototype.ml);
t.defineProperty(Yg,{ml:"cellSize"},function(){return this.Dj},function(a){t.l(a,ra,Yg,"cellSize");this.Dj.O(a)||this.Dj.assign(a)});t.g(Yg,"isGridSnapEnabled",Yg.prototype.Dp);t.defineProperty(Yg,{Dp:"isGridSnapEnabled"},function(){return this.jr},function(a){t.i(a,"boolean",Yg,"isGridSnapEnabled");this.jr=a});t.g(Yg,"originalDesiredSize",Yg.prototype.TJ);t.A(Yg,{TJ:"originalDesiredSize"},function(){return this.Kv});t.g(Yg,"originalLocation",Yg.prototype.UJ);t.A(Yg,{UJ:"originalLocation"},function(){return this.yz});
function fh(){0<arguments.length&&t.fd(fh);ze.call(this);this.name="Rotating";this.DD=45;this.CD=2;this.ob=null;var a=new W;a.Eb="Ellipse";a.Ea=K.$x;a.fill="lightblue";a.stroke="dodgerblue";a.lb=1;a.cursor="pointer";this.Sk=a;this.kc=null;this.Jv=0;this.yD=new E}t.ka("RotatingTool",fh);t.Qa(fh,ze);
fh.prototype.updateAdornments=function(a){if(!(null===a||a instanceof B)){if(a.ib&&!this.h.hb){var b=a.tG;if(null!==b&&a.canRotate()&&a.pa.P()&&a.Wa()&&b.pa.P()&&b.Cl()){var c=a.np(this.name);null===c&&(c=this.makeAdornment(b));if(null!==c){c.angle=b.ul();var d=null,f=null;b===a||b===a.Zb?(d=a.Zb,f=a.gf):(d=b,f=Yb);for(var g=d.Ja,f=t.qc(g.width*f.x+f.offsetX,g.height*f.y+f.offsetY);null!==d&&d!==b;)d.transform.Xa(f),d=d.ia;var d=f.y,g=Math.max(f.x-b.Ja.width,0),h=t.N();c.location=b.wb(new L(1,0,50+
g,d),h);t.B(h);t.B(f);a.il(this.name,c);return}}}a.Hl(this.name)}};fh.prototype.makeAdornment=function(a){var b=null,b=a.U.sG;if(null===b){b=new ea;b.type=gh;b.gf=Yb;var c=this.wt;null!==c&&b.add(c.copy())}else if(cf(b),b=b.copy(),!(b instanceof ea))return null;b.cd=this.name;b.uc=a;return b};t.defineProperty(fh,{wt:"handleArchetype"},function(){return this.Sk},function(a){null!==a&&t.l(a,V,fh,"handleArchetype");this.Sk=a});t.A(fh,{handle:"handle"},function(){return this.kc});
t.defineProperty(fh,{uc:"adornedObject"},function(){return this.ob},function(a){null!==a&&t.l(a,V,fh,"adornedObject");this.ob=a});fh.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;return null!==a&&!a.hb&&a.bp&&a.T.left?null!==this.findToolHandleAt(a.Rc.da,this.name)?!0:!1:!1};
fh.prototype.doActivate=function(){var a=this.h;if(null!==a&&(this.kc=this.findToolHandleAt(a.Rc.da,this.name),null!==this.kc)){this.ob=this.kc.U.uc;var b=this.ob.U,c=b.Zb;this.yD=this.ob===b||this.ob===c?c.wb(b.gf):this.ob.wb(Yb);this.Jv=this.ob.angle;a.Qd=!0;a.Kw=!0;this.yc(this.name);this.la=!0}};fh.prototype.doDeactivate=function(){var a=this.h;null!==a&&(this.vk(),this.ob=this.kc=null,this.la=a.Qd=!1)};fh.prototype.doCancel=function(){var a=this.h;a&&(a.Kw=!1);this.rotate(this.Jv);this.stopTool()};
fh.prototype.doMouseMove=function(){var a=this.h;this.la&&null!==a&&(a=this.computeRotate(a.T.da),this.rotate(a))};fh.prototype.doMouseUp=function(){var a=this.h;if(this.la&&null!==a){a.Kw=!1;var b=this.computeRotate(a.T.da);this.rotate(b);a.Sc();this.mf=this.name;a.Ga("PartRotated",this.ob,this.Jv)}this.stopTool()};fh.prototype.rotate=function(a){e&&t.q(a,fh,"rotate:newangle");null!==this.ob&&(this.ob.angle=a)};
fh.prototype.computeRotate=function(a){a=this.yD.mj(a);var b=this.ob.ia;b&&(a-=b.ul(),360<=a?a-=360:0>a&&(a+=360));var b=Math.min(Math.abs(this.MG),180),c=Math.min(Math.abs(this.LG),b/2);!this.h.T.shift&&0<b&&0<c&&(a%b<c?a=Math.floor(a/b)*b:a%b>b-c&&(a=(Math.floor(a/b)+1)*b));360<=a?a-=360:0>a&&(a+=360);return a};t.g(fh,"snapAngleMultiple",fh.prototype.MG);t.defineProperty(fh,{MG:"snapAngleMultiple"},function(){return this.DD},function(a){t.i(a,"number",fh,"snapAngleMultiple");this.DD=a});
t.g(fh,"snapAngleEpsilon",fh.prototype.LG);t.defineProperty(fh,{LG:"snapAngleEpsilon"},function(){return this.CD},function(a){t.i(a,"number",fh,"snapAngleEpsilon");this.CD=a});t.g(fh,"originalAngle",fh.prototype.SJ);t.A(fh,{SJ:"originalAngle"},function(){return this.Jv});function hh(){0<arguments.length&&t.fd(hh);ze.call(this);this.name="ClickSelecting"}t.ka("ClickSelectingTool",hh);t.Qa(hh,ze);hh.prototype.canStart=function(){return!this.isEnabled||null===this.h||this.isBeyondDragSize()?!1:!0};
hh.prototype.doMouseUp=function(){this.la&&(this.standardMouseSelect(),this.standardMouseClick());this.stopTool()};function ih(){0<arguments.length&&t.fd(ih);ze.call(this);this.name="Action";this.Kn=null}t.ka("ActionTool",ih);t.Qa(ih,ze);ih.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;if(null===a)return!1;var b=a.T,c=a.de(b.da,function(a){for(;null!==a.ia&&!a.Bt;)a=a.ia;return a},function(a){return a.Bt});return null!==c?(this.Kn=c,a.Sn=a.de(b.da,null,null),!0):!1};
ih.prototype.doMouseDown=function(){if(this.la){var a=this.h.T,b=this.Kn;null!==b&&(a.ke=b,null!==b.Tz&&b.Tz(a,b))}else this.canStart()&&this.doActivate()};ih.prototype.doMouseMove=function(){if(this.la){var a=this.h.T,b=this.Kn;null!==b&&(a.ke=b,null!==b.Uz&&b.Uz(a,b))}};ih.prototype.doMouseUp=function(){if(this.la){var a=this.h,b=a.T,c=this.Kn;if(null===c)return;b.ke=c;null!==c.Vz&&c.Vz(b,c);this.isBeyondDragSize()||hf(c,b,a)}this.stopTool()};
ih.prototype.doCancel=function(){var a=this.h;if(null!==a){var a=a.T,b=this.Kn;if(null===b)return;a.ke=b;null!==b.Sz&&b.Sz(a,b)}this.stopTool()};ih.prototype.doStop=function(){this.Kn=null};function Da(){0<arguments.length&&t.fd(Da);ze.call(this);this.name="ClickCreating";this.Kk=null;this.PC=!0;this.FC=new E(0,0)}t.ka("ClickCreatingTool",Da);t.Qa(Da,ze);
Da.prototype.canStart=function(){if(!this.isEnabled||null===this.ct)return!1;var a=this.h;if(null===a||a.hb||a.ef||!a.Pm||!a.T.left||this.isBeyondDragSize())return!1;if(this.BF){if(1===a.T.Ge&&(this.FC=a.T.Wd.copy()),2!==a.T.Ge||this.isBeyondDragSize(this.FC))return!1}else if(1!==a.T.Ge)return!1;return a.Ya!==this&&null!==a.st(a.T.da,!0)?!1:!0};Da.prototype.doMouseUp=function(){var a=this.h;this.la&&null!==a&&this.insertPart(a.T.da);this.stopTool()};
Da.prototype.insertPart=function(a){var b=this.h;if(null===b)return null;var c=this.ct;if(null===c)return null;this.yc(this.name);var d=null;c instanceof x?c.Rd()&&(cf(c),d=c.copy(),d instanceof x&&b.add(d)):null!==c&&(c=b.ea.copyNodeData(c),t.xb(c)&&(b.ea.Om(c),d=b.qh(c)));d instanceof x&&(d.location=a,b.Ve&&b.select(d));b.Sc();this.mf=this.name;b.Ga("PartCreated",d);this.vk();return d instanceof x?d:null};t.g(Da,"archetypeNodeData",Da.prototype.ct);
t.defineProperty(Da,{ct:"archetypeNodeData"},function(){return this.Kk},function(a){null!==a&&t.l(a,Object,Da,"archetypeNodeData");this.Kk=a});t.g(Da,"isDoubleClick",Da.prototype.BF);t.defineProperty(Da,{BF:"isDoubleClick"},function(){return this.PC},function(a){t.i(a,"boolean",Da,"isDoubleClick");this.PC=a});
function jh(){0<arguments.length&&t.fd(jh);ze.call(this);this.name="ContextMenu";this.Tn=this.nC=null;this.eD=new E;this.ao=null;if(!0===t.CB){this.ao=new ea;this.Ry=null;var a=this;this.VD=function(){a.stopTool()};if(!1===t.KE){var b=document.createElement("div"),c=document.createElement("div");b.style.cssText="top: 0px;z-index:300;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px";
c.style.cssText="z-index:299;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;-moz-opacity: 0.8;opacity:.80;filter: alpha(opacity=80);";var d=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(d);d.sheet.insertRule(".defaultCXul { list-style: none; }",0);d.sheet.insertRule(".defaultCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0);d.sheet.insertRule(".defaultCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",
0);b.addEventListener("contextmenu",function(a){a.preventDefault();return!1},!1);b.addEventListener("selectstart",function(a){a.preventDefault();return!1},!1);c.addEventListener("contextmenu",function(a){a.preventDefault();return!1},!1);document.body&&(document.body.appendChild(b),document.body.appendChild(c));t.it=b;t.ht=c;t.KE=!0}}}t.ka("ContextMenuTool",jh);t.Qa(jh,ze);
jh.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;return null===a||this.isBeyondDragSize()||!a.T.right?!1:(null===this.ao||a.T.event instanceof MouseEvent)&&null===this.findObjectWithContextMenu()?!1:!0};jh.prototype.doStart=function(){var a=this.h;null!==a&&this.eD.set(a.Rc.da)};jh.prototype.doStop=function(){this.hideDefaultContextMenu();this.hideContextMenu();this.Tn=null};
jh.prototype.findObjectWithContextMenu=function(a){var b=this.h;if(null===b)return null;var c=b.T,d=null,d=void 0!==a?a:b.de(c.da,null,function(a){return!a.layer.Dc});if(null!==d){for(a=d;null!==a;){c=a.contextMenu;if(null!==c)return a;a=a.ia}if(null!==this.ao&&!(b.T.event instanceof MouseEvent))return d.U}else if(c=b.contextMenu,null!==c)return b;return null};jh.prototype.doActivate=function(){};
jh.prototype.doMouseDown=function(){if(this.la){var a=this.h;if(null!==a&&null!==this.wf){var b=a.de(a.T.da,null,null);null!==b&&b.rj(this.wf)?(this.standardMouseClick(null,null),this.stopTool()):(this.stopTool(),a.Ya.doMouseDown())}}};jh.prototype.doMouseUp=function(){this.la||this.canStart()&&gf(this,!0)};
function gf(a,b,c){a.la=!0;b&&a.standardMouseSelect();a.standardMouseClick();a.Tn=null;void 0===c&&(c=a.findObjectWithContextMenu());null!==c?(b=c.contextMenu,null!==b?(a.Tn=c instanceof V?c:null,a.showContextMenu(b,a.Tn)):a.showDefaultContextMenu()):a.showDefaultContextMenu()}jh.prototype.doMouseMove=function(){this.la&&this.standardMouseOver()};
jh.prototype.showContextMenu=function(a,b){t.l(a,ea,jh,"showContextMenu:contextmenu");null!==b&&t.l(b,V,jh,"showContextMenu:obj");var c=this.h;if(null!==c){a!==this.wf&&this.hideContextMenu();a.Ne="Tool";a.uk=!1;a.scale=1/c.scale;a.cd=this.name;c.add(a);if(null!==b){var c=null,d=b.qp();null!==d&&(c=d.data);a.uc=b;a.data=c}else a.data=c.ea;a.xf();this.positionContextMenu(a,b);this.wf=a}};
jh.prototype.positionContextMenu=function(a){var b=this.h;if(null!==b){var c=b.T.da.copy(),d=a.Ha,f=b.Ab;b.T.lx&&(c.x-=d.width);c.x+d.width>f.right&&(c.x-=d.width+5);c.x<f.x&&(c.x=f.x);c.y+d.height>f.bottom&&(c.y-=d.height+5);c.y<f.y&&(c.y=f.y);a.position=c}};jh.prototype.hideContextMenu=function(){var a=this.h;null!==a&&null!==this.wf&&(this.wf.data=null,this.wf.uc=null,a.remove(this.wf),this.wf=null,this.standardMouseOver())};
jh.prototype.initializeDefaultButtons=function(){if(null===this.h)return null;var a=new H,b=this.h.Ye;a.add({text:"Copy",oh:function(){b.copySelection()},visible:function(){return b.canCopySelection()}});a.add({text:"Cut",oh:function(){b.cutSelection()},visible:function(){return b.canCutSelection()}});a.add({text:"Delete",oh:function(){b.deleteSelection()},visible:function(){return b.canDeleteSelection()}});a.add({text:"Paste",oh:function(a){b.pasteSelection(a.T.da)},visible:function(){return b.canPasteSelection()}});
a.add({text:"Select All",oh:function(){b.selectAll()},visible:function(){return b.canSelectAll()}});a.add({text:"Undo",oh:function(){b.undo()},visible:function(){return b.canUndo()}});a.add({text:"Redo",oh:function(){b.redo()},visible:function(){return b.canRedo()}});a.add({text:"Zoom To Fit",oh:function(){b.zoomToFit()},visible:function(){return b.canZoomToFit()}});a.add({text:"Reset Zoom",oh:function(){b.resetZoom()},visible:function(){return b.canResetZoom()}});a.add({text:"Group Selection",oh:function(){b.groupSelection()},
visible:function(){return b.canGroupSelection()}});a.add({text:"Ungroup Selection",oh:function(){b.ungroupSelection()},visible:function(){return b.canUngroupSelection()}});a.add({text:"Edit Text",oh:function(){b.editTextBlock()},visible:function(){return b.canEditTextBlock()}});return a};
jh.prototype.showDefaultContextMenu=function(){var a=this.h;if(null!==a){null===this.Ry&&(this.Ry=this.initializeDefaultButtons());this.ao!==this.wf&&this.hideContextMenu();t.it.innerHTML="";t.ht.addEventListener("click",this.VD,!1);var b=this,c=document.createElement("ul");c.className="defaultCXul";t.it.appendChild(c);c.innerHTML="";for(var d=this.Ry.k;d.next();){var f=d.value,g=f.text,h=f.visible;if("function"!==typeof h||h()){h=document.createElement("li");h.className="defaultCXli";var k=document.createElement("a");
k.className="defaultCXa";k.href="#";k.AH=f.oh;k.addEventListener("click",function(c){this.AH(a);b.stopTool();c.preventDefault();return!1},!1);k.textContent=g;h.appendChild(k);c.appendChild(h)}}t.it.style.display="block";t.ht.style.display="block";this.wf=this.ao}};jh.prototype.hideDefaultContextMenu=function(){null!==this.wf&&this.wf===this.ao&&(t.it.style.display="none",t.ht.style.display="none",t.ht.removeEventListener("click",this.VD,!1),this.wf=null)};t.g(jh,"currentContextMenu",jh.prototype.wf);
t.defineProperty(jh,{wf:"currentContextMenu"},function(){return this.nC},function(a){null!==a&&t.l(a,ea,jh,"currentContextMenu");this.nC=a});t.g(jh,"currentObject",jh.prototype.AI);t.defineProperty(jh,{AI:"currentObject"},function(){return this.Tn},function(a){null!==a&&t.l(a,V,jh,"currentObject");this.Tn=a});t.A(jh,{RK:"mouseDownPoint"},function(){return this.eD});
function kh(){0<arguments.length&&t.fd(kh);ze.call(this);this.name="DragSelecting";this.bo=175;this.UC=!1;var a=new x;a.Ne="Tool";a.uk=!1;var b=new W;b.name="SHAPE";b.Eb="Rectangle";b.fill=null;b.stroke="magenta";a.add(b);this.Vl=a}t.ka("DragSelectingTool",kh);t.Qa(kh,ze);
kh.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;if(null===a||!a.Ve)return!1;var b=a.T;return!b.left||a.Ya!==this&&(!this.isBeyondDragSize()||b.timestamp-a.Rc.timestamp<this.Jw||null!==a.st(b.da,!0))?!1:!0};kh.prototype.doActivate=function(){var a=this.h;null!==a&&(this.la=!0,a.Qd=!0,a.ab=!0,a.add(this.Bg),this.doMouseMove())};kh.prototype.doDeactivate=function(){var a=this.h;null!==a&&(a.remove(this.Bg),a.ab=!1,this.la=a.Qd=!1)};
kh.prototype.doMouseMove=function(){if(null!==this.h&&this.la&&null!==this.Bg){var a=this.computeBoxBounds(),b=this.Bg.ue("SHAPE");null===b&&(b=this.Bg.Rw());b.Ea=a.size;this.Bg.position=a.position}};kh.prototype.doMouseUp=function(){if(this.la){var a=this.h;a.remove(this.Bg);try{a.gc="wait",this.selectInRect(this.computeBoxBounds())}finally{a.gc=""}}this.stopTool()};kh.prototype.computeBoxBounds=function(){var a=this.h;return null===a?new F(0,0,0,0):new F(a.Rc.da,a.T.da)};
kh.prototype.selectInRect=function(a){var b=this.h;if(null!==b){var c=b.T;b.Ga("ChangingSelection");a=b.pk(a,null,function(a){return a instanceof x&&a.canSelect()},this.GF);if(t.ln?c.Op:c.control)if(c.shift)for(a=a.k;a.next();)c=a.value,c.ib&&(c.ib=!1);else for(a=a.k;a.next();)c=a.value,c.ib=!c.ib;else{if(!c.shift){for(var d=new H(x),f=b.selection.k;f.next();)c=f.value,a.contains(c)||d.add(c);for(d=d.k;d.next();)c=d.value,c.ib=!1}for(a=a.k;a.next();)c=a.value,c.ib||(c.ib=!0)}b.Ga("ChangedSelection")}};
t.g(kh,"delay",kh.prototype.Jw);t.defineProperty(kh,{Jw:"delay"},function(){return this.bo},function(a){t.i(a,"number",kh,"delay");this.bo=a});t.g(kh,"isPartialInclusion",kh.prototype.GF);t.defineProperty(kh,{GF:"isPartialInclusion"},function(){return this.UC},function(a){t.i(a,"boolean",kh,"isPartialInclusion");this.UC=a});t.g(kh,"box",kh.prototype.Bg);t.defineProperty(kh,{Bg:"box"},function(){return this.Vl},function(a){null!==a&&t.l(a,x,kh,"box");this.Vl=a});
function lh(){0<arguments.length&&t.fd(lh);ze.call(this);this.name="Panning";this.Az=new E;this.Cj=!1;var a=this;this.JD=function(){document.removeEventListener("scroll",a.JD,!1);a.stopTool()}}t.ka("PanningTool",lh);t.Qa(lh,ze);lh.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;return null===a||!a.tf&&!a.uf||!a.T.left||a.Ya!==this&&!this.isBeyondDragSize()?!1:!0};
lh.prototype.doActivate=function(){var a=this.h;null!==a&&(this.Cj?(a.T.bubbles=!0,document.addEventListener("scroll",this.JD,!1)):(a.gc="move",a.Qd=!0,this.Az=a.position.copy()),this.la=!0)};lh.prototype.doDeactivate=function(){var a=this.h;null!==a&&(a.gc="",this.la=a.Qd=!1)};lh.prototype.doCancel=function(){var a=this.h;null!==a&&(a.position=this.Az,a.Qd=!1);this.stopTool()};lh.prototype.doMouseMove=function(){this.move()};lh.prototype.doMouseUp=function(){this.move();this.stopTool()};
lh.prototype.move=function(){var a=this.h;if(this.la&&a)if(this.Cj)a.T.bubbles=!0;else{var b=a.position,c=a.Rc.da,d=a.T.da,f=b.x+c.x-d.x,c=b.y+c.y-d.y;a.tf||(f=b.x);a.uf||(c=b.y);a.position=new E(f,c)}};t.g(lh,"bubbles",lh.prototype.bubbles);t.defineProperty(lh,{bubbles:"bubbles"},function(){return this.Cj},function(a){t.i(a,"boolean",lh,"bubbles");this.Cj=a});t.g(lh,"originalPosition",lh.prototype.XJ);t.A(lh,{XJ:"originalPosition"},function(){return this.Az});
function mh(){0<arguments.length&&t.fd(mh);ze.call(this);this.name="TextEditing";this.qC=this.Nz=this.ND=null;this.HD=vh;this.fl=null;this.cb=wh;this.bl=null;var a=document.createElement("textarea");a.aC=!0;this.vC=a;a.addEventListener("input",function(){var a=this.textEditingTool.ND;a.text=this.value;xh(a,Infinity,Infinity);this.style.width=20+a.Ha.width*this.wK+"px";this.rows=a.NF},!1);a.addEventListener("keydown",function(a){var c=a.which,d=this.textEditingTool;if(null!==d)if(13===c)d.acceptText(yh);
else{if(9===c)return d.acceptText(zh),a.preventDefault(),!1;27===c&&(d.doCancel(),d.h&&d.h.focus())}},!1);a.addEventListener("focus",function(){var a=this.textEditingTool;a.cb===Ah?a.cb=Bh:a.cb===Ch?a.cb=Dh:a.cb===Dh&&(a.cb=Bh);this.select()},!1);a.addEventListener("blur",function(){this.focus();this.select()},!1)}t.ka("TextEditingTool",mh);t.Qa(mh,ze);var Eh;mh.LostFocus=Eh=t.w(mh,"LostFocus",0);var Fh;mh.MouseDown=Fh=t.w(mh,"MouseDown",1);var zh;mh.Tab=zh=t.w(mh,"Tab",2);var yh;
mh.Enter=yh=t.w(mh,"Enter",3);mh.SingleClick=t.w(mh,"SingleClick",0);var vh;mh.SingleClickSelected=vh=t.w(mh,"SingleClickSelected",1);var wh=t.w(mh,"StateNone",0),Ah=t.w(mh,"StateActive",1),Bh=t.w(mh,"StateEditing",2),Dh=t.w(mh,"StateEditing2",3),Gh=t.w(mh,"StateValidating",4),Ch=t.w(mh,"StateValidated",5);t.g(mh,"textBlock",mh.prototype.Ug);t.defineProperty(mh,{Ug:"textBlock"},function(){return this.Nz},function(a){null!==a&&t.l(a,za,mh,"textBlock");this.Nz=a});t.g(mh,"currentTextEditor",mh.prototype.ph);
t.defineProperty(mh,{ph:"currentTextEditor"},function(){return this.qC},function(a){this.qC=a});t.g(mh,"defaultTextEditor",mh.prototype.ME);t.defineProperty(mh,{ME:"defaultTextEditor"},function(){return this.vC},function(a){this.vC=a});t.g(mh,"starting",mh.prototype.NG);t.defineProperty(mh,{NG:"starting"},function(){return this.HD},function(a){t.Fa(a,mh,mh,"starting");this.HD=a});
mh.prototype.canStart=function(){if(!this.isEnabled)return!1;var a=this.h;if(null===a||a.hb||!a.T.left||this.isBeyondDragSize())return!1;a=a.de(a.T.da,null,function(a){return a instanceof za});if(!(a instanceof za&&a.Mw&&a.U.canEdit()))return!1;a=a.U;return null===a||this.NG===vh&&!a.ib?!1:!0};mh.prototype.doStart=function(){this.la||null===this.Ug||this.doActivate()};
mh.prototype.doActivate=function(){if(!this.la){var a=this.h;if(null!==a){var b=this.Ug;null===b&&(b=a.de(a.T.da,function(a){return a instanceof za?a:null}),b=b instanceof za?b:null);if(null!==b&&(this.Ug=b,null!==b.U)){this.la=!0;this.cb=Ah;var c=this.ME,d=!1;null!==b.EB&&(c=b.EB);null===c||c.aC||(d=!0);this.ND=this.Ug.copy();if(c.aC){var f=b.wb(Yb),g=a.position,h=a.scale,k=b.sk()*h,l=b.Ja.width*k;Hh(b);var m=(f.x-g.x)*h,f=(f.y-g.y)*h;c.value=b.text;a.nj.style.font=b.font;c.style.font="inherit";
c.style.fontSize=100*k+"%";c.style.lineHeight="normal";l=20+l;c.style.width=l+"px";c.style.height="";c.rows=b.NF;a.nj.appendChild(c);c.style.left=(m-l/2|0)+"px";c.style.top=(f-c.clientHeight/2|0)+"px";c.style.textAlign=b.textAlign}else a.nj.appendChild(c);c.style.position="absolute";c.style.zIndex=100;c.className="start";c.textEditingTool=this;c.wK=k;if(d&&void 0!==c.onActivate)c.onActivate();this.ph=c;c.focus();c.select()}}}};
mh.prototype.doCancel=function(){null!==this.bl&&(this.ph.style.border=this.bl,this.bl=null);this.stopTool()};mh.prototype.doMouseUp=function(){!this.la&&this.canStart()&&this.doActivate()};mh.prototype.doMouseDown=function(){this.la&&this.acceptText(Fh)};
mh.prototype.acceptText=function(a){switch(a){case Fh:if(this.cb===Ch||this.cb===Dh)this.ph.focus();else if(this.cb===Ah||this.cb===Bh)this.cb=Gh,Ih(this);break;case Eh:case yh:case zh:if(yh===a&&!0===this.Nz.kx)break;if(this.cb===Ah||this.cb===Bh)this.cb=Gh,Ih(this)}};
function Ih(a){if(null!==a.Ug&&null!==a.ph){var b=a.Ug,c=a.Ug.text,d=a.ph.value,f="",f="function"===typeof d?d():d;if(!a.isValidText(a.Ug,c,f)){a.cb=Bh;null!==b.pt&&b.pt(a,c,f);null===a.bl&&(a.bl=a.ph.style.border,a.ph.style.border="3px solid red");a.ph.focus();return}a.yc(a.name);a.cb=Ch;c!==f&&(a.Ug.text=f);a.mf=a.name;b=a.h;null!==b&&b.Ga("TextEdited",a.Ug,c);a.vk();a.stopTool();null!==b&&b.focus()}null!==a.bl&&(a.ph.style.border=a.bl,a.bl=null)}
mh.prototype.doDeactivate=function(){var a=this.h;if(null!==a){this.cb=wh;this.Ug=null;if(null!==this.ph){var b=this.ph;if(void 0!==b.onDeactivate)b.onDeactivate();null!==b&&a.nj.removeChild(b)}this.la=!1}};mh.prototype.isValidText=function(a,b,c){t.l(a,za,mh,"isValidText:textblock");var d=this.lu;if(null!==d&&!d(a,b,c))return!1;d=a.lu;return null===d||d(a,b,c)?!0:!1};t.g(mh,"textValidation",mh.prototype.lu);
t.defineProperty(mh,{lu:"textValidation"},function(){return this.fl},function(a){null!==a&&t.i(a,"function",mh,"textValidation");this.fl=a});function $e(){ze.call(this);this.name="ToolManager";this.fD=new H(ze);this.gD=new H(ze);this.hD=new H(ze);this.IC=this.JC=1E3;this.xC=(new ra(2,2)).Oa();this.Pu=this.Py=null;this.iD=kf}t.ka("ToolManager",$e);t.Qa($e,ze);var kf;$e.WheelScroll=kf=t.w($e,"WheelScroll",0);var jf;$e.WheelZoom=jf=t.w($e,"WheelZoom",1);$e.WheelNone=t.w($e,"WheelNone",2);
t.g($e,"mouseWheelBehavior",$e.prototype.un);t.defineProperty($e,{un:"mouseWheelBehavior"},function(){return this.iD},function(a){t.Fa(a,$e,$e,"mouseWheelBehavior");this.iD=a});$e.prototype.initializeStandardTools=function(){this.dE=new ih;this.jB=new yf;this.QF=new Qg;this.rG=new Yg;this.vG=new fh;this.QA=new Ca;this.Od=new lf;this.RE=new kh;this.gG=new lh;this.Dw=new jh;this.Ox=new mh;this.uE=new Da;this.vE=new hh};
$e.prototype.doMouseDown=function(){var a=this.h;if(null!==a){var b=a.ma;b.fA&&0!==b.Qe&&t.trace("WARNING: In ToolManager.doMouseDown: UndoManager.transactionLevel is not zero");for(var b=this.jf.length,c=0;c<b;c++){var d=this.jf.wa(c);null===d.h&&d.Ed(this.h);if(d.canStart()){a.Ya=d;a.Ya===d&&(d.la||d.doActivate(),d.doMouseDown());return}}1===a.T.button&&(this.un===kf?this.un=jf:this.un===jf&&(this.un=kf));this.doActivate();this.standardWaitAfter(this.EA)}};
$e.prototype.doMouseMove=function(){var a=this.h;if(null!==a){if(this.la)for(var b=this.Kg.length,c=0;c<b;c++){var d=this.Kg.wa(c);null===d.h&&d.Ed(this.h);if(d.canStart()){a.Ya=d;a.Ya===d&&(d.la||d.doActivate(),d.doMouseMove());return}}this.standardMouseOver();this.isBeyondDragSize()&&this.standardWaitAfter(this.la?this.EA:this.sF)}};$e.prototype.doCurrentObjectChanged=function(a,b){var c=this.ql;null===c||null!==b&&(b===c||b.rj(c))||this.hideToolTip()};
$e.prototype.doWaitAfter=function(){this.h&&this.h.Za&&(this.doMouseHover(),this.la||this.doToolTip())};$e.prototype.doMouseHover=function(){var a=this.h;if(null!==a){var b=a.T;null===b.ke&&(b.ke=a.de(b.da,null,null));var c=b.ke;if(null!==c)for(;null!==c;){a=this.la?c.Nt:c.Ot;if(null!==a&&(a(b,c),b.Ke))break;c=c.ia}else a=this.la?a.Nt:a.Ot,null!==a&&a(b)}};
$e.prototype.doToolTip=function(){var a=this.h;if(null!==a){var b=a.T;null===b.ke&&(b.ke=a.de(b.da,null,null));b=b.ke;if(null!==b){if(b!==this.ql&&!b.rj(this.ql)){for(;null!==b;){a=b.mu;if(null!==a){this.showToolTip(a,b);return}b=b.ia}this.hideToolTip()}}else a=a.mu,null!==a?this.showToolTip(a,null):this.hideToolTip()}};
$e.prototype.showToolTip=function(a,b){t.l(a,ea,$e,"showToolTip:tooltip");null!==b&&t.l(b,V,$e,"showToolTip:obj");var c=this.h;if(null!==c){a!==this.ql&&this.hideToolTip();a.Ne="Tool";a.uk=!1;a.scale=1/c.scale;c.add(a);if(null!==b&&b!==this.Pu){var c=null,d=b.qp();null!==d&&(c=d.data);a.uc=b;a.data=c}else null===b&&(a.data=c.ea);if(null===b||b!==this.Pu)a.xf(),this.positionToolTip(a,b);this.Py=a;this.Pu=b}};
$e.prototype.positionToolTip=function(a){var b=this.h;if(null!==b){var c=b.T.da.copy(),d=a.Ha,f=b.Ab;b.T.lx&&(c.x-=d.width);c.x+d.width>f.right&&(c.x-=d.width+5);c.x<f.x&&(c.x=f.x);c.y=c.y+20+d.height>f.bottom?c.y-(d.height+5):c.y+20;c.y<f.y&&(c.y=f.y);a.position=c}};$e.prototype.hideToolTip=function(){if(null!==this.ql){var a=this.h;null!==a&&(this.ql.data=null,this.ql.uc=null,a.remove(this.ql),this.Pu=this.Py=null)}};t.A($e,{ql:"currentToolTip"},function(){return this.Py});
$e.prototype.doMouseUp=function(){this.cancelWaitAfter();if(this.la){var a=this.h;if(null===a)return;for(var b=this.Lg.length,c=0;c<b;c++){var d=this.Lg.wa(c);null===d.h&&d.Ed(this.h);if(d.canStart()){a.Ya=d;a.Ya===d&&(d.la||d.doActivate(),d.doMouseUp());return}}}this.doDeactivate()};$e.prototype.doMouseWheel=function(){this.standardMouseWheel()};$e.prototype.doKeyDown=function(){var a=this.h;null!==a&&a.Ye.doKeyDown()};$e.prototype.doKeyUp=function(){var a=this.h;null!==a&&a.Ye.doKeyUp()};
$e.prototype.doCancel=function(){null!==wf&&wf.doCancel();ze.prototype.doCancel.call(this)};$e.prototype.findTool=function(a){t.i(a,"string",$e,"findTool:name");for(var b=this.jf.length,c=0;c<b;c++){var d=this.jf.wa(c);if(d.name===a)return d}b=this.Kg.length;for(c=0;c<b;c++)if(d=this.Kg.wa(c),d.name===a)return d;b=this.Lg.length;for(c=0;c<b;c++)if(d=this.Lg.wa(c),d.name===a)return d;return null};
$e.prototype.replaceTool=function(a,b){t.i(a,"string",$e,"replaceTool:name");null!==b&&(t.l(b,ze,$e,"replaceTool:newtool"),b.h&&b.h!==this.h&&t.m("Cannot share tools between Diagrams: "+b.toString()),b.Ed(this.h));for(var c=this.jf.length,d=0;d<c;d++){var f=this.jf.wa(d);if(f.name===a)return null!==b?this.jf.Tg(d,b):this.jf.wd(d),f}c=this.Kg.length;for(d=0;d<c;d++)if(f=this.Kg.wa(d),f.name===a)return null!==b?this.Kg.Tg(d,b):this.Kg.wd(d),f;c=this.Lg.length;for(d=0;d<c;d++)if(f=this.Lg.wa(d),f.name===
a)return null!==b?this.Lg.Tg(d,b):this.Lg.wd(d),f;return null};function Jh(a,b,c,d){t.i(b,"string",$e,"replaceStandardTool:name");t.l(d,H,$e,"replaceStandardTool:list");null!==c&&(t.l(c,ze,$e,"replaceStandardTool:newtool"),c.h&&c.h!==a.h&&t.m("Cannot share tools between Diagrams: "+c.toString()),c.name=b,c.Ed(a.h));a.findTool(b)?a.replaceTool(b,c):null!==c&&d.add(c)}t.A($e,{jf:"mouseDownTools"},function(){return this.fD});t.A($e,{Kg:"mouseMoveTools"},function(){return this.gD});
t.A($e,{Lg:"mouseUpTools"},function(){return this.hD});t.g($e,"hoverDelay",$e.prototype.sF);t.defineProperty($e,{sF:"hoverDelay"},function(){return this.JC},function(a){t.i(a,"number",$e,"hoverDelay");this.JC=a});t.g($e,"holdDelay",$e.prototype.EA);t.defineProperty($e,{EA:"holdDelay"},function(){return this.IC},function(a){t.i(a,"number",$e,"holdDelay");this.IC=a});t.g($e,"dragSize",$e.prototype.SE);
t.defineProperty($e,{SE:"dragSize"},function(){return this.xC},function(a){t.l(a,ra,$e,"dragSize");this.xC=a.ba()});t.g($e,"actionTool",$e.prototype.dE);t.defineProperty($e,{dE:"actionTool"},function(){return this.findTool("Action")},function(a){Jh(this,"Action",a,this.jf)});t.g($e,"relinkingTool",$e.prototype.jB);t.defineProperty($e,{jB:"relinkingTool"},function(){return this.findTool("Relinking")},function(a){Jh(this,"Relinking",a,this.jf)});t.g($e,"linkReshapingTool",$e.prototype.QF);
t.defineProperty($e,{QF:"linkReshapingTool"},function(){return this.findTool("LinkReshaping")},function(a){Jh(this,"LinkReshaping",a,this.jf)});t.g($e,"resizingTool",$e.prototype.rG);t.defineProperty($e,{rG:"resizingTool"},function(){return this.findTool("Resizing")},function(a){Jh(this,"Resizing",a,this.jf)});t.g($e,"rotatingTool",$e.prototype.vG);t.defineProperty($e,{vG:"rotatingTool"},function(){return this.findTool("Rotating")},function(a){Jh(this,"Rotating",a,this.jf)});
t.g($e,"linkingTool",$e.prototype.QA);t.defineProperty($e,{QA:"linkingTool"},function(){return this.findTool("Linking")},function(a){Jh(this,"Linking",a,this.Kg)});t.g($e,"draggingTool",$e.prototype.Od);t.defineProperty($e,{Od:"draggingTool"},function(){return this.findTool("Dragging")},function(a){Jh(this,"Dragging",a,this.Kg)});t.g($e,"dragSelectingTool",$e.prototype.RE);
t.defineProperty($e,{RE:"dragSelectingTool"},function(){return this.findTool("DragSelecting")},function(a){Jh(this,"DragSelecting",a,this.Kg)});t.g($e,"panningTool",$e.prototype.gG);t.defineProperty($e,{gG:"panningTool"},function(){return this.findTool("Panning")},function(a){Jh(this,"Panning",a,this.Kg)});t.g($e,"contextMenuTool",$e.prototype.Dw);t.defineProperty($e,{Dw:"contextMenuTool"},function(){return this.findTool("ContextMenu")},function(a){Jh(this,"ContextMenu",a,this.Lg)});
t.g($e,"textEditingTool",$e.prototype.Ox);t.defineProperty($e,{Ox:"textEditingTool"},function(){return this.findTool("TextEditing")},function(a){Jh(this,"TextEditing",a,this.Lg)});t.g($e,"clickCreatingTool",$e.prototype.uE);t.defineProperty($e,{uE:"clickCreatingTool"},function(){return this.findTool("ClickCreating")},function(a){Jh(this,"ClickCreating",a,this.Lg)});t.g($e,"clickSelectingTool",$e.prototype.vE);
t.defineProperty($e,{vE:"clickSelectingTool"},function(){return this.findTool("ClickSelecting")},function(a){Jh(this,"ClickSelecting",a,this.Lg)});function Ke(){this.CH=Kh;this.W=null;new wa;this.bm=this.cm=null;this.dC=this.zd=this.qr=this.Kj=!1;this.Re=!0;this.Ou=this.Nu=this.oC=null;this.Ny=0;this.Yy=600;this.IH=new E(0,0);this.fC=this.eC=this.ZD=!1;this.Io=new wa}function Kh(a,b,c,d){a/=d/2;return 1>a?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b}
Ke.prototype.prepareAnimation=Ke.prototype.Gl=function(){this.Re&&(this.Kj&&this.iq(),this.zd=!0,this.dC=!1)};function Lh(a){a.Re&&requestAnimationFrame(function(){!1===a.zd||a.Kj||(a.zd=!1,a.W.Ga("AnimationStarting"),Mh(a))})}
function Nh(a,b,c,d){if(a.zd&&(e&&(b instanceof V||t.m("addToAnimation:object must be a GraphObject.")),!(b instanceof x)||b.GA)){var f=a.Io,g;f.contains(b)?(b=f.Da(b),a=b[0],g=b[1],void 0===a.position&&(a.position=Oh(c)),g.position=Oh(d)):(a={},g={},a.position=Oh(c),g.position=Oh(d),f.add(b,[a,g]))}}function Oh(a){return a instanceof E?a.copy():a instanceof ra?a.copy():a}
function Mh(a){var b,c=a.W;if(null!==c)if(0===a.Io.count)a.Kj=!1,c.Ig();else{a.Kj=!0;b||(b={});var d=b.HK||a.CH,f=b.TK||null,g=b.UK||null,h=b.duration||a.Yy;b=a.Io.k;for(var k=a.IH;b.next();){var l=b.value[0].position;l&&!l.P()&&l.assign(k)}a.oC=d;a.Nu=f;a.Ou=g;a.Ny=h;var m=a.BH=a.Io;Ph(a);Qh(a,c,m,d,0,h,null!==a.cm&&null!==a.bm);Rh(a.W);Sh(a);requestAnimationFrame(function(b){var f=b||+new Date,g=f+h,k;(function u(b){!1!==a.Kj&&(k=b||+new Date,b=k>g?h:k-f,Ph(a),Qh(a,c,m,d,b,h,null!==a.cm&&null!==
a.bm),a.Nu&&a.Nu(),Rh(c),Sh(a),k>g?Th(a):requestAnimationFrame(u))})(f)})}}var Uh={opacity:function(a,b,c,d,f,g){a.opacity=d(f,b,c-b,g)},position:function(a,b,c,d,f,g){f!==g?a.GG(d(f,b.x,c.x-b.x,g),d(f,b.y,c.y-b.y,g)):a.position=new E(d(f,b.x,c.x-b.x,g),d(f,b.y,c.y-b.y,g))},scale:function(a,b,c,d,f,g){a.scale=d(f,b,c-b,g)},visible:function(a,b,c,d,f,g){a.visible=f!==g?b:c}};function Ph(a){if(!a.qr){var b=a.W;a.ZD=b.ab;a.eC=b.hu;a.fC=b.Oo;b.ab=!0;b.hu=!0;b.Oo=!0;a.qr=!0}}
function Sh(a){var b=a.W;b.ab=a.ZD;b.hu=a.eC;b.Oo=a.fC;a.qr=!1}function Qh(a,b,c,d,f,g,h){for(c=c.k;c.next();){var k=c.key,l=c.value,m=l[0],l=l[1],n;for(n in l)if(void 0!==Uh[n])Uh[n](k,m[n],l[n],d,f,g)}h&&(h=a.cm,a=a.bm,n=a.y-h.y,a=d(f,h.x,a.x-h.x,g),d=d(f,h.y,n,g),f=b.cc,b.cc=!0,b.position=new E(a,d),b.cc=f)}
Ke.prototype.stopAnimation=Ke.prototype.iq=function(){!0===this.zd&&(this.zd=!1,this.dC&&this.W.ie());this.Kj&&this.Re&&(Ph(this),Qh(this,this.W,this.BH,this.oC,this.Ny,this.Ny,null!==this.cm&&null!==this.bm),Sh(this),Th(this))};function Th(a){a.Kj=!1;a.cm=null;a.bm=null;a.Io=new wa;Ph(a);for(var b=a.W.links;b.next();){var c=b.value;null!==c.No&&(c.points=c.No,c.No=null)}b=a.W;b.Sc();b.Ig();Sh(a);a.Ou&&a.Ou();a.Ou=null;a.Nu=null;b.Ga("AnimationFinished")}
function Vh(a,b,c){var d=b.pa,f=c.pa;c instanceof z&&c.placeholder?(c=c.placeholder,d=c.wb(Vb),d.x+=c.padding.left,d.y+=c.padding.top,Nh(a,b,d,b.position)):Nh(a,b,new E(f.x+f.width/2-d.width/2,f.y+f.height/2-d.height/2),b.position)}function Wh(a,b,c){a.zd&&(null===a.cm&&b.P()&&null===a.bm&&(a.cm=b.copy()),a.bm=c.copy())}t.g(Ke,"isEnabled",Ke.prototype.isEnabled);t.defineProperty(Ke,{isEnabled:"isEnabled"},function(){return this.Re},function(a){t.i(a,"boolean",Ke,"isEnabled");this.Re=a});
t.g(Ke,"duration",Ke.prototype.duration);t.defineProperty(Ke,{duration:"duration"},function(){return this.Yy},function(a){t.i(a,"number",Ke,"duration");1>a&&t.ha(a,">= 1",Ke,"duration");this.Yy=a});t.A(Ke,{Eg:"isAnimating"},function(){return this.Kj});t.A(Ke,{KK:"isTicking"},function(){return this.qr});
function se(){0<arguments.length&&t.fd(se);t.Fc(this);this.W=null;this.mb=new H(x);this.ec="";this.Qf=1;this.oz=!1;this.dl=this.Rz=this.Hk=this.Gk=this.Fk=this.Ek=this.Ck=this.Dk=this.Bk=this.Jk=this.Ak=this.Ik=this.zk=this.yk=!0;this.lz=!1;this.Lv=[]}t.ka("Layer",se);se.prototype.Ed=function(a){this.W=a};
se.prototype.toString=function(a){void 0===a&&(a=0);var b='Layer "'+this.name+'"';if(0>=a)return b;for(var c=0,d=0,f=0,g=0,h=0,k=this.mb.k;k.next();){var l=k.value;l instanceof z?f++:l instanceof y?d++:l instanceof B?g++:l instanceof ea?h++:c++}k="";0<c&&(k+=c+" Parts ");0<d&&(k+=d+" Nodes ");0<f&&(k+=f+" Groups ");0<g&&(k+=g+" Links ");0<h&&(k+=h+" Adornments ");if(1<a)for(c=this.mb.k;c.next();)d=c.value,k+="\n    "+d.toString(a-1),(f=d.data)&&t.ud(f)&&(k+=" #"+t.ud(f)),d instanceof y?k+=" "+na(f):
d instanceof B&&(k+=" "+na(d.ca)+" "+na(d.fa));return b+" "+this.mb.count+": "+k};
se.prototype.findObjectAt=se.prototype.de=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);if(!1===this.dl)return null;e&&!a.P()&&t.m("findObjectAt: Point must have a real value.");var d=this.mb,f=!1;this.h.Ab.La(a)&&(f=!0);for(var g=t.N(),h=d.length;h--;){var k=d.wa(h);if((!0!==f||!1!==Xh(k))&&k.Wa()&&(g.assign(a),lb(g,k.se),k=k.de(g,b,c),null!==k&&(null!==b&&(k=b(k)),k&&(null===c||c(k)))))return t.B(g),k}t.B(g);return null};
se.prototype.findObjectsAt=se.prototype.op=function(a,b,c,d){void 0===b&&(b=null);void 0===c&&(c=null);d instanceof H||d instanceof I||(d=new I(V));if(!1===this.dl)return d;e&&!a.P()&&t.m("findObjectsAt: Point must have a real value.");var f=this.mb,g=!1;this.h.Ab.La(a)&&(g=!0);for(var h=t.N(),k=f.length;k--;){var l=f.wa(k);!0===g&&!1===Xh(l)||!l.Wa()||(h.assign(a),lb(h,l.se),l.op(h,b,c,d)&&(null!==b&&(l=b(l)),l&&(null===c||c(l))&&d.add(l)))}t.B(h);return d};
se.prototype.findObjectsIn=se.prototype.pk=function(a,b,c,d,f){void 0===b&&(b=null);void 0===c&&(c=null);void 0===d&&(d=!1);f instanceof H||f instanceof I||(f=new I(V));if(!1===this.dl)return f;e&&!a.P()&&t.m("findObjectsIn: Rect must have a real value.");var g=this.mb,h=!1;this.h.Ab.kk(a)&&(h=!0);for(var k=g.length,g=g.n;k--;){var l=g[k];(!0!==h||!1!==Xh(l))&&l.Wa()&&l.pk(a,b,c,d,f)&&(null!==b&&(l=b(l)),l&&(null===c||c(l))&&f.add(l))}return f};
se.prototype.tA=function(a,b,c,d,f,g,h){if(!1===this.dl)return f;for(var k=this.mb,l=k.length,k=k.n;l--;){var m=k[l];(!0!==h||!1!==Xh(m))&&g(m)&&m.Wa()&&m.pk(a,b,c,d,f)&&(null!==b&&(m=b(m)),m&&(null===c||c(m))&&f.add(m))}return f};
se.prototype.findObjectsNear=se.prototype.fn=function(a,b,c,d,f,g){void 0===c&&(c=null);void 0===d&&(d=null);void 0===f&&(f=!0);if(!1!==f&&!0!==f){if(f instanceof H||f instanceof I)g=f;f=!0}g instanceof H||g instanceof I||(g=new I(V));if(!1===this.dl)return g;e&&!a.P()&&t.m("findObjectsNear: Point must have a real value.");var h=this.mb,k=!1;this.h.Ab.La(a)&&(k=!0);for(var l=t.N(),m=t.N(),n=h.length;n--;){var p=h.n[n];!0===k&&!1===Xh(p)||!p.Wa()||(l.assign(a),lb(l,p.se),m.p(a.x+b,a.y),lb(m,p.se),
p.fn(l,m,c,d,f,g)&&(null!==c&&(p=c(p)),p&&(null===d||d(p))&&g.add(p)))}t.B(l);t.B(m);return g};aa=se.prototype;aa.bg=function(a,b){if(this.visible){var c=this.mb,d;d=b?b:a.Ab;for(var f=c.length,g=0;g<f;g++){var h=c.n[g];h.$C=g;if(!(h instanceof B&&!1===h.xg||h instanceof ea&&null!==h.hi))if(Eb(h.pa,d))for(h.bg(!0),Yh(h),h=h.pw;h.next();){var k=h.value;xh(k,Infinity,Infinity);k.Pc();k.bg(!0)}else h.bg(!1),null!==h.pw&&0<h.pw.count&&Yh(h)}}};
aa.$e=function(a,b,c,d){if(this.visible&&(void 0===d&&(d=!0),d||!this.Dc)){1!==this.Qf&&(a.globalAlpha=this.Qf);c=this.mb;d=this.Lv;d.length=0;for(var f=b.scale,g=c.length,h=0;h<g;h++){var k=c.n[h];if(Xh(k)){if(k instanceof B&&(k.pc&&d.push(k),!1===k.xg))continue;var l=k.pa;1<l.width*f||1<l.height*f?k.$e(a,b):Zh(k,a)}}a.globalAlpha=1}};
function $h(a,b,c,d){if(a.visible){b.globalAlpha=a.Qf;var f=a.mb;a=a.Lv;a.length=0;for(var g=c.scale,h=f.length,k=d.length,l=0;l<h;l++){var m=f.n[l];if(Xh(m)){if(m instanceof B&&(m.pc&&a.push(m),!1===m.xg))continue;var n=ai(m,m.pa),p;a:{p=n;for(var q=d,r=k,s=2/g,u=4/g,w=0;w<r;w++){var D=q[w];if(0!==D[2]&&0!==D[3]&&p.zF(D[0]-s,D[1]-s,D[2]+u,D[3]+u)){p=!0;break a}}p=!1}p&&(1<n.width*g||1<n.height*g?m.$e(b,c):Zh(m,b))}}b.globalAlpha=1}}
aa.j=function(a,b,c,d,f){var g=this.h;null!==g&&g.ed(Ld,a,this,b,c,d,f)};aa.zp=function(a,b,c){var d=this.mb;b.Co=this;if(a>=d.count)a=d.count;else if(d.wa(a)===b)return-1;d.Pd(a,b);b.zt(c);d=this.h;null!==d&&(c?d.na():d.zp(b));b instanceof z&&this.Kx(b);return a};aa.cf=function(a,b,c){var d=this.mb;if(0>a||a>=d.length){if(a=d.indexOf(b),0>a)return-1}else if(d.wa(a)!==b&&(a=d.indexOf(b),0>a))return-1;b.At(c);d.wd(a);d=this.h;null!==d&&(c?d.na():d.cf(b));b.Co=null;return a};
aa.Kx=function(a){for(;null!==a;){if(a.layer===this){var b=a;if(b.Vc.next()){for(var c=-1,d=-1,f=this.mb.n,g=f.length,h=0;h<g;h++){var k=f[h];if(k===b&&(c=h,0<=d))break;if(0>d&&k.fb===b&&(d=h,0<=c))break}!(0>d)&&d<c&&(f=this.mb,f.wd(c),f.Pd(d,b))}}a=a.fb}};aa.clear=function(){for(var a=this.mb.Pe(),b=a.length,c=0;c<b;c++)a[c].bg(!1),this.cf(-1,a[c],!1)};t.A(se,{vj:"parts"},function(){return this.mb.k});t.A(se,{XK:"partsBackwards"},function(){return this.mb.nn});t.A(se,{h:"diagram"},function(){return this.W});
t.g(se,"name",se.prototype.name);t.defineProperty(se,{name:"name"},function(){return this.ec},function(a){t.i(a,"string",se,"name");var b=this.ec;if(b!==a){var c=this.h;if(null!==c)for(""===b&&t.m("Cannot rename default Layer to: "+a),c=c.pn;c.next();)c.value.name===a&&t.m("Layer.name is already present in this diagram: "+a);this.ec=a;this.j("name",b,a);for(a=this.mb.k;a.next();)a.value.Ne=this.ec}});t.g(se,"opacity",se.prototype.opacity);
t.defineProperty(se,{opacity:"opacity"},function(){return this.Qf},function(a){var b=this.Qf;b!==a&&(t.i(a,"number",se,"opacity"),(0>a||1<a)&&t.ha(a,"0 <= val <= 1",se,"opacity"),this.Qf=a,this.j("opacity",b,a),a=this.h,null!==a&&a.na())});t.g(se,"isTemporary",se.prototype.Dc);t.defineProperty(se,{Dc:"isTemporary"},function(){return this.oz},function(a){var b=this.oz;b!==a&&(t.i(a,"boolean",se,"isTemporary"),this.oz=a,this.j("isTemporary",b,a))});t.g(se,"visible",se.prototype.visible);
t.defineProperty(se,{visible:"visible"},function(){return this.Rz},function(a){var b=this.Rz;if(b!==a){t.i(a,"boolean",se,"visible");this.Rz=a;this.j("visible",b,a);for(b=this.mb.k;b.next();)b.value.sh(a);a=this.h;null!==a&&a.na()}});t.g(se,"pickable",se.prototype.kf);t.defineProperty(se,{kf:"pickable"},function(){return this.dl},function(a){var b=this.dl;b!==a&&(t.i(a,"boolean",se,"pickable"),this.dl=a,this.j("pickable",b,a))});t.g(se,"isBoundsIncluded",se.prototype.HA);
t.defineProperty(se,{HA:"isBoundsIncluded"},function(){return this.lz},function(a){this.lz!==a&&(this.lz=a,null!==this.h&&this.h.Sc())});t.g(se,"allowCopy",se.prototype.dj);t.defineProperty(se,{dj:"allowCopy"},function(){return this.yk},function(a){var b=this.yk;b!==a&&(t.i(a,"boolean",se,"allowCopy"),this.yk=a,this.j("allowCopy",b,a))});t.g(se,"allowDelete",se.prototype.ll);
t.defineProperty(se,{ll:"allowDelete"},function(){return this.zk},function(a){var b=this.zk;b!==a&&(t.i(a,"boolean",se,"allowDelete"),this.zk=a,this.j("allowDelete",b,a))});t.g(se,"allowTextEdit",se.prototype.cp);t.defineProperty(se,{cp:"allowTextEdit"},function(){return this.Ik},function(a){var b=this.Ik;b!==a&&(t.i(a,"boolean",se,"allowTextEdit"),this.Ik=a,this.j("allowTextEdit",b,a))});t.g(se,"allowGroup",se.prototype.Zo);
t.defineProperty(se,{Zo:"allowGroup"},function(){return this.Ak},function(a){var b=this.Ak;b!==a&&(t.i(a,"boolean",se,"allowGroup"),this.Ak=a,this.j("allowGroup",b,a))});t.g(se,"allowUngroup",se.prototype.dp);t.defineProperty(se,{dp:"allowUngroup"},function(){return this.Jk},function(a){var b=this.Jk;b!==a&&(t.i(a,"boolean",se,"allowUngroup"),this.Jk=a,this.j("allowUngroup",b,a))});t.g(se,"allowLink",se.prototype.Qm);
t.defineProperty(se,{Qm:"allowLink"},function(){return this.Bk},function(a){var b=this.Bk;b!==a&&(t.i(a,"boolean",se,"allowLink"),this.Bk=a,this.j("allowLink",b,a))});t.g(se,"allowRelink",se.prototype.gk);t.defineProperty(se,{gk:"allowRelink"},function(){return this.Dk},function(a){var b=this.Dk;b!==a&&(t.i(a,"boolean",se,"allowRelink"),this.Dk=a,this.j("allowRelink",b,a))});t.g(se,"allowMove",se.prototype.fk);
t.defineProperty(se,{fk:"allowMove"},function(){return this.Ck},function(a){var b=this.Ck;b!==a&&(t.i(a,"boolean",se,"allowMove"),this.Ck=a,this.j("allowMove",b,a))});t.g(se,"allowReshape",se.prototype.$o);t.defineProperty(se,{$o:"allowReshape"},function(){return this.Ek},function(a){var b=this.Ek;b!==a&&(t.i(a,"boolean",se,"allowReshape"),this.Ek=a,this.j("allowReshape",b,a))});t.g(se,"allowResize",se.prototype.ap);
t.defineProperty(se,{ap:"allowResize"},function(){return this.Fk},function(a){var b=this.Fk;b!==a&&(t.i(a,"boolean",se,"allowResize"),this.Fk=a,this.j("allowResize",b,a))});t.g(se,"allowRotate",se.prototype.bp);t.defineProperty(se,{bp:"allowRotate"},function(){return this.Gk},function(a){var b=this.Gk;b!==a&&(t.i(a,"boolean",se,"allowRotate"),this.Gk=a,this.j("allowRotate",b,a))});t.g(se,"allowSelect",se.prototype.Ve);
t.defineProperty(se,{Ve:"allowSelect"},function(){return this.Hk},function(a){var b=this.Hk;b!==a&&(t.i(a,"boolean",se,"allowSelect"),this.Hk=a,this.j("allowSelect",b,a))});
function v(a){function b(){document.removeEventListener("DOMContentLoaded",b,!1);bi(c)}1<arguments.length&&t.m("Diagram constructor can only take one optional argument, the DIV HTML element or its id.");t.Fc(this);t.oA=[];this.cc=!0;this.yi=new Ke;this.yi.W=this;this.sf=17;var c=this;null!==document.body?bi(this):document.addEventListener("DOMContentLoaded",b,!1);this.Wb=new H(se);this.Ib=this.Jb=0;this.Rb=this.of=this.Za=null;this.el={};this.mG();this.Pa=(new E(NaN,NaN)).freeze();this.fc=1;this.gv=
(new E(NaN,NaN)).freeze();this.hv=NaN;this.wv=1E-4;this.tv=100;this.Oc=new ta;this.mw=(new E(NaN,NaN)).freeze();this.Yu=(new F(NaN,NaN,NaN,NaN)).freeze();this.Sl=ef;this.Rn=Ub;this.Uk=ef;this.qo=Ub;this.iv=this.fv=Vb;this.lg=new I(V);this.Be=!0;this.co=new wa(B,F);this.eo=!0;this.yH=250;this.Tl=null;this.Du=(new wb(16,16,16,16)).freeze();this.Su=this.Sf=!1;this.jo=!0;this.Qk=new Ad;this.Md=new Ad;this.dc=new Ad;this.Ej=null;this.cw=-1;this.Jz=!1;this.Vy=new wa("string",H);this.Uy=new wa("string",
"string");ci(this);this.Gv=new I(y);this.gl=new I(z);this.pv=new I(B);this.mb=new I(x);this.kv=!0;this.LC=!1;this.jw=rg;this.Mj=10;this.Oy=this.Sy=this.hw=null;this.My="";this.Uq="auto";this.Di=this.$i=this.Ni=this.zv=this.Oi=this.Pi=this.Qi=this.Ci=this.Gi=this.Ai=null;this.Ii=!0;this.wz=!1;this.Dy=null;this.lv=this.Ln=this.Ty=this.Oo=this.BD=this.Xi=!1;this.WC=!0;this.Jd=!1;this.pe=null;var d=this;this.cD=function(a){if(a.ea===d.ea&&d.Sa){d.Sa=!1;try{var b=a.Bd;""===a.Ff&&b===Ld&&di(d,a.object,
a.propertyName)}finally{d.Sa=!0}}};this.dD=function(a){ei(d,a)};this.aE=!0;this.ah=-2;this.Ei=new wa(Object,x);this.Nk=new wa(Object,B);this.km=new wa(Object,Array);this.Wk=!1;this.zk=this.yk=this.tu=this.Re=!0;this.vu=this.uu=!1;this.Au=this.yu=this.Hk=this.Gk=this.Fk=this.Ek=this.Ck=this.Dk=this.Bk=this.xu=this.Jk=this.Ak=this.Ik=!0;this.uo=this.TC=!1;this.zu=this.wu=this.dv=this.cv=!0;this.Uv=this.Tv=16;this.Dz=this.Sv=!1;this.Fz=this.Ez=this.$j=this.Zj=null;this.Te=(new wb(5)).freeze();this.Xv=
(new I(x)).freeze();this.uv=999999999;this.ev=(new I(x)).freeze();this.Vk=this.Jj=this.Ji=!0;this.fm=this.em=!1;this.kz=this.jz=0;this.Yd=null;this.Bu=!0;this.rf=!1;this.$d=null;this.wm=1;this.no=!1;this.FD=0;this.Go=null;this.$D=(new F(NaN,NaN,NaN,NaN)).freeze();this.Tu=(new F(NaN,NaN,NaN,NaN)).freeze();this.xm=new I;fi(this);this.ov=this.$u=this.Fv=this.sC=this.rC=this.tC=this.Nj=this.Rk=this.Ri=null;gi(this);this.md=null;this.Zu=!1;this.Sn=null;this.Cb=new $e;this.Cb.initializeStandardTools();
this.Ya=this.Iw=this.Cb;this.Ye=new Ba;this.ea=new T;this.Xi=!0;this.ic=new Ae;this.Xi=!1;void 0===a&&(a=document.createElement("div"));this.CC=this.Xy=null;this.Qz=!0;this.Cz=!1;this.Hj=null;this.sg=1;this.Tk=new qi;ri(this,a);this.mm=1;this.nm=0;this.ZC=new E;this.XD=500;this.Cu=new E;this.Bs=null;this.cc=!1}t.ka("Diagram",v);
function gi(a){a.Ri=new wa("string",x);var b=new y,c=new za;c.bind(new Me("text","",na));b.add(c);a.tC=b;a.Ri.add("",b);b=new y;c=new za;c.stroke="brown";c.bind(new Me("text","",na));b.add(c);a.Ri.add("Comment",b);b=new y;b.uk=!1;b.dA=!1;c=new W;c.Eb="Ellipse";c.fill="black";c.stroke=null;c.Ea=(new ra(3,3)).Oa();b.add(c);a.Ri.add("LinkLabel",b);a.Rk=new wa("string",z);b=new z;b.du="GROUPPANEL";b.type=si;c=new za;c.font="bold 12pt sans-serif";c.bind(new Me("text","",na));b.add(c);c=new C(ti);c.name=
"GROUPPANEL";var d=new W;d.Eb="Rectangle";d.fill="rgba(128,128,128,0.2)";d.stroke="black";c.add(d);d=new ah;d.padding=(new wb(5,5,5,5)).Oa();c.add(d);b.add(c);a.rC=b;a.Rk.add("",b);a.Nj=new wa("string",B);b=new B;c=new W;c.oi=!0;b.add(c);c=new W;c.Gn="Standard";c.fill="black";c.stroke=null;c.lb=0;b.add(c);a.sC=b;a.Nj.add("",b);b=new B;c=new W;c.oi=!0;c.stroke="brown";b.add(c);a.Nj.add("Comment",b);b=new ea;b.type=ti;c=new W;c.fill=null;c.stroke="dodgerblue";c.lb=3;b.add(c);c=new ah;c.margin=(new wb(1.5,
1.5,1.5,1.5)).Oa();b.add(c);a.Fv=b;a.$u=b;b=new ea;b.type=Lg;c=new W;c.oi=!0;c.fill=null;c.stroke="dodgerblue";c.lb=3;b.add(c);a.ov=b}
function bi(a){var b=document.createElement("p");b.style.width="100%";b.style.height="200px";b.style.boxSizing="content-box";var c=document.createElement("div");c.style.position="absolute";c.style.visibility="hidden";c.style.width="200px";c.style.height="150px";c.style.overflow="hidden";c.style.boxSizing="content-box";c.appendChild(b);document.body.appendChild(c);var d=b.offsetWidth;c.style.overflow="scroll";b=b.offsetWidth;d===b&&(b=c.clientWidth);document.body.removeChild(c);a.sf=d-b}
v.prototype.toString=function(a){void 0===a&&(a=0);var b="";this.id&&(b=this.id);this.nj&&this.nj.id&&(b=this.nj.id);b='Diagram "'+b+'"';if(0>=a)return b;for(var c=this.Wb.k;c.next();)b+="\n  "+c.value.toString(a-1);return b};v.prototype.checkProperties=function(){return t.rI(this)};v.fromDiv=function(a){var b=a;"string"===typeof a&&(b=document.getElementById(a));return b instanceof HTMLDivElement&&b.W instanceof v?b.W:null};t.g(v,"div",v.prototype.nj);
t.defineProperty(v,{nj:"div"},function(){return this.Rb},function(a){null!==a&&t.l(a,HTMLDivElement,v,"div");if(this.Rb!==a){t.oA=[];var b=this.Rb;if(null!==b){b.W=void 0;b.innerHTML="";null!==this.Za&&(this.Za.W=null,this.Za.removeEventListener("touchstart",this.WG,!1),this.Za.removeEventListener("touchmove",this.VG,!1),this.Za.removeEventListener("touchend",this.UG,!1));b=this.hw;if(null!==b){for(var c=b.fD.n,d=c.length,f=0;f<d;f++)c[f].cancelWaitAfter();c=b.gD.n;d=c.length;for(f=0;f<d;f++)c[f].cancelWaitAfter();
c=b.hD.n;d=c.length;for(f=0;f<d;f++)c[f].cancelWaitAfter()}b.cancelWaitAfter();this.of=this.Za=null;window.removeEventListener("resize",this.oH,!1);window.removeEventListener("mousemove",this.Qp,!0);window.removeEventListener("mousedown",this.Pp,!0);window.removeEventListener("mouseup",this.Sp,!0);window.removeEventListener("mousewheel",this.th,!0);window.removeEventListener("DOMMouseScroll",this.th,!0);window.removeEventListener("mouseout",this.Rp,!0);null!==this.Go&&(this.Go=this.Go.target=null)}else this.rf=
!1;this.Rb=null;if(null!==a){if(b=a.W)b.nj=null;ri(this,a);this.Yt()}}});function qi(){this.NH="63ad05bbe23a1786468a4c741b6d2";this.NH===this._tk?this.Kh=!0:ui(this,!1)}
function ui(a,b){var c="p",d=window[t.Ma("76a715b2f73f148a")][t.Ma("72ba13b5")];if(t.Ma("77bb5bb2f32603de")===window[t.Ma("76a715b2f73f148a")][t.Ma("6aba19a7ec351488")])try{a.Kh=!window[t.Ma("4da118b7ec2108")]([t.Ma("5bb806bfea351a904a84515e1b6d38b6")])([t.Ma("49bc19a1e6")])([t.Ma("59bd04a1e6380fa5539b")])([t.Ma("7bb8069ae7")]===t.Ma(t.qw));if(!1===a.Kh)return;a.Kh=!window[t.Ma("4da118b7ec2108")]([t.Ma("5bb806bfea351a904a84515e1b6d38b6")])([t.Ma("49bc19a1e6")])([t.Ma("59bd04a1e6380fa5539b6c7a197c31bb4cfd3e")])([t.Ma("7bb8069ae7")]===
t.Ma(t.qw));if(!1===a.Kh)return}catch(f){}for(var g=d[t.Ma("76ad18b4f73e")],h=d[t.Ma("73a612b6fb191d")](t.Ma("35e7"))+2;h<g;h++)c+=d[h];d=c[t.Ma("73a612b6fb191d")](t.Ma(t.qw));0>=d&&t.Ma(t.qw)!==t.Ma("7da71ca0ad381e90")&&(d=c[t.Ma("73a612b6fb191d")](t.Ma("76a715b2ef3e149757")));a.Kh=!(0<d&&d<c[t.Ma("73a612b6fb191d")](t.Ma("35")));a.Kh&&(c=document[t.Ma("79ba13b2f7333e8846865a7d00")]("div"),d=t.Ma("34af05bbcb331a804699"),"."===d[0]&&(d=d[t.Ma("69bd14a0f724128a44")](1)),c[t.Ma("79a417a0f0181a8946")]=d,document[t.Ma("78a712aa")]?
(document[t.Ma("78a712aa")][t.Ma("7bb806b6ed32388c4a875b")](c),d=window[t.Ma("7dad0290ec3b0b91578e5b40007031bf")](c)[t.Ma("7dad0283f1390b81519f4645156528bf")](t.Ma("78a704b7e62456904c9b12701b6532a8")),document[t.Ma("78a712aa")][t.Ma('"68ad1bbcf533388c4a875b')](c),d&&-1!==d.indexOf(t.Ma(t.sI))&&-1!==d.indexOf(t.Ma(t.tI))&&(a.Kh=!1)):(a.Kh=null,b&&(a.Kh=!1)))}qi.prototype.Ql=function(a){a.of.setTransform(a.sg,0,0,a.sg,0,0);null===this.Kh&&ui(this,!0);return 0<this.Kh&&this!==this.LH?!0:!1};
qi.prototype.t=function(){this.LH=null};
function ri(a,b){void 0!==b&&null!==b||t.m("Diagram setup requires an argument DIV.");null!==a.Rb&&t.m("Diagram has already completed setup.");"string"===typeof b?a.Rb=document.getElementById(b):b instanceof HTMLDivElement?a.Rb=b:t.m("No DIV or DIV id supplied: "+b);null===a.Rb&&t.m("Invalid DIV id; could not get element with id: "+b);void 0!==a.Rb.W&&t.m("Invalid div id; div already has a Diagram associated with it.");"static"===window.getComputedStyle(a.Rb,null).position&&(a.Rb.style.position="relative");
a.Rb.style["-webkit-tap-highlight-color"]="rgba(255, 255, 255, 0)";a.Rb.style["-ms-touch-action"]="none";a.Rb.innerHTML="";a.Rb.W=a;var c=document.createElement("canvas");if(c.getContext&&c.getContext("2d")){c.innerHTML="This text is displayed if your browser does not support the Canvas HTML element.";void 0!==c.style&&(c.style.position="absolute",c.style.top="0px",c.style.left="0px",c.style.zIndex="2",c.style.bL="none",c.style.webkitUserSelect="none",c.style.MozUserSelect="none");a.Jb=a.Rb.clientWidth||
1;a.Ib=a.Rb.clientHeight||1;a.Za=c;a.of=c.getContext("2d");var d=a.of;a.sg=a.computePixelRatio();vi(a,a.Jb,a.Ib);a.kz=0;a.jz=0;if(document.body){var f=document.body.parentNode;a.kz=f.offsetTop||0;a.jz=f.offsetLeft||0}else document.addEventListener("load",function(){if(document.body){var b=document.body.parentNode;a.kz=b.offsetTop||0;a.jz=b.offsetLeft||0}},!1);c.W=a;a.vy=d[t.Ma("7eba17a4ca3b1a8346")][t.Ma("78a118b7")](d,t.Ql,4,4);a.Rb.insertBefore(c,a.Rb.firstChild);d=document.createElement("canvas");
d.width=1;d.height=1;a.Xy=d;a.CC=d.getContext("2d");var f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),k=document.createElement("div");f.style.position="absolute";f.style.overflow="auto";f.style.width=a.Jb+"px";f.style.height=a.Ib+"px";f.style.zIndex="1";g.style.position="absolute";g.style.overflow="auto";g.style.width=a.Jb+"px";g.style.height=a.Ib+"px";g.style.zIndex="1";h.style.position="absolute";h.style.width="1px";h.style.height="1px";k.style.position=
"absolute";k.style.width="1px";k.style.height="1px";a.Rb.appendChild(f);a.Rb.appendChild(g);f.appendChild(h);g.appendChild(k);f.onscroll=a.lD;f.onmousedown=a.mD;f.W=a;f.zD=!0;g.onscroll=a.lD;g.onmousedown=a.mD;g.W=a;g.AD=!0;a.Zj=f;a.$j=g;a.Ez=h;a.Fz=k;a.bK=t.HE(function(){a.na()},300,!1);a.oH=t.HE(function(){wi(a)},250,!1);a.preventDefault=function(a){a.preventDefault();return!1};a.Qp=function(b){if(a.isEnabled){a.uo=!0;var c=a.Md;t.kn&&c.lx?(b.preventDefault(),b.simulated=!0,a.Bs=b):(a.Md=a.dc,a.dc=
c,xi(a,a,b,c,!0),a.zB(b,null,b.target.W)||(a.doMouseMove(),a.Ya.isBeyondDragSize()&&(yi(a),a.mm=0)))}};a.Pp=function(b){if(a.isEnabled){a.uo=!0;var c=a.Md;if(t.kn&&null!==a.Bs)a.Bs=b,b.preventDefault();else if(t.kn&&400>b.timeStamp-a.nm)b.preventDefault();else if(a.Md=a.dc,a.dc=c,xi(a,a,b,c,!0),c.ok=!0,c.Ge=b.detail,a.Qk=c.copy(),!0===c.$q.simulated)b.preventDefault(),b.simulated=!0;else if(e&&e.cG&&(window.cG=a.op(c.da)),wf=null,a.doMouseDown(),1===b.button)return b.preventDefault(),!1}};a.Sp=function(b){if(a.isEnabled){a.uo=
!0;var c=a.Md;if(t.kn){if(400>b.timeStamp-a.nm){b.preventDefault();return}a.nm=b.timeStamp}if(t.kn&&null!==a.Bs)a.Bs=null,b.preventDefault();else{a.Md=a.dc;a.dc=c;xi(a,a,b,c,!0);c.zj=!0;c.Ge=b.detail;if(t.gx||t.LA)b.timeStamp-a.nm<a.XD&&!a.Ya.isBeyondDragSize()?a.mm++:a.mm=1,a.nm=b.timeStamp,c.Ge=a.mm;c.bubbles=b.bubbles;b.target.W&&(c.zh=b.target.W);a.JG(b,null,new E,c.zh)||(a.doMouseUp(),Bf(a),ha(a,c,b))}}};a.th=function(b){if(a.isEnabled){var c=a.Md;a.Md=a.dc;a.dc=c;xi(a,a,b,c,!0);c.bubbles=!0;
c.mk=void 0!==b.wheelDelta?b.wheelDelta:-40*b.detail;a.doMouseWheel();ha(a,c,b)}};a.Rp=function(){if(a.isEnabled){a.uo=!1;var b=a.Ya;b.cancelWaitAfter();b instanceof $e&&b.hideToolTip()}};a.WG=function(b){if(a.isEnabled){a.Jz=!1;if(1<b.touches.length){a.Ya.doCancel();if(a.Ii){a.no=!0;a.wm=a.scale;var c=a.Jb,d=a.Ib,f=a.Za.getBoundingClientRect(),g=b.targetTouches[0],h=g.clientX-c/f.width*f.left,k=g.clientY-d/f.height*f.top,g=b.targetTouches[1],c=g.clientX-c/f.width*f.left-h,d=g.clientY-d/f.height*
f.top-k,d=Math.sqrt(c*c+d*d);a.FD=d;b.preventDefault();b.cancelBubble=!0;return!1}yi(a);b.cancelBubble=!1;return!0}d=a.Md;a.Md=a.dc;a.dc=d;d.h=a;zi(a,b.targetTouches[0],d);d.dd=0;d.button=0;d.ok=!0;d.zj=!1;d.Ge=1;d.mk=0;d.Ke=!1;d.bubbles=!1;d.event=b;d.timestamp=Date.now();d.zh=b.target.W?b.target.W:null;d.ke=null;a.Qk=d.copy();wf=null;a.doMouseDown();Ai(a,d);ha(a,d,b)}};a.VG=function(b){if(a.isEnabled){if(1<b.touches.length){a.Ya.doCancel();yi(a);if(a.Ii&&a.no&&1<b.targetTouches.length){var c=a.Jb,
d=a.Ib,f=a.Za.getBoundingClientRect(),g=b.targetTouches[0],h=g.clientX-c/f.width*f.left,k=g.clientY-d/f.height*f.top,g=b.targetTouches[1],c=g.clientX-c/f.width*f.left,g=g.clientY-d/f.height*f.top,d=c-h,f=g-k,d=Math.sqrt(d*d+f*f)/a.FD,g=new E((Math.min(c,h)+Math.max(c,h))/2,(Math.min(g,k)+Math.max(g,k))/2),h=a.wm*d,k=a.Ye;h!==a.scale&&k.canResetZoom(h)&&(c=a.eg,a.eg=g,k.resetZoom(h),a.eg=c);b.preventDefault();b.cancelBubble=!0;return!1}b.cancelBubble=!1;return!0}h=a.Md;a.Md=a.dc;a.dc=h;g=k=null;0<
b.changedTouches.length?g=b.changedTouches[0]:0<b.targetTouches.length&&(g=b.targetTouches[0]);h.h=a;g?((k=document.elementFromPoint(g.clientX,g.clientY))&&k.W?(d=g,c=k.W):(d=b.changedTouches[0],c=a),zi(c,d,h)):null!==a.Md?(h.da=a.Md.da,h.Wd=a.Md.Wd,k=a.Md.zh):null!==a.Qk&&(h.da=a.Qk.da,h.Wd=a.Qk.Wd,k=a.Qk.zh);h.dd=0;h.button=0;h.ok=!1;h.zj=!1;h.Ge=1;h.mk=0;h.Ke=!1;h.bubbles=!1;h.event=b;h.timestamp=Date.now();h.zh=null===k?b.target.W:k.W?k.W:null;h.ke=null;a.Ya.isBeyondDragSize()&&yi(a);a.zB(g?g:
b,null,h.zh)||(a.doMouseMove(),ha(a,h,b))}};a.UG=function(b){if(a.isEnabled){yi(a);if(a.Jz)return b.preventDefault(),!1;var c=a.Md;a.Md=a.dc;a.dc=c;if(1<b.touches.length)a.Ii&&(a.no=!1);else{var d=null,f=null;0<b.changedTouches.length?f=b.changedTouches[0]:0<b.targetTouches.length&&(f=b.targetTouches[0]);c.h=a;c.Ge=1;if(f){var d=document.elementFromPoint(f.clientX,f.clientY),g,h;d&&d.W?(h=f,g=d.W):(h=b.changedTouches[0],g=a);zi(g,h,c);g=f.screenX;h=f.screenY;var k=a.ZC;b.timeStamp-a.nm<a.XD&&!(25<
Math.abs(k.x-g)||25<Math.abs(k.y-h))?a.mm++:a.mm=1;c.Ge=a.mm;a.nm=b.timeStamp;a.ZC.p(g,h)}else d=c.zh;c.dd=0;c.button=0;c.ok=!1;c.zj=!0;c.mk=0;c.Ke=!1;c.bubbles=!1;c.event=b;c.timestamp=Date.now();c.zh=null===d?b.target.W:d.W?d.W:null;c.ke=null;a.JG(f?f:b,null,new E,c.zh)||(a.doMouseUp(),ha(a,c,b))}}};c.addEventListener("touchstart",a.WG,!1);c.addEventListener("touchmove",a.VG,!1);c.addEventListener("touchend",a.UG,!1);c.addEventListener("gesturestart",function(){!1!==a.Ii&&(a.wm=a.scale,a.Ya.doCancel(),
a.HC=0)},!1);c.addEventListener("gesturechange",function(b){if(!1!==a.Ii){var c=b.scale;a.HC++;if(1===a.HC)if(1.02<c||0.98>c)b.preventDefault();else{a.wm=null;return}if(null!==a.wm){var d=a.Jb,f=a.Ib,g=a.Za.getBoundingClientRect();b=new E(b.pageX-window.scrollX-d/g.width*g.left,b.pageY-window.scrollY-f/g.height*g.top);c*=a.wm;d=a.Ye;c!==a.scale&&d.canResetZoom(c)&&(f=a.eg,a.eg=b,d.resetZoom(c),a.eg=f)}}},!1);window.MSGesture&&(a.Go=new window.MSGesture,a.Go.target=d,c.addEventListener("pointerdown",
function(b){a.Go.addPointer(b.pointerId)},!1),c.addEventListener("MSGestureStart",function(b){!1!==a.Ii&&(a.wm=a.scale,a.no=!0,b.preventDefault())},!1),c.addEventListener("MSGestureChange",function(b){if(!1!==a.Ii){var c=b.scale;if(1===c)b.gestureObject.stop(),b.preventDefault();else{a.no&&(a.Ya.doCancel(),a.no=!1);b=a.JB(a.dm(b));var c=a.scale*c,d=a.Ye;if(c!==a.scale&&d.canResetZoom(c)){var f=a.eg;a.eg=b;d.resetZoom(c);a.eg=f}}}},!1));c.addEventListener("mousemove",a.Qp,!1);c.addEventListener("mousedown",
a.Pp,!1);c.addEventListener("mouseup",a.Sp,!1);c.addEventListener("mousewheel",a.th,!1);c.addEventListener("DOMMouseScroll",a.th,!1);c.addEventListener("mouseout",a.Rp,!1);c.addEventListener("keydown",a.DJ,!1);c.addEventListener("keyup",a.EJ,!1);c.addEventListener("selectstart",function(a){a.preventDefault();return!1},!1);c.addEventListener("contextmenu",function(a){a.preventDefault();return!1},!1);window.addEventListener("resize",a.oH,!1);c.tabIndex=0;da(a)}else a.Rb.innerHTML="This text is displayed if your browser does not support the Canvas HTML element."}
v.prototype.computePixelRatio=function(){var a=this.of;return Math.round((window.devicePixelRatio||1)/(a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1))};v.prototype.doMouseMove=function(){this.Ya.doMouseMove()};v.prototype.doMouseDown=function(){this.Ya.doMouseDown()};v.prototype.doMouseUp=function(){this.Ya.doMouseUp()};v.prototype.doMouseWheel=function(){this.Ya.doMouseWheel()};
v.prototype.doKeyDown=function(){this.Ya.doKeyDown()};v.prototype.doKeyUp=function(){this.Ya.doKeyUp()};function wi(a){if(null!==a.Za){var b=a.Rb;if(0!==b.clientWidth&&0!==b.clientHeight){var c=a.fm?a.sf:0,d=a.em?a.sf:0,f=a.sg;a.sg=a.computePixelRatio();a.sg!==f&&(vi(a,a.Jb,a.Ib),da(a),a.ie());if(b.clientWidth!==a.Jb+c||b.clientHeight!==a.Ib+d)a.Jj=!0,a.Be=!0,b=a.ic,null!==b&&b.Gt&&b.M(),a.Jd||a.ie()}}}v.prototype.focus=v.prototype.focus=function(){this.Za&&this.Za.focus()};
function da(a,b,c){void 0===b&&(b=a.of);void 0===c&&(c=!0);c&&(b.su="");b.Jn="";b.Rl=""}function fi(a){var b=new se;b.name="Background";a.Ys(b);b=new se;b.name="";a.Ys(b);b=new se;b.name="Foreground";a.Ys(b);b=new se;b.name="Adornment";b.Dc=!0;a.Ys(b);b=new se;b.name="Tool";b.Dc=!0;b.HA=!0;a.Ys(b);b=new se;b.name="Grid";b.Ve=!1;b.kf=!1;b.Dc=!0;a.UH(b,a.sl("Background"))}
function Bi(a){a.md=new C(Ci);a.md.name="GRID";var b=new W;b.Eb="LineH";b.stroke="lightgray";b.lb=0.5;b.interval=1;a.md.add(b);b=new W;b.Eb="LineH";b.stroke="gray";b.lb=0.5;b.interval=5;a.md.add(b);b=new W;b.Eb="LineH";b.stroke="gray";b.lb=1;b.interval=10;a.md.add(b);b=new W;b.Eb="LineV";b.stroke="lightgray";b.lb=0.5;b.interval=1;a.md.add(b);b=new W;b.Eb="LineV";b.stroke="gray";b.lb=0.5;b.interval=5;a.md.add(b);b=new W;b.Eb="LineV";b.stroke="gray";b.lb=1;b.interval=10;a.md.add(b);b=new x;b.add(a.md);
b.Ne="Grid";b.hx=!1;b.GA=!1;b.kf=!1;b.Jt="GRID";a.add(b);a.mb.remove(b);a.md.visible=!1}
v.prototype.lD=function(){if(this.W.isEnabled){var a=this.W;if(a.Dz&&null!==a.Za){a.Sv=!0;var b=a.Lc,c=a.Ab,d=b.width,f=c.width,g=b.height,h=c.height,k=b.right,l=c.right,m=b.bottom,n=c.bottom,p=b.x,q=c.x,b=b.y,c=c.y,r=a.scale;if(f<d||h<g){var s=t.N();this.zD&&a.tf?(s.p(this.scrollLeft/r+p,a.position.y),a.position=s):this.AD&&a.uf&&(s.p(a.position.x,this.scrollTop/r+b),a.position=s);t.B(s);a.Sv=!1;a.Jj=!1}else s=t.N(),this.zD&&a.tf&&(p<q&&(a.position=new E(this.scrollLeft+p,a.position.y)),k>l&&(a.position=
new E(-(a.Zj.scrollWidth-a.Jb)+this.scrollLeft-a.Jb/r+a.Lc.right,a.position.y))),this.AD&&a.uf&&(b<c&&(a.position=new E(a.position.x,this.scrollTop+b)),m>n&&(a.position=new E(a.position.x,-(a.$j.scrollHeight-a.Ib)+this.scrollTop-a.Ib/r+a.Lc.bottom))),t.B(s),Di(a),a.Sv=!1,a.Jj=!1,b=a.Lc,c=a.Ab,k=b.right,l=c.right,m=b.bottom,n=c.bottom,p=b.x,q=c.x,b=b.y,c=c.y,f>=d&&p>=q&&k<=l&&(a.Ez.style.width="1px"),h>=g&&b>=c&&m<=n&&(a.Fz.style.height="1px")}}else Ei(this.W)};
v.prototype.mD=function(){this.W.isEnabled?this.W.Dz=!0:Ei(this.W)};v.prototype.computeBounds=v.prototype.vf=function(){0<this.lg.count&&Fi(this);return Gi(this)};function Gi(a){if(a.vA.P()){var b=a.vA.copy();b.ow(a.padding);return b}for(var c=!0,d=a.Wb.n,f=d.length,g=0;g<f;g++){var h=d[g];if(h.visible&&(!h.Dc||h.HA))for(var h=h.mb.n,k=h.length,l=0;l<k;l++){var m=h[l];m.hx&&m.Wa()&&(m=m.pa,m.P()&&(c?(c=!1,b=m.copy()):b.yj(m)))}}c&&(b=new F(0,0,0,0));b.ow(a.padding);return b}
v.prototype.computePartsBounds=function(a){var b=null;for(a=a.k;a.next();){var c=a.value;c instanceof B||(c.xf(),null===b?b=c.pa.copy():b.yj(c.pa))}return null===b?new F(NaN,NaN,0,0):b};
function Hi(a,b){if(!a.mc.Eg&&(void 0===b&&(b=!1),(b||a.rf)&&!a.cc&&a.Lc.P()&&null!==a.Za)){a.cc=!0;var c=a.Sl;b&&a.Uk!==ef&&(c=a.Uk);var d=c!==ef?Ii(a,c):a.scale,c=a.Ab.copy(),f=a.Jb/d,g=a.Ib/d,h=null,k=a.mc;k.zd&&(h=a.Pa.copy());a.position.Ra();var l=a.Rn;b&&a.qo.Cd()&&(l=a.qo);Ji(a,a.Pa,a.Lc,f,g,l);a.position.freeze();null!==h&&Wh(k,h,a.Pa);a.scale=d;a.cc=!1;d=a.Ab;d.yf(c)||a.Ut(c,d)}}
function Ii(a,b){if(null!==a.Za){a.Ji&&Ki(a,a.vf());var c=a.Ye.mt,d=a.Lc;if(!d.P())return c;var f=d.width,d=d.height,g=a.Jb,h=a.Ib,k=g/f,l=h/d;return b===Li?(f=Math.min(l,k),f>c&&(f=c),f<a.Jg&&(f=a.Jg),f>a.Hg&&(f=a.Hg),f):b===Mi?(f=l>k?(h-a.sf)/d:(g-a.sf)/f,f>c&&(f=c),f<a.Jg&&(f=a.Jg),f>a.Hg&&(f=a.Hg),f):a.scale}}v.prototype.zoomToFit=v.prototype.zoomToFit=function(){this.scale=Ii(this,Li)};
v.prototype.zoomToRect=function(a,b){void 0===b&&(b=Li);var c=a.width,d=a.height;if(!(0===c||0===d||isNaN(c)&&isNaN(d))){var f=1;if(b===Li||b===Mi)if(isNaN(c))f=this.Ab.height*this.scale/d;else if(isNaN(d))f=this.Ab.width*this.scale/c;else var f=this.Jb,g=this.Ib,f=b===Mi?g/d>f/c?(g-(this.em?this.sf:0))/d:(f-(this.fm?this.sf:0))/c:Math.min(g/d,f/c);this.scale=f;this.position=new E(a.x,a.y)}};
v.prototype.alignDocument=function(a,b){this.Ji&&Ki(this,this.vf());var c=this.Lc,d=this.Ab,f=this.cc;this.cc=!0;this.position=new E(c.x+(a.x*c.width+a.offsetX)-(b.x*d.width-b.offsetX),c.y+(a.y*c.height+a.offsetY)-(b.y*d.height-b.offsetY));this.cc=f;this.na()};
function Ji(a,b,c,d,f,g){var h;h=b.x;var k=b.y;g.Cd()&&(d>c.width&&(h=c.x+(g.x*c.width+g.offsetX)-(g.x*d-g.offsetX)),f>c.height&&(k=c.y+(g.y*c.height+g.offsetY)-(g.y*f-g.offsetY)));d<c.width?(h=Math.min(h+d/2,c.right-d/2),h=Math.max(h,c.left+d/2),h-=d/2):h>c.left?h=c.left:h<c.right-d&&(h=c.right-d);f<c.height?(d=Math.min(k+f/2,c.bottom-f/2),d=Math.max(d,c.top+f/2),k=d-f/2):k>c.top?k=c.top:k<c.bottom-f&&(k=c.bottom-f);b.x=isFinite(h)?h:-a.padding.left;b.y=isFinite(k)?k:-a.padding.top}
v.prototype.findPartAt=v.prototype.st=function(a,b){var c=b?ag(this,a,function(a){return a.U},function(a){return a.canSelect()}):ag(this,a,function(a){return a.U});return c instanceof x?c:null};v.prototype.findObjectAt=v.prototype.de=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);var d=this.Wb.nn;for(Fi(this);d.next();){var f=d.value;if(f.visible&&(f=f.de(a,b,c),null!==f))return f}return null};
function ag(a,b,c,d){void 0===c&&(c=null);void 0===d&&(d=null);var f=a.Wb.nn;for(Fi(a);f.next();)if(a=f.value,a.visible&&!a.Dc&&(a=a.de(b,c,d),null!==a))return a;return null}v.prototype.findObjectsAt=v.prototype.op=function(a,b,c,d){void 0===b&&(b=null);void 0===c&&(c=null);d instanceof H||d instanceof I||(d=new I(V));Fi(this);for(var f=this.Wb.nn;f.next();){var g=f.value;g.visible&&g.op(a,b,c,d)}return d};
v.prototype.findObjectsIn=v.prototype.pk=function(a,b,c,d,f){void 0===b&&(b=null);void 0===c&&(c=null);void 0===d&&(d=!1);f instanceof H||f instanceof I||(f=new I(V));Fi(this);for(var g=this.Wb.nn;g.next();){var h=g.value;h.visible&&h.pk(a,b,c,d,f)}return f};v.prototype.tA=function(a,b,c,d,f,g){var h=new I(V);Fi(this);for(var k=this.Wb.nn;k.next();){var l=k.value;l.visible&&l.tA(a,b,c,d,h,f,g)}return h};
v.prototype.findObjectsNear=v.prototype.fn=function(a,b,c,d,f,g){void 0===c&&(c=null);void 0===d&&(d=null);void 0===f&&(f=!0);if(!1!==f&&!0!==f){if(f instanceof H||f instanceof I)g=f;f=!0}g instanceof H||g instanceof I||(g=new I(V));Fi(this);for(var h=this.Wb.nn;h.next();){var k=h.value;k.visible&&k.fn(a,b,c,d,f,g)}return g};function yi(a){-1!==a.cw&&(clearTimeout(a.cw),a.cw=-1)}function Ai(a,b){var c=b.copy();a.cw=setTimeout(function(){c.button=2;a.T=c;a.Jz=!0;a.doMouseUp()},850)}
v.prototype.acceptEvent=function(a){var b=this.Md;this.Md=this.dc;this.dc=b;xi(this,this,a,b,a instanceof MouseEvent);return b};function xi(a,b,c,d,f){d.h=b;f?zi(a,c,d):(d.Wd=b.dc.Wd,d.da=b.dc.da);a=0;c.ctrlKey&&(a+=1);c.altKey&&(a+=2);c.shiftKey&&(a+=4);c.metaKey&&(a+=8);d.dd=a;d.button=c.button;t.ln&&0===c.button&&c.ctrlKey&&(d.button=2);d.ok=!1;d.zj=!1;d.Ge=1;d.mk=0;d.Ke=!1;d.bubbles=!1;d.event=c;d.timestamp=Date.now();d.zh=c.target.W?c.target.W:null;d.ke=null}
function ha(a,b,c){if(b.bubbles)return e&&e.pF&&t.trace("NOT handled "+c.type+" "+b.toString()),!0;e&&e.pF&&t.trace("handled "+c.type+" "+a.Ya.name+" "+b.toString());void 0!==c.stopPropagation&&c.stopPropagation();(void 0===c.touches||2>c.touches.length)&&c.preventDefault();c.cancelBubble=!0;return!1}
v.prototype.DJ=function(a){if(this.W.isEnabled){var b=this.W.dc;xi(this.W,this.W,a,b,!1);b.key=String.fromCharCode(a.which);b.ok=!0;switch(a.which){case 33:b.key="PageUp";break;case 34:b.key="PageDown";break;case 35:b.key="End";break;case 36:b.key="Home";break;case 37:b.key="Left";break;case 38:b.key="Up";break;case 39:b.key="Right";break;case 40:b.key="Down";break;case 45:b.key="Insert";break;case 46:b.key="Del";break;case 48:b.key="0";break;case 187:case 61:case 107:b.key="Add";break;case 189:case 173:case 109:b.key=
"Subtract";break;case 27:b.key="Esc"}this.W.doKeyDown();return 187!==a.which&&189!==a.which&&48!==a.which&&107!==a.which&&109!==a.which&&61!==a.which&&173!==a.which||!0!==a.ctrlKey?ha(this.W,b,a):(a.cancelBubble=!0,a.preventDefault(),a.stopPropagation(),!1)}};
v.prototype.EJ=function(a){if(this.W.isEnabled){var b=this.W.dc;xi(this.W,this.W,a,b,!1);b.key=String.fromCharCode(a.which);b.zj=!0;switch(a.which){case 33:b.key="PageUp";break;case 34:b.key="PageDown";break;case 35:b.key="End";break;case 36:b.key="Home";break;case 37:b.key="Left";break;case 38:b.key="Up";break;case 39:b.key="Right";break;case 40:b.key="Down";break;case 45:b.key="Insert";break;case 46:b.key="Del"}this.W.doKeyUp();return ha(this.W,b,a)}};
v.prototype.dm=function(a){var b=this.Za;if(null===b)return new E(0,0);var c=this.Jb,d=this.Ib,b=b.getBoundingClientRect(),c=a.clientX-c/b.width*b.left;a=a.clientY-d/b.height*b.top;return null!==this.Oc?(a=new E(c,a),lb(a,this.Oc),a):new E(c,a)};function zi(a,b,c){var d=a.Za,f=a.Jb,g=a.Ib,h=0,k=0;null!==d&&(d=d.getBoundingClientRect(),h=b.clientX-f/d.width*d.left,k=b.clientY-g/d.height*d.top);c.Wd.p(h,k);null!==a.Oc?(b=t.qc(h,k),a.Oc.mi(b),c.da.assign(b),t.B(b)):c.da.p(h,k)}
v.prototype.invalidateDocumentBounds=v.prototype.Sc=function(){this.Ji||(this.Ji=!0,this.ie())};function Ni(a){a.Jd||Fi(a);a.Ji&&Ki(a,a.vf());Hi(a);for(a=a.xm.k;a.next();)Ni(a.value)}v.prototype.redraw=v.prototype.Yt=function(){this.cc||this.Jd||(this.na(),Oi(this),Di(this),this.Sc(),this.Ig())};v.prototype.isUpdateRequested=function(){return this.Sf};v.prototype.delayInitialization=function(a){var b=this.mc,c=b.isEnabled;b.isEnabled=!1;Rh(this);this.rf=!1;b.isEnabled=c;a&&setTimeout(a,1)};
v.prototype.requestUpdate=v.prototype.ie=function(a){void 0===a&&(a=!1);if(!0!==this.Sf&&!(this.cc||!1===a&&this.Jd)){this.Sf=!0;var b=this;requestAnimationFrame(function(){b.Sf&&b.Ig()})}};v.prototype.maybeUpdate=v.prototype.Ig=function(){if(!this.jo||this.Sf)this.jo&&(this.jo=!1),Rh(this)};
function Rh(a){if(!a.Jd&&(a.Sf=!1,null!==a.Rb)){a.Jd=!0;var b=a.yi,c=!1,d=!1;b.Eg?(d=!0,c=a.ab,a.ab=!0):b.zd||wi(a);a.cc||b.Eg||!a.Jj||Ei(a)||Ei(a);null!==a.md&&(a.md.visible&&!a.Zu&&(Pi(a),a.Zu=!0),!a.md.visible&&a.Zu&&(a.Zu=!1));Qi(a);Fi(a);var f=!1;if(!a.rf||a.Bu)a.rf?Ri(a,!a.Su):(a.yc("Initial Layout"),!1===b.isEnabled&&b.iq(),Ri(a,!1)),f=!0;a.Su=!1;Fi(a);a.Oo||b.Eg||Ni(a);f&&(a.rf||(Si(a),Pi(a)),a.Ga("LayoutCompleted"));Fi(a);a.cc||b.Eg||!a.Jj||Ei(a)||(Ei(a),Fi(a));f&&!a.rf&&(a.rf=!0,a.Ie("Initial Layout"),
a.ab||a.ma.clear(),setTimeout(function(){a.rh=!1},1));a.$e();d&&(a.ab=c);a.Jd=!1}}function Si(a){if(a.Uk!==ef)a.scale=Ii(a,a.Uk);else if(a.Sl!==ef)a.scale=Ii(a,a.Sl);else{var b=a.wF;isFinite(b)&&0<b&&(a.scale=b)}a.Ji&&Ki(a,a.vf());b=a.vF;if(b.P())a.position=b;else{b=t.N();b.eu(a.Lc,a.uF);var c=a.Ab,c=t.wk(0,0,c.width,c.height),d=t.N();d.eu(c,a.xF);a.position=new E(b.x-d.x,b.y-d.y);t.oc(c);t.B(d);t.B(b);Hi(a,!0)}a.Ga("InitialLayoutCompleted")}
function Fi(a){if((a.Jd||!a.mc.Eg)&&0!==a.lg.count)for(var b=0;23>b;b++){var c=a.lg.k;if(null===c||0===a.lg.count)break;a.lg=new I(V);var d=a,f=a.lg;for(c.reset();c.next();){var g=c.value;!g.Rd()||g instanceof z||(g.Bl()?(xh(g,Infinity,Infinity),g.Pc()):f.add(g))}for(c.reset();c.next();)g=c.value,g instanceof z&&Ti(d,g);for(c.reset();c.next();)d=c.value,d instanceof B&&(d.Bl()?(xh(d,Infinity,Infinity),d.Pc(),d.sx()):f.add(d));for(c.reset();c.next();)d=c.value,d instanceof ea&&(d.Bl()?(xh(d,Infinity,
Infinity),d.Pc()):f.add(d))}}function Ti(a,b){for(var c=b.Vc,d=t.Hb();c.next();){var f=c.value;f.Wa()&&(f instanceof z?(Ui(f)||Vi(f)||Wi(f))&&Ti(a,f):f instanceof B?d.push(f):(xh(f,Infinity,Infinity),f.Pc()))}c=d.length;for(f=0;f<c;f++){var g=d[f];xh(g,Infinity,Infinity);g.Pc()}t.Ca(d);xh(b,Infinity,Infinity);b.Pc()}v.prototype.bg=function(a,b,c,d){var f=this.yi;if(this.Vk||f.Eg)for(f=0;f<b;f++)a[f].bg(c,d)};
v.prototype.$e=function(a,b){null===this.Rb&&t.m("No div specified");var c=this.Za;null===c&&t.m("No canvas specified");if(this.yi.zd)0===this.ma.Qe&&this.ie(!0);else{a||(a=this.of);var d=a!==this.of,f=this.Wb.n,g=f.length,h=this;this.bg(f,g,h);if(d)da(this,a),Di(this);else if(!this.Be&&void 0===b)return;var k=this.Pa,g=this.fc,l=Math.round(k.x*g)/g,m=Math.round(k.y*g)/g,n=this.Oc;n.reset();1!==g&&n.scale(g);0===k.x&&0===k.y||n.translate(-l,-m);var p=this.Hj;if(k=null!==p&&0<p.length&&!0===this.Cz){m=
t.gx;a.save();a.beginPath();g=p.length;for(l=0;l<g;l++){var q=p[l];if(0!==q[2]||0!==q[3])q=ga(this,q),a.rect(Math.floor(q[0])-1,Math.floor(q[1])-1,Math.ceil(q[2])+2,Math.ceil(q[3])+2),m&&a.clearRect(Math.floor(q[0])-1,Math.floor(q[1])-1,Math.ceil(q[2])+2,Math.ceil(q[3])+2)}a.clip()}g=this.sg;t.kn?(c.width=c.width,k=!1,da(this,a),a.scale(g,g)):(a.setTransform(1,0,0,1,0,0),a.scale(g,g),a.clearRect(0,0,this.Jb,this.Ib));a.miterLimit=9;a.setTransform(1,0,0,1,0,0);a.scale(g,g);a.transform(n.m11,n.m12,
n.m21,n.m22,n.dx,n.dy);e&&e.gj&&e.WE(this,a);c=b?function(c){var d=a;if(c.visible){d.globalAlpha=c.Qf;var f=c.mb;c=c.Lv;c.length=0;for(var g=h.scale,k=f.length,l=0;l<k;l++){var m=f.n[l];if(Xh(m)&&!b.contains(m)){if(m instanceof B&&(m.pc&&c.push(m),!1===m.xg))continue;var n=m.pa;1<n.width*g||1<n.height*g?m.$e(d,h):Zh(m,d)}}d.globalAlpha=1}}:k?function(b){$h(b,a,h,p)}:function(b){b.$e(a,h)};Xi(this,a);g=f.length;for(l=0;l<g;l++)c(f[l]);this.Hj=[];this.Tk?this.Tk.Ql(this)&&this.vy():this.dm=function(){};
k&&(a.restore(),da(this,a),e&&e.YI&&e.XI(p,a,this));e&&(e.rA||e.gj)&&e.qA(a,this,n);d?(da(this),Di(this)):this.Be=this.Vk=!1}};
function Yi(a,b,c,d,f){null===a.Rb&&t.m("No div specified");var g=a.Za;null===g&&t.m("No canvas specified");var h=a.of;if(a.Be){var k=a.sg;t.kn?(g.width=g.width,da(a,h)):(h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,a.Jb*k,a.Ib*k));h.mH=!1;h.tF=!1;h.drawImage(a.Xy,0<d?0:Math.round(-d),0<f?0:Math.round(-f));f=a.Pa;var g=a.fc,l=Math.round(f.x*g)/g,m=Math.round(f.y*g)/g;d=a.Oc;d.reset();1!==g&&d.scale(g);0===f.x&&0===f.y||d.translate(-l,-m);h.save();h.beginPath();f=c.length;for(g=0;g<f;g++)l=c[g],0!==
l[2]&&0!==l[3]&&h.rect(Math.floor(l[0]),Math.floor(l[1]),Math.ceil(l[2]),Math.ceil(l[3]));h.clip();h.setTransform(1,0,0,1,0,0);h.scale(k,k);h.transform(d.m11,d.m12,d.m21,d.m22,d.dx,d.dy);e&&e.gj&&e.WE(a,h);c=a.Wb.n;f=c.length;a.bg(c,f,a);Xi(a,h);for(g=0;g<f;g++)$h(c[g],h,a,b);h.restore();da(a);e&&(e.rA||e.gj)&&e.qA(h,a,d);a.Tk?a.Tk.Ql(a)&&a.vy():a.dm=function(){};a.Vk=!1;a.Be=!1;a.bK()}}
function Zi(a,b,c,d,f,g,h,k,l,m){null===a.Rb&&t.m("No div specified");null===a.Za&&t.m("No canvas specified");da(a);Di(a);var n=void 0;g&&d&&f&&(n=new F(g.x,g.y,d.width/f,d.height/f));var p=n.copy();p.ow(c);Pi(a,p);Fi(a);var p=a.Wb.n,q=p.length;a.bg(p,q,a,n);var r=a.sg;b.setTransform(1,0,0,1,0,0);b.scale(r,r);b.clearRect(0,0,d.width,d.height);k&&(b.fillStyle=k,b.fillRect(0,0,d.width,d.height));d=t.Ah();d.reset();d.translate(c.left,c.top);d.scale(f);0===g.x&&0===g.y||d.translate(-g.x,-g.y);b.setTransform(d.m11,
d.m12,d.m21,d.m22,d.dx,d.dy);t.bf(d);Xi(a,b);if(h){var s=new I;c=h.k;for(c.reset();c.next();)f=c.value.U,!1===m&&"Grid"===f.layer.name||null===f||s.add(f);c=function(c){var d=l;if(c.visible&&(void 0===d&&(d=!0),d||!c.Dc)){b.globalAlpha=c.Qf;d=c.mb;c=c.Lv;c.length=0;for(var f=a.scale,g=d.length,h=0;h<g;h++){var k=d.n[h];if(Xh(k)&&s.contains(k)){if(k instanceof B&&(k.pc&&c.push(k),!1===k.xg))continue;var m=k.pa;1<m.width*f||1<m.height*f?k.$e(b,a):Zh(k,b)}}b.globalAlpha=1}}}else if(!l&&m){var u=a.xp.U,
w=u.layer;c=function(c){c===w?u.$e(b,a):c.$e(b,a,n,l,m)}}else c=function(c){c.$e(b,a,n,l,m)};for(f=0;f<q;f++)c(p[f]);a.Tk?a.Tk.Ql(a)&&a.vy():a.dm=function(){};da(a);Di(a);a.bg(p,q,a);Pi(a)}v.prototype.getRenderingHint=function(a){return this.el[a]};v.prototype.setRenderingHint=v.prototype.lK=function(a,b){this.el[a]=b;this.Yt()};v.prototype.resetRenderingHints=v.prototype.mG=function(){this.el={drawShadows:!0}};
function Xi(a,b){var c=a.el;if(null!==c){if(void 0!==c.imageSmoothingEnabled){var d=!!c.imageSmoothingEnabled;b.tF=d;b.mH=d;b.SK=d}c=c.defaultFont;void 0!==c&&null!==c&&(b.font=c,b.su=c)}}function Qi(a){if(0===a.ma.Qe&&0<a.co.count){for(var b=a.co.k;b.next();){var c=b.key,d=b.value;c.df();Pg(c,d)}a.co.clear()}}
v.prototype.na=function(a,b){if(this.Cz&&void 0!==a&&null!==this.Hj){var c=this.Ab;if(a&&c.Xf(a)||b&&c.Xf(b))null!==this.Hj&&(a&&a.P()&&$i(this,a.x-2,a.y-2,a.width+4,a.height+4),b&&b.P()&&$i(this,b.x-2,b.y-2,b.width+4,b.height+4)),this.Be=!0,this.ie()}else this.Hj=null,this.Be=!0,this.ie();for(c=this.xm.k;c.next();)c.value.na(a,b)};t.g(v,"viewportOptimizations",v.prototype.zK);
t.defineProperty(v,{zK:null},function(){return this.Qz},function(a){t.i(a,"boolean",v,"viewportOptimizations");this.Hj=null;this.Qz=a});
function $i(a,b,c,d,f){b=Math.floor(b);c=Math.floor(c);d=Math.ceil(d);f=Math.ceil(f);for(var g=a.Hj,h=g.length,k=0;k<h;k++){var l=g[k];if(b>=l[0]&&c>=l[1]&&b+d<=l[0]+l[2]&&c+f<=l[1]+l[3])return!1;b<=l[0]&&c<=l[1]&&b+d>=l[0]+l[2]&&c+f>=l[1]+l[3]?(g[k][2]=0,g[k][3]=0):b>=l[0]&&b<l[0]+l[2]&&c>=l[1]&&c+f<=l[1]+l[3]?(d=b+d-(l[0]+l[2]),b=l[0]+l[2],k=-1):b+d>l[0]&&b+d<=l[0]+l[2]&&c>=l[1]&&c+f<=l[1]+l[3]?(d=l[0]-b,k=-1):b>=l[0]&&b+d<=l[0]+l[2]&&c>=l[1]&&c<l[1]+l[3]?(f=c+f-(l[1]+l[3]),c=l[1]+l[3],k=-1):b>=
l[0]&&b+d<=l[0]+l[2]&&c+f>l[1]&&c+f<=l[1]+l[3]?(f=l[1]-c,k=-1):g[k][0]>=b&&g[k][0]<b+d&&g[k][1]>=c&&g[k][1]+g[k][3]<=c+f?(g[k][2]-=b+d-g[k][0],g[k][0]=b+d,k=-1):g[k][0]+g[k][2]>b&&g[k][0]+g[k][2]<=b+d&&g[k][1]>=c&&g[k][1]+g[k][3]<=c+f?(g[k][2]=b-g[k][0],k=-1):g[k][0]>=b&&g[k][0]+g[k][2]<=b+d&&g[k][1]>=c&&g[k][1]<c+f?(g[k][3]-=c+f-g[k][1],g[k][1]=c+f,k=-1):g[k][0]>=b&&g[k][0]+g[k][2]<=b+d&&g[k][1]+g[k][3]>c&&g[k][1]+g[k][3]<=c+f&&(g[k][3]=c-g[k][1],k=-1)}for(k=0;k<h;k++)if(l=g[k],0<d&&0<f&&0<l[2]&&
0<l[3]&&(Math.max(b+d,l[0]+l[2])-Math.min(b,l[0]))*(Math.max(c+f,l[1]+l[3])-Math.min(c,l[1]))<d*f+l[2]*l[3]+50){var h=Math.min(l[0],b),m=Math.min(l[1],c);b=Math.max(b+d,l[0]+l[2])-Math.min(l[0],b);c=Math.max(c+f,l[1]+l[3])-Math.min(l[1],c);g[k][2]=0;g[k][3]=0;return $i(a,h,m,b,c)}g.push([b,c,d,f]);return!0}
function aj(a,b,c){if(!0!==a.Be){a.Be=!0;if(a instanceof bj)cj(a);else if(!0===a.Qz&&c.width===b.width&&c.height===b.height){var d=a.scale,f=t.Jf(),g=Math.max(b.x,c.x),h=Math.max(b.y,c.y),k=Math.min(b.x+b.width,c.x+c.width),l=Math.min(b.y+b.height,c.y+c.height);f.x=g;f.y=h;f.width=Math.max(0,k-g)*d;f.height=Math.max(0,l-h)*d;if(0<f.width&&0<f.height){if(!a.Jd&&(a.Sf=!1,null!==a.Rb)){a.Jd=!0;Qi(a);Fi(a);a.Lc.P()||Ki(a,a.vf());var m=a.Za;if(null!==m){k=a.sg;g=a.Jb*k;h=a.Ib*k;l=a.scale*k;d=Math.round(Math.round(c.x*
l)-Math.round(b.x*l));b=Math.round(Math.round(c.y*l)-Math.round(b.y*l));c=a.Xy;var n=a.CC;c.width=g;c.height=h;c=190*a.sg;var l=70*a.sg,p=Math.max(d,0),q=Math.max(b,0),r=g-p,s=h-q;n.mH=!1;n.tF=!1;n.drawImage(m,p,q,r,s,0,0,r,s);a.Tk.Ql(a)&&n.clearRect(0,0,c,l);var m=t.Hb(),n=t.Hb(),s=Math.abs(d),r=Math.abs(b),u=0===p?0:g-s,p=t.qc(u,0),s=t.qc(s+u,h);n.push([Math.min(p.x,s.x),Math.min(p.y,s.y),Math.abs(p.x-s.x),Math.abs(p.y-s.y)]);var w=a.Oc;w.reset();w.scale(k,k);1!==a.fc&&w.scale(a.fc);k=a.Pa;(0!==
k.x||0!==k.y)&&isFinite(k.x)&&isFinite(k.y)&&w.translate(-k.x,-k.y);lb(p,w);lb(s,w);m.push([Math.min(p.x,s.x),Math.min(p.y,s.y),Math.abs(p.x-s.x),Math.abs(p.y-s.y)]);u=0===q?0:h-r;p.p(0,u);s.p(g,r+u);n.push([Math.min(p.x,s.x),Math.min(p.y,s.y),Math.abs(p.x-s.x),Math.abs(p.y-s.y)]);lb(p,w);lb(s,w);m.push([Math.min(p.x,s.x),Math.min(p.y,s.y),Math.abs(p.x-s.x),Math.abs(p.y-s.y)]);a.Tk.Ql(a)&&(g=0<d?0:-d,h=0<b?0:-b,p.p(g,h),s.p(c+g,l+h),n.push([Math.min(p.x,s.x),Math.min(p.y,s.y),Math.abs(p.x-s.x),Math.abs(p.y-
s.y)]),lb(p,w),lb(s,w),m.push([Math.min(p.x,s.x),Math.min(p.y,s.y),Math.abs(p.x-s.x),Math.abs(p.y-s.y)]));t.B(p);t.B(s);!a.cc&&a.Jj&&(Ei(a)||Ei(a));Yi(a,m,n,d,b);t.Ca(m);t.Ca(n);a.Jd=!1}}}else a.ie();t.oc(f)}else a.Ig();for(a=a.xm.k;a.next();)aj(a.value)}}function Oi(a){!1===a.Jj&&(a.Jj=!0)}function Di(a){!1===a.Vk&&(a.Vk=!0)}function vi(a,b,c){var d=a.Za,f=a.sg,g=b*f,f=c*f;if(d.width!==g||d.height!==f)d.width=g,d.height=f,d.style.width=b+"px",d.style.height=c+"px",a.Be=!0}
function Ei(a){if(null!==a.Za&&!a.mc.zd){var b=a.Rb,c=a.Jb,d=a.Ib,f=a.$D.copy(),g=!1,h=a.fm?a.sf:0,k=a.em?a.sf:0,l=b.clientWidth||c+h,b=b.clientHeight||d+k;if(l!==c+h||b!==d+k)a.fm=!1,a.em=!1,a.Jb=l,a.Ib=b,vi(a,l,b),g=!0;a.Jj=!1;if(a.Sv)c===a.Jb&&d===a.Ib||a.Ig();else{var m=a.Ab,n=a.Lc,h=n.width,k=n.height,p=m.width,q=m.height,r=n.x,s=m.x,u=n.right,w=m.right,D=n.y,A=m.y,G=n.bottom,M=m.bottom,n=m="1px",N=a.scale;l/N>h&&b/N>k||(a.qF&&a.tf&&(p+1<h?(m=(h-p)*N+a.Jb+"px",a.Zj.scrollLeft=(a.position.x-r)*
N):r+1<s?(m=(s-r)*N+a.Jb+"px",a.Zj.scrollLeft=a.Zj.scrollWidth-a.Zj.clientWidth):u>w+1&&(m=(u-w)*N+a.Jb+"px",a.Zj.scrollLeft=a.position.x*N)),a.rF&&a.uf&&(q+1<k?(n=(k-q)*N+a.Ib+"px",a.$j.scrollTop=(a.position.y-D)*N):D+1<A?(n=(A-D)*N+a.Ib+"px",a.$j.scrollTop=a.$j.scrollHeight-a.$j.clientHeight):G>M+1&&(n=(G-M)*N+a.Ib+"px",a.$j.scrollTop=a.position.y*N)));l="1px"!==m;b="1px"!==n;l!==a.em&&(a.Ib="1px"===m?a.Ib+a.sf:Math.max(a.Ib-a.sf,1),g=!0);a.em=l;a.Ez.style.width=m;b!==a.fm&&(a.Jb="1px"===n?a.Jb+
a.sf:Math.max(a.Jb-a.sf,1),g=!0);a.fm=b;a.Fz.style.height=n;g&&(vi(a,a.Jb,a.Ib),da(a));l=a.Jb;b=a.Ib;a.$j.style.height=b+"px";a.$j.style.width=l+(a.fm?a.sf:0)+"px";a.Zj.style.width=l+"px";a.Zj.style.height=b+(a.em?a.sf:0)+"px";a.Dz=!1;return c!==l||d!==b?(m=a.Ab,a.Ut(f,m,g?!0:void 0),!1):!0}}}
v.prototype.add=v.prototype.add=function(a){t.l(a,x,v,"add:part");var b=a.h;if(b!==this){null!==b&&t.m("Cannot add part "+a.toString()+" to "+this.toString()+". It is already a part of "+b.toString());this.Ln&&(a.Xk="Tool");var c=a.Ne,b=this.sl(c);null===b&&(b=this.sl(""));null===b&&t.m('Cannot add a Part when unable find a Layer named "'+c+'" and there is no default Layer');a.layer!==b&&(c=b.zp(99999999,a,a.h===this),0<=c&&this.ed(Md,"parts",b,null,a,null,c),b.Dc||this.Sc(),a.M(dj),c=a.Gp,null!==
c&&c(a,null,b))}};
v.prototype.zp=function(a){if(a instanceof y){if(this.Gv.add(a),a instanceof z){var b=a.fb;null===b?this.gl.add(a):b.um.add(a);b=a.ic;null!==b&&(b.h=this)}}else a instanceof B?this.pv.add(a):a instanceof ea||this.mb.add(a);a.Nb&&a.ja();if(b=a.data){a instanceof ea||(a instanceof B?this.Nk.add(b,a):this.Ei.add(b,a));var c=this;ej(a,function(a){fj(c,a)})}!0!==Vi(a)&&!0!==Wi(a)||this.lg.add(a);gj(a,!0,this);hj(a)?(a.pa.P()&&this.na(ai(a,a.pa)),this.Sc()):a.Wa()&&a.pa.P()&&this.na(ai(a,a.pa));this.ie()};
v.prototype.cf=function(a){a.Uf();if(a instanceof y){if(this.Gv.remove(a),a instanceof z){var b=a.fb;null===b?this.gl.remove(a):b.um.remove(a);b=a.ic;null!==b&&(b.h=null)}}else a instanceof B?this.pv.remove(a):a instanceof ea||this.mb.remove(a);if(b=a.data){a instanceof ea||(a instanceof B?this.Nk.remove(b):this.Ei.remove(b));var c=this;ej(a,function(a){ij(c,a)})}this.lg.remove(a);hj(a)?(a.pa.P()&&this.na(ai(a,a.pa)),this.Sc()):a.Wa()&&a.pa.P()&&this.na(ai(a,a.pa));this.ie()};
v.prototype.remove=v.prototype.remove=function(a){t.l(a,x,v,"remove:part");a.ib=!1;a.Fg=!1;var b=a.layer;if(null!==b&&b.h===this){a.M(jj);a.cn();var c=b.cf(-1,a,!1);0<=c&&this.ed(Nd,"parts",b,a,null,c,null);c=a.Gp;null!==c&&c(a,b,null)}};v.prototype.removeParts=v.prototype.mB=function(a,b){if(a===this.selection){var c=new I;c.Ue(a);a=c}for(c=a.k;c.next();){var d=c.value;d.h===this&&(b&&!d.canDelete()||this.remove(d))}};v.prototype.copyParts=v.prototype.Zm=function(a,b,c){return this.Ye.Zm(a,b,c)};
v.prototype.moveParts=v.prototype.moveParts=function(a,b,c){t.l(b,E,v,"moveParts:offset");var d=this.Cb;if(null!==d){d=d.Od;null===d&&(d=new lf,d.h=this);var f=new wa(x,Object);if(a)a=a.k;else{for(a=this.vj;a.next();)zf(d,f,a.value,c);for(a=this.vh;a.next();)zf(d,f,a.value,c);a=this.links}for(;a.next();)zf(d,f,a.value,c);d.moveParts(f,b,c)}};
function kj(a,b,c){t.l(b,se,v,"addLayer:layer");null!==b.h&&b.h!==a&&t.m("Cannot share a Layer with another Diagram: "+b+" of "+b.h);null===c?null!==b.h&&t.m("Cannot add an existing Layer to this Diagram again: "+b):(t.l(c,se,v,"addLayer:existingLayer"),c.h!==a&&t.m("Existing Layer must be in this Diagram: "+c+" not in "+c.h),b===c&&t.m("Cannot move a Layer before or after itself: "+b));if(b.h!==a){b=b.name;a=a.Wb;c=a.count;for(var d=0;d<c;d++)a.wa(d).name===b&&t.m("Cannot add Layer with the name '"+
b+"'; a Layer with the same name is already present in this Diagram.")}}v.prototype.addLayer=v.prototype.Ys=function(a){kj(this,a,null);a.Ed(this);var b=this.Wb,c=b.count-1;if(!a.Dc)for(;0<=c&&b.wa(c).Dc;)c--;b.Pd(c+1,a);null!==this.pe&&this.ed(Md,"layers",this,null,a,null,c+1);this.na();this.Sc()};
v.prototype.addLayerBefore=v.prototype.UH=function(a,b){kj(this,a,b);a.Ed(this);var c=this.Wb,d=c.indexOf(a);0<=d&&(c.remove(a),null!==this.pe&&this.ed(Nd,"layers",this,a,null,d,null));for(var f=c.count,g=0;g<f;g++)if(c.wa(g)===b){c.Pd(g,a);break}null!==this.pe&&this.ed(Md,"layers",this,null,a,null,g);this.na();0>d&&this.Sc()};
v.prototype.addLayerAfter=function(a,b){kj(this,a,b);a.Ed(this);var c=this.Wb,d=c.indexOf(a);0<=d&&(c.remove(a),null!==this.pe&&this.ed(Nd,"layers",this,a,null,d,null));for(var f=c.count,g=0;g<f;g++)if(c.wa(g)===b){c.Pd(g+1,a);break}null!==this.pe&&this.ed(Md,"layers",this,null,a,null,g+1);this.na();0>d&&this.Sc()};
v.prototype.removeLayer=function(a){t.l(a,se,v,"removeLayer:layer");a.h!==this&&t.m("Cannot remove a Layer from another Diagram: "+a+" of "+a.h);if(""!==a.name){var b=this.Wb,c=b.indexOf(a);if(b.remove(a)){for(b=a.mb.copy().k;b.next();){var d=b.value,f=d.Ne;d.Ne=f!==a.name?f:""}null!==this.pe&&this.ed(Nd,"layers",this,a,null,c,null);this.na();this.Sc()}}};v.prototype.findLayer=v.prototype.sl=function(a){for(var b=this.pn;b.next();){var c=b.value;if(c.name===a)return c}return null};
v.prototype.addChangedListener=v.prototype.Wz=function(a){t.i(a,"function",v,"addChangedListener:listener");null===this.Ej&&(this.Ej=new H("function"));this.Ej.add(a)};v.prototype.removeChangedListener=v.prototype.kB=function(a){t.i(a,"function",v,"removeChangedListener:listener");null!==this.Ej&&(this.Ej.remove(a),0===this.Ej.count&&(this.Ej=null))};
v.prototype.vw=function(a){this.ab||this.ma.oF(a);a.Bd!==Kd&&(this.rh=!0);if(null!==this.Ej){var b=this.Ej,c=b.length;if(1===c)b=b.wa(0),b(a);else if(0!==c)for(var d=b.Pe(),f=0;f<c;f++)b=d[f],b(a)}};v.prototype.raiseChangedEvent=v.prototype.ed=function(a,b,c,d,f,g,h){void 0===g&&(g=null);void 0===h&&(h=null);var k=new Cd;k.h=this;k.Bd=a;k.propertyName=b;k.object=c;k.oldValue=d;k.ag=g;k.newValue=f;k.Zf=h;this.vw(k)};
v.prototype.raiseChanged=v.prototype.j=function(a,b,c,d,f){this.ed(Ld,a,this,b,c,d,f)};t.A(v,{mc:"animationManager"},function(){return this.yi});t.A(v,{ma:"undoManager"},function(){return this.pe.ma});t.g(v,"skipsUndoManager",v.prototype.ab);t.defineProperty(v,{ab:"skipsUndoManager"},function(){return this.Xi},function(a){t.i(a,"boolean",v,"skipsUndoManager");this.Xi=a;this.pe.Xi=a});t.g(v,"delaysLayout",v.prototype.Kw);
t.defineProperty(v,{Kw:"delaysLayout"},function(){return this.Ty},function(a){this.Ty=a});
v.prototype.changeState=function(a,b){if(null!==a&&a.h===this){var c=a.Bd;if(c===Ld){var c=a.object,d=a.propertyName,f=a.Da(b);t.Va(c,d,f);c instanceof V&&(c=c.U,null!==c&&c.Uf());this.rh=!0}else if(c===Md){f=a.object;d=a.Zf;c=a.newValue;if(f instanceof C){if("number"===typeof d&&c instanceof V){var g=f;b?g.cf(d):g.Pd(d,c);c=f.U;null!==c&&c.Uf()}}else f instanceof se?(g=!0===a.ag,"number"===typeof d&&c instanceof x&&(b?(c.Uf(),g?f.cf(d,c,g):this.remove(c)):f.zp(d,c,g))):f instanceof v?"number"===
typeof d&&c instanceof se&&(b?this.Wb.wd(d):(c.Ed(this),this.Wb.Pd(d,c))):t.m("unknown ChangedEvent.Insert object: "+a.toString());this.rh=!0}else c===Nd?(f=a.object,d=a.ag,c=a.oldValue,f instanceof C?"number"===typeof d&&c instanceof V&&(g=f,b?g.Pd(d,c):g.cf(d)):f instanceof se?(g=!0===a.Zf,"number"===typeof d&&c instanceof x&&(b?f.zp(d,c,g):(c.Uf(),g?f.cf(d,c,g):this.remove(c)))):f instanceof v?"number"===typeof d&&c instanceof se&&(b?(c.Ed(this),this.Wb.Pd(d,c)):this.Wb.wd(d)):t.m("unknown ChangedEvent.Remove object: "+
a.toString()),this.rh=!0):c!==Kd&&t.m("unknown ChangedEvent: "+a.toString())}};v.prototype.startTransaction=v.prototype.yc=function(a){return this.ma.yc(a)};v.prototype.commitTransaction=v.prototype.Ie=function(a){return this.ma.Ie(a)};v.prototype.rollbackTransaction=v.prototype.$p=function(){return this.ma.$p()};v.prototype.updateAllTargetBindings=function(a){void 0===a&&(a="");for(var b=this.vj;b.next();)b.value.Vb(a);for(b=this.vh;b.next();)b.value.Vb(a);for(b=this.links;b.next();)b.value.Vb(a)};
v.prototype.updateAllModelDataReferences=function(){for(var a=this.vj;a.next();)a.value.updateModelDataReferences();for(a=this.vh;a.next();)a.value.updateModelDataReferences();for(a=this.links;a.next();)a.value.updateModelDataReferences()};
v.prototype.Ut=function(a,b,c){Oi(this);Di(this);var d=this.ic;null===d||!d.Gt||c||a.width===b.width&&a.height===b.height||d.M();this.cc||Hi(this);Pi(this);d=this.Ya;!0===this.uo&&d instanceof $e&&(this.T.da=this.$G(this.T.Wd),d.doMouseMove());aj(this,a,b);this.Ga("ViewportBoundsChanged",c?{}:null,a)};
function Pi(a,b){var c=a.md;if(null!==c&&c.visible){for(var d=t.Ml(),f=1,g=1,h=c.va.length,k=0;k<h;k++){var l=c.va.n[k],m=l.interval;2>m||(lj(l.Eb)?g=g*m/K.hF(g,m):f=f*m/K.hF(f,m))}h=c.vt;d.p(g*h.width,f*h.height);if(b)k=b.width,l=b.height,g=b.x,h=b.y;else{f=t.Jf();g=a.Ab;f.p(g.x,g.y,g.width,g.height);for(h=a.xm.k;h.next();)g=h.value.Ab,g.P()&&Fb(f,g.x,g.y,g.width,g.height);k=f.width;l=f.height;g=f.x;h=f.y;if(!f.P())return}c.width=k+2*d.width;c.height=l+2*d.height;f=t.N();K.rt(g,h,0,0,d.width,d.height,
f);f.offset(-d.width,-d.height);t.qk(d);c.U.location=f;t.B(f)}}v.prototype.clearSelection=v.prototype.xw=function(){var a=0<this.selection.count;a&&this.Ga("ChangingSelection");df(this);a&&this.Ga("ChangedSelection")};function df(a){a=a.selection;if(0<a.count){for(var b=a.Pe(),c=b.length,d=0;d<c;d++)b[d].ib=!1;a.Ra();a.clear();a.freeze()}}
v.prototype.select=v.prototype.select=function(a){null!==a&&a.layer.h===this&&(t.l(a,x,v,"select:part"),!a.ib||1<this.selection.count)&&(this.Ga("ChangingSelection"),df(this),a.ib=!0,this.Ga("ChangedSelection"))};
v.prototype.selectCollection=v.prototype.zG=function(a){this.Ga("ChangingSelection");df(this);if(t.isArray(a))for(var b=t.ub(a),c=0;c<b;c++){var d=t.rb(a,c);d instanceof x||t.m("Diagram.selectCollection given something that is not a Part: "+d);d.ib=!0}else for(a=a.k;a.next();)d=a.value,d instanceof x||t.m("Diagram.selectCollection given something that is not a Part: "+d),d.ib=!0;this.Ga("ChangedSelection")};
v.prototype.clearHighlighteds=v.prototype.sE=function(){var a=this.Zw;if(0<a.count){for(var b=a.Pe(),c=b.length,d=0;d<c;d++)b[d].Fg=!1;a.Ra();a.clear();a.freeze()}};v.prototype.highlight=function(a){null!==a&&a.layer.h===this&&(t.l(a,x,v,"highlight:part"),!a.Fg||1<this.Zw.count)&&(this.sE(),a.Fg=!0)};
v.prototype.highlightCollection=function(a){this.sE();if(t.isArray(a))for(var b=t.ub(a),c=0;c<b;c++){var d=t.rb(a,c);d instanceof x||t.m("Diagram.highlightCollection given something that is not a Part: "+d);d.Fg=!0}else for(a=a.k;a.next();)d=a.value,d instanceof x||t.m("Diagram.highlightCollection given something that is not a Part: "+d),d.Fg=!0};
v.prototype.scroll=function(a,b,c){void 0===c&&(c=1);var d="up"===b||"down"===b,f;"pixel"===a?f=c:"line"===a?f=c*(d?this.dq:this.cq):"page"===a?(a=d?this.Ab.height:this.Ab.width,a*=this.scale,0!==a&&(f=Math.max(a-(d?this.dq:this.cq),0),f*=c)):t.m("scrolling unit must be 'pixel', 'line', or 'page', not: "+a);f/=this.scale;c=this.position.copy();"up"===b?c.y=this.position.y-f:"down"===b?c.y=this.position.y+f:"left"===b?c.x=this.position.x-f:"right"===b?c.x=this.position.x+f:t.m("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+
b);this.position=c};v.prototype.scrollToRect=function(a){var b=this.Ab;b.kk(a)||(a=a.eA,a.x-=b.width/2,a.y-=b.height/2,this.position=a)};v.prototype.centerRect=function(a){var b=this.Ab;a=a.eA;a.x-=b.width/2;a.y-=b.height/2;this.position=a};v.prototype.transformDocToView=v.prototype.JB=function(a){var b=this.Oc;b.reset();1!==this.fc&&b.scale(this.fc);var c=this.Pa;(0!==c.x||0!==c.y)&&isFinite(c.x)&&isFinite(c.y)&&b.translate(-c.x,-c.y);return a.copy().transform(this.Oc)};
function ga(a,b){var c=a.Oc,d=b[0],f=b[1],g=d+b[2],h=f+b[3],k=c.m11,l=c.m12,m=c.m21,n=c.m22,p=c.dx,q=c.dy,r=d*k+f*m+p,s=d*l+f*n+q,c=g*k+f*m+p,f=g*l+f*n+q,u=d*k+h*m+p,d=d*l+h*n+q,k=g*k+h*m+p,g=g*l+h*n+q,h=r,l=s,r=Math.min(r,c),h=Math.max(h,c),l=Math.min(l,f),s=Math.max(s,f),r=Math.min(r,u),h=Math.max(h,u),l=Math.min(l,d),s=Math.max(s,d),r=Math.min(r,k),h=Math.max(h,k),l=Math.min(l,g),s=Math.max(s,g);return[r,l,h-r,s-l]}
v.prototype.transformViewToDoc=v.prototype.$G=function(a){var b=this.Oc;b.reset();1!==this.fc&&b.scale(this.fc);var c=this.Pa;(0!==c.x||0!==c.y)&&isFinite(c.x)&&isFinite(c.y)&&b.translate(-c.x,-c.y);return lb(a.copy(),this.Oc)};var ef;v.None=ef=t.w(v,"None",0);var Li;v.Uniform=Li=t.w(v,"Uniform",1);var Mi;v.UniformToFill=Mi=t.w(v,"UniformToFill",2);var rg;v.CycleAll=rg=t.w(v,"CycleAll",10);var vg;v.CycleNotDirected=vg=t.w(v,"CycleNotDirected",11);var xg;
v.CycleNotDirectedFast=xg=t.w(v,"CycleNotDirectedFast",12);var yg;v.CycleNotUndirected=yg=t.w(v,"CycleNotUndirected",13);var sg;v.CycleDestinationTree=sg=t.w(v,"CycleDestinationTree",14);var ug;v.CycleSourceTree=ug=t.w(v,"CycleSourceTree",15);t.g(v,"validCycle",v.prototype.fH);t.defineProperty(v,{fH:"validCycle"},function(){return this.jw},function(a){var b=this.jw;b!==a&&(t.Fa(a,v,v,"validCycle"),this.jw=a,this.j("validCycle",b,a))});t.g(v,"linkSpacing",v.prototype.Lp);
t.defineProperty(v,{Lp:"linkSpacing"},function(){return this.Mj},function(a){var b=this.Mj;b!==a&&(t.q(a,v,"linkSpacing"),0>a&&t.ha(a,">= zero",v,"linkSpacing"),this.Mj=a,this.j("linkSpacing",b,a))});t.A(v,{pn:"layers"},function(){return this.Wb.k});t.g(v,"isModelReadOnly",v.prototype.ef);t.defineProperty(v,{ef:"isModelReadOnly"},function(){var a=this.pe;return null===a?!1:a.hb},function(a){var b=this.pe;null!==b&&(b.hb=a)});t.g(v,"isReadOnly",v.prototype.hb);
t.defineProperty(v,{hb:"isReadOnly"},function(){return this.Wk},function(a){var b=this.Wk;b!==a&&(t.i(a,"boolean",v,"isReadOnly"),this.Wk=a,this.j("isReadOnly",b,a))});t.g(v,"isEnabled",v.prototype.isEnabled);t.defineProperty(v,{isEnabled:"isEnabled"},function(){return this.Re},function(a){var b=this.Re;b!==a&&(t.i(a,"boolean",v,"isEnabled"),this.Re=a,this.j("isEnabled",b,a))});t.g(v,"allowClipboard",v.prototype.rw);
t.defineProperty(v,{rw:"allowClipboard"},function(){return this.tu},function(a){var b=this.tu;b!==a&&(t.i(a,"boolean",v,"allowClipboard"),this.tu=a,this.j("allowClipboard",b,a))});t.g(v,"allowCopy",v.prototype.dj);t.defineProperty(v,{dj:"allowCopy"},function(){return this.yk},function(a){var b=this.yk;b!==a&&(t.i(a,"boolean",v,"allowCopy"),this.yk=a,this.j("allowCopy",b,a))});t.g(v,"allowDelete",v.prototype.ll);
t.defineProperty(v,{ll:"allowDelete"},function(){return this.zk},function(a){var b=this.zk;b!==a&&(t.i(a,"boolean",v,"allowDelete"),this.zk=a,this.j("allowDelete",b,a))});t.g(v,"allowDragOut",v.prototype.at);t.defineProperty(v,{at:"allowDragOut"},function(){return this.uu},function(a){var b=this.uu;b!==a&&(t.i(a,"boolean",v,"allowDragOut"),this.uu=a,this.j("allowDragOut",b,a))});t.g(v,"allowDrop",v.prototype.Yz);
t.defineProperty(v,{Yz:"allowDrop"},function(){return this.vu},function(a){var b=this.vu;b!==a&&(t.i(a,"boolean",v,"allowDrop"),this.vu=a,this.j("allowDrop",b,a))});t.g(v,"allowTextEdit",v.prototype.cp);t.defineProperty(v,{cp:"allowTextEdit"},function(){return this.Ik},function(a){var b=this.Ik;b!==a&&(t.i(a,"boolean",v,"allowTextEdit"),this.Ik=a,this.j("allowTextEdit",b,a))});t.g(v,"allowGroup",v.prototype.Zo);
t.defineProperty(v,{Zo:"allowGroup"},function(){return this.Ak},function(a){var b=this.Ak;b!==a&&(t.i(a,"boolean",v,"allowGroup"),this.Ak=a,this.j("allowGroup",b,a))});t.g(v,"allowUngroup",v.prototype.dp);t.defineProperty(v,{dp:"allowUngroup"},function(){return this.Jk},function(a){var b=this.Jk;b!==a&&(t.i(a,"boolean",v,"allowUngroup"),this.Jk=a,this.j("allowUngroup",b,a))});t.g(v,"allowInsert",v.prototype.Pm);
t.defineProperty(v,{Pm:"allowInsert"},function(){return this.xu},function(a){var b=this.xu;b!==a&&(t.i(a,"boolean",v,"allowInsert"),this.xu=a,this.j("allowInsert",b,a))});t.g(v,"allowLink",v.prototype.Qm);t.defineProperty(v,{Qm:"allowLink"},function(){return this.Bk},function(a){var b=this.Bk;b!==a&&(t.i(a,"boolean",v,"allowLink"),this.Bk=a,this.j("allowLink",b,a))});t.g(v,"allowRelink",v.prototype.gk);
t.defineProperty(v,{gk:"allowRelink"},function(){return this.Dk},function(a){var b=this.Dk;b!==a&&(t.i(a,"boolean",v,"allowRelink"),this.Dk=a,this.j("allowRelink",b,a))});t.g(v,"allowMove",v.prototype.fk);t.defineProperty(v,{fk:"allowMove"},function(){return this.Ck},function(a){var b=this.Ck;b!==a&&(t.i(a,"boolean",v,"allowMove"),this.Ck=a,this.j("allowMove",b,a))});t.g(v,"allowReshape",v.prototype.$o);
t.defineProperty(v,{$o:"allowReshape"},function(){return this.Ek},function(a){var b=this.Ek;b!==a&&(t.i(a,"boolean",v,"allowReshape"),this.Ek=a,this.j("allowReshape",b,a))});t.g(v,"allowResize",v.prototype.ap);t.defineProperty(v,{ap:"allowResize"},function(){return this.Fk},function(a){var b=this.Fk;b!==a&&(t.i(a,"boolean",v,"allowResize"),this.Fk=a,this.j("allowResize",b,a))});t.g(v,"allowRotate",v.prototype.bp);
t.defineProperty(v,{bp:"allowRotate"},function(){return this.Gk},function(a){var b=this.Gk;b!==a&&(t.i(a,"boolean",v,"allowRotate"),this.Gk=a,this.j("allowRotate",b,a))});t.g(v,"allowSelect",v.prototype.Ve);t.defineProperty(v,{Ve:"allowSelect"},function(){return this.Hk},function(a){var b=this.Hk;b!==a&&(t.i(a,"boolean",v,"allowSelect"),this.Hk=a,this.j("allowSelect",b,a))});t.g(v,"allowUndo",v.prototype.Zz);
t.defineProperty(v,{Zz:"allowUndo"},function(){return this.yu},function(a){var b=this.yu;b!==a&&(t.i(a,"boolean",v,"allowUndo"),this.yu=a,this.j("allowUndo",b,a))});t.g(v,"allowZoom",v.prototype.bt);t.defineProperty(v,{bt:"allowZoom"},function(){return this.Au},function(a){var b=this.Au;b!==a&&(t.i(a,"boolean",v,"allowZoom"),this.Au=a,this.j("allowZoom",b,a))});t.g(v,"hasVerticalScrollbar",v.prototype.rF);
t.defineProperty(v,{rF:"hasVerticalScrollbar"},function(){return this.dv},function(a){var b=this.dv;b!==a&&(t.i(a,"boolean",v,"hasVerticalScrollbar"),this.dv=a,Oi(this),this.na(),this.j("hasVerticalScrollbar",b,a),Hi(this))});t.g(v,"hasHorizontalScrollbar",v.prototype.qF);t.defineProperty(v,{qF:"hasHorizontalScrollbar"},function(){return this.cv},function(a){var b=this.cv;b!==a&&(t.i(a,"boolean",v,"hasHorizontalScrollbar"),this.cv=a,Oi(this),this.na(),this.j("hasHorizontalScrollbar",b,a),Hi(this))});
t.g(v,"allowHorizontalScroll",v.prototype.tf);t.defineProperty(v,{tf:"allowHorizontalScroll"},function(){return this.wu},function(a){var b=this.wu;b!==a&&(t.i(a,"boolean",v,"allowHorizontalScroll"),this.wu=a,this.j("allowHorizontalScroll",b,a),Hi(this))});t.g(v,"allowVerticalScroll",v.prototype.uf);t.defineProperty(v,{uf:"allowVerticalScroll"},function(){return this.zu},function(a){var b=this.zu;b!==a&&(t.i(a,"boolean",v,"allowVerticalScroll"),this.zu=a,this.j("allowVerticalScroll",b,a),Hi(this))});
t.g(v,"scrollHorizontalLineChange",v.prototype.cq);t.defineProperty(v,{cq:"scrollHorizontalLineChange"},function(){return this.Tv},function(a){var b=this.Tv;b!==a&&(t.i(a,"number",v,"scrollHorizontalLineChange"),0>a&&t.ha(a,">= 0",v,"scrollHorizontalLineChange"),this.Tv=a,this.j("scrollHorizontalLineChange",b,a))});t.g(v,"scrollVerticalLineChange",v.prototype.dq);
t.defineProperty(v,{dq:"scrollVerticalLineChange"},function(){return this.Uv},function(a){var b=this.Uv;b!==a&&(t.i(a,"number",v,"scrollVerticalLineChange"),0>a&&t.ha(a,">= 0",v,"scrollVerticalLineChange"),this.Uv=a,this.j("scrollVerticalLineChange",b,a))});t.g(v,"lastInput",v.prototype.T);t.defineProperty(v,{T:"lastInput"},function(){return this.dc},function(a){e&&t.l(a,Ad,v,"lastInput");this.dc=a});t.g(v,"firstInput",v.prototype.Rc);
t.defineProperty(v,{Rc:"firstInput"},function(){return this.Qk},function(a){e&&t.l(a,Ad,v,"firstInput");this.Qk=a});t.g(v,"currentCursor",v.prototype.gc);t.defineProperty(v,{gc:"currentCursor"},function(){return this.My},function(a){""===a&&(a=this.Uq);this.My!==a&&(t.i(a,"string",v,"currentCursor"),null!==this.Za&&(this.My=a,this.Za.style.cursor=a,this.Rb.style.cursor=a))});t.g(v,"defaultCursor",v.prototype.EI);
t.defineProperty(v,{EI:"defaultCursor"},function(){return this.Uq},function(a){""===a&&(a="auto");var b=this.Uq;b!==a&&(t.i(a,"string",v,"defaultCursor"),this.Uq=a,this.j("defaultCursor",b,a))});t.g(v,"hasGestureZoom",v.prototype.lJ);t.defineProperty(v,{lJ:"hasGestureZoom"},function(){return this.Ii},function(a){var b=this.Ii;b!==a&&(t.i(a,"boolean",v,"hasGestureZoom"),this.Ii=a,this.j("hasGestureZoom",b,a))});t.g(v,"click",v.prototype.click);
t.defineProperty(v,{click:"click"},function(){return this.Ai},function(a){var b=this.Ai;b!==a&&(null!==a&&t.i(a,"function",v,"click"),this.Ai=a,this.j("click",b,a))});t.g(v,"doubleClick",v.prototype.dn);t.defineProperty(v,{dn:"doubleClick"},function(){return this.Gi},function(a){var b=this.Gi;b!==a&&(null!==a&&t.i(a,"function",v,"doubleClick"),this.Gi=a,this.j("doubleClick",b,a))});t.g(v,"contextClick",v.prototype.jt);
t.defineProperty(v,{jt:"contextClick"},function(){return this.Ci},function(a){var b=this.Ci;b!==a&&(null!==a&&t.i(a,"function",v,"contextClick"),this.Ci=a,this.j("contextClick",b,a))});t.g(v,"mouseOver",v.prototype.Pt);t.defineProperty(v,{Pt:"mouseOver"},function(){return this.Qi},function(a){var b=this.Qi;b!==a&&(null!==a&&t.i(a,"function",v,"mouseOver"),this.Qi=a,this.j("mouseOver",b,a))});t.g(v,"mouseHover",v.prototype.Ot);
t.defineProperty(v,{Ot:"mouseHover"},function(){return this.Pi},function(a){var b=this.Pi;b!==a&&(null!==a&&t.i(a,"function",v,"mouseHover"),this.Pi=a,this.j("mouseHover",b,a))});t.g(v,"mouseHold",v.prototype.Nt);t.defineProperty(v,{Nt:"mouseHold"},function(){return this.Oi},function(a){var b=this.Oi;b!==a&&(null!==a&&t.i(a,"function",v,"mouseHold"),this.Oi=a,this.j("mouseHold",b,a))});t.g(v,"mouseDragOver",v.prototype.aG);
t.defineProperty(v,{aG:"mouseDragOver"},function(){return this.zv},function(a){var b=this.zv;b!==a&&(null!==a&&t.i(a,"function",v,"mouseDragOver"),this.zv=a,this.j("mouseDragOver",b,a))});t.g(v,"mouseDrop",v.prototype.Mt);t.defineProperty(v,{Mt:"mouseDrop"},function(){return this.Ni},function(a){var b=this.Ni;b!==a&&(null!==a&&t.i(a,"function",v,"mouseDrop"),this.Ni=a,this.j("mouseDrop",b,a))});t.g(v,"toolTip",v.prototype.mu);
t.defineProperty(v,{mu:"toolTip"},function(){return this.$i},function(a){var b=this.$i;b!==a&&(null!==a&&t.l(a,ea,v,"toolTip"),this.$i=a,this.j("toolTip",b,a))});t.g(v,"contextMenu",v.prototype.contextMenu);t.defineProperty(v,{contextMenu:"contextMenu"},function(){return this.Di},function(a){var b=this.Di;b!==a&&(null!==a&&t.l(a,ea,v,"contextMenu"),this.Di=a,this.j("contextMenu",b,a))});t.g(v,"commandHandler",v.prototype.Ye);
t.defineProperty(v,{Ye:"commandHandler"},function(){return this.Dy},function(a){var b=this.Dy;b!==a&&(t.l(a,Ba,v,"commandHandler"),null!==a.h&&t.m("Cannot share CommandHandlers between Diagrams: "+a.toString()),null!==b&&b.Ed(null),this.Dy=a,a.Ed(this))});t.g(v,"toolManager",v.prototype.Cb);
t.defineProperty(v,{Cb:"toolManager"},function(){return this.hw},function(a){var b=this.hw;b!==a&&(t.l(a,$e,v,"toolManager"),null!==a.h&&t.m("Cannot share ToolManagers between Diagrams: "+a.toString()),null!==b&&b.Ed(null),this.hw=a,a.Ed(this))});t.g(v,"defaultTool",v.prototype.Iw);t.defineProperty(v,{Iw:"defaultTool"},function(){return this.Sy},function(a){var b=this.Sy;b!==a&&(t.l(a,ze,v,"defaultTool"),this.Sy=a,this.Ya===b&&(this.Ya=a))});t.g(v,"currentTool",v.prototype.Ya);
t.defineProperty(v,{Ya:"currentTool"},function(){return this.Oy},function(a){var b=this.Oy;if(null!==b)for(b.la&&b.doDeactivate(),b.cancelWaitAfter(),b.doStop(),b=this.xm.k;b.next();)b.value.na();null===a&&(a=this.Iw);null!==a&&(t.l(a,ze,v,"currentTool"),this.Oy=a,a.Ed(this),a.doStart())});t.A(v,{selection:"selection"},function(){return this.Xv});t.g(v,"maxSelectionCount",v.prototype.UF);
t.defineProperty(v,{UF:"maxSelectionCount"},function(){return this.uv},function(a){var b=this.uv;if(b!==a)if(t.i(a,"number",v,"maxSelectionCount"),0<=a&&!isNaN(a)){if(this.uv=a,this.j("maxSelectionCount",b,a),!this.ma.yb&&(a=this.selection.count-a,0<a)){this.Ga("ChangingSelection");for(var b=this.selection.Pe(),c=0;c<a;c++)b[c].ib=!1;this.Ga("ChangedSelection")}}else t.ha(a,">= 0",v,"maxSelectionCount")});t.g(v,"nodeSelectionAdornmentTemplate",v.prototype.dG);
t.defineProperty(v,{dG:"nodeSelectionAdornmentTemplate"},function(){return this.Fv},function(a){var b=this.Fv;b!==a&&(t.l(a,ea,v,"nodeSelectionAdornmentTemplate"),this.Fv=a,this.j("nodeSelectionAdornmentTemplate",b,a))});t.g(v,"groupSelectionAdornmentTemplate",v.prototype.nF);t.defineProperty(v,{nF:"groupSelectionAdornmentTemplate"},function(){return this.$u},function(a){var b=this.$u;b!==a&&(t.l(a,ea,v,"groupSelectionAdornmentTemplate"),this.$u=a,this.j("groupSelectionAdornmentTemplate",b,a))});
t.g(v,"linkSelectionAdornmentTemplate",v.prototype.RF);t.defineProperty(v,{RF:"linkSelectionAdornmentTemplate"},function(){return this.ov},function(a){var b=this.ov;b!==a&&(t.l(a,ea,v,"linkSelectionAdornmentTemplate"),this.ov=a,this.j("linkSelectionAdornmentTemplate",b,a))});t.A(v,{Zw:"highlighteds"},function(){return this.ev});t.g(v,"isModified",v.prototype.rh);
t.defineProperty(v,{rh:"isModified"},function(){var a=this.ma;return a.isEnabled?null!==a.kj?!0:this.mz&&this.ah!==a.pj:this.mz},function(a){if(this.mz!==a){t.i(a,"boolean",v,"isModified");this.mz=a;var b=this.ma;!a&&b.isEnabled&&(this.ah=b.pj);a||mj(this)}});function mj(a){var b=a.rh;a.aE!==b&&(a.aE=b,a.Ga("Modified"))}t.g(v,"model",v.prototype.ea);
t.defineProperty(v,{ea:"model"},function(){return this.pe},function(a){var b=this.pe;if(b!==a){t.l(a,J,v,"model");this.Ya.doCancel();null!==b&&b.ma!==a.ma&&b.ma.DF&&t.m("Do not replace a Diagram.model while a transaction is in progress.");this.mc.iq();this.xw();this.rf=!1;this.jo=!0;this.ah=-2;this.Sf=!1;var c=this.Jd;this.Jd=!0;this.mc.Gl();null!==b&&(b.kB(this.dD),b instanceof T&&nj(this,b.tj),nj(this,b.Ng));this.pe=a;a.Wz(this.cD);oj(this,a.Ng);a instanceof T&&pj(this,a.tj);a.kB(this.cD);a.Wz(this.dD);
this.Jd=c;this.cc||this.na();null!==b&&(a.ma.isEnabled=b.ma.isEnabled)}});t.defineProperty(v,{Sa:null},function(){return this.WC},function(a){this.WC=a});
function ei(a,b){if(b.ea===a.ea){var c=b.Bd,d=b.propertyName;if(c===Kd&&"S"===d[0])if("StartingFirstTransaction"===d){c=a.Cb;for(d=c.jf.k;d.next();)d.value.Ed(a);for(d=c.Kg.k;d.next();)d.value.Ed(a);for(d=c.Lg.k;d.next();)d.value.Ed(a);a.Jd||a.rf||(a.Su=!0,a.jo&&(a.Sf=!0),a.yi.Gl())}else if("StartingUndo"===d||"StartingRedo"===d){var f=a.mc;f.Eg&&!a.ab&&f.iq();a.Ga("ChangingSelection")}else"StartedTransaction"===d&&(f=a.mc,f.Eg&&!a.ab&&f.iq(),a.lv&&f.Gl());else if(a.Sa){a.Sa=!1;try{var g=b.Ff;if(""!==
g)if(c===Ld){if("linkFromKey"===g){var h=b.object,k=a.Vf(h);if(null!==k){var l=b.newValue,m=a.af(l);k.ca=m}}else if("linkToKey"===g)h=b.object,k=a.Vf(h),null!==k&&(l=b.newValue,m=a.af(l),k.fa=m);else if("linkFromPortId"===g){if(h=b.object,k=a.Vf(h),null!==k){var n=b.newValue;"string"===typeof n&&(k.Af=n)}}else if("linkToPortId"===g)h=b.object,k=a.Vf(h),null!==k&&(n=b.newValue,"string"===typeof n&&(k.dg=n));else if("nodeGroupKey"===g){var h=b.object,p=a.qh(h);if(null!==p){var q=b.newValue;if(void 0!==
q){var r=a.af(q);p.fb=r instanceof z?r:null}else p.fb=null}}else if("linkLabelKeys"===g){if(h=b.object,k=a.Vf(h),null!==k){var s=b.oldValue,u=b.newValue;if(t.isArray(s))for(var w=t.ub(s),D=0;D<w;D++){var A=t.rb(s,D),m=a.af(A);null!==m&&(m.Dd=null)}if(t.isArray(u))for(w=t.ub(u),D=0;D<w;D++)A=t.rb(u,D),m=a.af(A),null!==m&&(m.Dd=k)}}else if("nodeParentKey"===g){var G=b.object,M=a.af(b.newValue),N=a.Sw(G);if(null!==N){var O=N.tt();null!==O?null===M?a.remove(O):a.vd?O.ca=M:O.fa=M:qj(a,M,N)}}else if("parentLinkCategory"===
g){var G=b.object,N=a.Sw(G),U=b.newValue;null!==N&&"string"===typeof U&&(O=N.tt(),null!==O&&(O.cd=U))}else if("nodeCategory"===g){var h=b.object,Y=a.qh(h),U=b.newValue;null!==Y&&"string"===typeof U&&(Y.cd=U)}else if("linkCategory"===g){var h=b.object,ba=a.Vf(h),U=b.newValue;null!==ba&&"string"===typeof U&&(ba.cd=U)}else if("nodeDataArray"===g){a.na();var R=b.oldValue;nj(a,R);var ya=b.newValue;oj(a,ya)}else"linkDataArray"===g&&(a.na(),R=b.oldValue,nj(a,R),ya=b.newValue,pj(a,ya));a.rh=!0}else if(c===
Md)ya=b.newValue,"nodeDataArray"===g&&t.xb(ya)?rj(a,ya):"linkDataArray"===g&&t.xb(ya)?sj(a,ya):"linkLabelKeys"===g&&Ee(ya)&&(k=a.Vf(b.object),m=a.af(ya),null!==k&&null!==m&&(m.Dd=k)),a.rh=!0;else if(c===Nd)R=b.oldValue,"nodeDataArray"===g&&t.xb(R)?tj(a,R):"linkDataArray"===g&&t.xb(R)?tj(a,R):"linkLabelKeys"===g&&Ee(R)&&(m=a.af(R),null!==m&&(m.Dd=null)),a.rh=!0;else{if(c===Kd&&"SourceChanged"===g){var p=a.qh(b.object),Ya=b.propertyName;null!==p&&"string"===typeof Ya&&(p.Vb(Ya),a.ea instanceof ce&&
(k=a.Vf(b.object),null!==k&&k.Vb(Ya)))}}else if(c===Ld){var Aa=b.propertyName,h=b.object;if(h===a.ea){if("nodeKeyProperty"===Aa||"nodeCategoryProperty"===Aa||"linkFromKeyProperty"===Aa||"linkToKeyProperty"===Aa||"linkFromPortIdProperty"===Aa||"linkToPortIdProperty"===Aa||"linkLabelKeysProperty"===Aa||"nodeIsGroupProperty"===Aa||"nodeGroupKeyProperty"===Aa||"nodeParentKeyProperty"===Aa||"linkCategoryProperty"===Aa)a.ma.yb||a.zn()}else di(a,h,Aa);a.rh=!0}else if(c===Md||c===Nd)uj(a,b),a.rh=!0;else if(c===
Kd){if("FinishedUndo"===d||"FinishedRedo"===d)a.ma.Ki=!0,a.Ga("ChangedSelection"),Fi(a),a.ma.Ki=!1;a.Su=!0;a.Ig();f=a.yi;f.zd&&0===a.ma.Qe&&Lh(f);"CommittedTransaction"===d&&a.ma.pz&&(a.ah=Math.min(a.ah,a.ma.pj-1));mj(a);a.wz||"CommittedTransaction"!==d||(a.wz=!0,setTimeout(function(){a.Ya.standardMouseOver();a.wz=!1},10))}}finally{a.Sa=!0}}}}
function di(a,b,c){var d=a.qh(b);if(null!==d&&"string"===typeof c)d.Vb(c),a.ea instanceof ce&&(b=a.Vf(b),null!==b&&b.Vb(c));else if("string"===typeof c){d=null;for(a=a.km.k;a.next();){for(var f=a.value,g=0;g<f.length;g++){var h=f[g];null!==h.mg&&(h=h.mg.Da(b),null!==h&&(null===d&&(d=t.Hb()),d.push(h)))}if(null!==d)break}b=d;if(null!==b){for(d=0;d<b.length;d++)b[d].Vb(c);t.Ca(b)}}}t.g(v,"skipsModelSourceBindings",v.prototype.hu);
t.defineProperty(v,{hu:"skipsModelSourceBindings"},function(){return this.BD},function(a){this.BD=a});function uj(a,b){var c=b.Bd===Md,d=c?b.Zf:b.ag,f=c?b.newValue:b.oldValue,g=a.km.Da(b.object);if(Array.isArray(g)&&"number"===typeof d)for(var h=0;h<g.length;h++){var k=g[h];k.type!==$g&&k.type!==ti||d++;c?xj(k,f,d):(k.cf(d),Ij(k,d-1))}}function fj(a,b){var c=b.Li;if(t.isArray(c)){var d=a.km.Da(c);if(null===d)a.km.add(c,[b]);else{for(c=0;c<d.length;c++)if(d[c]===b)return;d.push(b)}}}
function ij(a,b){var c=b.Li;if(t.isArray(c)){var d=a.km.Da(c);if(null!==d)for(var f=0;f<d.length;f++)if(d[f]===b){d.splice(f,1);0===d.length&&a.km.remove(c);break}}}
v.prototype.clear=v.prototype.clear=function(){var a=null;null!==this.md&&(a=this.md.U);this.ea.clear();for(var b=this.Wb.length,c=0;c<b;c++)this.Wb.n[c].clear();this.lg.clear();this.co.clear();this.Gv.clear();this.gl.clear();this.pv.clear();this.mb.clear();this.Ei.clear();this.Nk.clear();this.km.clear();this.Xv.Ra();this.Xv.clear();this.Xv.freeze();this.ev.Ra();this.ev.clear();this.ev.freeze();this.Sn=null;t.gt=null;this.Tu=(new F(NaN,NaN,NaN,NaN)).freeze();null!==a&&(this.add(a),this.mb.remove(a));
this.na()};
v.prototype.reset=v.prototype.reset=function(){this.cc=!0;this.clear();this.Wb=new H(se);this.el={};this.mG();this.Pa=(new E(NaN,NaN)).freeze();this.fc=1;this.gv=(new E(NaN,NaN)).freeze();this.hv=NaN;this.wv=1E-4;this.tv=100;this.mw=(new E(NaN,NaN)).freeze();this.Yu=(new F(NaN,NaN,NaN,NaN)).freeze();this.Sl=ef;this.Rn=Ub;this.Uk=ef;this.qo=Ub;this.iv=this.fv=Vb;this.Du=(new wb(16,16,16,16)).freeze();this.kv=!0;this.jw=rg;this.Uq="auto";this.Di=this.$i=this.Ni=this.zv=this.Oi=this.Pi=this.Qi=this.Ci=
this.Gi=this.Ai=null;this.Wk=!1;this.zk=this.yk=this.tu=this.Re=!0;this.vu=this.uu=!1;this.zu=this.wu=this.dv=this.cv=this.Au=this.yu=this.Hk=this.Gk=this.Fk=this.Ek=this.Ck=this.Dk=this.Bk=this.xu=this.Jk=this.Ak=this.Ik=!0;this.Uv=this.Tv=16;this.Te=(new wb(5)).freeze();this.uv=999999999;this.Yd=null;fi(this);gi(this);this.md=null;this.ea=new T;this.Xi=!0;this.ic=new Ae;this.rf=this.Xi=!1;this.jo=!0;this.cc=this.Sf=!1;this.na()};
v.prototype.rebuildParts=v.prototype.zn=function(){for(var a=this.ux.k;a.next();){var b=a.value;(!b.Rd()||b instanceof z)&&t.m('Invalid node template in Diagram.nodeTemplateMap: template for "'+a.key+'" must be a Node or a simple Part, not a Group or Link: '+b)}for(a=this.Xw.k;a.next();)b=a.value,b instanceof z||t.m('Invalid group template in Diagram.groupTemplateMap: template for "'+a.key+'" must be a Group, not a normal Node or Link: '+b);for(a=this.qx.k;a.next();)b=a.value,b instanceof B||t.m('Invalid link template in Diagram.linkTemplateMap: template for "'+
a.key+'" must be a Link, not a normal Node or simple Part: '+b);a=t.Hb();for(b=this.selection.k;b.next();){var c=b.value.data;c&&a.push(c)}for(var b=t.Hb(),d=this.Zw.k;d.next();)(c=d.value.data)&&b.push(c);for(var c=t.Hb(),f=this.vh.k;f.next();)d=f.value,d.data&&(c.push(d.data),c.push(d.location));for(f=this.links.k;f.next();)d=f.value,d.data&&(c.push(d.data),c.push(d.location));for(f=this.vj.k;f.next();)d=f.value,d.data&&(c.push(d.data),c.push(d.location));d=this.ea;d instanceof T&&nj(this,d.tj);
nj(this,d.Ng);oj(this,d.Ng);d instanceof T&&pj(this,d.tj);for(d=0;d<a.length;d++)if(f=this.qh(a[d]))f.ib=!0;for(d=0;d<b.length;d++)if(f=this.qh(b[d]))f.Fg=!0;for(d=0;d<c.length;d+=2)if(f=this.qh(c[d]))f.location=c[d+1];t.Ca(a);t.Ca(b);t.Ca(c)};
function oj(a,b){if(null!==b){for(var c=a.ea,d=t.ub(b),f=0;f<d;f++){var g=t.rb(b,f);c.te(g)?rj(a,g,!1):c instanceof T&&sj(a,g)}if(c instanceof T||c instanceof ce){for(f=0;f<d;f++)g=t.rb(b,f),c.te(g)&&Jj(a,g);if(c instanceof T)for(c=a.links;c.next();)Kj(c.value)}Lj(a,!1)}}
function rj(a,b,c){if(void 0!==b&&null!==b&&!a.ma.yb&&!a.Ei.contains(b)){void 0===c&&(c=!0);var d=a.getCategoryForNodeData(b),f=a.findTemplateForNodeData(b,d);f instanceof x&&(cf(f),f=f.copy(),f instanceof x&&(f.Eh=d,a.Ln&&(f.Xk="Tool"),a.add(f),f.data=b,c&&Jj(a,b)))}}v.prototype.getCategoryForNodeData=function(a){var b=this.ea,c=b.getCategoryForNodeData(a),d=!1;b instanceof T&&(d=b.tJ(a));d&&""===c&&(c="LinkLabel");return c};
v.prototype.findTemplateForNodeData=function(a,b){var c=!1,d=this.ea;d instanceof T&&(c=d.KA(a));c?(c=this.Xw.Da(b),null===c&&(c=this.Xw.Da(""),null===c&&(t.iH||(t.iH=!0,t.trace('No Group template found for category "'+b+'"'),t.trace("  Using default group template")),c=this.rC))):(c=this.ux.Da(b),null===c&&(c=this.ux.Da(""),null===c&&(t.lH||(t.lH=!0,t.trace('No Node template found for category "'+b+'"'),t.trace("  Using default node template")),c=this.tC)));return c instanceof x?c:null};
function Jj(a,b){var c=a.ea;if(c instanceof T||c instanceof ce){var d=c.Lb(b);if(void 0!==d){var f=Fe(c,d),g=a.qh(b);if(null!==f&&null!==g){for(f=f.k;f.next();){var h=f.value;if(c instanceof T)if(c.te(h)){if(g instanceof z&&c.hn(h)===d){var k=a.qh(h);null!==k&&(k.fb=g)}}else{if(k=a.Vf(h),null!==k&&g instanceof y&&(c.vl(h)===d&&(k.ca=g),c.zl(h)===d&&(k.fa=g),h=c.xl(h),t.isArray(h)))for(var l=0;l<t.ub(h);l++)if(t.rb(h,l)===d){g.Dd=k;break}}else c instanceof ce&&c.te(h)&&g instanceof y&&c.jn(h)===d&&
(k=a.Sw(h),qj(a,g,k))}He(c,d)}c instanceof T?(c=c.hn(b),void 0!==c&&(c=a.af(c),c instanceof z&&(g.fb=c))):c instanceof ce&&(c=c.jn(b),void 0!==c&&g instanceof y&&(c=a.af(c),qj(a,c,g)))}}}
function qj(a,b,c){if(null!==b&&null!==c){var d=a.Cb.QA,f=b,g=c;if(a.vd)for(b=g.Td;b.next();){var h=b.value;if(h.fa===g)return}else for(f=c,g=b,b=f.Td;b.next();)if(h=b.value,h.ca===f)return;null!==d&&tg(d,f,g,null,!0)||(d=a.getCategoryForLinkData(c.data),b=a.findTemplateForLinkData(c.data,d),b instanceof B&&(cf(b),b=b.copy(),b instanceof B&&(b.Eh=d,b.ca=f,b.fa=g,a.add(b),b.data=c.data)))}}function pj(a,b){if(null!==b){for(var c=t.ub(b),d=0;d<c;d++){var f=t.rb(b,d);sj(a,f)}Lj(a,!1)}}
function sj(a,b){if(void 0!==b&&null!==b&&!a.ma.yb&&!a.Nk.contains(b)){var c=a.getCategoryForLinkData(b),d=a.findTemplateForLinkData(b,c);if(d instanceof B&&(cf(d),d=d.copy(),d instanceof B)){d.Eh=c;var c=a.ea,f=c.fJ(b);""!==f&&(d.Af=f);f=c.vl(b);void 0!==f&&(f=a.af(f),f instanceof y&&(d.ca=f));f=c.iJ(b);""!==f&&(d.dg=f);f=c.zl(b);void 0!==f&&(f=a.af(f),f instanceof y&&(d.fa=f));c=c.xl(b);if(t.isArray(c))for(var f=t.ub(c),g=0;g<f;g++){var h=t.rb(c,g),h=a.af(h);null!==h&&(h.Dd=d)}a.add(d);d.data=b}}}
v.prototype.getCategoryForLinkData=function(a){var b=this.ea,c="";b instanceof T?c=b.getCategoryForLinkData(a):b instanceof ce&&(c=b.hJ(a));return c};v.prototype.findTemplateForLinkData=function(a,b){var c=this.qx.Da(b);null===c&&(c=this.qx.Da(""),null===c&&(t.kH||(t.kH=!0,t.trace('No Link template found for category "'+b+'"'),t.trace("  Using default link template")),c=this.sC));return c instanceof B?c:null};function nj(a,b){for(var c=t.ub(b),d=0;d<c;d++){var f=t.rb(b,d);tj(a,f)}}
function tj(a,b){if(void 0!==b&&null!==b){var c=a.qh(b);if(c instanceof x){c.ib=!1;c.Fg=!1;var d=c.layer;if(null!==d&&d.h===a){var f=a.ea;if(f instanceof T&&c instanceof y){var g=f.Lb(c.data);if(void 0!==g){for(var h=c.Td;h.next();){var k=h.value.data;Ge(f,g,k)}c.ni&&(h=c.Dd,null!==h&&(k=h.data,Ge(f,g,k)));if(c instanceof z)for(h=c.Vc;h.next();)k=h.value.data,f.te(k)&&Ge(f,g,k)}}else if(f instanceof ce&&c instanceof y){h=a.Vf(c.data);if(null!==h&&(h.ib=!1,h.Fg=!1,k=h.layer,null!==k)){var l=k.cf(-1,
h,!1);0<=l&&a.ed(Nd,"parts",k,h,null,l,null);l=h.Gp;null!==l&&l(h,k,null)}h=a.vd;for(k=c.Td;k.next();)l=k.value,l=(h?l.fa:l.ca).data,f.te(l)&&Ge(f,g,l)}f=d.cf(-1,c,!1);0<=f&&a.ed(Nd,"parts",d,c,null,f,null);f=c.Gp;null!==f&&f(c,d,null)}}}}v.prototype.findPartForKey=v.prototype.dJ=function(a){if(null===a||void 0===a)return null;a=this.ea.zf(a);if(null===a)return null;a=this.Ei.Da(a);return a instanceof x?a:null};
v.prototype.findNodeForKey=v.prototype.af=function(a){if(null===a||void 0===a)return null;a=this.ea.zf(a);if(null===a)return null;a=this.Ei.Da(a);return a instanceof y?a:null};v.prototype.findPartForData=v.prototype.qh=function(a){if(null===a)return null;var b=this.Ei.Da(a);if(b instanceof x)return b;b=this.Nk.Da(a);return b instanceof x?b:null};v.prototype.findNodeForData=v.prototype.Sw=function(a){if(null===a)return null;a=this.Ei.Da(a);return a instanceof y?a:null};
v.prototype.findLinkForData=v.prototype.Vf=function(a){if(null===a)return null;a=this.Nk.Da(a);return a instanceof B?a:null};t.g(v,"nodeTemplate",v.prototype.PJ);t.defineProperty(v,{PJ:"nodeTemplate"},function(){return this.Ri.Da("")},function(a){var b=this.Ri.Da("");b!==a&&(t.l(a,x,v,"nodeTemplate"),this.Ri.add("",a),this.j("nodeTemplate",b,a),this.ma.yb||this.zn())});t.g(v,"nodeTemplateMap",v.prototype.ux);
t.defineProperty(v,{ux:"nodeTemplateMap"},function(){return this.Ri},function(a){var b=this.Ri;b!==a&&(t.l(a,wa,v,"nodeTemplateMap"),this.Ri=a,this.j("nodeTemplateMap",b,a),this.ma.yb||this.zn())});t.g(v,"groupTemplate",v.prototype.kJ);t.defineProperty(v,{kJ:"groupTemplate"},function(){return this.Rk.Da("")},function(a){var b=this.Rk.Da("");b!==a&&(t.l(a,z,v,"groupTemplate"),this.Rk.add("",a),this.j("groupTemplate",b,a),this.ma.yb||this.zn())});t.g(v,"groupTemplateMap",v.prototype.Xw);
t.defineProperty(v,{Xw:"groupTemplateMap"},function(){return this.Rk},function(a){var b=this.Rk;b!==a&&(t.l(a,wa,v,"groupTemplateMap"),this.Rk=a,this.j("groupTemplateMap",b,a),this.ma.yb||this.zn())});t.g(v,"linkTemplate",v.prototype.GJ);t.defineProperty(v,{GJ:"linkTemplate"},function(){return this.Nj.Da("")},function(a){var b=this.Nj.Da("");b!==a&&(t.l(a,B,v,"linkTemplate"),this.Nj.add("",a),this.j("linkTemplate",b,a),this.ma.yb||this.zn())});t.g(v,"linkTemplateMap",v.prototype.qx);
t.defineProperty(v,{qx:"linkTemplateMap"},function(){return this.Nj},function(a){var b=this.Nj;b!==a&&(t.l(a,wa,v,"linkTemplateMap"),this.Nj=a,this.j("linkTemplateMap",b,a),this.ma.yb||this.zn())});t.g(v,"isMouseCaptured",v.prototype.Qd);
t.defineProperty(v,{Qd:"isMouseCaptured"},function(){return this.TC},function(a){var b=this.Za;null!==b&&(a?(this.T.bubbles=!1,b.removeEventListener("mousemove",this.Qp,!1),b.removeEventListener("mousedown",this.Pp,!1),b.removeEventListener("mouseup",this.Sp,!1),b.removeEventListener("mousewheel",this.th,!1),b.removeEventListener("DOMMouseScroll",this.th,!1),b.removeEventListener("mouseout",this.Rp,!1),window.addEventListener("mousemove",this.Qp,!0),window.addEventListener("mousedown",this.Pp,!0),
window.addEventListener("mouseup",this.Sp,!0),window.addEventListener("mousewheel",this.th,!0),window.addEventListener("DOMMouseScroll",this.th,!0),window.addEventListener("mouseout",this.Rp,!0),window.addEventListener("selectstart",this.preventDefault,!1)):(window.removeEventListener("mousemove",this.Qp,!0),window.removeEventListener("mousedown",this.Pp,!0),window.removeEventListener("mouseup",this.Sp,!0),window.removeEventListener("mousewheel",this.th,!0),window.removeEventListener("DOMMouseScroll",
this.th,!0),window.removeEventListener("mouseout",this.Rp,!0),window.removeEventListener("selectstart",this.preventDefault,!1),b.addEventListener("mousemove",this.Qp,!1),b.addEventListener("mousedown",this.Pp,!1),b.addEventListener("mouseup",this.Sp,!1),b.addEventListener("mousewheel",this.th,!1),b.addEventListener("DOMMouseScroll",this.th,!1),b.addEventListener("mouseout",this.Rp,!1)),this.TC=a)});t.g(v,"position",v.prototype.position);
t.defineProperty(v,{position:"position"},function(){return this.Pa},function(a){var b=this.Pa;if(!b.O(a)){t.l(a,E,v,"position");var c=this.Ab.copy();c.x=b.x;c.y=b.y;a=a.copy();if(!this.cc&&null!==this.Za){this.cc=!0;var d=this.scale;Ji(this,a,this.Lc,this.Jb/d,this.Ib/d,this.Rn);this.cc=!1}this.Pa=a.ba();a=this.mc;a.zd&&Wh(a,b,this.Pa);this.cc||this.Ut(c,this.Ab)}});t.g(v,"initialPosition",v.prototype.vF);
t.defineProperty(v,{vF:"initialPosition"},function(){return this.gv},function(a){this.gv.O(a)||(t.l(a,E,v,"initialPosition"),this.gv=a.ba())});t.g(v,"initialScale",v.prototype.wF);t.defineProperty(v,{wF:"initialScale"},function(){return this.hv},function(a){this.hv!==a&&(t.i(a,"number",v,"initialScale"),this.hv=a)});t.g(v,"grid",v.prototype.xp);
t.defineProperty(v,{xp:"grid"},function(){null===this.md&&Bi(this);return this.md},function(a){var b=this.md;if(b!==a){null===b&&(Bi(this),b=this.md);t.l(a,C,v,"grid");a.type!==Ci&&t.m("Diagram.grid must be a Panel of type Panel.Grid");var c=b.ia;null!==c&&c.remove(b);this.md=a;a.name="GRID";null!==c&&c.add(a);Pi(this);this.na();this.j("grid",b,a)}});
t.A(v,{Ab:"viewportBounds"},function(){var a=this.$D;if(null===this.Za)return a;var b=this.Pa,c=this.fc;a.p(b.x,b.y,Math.max(this.Jb,0)/c,Math.max(this.Ib,0)/c);return a});t.g(v,"fixedBounds",v.prototype.vA);t.defineProperty(v,{vA:"fixedBounds"},function(){return this.Yu},function(a){var b=this.Yu;b.O(a)||(t.l(a,F,v,"fixedBounds"),this.Yu=a=a.ba(),this.Sc(),this.j("fixedBounds",b,a))});t.A(v,{Lc:"documentBounds"},function(){return this.Tu});
function Ki(a,b){a.Ji=!1;var c=a.Tu;c.O(b)||(b=b.ba(),a.Tu=b,a.Hj=null,Hi(a),a.Ga("DocumentBoundsChanged",null,c.copy()),Oi(a))}t.g(v,"scale",v.prototype.scale);
t.defineProperty(v,{scale:"scale"},function(){return this.fc},function(a){var b=this.fc;t.q(a,v,"scale");a<this.Jg&&(a=this.Jg);a>this.Hg&&(a=this.Hg);if(b!==a){this.fc=a;if(!this.cc&&!this.Jd&&(this.cc=!0,null!==this.Za)){var c=this.Ab.copy(),d=this.Jb/a,f=this.Ib/a;c.width=this.Jb/b;c.height=this.Ib/b;var g=this.eg.copy();if(isNaN(g.x))switch(this.Cw){case sc:g.x=0;break;case tc:g.x=d-1;break;case Yb:g.x=d/2;break;case Ub:case vc:g.x=d/2}if(isNaN(g.y))switch(this.Cw){case rc:g.y=0;break;case uc:g.y=
f-1;break;case Yb:g.y=f/2;break;case Ub:case vc:g.y=f/2}this.position=new E(this.Pa.x+g.x/b-g.x/a,this.Pa.y+g.y/b-g.y/a);this.cc=!1;this.Ut(c,this.Ab)}this.na();Oi(this)}});t.g(v,"autoScale",v.prototype.Tm);t.defineProperty(v,{Tm:"autoScale"},function(){return this.Sl},function(a){var b=this.Sl;b!==a&&(t.Fa(a,v,v,"autoScale"),this.Sl=a,this.j("autoScale",b,a),a!==ef&&Hi(this))});t.g(v,"initialAutoScale",v.prototype.pJ);
t.defineProperty(v,{pJ:"initialAutoScale"},function(){return this.Uk},function(a){var b=this.Uk;b!==a&&(t.Fa(a,v,v,"initialAutoScale"),this.Uk=a,this.j("initialAutoScale",b,a))});t.g(v,"initialViewportSpot",v.prototype.xF);t.defineProperty(v,{xF:"initialViewportSpot"},function(){return this.iv},function(a){var b=this.iv;b!==a&&(t.l(a,L,v,"initialViewportSpot"),a.Cd()||t.m("initialViewportSpot must be a real Spot: "+a),this.iv=a,this.j("initialViewportSpot",b,a))});t.g(v,"initialDocumentSpot",v.prototype.uF);
t.defineProperty(v,{uF:"initialDocumentSpot"},function(){return this.fv},function(a){var b=this.fv;b!==a&&(t.l(a,L,v,"initialDocumentSpot"),a.Cd()||t.m("initialViewportSpot must be a real Spot: "+a),this.fv=a,this.j("initialDocumentSpot",b,a))});t.g(v,"minScale",v.prototype.Jg);t.defineProperty(v,{Jg:"minScale"},function(){return this.wv},function(a){t.q(a,v,"minScale");var b=this.wv;b!==a&&(0<a?(this.wv=a,this.j("minScale",b,a),a>this.scale&&(this.scale=a)):t.ha(a,"> 0",v,"minScale"))});
t.g(v,"maxScale",v.prototype.Hg);t.defineProperty(v,{Hg:"maxScale"},function(){return this.tv},function(a){t.q(a,v,"maxScale");var b=this.tv;b!==a&&(0<a?(this.tv=a,this.j("maxScale",b,a),a<this.scale&&(this.scale=a)):t.ha(a,"> 0",v,"maxScale"))});t.g(v,"zoomPoint",v.prototype.eg);t.defineProperty(v,{eg:"zoomPoint"},function(){return this.mw},function(a){this.mw.O(a)||(t.l(a,E,v,"zoomPoint"),this.mw=a=a.ba())});t.g(v,"contentAlignment",v.prototype.Cw);
t.defineProperty(v,{Cw:"contentAlignment"},function(){return this.Rn},function(a){var b=this.Rn;b.O(a)||(t.l(a,L,v,"contentAlignment"),this.Rn=a=a.ba(),this.j("contentAlignment",b,a),Hi(this))});t.g(v,"initialContentAlignment",v.prototype.qJ);t.defineProperty(v,{qJ:"initialContentAlignment"},function(){return this.qo},function(a){var b=this.qo;b.O(a)||(t.l(a,L,v,"initialContentAlignment"),this.qo=a=a.ba(),this.j("initialContentAlignment",b,a))});t.g(v,"padding",v.prototype.padding);
t.defineProperty(v,{padding:"padding"},function(){return this.Te},function(a){"number"===typeof a?a=new wb(a):t.l(a,wb,v,"padding");var b=this.Te;b.O(a)||(this.Te=a=a.ba(),this.Sc(),this.j("padding",b,a))});t.A(v,{vh:"nodes"},function(){return this.Gv.k});t.A(v,{links:"links"},function(){return this.pv.k});t.A(v,{vj:"parts"},function(){return this.mb.k});v.prototype.findTopLevelGroups=function(){return this.gl.k};t.g(v,"layout",v.prototype.ic);
t.defineProperty(v,{ic:"layout"},function(){return this.Yd},function(a){var b=this.Yd;b!==a&&(t.l(a,Ae,v,"layout"),null!==b&&(b.h=null,b.group=null),this.Yd=a,a.h=this,a.group=null,this.Bu=!0,this.j("layout",b,a),this.ie())});v.prototype.layoutDiagram=function(a){Fi(this);a&&Lj(this,!0);Ri(this,!1)};function Lj(a,b){for(var c=a.gl.k;c.next();)Mj(a,c.value,b);null!==a.ic&&(b?a.ic.ff=!1:a.ic.M())}
function Mj(a,b,c){if(null!==b){for(var d=b.um.k;d.next();)Mj(a,d.value,c);null!==b.ic&&(c?b.ic.ff=!1:b.ic.M())}}function Ri(a,b){if(!a.Ty){var c=a.ic,d=a.lv;a.lv=!0;var f=a.Sa;a.Sa=!0;try{for(var g=a.gl.k;g.next();)Nj(a,g.value,b);c.ff||b&&!c.NA||(c.doLayout(a),Fi(a),c.ff=!0)}finally{a.Bu=!c.ff,a.lv=d,a.Sa=f}}}function Nj(a,b,c){if(null!==b){for(var d=b.um.k;d.next();)Nj(a,d.value,c);d=b.ic;null===d||d.ff||c&&!d.NA||(b.jD=!b.location.P(),d.doLayout(b),b.M(Oj),d.ff=!0,Ti(a,b))}}
t.g(v,"isTreePathToChildren",v.prototype.vd);t.defineProperty(v,{vd:"isTreePathToChildren"},function(){return this.kv},function(a){var b=this.kv;if(b!==a&&(t.i(a,"boolean",v,"isTreePathToChildren"),this.kv=a,this.j("isTreePathToChildren",b,a),!this.ma.yb))for(a=this.vh;a.next();)Pj(a.value)});v.prototype.findTreeRoots=function(){for(var a=new H(y),b=this.vh.k;b.next();){var c=b.value;c.Fp&&null===c.tt()&&a.add(c)}return a.k};t.g(v,"isCollapsingExpanding",v.prototype.ee);
t.defineProperty(v,{ee:null},function(){return this.LC},function(a){this.LC=a});
function ci(a){function b(a){var b=a.toLowerCase(),h=new H("function");c.add(a,h);c.add(b,h);d.add(a,a);d.add(b,a)}var c=new wa("string",H),d=new wa("string","string");b("AnimationStarting");b("AnimationFinished");b("BackgroundSingleClicked");b("BackgroundDoubleClicked");b("BackgroundContextClicked");b("ClipboardChanged");b("ClipboardPasted");b("DocumentBoundsChanged");b("ExternalObjectsDropped");b("InitialLayoutCompleted");b("LayoutCompleted");b("LinkDrawn");b("LinkRelinked");b("LinkReshaped");b("Modified");
b("ObjectSingleClicked");b("ObjectDoubleClicked");b("ObjectContextClicked");b("PartCreated");b("PartResized");b("PartRotated");b("SelectionMoved");b("SelectionCopied");b("SelectionDeleting");b("SelectionDeleted");b("SelectionGrouped");b("SelectionUngrouped");b("ChangingSelection");b("ChangedSelection");b("SubGraphCollapsed");b("SubGraphExpanded");b("TextEdited");b("TreeCollapsed");b("TreeExpanded");b("ViewportBoundsChanged");a.Vy=c;a.Uy=d}
function xa(a,b){var c=a.Uy.Da(b);return null!==c?c:a.Uy.Da(b.toLowerCase())}function Qj(a,b){var c=a.Vy.Da(b);if(null!==c)return c;c=a.Vy.Da(b.toLowerCase());if(null!==c)return c;t.m("Unknown DiagramEvent name: "+b);return null}v.prototype.addDiagramListener=v.prototype.Xz=function(a,b){t.i(a,"string",v,"addDiagramListener:name");t.i(b,"function",v,"addDiagramListener:listener");var c=Qj(this,a);null!==c&&c.add(b)};
v.prototype.removeDiagramListener=v.prototype.kG=function(a,b){t.i(a,"string",v,"removeDiagramListener:name");t.i(b,"function",v,"addDiagramListener:listener");var c=Qj(this,a);null!==c&&c.remove(b)};v.prototype.raiseDiagramEvent=v.prototype.Ga=function(a,b,c){e&&t.i(a,"string",v,"raiseDiagramEvent:name");var d=Qj(this,a),f=new Bd;f.h=this;f.name=xa(this,a);void 0!==b&&(f.Nx=b);void 0!==c&&(f.yx=c);a=d.length;if(1===a)d=d.wa(0),d(f);else if(0!==a)for(b=d.Pe(),c=0;c<a;c++)d=b[c],d(f);return f.cancel};
function fg(a,b){var c=!1;a.Ab.kk(b)&&(c=!0);c=a.tA(b,function(a){return a.U},function(a){return a instanceof B},!0,function(a){return a instanceof B},c);if(0!==c.count)for(c=c.k;c.next();){var d=c.value;d.qj&&d.hc()}}
function ia(a,b,c){null===a.$d&&(a.$d=new Rj);c=null!==c?c.fb:null;if(a.$d.Ap||a.$d.group!==c){if(null===c){b=a.Ji?Gi(a):a.Lc.copy();b.Wf(100,100);a.$d.initialize(b);b=t.Jf();for(var d=a.vh;d.next();){var f=d.value,g=f.layer;null!==g&&g.visible&&!g.Dc&&Sj(a,f,null,b)}}else for(c.pa.P()||c.xf(),b=c.pa.copy(),b.Wf(20,20),a.$d.initialize(b),b=t.Jf(),d=c.Vc;d.next();)f=d.value,f instanceof y&&Sj(a,f,null,b);t.oc(b);a.$d.group=c;a.$d.Ap=!1}else b&&Tj(a.$d);return a.$d}
function Sj(a,b,c,d){if(b!==c)if(b.Wa()&&b.canAvoid()){c=b.getAvoidableRect(d);d=a.$d.Vm;b=a.$d.Um;for(var f=c.x+c.width,g=c.y+c.height,h=c.x;h<f;h+=d){for(var k=c.y;k<g;k+=b)Uj(a.$d,h,k);Uj(a.$d,h,g)}for(k=c.y;k<g;k+=b)Uj(a.$d,f,k);Uj(a.$d,f,g)}else if(b instanceof z)for(b=b.Vc;b.next();)f=b.value,f instanceof y&&Sj(a,f,c,d)}function Vj(a,b){null===a.$d||a.$d.Ap||null!==b&&!b.canAvoid()||(a.$d.Ap=!0)}
v.prototype.simulatedMouseMove=v.prototype.zB=function(a,b,c){if(null!==wf){var d=wf.h;c instanceof v||(c=null);var f=xf;c!==f&&(null!==f&&f!==d&&null!==f.Cb.Od&&(Bf(f),wf.Dt=!1,f.Cb.Od.doSimulatedDragLeave()),xf=c,null!==c&&c!==d&&null!==c.Cb.Od&&(Hf(),f=c.Cb.Od,Ef.contains(f)||Ef.add(f),c.Cb.Od.doSimulatedDragEnter()));if(null===c||c===d||!c.Yz||c.hb||!c.Pm)return!1;d=c.Cb.Od;null!==d&&(null!==a?b=c.dm(a):null===b&&(b=new E),c.dc.da=b,c.dc.ok=!1,c.dc.zj=!1,d.doSimulatedDragOver());return!0}return!1};
v.prototype.simulatedMouseUp=v.prototype.JG=function(a,b,c,d){if(null!==wf){null===d&&(d=b);b=xf;var f=wf.h;if(d!==b){if(null!==b&&b!==f&&null!==b.Cb.Od)return Bf(b),wf.Dt=!1,b.Cb.Od.doSimulatedDragLeave(),!1;xf=d;null!==d&&null!==d.Cb.Od&&(Hf(),b=d.Cb.Od,Ef.contains(b)||Ef.add(b),d.Cb.Od.doSimulatedDragEnter())}if(null===d)return wf.doCancel(),!0;if(d!==this)return null!==a&&(c=d.dm(a)),d.dc.da=c,d.dc.ok=!1,d.dc.zj=!0,a=d.Cb.Od,null!==a&&a.doSimulatedDrop(),a=wf,null!==a&&(d=a.mayCopy(),a.mf=d?"Copy":
"Move",a.stopTool()),!0}return!1};t.g(v,"autoScrollRegion",v.prototype.nE);t.defineProperty(v,{nE:"autoScrollRegion"},function(){return this.Du},function(a){"number"===typeof a?a=new wb(a):t.l(a,wb,v,"autoScrollRegion");var b=this.Du;b.O(a)||(this.Du=a=a.ba(),this.Sc(),this.j("autoScrollRegion",b,a))});function bg(a,b){a.Cu.assign(b);Wj(a,a.Cu).yf(a.position)?Bf(a):Xj(a)}
function Xj(a){null===a.Tl&&(a.Tl={},a.Tl.id=setInterval(function(){if(null!==a.Tl){Bf(a);var b=Wj(a,a.Cu);b.yf(a.position)||(a.position=b,a.T.da=a.$G(a.Cu),a.zB(a.T.event,null,a.T.event.target.W)||a.doMouseMove(),a.Ji=!0,Ki(a,a.vf()),a.Be=!0,a.Ig(),Xj(a))}},a.yH))}function Bf(a){null!==a.Tl&&(clearInterval(a.Tl.id),a.Tl=null)}
function Wj(a,b){var c=a.position,d=a.nE;if(0>=d.top&&0>=d.left&&0>=d.right&&0>=d.bottom)return c;var f=a.Ab,g=a.scale,f=t.wk(0,0,f.width*g,f.height*g),h=t.qc(0,0);if(b.x>=f.x&&b.x<f.x+d.left){var k=Math.max(a.cq,1),k=k|0;h.x-=k;b.x<f.x+d.left/2&&(h.x-=k);b.x<f.x+d.left/4&&(h.x-=4*k)}else b.x<=f.x+f.width&&b.x>f.x+f.width-d.right&&(k=Math.max(a.cq,1),k|=0,h.x+=k,b.x>f.x+f.width-d.right/2&&(h.x+=k),b.x>f.x+f.width-d.right/4&&(h.x+=4*k));b.y>=f.y&&b.y<f.y+d.top?(k=Math.max(a.dq,1),k|=0,h.y-=k,b.y<f.y+
d.top/2&&(h.y-=k),b.y<f.y+d.top/4&&(h.y-=4*k)):b.y<=f.y+f.height&&b.y>f.y+f.height-d.bottom&&(k=Math.max(a.dq,1),k|=0,h.y+=k,b.y>f.y+f.height-d.bottom/2&&(h.y+=k),b.y>f.y+f.height-d.bottom/4&&(h.y+=4*k));h.yf(K.Aj)||(c=new E(c.x+h.x/g,c.y+h.y/g));t.oc(f);t.B(h);return c}v.prototype.makeSVG=v.prototype.makeSvg=function(a){void 0===a&&(a={});a.context="svg";a=Yj(this,a);return null!==a?a.Ll:null};
v.prototype.makeImage=function(a){void 0===a&&(a={});var b=(a.document||document).createElement("img");b.src=this.HJ(a);return b instanceof HTMLImageElement?b:null};v.prototype.makeImageData=v.prototype.HJ=function(a){void 0===a&&(a={});var b=Yj(this,a);return null!==b?b.toDataURL(a.type,a.details):""};
function Yj(a,b){a.Ig();if(null===a.Za)return null;"object"!==typeof b&&t.m("properties argument must be an Object.");var c=!1,d=b.size||null,f=b.scale||null;void 0!==b.scale&&isNaN(b.scale)&&(f="NaN");var g=b.maxSize;void 0===b.maxSize&&(c=!0,g="svg"===b.context?new ra(Infinity,Infinity):new ra(2E3,2E3));var h=b.position||null,k=b.parts||null,l=void 0===b.padding?1:b.padding,m=b.background||null,n=b.omitTemporary;void 0===n&&(n=!0);var p=b.document||document,q=b.elementFinished||null,r=b.showTemporary;
void 0===r&&(r=!n);n=b.showGrid;void 0===n&&(n=r);null!==d&&isNaN(d.width)&&isNaN(d.height)&&(d=null);l&&"number"===typeof l&&(l=new wb(l));l||(l=new wb(0));l.left=Math.max(l.left,0);l.right=Math.max(l.right,0);l.top=Math.max(l.top,0);l.bottom=Math.max(l.bottom,0);a.eo=!1;da(a);var s=p.createElement("canvas"),u=s.getContext("2d"),w=s;if(!(d||f||k||h))return s.width=a.Jb+Math.ceil(l.left+l.right),s.height=a.Ib+Math.ceil(l.top+l.bottom),"svg"===b.context&&(u=w=new Ac(s,p,q),u instanceof Ac&&(a.eo=!0)),
Zi(a,u,l,new ra(s.width,s.height),a.fc,a.Pa,k,m,r,n),a.eo=!0,w;var D=a.Ye.mt,A,G=new E(0,0);A=a.Lc.copy();A.tK(a.padding);null!==h&&h.P()?(G=h,f||(f=D)):(G.x=A.x,G.y=A.y);if(k){var M,h=!0,k=k.k;for(k.reset();k.next();){var N=k.value;if(N instanceof x){var O=N.layer;O&&!O.visible||O&&O.Dc||!N.Wa()||(N=N.pa,N.P()&&(h?(h=!1,M=N.copy()):M.yj(N)))}}h&&(M=new F(0,0,0,0));A.width=M.width;A.height=M.height;G.x=M.x;G.y=M.y}h=M=0;l&&(M=l.left+l.right,h=l.top+l.bottom);N=O=0;d&&(O=d.width,N=d.height,isFinite(O)&&
(O=Math.max(0,O-M)),isFinite(N)&&(N=Math.max(0,N-h)));d&&f?("NaN"===f&&(f=D),d.P()?(d=O,A=N):isNaN(N)?(d=O,A=A.height*f):(d=A.width*f,A=N)):d?d.P()?(f=Math.min(O/A.width,N/A.height),d=O,A=N):isNaN(N)?(f=O/A.width,d=O,A=A.height*f):(f=N/A.height,d=A.width*f,A=N):f?"NaN"===f&&g.P()?(f=Math.min((g.width-M)/A.width,(g.height-h)/A.height),f>D?(f=D,d=A.width,A=A.height):(d=g.width,A=g.height)):(d=A.width*f,A=A.height*f):(f=D,d=A.width,A=A.height);l?(d+=M,A+=h):l=new wb(0);g&&(D=g.width,g=g.height,"svg"!==
b.context&&c&&!t.hH&&(d>D||A>g)&&(t.trace("Diagram.makeImage(data): Diagram width or height is larger than the default max size. ("+Math.ceil(d)+"x"+Math.ceil(A)+" vs 2000x2000) Consider increasing the max size."),t.hH=!0),isNaN(D)&&(D=2E3),isNaN(g)&&(g=2E3),isFinite(D)&&(d=Math.min(d,D)),isFinite(g)&&(A=Math.min(A,g)));s.width=Math.ceil(d);s.height=Math.ceil(A);"svg"===b.context&&(u=w=new Ac(s,p,q),u instanceof Ac&&(a.eo=!0));Zi(a,u,l,new ra(Math.ceil(d),Math.ceil(A)),f,G,k,m,r,n);a.eo=!0;return w}
v.inherit=function(a,b){t.i(a,"function",v,"inherit");t.i(b,"function",v,"inherit");b.KH&&t.m("Cannot inherit from "+t.Dg(b));t.Qa(a,b)};function Zj(a){1<arguments.length&&t.m("Palette constructor can only take one optional argument, the DIV HTML element or its id.");v.call(this,a);this.at=!0;this.fk=!1;this.hb=!0;this.Cw=Wb;this.ic=new ak}t.ka("Palette",Zj);t.Qa(Zj,v);
function bj(a){1<arguments.length&&t.m("Overview constructor can only take one optional argument, the DIV HTML element or its id.");v.call(this,a);this.yi.isEnabled=!1;this.cc=!0;this.Si=null;this.EH=this.Vu=!0;this.lK("drawShadows",!1);var b=new x,c=new W;c.stroke="magenta";c.lb=2;c.fill="transparent";c.name="BOXSHAPE";b.du="BOXSHAPE";b.Jt="BOXSHAPE";b.cursor="move";b.add(c);this.Vl=b;this.Lz=document.createElement("canvas");this.MH=this.Lz.getContext("2d");b=new bk;b.Ed(this);this.Cb.jf.Pd(0,b);
var d=this;this.fG=function(){ck(d)};this.eG=function(){null!==d.Si&&(d.Sc(),d.na())};this.hb=!0;this.Ve=!1;this.Tm=Li;this.Cb.un=jf;this.cc=!1}t.ka("Overview",bj);t.Qa(bj,v);
function cj(a){a.cc||a.Jd||!1!==a.Sf||(a.Sf=!0,requestAnimationFrame(function(){if(a.Sf&&!a.Jd&&(a.Sf=!1,null!==a.Rb)){a.Jd=!0;Fi(a);a.Lc.P()||Ki(a,a.vf());null===a.Rb&&t.m("No div specified");null===a.Za&&t.m("No canvas specified");if(a.Be){var b=a.Si;if(null!==b&&!b.mc.Eg&&!b.mc.zd){var b=a.of,c=a.Lz;b.setTransform(1,0,0,1,0,0);b.clearRect(0,0,a.Za.width,a.Za.height);b.drawImage(c,0,0);c=a.Oc;c.reset();1!==a.fc&&c.scale(a.scale);0===a.position.x&&0===a.position.y||c.translate(-a.Pa.x,-a.Pa.y);b.setTransform(c.m11,
c.m12,c.m21,c.m22,c.dx,c.dy);for(var c=a.Wb.length,d=0;d<c;d++)a.Wb.n[d].$e(b,a);a.Vk=!1;a.Be=!1}}a.Jd=!1}}))}bj.prototype.computePixelRatio=function(){return 1};
bj.prototype.$e=function(){null===this.Rb&&t.m("No div specified");null===this.Za&&t.m("No canvas specified");if(this.Be){var a=this.Si;if(!(null===a||a.mc.Eg||a.mc.zd||!this.EH&&a.Cb.Od.la)){var b=a.xp;(b&&b.visible&&isNaN(b.width)||isNaN(b.height))&&Pi(a);var c=this.Za,b=this.of,d=this.Lz,f=this.MH;d.width=c.width;d.height=c.height;b.su="";b.setTransform(1,0,0,1,0,0);b.clearRect(0,0,this.Za.width,this.Za.height);var g=this.Oc;g.reset();1!==this.fc&&g.scale(this.scale);0===this.position.x&&0===this.position.y||
g.translate(-this.Pa.x,-this.Pa.y);b.setTransform(g.m11,g.m12,g.m21,g.m22,g.dx,g.dy);for(var h=this.Vu,k=this.Ab,l=a.Wb.length,m=0;m<l;m++){var n=a.Wb.n[m],p=b,q=k,r=h;void 0===r&&(r=!0);if(r||!n.Dc)for(var n=n.mb,r=this.scale,s=n.length,u=0;u<s;u++){var w=n.n[u],D=w.pa;D.Xf(q)&&(1<D.width*r||1<D.height*r?w.$e(p,this):Zh(w,p))}}f.drawImage(c,0,0);e&&e.gj&&(f.fillStyle="red",f.fillRect(0,d.height/2,d.width,4));a=this.Wb.n;c=this.Wb.length;for(m=0;m<c;m++)a[m].$e(b,this);e&&(e.rA||e.gj)&&e.qA(b,this,
g);this.Be=this.Vk=!1}}};t.g(bj,"observed",bj.prototype.RJ);
t.defineProperty(bj,{RJ:"observed"},function(){return this.Si},function(a){var b=this.Si;null!==a&&t.l(a,v,bj,"observed");b===a||a instanceof bj||(null!==b&&(this.remove(this.Bg),b.kG("ViewportBoundsChanged",this.fG),b.kG("DocumentBoundsChanged",this.eG),b.xm.remove(this)),this.Si=a,null!==a&&(a.Xz("ViewportBoundsChanged",this.fG),a.Xz("DocumentBoundsChanged",this.eG),a.xm.add(this),this.add(this.Bg),ck(this)),this.Sc(),this.j("observed",b,a))});t.g(bj,"box",bj.prototype.Bg);
t.defineProperty(bj,{Bg:"box"},function(){return this.Vl},function(a){var b=this.Vl;b!==a&&(this.Vl=a,this.remove(b),this.add(this.Vl),ck(this),this.j("box",b,a))});t.g(bj,"drawsTemporaryLayers",bj.prototype.ZI);t.defineProperty(bj,{ZI:"drawsTemporaryLayers"},function(){return this.Vu},function(a){this.Vu!==a&&(this.Vu=a,this.Yt())});
function ck(a){var b=a.Bg;if(null!==b){var c=a.Si;if(null!==c){a.Be=!0;var c=c.Ab,d=b.An,f=t.Ml();f.p(c.width,c.height);d.Ea=f;t.qk(f);a=2/a.scale;d instanceof W&&(d.lb=a);b.location=new E(c.x-a/2,c.y-a/2)}}}bj.prototype.vf=function(){var a=this.Si;return null===a?K.xH:a.Lc};bj.prototype.Ut=function(a){this.cc||(Di(this),this.na(),Oi(this),this.Sc(),ck(this),this.Ga("ViewportBoundsChanged",a))};function bk(){ze.call(this);this.name="MoveBox"}t.Qa(bk,ze);
bk.prototype.doStart=function(){this.la=this.h.Qd=!0};bk.prototype.doMouseMove=function(){if(this.la){var a=this.h;if(null!==a&&null!==a.Si){var b=a.Si;if(null!==b){var c=b.Ab,d=a.T.da;b.position=new E(d.x-c.width/2,d.y-c.height/2);a.ie()}}}};bk.prototype.doMouseUp=function(){this.la&&this.doMouseMove();this.stopTool()};bk.prototype.doStop=function(){this.la=!1;var a=this.h;null!==a&&(a.Qd=!1,ck(a))};
function qa(a){1<arguments.length&&t.m("Brush constructor can take at most one optional argument, the Brush type.");t.Fc(this);this.tb=!1;void 0===a?(this.ga=pe,this.Qn="black"):"string"===typeof a?(this.ga=pe,e&&t.fp("Brush constructor",a),this.Qn=a):(e&&t.Fa(a,qa,qa,"constructor:type"),this.ga=a,this.Qn="black");var b=this.ga;b===qe?(this.Po=Wb,this.ho=ac):this.ho=b===re?this.Po=Yb:this.Po=Tb;this.aw=0;this.Wu=NaN;this.Zg=this.Nv=this.Yg=null;this.Fy=this.Gy=0}t.ka("Brush",qa);var pe;
qa.Solid=pe=t.w(qa,"Solid",0);var qe;qa.Linear=qe=t.w(qa,"Linear",1);var re;qa.Radial=re=t.w(qa,"Radial",2);var dk;qa.Pattern=dk=t.w(qa,"Pattern",4);var pa;qa.isValidColor=pa=function(a){if("black"===a)return!0;if(""===a)return!1;e&&t.i(a,"string",qa,"isValidColor");var b=t.Dn;b.fillStyle="#000000";var c=b.fillStyle;b.fillStyle=a;if(b.fillStyle!==c)return!0;b.fillStyle="#FFFFFF";c=b.fillStyle;b.fillStyle=a;return b.fillStyle!==c};
qa.prototype.copy=function(){var a=new qa;a.ga=this.ga;a.Qn=this.Qn;a.Po=this.Po.ba();a.ho=this.ho.ba();a.aw=this.aw;a.Wu=this.Wu;null!==this.Yg&&(a.Yg=this.Yg.copy());a.Nv=this.Nv;return a};qa.prototype.Oa=function(){this.freeze();Object.freeze(this);return this};qa.prototype.freeze=function(){this.tb=!0;null!==this.Yg&&this.Yg.freeze();return this};qa.prototype.Ra=function(){Object.isFrozen(this)&&t.m("cannot thaw constant: "+this);this.tb=!1;null!==this.Yg&&this.Yg.Ra();return this};
qa.prototype.toString=function(){var a="Brush(";if(this.type===pe)a+=this.color;else if(a=this.type===qe?a+"Linear ":this.type===re?a+"Radial ":this.type===dk?a+"Pattern ":a+"(unknown) ",a+=this.start+" "+this.end,null!==this.hp)for(var b=this.hp.k;b.next();)a+=" "+b.key+":"+b.value;return a+")"};
qa.prototype.addColorStop=qa.prototype.addColorStop=function(a,b){t.J(this);("number"!==typeof a||!isFinite(a)||1<a||0>a)&&t.ha(a,"0 <= loc <= 1",qa,"addColorStop:loc");t.i(b,"string",qa,"addColorStop:color");null===this.Yg&&(this.Yg=new wa("number","string"));this.Yg.add(a,b);this.ga===pe&&(this.type=qe);this.Zg=null};t.g(qa,"type",qa.prototype.type);
t.defineProperty(qa,{type:"type"},function(){return this.ga},function(a){t.J(this,a);t.Fa(a,qa,qa,"type");this.ga=a;this.start.Me()&&(a===qe?this.start=Wb:a===re&&(this.start=Yb));this.end.Me()&&(a===qe?this.end=ac:a===re&&(this.end=Yb));this.Zg=null});t.g(qa,"color",qa.prototype.color);t.defineProperty(qa,{color:"color"},function(){return this.Qn},function(a){t.J(this,a);t.i(a,"string",qa,"color");this.Qn=a;this.Zg=null});t.g(qa,"start",qa.prototype.start);
t.defineProperty(qa,{start:"start"},function(){return this.Po},function(a){t.J(this,a);a instanceof L||t.jc(a,"Spot",qa,"start");this.Po=a.ba();this.Zg=null});t.g(qa,"end",qa.prototype.end);t.defineProperty(qa,{end:"end"},function(){return this.ho},function(a){t.J(this,a);a instanceof L||t.jc(a,"Spot",qa,"end");this.ho=a.ba();this.Zg=null});t.g(qa,"startRadius",qa.prototype.hq);
t.defineProperty(qa,{hq:"startRadius"},function(){return this.aw},function(a){t.J(this,a);t.q(a,qa,"startRadius");0>a&&t.ha(a,">= zero",qa,"startRadius");this.aw=a;this.Zg=null});t.g(qa,"endRadius",qa.prototype.mp);t.defineProperty(qa,{mp:"endRadius"},function(){return this.Wu},function(a){t.J(this,a);t.q(a,qa,"endRadius");0>a&&t.ha(a,">= zero",qa,"endRadius");this.Wu=a;this.Zg=null});t.g(qa,"colorStops",qa.prototype.hp);
t.defineProperty(qa,{hp:"colorStops"},function(){return this.Yg},function(a){t.J(this,a);e&&t.l(a,wa,qa,"colorStops");this.Yg=a;this.Zg=null});t.g(qa,"pattern",qa.prototype.pattern);t.defineProperty(qa,{pattern:"pattern"},function(){return this.Nv},function(a){t.J(this,a);this.Nv=a;this.Zg=null});
qa.randomColor=function(a,b){void 0===a&&(a=128);e&&(t.q(a,qa,"randomColor:min"),(0>a||255<a)&&t.ha(a,"0 <= min <= 255",qa,"randomColor:min"));void 0===b&&(b=Math.max(a,255));e&&(t.q(b,qa,"randomColor:max"),(b<a||255<b)&&t.ha(b,"min <= max <= 255",qa,"randomColor:max"));var c=Math.abs(b-a),d=Math.floor(a+Math.random()*c).toString(16),f=Math.floor(a+Math.random()*c).toString(16),c=Math.floor(a+Math.random()*c).toString(16);2>d.length&&(d="0"+d);2>f.length&&(f="0"+f);2>c.length&&(c="0"+c);return"#"+
d+f+c};
function V(){t.Fc(this);this.oa=30723;this.Qf=1;this.Ui=null;this.ec="";this.zc=this.Qb=null;this.Pa=(new E(NaN,NaN)).freeze();this.pf=(new ra(NaN,NaN)).freeze();this.Tj=K.uq;this.Sj=K.wH;this.Oc=new ta;this.Ch=new ta;this.Zk=new ta;this.fc=1;this.Nn=0;this.$h=ch;this.Gr=K.tq;this.$c=(new F(NaN,NaN,NaN,NaN)).freeze();this.Pb=(new F(NaN,NaN,NaN,NaN)).freeze();this.nd=(new F(0,0,NaN,NaN)).freeze();this.Ns=this.ar=this.R=this.bs=this.cs=null;this.Os=this.br=Infinity;this.Aq=this.Ae=Ub;this.os=0;this.Yj=
1;this.Hq=0;this.Fj=1;this.ss=-Infinity;this.rs=0;this.ts=K.Aj;this.us=Og;this.Oq="";this.zm=this.Bi=this.Xl=this.Nc=this.S=null}t.ka("GraphObject",V);t.ii(V);
V.prototype.cloneProtected=function(a){a.oa=this.oa|6144;a.Qf=this.Qf;a.ec=this.ec;a.Qb=this.Qb;a.zc=this.zc;a.Pa.assign(this.Pa);a.pf.assign(this.pf);a.Tj=this.Tj.ba();a.Sj=this.Sj.ba();a.Zk=this.Zk.copy();a.fc=this.fc;a.Nn=this.Nn;a.$h=this.$h;a.Gr=this.Gr.ba();a.$c.assign(this.$c);a.Pb.assign(this.Pb);a.nd.assign(this.nd);a.bs=this.bs;if(null!==this.R){var b=this.R;a.R={Ph:b.Ph.ba(),ei:b.ei.ba(),Mh:b.Mh,bi:b.bi,Lh:b.Lh,ai:b.ai,Oh:b.Oh,di:b.di}}else a.R=null;a.ar=this.ar;a.br=this.br;a.Ns=this.Ns;
a.Os=this.Os;a.Ae=this.Ae.ba();a.Aq=this.Aq.ba();a.os=this.os;a.Yj=this.Yj;a.Hq=this.Hq;a.Fj=this.Fj;a.ss=this.ss;a.rs=this.rs;a.ts=this.ts.ba();a.us=this.us;a.Oq=this.Oq;null!==this.S?(b=this.S,a.S={Ai:b.Ai,Gi:b.Gi,Ci:b.Ci,Sr:b.Sr,Tr:b.Tr,Qi:b.Qi,Pi:b.Pi,Oi:b.Oi,Qr:b.Qr,Rr:b.Rr,Ni:b.Ni,wq:b.wq,xq:b.xq,yq:b.yq,vq:b.vq,$i:b.$i,Di:b.Di}):a.S=null;a.Nc=this.Nc;if(Array.isArray(this.Xl))for(a.Xl=this.Xl.slice(0),b=0;b<this.Xl.length;b++){var c=this.Xl[b];a[c]=this[c]}null!==this.Bi&&(a.Bi=this.Bi.copy())};
V.prototype.ji=function(a){a.cs=null;a.zm=null;a.ja()};V.prototype.copy=function(){var a=new this.constructor;this.cloneProtected(a);return a};V.prototype.toString=function(){return t.Dg(Object.getPrototypeOf(this))+"#"+t.ud(this)};var bh;V.None=bh=t.w(V,"None",0);var ch;V.Default=ch=t.w(V,"Default",0);var ek;V.Vertical=ek=t.w(V,"Vertical",4);var fk;V.Horizontal=fk=t.w(V,"Horizontal",5);var Sc;V.Fill=Sc=t.w(V,"Fill",3);var dh;V.Uniform=dh=t.w(V,"Uniform",1);var eh;
V.UniformToFill=eh=t.w(V,"UniformToFill",2);function gk(a){a.S={Ai:null,Gi:null,Ci:null,Sr:null,Tr:null,Qi:null,Pi:null,Oi:null,Qr:null,Rr:null,Ni:null,wq:null,xq:null,yq:null,vq:null,$i:null,Di:null}}aa=V.prototype;aa.Le=function(){this.R={Ph:Tb,ei:Tb,Mh:10,bi:10,Lh:hk,ai:hk,Oh:0,di:0}};
function ik(a,b,c,d,f,g,h){var k=0.001,l=g.length;a.moveTo(b,c);d-=b;k=f-c;0===d&&(d=0.001);f=k/d;for(var m=Math.sqrt(d*d+k*k),n=0,p=!0,q=0===h?!1:!0;0.1<=m;){if(q){k=g[n++%l];for(k-=h;0>k;)k+=g[n++%l],p=!p;q=!1}else k=g[n++%l];k>m&&(k=m);var r=Math.sqrt(k*k/(1+f*f));0>d&&(r=-r);b+=r;c+=f*r;p?a.lineTo(b,c):a.moveTo(b,c);m-=k;p=!p}}aa.ed=function(a,b,c,d,f,g,h){var k=this.U;null!==k&&(k.yn(a,b,c,d,f,g,h),0!==(this.oa&1024)&&c===this&&a===Ld&&jk(this,k,b))};
function jk(a,b,c){var d=a.qp();if(null!==d)for(var f=a.Nc.k;f.next();){var g=f.value,h=g.iu;if(null!==h){var k=d.ue(h);if(null===k)continue;g.MB(a,k,c,null)}else{k=d.data;if(null===k)continue;var l=b.h;null!==l&&l.hu||g.MB(a,k,c,l)}null!==h&&(k=d,""!==h&&(k=d.ue(h)),null!==k&&(h=g.Fn,l=d,""!==h&&(l=d.ue(h)),null!==l&&g.eH(l,k,c)))}}aa.j=function(a,b,c){this.ed(Ld,a,this,b,c)};
function kk(a,b,c,d,f){var g=a.$c,h=a.Zk;h.reset();lk(a,h,b,c,d,f);a.Zk=h;g.x=b;g.y=c;g.width=d;g.height=f;h.Et()||h.ZG(g)}function mk(a,b,c,d){if(!1===a.kf)return!1;d.multiply(a.transform);return c?a.Xf(b,d):a.Ym(b,d)}
aa.bF=function(a,b,c){if(!1===this.kf)return!1;var d=this.Ja;b=a.nk(b);var f=!1;c&&(f=nb(a.x,a.y,0,0,0,d.height)<b||nb(a.x,a.y,0,d.height,d.width,d.height)<b||nb(a.x,a.y,d.width,d.height,d.width,0)<b||nb(a.x,a.y,d.width,0,0,0)<b);c||(f=nb(a.x,a.y,0,0,0,d.height)<b&&nb(a.x,a.y,0,d.height,d.width,d.height)<b&&nb(a.x,a.y,d.width,d.height,d.width,0)<b&&nb(a.x,a.y,d.width,0,0,0)<b);return f};aa.Kf=function(){return!0};
V.prototype.containsPoint=V.prototype.La=function(a){e&&t.l(a,E,V,"containsPoint:p");var b=t.N();b.assign(a);this.transform.Xa(b);var c=this.pa;if(!c.P())return!1;if(t.CB){var d=this.Ja,f=this.sk()*(null!==this.h?this.h.scale:1),g=1/f;if(10>d.width*f&&10>d.height*f)return a=Gb(c.x-5*g,c.y-5*g,c.width+10*g,c.height+10*g,b.x,b.y),t.B(b),a}if(void 0!==this.uc||this instanceof W?Gb(c.x-5,c.y-5,c.width+10,c.height+10,b.x,b.y):c.La(b)){if(this.Bi&&!this.Bi.La(b))return!1;if(null!==this.zc&&c.La(b)||null!==
this.Qb&&this.nd.La(a))return!0;t.B(b);return this.jk(a)}t.B(b);return!1};V.prototype.jk=function(a){var b=this.Ja;return Gb(0,0,b.width,b.height,a.x,a.y)};
V.prototype.containsRect=V.prototype.kk=function(a){e&&t.l(a,F,V,"containsRect:r");if(0===this.angle)return this.pa.kk(a);var b=this.Ja,b=t.wk(0,0,b.width,b.height),c=this.transform,d=!1,f=t.qc(a.x,a.y);b.La(c.mi(f))&&(f.p(a.x,a.bottom),b.La(c.mi(f))&&(f.p(a.right,a.bottom),b.La(c.mi(f))&&(f.p(a.right,a.y),b.La(c.mi(f))&&(d=!0))));t.B(f);t.oc(b);return d};
V.prototype.containedInRect=V.prototype.Ym=function(a,b){e&&t.l(a,F,V,"containedInRect:r");if(void 0===b)return a.kk(this.pa);var c=this.Ja,d=!1,f=t.qc(0,0);a.La(b.Xa(f))&&(f.p(0,c.height),a.La(b.Xa(f))&&(f.p(c.width,c.height),a.La(b.Xa(f))&&(f.p(c.width,0),a.La(b.Xa(f))&&(d=!0))));return d};
V.prototype.intersectsRect=V.prototype.Xf=function(a,b){e&&t.l(a,F,V,"intersectsRect:r");if(void 0===b&&(b=this.transform,0===this.angle))return a.Xf(this.pa);var c=this.Ja,d=b,f=t.qc(0,0),g=t.qc(0,c.height),h=t.qc(c.width,c.height),k=t.qc(c.width,0),l=!1;if(a.La(d.Xa(f))||a.La(d.Xa(g))||a.La(d.Xa(h))||a.La(d.Xa(k)))l=!0;else{var c=t.wk(0,0,c.width,c.height),m=t.qc(a.x,a.y);c.La(d.mi(m))?l=!0:(m.p(a.x,a.bottom),c.La(d.mi(m))?l=!0:(m.p(a.right,a.bottom),c.La(d.mi(m))?l=!0:(m.p(a.right,a.y),c.La(d.mi(m))&&
(l=!0))));t.B(m);t.oc(c);!l&&(K.bx(a,f,g)||K.bx(a,g,h)||K.bx(a,h,k)||K.bx(a,k,f))&&(l=!0)}t.B(f);t.B(g);t.B(h);t.B(k);return l};V.prototype.getDocumentPoint=V.prototype.wb=function(a,b){void 0===b&&(b=new E);a.Me()&&t.m("getDocumentPoint:s Spot must be real: "+a.toString());var c=this.Ja;b.p(a.x*c.width+a.offsetX,a.y*c.height+a.offsetY);this.se.Xa(b);return b};V.prototype.getDocumentAngle=V.prototype.ul=function(){var a=this.se,a=180/Math.PI*Math.atan2(a.m12,a.m11);0>a&&(a+=360);return a};
V.prototype.getDocumentScale=V.prototype.sk=function(){var a=this.fc;return null!==this.ia?a*this.ia.sk():a};V.prototype.getLocalPoint=V.prototype.jF=function(a,b){void 0===b&&(b=new E);b.assign(a);this.se.mi(b);return b};V.prototype.getNearestIntersectionPoint=V.prototype.yl=function(a,b,c){return this.wp(a.x,a.y,b.x,b.y,c)};aa=V.prototype;
aa.wp=function(a,b,c,d,f){var g=this.transform,h=1/(g.m11*g.m22-g.m12*g.m21),k=g.m22*h,l=-g.m12*h,m=-g.m21*h,n=g.m11*h,p=h*(g.m21*g.dy-g.m22*g.dx),q=h*(g.m12*g.dx-g.m11*g.dy);if(null!==this.hk)return g=this.pa,K.yl(g.left,g.top,g.right,g.bottom,a,b,c,d,f);h=a*k+b*m+p;a=a*l+b*n+q;b=c*k+d*m+p;c=c*l+d*n+q;f.p(0,0);d=this.Ja;c=K.yl(0,0,d.width,d.height,h,a,b,c,f);f.transform(g);return c};
function xh(a,b,c,d,f){if(!1!==Ui(a)){var g=a.margin,h=g.top+g.bottom;b=Math.max(b-(g.right+g.left),0);c=Math.max(c-h,0);g=a.angle;if(90===g||270===g)g=b,b=c,c=g,g=d,d=f,f=g;g=a.Ea;h=0;a.lb&&(h=a.lb);b=isFinite(g.width)?g.width+h:b;c=isFinite(g.height)?g.height+h:c;var g=d||0,h=f||0,k=a instanceof C;switch(nk(a)){case bh:h=g=0;k&&(c=b=Infinity);break;case Sc:isFinite(b)&&b>d&&(g=b);isFinite(c)&&c>f&&(h=c);break;case fk:isFinite(b)&&b>d&&(g=b);h=0;k&&(c=Infinity);break;case ek:isFinite(c)&&c>f&&(h=
c),g=0,k&&(b=Infinity)}var k=a.Oe,l=a.Yf;g>k.width&&l.width<k.width&&(g=k.width);h>k.height&&l.height<k.height&&(h=k.height);d=Math.max(g/a.scale,l.width);f=Math.max(h/a.scale,l.height);k.width<d&&(d=Math.min(l.width,d));k.height<f&&(f=Math.min(l.height,f));b=Math.min(k.width,b);c=Math.min(k.height,c);b=Math.max(d,b);c=Math.max(f,c);a.$c.Ra();a.Kt(b,c,d,f);a.$c.freeze();a.$c.P()||t.m("Non-real measuredBounds has been set. Object "+a+", measuredBounds: "+a.$c.toString());ok(a,!1)}}
aa.Pc=function(a,b,c,d,f){pk(this);var g=t.Jf();g.assign(this.Pb);this.Pb.Ra();if(!1===Vi(this)){var h=this.Pb;h.x=a;h.y=b;h.width=c;h.height=d}else this.ik(a,b,c,d);this.Pb.freeze();this.Bi=void 0===f?null:f;c=!1;void 0!==f?c=!0:this.ia&&(f=this.ia.nd,d=this.Ha,null!==this.hk&&(d=this.Pb),c=b+d.height,d=a+d.width,c=!(0<=a+0.05&&d<=f.width+0.05&&0<=b+0.05&&c<=f.height+0.05),this instanceof za&&(a=this.nd,this.sv>a.height||this.Eo.Gg>a.width))&&(c=!0);this.oa=c?this.oa|256:this.oa&-257;this.Pb.P()||
t.m("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.Pb.toString());qk(this,g,this.Pb);t.oc(g)};aa.ik=function(){};
function rk(a,b,c,d,f){var g=a.pa;g.x=b;g.y=c;g.width=d;g.height=f;if(!a.Ea.P()){g=a.$c;c=a.margin;b=c.right+c.left;var h=c.top+c.bottom;c=g.width+b;g=g.height+h;d+=b;f+=h;b=nk(a);c===d&&g===f&&(b=bh);switch(b){case bh:if(c>d||g>f)ok(a,!0),xh(a,c>d?d:c,g>f?f:g);break;case Sc:ok(a,!0);xh(a,d,f,0,0);break;case fk:ok(a,!0);xh(a,d,g,0,0);break;case ek:ok(a,!0),xh(a,c,f,0,0)}}}
function qk(a,b,c){sk(a,!1);var d=a.U;if(null!==d){var f=d.h;if(null!==f)if(tk(d),a instanceof x){var g=!1,d=b.P();if(!1===f.Ji){var h=f.Lc,k=f.padding,l=h.x+k.left,m=h.y+k.top,n=h.width-2*k.right,h=h.height-2*k.bottom;d&&b.x>l&&b.y>m&&b.right<n&&b.bottom<h&&c.x>l&&c.y>m&&c.right<n&&c.bottom<h&&(g=!0)}0!==(a.Z&65536)!==!0&&b.O(c)||gj(a,g,f);f.Cz&&null!==f.Hj?(g=null,d&&(g=t.Jf(),ai(a,b,g)),f.na(c.P()?ai(a,c):null,g),null!==g&&t.oc(g)):f.na()}else uk(a,d),a.na(),b=a.U,null!==b&&(b.An!==a&&b.pG!==a&&
b.tG!==a||vk(b,!0))}}function uk(a,b){null!==a.Ud&&vk(b,!0);if(a instanceof C)for(var c=a.va,d=c.length,f=0;f<d;f++)uk(c.n[f],b)}
aa.$e=function(a,b){if(this.visible){var c=this.opacity,d=1;if(1!==c){if(0===c)return;d=a.globalAlpha;a.globalAlpha=d*c}if(a instanceof Ac)a:{if(this.visible){var f=null,g=a.mx;if(this instanceof C&&(this.type===wk||this.type===xk))yk(this,a,b);else{var h=this.Pb;if(0!==h.width&&0!==h.height&&!isNaN(h.x)&&!isNaN(h.y)){var k=this.transform,l=this.ia,m=this.Ch;m.reset();null!==l&&(l.Kf()?m.multiply(l.se):null!==l.ia&&m.multiply(l.ia.se));m.multiply(this.Oc);var m=0!==(this.oa&256),n=!1;this instanceof
za&&zk(this,a);if(m){n=l.Kf()?l.Ja:l.pa;if(this.Bi)var p=this.Bi,q=p.x,r=p.y,s=p.width,p=p.height;else q=Math.max(h.x,n.x),r=Math.max(h.y,n.y),s=Math.min(h.right,n.right)-q,p=Math.min(h.bottom,n.bottom)-r;if(q>h.width+h.x||h.x>n.width+n.x||r>h.height+h.y||h.y>n.height+n.y)break a;n=!0;Cc(a,1,0,0,1,0,0);a.save();a.beginPath();a.rect(q,r,s,p);a.clip()}q=!1;if(this instanceof x&&(q=!0,!this.Wa()))break a;r=!1;s=b.el;this.U&&s.drawShadows&&(r=this.U.qi);a.lj.hf=[1,0,0,1,0,0];null!==this.zc&&(Ak(this,
a,this.zc,!0,!0),this.zc instanceof qa&&this.zc.type===re?(a.beginPath(),a.rect(h.x,h.y,h.width,h.height),Bk(a,this.zc,!0)):a.fillRect(h.x,h.y,h.width,h.height));q&&this.qi&&s.drawShadows&&(Cc(a,1,0,0,1,0,0),h=this.Im,a.shadowOffsetX=h.x,a.shadowOffsetY=h.y,a.shadowColor=this.Hm,a.shadowBlur=this.Gm/b.scale,a.jb());this instanceof C?Cc(a,k.m11,k.m12,k.m21,k.m22,k.dx,k.dy):a.lj.hf=[k.m11,k.m12,k.m21,k.m22,k.dx,k.dy];if(null!==this.Qb){var p=this.Ja,h=k=0,s=p.width,p=p.height,u=0;this instanceof W&&
(p=this.Ta.Tb,k=p.x,h=p.y,s=p.width,p=p.height,u=this.qe);Ak(this,a,this.Qb,!0);this.Qb instanceof qa&&this.Qb.type===re?(a.beginPath(),a.rect(k-u/2,h-u/2,s+u,p+u),Bk(a,this.Qb,!0)):a.fillRect(k-u/2,h-u/2,s+u,p+u)}if(r&&(null!==this.Qb||null!==this.zc||null!==l&&0!==(l.oa&512)||null!==l&&l.type===ti&&l.Rw()!==this)){Ck(this,!0);var w=[a.shadowOffsetX,a.shadowOffsetY,a.shadowBlur];a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0}else Ck(this,!1);this.rl(a,b);r&&0!==(this.oa&512)===!0&&(a.shadowOffsetX=
w[0],a.shadowOffsetY=w[1],a.shadowBlur=w[2]);q&&r&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0);m?(a.restore(),n&&a.Bf.pop(),da(b,a)):this instanceof C&&(f=a.Bf.pop());q&&r&&a.Bf.pop();null!==a.YE&&(null===f&&(g===a.mx?(Cc(a,1,0,0,1,0,0),w=a.Bf.pop()):w=a.mx,f=w),a.YE(this,f))}}}}else if(this instanceof C&&(this.type===wk||this.type===xk))yk(this,a,b);else if(m=this.Pb,0!==m.width&&0!==m.height&&!isNaN(m.x)&&!isNaN(m.y)){e&&e.gj&&e.SI(a,this);w=this.transform;g=this.ia;l=this.Ch;l.reset();
null!==g&&(g.Kf()?l.multiply(g.se):null!==g.ia&&l.multiply(g.ia.se));l.multiply(this.Oc);l=0!==(this.oa&256);this instanceof za&&zk(this,a);if(l){e&&e.XE&&t.trace("clip"+this.toString());n=g.Kf()?g.Ja:g.pa;this.Bi?(r=this.Bi,k=r.x,h=r.y,q=r.width,r=r.height):(k=Math.max(m.x,n.x),h=Math.max(m.y,n.y),q=Math.min(m.right,n.right)-k,r=Math.min(m.bottom,n.bottom)-h);if(k>m.width+m.x||m.x>n.width+n.x||h>m.height+m.y||m.y>n.height+n.y){1!==c&&(a.globalAlpha=d);return}e&&e.XE&&e.UI(a,k,h,q,r);a.save();a.beginPath();
a.rect(k,h,q,r);a.clip()}h=b.el;n=!1;if(this instanceof x){n=!0;if(!this.Wa()){1!==c&&(a.globalAlpha=d);return}this.qi&&h.drawShadows&&(k=this.Im,a.shadowOffsetX=k.x*b.scale,a.shadowOffsetY=k.y*b.scale,a.shadowColor=this.Hm,a.shadowBlur=this.Gm)}k=!1;this.U&&h.drawShadows&&(k=this.U.qi);null!==this.zc&&(Ak(this,a,this.zc,!0,!0),this.zc instanceof qa&&this.zc.type===re?(a.beginPath(),a.rect(m.x,m.y,m.width,m.height),Bk(a,this.zc,!0)):a.fillRect(m.x,m.y,m.width,m.height));w.Et()||a.transform(w.m11,
w.m12,w.m21,w.m22,w.dx,w.dy);null!==this.Qb&&(r=this.Ja,h=m=0,q=r.width,r=r.height,s=0,this instanceof W&&(r=this.Ta.Tb,m=r.x,h=r.y,q=r.width,r=r.height,s=this.qe),Ak(this,a,this.Qb,!0),this.Qb instanceof qa&&this.Qb.type===re?(a.beginPath(),a.rect(m-s/2,h-s/2,q+s,r+s),Bk(a,this.Qb,!0)):a.fillRect(m-s/2,h-s/2,q+s,r+s));e&&e.gj&&e.TI(a,this);k&&(null!==this.Qb||null!==this.zc||null!==g&&0!==(g.oa&512)||null!==g&&(g.type===ti||g.type===$g)&&g.Rw()!==this)?(Ck(this,!0),f=[a.shadowOffsetX,a.shadowOffsetY,
a.shadowBlur],a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0):Ck(this,!1);this.rl(a,b);k&&0!==(this.oa&512)===!0&&(a.shadowOffsetX=f[0],a.shadowOffsetY=f[1],a.shadowBlur=f[2]);n&&k&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0);l?(a.restore(),this instanceof C?da(b,a,!0):da(b,a,!1)):w.Et()||(f=1/(w.m11*w.m22-w.m12*w.m21),a.transform(w.m22*f,-w.m12*f,-w.m21*f,w.m11*f,f*(w.m21*w.dy-w.m22*w.dx),f*(w.m12*w.dx-w.m11*w.dy)))}1!==c&&(a.globalAlpha=d)}};
function yk(a,b,c){var d=a.Pb;0===d.width||0===d.height||isNaN(d.x)||isNaN(d.y)||(null!==a.zc&&(Ak(a,b,a.zc,!0,!0),a.zc instanceof qa&&a.zc.type===re?(b.beginPath(),b.rect(d.x,d.y,d.width,d.height),Bk(b,a.zc,!0)):b.fillRect(d.x,d.y,d.width,d.height)),null!==a.Qb&&(Ak(a,b,a.Qb,!0),a.Qb instanceof qa&&a.Qb.type===re?(b.beginPath(),b.rect(d.x,d.y,d.width,d.height),Bk(b,a.Qb,!0)):b.fillRect(d.x,d.y,d.width,d.height)),a.rl(b,c))}aa.rl=function(){};
function Bk(a,b,c){if(c)if(a instanceof CanvasRenderingContext2D&&b instanceof qa&&b.type===re){var d=b.Gy;b=b.Fy;b>d?(a.scale(d/b,1),a.translate((b-d)/2,0),c?a.fill():a.stroke(),a.translate(-(b-d)/2,0),a.scale(1/(d/b),1)):d>b?(a.scale(1,b/d),a.translate(0,(d-b)/2),c?a.fill():a.stroke(),a.translate(0,-(d-b)/2),a.scale(1,1/(b/d))):c?a.fill():a.stroke()}else c?a.fill():a.stroke();else a.stroke()}
function Ak(a,b,c,d,f){if(null!==c){var g=1,h=1;if("string"===typeof c)d?b.Rl!==c&&(b.fillStyle=c,b.Rl=c):b.Jn!==c&&(b.strokeStyle=c,b.Jn=c);else if(c.type===pe)c=c.color,d?b.Rl!==c&&(b.fillStyle=c,b.Rl=c):b.Jn!==c&&(b.strokeStyle=c,b.Jn=c);else{var k,h=a.Ja,g=h.width,h=h.height;if(f)var l=a.pa,g=l.width,h=l.height;var m=b instanceof CanvasRenderingContext2D;if(m&&(c.Zg&&c.type===dk||c.Gy===g&&c.Fy===h))k=c.Zg;else{var n,p,q=p=0;f&&(l=a.pa,g=l.width,h=l.height,p=l.x,q=l.y);c.start instanceof E?(a=
c.start.x,f=c.start.y):c.start instanceof L?(a=c.start.x*g+c.start.offsetX,f=c.start.y*h+c.start.offsetY):(a=Yb.x*g+c.start.offsetX,f=Yb.y*h+c.start.offsetY);c.end instanceof E?(l=c.end.x,n=c.end.y):c.end instanceof L?(l=c.end.x*g+c.end.offsetX,n=c.end.y*h+c.end.offsetY):c.type===qe?(l=ac.x*g+c.end.offsetX,n=ac.y*h+c.end.offsetY):(l=Yb.x*g+c.end.offsetX,n=Yb.y*h+c.end.offsetY);a+=p;l+=p;f+=q;n+=q;c.type===qe?k=b.createLinearGradient(a,f,l,n):c.type===re?(p=isNaN(c.mp)?Math.max(g,h)/2:c.mp,isNaN(c.hq)?
(k=0,p=Math.max(g,h)/2):k=c.hq,k=b.createRadialGradient(a,f,k,l,n,p)):c.type===dk?k=b.createPattern(c.pattern,"repeat"):t.jc(c.type,"Brush type");if(c.type!==dk&&(p=c.hp))for(p=p.k;p.next();)k.addColorStop(p.key,p.value);m&&(c.Zg=k,c.Gy=g,c.Fy=h)}d?b.Rl!==k&&(b.fillStyle=k,b.Rl=k):b.Jn!==k&&(b.strokeStyle=k,b.Jn=k)}}}V.prototype.isContainedBy=V.prototype.rj=function(a){if(a instanceof C)a:{if(this!==a&&null!==a)for(var b=this.ia;null!==b;){if(b===a){a=!0;break a}b=b.ia}a=!1}else a=!1;return a};
V.prototype.isVisibleObject=V.prototype.Cl=function(){if(!this.visible)return!1;var a=this.ia;return null!==a?a.Cl():!0};
function Dk(a){if(0!==(a.oa&2048)===!0){var b=a.Oc;b.reset();if(!a.Pb.P()||!a.$c.P()){Ek(a,!1);return}b.translate(a.Pb.x,a.Pb.y);b.translate(-a.Ha.x,-a.Ha.y);var c=a.Ja;lk(a,b,c.x,c.y,c.width,c.height);Ek(a,!1);Fk(a,!0)}0!==(a.oa&4096)===!0&&(b=a.ia,null===b?(a.Ch.set(a.Oc),Fk(a,!1)):null!==b.se&&(c=a.Ch,c.reset(),b.Kf()?c.multiply(b.Ch):null!==b.ia&&c.multiply(b.ia.Ch),c.multiply(a.Oc),Fk(a,!1)))}
function lk(a,b,c,d,f,g){1!==a.scale&&b.scale(a.scale);if(0!==a.angle){var h=Yb;a.gf&&a.gf.Cd()&&(h=a.gf);var k=t.N();if(a instanceof x&&a.Zb!==a)for(c=a.Zb,d=c.Ja,k.fu(d.x,d.y,d.width,d.height,h),c.Zk.Xa(k),k.offset(-c.Ha.x,-c.Ha.y),h=c.ia;null!==h&&h!==a;)h.Zk.Xa(k),k.offset(-h.Ha.x,-h.Ha.y),h=h.ia;else k.fu(c,d,f,g,h);b.rotate(a.angle,k.x,k.y);t.B(k)}}
V.prototype.ja=function(a){if(!0!==Ui(this)){ok(this,!0);sk(this,!0);var b=this.ia;null!==b?a||b.ja():(a=this.h,null!==a&&(this.Wa()&&a.lg.add(this),this instanceof y&&(a.ma.yb||this.Cf(),null!==this.Dd&&Gk(this.Dd)),a.ie()));if(this instanceof C){var c=null;a=this.va;b=a.length;this.ga===ti&&(c=Hk(this,a,b))&&c.ja(!0);a=a.n;for(c=0;c<b;c++){var d=a[c];!0!==Ui(d)&&(d.Ea.P()||(d instanceof ah||d instanceof C||d instanceof za||nk(d)!==bh)&&d.ja(!0))}}}};
function Ik(a){if(!1===Ui(a)&&(ok(a,!0),sk(a,!0),a instanceof C)){a=a.va.n;for(var b=a.length,c=0;c<b;c++)Ik(a[c])}}function Gk(a){if(!1===Vi(a)){if(null!==a.ia)a.ia.ja();else{var b=a.h;null!==b&&(a.Wa()&&b.lg.add(a),a instanceof y&&a.Cf(),b.ie())}sk(a,!0)}}function pk(a){if(0!==(a.oa&2048)===!1&&(Ek(a,!0),Fk(a,!0),a instanceof C)){a=a.va.n;for(var b=a.length,c=0;c<b;c++)Jk(a[c])}}function Jk(a){Fk(a,!0);if(a instanceof C){a=a.va.n;for(var b=a.length,c=0;c<b;c++)Jk(a[c])}}
V.prototype.na=function(){if(this instanceof x){var a=this.h;null!==a&&!Vi(this)&&!Wi(this)&&this.Wa()&&this.Pb.P()&&a.na(ai(this,this.Pb))}else null!==this.U&&this.U.na()};function nk(a){var b=a.ui,c=a.ia;if(c&&c.ga===fa)return Kk(a,c.we(a.wc),c.ve(a.column));if(c&&c.ga===ti&&c.Rw()===a)return Sc;if(b===ch){if(c){c.ga===$g&&null===c.To&&(b=c.va,Hk(c,b,b.length));if(c.To===a)return Sc;a=c.mA;return a===ch?bh:a}return bh}return b}
function Kk(a,b,c){var d=a.ui;if(d!==ch)return d;var f=d=void 0;switch(b.ui){case ek:f=!0;break;case Sc:f=!0}switch(c.ui){case fk:d=!0;break;case Sc:d=!0}a=a.ia.mA;d=void 0!==d||a!==fk&&a!==Sc?!1:!0;f=void 0!==f||a!==ek&&a!==Sc?!1:!0;return!0===d&&!0===f?Sc:!0===d?fk:!0===f?ek:bh}t.g(V,"segmentOrientation",V.prototype.cu);
t.defineProperty(V,{cu:"segmentOrientation"},function(){return this.us},function(a){var b=this.us;b!==a&&(e&&t.Fa(a,B,V,"segmentOrientation"),this.us=a,this.ja(),this.j("segmentOrientation",b,a))});t.g(V,"segmentIndex",V.prototype.Gf);t.defineProperty(V,{Gf:"segmentIndex"},function(){return this.ss},function(a){e&&t.i(a,"number",V,"segmentIndex");a=Math.round(a);var b=this.ss;b!==a&&(this.ss=a,this.ja(),this.j("segmentIndex",b,a))});t.g(V,"segmentFraction",V.prototype.bu);
t.defineProperty(V,{bu:"segmentFraction"},function(){return this.rs},function(a){e&&t.i(a,"number",V,"segmentFraction");isNaN(a)?a=0:0>a?a=0:1<a&&(a=1);var b=this.rs;b!==a&&(this.rs=a,this.ja(),this.j("segmentFraction",b,a))});t.g(V,"segmentOffset",V.prototype.sB);t.defineProperty(V,{sB:"segmentOffset"},function(){return this.ts},function(a){var b=this.ts;b.O(a)||(e&&t.l(a,E,V,"segmentOffset"),this.ts=a=a.ba(),this.ja(),this.j("segmentOffset",b,a))});t.g(V,"stretch",V.prototype.ui);
t.defineProperty(V,{ui:"stretch"},function(){return this.$h},function(a){var b=this.$h;b!==a&&(e&&t.Fa(a,V,V,"stretch"),this.$h=a,this.ja(),this.j("stretch",b,a))});t.g(V,"name",V.prototype.name);t.defineProperty(V,{name:"name"},function(){return this.ec},function(a){var b=this.ec;b!==a&&(e&&t.i(a,"string",V,"name"),this.ec=a,this.U&&(this.U.Uj=null),this.j("name",b,a))});t.g(V,"opacity",V.prototype.opacity);
t.defineProperty(V,{opacity:"opacity"},function(){return this.Qf},function(a){var b=this.Qf;b!==a&&(t.i(a,"number",V,"opacity"),(0>a||1<a)&&t.ha(a,"0 <= val <= 1",V,"opacity"),this.Qf=a,this.j("opacity",b,a),a=this.h,b=this.U,null!==a&&null!==b&&a.na(ai(b,b.pa)))});t.g(V,"visible",V.prototype.visible);
t.defineProperty(V,{visible:"visible"},function(){return 0!==(this.oa&1)},function(a){var b=0!==(this.oa&1);b!==a&&(e&&t.i(a,"boolean",V,"visible"),this.oa^=1,this.j("visible",b,a),b=this.ia,null!==b?b.ja():this instanceof x&&(this.h&&this.h.na(),tk(this),this.sh(a)),this.na(),Lk(this))});t.g(V,"pickable",V.prototype.kf);t.defineProperty(V,{kf:"pickable"},function(){return 0!==(this.oa&2)},function(a){var b=0!==(this.oa&2);b!==a&&(e&&t.i(a,"boolean",V,"pickable"),this.oa^=2,this.j("pickable",b,a))});
t.g(V,"fromLinkableDuplicates",V.prototype.eF);t.defineProperty(V,{eF:"fromLinkableDuplicates"},function(){return 0!==(this.oa&4)},function(a){var b=0!==(this.oa&4);b!==a&&(e&&t.i(a,"boolean",V,"fromLinkableDuplicates"),this.oa^=4,this.j("fromLinkableDuplicates",b,a))});t.g(V,"fromLinkableSelfNode",V.prototype.fF);
t.defineProperty(V,{fF:"fromLinkableSelfNode"},function(){return 0!==(this.oa&8)},function(a){var b=0!==(this.oa&8);b!==a&&(e&&t.i(a,"boolean",V,"fromLinkableSelfNode"),this.oa^=8,this.j("fromLinkableSelfNode",b,a))});t.g(V,"toLinkableDuplicates",V.prototype.RG);t.defineProperty(V,{RG:"toLinkableDuplicates"},function(){return 0!==(this.oa&16)},function(a){var b=0!==(this.oa&16);b!==a&&(e&&t.i(a,"boolean",V,"toLinkableDuplicates"),this.oa^=16,this.j("toLinkableDuplicates",b,a))});
t.g(V,"toLinkableSelfNode",V.prototype.SG);t.defineProperty(V,{SG:"toLinkableSelfNode"},function(){return 0!==(this.oa&32)},function(a){var b=0!==(this.oa&32);b!==a&&(e&&t.i(a,"boolean",V,"toLinkableSelfNode"),this.oa^=32,this.j("toLinkableSelfNode",b,a))});t.g(V,"isPanelMain",V.prototype.oi);t.defineProperty(V,{oi:"isPanelMain"},function(){return 0!==(this.oa&64)},function(a){var b=0!==(this.oa&64);b!==a&&(e&&t.i(a,"boolean",V,"isPanelMain"),this.oa^=64,this.ja(),this.j("isPanelMain",b,a))});
t.g(V,"isActionable",V.prototype.Bt);t.defineProperty(V,{Bt:"isActionable"},function(){return 0!==(this.oa&128)},function(a){var b=0!==(this.oa&128);b!==a&&(e&&t.i(a,"boolean",V,"isActionable"),this.oa^=128,this.j("isActionable",b,a))});t.g(V,"areaBackground",V.prototype.hk);
t.defineProperty(V,{hk:"areaBackground"},function(){return this.zc},function(a){var b=this.zc;b!==a&&(e&&null!==a&&t.fp(a,"GraphObject.areaBackground"),a instanceof qa&&a.freeze(),this.zc=a,this.na(),this.j("areaBackground",b,a))});t.g(V,"background",V.prototype.background);t.defineProperty(V,{background:"background"},function(){return this.Qb},function(a){var b=this.Qb;b!==a&&(e&&null!==a&&t.fp(a,"GraphObject.background"),a instanceof qa&&a.freeze(),this.Qb=a,this.na(),this.j("background",b,a))});
function Ck(a,b){a.oa=b?a.oa|512:a.oa&-513}function Mk(a,b){a.oa=b?a.oa|1024:a.oa&-1025}function Ek(a,b){a.oa=b?a.oa|2048:a.oa&-2049}function Fk(a,b){a.oa=b?a.oa|4096:a.oa&-4097}function Ui(a){return 0!==(a.oa&8192)}function ok(a,b){a.oa=b?a.oa|8192:a.oa&-8193}function Vi(a){return 0!==(a.oa&16384)}function sk(a,b){a.oa=b?a.oa|16384:a.oa&-16385}t.A(V,{U:"part"},function(){if(this instanceof x)return this;if(this.zm)return this.zm;var a;for(a=this.ia;a;){if(a instanceof x)return this.zm=a;a=a.ia}return null});
V.prototype.Il=function(a){this.Ui=a};t.A(V,{ia:"panel"},function(){return this.Ui});t.A(V,{layer:"layer"},function(){var a=this.U;return null!==a?a.layer:null});t.A(V,{h:"diagram"},function(){var a=this.U;return null!==a?a.h:null},{configurable:!0});t.g(V,"position",V.prototype.position);t.defineProperty(V,{position:"position"},function(){return this.Pa},function(a){var b=this.Pa;b.O(a)||(e&&t.l(a,E,V,"position"),a=a.ba(),this.FG(a,b)&&this.j("position",b,a))});
V.prototype.FG=function(a){this.Pa=a;Gk(this);pk(this);return!0};V.prototype.GG=function(a,b){this.Pa.p(a,b);Nk(this,!1);pk(this)};t.A(V,{pa:"actualBounds"},function(){return this.Pb});t.g(V,"scale",V.prototype.scale);t.defineProperty(V,{scale:"scale"},function(){return this.fc},function(a){var b=this.fc;b!==a&&(e&&t.q(a,V,"scale"),0>=a&&t.m("GraphObject.scale must be greater than zero"),this.fc=a,pk(this),this.ja(),this.j("scale",b,a))});t.g(V,"angle",V.prototype.angle);
t.defineProperty(V,{angle:"angle"},function(){return this.Nn},function(a){var b=this.Nn;b!==a&&(e&&t.q(a,V,"angle"),a%=360,0>a&&(a+=360),b!==a&&(this.Nn=a,this.ja(),pk(this),this.j("angle",b,a)))});t.g(V,"desiredSize",V.prototype.Ea);
t.defineProperty(V,{Ea:"desiredSize"},function(){return this.pf},function(a){var b=this.pf;b.O(a)||(e&&t.l(a,ra,V,"desiredSize"),this.pf=a=a.ba(),this.ja(),this instanceof W&&this.df(),this.j("desiredSize",b,a),a=this.U,null!==a&&0!==(this.oa&1024)&&(jk(this,a,"width"),jk(this,a,"height")))});t.g(V,"width",V.prototype.width);
t.defineProperty(V,{width:"width"},function(){return this.pf.width},function(a){if(this.pf.width!==a){e&&t.i(a,"number",V,"width");var b=this.pf;this.pf=a=(new ra(a,this.pf.height)).freeze();this.ja();this instanceof W&&this.df();this.j("desiredSize",b,a);b=this.U;null!==b&&0!==(this.oa&1024)&&jk(this,b,"width")}});t.g(V,"height",V.prototype.height);
t.defineProperty(V,{height:"height"},function(){return this.pf.height},function(a){if(this.pf.height!==a){e&&t.i(a,"number",V,"height");var b=this.pf;this.pf=a=(new ra(this.pf.width,a)).freeze();this.ja();this instanceof W&&this.df();this.j("desiredSize",b,a);b=this.U;null!==b&&0!==(this.oa&1024)&&jk(this,b,"height")}});t.g(V,"minSize",V.prototype.Yf);
t.defineProperty(V,{Yf:"minSize"},function(){return this.Tj},function(a){var b=this.Tj;b.O(a)||(e&&t.l(a,ra,V,"minSize"),a=a.copy(),isNaN(a.width)&&(a.width=0),isNaN(a.height)&&(a.height=0),a.freeze(),this.Tj=a,this.ja(),this.j("minSize",b,a))});t.g(V,"maxSize",V.prototype.Oe);
t.defineProperty(V,{Oe:"maxSize"},function(){return this.Sj},function(a){var b=this.Sj;b.O(a)||(e&&t.l(a,ra,V,"maxSize"),a=a.copy(),isNaN(a.width)&&(a.width=Infinity),isNaN(a.height)&&(a.height=Infinity),a.freeze(),this.Sj=a,this.ja(),this.j("maxSize",b,a))});t.A(V,{Ha:"measuredBounds"},function(){return this.$c});t.A(V,{Ja:"naturalBounds"},function(){return this.nd},{configurable:!0});t.g(V,"margin",V.prototype.margin);
t.defineProperty(V,{margin:"margin"},function(){return this.Gr},function(a){"number"===typeof a?a=new wb(a):e&&t.l(a,wb,V,"margin");var b=this.Gr;b.O(a)||(this.Gr=a=a.ba(),this.ja(),this.j("margin",b,a))});t.A(V,{transform:null},function(){0!==(this.oa&2048)===!0&&Dk(this);return this.Oc});t.A(V,{se:null},function(){0!==(this.oa&4096)===!0&&Dk(this);return this.Ch});t.g(V,"alignment",V.prototype.alignment);
t.defineProperty(V,{alignment:"alignment"},function(){return this.Ae},function(a){var b=this.Ae;b.O(a)||(e?t.l(a,L,V,"alignment"):a.Me()&&!a.Tc()&&t.m("alignment must be a real Spot or Spot.Default"),this.Ae=a=a.ba(),Gk(this),this.j("alignment",b,a))});t.g(V,"column",V.prototype.column);t.defineProperty(V,{column:"column"},function(){return this.Hq},function(a){e&&t.q(a,V,"column");a=Math.round(a);var b=this.Hq;b!==a&&(0>a&&t.ha(a,">= 0",V,"column"),this.Hq=a,this.ja(),this.j("column",b,a))});
t.g(V,"columnSpan",V.prototype.yE);t.defineProperty(V,{yE:"columnSpan"},function(){return this.Fj},function(a){e&&t.q(a,V,"columnSpan");a=Math.round(a);var b=this.Fj;b!==a&&(1>a&&t.ha(a,">= 1",V,"columnSpan"),this.Fj=a,this.ja(),this.j("columnSpan",b,a))});t.g(V,"row",V.prototype.wc);t.defineProperty(V,{wc:"row"},function(){return this.os},function(a){e&&t.q(a,V,"row");a=Math.round(a);var b=this.os;b!==a&&(0>a&&t.ha(a,">= 0",V,"row"),this.os=a,this.ja(),this.j("row",b,a))});t.g(V,"rowSpan",V.prototype.rowSpan);
t.defineProperty(V,{rowSpan:"rowSpan"},function(){return this.Yj},function(a){e&&t.q(a,V,"rowSpan");a=Math.round(a);var b=this.Yj;b!==a&&(1>a&&t.ha(a,">= 1",V,"rowSpan"),this.Yj=a,this.ja(),this.j("rowSpan",b,a))});t.g(V,"alignmentFocus",V.prototype.ek);
t.defineProperty(V,{ek:"alignmentFocus"},function(){return this.Aq},function(a){var b=this.Aq;b.O(a)||(e?t.l(a,L,V,"alignmentFocus"):a.Me()&&!a.Tc()&&t.m("alignmentFocus must be a real Spot or Spot.Default"),this.Aq=a=a.ba(),this.ja(),this.j("alignmentFocus",b,a))});t.g(V,"portId",V.prototype.Ud);
t.defineProperty(V,{Ud:"portId"},function(){return this.bs},function(a){var b=this.bs;if(b!==a){e&&null!==a&&t.i(a,"string",V,"portId");var c=this.U;null===c||c instanceof y||(t.m("portID being set on a Link: "+a),c=null);null!==b&&c&&Ok(c,this);this.bs=a;if(null!==a&&c){c.Qh=!0;null===c.Ad&&Pk(c);var d=this.Ud;null!==d&&c.Ad.add(d,this)}this.j("portId",b,a)}});function Qk(a){var b={value:null};Rk(a,b);return b.value}
function Rk(a,b){var c=a.ia;return null===c||!Rk(c,b)&&a.visible?(b.value=a,!1):!0}function Lk(a){var b=a.U;b instanceof y&&(a=a.h)&&!a.ma.yb&&b.Cf()}t.g(V,"toSpot",V.prototype.zb);t.defineProperty(V,{zb:"toSpot"},function(){return null!==this.R?this.R.ei:Tb},function(a){null===this.R&&this.Le();var b=this.R.ei;b.O(a)||(e&&t.l(a,L,V,"toSpot"),a=a.ba(),this.R.ei=a,this.j("toSpot",b,a),Lk(this))});t.g(V,"toEndSegmentLength",V.prototype.xk);
t.defineProperty(V,{xk:"toEndSegmentLength"},function(){return null!==this.R?this.R.bi:10},function(a){null===this.R&&this.Le();var b=this.R.bi;b!==a&&(e&&t.i(a,"number",V,"toEndSegmentLength"),0>a&&t.ha(a,">= 0",V,"toEndSegmentLength"),this.R.bi=a,this.j("toEndSegmentLength",b,a),Lk(this))});t.g(V,"toEndSegmentDirection",V.prototype.kq);
t.defineProperty(V,{kq:"toEndSegmentDirection"},function(){return null!==this.R?this.R.ai:hk},function(a){null===this.R&&this.Le();var b=this.R.ai;b!==a&&(e&&t.Fa(a,y,V,"toEndSegmentDirection"),this.R.ai=a,this.j("toEndSegmentDirection",b,a),Lk(this))});t.g(V,"toShortLength",V.prototype.lq);
t.defineProperty(V,{lq:"toShortLength"},function(){return null!==this.R?this.R.di:0},function(a){null===this.R&&this.Le();var b=this.R.di;b!==a&&(e&&t.i(a,"number",V,"toShortLength"),this.R.di=a,this.j("toShortLength",b,a),Lk(this))});t.g(V,"toLinkable",V.prototype.GB);t.defineProperty(V,{GB:"toLinkable"},function(){return this.Ns},function(a){var b=this.Ns;b!==a&&(e&&null!==a&&t.i(a,"boolean",V,"toLinkable"),this.Ns=a,this.j("toLinkable",b,a))});t.g(V,"toMaxLinks",V.prototype.TG);
t.defineProperty(V,{TG:"toMaxLinks"},function(){return this.Os},function(a){var b=this.Os;b!==a&&(e&&t.q(a,V,"toMaxLinks"),0>a&&t.ha(a,">= 0",V,"toMaxLinks"),this.Os=a,this.j("toMaxLinks",b,a))});t.g(V,"fromSpot",V.prototype.vb);t.defineProperty(V,{vb:"fromSpot"},function(){return null!==this.R?this.R.Ph:Tb},function(a){null===this.R&&this.Le();var b=this.R.Ph;b.O(a)||(e&&t.l(a,L,V,"fromSpot"),a=a.ba(),this.R.Ph=a,this.j("fromSpot",b,a),Lk(this))});t.g(V,"fromEndSegmentLength",V.prototype.rk);
t.defineProperty(V,{rk:"fromEndSegmentLength"},function(){return null!==this.R?this.R.Mh:10},function(a){null===this.R&&this.Le();var b=this.R.Mh;b!==a&&(e&&t.i(a,"number",V,"fromEndSegmentLength"),0>a&&t.ha(a,">= 0",V,"fromEndSegmentLength"),this.R.Mh=a,this.j("fromEndSegmentLength",b,a),Lk(this))});t.g(V,"fromEndSegmentDirection",V.prototype.tp);
t.defineProperty(V,{tp:"fromEndSegmentDirection"},function(){return null!==this.R?this.R.Lh:hk},function(a){null===this.R&&this.Le();var b=this.R.Lh;b!==a&&(e&&t.Fa(a,y,V,"fromEndSegmentDirection"),this.R.Lh=a,this.j("fromEndSegmentDirection",b,a),Lk(this))});t.g(V,"fromShortLength",V.prototype.up);
t.defineProperty(V,{up:"fromShortLength"},function(){return null!==this.R?this.R.Oh:0},function(a){null===this.R&&this.Le();var b=this.R.Oh;b!==a&&(e&&t.i(a,"number",V,"fromShortLength"),this.R.Oh=a,this.j("fromShortLength",b,a),Lk(this))});t.g(V,"fromLinkable",V.prototype.yA);t.defineProperty(V,{yA:"fromLinkable"},function(){return this.ar},function(a){var b=this.ar;b!==a&&(e&&null!==a&&t.i(a,"boolean",V,"fromLinkable"),this.ar=a,this.j("fromLinkable",b,a))});t.g(V,"fromMaxLinks",V.prototype.gF);
t.defineProperty(V,{gF:"fromMaxLinks"},function(){return this.br},function(a){var b=this.br;b!==a&&(e&&t.q(a,V,"fromMaxLinks"),0>a&&t.ha(a,">= 0",V,"fromMaxLinks"),this.br=a,this.j("fromMaxLinks",b,a))});t.g(V,"cursor",V.prototype.cursor);t.defineProperty(V,{cursor:"cursor"},function(){return this.Oq},function(a){var b=this.Oq;b!==a&&(t.i(a,"string",V,"cursor"),this.Oq=a,this.j("cursor",b,a))});t.g(V,"click",V.prototype.click);
t.defineProperty(V,{click:"click"},function(){return null!==this.S?this.S.Ai:null},function(a){null===this.S&&gk(this);var b=this.S.Ai;b!==a&&(null!==a&&t.i(a,"function",V,"click"),this.S.Ai=a,this.j("click",b,a))});t.g(V,"doubleClick",V.prototype.dn);t.defineProperty(V,{dn:"doubleClick"},function(){return null!==this.S?this.S.Gi:null},function(a){null===this.S&&gk(this);var b=this.S.Gi;b!==a&&(null!==a&&t.i(a,"function",V,"doubleClick"),this.S.Gi=a,this.j("doubleClick",b,a))});
t.g(V,"contextClick",V.prototype.jt);t.defineProperty(V,{jt:"contextClick"},function(){return null!==this.S?this.S.Ci:null},function(a){null===this.S&&gk(this);var b=this.S.Ci;b!==a&&(null!==a&&t.i(a,"function",V,"contextClick"),this.S.Ci=a,this.j("contextClick",b,a))});t.g(V,"mouseEnter",V.prototype.UA);
t.defineProperty(V,{UA:"mouseEnter"},function(){return null!==this.S?this.S.Sr:null},function(a){null===this.S&&gk(this);var b=this.S.Sr;b!==a&&(null!==a&&t.i(a,"function",V,"mouseEnter"),this.S.Sr=a,this.j("mouseEnter",b,a))});t.g(V,"mouseLeave",V.prototype.VA);t.defineProperty(V,{VA:"mouseLeave"},function(){return null!==this.S?this.S.Tr:null},function(a){null===this.S&&gk(this);var b=this.S.Tr;b!==a&&(null!==a&&t.i(a,"function",V,"mouseLeave"),this.S.Tr=a,this.j("mouseLeave",b,a))});
t.g(V,"mouseOver",V.prototype.Pt);t.defineProperty(V,{Pt:"mouseOver"},function(){return null!==this.S?this.S.Qi:null},function(a){null===this.S&&gk(this);var b=this.S.Qi;b!==a&&(null!==a&&t.i(a,"function",V,"mouseOver"),this.S.Qi=a,this.j("mouseOver",b,a))});t.g(V,"mouseHover",V.prototype.Ot);
t.defineProperty(V,{Ot:"mouseHover"},function(){return null!==this.S?this.S.Pi:null},function(a){null===this.S&&gk(this);var b=this.S.Pi;b!==a&&(null!==a&&t.i(a,"function",V,"mouseHover"),this.S.Pi=a,this.j("mouseHover",b,a))});t.g(V,"mouseHold",V.prototype.Nt);t.defineProperty(V,{Nt:"mouseHold"},function(){return null!==this.S?this.S.Oi:null},function(a){null===this.S&&gk(this);var b=this.S.Oi;b!==a&&(null!==a&&t.i(a,"function",V,"mouseHold"),this.S.Oi=a,this.j("mouseHold",b,a))});
t.g(V,"mouseDragEnter",V.prototype.$F);t.defineProperty(V,{$F:"mouseDragEnter"},function(){return null!==this.S?this.S.Qr:null},function(a){null===this.S&&gk(this);var b=this.S.Qr;b!==a&&(null!==a&&t.i(a,"function",V,"mouseDragEnter"),this.S.Qr=a,this.j("mouseDragEnter",b,a))});t.g(V,"mouseDragLeave",V.prototype.TA);
t.defineProperty(V,{TA:"mouseDragLeave"},function(){return null!==this.S?this.S.Rr:null},function(a){null===this.S&&gk(this);var b=this.S.Rr;b!==a&&(null!==a&&t.i(a,"function",V,"mouseDragLeave"),this.S.Rr=a,this.j("mouseDragLeave",b,a))});t.g(V,"mouseDrop",V.prototype.Mt);t.defineProperty(V,{Mt:"mouseDrop"},function(){return null!==this.S?this.S.Ni:null},function(a){null===this.S&&gk(this);var b=this.S.Ni;b!==a&&(null!==a&&t.i(a,"function",V,"mouseDrop"),this.S.Ni=a,this.j("mouseDrop",b,a))});
t.g(V,"actionDown",V.prototype.Tz);t.defineProperty(V,{Tz:"actionDown"},function(){return null!==this.S?this.S.wq:null},function(a){null===this.S&&gk(this);var b=this.S.wq;b!==a&&(null!==a&&t.i(a,"function",V,"actionDown"),this.S.wq=a,this.j("actionDown",b,a))});t.g(V,"actionUp",V.prototype.Vz);
t.defineProperty(V,{Vz:"actionUp"},function(){return null!==this.S?this.S.yq:null},function(a){null===this.S&&gk(this);var b=this.S.yq;b!==a&&(null!==a&&t.i(a,"function",V,"actionUp"),this.S.yq=a,this.j("actionUp",b,a))});t.g(V,"actionMove",V.prototype.Uz);t.defineProperty(V,{Uz:"actionMove"},function(){return null!==this.S?this.S.xq:null},function(a){null===this.S&&gk(this);var b=this.S.xq;b!==a&&(null!==a&&t.i(a,"function",V,"actionMove"),this.S.xq=a,this.j("actionMove",b,a))});
t.g(V,"actionCancel",V.prototype.Sz);t.defineProperty(V,{Sz:"actionCancel"},function(){return null!==this.S?this.S.vq:null},function(a){null===this.S&&gk(this);var b=this.S.vq;b!==a&&(null!==a&&t.i(a,"function",V,"actionCancel"),this.S.vq=a,this.j("actionCancel",b,a))});t.g(V,"toolTip",V.prototype.mu);
t.defineProperty(V,{mu:"toolTip"},function(){return null!==this.S?this.S.$i:null},function(a){null===this.S&&gk(this);var b=this.S.$i;b!==a&&(null!==a&&t.l(a,ea,V,"toolTip"),this.S.$i=a,this.j("toolTip",b,a))});t.g(V,"contextMenu",V.prototype.contextMenu);t.defineProperty(V,{contextMenu:"contextMenu"},function(){return null!==this.S?this.S.Di:null},function(a){null===this.S&&gk(this);var b=this.S.Di;b!==a&&(null!==a&&t.l(a,ea,V,"contextMenu"),this.S.Di=a,this.j("contextMenu",b,a))});
V.prototype.bind=V.prototype.bind=function(a){a.vg=this;var b=this.qp();null!==b&&Sk(b)&&t.m("Cannot add a Binding to a template that has already been copied: "+a);null===this.Nc&&(this.Nc=new H(Me));this.Nc.add(a)};V.prototype.findTemplateBinder=V.prototype.qp=function(){for(var a=this instanceof C?this:this.ia;null!==a;){if(null!==a.Ul&&a instanceof C)return a;a=a.ia}return null};V.fromSvg=V.fromSVG=function(a){return Tk(a)};V.prototype.setProperties=function(a){t.Gx(this,a)};var Uk;
V.make=Uk=function(a,b){var c=arguments,d=null,f=null;if("function"===typeof a)f=a;else if("string"===typeof a){var g=Vk.Da(a);"function"===typeof g?(c=Array.prototype.slice.call(arguments),d=g(c)):f=ca[a]}null===d&&(void 0===f&&(d=window.$,void 0!==d&&void 0!==d.noop&&t.m("GraphObject.make failed to complete. Is it conflicting with another $ var? (such as jQuery)"),t.m("GraphObject.make failed to complete, it may be conflicting with another var.")),null!==f&&f.constructor||t.m("GraphObject.make requires a class function or class name, not: "+
a),d=new f);g=1;d instanceof v&&1<c.length&&(f=c[1],"string"===typeof f||f instanceof HTMLDivElement)&&(d.nj=null,ri(d,f),g++);for(;g<c.length;g++)f=c[g],void 0===f?t.m("Undefined value at argument "+g+" for object being constructed by GraphObject.make: "+d):Wk(d,f);return d};
function Wk(a,b){if("string"===typeof b){var c=a;if(c instanceof za)c.text=b;else if(c instanceof W)c.Eb=b;else if(c instanceof Xk)c.source=b;else if(c instanceof C){var d=t.en(C,b);null!==d?c.type=d:t.m("Unknown Panel type as an argument to GraphObject.make: "+b)}else c instanceof qa?(d=t.en(qa,b),null!==d?c.type=d:t.m("Unknown Brush type as an argument to GraphObject.make: "+b)):c instanceof Pc?(d=t.en(Pc,b),null!==d?c.type=d:t.m("Unknown Geometry type as an argument to GraphObject.make: "+b)):
c instanceof xd?(d=t.en(xd,b),null!==d?c.type=d:t.m("Unknown PathSegment type as an argument to GraphObject.make: "+b)):t.m("Unable to use a string as an argument to GraphObject.make: "+b)}else if(b instanceof V)a instanceof C||t.m("A GraphObject can only be added to a Panel, not to: "+a),a.add(b);else if(b instanceof Je)a instanceof C||t.m("A RowColumnDefinition can only be added to a Panel, not to: "+a),c=b.pi?a.we(b.index):a.ve(b.index),t.l(b,Je,Je,"copyFrom:pd"),b.pi?c.height=b.height:c.width=
b.width,c.si=b.si,c.Ef=b.Ef,c.alignment=b.alignment,c.gu=b.gu,c.ak=null===b.ak?null:b.ak.ba(),c.Bn=b.Bn,c.Cn=b.Cn,c.Wh=null,b.Wh&&(c.Wh=b.Wh.slice(0)),c.background=b.background,c.Hw=b.Hw,c.Nc=b.Nc;else if(b instanceof oa)c=a,c instanceof B&&b.Xe===B?2===(b.value&2)?c.au=b:b===Wg||b===Ng||b===Mg?c.Je=b:b===Yk||b===Zk||b===$k?c.Yo=b:b!==al&&b!==Og&&t.m("Unknown Link enum value for a Link property: "+b):c instanceof C&&b.Xe===C?c.type=b:c instanceof za&&b.Xe===za?c.OB=b:c instanceof V&&b.Xe===B?0===
b.name.indexOf("Orient")?c.cu=b:t.m("Unknown Link enum value for GraphObject.segmentOrientation property: "+b):c instanceof V&&b.Xe===V?c.ui=b:c instanceof v&&b.Xe===v?c.Tm=b:c instanceof qa&&b.Xe===qa?c.type=b:c instanceof Pc&&b.Xe===Pc?c.type=b:c instanceof xd&&b.Xe===xd?c.type=b:c instanceof Me&&b.Xe===Me?c.mode=b:c instanceof Cd&&b.Xe===Cd?c.Bd=b:c instanceof X&&b.Xe===X?0===b.name.indexOf("Alignment")?c.alignment=b:0===b.name.indexOf("Arrangement")?c.We=b:0===b.name.indexOf("Compaction")?c.compaction=
b:0===b.name.indexOf("Path")?c.path=b:0===b.name.indexOf("Sorting")?c.sorting=b:0===b.name.indexOf("Style")?c.bH=b:t.m("Unknown enum value: "+b):c instanceof Z&&b.Xe===Z?0===b.name.indexOf("Aggressive")?c.hE=b:0===b.name.indexOf("Cycle")?c.GE=b:0===b.name.indexOf("Init")?c.yF=b:0===b.name.indexOf("Layer")?c.LF=b:t.m("Unknown enum value: "+b):c instanceof ak&&b.Xe===ak?b===bl||b===cl||b===dl||b===el?c.sorting=b:b===fl||b===gl?c.We=b:b===hl||b===il?c.alignment=b:t.m("Unknown enum value: "+b):c instanceof
jl&&b.Xe===jl?b===kl||b===ll||b===ml||b===nl||b===ol?c.sorting=b:b===pl||b===ql||b===rl||b===sl?c.direction=b:b===tl||b===ul||b===vl||b===Bl?c.We=b:b===Cl||b===Dl?c.Rt=b:t.m("Unknown enum value: "+b):t.m("No property to set for this enum value: "+b);else if(b instanceof Me)if(a instanceof V||a instanceof Je){var d=b.ku,f=d.indexOf(".");0<f&&a instanceof C&&(c=d.substr(f+1),d=a.ue(d.substring(0,f)),null!==d&&(a=d,b.ku=c));a.bind(b)}else t.m("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+
a);else if(b instanceof Rc)a instanceof Pc?a.Fb.add(b):t.m("A PathFigure can only be added to a Geometry, not to: "+a);else if(b instanceof xd)a instanceof Rc?a.Ka.add(b):t.m("A PathSegment can only be added to a PathFigure, not to: "+a);else if(Array.isArray(b))for(c=0;c<b.length;c++)Wk(a,b[c]);else if("object"===typeof b&&null!==b)if(c=a,c instanceof qa){d={};for(f in b){var g=parseFloat(f);isNaN(g)?d[f]=b[f]:c.addColorStop(g,b[f])}t.Gx(c,d)}else c instanceof Je?(void 0!==b.row?(d=b.row,(void 0===
d||null===d||Infinity===d||isNaN(d)||0>d)&&t.m("Must specify non-negative integer row for RowColumnDefinition "+b),c.hm=!0,c.Zc=d):void 0!==b.column?(d=b.column,(void 0===d||null===d||Infinity===d||isNaN(d)||0>d)&&t.m("Must specify non-negative integer column for RowColumnDefinition "+b),c.hm=!1,c.Zc=d):t.m("Must specify row or column value in a RowColumnDefinition "+b),d=t.wI(b,"row","column"),t.Gx(c,d)):t.Gx(c,b);else t.m('Unknown initializer "'+b+'" for object being constructed by GraphObject.make: '+
a)}var Vk;V.Builders=Vk=new wa("string","function");
Vk.add("Button",function(){var a=new qa(qe);a.addColorStop(0,"white");a.addColorStop(1,"lightgray");var b=new qa(qe);b.addColorStop(0,"white");b.addColorStop(1,"dodgerblue");var c=Uk(C,ti,{Bt:!0},Uk(W,{name:"ButtonBorder",Eb:"RoundedRectangle",fill:a,stroke:"gray"}));c.UA=function(a,c){var g=c.wa(0),h=c._buttonFillOver;void 0===h&&(h=b);c._buttonFillNormal=g.fill;g.fill=h;h=c._buttonStrokeOver;void 0===h&&(h="blue");c._buttonStrokeNormal=g.stroke;g.stroke=h};c.VA=function(b,c){var g=c.wa(0),h=c._buttonFillNormal;
void 0===h&&(h=a);g.fill=h;h=c._buttonStrokeNormal;void 0===h&&(h="gray");g.stroke=h};return c});
Vk.add("TreeExpanderButton",function(){var a=Uk("Button",Uk(W,{name:"ButtonIcon",Eb:"MinusLine",Ea:K.rq},(new Me("figure","isTreeExpanded",function(a,c){var d=null,f=c.ia;f&&(d=a?f._treeExpandedFigure:f._treeCollapsedFigure);d||(d=a?"MinusLine":"PlusLine");return d})).bB("")),{visible:!1},(new Me("visible","isTreeLeaf",function(a){return!a})).bB(""));a.click=function(a,c){var d=c.U;d instanceof ea&&(d=d.hi);if(d instanceof y){var f=d.h;if(null!==f){f=f.Ye;if(d.Uc){if(!f.canCollapseTree(d))return}else if(!f.canExpandTree(d))return;
a.Ke=!0;d.Uc?f.collapseTree(d):f.expandTree(d)}}};return a});
Vk.add("SubGraphExpanderButton",function(){var a=Uk("Button",Uk(W,{name:"ButtonIcon",Eb:"MinusLine",Ea:K.rq},(new Me("figure","isSubGraphExpanded",function(a,c){var d=null,f=c.ia;f&&(d=a?f._subGraphExpandedFigure:f._subGraphCollapsedFigure);d||(d=a?"MinusLine":"PlusLine");return d})).bB("")));a.click=function(a,c){var d=c.U;d instanceof ea&&(d=d.hi);if(d instanceof z){var f=d.h;if(null!==f){f=f.Ye;if(d.xe){if(!f.canCollapseSubGraph(d))return}else if(!f.canExpandSubGraph(d))return;a.Ke=!0;d.xe?f.collapseSubGraph(d):
f.expandSubGraph(d)}}};return a});Vk.add("ContextMenuButton",function(){var a=Uk("Button");a.ui=fk;var b=a.ue("ButtonBorder");b instanceof W&&(b.Eb="Rectangle",b.G=new L(0,0,2,2),b.H=new L(1,1,-2,-2));return a});V.defineBuilder=function(a,b){t.i(a,"string",V,"defineBuilder:name");t.i(b,"function",V,"defineBuilder:func");var c=a.toLowerCase();""!==a&&"none"!==c&&a!==c||t.m("Shape.defineFigureGenerator name must not be empty or None or all-lower-case: "+a);V.Builders.add(a,b)};
function C(a){V.call(this);void 0===a?0===arguments.length?this.ga=gh:t.m("invalid argument to Panel constructor: undefined"):(t.Fa(a,C,C,"type"),this.ga=a);this.va=new H(V);this.Te=K.tq;this.bh=!1;this.ga===Ci&&(this.bh=!0);this.Rq=Ub;this.Ac=ch;this.ga===fa&&El(this);this.Vo=dh;this.fr=(new ra(10,10)).freeze();this.gr=K.Aj;this.Ul=this.Zl=null;this.vr=NaN;this.ng=this.Li=null;this.xo="category";this.mg=null;this.bj=new F(NaN,NaN,NaN,NaN);this.To=null;this.Qh=!1;this.ps=null}t.ka("Panel",C);t.ii(C);
t.Qa(C,V);function El(a){a.Gj=K.tq;a.Jh=1;a.Fi=null;a.am=null;a.Ih=1;a.Hh=null;a.$l=null;a.pd=[];a.jd=[];a.Em=Fl;a.Wl=Fl;a.aj=0;a.Mi=0}
C.prototype.cloneProtected=function(a){V.prototype.cloneProtected.call(this,a);a.ga=this.ga;a.Te=this.Te.ba();a.bh=this.bh;a.Rq=this.Rq.ba();a.Ac=this.Ac;if(a.ga===fa){a.Gj=this.Gj.ba();a.Jh=this.Jh;a.Fi=this.Fi;a.am=this.am;a.Ih=this.Ih;a.Hh=this.Hh;a.$l=this.$l;var b=[];if(0<this.pd.length)for(var c=this.pd,d=c.length,f=0;f<d;f++)if(void 0!==c[f]){var g=c[f].copy();g.Il(a);b[f]=g}a.pd=b;b=[];if(0<this.jd.length)for(c=this.jd,d=c.length,f=0;f<d;f++)void 0!==c[f]&&(g=c[f].copy(),g.Il(a),b[f]=g);a.jd=
b;a.Em=this.Em;a.Wl=this.Wl;a.aj=this.aj;a.Mi=this.Mi}a.Vo=this.Vo;a.fr.assign(this.fr);a.gr=this.gr.ba();a.Zl=this.Zl;a.Ul=this.Ul;a.vr=this.vr;a.Li=this.Li;a.ng=this.ng;a.xo=this.xo;a.bj.assign(this.bj);a.Qh=this.Qh;this.ps&&(a.ps=this.ps);this._buttonFillNormal&&(a._buttonFillNormal=this._buttonFillNormal);this._buttonFillOver&&(a._buttonFillOver=this._buttonFillOver);this._buttonStrokeNormal&&(a._buttonStrokeNormal=this._buttonStrokeNormal);this._buttonStrokeOver&&(a._buttonStrokeOver=this._buttonStrokeOver);
this._treeExpandedFigure&&(a._treeExpandedFigure=this._treeExpandedFigure);this._treeCollapsedFigure&&(a._treeCollapsedFigure=this._treeCollapsedFigure);this._subGraphExpandedFigure&&(a._subGraphExpandedFigure=this._subGraphExpandedFigure);this._subGraphCollapsedFigure&&(a._subGraphCollapsedFigure=this._subGraphCollapsedFigure)};C.prototype.ji=function(a){V.prototype.ji.call(this,a);a.va=this.va;for(var b=a.va.k;b.next();)b.value.Ui=a};
C.prototype.copy=function(){var a=V.prototype.copy.call(this);if(a instanceof C){var b=this.va;if(0<b.length)for(var c=b.length,d=0;d<c;d++){var f=b.n[d].copy(),g=a;f.Il(g);f.zm=null;var h=g.va,k=h.count;h.Pd(k,f);h=g.U;if(null!==h){h.Uj=null;null!==f.Ud&&h instanceof y&&(h.Qh=!0);var l=g.h;null!==l&&l.ma.yb||h.ed(Md,"elements",g,null,f,null,k)}}return a}return null};C.prototype.toString=function(){return"Panel("+this.type+")#"+t.ud(this)};var gh;C.Position=gh=t.w(C,"Position",0);
C.Horizontal=t.w(C,"Horizontal",1);var si;C.Vertical=si=t.w(C,"Vertical",2);var $g;C.Spot=$g=t.w(C,"Spot",3);var ti;C.Auto=ti=t.w(C,"Auto",4);var fa;C.Table=fa=t.w(C,"Table",5);C.Viewbox=t.w(C,"Viewbox",6);var wk;C.TableRow=wk=t.w(C,"TableRow",7);var xk;C.TableColumn=xk=t.w(C,"TableColumn",8);var Lg;C.Link=Lg=t.w(C,"Link",9);var Ci;C.Grid=Ci=t.w(C,"Grid",10);t.g(C,"type",C.prototype.type);
t.defineProperty(C,{type:"type"},function(){return this.ga},function(a){var b=this.ga;b!==a&&(e&&t.Fa(a,C,C,"type"),b!==wk&&b!==xk||t.m("Cannot change Panel.type when it is already a TableRow or a TableColumn: "+a),this.ga=a,this.ga===Ci?this.bh=!0:this.ga===fa&&El(this),this.ja(),this.j("type",b,a))});t.A(C,{elements:"elements"},function(){return this.va.k});t.A(C,{Ja:"naturalBounds"},function(){return this.nd});t.g(C,"padding",C.prototype.padding);
t.defineProperty(C,{padding:"padding"},function(){return this.Te},function(a){"number"===typeof a?(0>a&&t.ha(a,">= 0",C,"padding"),a=new wb(a)):(t.l(a,wb,C,"padding"),0>a.left&&t.ha(a.left,">= 0",C,"padding:val.left"),0>a.right&&t.ha(a.right,">= 0",C,"padding:val.right"),0>a.top&&t.ha(a.top,">= 0",C,"padding:val.top"),0>a.bottom&&t.ha(a.bottom,">= 0",C,"padding:val.bottom"));var b=this.Te;b.O(a)||(this.Te=a=a.ba(),this.ja(),this.j("padding",b,a))});t.g(C,"defaultAlignment",C.prototype.lk);
t.defineProperty(C,{lk:"defaultAlignment"},function(){return this.Rq},function(a){var b=this.Rq;b.O(a)||(e&&t.l(a,L,C,"defaultAlignment"),this.Rq=a=a.ba(),this.ja(),this.j("defaultAlignment",b,a))});t.g(C,"defaultStretch",C.prototype.mA);t.defineProperty(C,{mA:"defaultStretch"},function(){return this.Ac},function(a){var b=this.Ac;b!==a&&(t.Fa(a,V,C,"defaultStretch"),this.Ac=a,this.ja(),this.j("defaultStretch",b,a))});t.g(C,"defaultSeparatorPadding",C.prototype.KI);
t.defineProperty(C,{KI:"defaultSeparatorPadding"},function(){return void 0===this.Gj?K.tq:this.Gj},function(a){if(void 0!==this.Gj){"number"===typeof a?a=new wb(a):e&&t.l(a,wb,C,"defaultSeparatorPadding");var b=this.Gj;b.O(a)||(this.Gj=a=a.ba(),this.j("defaultSeparatorPadding",b,a))}});t.g(C,"defaultRowSeparatorStroke",C.prototype.II);
t.defineProperty(C,{II:"defaultRowSeparatorStroke"},function(){return void 0===this.Fi?null:this.Fi},function(a){var b=this.Fi;b!==a&&(null===a||"string"===typeof a||a instanceof qa)&&(a instanceof qa&&a.freeze(),this.Fi=a,this.j("defaultRowSeparatorStroke",b,a))});t.g(C,"defaultRowSeparatorStrokeWidth",C.prototype.JI);
t.defineProperty(C,{JI:"defaultRowSeparatorStrokeWidth"},function(){return void 0===this.Jh?1:this.Jh},function(a){if(void 0!==this.Jh){var b=this.Jh;b!==a&&(this.Jh=a,this.j("defaultRowSeparatorStrokeWidth",b,a))}});t.g(C,"defaultRowSeparatorDashArray",C.prototype.HI);
t.defineProperty(C,{HI:"defaultRowSeparatorDashArray"},function(){return void 0===this.am?null:this.am},function(a){if(void 0!==this.am){var b=this.am;b!==a&&(Array.isArray(a)||t.jc(a,"Array",C,"defaultRowSeparatorDashArray:val"),this.am=a,this.j("defaultRowSeparatorDashArray",b,a))}});t.g(C,"defaultColumnSeparatorStroke",C.prototype.CI);
t.defineProperty(C,{CI:"defaultColumnSeparatorStroke"},function(){return void 0===this.Hh?null:this.Hh},function(a){if(void 0!==this.Hh){var b=this.Hh;b!==a&&(null===a||"string"===typeof a||a instanceof qa)&&(a instanceof qa&&a.freeze(),this.Hh=a,this.j("defaultColumnSeparatorStroke",b,a))}});t.g(C,"defaultColumnSeparatorStrokeWidth",C.prototype.DI);
t.defineProperty(C,{DI:"defaultColumnSeparatorStrokeWidth"},function(){return void 0===this.Ih?1:this.Ih},function(a){if(void 0!==this.Ih){var b=this.Ih;b!==a&&(this.Ih=a,this.j("defaultColumnSeparatorStrokeWidth",b,a))}});t.g(C,"defaultColumnSeparatorDashArray",C.prototype.BI);
t.defineProperty(C,{BI:"defaultColumnSeparatorDashArray"},function(){return void 0===this.$l?null:this.$l},function(a){if(void 0!==this.$l){var b=this.$l;b!==a&&(Array.isArray(a)||t.jc(a,"Array",C,"defaultColumnSeparatorDashArray:val"),this.$l=a,this.j("defaultColumnSeparatorDashArray",b,a))}});t.g(C,"viewboxStretch",C.prototype.yK);
t.defineProperty(C,{yK:"viewboxStretch"},function(){return this.Vo},function(a){var b=this.Vo;b!==a&&(t.Fa(a,V,C,"viewboxStretch"),this.Vo=a,this.j("viewboxStretch",b,a))});t.g(C,"gridCellSize",C.prototype.vt);
t.defineProperty(C,{vt:"gridCellSize"},function(){return this.fr},function(a){var b=this.fr;b.O(a)||(t.l(a,ra,C,"gridCellSize"),a.P()&&0!==a.width&&0!==a.height||t.m("Invalid Panel.gridCellSize: "+a),this.fr=a.ba(),null!==this.h&&this===this.h.xp&&Pi(this.h),this.na(),this.j("gridCellSize",b,a))});t.g(C,"gridOrigin",C.prototype.BA);
t.defineProperty(C,{BA:"gridOrigin"},function(){return this.gr},function(a){var b=this.gr;b.O(a)||(t.l(a,E,C,"gridOrigin"),a.P()||t.m("Invalid Panel.gridOrigin: "+a),this.gr=a.ba(),this.h&&Pi(this.h),this.na(),this.j("gridOrigin",b,a))});
C.prototype.rl=function(a,b){if(this.ga===Ci){var c=this.sk()*b.scale;0>=c&&(c=1);var d=this.vt,f=d.width,d=d.height,g=this.Ja,h=g.width,g=g.height,k=Math.ceil(h/f),l=Math.ceil(g/d),m=this.BA;a.save();a.beginPath();a.rect(0,0,h,g);a.clip();for(var n=[],p=this.va.n,q=this.va.length,r=0;r<q;r++){var s=[];n.push(s);var u=p[r];if(u.visible)for(var u=lj(u.Eb),w=r+1;w<q;w++){var D=p[w];D.visible&&lj(D.Eb)===u&&(D=D.interval,2<=D&&s.push(D))}}p=this.va.length;for(q=0;q<p;q++){var A=this.va.n[q];if(A.visible){var r=
n[q],s=A.interval,u=!1,G=A.Mx;if(null!==G){var M=u=!0;void 0!==a.setLineDash?(a.setLineDash(G),a.lineDashOffset=A.qd):void 0!==a.webkitLineDash?(a.webkitLineDash=G,a.webkitLineDashOffset=A.qd):void 0!==a.mozDash?(a.mozDash=G,a.mozDashOffset=A.qd):M=!1}if("LineV"===A.Eb){a.lineWidth=A.lb;Ak(this,a,A.stroke,!1);a.beginPath();for(D=w=Math.floor(-m.x/f);D<=w+k;D++){var N=D*f+m.x;if(0<=N&&N<h&&Gl(D,s,r)&&(u&&!M?ik(a,N,0,N,g,G,A.qd):(a.moveTo(N,0),a.lineTo(N,g)),2>f*s*c))break}a.stroke()}else if("LineH"===
A.Eb){a.lineWidth=A.lb;Ak(this,a,A.stroke,!1);a.beginPath();for(D=w=Math.floor(-m.y/d);D<=w+l&&!(N=D*d+m.y,0<=N&&N<=g&&Gl(D,s,r)&&(u&&!M?ik(a,0,N,h,N,G,A.qd):(a.moveTo(0,N),a.lineTo(h,N)),2>d*s*c));D++);a.stroke()}else if("BarV"===A.Eb)for(Ak(this,a,A.fill,!0),A=A.width,isNaN(A)&&(A=f),D=w=Math.floor(-m.x/f);D<=w+k&&!(N=D*f+m.x,0<=N&&N<h&&Gl(D,s,r)&&(a.fillRect(N,0,A,g),2>f*s*c));D++);else if("BarH"===A.Eb)for(Ak(this,a,A.fill,!0),A=A.height,isNaN(A)&&(A=d),D=w=Math.floor(-m.y/d);D<=w+l&&!(N=D*d+
m.y,0<=N&&N<=g&&Gl(D,s,r)&&(a.fillRect(0,N,h,A),2>d*s*c));D++);u&&(void 0!==a.setLineDash?(a.setLineDash(t.xi),a.lineDashOffset=0):void 0!==a.webkitLineDash?(a.webkitLineDash=t.xi,a.webkitLineDashOffset=0):void 0!==a.mozDash&&(a.mozDash=null,a.mozDashOffset=0))}}a.restore();da(b,a,!1)}else{this.ga===fa&&(a.lineCap="butt",Hl(this,a,!0,this.pd,!0),Hl(this,a,!1,this.jd,!0),Il(this,a,!0,this.pd),Il(this,a,!1,this.jd),Hl(this,a,!0,this.pd,!1),Hl(this,a,!1,this.jd,!1));c=this.va.length;for(f=0;f<c;f++)this.va.n[f].$e(a,
b);e&&e.WI&&this instanceof B&&e.VI(a,b,this)}};
function Il(a,b,c,d){for(var f=d.length,g,h=a.pa,k=c?a.we(0):a.ve(0),l=0;l<f;l++)if(g=d[l],void 0!==g&&g!==k&&0!==g.lc){var m=g.Cn;isNaN(m)&&(m=c?a.Jh:a.Ih);var n=g.Bn;null===n&&(n=c?a.Fi:a.Hh);if(0!==m&&null!==n){Ak(a,b,n,!1);var n=!1,p=g.CG;if(null!==p){var q=n=!0;void 0!==b.setLineDash?(b.setLineDash(p),b.lineDashOffset=a.qd):void 0!==b.webkitLineDash?(b.webkitLineDash=p,b.webkitLineDashOffset=a.qd):void 0!==b.mozDash?(b.mozDash=p,b.mozDashOffset=a.qd):q=!1}b.beginPath();var r=g.position+m;c?r>
h.height&&(m-=r-h.height):r>h.width&&(m-=r-h.width);g=g.position+m/2;b.lineWidth=m;r=a.padding;c?(g+=r.top,m=r.left,r=h.width-r.right,n&&!q?ik(b,m,g,r,g,p,0):(b.moveTo(m,g),b.lineTo(r,g))):(g+=r.left,m=r.top,r=h.height-r.bottom,n&&!q?ik(b,g,m,g,r,p,0):(b.moveTo(g,m),b.lineTo(g,r)));b.stroke();n&&(void 0!==b.setLineDash?(b.setLineDash(t.xi),b.lineDashOffset=0):void 0!==b.webkitLineDash?(b.webkitLineDash=t.xi,b.webkitLineDashOffset=0):void 0!==b.mozDash&&(b.mozDash=null,b.mozDashOffset=0))}}}
function Hl(a,b,c,d,f){for(var g=d.length,h,k=a.pa,l=0;l<g;l++)if(h=d[l],void 0!==h&&null!==h.background&&h.Hw!==f&&0!==h.lc){var m=c?k.height:k.width;if(!(h.position>m)){var n=Jl(h),p=h.Cn;isNaN(p)&&(p=c?a.Jh:a.Ih);var q=h.Bn;null===q&&(q=c?a.Fi:a.Hh);null===q&&(p=0);n-=p;p=h.position+p;n+=h.lc;p+n>m&&(n=m-p);0>=n||(m=a.padding,Ak(a,b,h.background,!0),c?b.fillRect(m.left,p+m.top,k.width-(m.left+m.right),n):b.fillRect(p+m.left,m.top,n,k.height-(m.top+m.bottom)))}}}
function Gl(a,b,c){if(0!==a%b)return!1;b=c.length;for(var d=0;d<b;d++)if(0===a%c[d])return!1;return!0}function lj(a){return"LineV"===a||"BarV"===a}
C.prototype.wp=function(a,b,c,d,f){var g=this.Kf(),h=this.transform,k=1/(h.m11*h.m22-h.m12*h.m21),l=h.m22*k,m=-h.m12*k,n=-h.m21*k,p=h.m11*k,q=k*(h.m21*h.dy-h.m22*h.dx),r=k*(h.m12*h.dx-h.m11*h.dy);if(null!==this.hk)return h=this.pa,K.yl(h.left,h.top,h.right,h.bottom,a,b,c,d,f);if(null!==this.background)g=a*l+b*n+q,k=a*m+b*p+r,a=c*l+d*n+q,c=c*m+d*p+r,f.p(0,0),d=this.Ja,c=K.yl(0,0,d.width,d.height,g,k,a,c,f),f.transform(h);else{g||(l=1,n=m=0,p=1,r=q=0);k=a*l+b*n+q;a=a*m+b*p+r;l=c*l+d*n+q;d=c*m+d*p+r;
f.p(l,d);m=(l-k)*(l-k)+(d-a)*(d-a);c=!1;p=this.va.n;r=p.length;n=t.N();for(q=0;q<r;q++)b=p[q],b.visible&&b.wp(k,a,l,d,n)&&(c=!0,b=(k-n.x)*(k-n.x)+(a-n.y)*(a-n.y),b<m&&(m=b,f.set(n)));t.B(n);g&&f.transform(h)}return c};
C.prototype.Kt=function(a,b,c,d){var f=this.bj;f.width=0;f.height=0;var g=this.Ea,h=this.Yf;void 0===c&&(c=h.width,d=h.height);c=Math.max(c,h.width);d=Math.max(d,h.height);var k=this.Oe;isNaN(g.width)||(a=Math.min(g.width,k.width));isNaN(g.height)||(b=Math.min(g.height,k.height));a=Math.max(c,a);b=Math.max(d,b);var l=this.padding;a=Math.max(a-l.left-l.right,0);b=Math.max(b-l.top-l.bottom,0);var m=this.va,n=m.length;if(0!==n){var p=this.ga.ec;switch(p){case "Position":var q=a,r=b,s=c,u=d;f.x=0;f.y=
0;f.width=0;for(var w=f.height=0;w<n;w++){var D=m.n[w];if(D.visible||D===this.Zb){var A=D.margin,G=A.right+A.left,M=A.top+A.bottom;xh(D,q,r,s,u);var N=D.Ha,O=Math.max(N.width+G,0),U=Math.max(N.height+M,0),Y=D.position.x,ba=D.position.y;isFinite(Y)||(Y=0);isFinite(ba)||(ba=0);if(D instanceof W&&D.JA)var R=D.lb/2,Y=Y-R,ba=ba-R;Fb(f,Y,ba,O,U)}}break;case "Vertical":for(var ya=a,Ya=c,Aa=t.Hb(),Na=0;Na<n;Na++){var va=m.n[Na];if(va.visible||va===this.Zb){var Pa=nk(va);if(Pa!==bh&&Pa!==ek)Aa.push(va);else{var Ga=
va.margin,Jf=Ga.right+Ga.left,mf=Ga.top+Ga.bottom;xh(va,ya,Infinity,Ya,0);var Zb=va.Ha,hg=Math.max(Zb.width+Jf,0),ic=Math.max(Zb.height+mf,0);f.width=Math.max(f.width,hg);f.height+=ic}}}var jb=Aa.length;if(0!==jb){this.Ea.width?ya=Math.min(this.Ea.width,this.Oe.width):0!==f.width&&(ya=Math.min(f.width,this.Oe.width));for(Na=0;Na<jb;Na++)if(va=Aa[Na],va.visible||va===this.Zb)Ga=va.margin,Jf=Ga.right+Ga.left,mf=Ga.top+Ga.bottom,xh(va,ya,Infinity,Ya,0),Zb=va.Ha,hg=Math.max(Zb.width+Jf,0),ic=Math.max(Zb.height+
mf,0),f.width=Math.max(f.width,hg),f.height+=ic;t.Ca(Aa)}break;case "Horizontal":for(var fb=b,Ia=d,Ja=t.Hb(),Xa=0;Xa<n;Xa++){var db=m.n[Xa];if(db.visible||db===this.Zb){var Ab=nk(db);if(Ab!==bh&&Ab!==fk)Ja.push(db);else{var nd=db.margin,nf=nd.right+nd.left,Dd=nd.top+nd.bottom;xh(db,Infinity,fb,0,Ia);var od=db.Ha,Ne=Math.max(od.width+nf,0),Ed=Math.max(od.height+Dd,0);f.width+=Ne;f.height=Math.max(f.height,Ed)}}}var te=Ja.length;if(0!==te){this.Ea.height?fb=Math.min(this.Ea.height,this.Oe.height):0!==
f.height&&(fb=Math.min(f.height,this.Oe.height));for(Xa=0;Xa<te;Xa++)if(db=Ja[Xa],db.visible||db===this.Zb)nd=db.margin,nf=nd.right+nd.left,Dd=nd.top+nd.bottom,xh(db,Infinity,fb,0,Ia),od=db.Ha,Ne=Math.max(od.width+nf,0),Ed=Math.max(od.height+Dd,0),f.width+=Ne,f.height=Math.max(f.height,Ed);t.Ca(Ja)}break;case "Spot":a:{var Kf=a,Bb=b,Cg=c,Hb=d,qb=Hk(this,m,n),Za=qb.margin,yb,jc,Lf=Za.right+Za.left,Mf=Za.top+Za.bottom;xh(qb,Kf,Bb,Cg,Hb);var kc=qb.Ha,Vc=kc.width,pd=kc.height,dc=Math.max(Vc+Lf,0),qd=
Math.max(pd+Mf,0);f.x=-Za.left;f.y=-Za.top;f.width=dc;f.height=qd;for(var $a=0;$a<n;$a++){var Ta=m.n[$a];if(Ta!==qb&&(Ta.visible||Ta===this.Zb)){Za=Ta.margin;yb=Za.right+Za.left;jc=Za.top+Za.bottom;xh(Ta,Kf,Bb,0,0);var kc=Ta.Ha,dc=Math.max(kc.width+yb,0),qd=Math.max(kc.height+jc,0),Qb=Ta.alignment;Qb.Tc()&&(Qb=this.lk);Qb.Cd()||(Qb=Yb);var Ib=Ta.ek;Ib.Tc()&&(Ib=Yb);Fb(f,Qb.x*Vc+Qb.offsetX-(Ib.x*kc.width-Ib.offsetX)-Za.left,Qb.y*pd+Qb.offsetY-(Ib.y*kc.height-Ib.offsetY)-Za.top,dc,qd)}}var Oe=qb.ui;
Oe===ch&&(Oe=nk(qb));switch(Oe){case bh:break a;case Sc:if(!isFinite(Kf)&&!isFinite(Bb))break a;break;case fk:if(!isFinite(Kf))break a;break;case ek:if(!isFinite(Bb))break a}kc=qb.Ha;Vc=kc.width;pd=kc.height;dc=Math.max(Vc+Lf,0);qd=Math.max(pd+Mf,0);Za=qb.margin;f.x=-Za.left;f.y=-Za.top;f.width=dc;f.height=qd;for($a=0;$a<n;$a++)Ta=m.n[$a],Ta===qb||!Ta.visible&&Ta!==this.Zb||(Za=Ta.margin,yb=Za.right+Za.left,jc=Za.top+Za.bottom,kc=Ta.Ha,dc=Math.max(kc.width+yb,0),qd=Math.max(kc.height+jc,0),Qb=Ta.alignment,
Qb.Tc()&&(Qb=this.lk),Qb.Cd()||(Qb=Yb),Ib=Ta.ek,Ib.Tc()&&(Ib=Yb),Fb(f,Qb.x*Vc+Qb.offsetX-(Ib.x*kc.width-Ib.offsetX)-Za.left,Qb.y*pd+Qb.offsetY-(Ib.y*kc.height-Ib.offsetY)-Za.top,dc,qd))}break;case "Auto":var Pd=a,oc=b,Jb=c,ee=d,rb=Hk(this,m,n),Fd=rb.margin,Dg=Fd.right+Fd.left,Pe=Fd.top+Fd.bottom;xh(rb,Pd,oc,Jb,ee);var Gd=rb.Ha,gb=Math.max(Gd.width+Dg,0),of=Math.max(Gd.height+Pe,0),hb=Kl(rb),sb=hb.x*gb+hb.offsetX,Wc=hb.y*of+hb.offsetY,hb=Ll(rb),Mb=hb.x*gb+hb.offsetX,Qd=hb.y*of+hb.offsetY,Rd=Pd,fe=
oc;isFinite(Pd)&&(Rd=Math.abs(sb-Mb));isFinite(oc)&&(fe=Math.abs(Wc-Qd));var Fc=t.Ml();Fc.p(0,0);for(var ue=0;ue<n;ue++){var Gc=m.n[ue];if(Gc!==rb&&(Gc.visible||Gc===this.Zb)){var Fd=Gc.margin,Cb=Fd.right+Fd.left,Qe=Fd.top+Fd.bottom;xh(Gc,Rd,fe,0,0);Gd=Gc.Ha;gb=Math.max(Gd.width+Cb,0);of=Math.max(Gd.height+Qe,0);Fc.p(Math.max(gb,Fc.width),Math.max(of,Fc.height))}}if(1===n)f.width=gb,f.height=of,t.qk(Fc);else{var rd=Kl(rb),kb=Ll(rb),Hd,Db;kb.x!==rd.x&&kb.y!==rd.y&&(Hd=Fc.width/Math.abs(kb.x-rd.x),
Db=Fc.height/Math.abs(kb.y-rd.y));t.qk(Fc);var Sd=0;rb instanceof W&&(Sd=rb.lb*rb.scale,Ml(rb)===dh&&(Hd=Math.max(Hd,Db),Db=Math.max(Hd,Db)));Hd+=Math.abs(rd.offsetX)+Math.abs(kb.offsetX)+Sd;Db+=Math.abs(rd.offsetY)+Math.abs(kb.offsetY)+Sd;var Id=rb.ui;Id===ch&&(Id=nk(rb));switch(Id){case bh:ee=Jb=0;break;case Sc:isFinite(Pd)&&(Hd=Pd);isFinite(oc)&&(Db=oc);break;case fk:isFinite(Pd)&&(Hd=Pd);ee=0;break;case ek:Jb=0,isFinite(oc)&&(Db=oc)}rb instanceof W&&!rb.Ea.P()&&(rb.lh?rb.Lk=null:rb.Ta=null);Ik(rb);
xh(rb,Hd,Db,Jb,ee);f.width=rb.Ha.width+Dg;f.height=rb.Ha.height+Pe}break;case "Table":for(var lc=a,Nb=b,tb=n,pf=c,bb=d,Jd=t.Hb(),Xc=t.Hb(),ma=0;ma<tb;ma++){var sa=m.n[ma];if(sa instanceof C&&(sa.type===wk||sa.type===xk)&&sa.visible){Xc.push(sa);for(var vj=sa.va,nh=vj.length,wc=0;wc<nh;wc++){var oh=vj.n[wc];sa.type===wk?oh.wc=sa.wc:sa.type===xk&&(oh.column=sa.column);Jd.push(oh)}}else Jd.push(sa)}for(var tb=Jd.length,ec=[],ma=0;ma<tb;ma++)sa=Jd[ma],ok(sa,!0),sk(sa,!0),ec[sa.wc]||(ec[sa.wc]=[]),ec[sa.wc][sa.column]||
(ec[sa.wc][sa.column]=[]),ec[sa.wc][sa.column].push(sa);t.Ca(Jd);for(var Eg=t.Hb(),ig=t.Hb(),Hc=t.Hb(),Ic={count:0},Jc={count:0},xc=lc,Kc=Nb,Nf=this.pd,tb=Nf.length,ma=0;ma<tb;ma++){var la=Nf[ma];void 0!==la&&Nl(la,0)}Nf=this.jd;tb=Nf.length;for(ma=0;ma<tb;ma++)la=Nf[ma],void 0!==la&&Nl(la,0);for(var ge=ec.length,Td=0,ma=0;ma<ge;ma++)ec[ma]&&(Td=Math.max(Td,ec[ma].length));for(var jg=Math.min(this.aj,ge-1),wj=Math.min(this.Mi,Td-1),Yc,ge=ec.length,ma=jg;ma<ge;ma++)if(ec[ma]){var Td=ec[ma].length,
ib=this.we(ma);Nl(ib,0);for(wc=wj;wc<Td;wc++)if(ec[ma][wc]){var mb=this.ve(wc);void 0===Eg[wc]&&(Nl(mb,0),Eg[wc]=!0);for(var hi=ec[ma][wc],wl=hi.length,kg=0;kg<wl;kg++)if(sa=hi[kg],sa.visible||sa===this.Zb){var lg=1<sa.Yj||1<sa.Fj;lg&&ig.push(sa);var Rb=sa.margin,Of=Rb.right+Rb.left,Pf=Rb.top+Rb.bottom,Ud=Kk(sa,ib,mb),he=sa.Ea,ph=!isNaN(he.width),Qf=!isNaN(he.height),Re=ph&&Qf;lg||Ud===bh||Re||(void 0===Ic[wc]&&(Ic[wc]=-1,Ic.count++),void 0===Jc[ma]&&(Jc[ma]=-1,Jc.count++),Hc.push(sa));xh(sa,Infinity,
Infinity,0,0);var ve=sa.Ha,Se=Math.max(ve.width+Of,0),Te=Math.max(ve.height+Pf,0);1!==sa.Yj||!Qf&&Ud!==bh&&Ud!==fk||(la=this.we(ma),Yc=Math.max(Te-la.lc,0),Yc>Kc&&(Yc=Kc),Nl(la,la.lc+Yc),Kc=Math.max(Kc-Yc,0));1!==sa.Fj||!ph&&Ud!==bh&&Ud!==ek||(la=this.ve(wc),Yc=Math.max(Se-la.lc,0),Yc>xc&&(Yc=xc),Nl(la,la.lc+Yc),xc=Math.max(xc-Yc,0));lg&&Ik(sa)}}}t.Ca(Eg);for(var ie=0,je=0,tb=this.Aw,ma=0;ma<tb;ma++)void 0!==this.jd[ma]&&(ie+=this.ve(ma).Ob);tb=this.Dx;for(ma=0;ma<tb;ma++)void 0!==this.pd[ma]&&(je+=
this.we(ma).Ob);for(var xc=Math.max(lc-ie,0),td=Kc=Math.max(Nb-je,0),qh=xc,tb=Hc.length,ma=0;ma<tb;ma++){var sa=Hc[ma],ib=this.we(sa.wc),mb=this.ve(sa.column),Fg=sa.Ha,Rb=sa.margin,Of=Rb.right+Rb.left,Pf=Rb.top+Rb.bottom;Ic[sa.column]=0===mb.lc?Math.max(Fg.width+Of,Ic[sa.column]):null;Jc[sa.wc]=0===ib.lc?Math.max(Fg.height+Pf,Jc[sa.wc]):null}var Vd=0,Gg=0;for(ma in Jc)"count"!==ma&&(Vd+=Jc[ma]);for(ma in Ic)"count"!==ma&&(Gg+=Ic[ma]);for(var zb=t.Ml(),ma=0;ma<tb;ma++)if(sa=Hc[ma],sa.visible||sa===
this.Zb){var ib=this.we(sa.wc),mb=this.ve(sa.column),ke;isFinite(mb.width)?ke=mb.width:(ke=isFinite(xc)&&null!==Ic[sa.column]?0===Gg?mb.lc+xc:Ic[sa.column]/Gg*qh:null!==Ic[sa.column]?xc:mb.lc||xc,ke=Math.max(0,ke-Jl(mb)));var qf;isFinite(ib.height)?qf=ib.height:(qf=isFinite(Kc)&&null!==Jc[sa.wc]?0===Vd?ib.lc+Kc:Jc[sa.wc]/Vd*td:null!==Jc[sa.wc]?Kc:ib.lc||Kc,qf=Math.max(0,qf-Jl(ib)));zb.p(Math.max(mb.si,Math.min(ke,mb.Ef)),Math.max(ib.si,Math.min(qf,ib.Ef)));Ud=Kk(sa,ib,mb);switch(Ud){case fk:zb.height=
Infinity;break;case ek:zb.width=Infinity}Rb=sa.margin;Of=Rb.right+Rb.left;Pf=Rb.top+Rb.bottom;Ik(sa);xh(sa,zb.width,zb.height,mb.si,ib.si);ve=sa.Ha;Se=Math.max(ve.width+Of,0);Te=Math.max(ve.height+Pf,0);isFinite(xc)&&(Se=Math.min(Se,zb.width));isFinite(Kc)&&(Te=Math.min(Te,zb.height));var rf;rf=ib.lc;Nl(ib,Math.max(ib.lc,Te));Yc=ib.lc-rf;Kc=Math.max(Kc-Yc,0);rf=mb.lc;Nl(mb,Math.max(mb.lc,Se));Yc=mb.lc-rf;xc=Math.max(xc-Yc,0)}t.Ca(Hc);for(var Wd=t.Ml(),tb=ig.length,ma=0;ma<tb;ma++)if(sa=ig[ma],sa.visible||
sa===this.Zb){ib=this.we(sa.wc);mb=this.ve(sa.column);zb.p(Math.max(mb.si,Math.min(lc,mb.Ef)),Math.max(ib.si,Math.min(Nb,ib.Ef)));Ud=Kk(sa,ib,mb);switch(Ud){case Sc:0!==mb.lc&&(zb.width=Math.min(zb.width,mb.lc));0!==ib.lc&&(zb.height=Math.min(zb.height,ib.lc));break;case fk:0!==mb.lc&&(zb.width=Math.min(zb.width,mb.lc));break;case ek:0!==ib.lc&&(zb.height=Math.min(zb.height,ib.lc))}isFinite(mb.width)&&(zb.width=mb.width);isFinite(ib.height)&&(zb.height=ib.height);Wd.p(0,0);for(var fc=1;fc<sa.Yj&&
!(sa.wc+fc>=this.Dx);fc++)la=this.we(sa.wc+fc),Wd.height+=Math.max(la.si,isNaN(la.Rf)?la.Ef:Math.min(la.Rf,la.Ef));for(fc=1;fc<sa.Fj&&!(sa.column+fc>=this.Aw);fc++)la=this.ve(sa.column+fc),Wd.width+=Math.max(la.si,isNaN(la.Rf)?la.Ef:Math.min(la.Rf,la.Ef));zb.width+=Wd.width;zb.height+=Wd.height;Rb=sa.margin;Of=Rb.right+Rb.left;Pf=Rb.top+Rb.bottom;xh(sa,zb.width,zb.height,pf,bb);for(var ve=sa.Ha,Se=Math.max(ve.width+Of,0),Te=Math.max(ve.height+Pf,0),Hg=0,fc=0;fc<sa.Yj;fc++)la=this.we(sa.wc+fc),Hg+=
la.total||0;if(Hg<Te)for(var Xd=Te-Hg;0<Xd;){var pc=la.Ob||0;isNaN(la.height)&&la.Ef>pc&&(Nl(la,Math.min(la.Ef,pc+Xd)),la.Ob!==pc&&(Xd-=la.Ob-pc));if(-1===la.index-1)break;la=this.we(la.index-1)}for(var Ue=0,fc=0;fc<sa.Fj;fc++)la=this.ve(sa.column+fc),Ue+=la.total||0;if(Ue<Se)for(Xd=Se-Ue;0<Xd;){pc=la.Ob||0;isNaN(la.width)&&la.Ef>pc&&(Nl(la,Math.min(la.Ef,pc+Xd)),la.Ob!==pc&&(Xd-=la.Ob-pc));if(-1===la.index-1)break;la=this.ve(la.index-1)}}t.Ca(ig);t.qk(Wd);t.qk(zb);for(var sf=0,le=0,Ud=nk(this),Ig=
this.Ea,mg=this.Oe,Lc=je=ie=0,me=0,tb=this.Aw,ma=0;ma<tb;ma++)void 0!==this.jd[ma]&&(la=this.ve(ma),isFinite(la.width)?(Lc+=la.width,Lc+=Jl(la)):Ol(la)===Pl?(Lc+=la.Ob,Lc+=Jl(la)):0!==la.Ob&&(ie+=la.Ob,ie+=Jl(la)));var sf=isFinite(Ig.width)?Math.min(Ig.width,mg.width):Ud!==bh&&isFinite(lc)?lc:ie,sf=Math.max(sf,this.Yf.width),sf=Math.max(sf-Lc,0),Kg=Math.max(sf/ie,1);isFinite(Kg)||(Kg=1);for(ma=0;ma<tb;ma++)void 0!==this.jd[ma]&&(la=this.ve(ma),isFinite(la.width)||Ol(la)===Pl||Nl(la,la.Ob*Kg),la.Pa=
f.width,0!==la.Ob&&(f.width+=la.Ob,f.width+=Jl(la)));tb=this.Dx;for(ma=0;ma<tb;ma++)void 0!==this.pd[ma]&&(la=this.we(ma),isFinite(la.height)?(me+=la.height,me+=Jl(la)):Ol(la)===Pl?(me+=la.Ob,me+=Jl(la)):0!==la.Ob&&(je+=la.Ob,je+=Jl(la)));var le=isFinite(Ig.height)?Math.min(Ig.height,mg.height):Ud!==bh&&isFinite(Nb)?Nb:je,le=Math.max(le,this.Yf.height),le=Math.max(le-me,0),Ve=Math.max(le/je,1);isFinite(Ve)||(Ve=1);for(ma=0;ma<tb;ma++)void 0!==this.pd[ma]&&(la=this.we(ma),isFinite(la.height)||Ol(la)===
Pl||Nl(la,la.Ob*Ve),la.Pa=f.height,0!==la.Ob&&(f.height+=la.Ob,f.height+=Jl(la)));tb=Xc.length;for(ma=0;ma<tb;ma++){var Zc=Xc[ma];Zc.type===wk?(ke=f.width,la=this.we(Zc.wc),qf=la.lc):(la=this.ve(Zc.column),ke=la.lc,qf=f.height);Zc.$c.p(0,0,ke,qf);ok(Zc,!1);ec[Zc.wc]||(ec[Zc.wc]=[]);ec[Zc.wc][Zc.column]||(ec[Zc.wc][Zc.column]=[]);ec[Zc.wc][Zc.column].push(Zc)}t.Ca(Xc);this.ps=ec;break;case "Viewbox":var yj=a,zj=b,Ho=c,Io=d;1<n&&t.m("Viewbox Panel cannot contain more than one GraphObject.");var ne=
m.n[0];ne.fc=1;Ik(ne);xh(ne,Infinity,Infinity,Ho,Io);var ii=ne.Ha,Aj=ne.margin,Jo=Aj.right+Aj.left,Ko=Aj.top+Aj.bottom;if(isFinite(yj)||isFinite(zj)){var Mq=ne.scale,Lo=ii.width,Mo=ii.height,No=Math.max(yj-Jo,0),Oo=Math.max(zj-Ko,0);ne.fc=this.Vo===dh?ne.fc*Math.min(No/Lo,Oo/Mo):ne.fc*Math.max(No/Lo,Oo/Mo);Mq!==ne.scale&&(ok(ne,!0),xh(ne,Infinity,Infinity,Ho,Io))}ii=ne.Ha;f.width=isFinite(yj)?yj:Math.max(ii.width+Jo,0);f.height=isFinite(zj)?zj:Math.max(ii.height+Ko,0);break;case "Link":var Bj=this instanceof
ea?this.hi:this;if(0===n){var Cj=this.nd;ub(Cj,0,0);var Yd=this.Ha;Yd.p(0,0,0,0)}else{var Dj=this.er(),We=this.Ij(),we=this.bj;we.assign(We);we.x=0;we.y=0;var rh,ji=this.ez();rh=void 0!==this.ra?this.ra:ji.count;this.hh.p(We.x,We.y);this.zi.clear();null!==Dj&&(Ql(Dj,We.width,We.height),Yd=Dj.Ha,we.yj(Yd),this.zi.add(Yd));for(var sh=t.Ah(),ki=t.N(),Rf=t.N(),xl=0;xl<n;xl++){var Sb=m.n[xl];if(Sb!==Dj)if(Sb.oi&&Sb instanceof W)Ql(Sb,We.width,We.height),Yd=Sb.Ha,we.yj(Yd),this.zi.add(Yd);else if(2>rh)xh(Sb,
Infinity,Infinity),Yd=Sb.Ha,we.yj(Yd),this.zi.add(Yd);else{var Sf=Sb.Gf,Qo=Sb.bu,yl=Sb.ek;yl.Me()&&(yl=Yb);var li=Sb.cu,Nq=Sb.sB,mi,ni,Ej=0;if(Sf<-rh||Sf>=rh){var Ro=Bj.YF,oi=Bj.XF;li!==Og&&(Ej=Bj.computeAngle(Sb,li,oi),Sb.angle=Ej);mi=Ro.x-We.x;ni=Ro.y-We.y}else{var tf,th;if(0<=Sf)tf=ji.n[Sf],th=Sf<rh-1?ji.n[Sf+1]:tf;else{var zl=rh+Sf;tf=ji.n[zl];th=0<zl?ji.n[zl-1]:tf}oi=0<=Sf?tf.mj(th):th.mj(tf);li!==Og&&(Ej=Bj.computeAngle(Sb,li,oi),Sb.Nn=Ej);mi=tf.x+(th.x-tf.x)*Qo-We.x;ni=tf.y+(th.y-tf.y)*Qo-
We.y}xh(Sb,Infinity,Infinity);var Yd=Sb.Ha,Cj=Sb.Ja,pi=0;Sb instanceof W&&(pi=Sb.lb);var Fj=Cj.width+pi,Al=Cj.height+pi;sh.reset();sh.translate(-Yd.x,-Yd.y);sh.scale(Sb.scale,Sb.scale);sh.rotate(li===Og?Sb.angle:oi,Fj/2,Al/2);var uh=new F(0,0,Fj,Al);ki.eu(uh,yl);sh.Xa(ki);var Oq=-ki.x+pi/2,Pq=-ki.y+pi/2;Rf.assign(Nq);isNaN(Rf.x)&&(Rf.x=0<=Sf?Fj/2+3:-(Fj/2+3));isNaN(Rf.y)&&(Rf.y=-(Al/2+3));Rf.rotate(oi);mi+=Rf.x;ni+=Rf.y;uh.set(Yd);uh.x=mi+Oq;uh.y=ni+Pq;this.zi.add(uh);we.yj(uh)}}if(this.Ce)for(var So=
this.sj;So.next();)xh(So.value,Infinity,Infinity);this.bj=we;var Gj=this.hh;Gj&&Gj.p(Gj.x+we.x,Gj.y+we.y);ub(f,we.width||0,we.height||0);t.bf(sh);t.B(ki);t.B(Rf)}break;case "Grid":break;case "TableRow":case "TableColumn":t.m(this.toString()+" is not an element of a Table Panel. TableRow and TableColumn Panels can only be elements of a Table Panel.");break;default:t.m("Unknown panel type: "+p)}}var xe=f.width,ye=f.height,Hj=this.padding,Qq=Hj.top+Hj.bottom,xe=xe+(Hj.left+Hj.right),ye=ye+Qq;isFinite(g.width)&&
(xe=g.width);isFinite(g.height)&&(ye=g.height);xe=Math.min(k.width,xe);ye=Math.min(k.height,ye);xe=Math.max(h.width,xe);ye=Math.max(h.height,ye);xe=Math.max(c,xe);ye=Math.max(d,ye);f.width=xe;f.height=ye;ub(this.nd,xe,ye);kk(this,0,0,xe,ye)};C.prototype.findMainElement=C.prototype.Rw=function(){null===this.To&&Hk(this,this.va,this.va.length);return this.To};function Hk(a,b,c){for(var d=0;d<c;d++){var f=b.n[d];if(!0===f.oi)return a.To=f}b=b.n[0];return a.To=b}
C.prototype.ik=function(a,b,c,d){var f=this.bj,g=this.va,h=g.length,k=t.wk(0,0,0,0);if(0===h){var l=this.pa;l.x=a;l.y=b;l.width=c;l.height=d}else{if(!this.Ea.P()){var m=nk(this),n=this.$c,p=n.width,q=n.height,r=this.margin,s=r.left+r.right,u=r.top+r.bottom;p===c&&q===d&&(m=bh);switch(m){case bh:if(p>c||q>d)this.ja(),xh(this,p>c?c:p,q>d?d:q);break;case Sc:ok(this,!0);xh(this,c+s,d+u,0,0);break;case fk:ok(this,!0);xh(this,c+s,q+u,0,0);break;case ek:ok(this,!0),xh(this,p+s,d+u,0,0)}}l=this.pa;l.x=a;
l.y=b;l.width=c;l.height=d;var w=this.ga.ec;switch(w){case "Position":for(var D=f.x-this.padding.left,A=f.y-this.padding.top,G=0;G<h;G++){var M=g.n[G],N=M.Ha,O=M.margin,U=M.position.x,Y=M.position.y;k.x=isNaN(U)?-D:U-D;k.y=isNaN(Y)?-A:Y-A;if(M instanceof W&&M.JA){var ba=M.lb/2;k.x-=ba;k.y-=ba}k.x+=O.left;k.y+=O.top;k.width=N.width;k.height=N.height;M.visible&&M.Pc(k.x,k.y,k.width,k.height)}break;case "Vertical":for(var R=this.padding.left,ya=this.padding.top,Ya=0;Ya<h;Ya++){var Aa=R,Na=g.n[Ya];if(Na.visible){var va=
Na.Ha,Pa=Na.margin,Ga=Pa.left+Pa.right,Jf=R+this.padding.right,mf=va.width,Zb=nk(Na);if(isNaN(Na.Ea.width)&&Zb===Sc||Zb===fk)mf=Math.max(f.width-Ga-Jf,0);var hg=mf+Ga+Jf,ic=Na.alignment;ic.Tc()&&(ic=this.lk);ic.Cd()||(ic=Yb);Na.Pc(Aa+ic.offsetX+Pa.left+(f.width*ic.x-hg*ic.x),ya+ic.offsetY+Pa.top,mf,va.height);ya+=va.height+Pa.bottom+Pa.top}}break;case "Horizontal":for(var jb=this.padding.top,fb=this.padding.left,Ia=0;Ia<h;Ia++){var Ja=jb,Xa=g.n[Ia];if(Xa.visible){var db=Xa.Ha,Ab=Xa.margin,nd=Ab.top+
Ab.bottom,nf=jb+this.padding.bottom,Dd=db.height,od=nk(Xa);if(isNaN(Xa.Ea.height)&&od===Sc||od===ek)Dd=Math.max(f.height-nd-nf,0);var Ne=Dd+nd+nf,Ed=Xa.alignment;Ed.Tc()&&(Ed=this.lk);Ed.Cd()||(Ed=Yb);Xa.Pc(fb+Ed.offsetX+Ab.left,Ja+Ed.offsetY+Ab.top+(f.height*Ed.y-Ne*Ed.y),db.width,Dd);fb+=db.width+Ab.left+Ab.right}}break;case "Spot":var te=Hk(this,g,h),Kf=te.Ha,Bb=Kf.width,Cg=Kf.height,Hb=this.padding,qb=Hb.left,Za=Hb.top;k.x=qb-f.x;k.y=Za-f.y;te.Pc(k.x,k.y,Bb,Cg);for(var yb=0;yb<h;yb++){var jc=
g.n[yb];if(jc!==te){var Lf=jc.Ha,Mf=Lf.width,kc=Lf.height,Vc=jc.alignment;Vc.Tc()&&(Vc=this.lk);Vc.Cd()||(Vc=Yb);var pd=jc.ek;pd.Tc()&&(pd=Yb);k.x=Vc.x*Bb+Vc.offsetX-(pd.x*Mf-pd.offsetX);k.y=Vc.y*Cg+Vc.offsetY-(pd.y*kc-pd.offsetY);k.x-=f.x;k.y-=f.y;jc.visible&&jc.Pc(qb+k.x,Za+k.y,Mf,kc)}}break;case "Auto":var dc=Hk(this,g,h),qd=dc.Ha,$a=t.Jf();$a.p(0,0,1,1);var Ta=dc.margin,Qb=Ta.left,Ib=Ta.top,Oe=this.padding,Pd=Oe.left,oc=Oe.top;k.x=Qb;k.y=Ib;k.width=qd.width;k.height=qd.height;dc.Pc(Pd+k.x,oc+
k.y,k.width,k.height);var Jb=Kl(dc),ee=Ll(dc),rb=0+Jb.y*qd.height+Jb.offsetY,Fd=0+ee.x*qd.width+ee.offsetX,Dg=0+ee.y*qd.height+ee.offsetY;$a.x=0+Jb.x*qd.width+Jb.offsetX;$a.y=rb;Fb($a,Fd,Dg,0,0);$a.x+=Qb+Pd;$a.y+=Ib+oc;for(var Pe=0;Pe<h;Pe++){var Gd=g.n[Pe];if(Gd!==dc){var gb=Gd.Ha,Ta=Gd.margin,of=Math.max(gb.width+Ta.right+Ta.left,0),hb=Math.max(gb.height+Ta.top+Ta.bottom,0),sb=Gd.alignment;sb.Tc()&&(sb=this.lk);sb.Cd()||(sb=Yb);k.x=$a.width*sb.x+sb.offsetX-of*sb.x+Ta.left+$a.x;k.y=$a.height*sb.y+
sb.offsetY-hb*sb.y+Ta.top+$a.y;k.width=$a.width;k.height=$a.height;Gd.visible&&(Gb($a.x,$a.y,$a.width,$a.height,k.x,k.y,gb.width,gb.height)?Gd.Pc(k.x,k.y,gb.width,gb.height):Gd.Pc(k.x,k.y,gb.width,gb.height,new F($a.x,$a.y,$a.width,$a.height)))}}t.oc($a);break;case "Table":for(var Wc=this.padding,Mb=Wc.left,Qd=Wc.top,Rd=this.ps,fe,Fc,ue=Rd.length,Gc=0,Cb=0;Cb<ue;Cb++)Rd[Cb]&&(Gc=Math.max(Gc,Rd[Cb].length));for(var Qe=Math.min(this.aj,ue-1);Qe!==ue&&(void 0===this.pd[Qe]||0===this.pd[Qe].Ob);)Qe++;
for(var Qe=Math.min(Qe,ue-1),rd=-this.pd[Qe].Pa,kb=Math.min(this.Mi,Gc-1);kb!==Gc&&(void 0===this.jd[kb]||0===this.jd[kb].Ob);)kb++;for(var kb=Math.min(kb,Gc-1),Hd=-this.jd[kb].Pa,Db=t.Ml(),Cb=0;Cb<ue;Cb++)if(Rd[Cb]){var Gc=Rd[Cb].length,Sd=this.we(Cb);Fc=Sd.Pa+rd+Qd+Rl(Sd);for(var Id=0;Id<Gc;Id++)if(Rd[Cb][Id]){var lc=this.ve(Id);fe=lc.Pa+Hd+Mb+Rl(lc);for(var Nb=Rd[Cb][Id],tb=Nb.length,pf=0;pf<tb;pf++){var bb=Nb[pf],Jd=bb.Ha;if(bb instanceof C&&(bb.type===wk||bb.type===xk)){pk(bb);bb.Pb.Ra();var Xc=
bb.Pb;Xc.x=bb.type===wk?Mb:fe;Xc.y=bb.type===xk?Qd:Fc;Xc.width=Jd.width;Xc.height=Jd.height;bb.Pb.freeze();sk(bb,!1)}else{Db.p(0,0);for(var ma=1;ma<bb.rowSpan&&!(Cb+ma>=this.Dx);ma++){var sa=this.we(Cb+ma);Db.height+=sa.total}for(ma=1;ma<bb.yE&&!(Id+ma>=this.Aw);ma++){var vj=this.ve(Id+ma);Db.width+=vj.total}var nh=lc.Ob+Db.width,wc=Sd.Ob+Db.height;k.x=fe;k.y=Fc;k.width=nh;k.height=wc;var oh=fe,ec=Fc,Eg=nh,ig=wc;fe+nh>f.width&&(Eg=Math.max(f.width-fe,0));Fc+wc>f.height&&(ig=Math.max(f.height-Fc,0));
var Hc=bb.alignment,Ic,Jc,xc,Kc;if(Hc.Tc()){Hc=this.lk;Hc.Cd()||(Hc=Yb);Ic=Hc.x;Jc=Hc.y;xc=Hc.offsetX;Kc=Hc.offsetY;var Nf=lc.alignment,la=Sd.alignment;Nf.Cd()&&(Ic=Nf.x,xc=Nf.offsetX);la.Cd()&&(Jc=la.y,Kc=la.offsetY)}else Ic=Hc.x,Jc=Hc.y,xc=Hc.offsetX,Kc=Hc.offsetY;if(isNaN(Ic)||isNaN(Jc))Jc=Ic=0.5,Kc=xc=0;var ge=Jd.width,Td=Jd.height,jg=bb.margin,wj=jg.left+jg.right,Yc=jg.top+jg.bottom,ib=Kk(bb,Sd,lc);!isNaN(bb.Ea.width)||ib!==Sc&&ib!==fk||(ge=Math.max(nh-wj,0));!isNaN(bb.Ea.height)||ib!==Sc&&ib!==
ek||(Td=Math.max(wc-Yc,0));var mb=bb.Oe,hi=bb.Yf,ge=Math.min(mb.width,ge),Td=Math.min(mb.height,Td),ge=Math.max(hi.width,ge),Td=Math.max(hi.height,Td),wl=Td+Yc;k.x+=k.width*Ic-(ge+wj)*Ic+xc+jg.left;k.y+=k.height*Jc-wl*Jc+Kc+jg.top;bb.visible&&(Gb(oh,ec,Eg,ig,k.x,k.y,Jd.width,Jd.height)?bb.Pc(k.x,k.y,ge,Td):bb.Pc(k.x,k.y,ge,Td,new F(oh,ec,Eg,ig)))}}}}t.qk(Db);for(Cb=0;Cb<h;Cb++)bb=g.n[Cb],bb instanceof C&&(bb.type===wk||bb.type===xk)&&(Xc=bb.Pb,bb.nd.Ra(),bb.nd.eq(0,0,Xc.width,Xc.height),bb.nd.freeze());
break;case "Viewbox":var kg=g.n[0],lg=kg.Ha,Rb=kg.margin,Of=Rb.top+Rb.bottom,Pf=Math.max(lg.width+(Rb.right+Rb.left),0),Ud=Math.max(lg.height+Of,0),he=kg.alignment;he.Tc()&&(he=this.lk);he.Cd()||(he=Yb);k.x=f.width*he.x-Pf*he.x+he.offsetX;k.y=f.height*he.y-Ud*he.y+he.offsetY;k.width=lg.width;k.height=lg.height;kg.Pc(k.x,k.y,k.width,k.height);break;case "Link":var ph=this.er(),Qf=0;if(null!==ph&&Qf<this.zi.count){var Re=this.zi.n[Qf];Qf++;ph.Pc(Re.x-this.bj.x,Re.y-this.bj.y,Re.width,Re.height)}for(var ve=
0;ve<h;ve++){var Se=g.n[ve];Se!==ph&&Qf<this.zi.count&&(Re=this.zi.n[Qf],Qf++,Se.Pc(Re.x-this.bj.x,Re.y-this.bj.y,Re.width,Re.height))}var Te=this.ez(),ie=Te.count;if(2<=ie&&this.Ce)for(var je=this.sj;je.next();){var td=je.value,qh=ie,Fg=Te,Vd=td.Gf,Gg=td.bu,zb=td.ek;zb.Me()&&(zb=Yb);var ke=td.cu,qf=td.sB,rf=void 0,Wd=void 0,fc=0;if(Vd<-qh||Vd>=qh){var Hg=this.YF,Xd=this.XF;ke!==Og&&(fc=this.computeAngle(td,ke,Xd),td.angle=fc);rf=Hg.x;Wd=Hg.y}else{var pc=void 0,Ue=void 0;if(0<=Vd)pc=Fg.n[Vd],Ue=Vd<
qh-1?Fg.n[Vd+1]:pc;else var sf=qh+Vd,pc=Fg.n[sf],Ue=0<sf?Fg.n[sf-1]:pc;Xd=0<=Vd?pc.mj(Ue):Ue.mj(pc);ke!==Og&&(fc=this.computeAngle(td,ke,Xd),td.angle=fc);rf=pc.x+(Ue.x-pc.x)*Gg;Wd=pc.y+(Ue.y-pc.y)*Gg}var le=t.Ah();le.reset();le.scale(td.scale,td.scale);le.rotate(td.angle,0,0);var Ig=td.Ja,mg=t.wk(0,0,Ig.width,Ig.height),Lc=t.N();Lc.eu(mg,zb);le.Xa(Lc);var me=-Lc.x,Kg=-Lc.y,Ve=qf.copy();isNaN(Ve.x)&&(Ve.x=0<=Vd?Lc.x+3:-(Lc.x+3));isNaN(Ve.y)&&(Ve.y=-(Lc.y+3));Ve.rotate(Xd);rf+=Ve.x;Wd+=Ve.y;le.ZG(mg);
var me=me+mg.x,Kg=Kg+mg.y,Zc=t.qc(rf+me,Wd+Kg);td.move(Zc);t.B(Zc);t.B(Lc);t.oc(mg);t.bf(le)}this.sx();break;case "Grid":break;case "TableRow":case "TableColumn":t.m(this.toString()+" is not an element of a Table Panel.TableRow and TableColumn panels can only be elements of a Table Panel.");break;default:t.m("Unknown panel type: "+w)}t.oc(k)}};
C.prototype.jk=function(a){var b=this.Ja;if(Gb(0,0,b.width,b.height,a.x,a.y)){for(var c=this.va.length,b=t.qc(0,0);c--;){var d=this.va.n[0];if(d.visible||d===this.Zb)if(lb(b.set(a),d.transform),d.La(b))return t.B(b),!0}t.B(b);return null===this.Qb&&null===this.zc?!1:!0}return!1};function Sl(a,b,c){c(a,b);if(b instanceof C){b=b.va.n;for(var d=b.length,f=0;f<d;f++)Sl(a,b[f],c)}}function ej(a,b){Tl(a,a,b)}
function Tl(a,b,c){c(b);b=b.va.n;for(var d=b.length,f=0;f<d;f++){var g=b[f];g instanceof C&&Tl(a,g,c)}}C.prototype.walkVisualTree=function(a){Ul(this,this,a)};function Ul(a,b,c){c(b);if(b instanceof C){b=b.va.n;for(var d=b.length,f=0;f<d;f++)Ul(a,b[f],c)}}C.prototype.findInVisualTree=C.prototype.qt=function(a){return Vl(this,this,a)};function Vl(a,b,c){if(c(b))return b;if(b instanceof C){b=b.va.n;for(var d=b.length,f=0;f<d;f++){var g=Vl(a,b[f],c);if(null!==g)return g}}return null}
C.prototype.findObject=C.prototype.ue=function(a){if(this.name===a)return this;for(var b=this.va.n,c=b.length,d=0;d<c;d++){var f=b[d];if(f.name===a)return f;if(f instanceof C)if(null===f.Li&&null===f.ng){if(f=f.ue(a),null!==f)return f}else if(Wl(f)&&(f=f.va.gb(),null!==f&&(f=f.ue(a),null!==f)))return f}return null};
function Xl(a){a=a.va.n;for(var b=a.length,c=0,d=0;d<b;d++){var f=a[d];if(f instanceof C)c=Math.max(c,Xl(f));else if(f instanceof W){a:{if(!f.lh)switch(f.io){case "None":case "Square":case "Ellipse":case "Circle":case "LineH":case "LineV":case "FramedRectangle":case "RoundedRectangle":case "Line1":case "Line2":case "Border":case "Cube1":case "Cube2":case "Junction":case "Cylinder1":case "Cylinder2":case "Cylinder3":case "Cylinder4":case "PlusLine":case "XLine":case "ThinCross":case "ThickCross":f=0;
break a}f=f.qe/2*f.Km*f.sk()}c=Math.max(c,f)}}return c}aa=C.prototype;aa.Kf=function(){return!(this.type===wk||this.type===xk)};
aa.de=function(a,b,c){if(!1===this.kf)return null;void 0===b&&(b=null);void 0===c&&(c=null);if(Vi(this))return null;var d=this.Ja,f=1/this.sk(),g=this.Kf(),h=g?a:lb(t.qc(a.x,a.y),this.transform);if(Gb(-(5*f),-(5*f),d.width+10*f,d.height+10*f,h.x,h.y)){if(!this.bh){for(var k=this.va.length,f=t.N();k--;){var l=this.va.n[k];if(l.visible||l===this.Zb){l.Kf()?lb(f.set(a),l.transform):f.set(a);var m=null;l instanceof C?m=l.de(f,b,c):!0===l.kf&&l.La(f)&&(m=l);if(null!==m&&(null!==b&&(m=b(m)),m&&(null===
c||c(m))))return t.B(f),g||t.B(h),m}}t.B(f)}if(null===this.background&&null===this.hk)return g||t.B(h),null;a=Gb(0,0,d.width,d.height,h.x,h.y)?this:null;g||t.B(h);return a}g||t.B(h);return null};
aa.op=function(a,b,c,d){if(!1===this.kf)return!1;void 0===b&&(b=null);void 0===c&&(c=null);d instanceof H||d instanceof I||(d=new H(V));var f=this.Ja,g=this.Kf(),h=g?a:lb(t.qc(a.x,a.y),this.transform);if(Gb(0,0,f.width,f.height,h.x,h.y)){if(!this.bh){for(var k=this.va.length,f=t.N();k--;){var l=this.va.n[k];if(l.visible||l===this.Zb)l.Kf()?lb(f.set(a),l.transform):f.set(a),(l instanceof C?l.op(f,b,c,d):l.La(f))&&!1!==l.kf&&(null!==b&&(l=b(l)),l&&(null===c||c(l))&&d.add(l))}t.B(f)}g||t.B(h);return null!==
this.background||null!==this.hk}g||t.B(h);return!1};
aa.pk=function(a,b,c,d,f,g){if(!1===this.kf)return!1;void 0===b&&(b=null);void 0===c&&(c=null);var h=g;void 0===g&&(h=t.Ah(),h.reset());h.multiply(this.transform);if(this.Ym(a,h))return Yl(this,b,c,f),void 0===g&&t.bf(h),!0;if(this.Xf(a,h)){if(!this.bh)for(var k=this.va.length;k--;){var l=this.va.n[k];if(l.visible||l===this.Zb){var m=l.pa,n=this.Ja;if(!(m.x>n.width||m.y>n.height||0>m.x+m.width||0>m.y+m.height)){m=t.Ah();m.set(h);if(l instanceof C?l.pk(a,b,c,d,f,m):mk(l,a,d,m))null!==b&&(l=b(l)),l&&
(null===c||c(l))&&f.add(l);t.bf(m)}}}void 0===g&&t.bf(h);return d}void 0===g&&t.bf(h);return!1};function Yl(a,b,c,d){for(var f=a.va.length;f--;){var g=a.va.n[f];if(g.visible){var h=g.pa,k=a.Ja;h.x>k.width||h.y>k.height||0>h.x+h.width||0>h.y+h.height||(g instanceof C&&Yl(g,b,c,d),null!==b&&(g=b(g)),g&&(null===c||c(g))&&d.add(g))}}}
aa.fn=function(a,b,c,d,f,g){if(!1===this.kf)return!1;void 0===c&&(c=null);void 0===d&&(d=null);var h=this.Ja,k=this.Kf(),l=k?a:lb(t.qc(a.x,a.y),this.transform),m=k?b:lb(t.qc(b.x,b.y),this.transform),n=l.nk(m),p=0<l.x&&l.x<h.width&&0<l.y&&l.y<h.height||nb(l.x,l.y,0,0,0,h.height)<n||nb(l.x,l.y,0,h.height,h.width,h.height)<n||nb(l.x,l.y,h.width,h.height,h.width,0)<n||nb(l.x,l.y,h.width,0,0,0)<n,h=0<l.x&&l.x<h.width&&0<l.y&&l.y<h.height&&nb(l.x,l.y,0,0,0,h.height)<n&&nb(l.x,l.y,0,h.height,h.width,h.height)<
n&&nb(l.x,l.y,h.width,h.height,h.width,0)<n&&nb(l.x,l.y,h.width,0,0,0)<n;k||(t.B(l),t.B(m));if(p){if(!this.bh){k=t.N();l=t.N();for(m=this.va.length;m--;)if(n=this.va.n[m],n.visible||n===this.Zb){var q=n.pa,r=this.Ja;q.x>r.width||q.y>r.height||0>q.x+q.width||0>q.y+q.height||(n.Kf()?(q=n.transform,lb(k.set(a),q),lb(l.set(b),q)):(k.set(a),l.set(b)),n instanceof C?!n.fn(k,l,c,d,f,g):!n.bF(k,l,f))||(null!==c&&(n=c(n)),n&&(null===d||d(n))&&g.add(n))}t.B(k);t.B(l)}return f?p:h}return!1};
function Kl(a){var b=a.G;if(void 0===b||b===Ub)b=null;null===b&&a instanceof W&&(a=a.Ta,null!==a&&(b=a.G));null===b&&(b=Vb);return b}function Ll(a){var b=a.H;if(void 0===b||b===Ub)b=null;null===b&&a instanceof W&&(a=a.Ta,null!==a&&(b=a.H));null===b&&(b=bc);return b}C.prototype.add=C.prototype.add=function(a){t.l(a,V,C,"add:element");this.Pd(this.va.count,a)};C.prototype.elt=C.prototype.wa=function(a){return this.va.wa(a)};
C.prototype.insertAt=C.prototype.Pd=function(a,b){b instanceof x&&t.m("Cannot add a Part to a Panel: "+b);if(this===b||this.rj(b))this===b&&t.m("Cannot make a Panel contain itself: "+this.toString()),t.m("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+b.toString());var c=b.ia;null!==c&&c!==this&&t.m("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+b.toString()+", already contained by "+c.toString()+", cannot be shared by this Panel: "+
this.toString());this.ga!==Ci||b instanceof W||t.m("Can only add Shapes to a Grid Panel, not: "+b);b.Il(this);b.zm=null;if(null!==this.Ht){var d=b.data;null!==d&&"object"===typeof d&&(null===this.mg&&(this.mg=new wa(Object,C)),this.mg.add(d,b))}var f=this.va,d=-1;if(c===this){for(var g=-1,h=f.count,k=0;k<h;k++)if(f.n[k]===b){g=k;break}if(-1!==g){if(g===a||g+1>=f.count&&a>=f.count)return;f.wd(g);d=g}else t.m("element "+b.toString()+" has panel "+c.toString()+" but is not contained by it.")}if(0>a||
a>f.count)a=f.count;f.Pd(a,b);this.ja();b.ja();null!==b.Ud?this.Qh=!0:b instanceof C&&!0===b.Qh&&(this.Qh=!0);c=this.U;null!==c&&(c.Uj=null,c.Rj=NaN,this.Qh&&c instanceof y&&(c.Qh=!0),c.Qh&&(c.Ad=null),f=this.h,null!==f&&f.ma.yb||(-1!==d&&c.ed(Nd,"elements",this,b,null,d,null),c.ed(Md,"elements",this,null,b,null,a)))};C.prototype.remove=C.prototype.remove=function(a){t.l(a,V,C,"remove:element");for(var b=this.va,c=b.count,d=-1,f=0;f<c;f++)if(b.n[f]===a){d=f;break}-1!==d&&this.cf(d)};
C.prototype.removeAt=C.prototype.wd=function(a){e&&t.q(a,C,"removeAt:idx");0<=a&&this.cf(a)};C.prototype.cf=function(a){var b=this.va,c=b.wa(a);c.zm=null;c.Il(null);if(null!==this.mg){var d=c.data;"object"===typeof d&&this.mg.remove(d)}b.wd(a);ok(this,!1);this.ja();b=this.U;null!==b&&(b.Uj=null,b.Rj=NaN,d=this.h,null!==d&&d.ma.yb||b.ed(Nd,"elements",this,c,null,a,null))};t.A(C,{Dx:"rowCount"},function(){return void 0===this.pd?0:this.pd.length});
C.prototype.getRowDefinition=C.prototype.we=function(a){if(void 0===this.pd)return null;e&&t.q(a,C,"getRowDefinition:idx");0>a&&t.ha(a,">= 0",C,"getRowDefinition:idx");a=Math.round(a);var b=this.pd;if(void 0===b[a]){var c=new Je;c.Il(this);c.hm=!0;c.Zc=a;b[a]=c}return b[a]};C.prototype.removeRowDefinition=function(a){if(void 0!==this.pd){e&&t.q(a,C,"removeRowDefinition:idx");0>a&&t.ha(a,">= 0",C,"removeRowDefinition:idx");a=Math.round(a);var b=this.pd;b[a]&&(b[a]=void 0)}};
t.A(C,{Aw:"columnCount"},function(){return void 0===this.jd?0:this.jd.length});C.prototype.getColumnDefinition=C.prototype.ve=function(a){if(void 0===this.jd)return null;e&&t.q(a,C,"getColumnDefinition:idx");0>a&&t.ha(a,">= 0",C,"getColumnDefinition:idx");a=Math.round(a);var b=this.jd;if(void 0===b[a]){var c=new Je;c.Il(this);c.hm=!1;c.Zc=a;b[a]=c}return b[a]};
C.prototype.removeColumnDefinition=function(a){if(void 0!==this.jd){e&&t.q(a,C,"removeColumnDefinition:idx");0>a&&t.ha(a,">= 0",C,"removeColumnDefinition:idx");a=Math.round(a);var b=this.jd;b[a]&&(b[a]=void 0)}};t.g(C,"rowSizing",C.prototype.wG);
t.defineProperty(C,{wG:"rowSizing"},function(){return void 0===this.Em?Fl:this.Em},function(a){if(void 0!==this.Em){var b=this.Em;b!==a&&(a!==Fl&&a!==Pl&&t.m("rowSizing must be RowColumnDefinition.ProportionalExtra or RowColumnDefinition.None"),this.Em=a,this.ja(),this.j("rowSizing",b,a))}});t.g(C,"columnSizing",C.prototype.xE);
t.defineProperty(C,{xE:"columnSizing"},function(){return void 0===this.Wl?Fl:this.Wl},function(a){if(void 0!==this.Wl){var b=this.Wl;b!==a&&(a!==Fl&&a!==Pl&&t.m("columnSizing must be RowColumnDefinition.ProportionalExtra or RowColumnDefinition.None"),this.Wl=a,this.ja(),this.j("columnSizing",b,a))}});t.g(C,"topIndex",C.prototype.IB);
t.defineProperty(C,{IB:"topIndex"},function(){return void 0===this.aj?0:this.aj},function(a){if(void 0!==this.aj){var b=this.aj;b!==a&&((!isFinite(a)||0>a)&&t.m("topIndex must be greater than zero and a real number. Was "+a),this.aj=a,this.ja(),this.j("topIndex",b,a))}});t.g(C,"leftIndex",C.prototype.OA);
t.defineProperty(C,{OA:"leftIndex"},function(){return void 0===this.Mi?0:this.Mi},function(a){if(void 0!==this.Mi){var b=this.Mi;b!==a&&((!isFinite(a)||0>a)&&t.m("leftIndex must be greater than zero and a real number. Was "+a),this.Mi=a,this.ja(),this.j("leftIndex",b,a))}});C.prototype.findRowForLocalY=function(a){if(0>a)return-1;if(this.type!==fa)return NaN;for(var b=0,c=this.pd,d=c.length,f=this.aj;f<d;f++){var g=c[f];if(void 0!==g&&(b+=g.total,a<b))return f}return-1};
C.prototype.findColumnForLocalX=function(a){if(0>a)return-1;if(this.type!==fa)return NaN;for(var b=0,c=this.jd,d=c.length,f=this.Mi;f<d;f++){var g=c[f];if(void 0!==g&&(b+=g.total,a<b))return f}return-1};t.g(C,"data",C.prototype.data);
t.defineProperty(C,{data:"data"},function(){return this.Zl},function(a){var b=this.Zl;if(b!==a){var c=this instanceof x&&!(this instanceof ea);c&&t.i(a,"object",C,"data");cf(this);this.Zl=a;var d=this.h;null!==d&&(c?this instanceof B?(null!==b&&d.Nk.remove(b),null!==a&&d.Nk.add(a,this)):(null!==b&&d.Ei.remove(b),null!==a&&d.Ei.add(a,this)):(c=this.ia,null!==c&&null!==c.mg&&(null!==b&&c.mg.remove(b),null!==a&&c.mg.add(a,this))));this.j("data",b,a);null!==d&&d.ma.yb||null!==a&&this.Vb()}});
t.g(C,"itemIndex",C.prototype.HF);t.defineProperty(C,{HF:"itemIndex"},function(){return this.vr},function(a){var b=this.vr;b!==a&&(this.vr=a,this.j("itemIndex",b,a))});function Sk(a){a=a.Ul;return null!==a&&a.tb}
function cf(a){var b=a.Ul;if(null===b)null!==a.data&&t.m("Template cannot have .data be non-null: "+a),a.Ul=b=new H(Me);else if(b.tb)return;var c=new H(V);Sl(a,a,function(a,d){var f=d.Nc;if(null!==f){Mk(d,!1);for(var g=f.k;g.next();){f=g.value;f.mode===Ye&&Mk(d,!0);var h=f.iu;if(null!==h){var q=a;""!==h&&(q=a.ue(h));null!==q&&(c.add(q),void 0===q.Fs&&(q.Fs=new H(Me)),q.Fs.add(f))}b.add(f)}}if(d instanceof C&&d.type===fa){if(0<d.pd.length)for(g=d.pd,h=g.length,q=0;q<h;q++){var r=g[q];if(void 0!==r&&
null!==r.Nc)for(var s=r.Nc.k;s.next();)f=s.value,f.vg=r,f.Kz=2,f.dw=r.index,b.add(f)}if(0<d.jd.length)for(g=d.jd,h=g.length,q=0;q<h;q++)if(r=g[q],void 0!==r&&null!==r.Nc)for(s=r.Nc.k;s.next();)f=s.value,f.vg=r,f.Kz=1,f.dw=r.index,b.add(f)}});for(var d=c.k;d.next();){var f=d.value;if(void 0!==f.Fs){Mk(f,!0);for(var g=f.Fs.k;g.next();){var h=g.value;null===f.Nc&&(f.Nc=new H(Me));f.Nc.add(h)}}delete f.Fs}for(d=b.k;d.next();)f=d.value,g=f.vg,null!==g&&(f.vg=null,g===a?f.Fn="":(g instanceof Je&&(g=g.ia),
f.Fn=""!==g.name?g.name:g.name="_"+t.ud(g)));b.freeze();a instanceof x&&a.Rd()&&(xh(a,Infinity,Infinity),a.Pc())}
C.prototype.updateTargetBindings=C.prototype.Vb=function(a){var b=this.Ul;if(null!==b)for(void 0===a&&(a=""),b=b.k;b.next();){var c=b.value,d=c.AB;if(""===a||""===d||d===a)if(d=c.ku,null!==c.BE||""!==d){var d=this.data,f=c.iu;null!==f&&(d=this.ue(f));if(null===d)e&&t.trace("Binding error: missing GraphObject named "+f+" in "+this.toString());else{var f=this,g=c.Fn;if(""!==g){if(f=this.ue(g),null===f)continue}else null!==c.vg&&(f=c.vg);g=c.Kz;if(0!==g){if(!(f instanceof C))continue;1===g?f=f.ve(c.dw):
2===g&&(f=f.we(c.dw))}void 0!==f&&c.eH(f,d)}}}};t.g(C,"itemArray",C.prototype.Ht);t.defineProperty(C,{Ht:"itemArray"},function(){return this.Li},function(a){var b=this.Li;if(b!==a){e&&null!==a&&!t.isArray(a)&&t.m("Panel.itemArray must be an Array-like object or null, not: "+a);var c=this.h;null!==c&&null!==b&&ij(c,this);this.Li=a;null!==c&&null!==a&&fj(c,this);this.j("itemArray",b,a);null!==c&&c.ma.yb||this.iB()}});function Wl(a){return a.type===$g||a.type===ti||a.type===Lg}
C.prototype.rebuildItemElements=C.prototype.iB=function(){var a=0;for(Wl(this)&&(a=1);this.va.length>a;)this.cf(a);a=this.Ht;if(null!==a)for(var b=t.ub(a),c=0;c<b;c++)xj(this,t.rb(a,c),c)};function xj(a,b,c){if(void 0!==b&&null!==b){var d=a.getCategoryForItemData(b,c),d=a.findTemplateForItemData(b,c,d);d instanceof C&&(cf(d),d=d.copy(),"object"===typeof b&&(null===a.mg&&(a.mg=new wa(Object,C)),a.mg.add(b,d)),a.type!==$g&&a.type!==ti||c++,a.Pd(c,d),Zl(d,c),Ij(a,c),d.data=b)}}
function Ij(a,b){for(var c=a.va,d=b+1;d<c.length;){var f=c.wa(d);f instanceof C&&Zl(f,d);d++}}function Zl(a,b){a.type===wk?a.wc=b:a.type===xk&&(a.column=b);a.HF=b}t.g(C,"itemTemplate",C.prototype.BJ);
t.defineProperty(C,{BJ:"itemTemplate"},function(){return null===this.ng?null:this.ng.Da("")},function(a){if(null===this.ng){if(null===a)return;this.ng=new wa("string",C)}var b=this.ng.Da("");b!==a&&(t.l(a,C,C,"itemTemplate"),a instanceof x&&t.m("itemTemplate must not be a Part: "+a),this.ng.add("",a),this.j("itemTemplate",b,a),a=this.h,null!==a&&a.ma.yb||this.iB())});t.g(C,"itemTemplateMap",C.prototype.IF);
t.defineProperty(C,{IF:"itemTemplateMap"},function(){return this.ng},function(a){var b=this.ng;if(b!==a){t.l(a,wa,C,"itemTemplateMap");for(var c=a.k;c.next();){var d=c.value;d instanceof x&&t.m("Template in itemTemplateMap must not be a Part: "+d)}this.ng=a;this.j("itemTemplateMap",b,a);a=this.h;null!==a&&a.ma.yb||this.iB()}});t.g(C,"itemCategoryProperty",C.prototype.AJ);
t.defineProperty(C,{AJ:"itemCategoryProperty"},function(){return this.xo},function(a){var b=this.xo;b!==a&&("string"!==typeof a&&"function"!==typeof a&&t.jc(a,"string or function",C,"itemCategoryProperty"),this.xo=a,this.j("itemCategoryProperty",b,a))});
C.prototype.getCategoryForItemData=function(a){if(null===a)return"";var b=this.xo;if("function"===typeof b)b=b(a);else if("string"===typeof b&&"object"===typeof a){if(""===b)return"";b=t.nb(a,b)}else return"";if(void 0===b)return"";if("string"===typeof b)return b;t.m("Panel.getCategoryForItemData found a non-string category for "+a+": "+b);return""};
C.prototype.findTemplateForItemData=function(a,b,c){a=this.IF;b=null;null!==a&&(b=a.Da(c));null===b&&(t.jH||(t.jH=!0,t.trace('No item template Panel found for category "'+c+'" on '+this),t.trace("  Using default item template."),c=new C,a=new za,a.bind(new Me("text","",na)),c.add(a),t.LE=c),b=t.LE);return b instanceof C?b:null};t.g(C,"isAtomic",C.prototype.sJ);
t.defineProperty(C,{sJ:"isAtomic"},function(){return this.bh},function(a){var b=this.bh;b!==a&&(t.i(a,"boolean",C,"isAtomic"),this.bh=a,this.j("isAtomic",b,a))});function Je(){t.Fc(this);this.Ui=null;this.hm=!0;this.Zc=0;this.Rf=NaN;this.sm=0;this.rm=Infinity;this.Ae=Ub;this.Pa=this.Ob=0;this.Nc=null;this.Cs=$l;this.$h=ch;this.zs=this.ak=null;this.As=NaN;this.Qb=this.Wh=null;this.Nq=!1}t.ka("RowColumnDefinition",Je);
Je.prototype.copy=function(){var a=new Je;a.hm=this.hm;a.Zc=this.Zc;a.Rf=this.Rf;a.sm=this.sm;a.rm=this.rm;a.Ae=this.Ae;a.Ob=this.Ob;a.Pa=this.Pa;a.$h=this.$h;a.Cs=this.Cs;a.ak=null===this.ak?null:this.ak.ba();a.zs=this.zs;a.As=this.As;a.Wh=null;this.Wh&&(a.Wh=this.Wh.slice(0));a.Qb=this.Qb;a.Nq=this.Nq;a.Nc=this.Nc;return a};Je.prototype.toString=function(){return"RowColumnDefinition "+(this.pi?"(Row ":"(Column ")+this.index+") #"+t.ud(this)};var $l;Je.Default=$l=t.w(Je,"Default",0);var Pl;
Je.None=Pl=t.w(Je,"None",1);var Fl;Je.ProportionalExtra=Fl=t.w(Je,"ProportionalExtra",2);Je.prototype.Il=function(a){this.Ui=a};function Nl(a,b){a.Ob=isNaN(a.Rf)?Math.max(Math.min(a.rm,b),a.sm):Math.max(Math.min(a.rm,a.Rf),a.sm)}function Rl(a){var b=a.Ui,c=a.Bn;null===c&&(c=a.pi?b.Fi:b.Hh);var d=a.Cn;isNaN(d)&&(d=a.pi?b.Jh:b.Ih);d=null!==c?d:0;0===a.index&&(d=0);c=a.uB;null===c&&(c=b.Gj);return d+(a.pi?c.top:c.left)}
function Jl(a){var b=a.Ui,c=a.Bn;null===c&&(c=a.pi?b.Fi:b.Hh);var d=a.Cn;isNaN(d)&&(d=a.pi?b.Jh:b.Ih);d=null!==c?d:0;0===a.index&&(d=0);c=a.uB;null===c&&(c=b.Gj);return d+(a.pi?c.top+c.bottom:c.left+c.right)}
Je.prototype.ad=function(a,b,c,d,f){var g=this.Ui;if(null!==g){g.ja();for(var h=this.pi,k=g.va,l=k.length,m=0;m<l;m++){var n=k.n[m];(h?n.wc:n.column)===this.index&&n.ja()}g.ed(Ld,a,this,b,c,d,f);if(null!==this.Nc&&(b=g.qp(),null!==b&&(b=b.data,null!==b)))for(c=this.Nc.k;c.next();)c.value.MB(this,b,a,null)}};t.A(Je,{ia:"panel"},function(){return this.Ui});t.A(Je,{pi:"isRow"},function(){return this.hm});t.A(Je,{index:"index"},function(){return this.Zc});t.g(Je,"height",Je.prototype.height);
t.defineProperty(Je,{height:"height"},function(){return this.Rf},function(a){var b=this.Rf;b!==a&&(e&&t.i(a,"number",Je,"height"),0>a&&t.ha(a,">= 0",Je,"height"),this.Rf=a,Nl(this,this.Ob),this.ad("size",b,a))});t.g(Je,"width",Je.prototype.width);t.defineProperty(Je,{width:"width"},function(){return this.Rf},function(a){var b=this.Rf;b!==a&&(e&&t.i(a,"number",Je,"width"),0>a&&t.ha(a,">= 0",Je,"width"),this.Rf=a,Nl(this,this.Ob),this.ad("size",b,a))});t.g(Je,"minimum",Je.prototype.si);
t.defineProperty(Je,{si:"minimum"},function(){return this.sm},function(a){var b=this.sm;b!==a&&(e&&t.i(a,"number",Je,"minimum"),(0>a||!isFinite(a))&&t.ha(a,">= 0",Je,"minimum"),this.sm=a,Nl(this,this.Ob),this.ad("minimum",b,a))});t.g(Je,"maximum",Je.prototype.Ef);t.defineProperty(Je,{Ef:"maximum"},function(){return this.rm},function(a){var b=this.rm;b!==a&&(e&&t.i(a,"number",Je,"maximum"),0>a&&t.ha(a,">= 0",Je,"maximum"),this.rm=a,Nl(this,this.Ob),this.ad("maximum",b,a))});t.g(Je,"alignment",Je.prototype.alignment);
t.defineProperty(Je,{alignment:"alignment"},function(){return this.Ae},function(a){var b=this.Ae;b.O(a)||(e&&t.l(a,L,Je,"alignment"),this.Ae=a.ba(),this.ad("alignment",b,a))});t.g(Je,"stretch",Je.prototype.ui);t.defineProperty(Je,{ui:"stretch"},function(){return this.$h},function(a){var b=this.$h;b!==a&&(e&&t.Fa(a,V,Je,"stretch"),this.$h=a,this.ad("stretch",b,a))});t.g(Je,"separatorPadding",Je.prototype.uB);
t.defineProperty(Je,{uB:"separatorPadding"},function(){return this.ak},function(a){"number"===typeof a?a=new wb(a):null!==a&&e&&t.l(a,wb,Je,"separatorPadding");var b=this.ak;null!==a&&null!==b&&b.O(a)||(null!==a&&(a=a.ba()),this.ak=a,this.ad("separatorPadding",b,a))});t.g(Je,"separatorStroke",Je.prototype.Bn);
t.defineProperty(Je,{Bn:"separatorStroke"},function(){return this.zs},function(a){var b=this.zs;b!==a&&(null===a||"string"===typeof a||a instanceof qa)&&(a instanceof qa&&a.freeze(),this.zs=a,this.ia&&this.ia.na(),this.ad("separatorStroke",b,a))});t.g(Je,"separatorStrokeWidth",Je.prototype.Cn);t.defineProperty(Je,{Cn:"separatorStrokeWidth"},function(){return this.As},function(a){var b=this.As;b!==a&&(this.As=a,this.ia&&this.ia.na(),this.ad("separatorStrokeWidth",b,a))});
t.g(Je,"separatorDashArray",Je.prototype.CG);t.defineProperty(Je,{CG:"separatorDashArray"},function(){return this.Wh},function(a){var b=this.Wh;b!==a&&(Array.isArray(a)||t.jc(a,"Array",Je,"separatorDashArray:val"),this.Wh=a,this.ia&&this.ia.na(),this.ad("separatorDashArray",b,a))});t.g(Je,"background",Je.prototype.background);
t.defineProperty(Je,{background:"background"},function(){return this.Qb},function(a){var b=this.Qb;b!==a&&(null===a||"string"===typeof a||a instanceof qa)&&(a instanceof qa&&a.freeze(),this.Qb=a,this.ia&&this.ia.na(),this.ad("background",b,a))});t.g(Je,"coversSeparators",Je.prototype.Hw);t.defineProperty(Je,{Hw:"coversSeparators"},function(){return this.Nq},function(a){var b=this.Nq;b!==a&&(t.i(a,"boolean",Je,"coversSeparators"),this.Nq=a,this.ad("coversSeparators",b,a))});t.g(Je,"sizing",Je.prototype.gu);
t.defineProperty(Je,{gu:"sizing"},function(){return this.Cs},function(a){var b=this.Cs;b!==a&&(e&&t.Fa(a,Je,Je,"sizing"),this.Cs=a,this.ad("sizing",b,a))});function Ol(a){if(a.gu===$l){var b=a.Ui;return a.pi?b.wG:b.xE}return a.gu}t.A(Je,{lc:"actual"},function(){return this.Ob});t.A(Je,{total:"total"},function(){return this.Ob+Jl(this)});t.A(Je,{position:"position"},function(){return this.Pa});
Je.prototype.bind=Je.prototype.bind=function(a){a.vg=this;var b=this.ia;null!==b&&(b=b.qp(),null!==b&&Sk(b)&&t.m("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+a));null===this.Nc&&(this.Nc=new H(Me));this.Nc.add(a)};
function W(){V.call(this);this.Ta=null;this.io="None";this.lh=!1;this.dr=ch;this.Lk=null;this.Kb=this.Yc="black";this.qe=1;this.Ro="butt";this.So="miter";this.Km=10;this.Jm=null;this.qd=0;this.Zi=this.Yi=Ub;this.Zr=this.Yr=0;this.ir=!1;this.or=!0;this.as=null;this.mo=this.Uo="None";this.hr=1}t.ka("Shape",W);t.Qa(W,V);
W.prototype.cloneProtected=function(a){V.prototype.cloneProtected.call(this,a);a.Ta=this.Ta;a.io=this.io;a.lh=this.lh;a.dr=this.dr;a.Lk=this.Lk;a.Yc=this.Yc;a.Kb=this.Kb;a.qe=this.qe;a.Ro=this.Ro;a.So=this.So;a.Km=this.Km;a.Jm=null;this.Jm&&(a.Jm=this.Jm.slice(0));a.qd=this.qd;a.Yi=this.Yi.ba();a.Zi=this.Zi.ba();a.Yr=this.Yr;a.Zr=this.Zr;a.ir=this.ir;a.or=this.or;a.as=this.as;a.Uo=this.Uo;a.mo=this.mo;a.hr=this.hr};
W.prototype.toString=function(){return"Shape("+("None"!==this.Eb?this.Eb:"None"!==this.Gn?this.Gn:this.Vw)+")#"+t.ud(this)};
function am(a,b,c,d){var f=0.001,g=d.Ha,h=g.width,g=g.height,k,l,m,n=c.length;if(!(2>n)){k=c[0][0];l=c[0][1];for(var p,q,r,s,u=0,w=t.Hb(),D=1;D<n;D++)p=c[D],f=p[0],m=p[1],p=f-k,k=m-l,0===p&&(p=0.001),q=k/p,s=Math.atan2(k,p),k=Math.sqrt(p*p+k*k),w.push([p,s,q,k]),u+=k,k=f,l=m;k=c[0][0];l=c[0][1];c=0;f=h;n=h/2;D=0===n?!1:!0;m=0;r=w[m];p=r[0];s=r[1];q=r[2];r=r[3];for(var A=0;0.1<=u;){0===A&&(D?(f=h,c++,f-=n,u-=n,D=!1):(f=h,c++),0===f&&(f=1));if(f>u){t.Ca(w);return}f>r?(A=f-r,f=r):A=0;var G=Math.sqrt(f*
f/(1+q*q));0>p&&(G=-G);k+=G;l+=q*G;a.translate(k,l);a.rotate(s);a.translate(-(h/2),-(g/2));0===A&&d.rl(a,b);a.translate(h/2,g/2);a.rotate(-s);a.translate(-k,-l);u-=f;r-=f;if(0!==A){m++;if(m===w.length){t.Ca(w);return}r=w[m];p=r[0];s=r[1];q=r[2];r=r[3];f=A}}t.Ca(w)}}
W.prototype.rl=function(a,b){if(null!==this.Kb||null!==this.Yc){null!==this.Yc&&Ak(this,a,this.Yc,!0);null!==this.Kb&&Ak(this,a,this.Kb,!1);var c=this.qe;if(0===c){var d=this.U;d instanceof ea&&d.type===Lg&&d.uc instanceof W&&(c=d.uc.lb)}a.lineWidth=c;a.lineJoin=this.So;a.lineCap=this.Ro;a.miterLimit=this.Km;var f=!1;this.U&&b.el.drawShadows&&(f=this.U.qi);var g=!0;null!==this.Kb&&null===this.Yc&&(g=!1);var d=!1,h=this.Mx;if(null!==h){var k=d=!0;void 0!==a.setLineDash?(a.setLineDash(h),a.lineDashOffset=
this.qd):void 0!==a.webkitLineDash?(a.webkitLineDash=h,a.webkitLineDashOffset=this.qd):void 0!==a.mozDash?(a.mozDash=h,a.mozDashOffset=this.qd):k=!1}var l=this.Ta;if(null!==l){if(l.ga===Tc)a.beginPath(),d&&!k?ik(a,l.tc,l.Cc,l.pb,l.Bb,h,this.qd):(a.moveTo(l.tc,l.Cc),a.lineTo(l.pb,l.Bb)),null!==this.Yc&&Bk(a,this.Yc,!0),0!==c&&null!==this.Kb&&Bk(a,this.Kb,!1);else if(l.ga===Uc){var m=l.tc,n=l.Cc,p=l.pb,l=l.Bb,q=Math.min(m,p),r=Math.min(n,l),m=Math.abs(p-m),n=Math.abs(l-n);null!==this.Yc&&(this.Yc instanceof
qa&&this.Yc.type===re?(a.beginPath(),a.rect(q,r,m,n),Bk(a,this.Yc,!0)):a.fillRect(q,r,m,n));if(null!==this.Kb){if(g&&f){var s=[a.shadowOffsetX,a.shadowOffsetY,a.shadowBlur];a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0}d&&!k?(k=[[q,r],[q+m,r],[q+m,r+n],[q,r+n],[q,r]],a.beginPath(),bm(a,k,h,this.qd),Bk(a,this.Kb,!1)):0!==c&&(this.Kb instanceof qa&&this.Kb.type===re?(a.beginPath(),a.rect(q,r,m,n),Bk(a,this.Kb,!1)):a.strokeRect(q,r,m,n));g&&f&&(a.shadowOffsetX=s[0],a.shadowOffsetY=s[1],a.shadowBlur=
s[2])}}else if(l.ga===$c)m=l.tc,n=l.Cc,p=l.pb,l=l.Bb,q=Math.abs(p-m)/2,r=Math.abs(l-n)/2,m=Math.min(m,p)+q,n=Math.min(n,l)+r,a.beginPath(),a.moveTo(m,n-r),a.bezierCurveTo(m+K.za*q,n-r,m+q,n-K.za*r,m+q,n),a.bezierCurveTo(m+q,n+K.za*r,m+K.za*q,n+r,m,n+r),a.bezierCurveTo(m-K.za*q,n+r,m-q,n+K.za*r,m-q,n),a.bezierCurveTo(m-q,n-K.za*r,m-K.za*q,n-r,m,n-r),a.closePath(),null!==this.Yc&&Bk(a,this.Yc,!0),d&&!k&&(k=t.Hb(),K.Fe(m,n-r,m+K.za*q,n-r,m+q,n-K.za*r,m+q,n,0.5,k),K.Fe(m+q,n,m+q,n+K.za*r,m+K.za*q,n+r,
m,n+r,0.5,k),K.Fe(m,n+r,m-K.za*q,n+r,m-q,n+K.za*r,m-q,n,0.5,k),K.Fe(m-q,n,m-q,n-K.za*r,m-K.za*q,n-r,m,n-r,0.5,k),a.beginPath(),bm(a,k,h,this.qd),t.Ca(k)),0!==c&&null!==this.Kb&&(g&&f&&(s=[a.shadowOffsetX,a.shadowOffsetY,a.shadowBlur],a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0),Bk(a,this.Kb,!1),g&&f&&(a.shadowOffsetX=s[0],a.shadowOffsetY=s[1],a.shadowBlur=s[2]));else if(l.ga===Qc){for(var q=l.Pk,r=q.length,u=0;u<r;u++){var w=q.n[u];a.beginPath();a.moveTo(w.sa,w.ta);for(var D=w.Ka.n,A=D.length,
G=null,M=0;M<A;M++){var N=D[M];switch(N.ga){case kd:a.moveTo(N.D,N.F);break;case bd:a.lineTo(N.D,N.F);break;case ld:a.bezierCurveTo(N.od,N.Ee,N.tg,N.ug,N.pb,N.Bb);break;case md:a.quadraticCurveTo(N.od,N.Ee,N.pb,N.Bb);break;case sd:if(N.radiusX===N.radiusY)G=Math.PI/180,a.arc(N.od,N.Ee,N.radiusX,N.yh*G,(N.yh+N.vi)*G,0>N.vi);else for(var G=vd(N,w),O=G.length,U=0;U<O;U++){var Y=G[U];0===U&&a.lineTo(Y.x1,Y.y1);a.bezierCurveTo(Y.x2,Y.y2,Y.ne,Y.oe,Y.$b,Y.ac)}break;case ud:G&&G.type===sd?(G=vd(G,w),G=G[G.length-
1]||null,null!==G&&(m=G.$b,p=G.ac)):(m=G?G.D:w.sa,p=G?G.F:w.ta);G=wd(N,w,m,p);O=G.length;for(U=0;U<O;U++)Y=G[U],a.bezierCurveTo(Y.x2,Y.y2,Y.ne,Y.oe,Y.$b,Y.ac);break;default:t.m("Segment not of valid type")}N.Sh&&a.closePath();G=N}f?w.vo?(!0===w.gm&&null!==this.Yc?(Bk(a,this.Yc,!0),g=!0):g=!1,0!==c&&null!==this.Kb&&(g&&(s=[a.shadowOffsetX,a.shadowOffsetY,a.shadowBlur],a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0),d&&!k||Bk(a,this.Kb,!1),g&&(a.shadowOffsetX=s[0],a.shadowOffsetY=s[1],a.shadowBlur=
s[2]))):(g&&(s=[a.shadowOffsetX,a.shadowOffsetY,a.shadowBlur],a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0),!0===w.gm&&null!==this.Yc&&Bk(a,this.Yc,!0),0!==c&&null!==this.Kb&&(d&&!k||Bk(a,this.Kb,!1)),g&&(a.shadowOffsetX=s[0],a.shadowOffsetY=s[1],a.shadowBlur=s[2])):(!0===w.gm&&null!==this.Yc&&Bk(a,this.Yc,!0),0===c||null===this.Kb||d&&!k||Bk(a,this.Kb,!1))}if(d&&!k)for(c=g,s=l.Pk,g=s.length,k=0;k<g;k++){l=s.n[k];a.beginPath();m=t.Hb();m.push([l.sa,l.ta]);p=l.sa;q=l.ta;r=p;u=q;w=l.Ka.n;D=w.length;
for(A=0;A<D;A++){M=w[A];switch(M.ga){case kd:bm(a,m,h,this.qd);m.length=0;m.push([M.D,M.F]);p=M.D;q=M.F;r=p;u=q;break;case bd:m.push([M.D,M.F]);p=M.D;q=M.F;break;case ld:K.Fe(p,q,M.od,M.Ee,M.tg,M.ug,M.pb,M.Bb,0.5,m);p=M.D;q=M.F;break;case md:K.Wp(p,q,M.od,M.Ee,M.pb,M.Bb,0.5,m);p=M.D;q=M.F;break;case sd:N=vd(M,l);G=N.length;for(O=0;O<G;O++)U=N[O],K.Fe(p,q,U.x2,U.y2,U.ne,U.oe,U.$b,U.ac,0.5,m),p=U.$b,q=U.ac;break;case ud:N=wd(M,l,p,q);G=N.length;for(O=0;O<G;O++)U=N[O],K.Fe(p,q,U.x2,U.y2,U.ne,U.oe,U.$b,
U.ac,0.5,m),p=U.$b,q=U.ac;break;default:t.m("Segment not of valid type")}M.Sh&&(m.push([r,u]),bm(a,m,h,this.qd))}bm(a,m,h,this.qd);t.Ca(m);null!==this.Kb&&(c&&f&&(n=[a.shadowOffsetX,a.shadowOffsetY,a.shadowBlur],a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0),Bk(a,this.Kb,!1),c&&f&&(a.shadowOffsetX=n[0],a.shadowOffsetY=n[1],a.shadowBlur=n[2]))}}d&&(void 0!==a.setLineDash?(a.setLineDash(t.xi),a.lineDashOffset=0):void 0!==a.webkitLineDash?(a.webkitLineDash=t.xi,a.webkitLineDashOffset=0):void 0!==
a.mozDash&&(a.mozDash=null,a.mozDashOffset=0));if(this.cB){d=this.cB;xh(d,Infinity,Infinity);h=d.Ha;d.Pc(0,0,h.width,h.height);a.save();h=this.td.Fb.gb();a.beginPath();n=t.Hb();n.push([h.sa,h.ta]);c=h.sa;f=h.ta;s=c;g=f;k=h.Ka.n;l=k.length;for(m=0;m<l;m++){p=k[m];switch(p.ga){case kd:am(a,b,n,d);n.length=0;n.push([p.D,p.F]);c=p.D;f=p.F;s=c;g=f;break;case bd:n.push([p.D,p.F]);c=p.D;f=p.F;break;case ld:K.Fe(c,f,p.od,p.Ee,p.tg,p.ug,p.pb,p.Bb,0.5,n);c=p.D;f=p.F;break;case md:K.Wp(c,f,p.od,p.Ee,p.pb,p.Bb,
0.5,n);c=p.D;f=p.F;break;case sd:q=vd(p,h);r=q.length;for(u=0;u<r;u++)w=q[u],K.Fe(c,f,w.x2,w.y2,w.ne,w.oe,w.$b,w.ac,0.5,n),c=w.$b,f=w.ac;break;case ud:q=wd(p,h,c,f);r=q.length;for(u=0;u<r;u++)w=q[u],K.Fe(c,f,w.x2,w.y2,w.ne,w.oe,w.$b,w.ac,0.5,n),c=w.$b,f=w.ac;break;default:t.m("Segment not of valid type")}p.Sh&&(n.push([s,g]),am(a,b,n,d))}am(a,b,n,d);t.Ca(n);a.restore()}}}};
function bm(a,b,c,d){var f=0.001,g=c.length,h,k,l,m=b.length;if(!(2>m))if(h=b[0][0],k=b[0][1],2===m)ik(a,h,k,b[1][0],b[1][1],c,d);else{a.moveTo(h,k);for(var n,p,q,r=0,s=t.Hb(),u=1;u<m;u++)n=b[u],f=n[0],l=n[1],n=f-h,h=l-k,0===n&&(n=0.001),p=h/n,h=Math.sqrt(n*n+h*h),s.push([n,p,h]),r+=h,h=f,k=l;h=b[0][0];k=b[0][1];b=0;m=!0;f=c[b%g];u=0!==d;l=0;q=s[l];n=q[0];p=q[1];q=q[2];for(var w=0;0.1<=r;){0===w&&(f=c[b%g],b++,u&&(d%=f,f-=d,u=!1));f>r&&(f=r);f>q?(w=f-q,f=q):w=0;var D=Math.sqrt(f*f/(1+p*p));0>n&&(D=
-D);h+=D;k+=p*D;m?a.lineTo(h,k):a.moveTo(h,k);r-=f;q-=f;if(0!==w){l++;if(l===s.length){t.Ca(s);return}q=s[l];n=q[0];p=q[1];q=q[2];f=w}else m=!m}t.Ca(s)}}W.prototype.getDocumentPoint=W.prototype.wb=function(a,b){void 0===b&&(b=new E);a.Me()&&t.m("getDocumentPoint:s Spot must be real: "+a.toString());var c=this.Ja,d=this.lb;b.p(a.x*(c.width+d)-d/2+c.x+a.offsetX,a.y*(c.height+d)-d/2+c.y+a.offsetY);this.se.Xa(b);return b};
W.prototype.jk=function(a,b){var c=this.Ta;if(null===c||null===this.fill&&null===this.stroke)return!1;var d=c.Tb,f=this.lb/2;c.type!==Tc||b||(f+=2);var g=t.Jf();g.assign(d);g.Wf(f+2,f+2);if(!g.La(a))return t.oc(g),!1;d=f+1E-4;if(c.type===Tc){if(null===this.stroke)return!1;d=(c.D-c.sa)*(a.x-c.sa)+(c.F-c.ta)*(a.y-c.ta);if(0>(c.sa-c.D)*(a.x-c.D)+(c.ta-c.F)*(a.y-c.F)||0>d)return!1;t.oc(g);return K.Sd(c.sa,c.ta,c.D,c.F,f,a.x,a.y)}if(c.type===Uc){var h=c.sa,k=c.ta,l=c.D,m=c.F,c=Math.min(h,l),n=Math.min(k,
m),h=Math.abs(l-h),k=Math.abs(m-k);g.x=c;g.y=n;g.width=h;g.height=k;if(null===this.fill){g.Wf(-d,-d);if(g.La(a))return t.oc(g),!1;g.Wf(d,d)}null!==this.stroke&&g.Wf(f,f);f=g.La(a);t.oc(g);return f}if(c.type===$c){h=c.sa;k=c.ta;l=c.D;m=c.F;c=Math.min(h,l);n=Math.min(k,m);h=Math.abs(l-h);k=Math.abs(m-k);h/=2;k/=2;c=a.x-(c+h);n=a.y-(n+k);if(null===this.fill){h-=d;k-=d;if(0>=h||0>=k||1>=c*c/(h*h)+n*n/(k*k))return t.oc(g),!1;h+=d;k+=d}null!==this.stroke&&(h+=f,k+=f);t.oc(g);return 0>=h||0>=k?!1:1>=c*c/
(h*h)+n*n/(k*k)}if(c.type===Qc)return t.oc(g),null===this.fill?zd(c,a.x,a.y,f):c.La(a,f,1<this.lb,b);t.m("Unknown Geometry type");return!1};
W.prototype.Kt=function(a,b,c,d){var f=this.Ea,g=this.qe;a=Math.max(a,0);b=Math.max(b,0);var h;if(this.lh)h=this.Ta.Tb;else{var k=this.Eb,l=K.eB[k];if(void 0===l){var m=K.oj[k];"string"===typeof m&&(m=K.oj[m]);"function"===typeof m?(l=m(null,100,100),K.eB[k]=l):t.m("Unsupported Figure:"+k)}h=l.Tb}var k=h.width,l=h.height,m=h.width,n=h.height;switch(nk(this)){case bh:d=c=0;break;case Sc:m=Math.max(a-g,0);n=Math.max(b-g,0);break;case fk:m=Math.max(a-g,0);d=0;break;case ek:c=0,n=Math.max(b-g,0)}isFinite(f.width)&&
(m=f.width);isFinite(f.height)&&(n=f.height);f=this.Oe;h=this.Yf;c=Math.max(c,h.width)-g;d=Math.max(d,h.height)-g;m=Math.min(f.width,m);n=Math.min(f.height,n);m=isFinite(m)?Math.max(c,m):Math.max(k,c);n=isFinite(n)?Math.max(d,n):Math.max(l,d);c=Ml(this);switch(c){case bh:break;case Sc:k=m;l=n;break;case dh:c=Math.min(m/k,n/l);isFinite(c)||(c=1);k*=c;l*=c;break;default:t.m(c+" is not a valid geometryStretch.")}if(this.lh){h=this.td;d=k;f=l;c=h.copy();h=h.Tb;d/=h.width;f/=h.height;isFinite(d)||(d=1);
isFinite(f)||(f=1);if(1!==d||1!==f)switch(c.type){case Tc:case Uc:case $c:c.sa*=d;c.ta*=f;c.D*=d;c.F*=f;break;case Qc:h=c.Fb;for(var p=h.length,q=0;q<p;q++){var r=h.n[q];r.sa*=d;r.ta*=f;for(var r=r.Ka,s=r.length,u=0;u<s;u++){var w=r.n[u];switch(w.type){case bd:case kd:w.D*=d;w.F*=f;break;case ld:w.Gb*=d;w.Xb*=f;w.ye*=d;w.ze*=f;w.D*=d;w.F*=f;break;case md:w.Gb*=d;w.Xb*=f;w.D*=d;w.F*=f;break;case sd:w.Ia*=d;w.Ua*=f;w.radiusX*=d;void 0!==w.radiusY&&(w.radiusY*=f);break;case ud:w.D*=d;w.F*=f;w.radiusX*=
d;w.radiusY*=f;break;default:t.m("Unknown Segment type: "+w.type)}}}}this.Ta=c}else if(null===this.Ta||this.Ta.to!==a-g||this.Ta.so!==b-g)this.Ta=K.makeGeometry(this,k,l);h=this.Ta.Tb;Infinity===a||Infinity===b?kk(this,h.x-g/2,h.y-g/2,0===a&&0===k?0:h.width+g,0===b&&0===l?0:h.height+g):kk(this,-(g/2),-(g/2),m+g,n+g)};
function Ql(a,b,c){if(!1!==Ui(a)){a.$c.Ra();var d=a.qe;if(0===d){var f=a.U;f instanceof ea&&f.type===Lg&&f.uc instanceof W&&(d=f.uc.lb)}d*=a.fc;kk(a,-(d/2),-(d/2),b+d,c+d);b=a.$c;c=a.Oe;d=a.Yf;b.width=Math.min(c.width,b.width);b.height=Math.min(c.height,b.height);b.width=Math.max(d.width,b.width);b.height=Math.max(d.height,b.height);a.$c.freeze();a.$c.P()||t.m("Non-real measuredBounds has been set. Object "+a+", measuredBounds: "+a.$c.toString());ok(a,!1)}}
function Ml(a){var b=a.Ww;return a.lh?b===ch?Sc:b:b===ch?K.eB[a.Eb].Ac:b}W.prototype.ik=function(a,b,c,d){rk(this,a,b,c,d)};W.prototype.getNearestIntersectionPoint=W.prototype.yl=function(a,b,c){return this.wp(a.x,a.y,b.x,b.y,c)};
W.prototype.wp=function(a,b,c,d,f){var g=this.transform,h=1/(g.m11*g.m22-g.m12*g.m21),k=g.m22*h,l=-g.m12*h,m=-g.m21*h,n=g.m11*h,p=h*(g.m21*g.dy-g.m22*g.dx),q=h*(g.m12*g.dx-g.m11*g.dy),g=a*k+b*m+p,h=a*l+b*n+q,k=c*k+d*m+p,l=c*l+d*n+q,m=this.lb/2,p=this.Ta;null===p&&(xh(this,Infinity,Infinity),p=this.Ta);q=p.Tb;n=!1;if(p.type===Tc)if(1.5>=this.lb)n=K.uh(p.tc,p.Cc,p.pb,p.Bb,g,h,k,l,f);else{var r,s;p.tc===p.pb?(r=m,s=0):(b=(p.Bb-p.Cc)/(p.pb-p.tc),s=m/Math.sqrt(1+b*b),r=s*b);d=t.Hb();b=new E;K.uh(p.tc+
r,p.Cc+s,p.pb+r,p.Bb+s,g,h,k,l,b)&&d.push(b);b=new E;K.uh(p.tc-r,p.Cc-s,p.pb-r,p.Bb-s,g,h,k,l,b)&&d.push(b);b=new E;K.uh(p.tc+r,p.Cc+s,p.tc-r,p.Cc-s,g,h,k,l,b)&&d.push(b);b=new E;K.uh(p.pb+r,p.Bb+s,p.pb-r,p.Bb-s,g,h,k,l,b)&&d.push(b);b=d.length;if(0===b)return t.Ca(d),!1;n=!0;s=Infinity;for(r=0;r<b;r++){var k=d[r],u=(k.x-g)*(k.x-g)+(k.y-h)*(k.y-h);u<s&&(s=u,f.x=k.x,f.y=k.y)}t.Ca(d)}else if(p.type===Uc)b=q.x-m,n=K.yl(b,q.y-m,q.x+q.width+m,q.y+q.height+m,g,h,k,l,f);else if(p.type===$c)a:if(b=q.copy().Wf(m,
m),0===b.width)n=K.uh(b.x,b.y,b.x,b.y+b.height,g,h,k,l,f);else if(0===b.height)n=K.uh(b.x,b.y,b.x+b.width,b.y,g,h,k,l,f);else{a=b.width/2;var w=b.height/2;d=b.x+a;b=b.y+w;c=9999;g!==k&&(c=(h-l)/(g-k));if(9999>Math.abs(c)){n=h-b-c*(g-d);if(0>a*a*c*c+w*w-n*n){f.x=NaN;f.y=NaN;n=!1;break a}m=Math.sqrt(a*a*c*c+w*w-n*n);k=(-(a*a*c*n)+a*w*m)/(w*w+a*a*c*c)+d;a=(-(a*a*c*n)-a*w*m)/(w*w+a*a*c*c)+d;l=c*(k-d)+n+b;b=c*(a-d)+n+b;d=Math.abs((g-k)*(g-k))+Math.abs((h-l)*(h-l));h=Math.abs((g-a)*(g-a))+Math.abs((h-b)*
(h-b));d<h?(f.x=k,f.y=l):(f.x=a,f.y=b)}else{k=w*w;l=g-d;k-=k/(a*a)*l*l;if(0>k){f.x=NaN;f.y=NaN;n=!1;break a}m=Math.sqrt(k);l=b+m;b-=m;d=Math.abs(l-h);h=Math.abs(b-h);d<h?(f.x=g,f.y=l):(f.x=g,f.y=b)}n=!0}else if(p.type===Qc){var D,A,G,q=t.N();r=k-g;s=l-h;s=r*r+s*s;f.x=k;f.y=l;for(r=0;r<p.Fb.count;r++){var M=p.Fb.n[r],N=M.Ka;D=M.sa;A=M.ta;for(var O=D,U=A,Y,ba,R=0;R<N.count;R++){Y=N.n[R];ba=Y.type;u=Y.D;G=Y.F;var ya=!1;switch(ba){case kd:O=u;U=G;break;case bd:ya=cm(D,A,u,G,g,h,k,l,q);break;case ld:ya=
Y.Gb;ba=Y.Xb;var Ya=Y.ye,Aa=Y.ze,ya=K.dt(D,A,ya,ba,Ya,Aa,u,G,g,h,k,l,0.5,q);break;case md:ya=(D+2*Y.Gb)/3;ba=(A+2*Y.Xb)/3;Ya=(2*Y.Gb+u)/3;Aa=(2*Y.Gb+u)/3;ya=K.dt(D,A,ya,ba,Ya,Aa,u,G,g,h,k,l,0.5,q);break;case sd:case ud:G=Y.type===sd?vd(Y,M):wd(Y,M,D,A);ba=G.length;for(Ya=0;Ya<ba;Ya++)w=G[Ya],0===Ya&&cm(D,A,w.x1,w.y1,g,h,k,l,q)&&(u=dm(g,h,q,s,f),u<s&&(s=u,n=!0)),K.dt(w.x1,w.y1,w.x2,w.y2,w.ne,w.oe,w.$b,w.ac,g,h,k,l,0.5,q)&&(u=dm(g,h,q,s,f),u<s&&(s=u,n=!0));u=w.$b;G=w.ac;break;default:t.m("Unknown Segment type: "+
Y.type)}D=u;A=G;ya&&(u=dm(g,h,q,s,f),u<s&&(s=u,n=!0));Y.Ct&&(u=O,G=U,cm(D,A,u,G,g,h,k,l,q)&&(u=dm(g,h,q,s,f),u<s&&(s=u,n=!0)))}}g=c-a;h=d-b;b=Math.sqrt(g*g+h*h);0!==b&&(g/=b,h/=b);f.x-=g*m;f.y-=h*m;t.B(q)}else t.m("Invalid Geometry type");if(!n)return!1;this.transform.Xa(f);return!0};function dm(a,b,c,d,f){a=c.x-a;b=c.y-b;b=a*a+b*b;return b<d?(f.x=c.x,f.y=c.y,b):d}
function cm(a,b,c,d,f,g,h,k,l){var m=!1,n=(f-h)*(b-d)-(g-k)*(a-c);if(0===n)return!1;l.x=((f*k-g*h)*(a-c)-(f-h)*(a*d-b*c))/n;l.y=((f*k-g*h)*(b-d)-(g-k)*(a*d-b*c))/n;(a>c?a-c:c-a)<(b>d?b-d:d-b)?(f=b<d?b:d,a=b<d?d:b,(l.y>f||K.sb(l.y,f))&&(l.y<a||K.sb(l.y,a))&&(m=!0)):(f=a<c?a:c,a=a<c?c:a,(l.x>f||K.sb(l.x,f))&&(l.x<a||K.sb(l.x,a))&&(m=!0));return m}
W.prototype.containedInRect=W.prototype.Ym=function(a,b){if(void 0===b)return a.kk(this.pa);var c=this.Ta;null===c&&(xh(this,Infinity,Infinity),c=this.Ta);var c=c.Tb,d=this.lb/2,f=!1,g=t.N();g.p(c.x-d,c.y-d);a.La(b.Xa(g))&&(g.p(c.x-d,c.bottom+d),a.La(b.Xa(g))&&(g.p(c.right+d,c.bottom+d),a.La(b.Xa(g))&&(g.p(c.right+d,c.y-d),a.La(b.Xa(g))&&(f=!0))));t.B(g);return f};
W.prototype.intersectsRect=W.prototype.Xf=function(a,b){if(this.Ym(a,b)||void 0===b&&(b=this.transform,a.kk(this.pa)))return!0;var c=t.Ah();c.set(b);c.FA();var d=a.left,f=a.right,g=a.top,h=a.bottom,k=t.N();k.p(d,g);c.Xa(k);if(this.jk(k,!0))return t.B(k),!0;k.p(f,g);c.Xa(k);if(this.jk(k,!0))return t.B(k),!0;k.p(d,h);c.Xa(k);if(this.jk(k,!0))return t.B(k),!0;k.p(f,h);c.Xa(k);if(this.jk(k,!0))return t.B(k),!0;var l=t.N(),m=t.N();c.set(b);c.XA(this.transform);c.FA();l.x=f;l.y=g;l.transform(c);k.x=d;k.y=
g;k.transform(c);var n=!1;em(this,k,l,m)?n=!0:(k.x=f,k.y=h,k.transform(c),em(this,k,l,m)?n=!0:(l.x=d,l.y=h,l.transform(c),em(this,k,l,m)?n=!0:(k.x=d,k.y=g,k.transform(c),em(this,k,l,m)&&(n=!0))));t.B(k);t.bf(c);t.B(l);t.B(m);return n};function em(a,b,c,d){if(!a.yl(b,c,d))return!1;a=b.x;b=b.y;var f=c.x,g=c.y;c=d.x;d=d.y;if(a===f){var h;b<g?(h=b,a=g):(h=g,a=b);return d>=h&&d<=a}a<f?(h=a,a=f):h=f;return c>=h&&c<=a}
W.prototype.bF=function(a,b,c){function d(a,b){for(var c=a.length,d=0;d<c;d++){var g=a[d];if(b.nt(g[0],g[1])>f)return!0}return!1}if(c&&null!==this.fill&&this.jk(a,!0))return!0;var f=a.nk(b);b=f;1.5<this.lb&&(f=this.lb/2+Math.sqrt(f),f*=f);var g=this.Ta;null===g&&(xh(this,Infinity,Infinity),g=this.Ta);if(!c){var h=g.Tb,k=h.x,l=h.y,m=h.x+h.width,h=h.y+h.height;if(ob(a.x,a.y,k,l)<=f&&ob(a.x,a.y,m,l)<=f&&ob(a.x,a.y,k,h)<=f&&ob(a.x,a.y,m,h)<=f)return!0}k=g.tc;l=g.Cc;m=g.pb;h=g.Bb;if(g.type===Tc){if(c=
nb(a.x,a.y,k,l,m,h),g=(k-m)*(a.x-m)+(l-h)*(a.y-h),c<=(0<=(m-k)*(a.x-k)+(h-l)*(a.y-l)&&0<=g?f:b))return!0}else{if(g.type===Uc)return b=!1,c&&(b=nb(a.x,a.y,k,l,k,h)<=f||nb(a.x,a.y,k,l,m,l)<=f||nb(a.x,a.y,m,l,m,h)<=f||nb(a.x,a.y,k,h,m,h)<=f),b;if(g.type===$c){b=a.x-(k+m)/2;var g=a.y-(l+h)/2,n=Math.abs(m-k)/2,p=Math.abs(h-l)/2;if(0===n||0===p)return c=nb(a.x,a.y,k,l,m,h),c<=f?!0:!1;if(c){if(a=K.OI(n,p,b,g),a*a<=f)return!0}else return ob(b,g,-n,0)>=f||ob(b,g,0,-p)>=f||ob(b,g,0,p)>=f||ob(b,g,n,0)>=f?!1:
!0}else if(g.type===Qc){h=g.Tb;k=h.x;l=h.y;m=h.x+h.width;h=h.y+h.height;if(a.x>m&&a.x<k&&a.y>h&&a.y<l&&nb(a.x,a.y,k,l,k,h)>f&&nb(a.x,a.y,k,l,m,l)>f&&nb(a.x,a.y,m,h,k,h)>f&&nb(a.x,a.y,m,h,m,l)>f)return!1;b=Math.sqrt(f);if(c){if(null===this.fill?zd(g,a.x,a.y,b):g.La(a,b,!0))return!0}else{c=g.Fb;for(b=0;b<c.count;b++){k=c.n[b];n=k.sa;p=k.ta;if(a.nt(n,p)>f)return!1;l=k.Ka.n;m=l.length;for(h=0;h<m;h++){var q=l[h];switch(q.type){case kd:case bd:n=q.D;p=q.F;if(a.nt(n,p)>f)return!1;break;case ld:g=t.Hb();
K.Fe(n,p,q.Gb,q.Xb,q.ye,q.ze,q.D,q.F,0.8,g);n=d(g,a);t.Ca(g);if(n)return!1;n=q.D;p=q.F;if(a.nt(n,p)>f)return!1;break;case md:g=t.Hb();K.Wp(n,p,q.Gb,q.Xb,q.D,q.F,0.8,g);n=d(g,a);t.Ca(g);if(n)return!1;n=q.D;p=q.F;if(a.nt(n,p)>f)return!1;break;case sd:case ud:var q=q.type===sd?vd(q,k):wd(q,k,n,p),r=q.length,s=null,g=t.Hb();for(b=0;b<r;b++)if(s=q[b],g.length=0,K.Fe(s.x1,s.y1,s.x2,s.y2,s.ne,s.oe,s.$b,s.ac,0.8,g),d(g,a))return t.Ca(g),!1;t.Ca(g);null!==s&&(n=s.$b,p=s.ac);break;default:t.m("Unknown Segment type: "+
q.type)}}}return!0}}}return!1};t.g(W,"geometry",W.prototype.td);t.defineProperty(W,{td:"geometry"},function(){return this.Lk?this.Lk:this.Ta},function(a){var b=this.Ta;if(b!==a){null!==a?(e&&t.l(a,Pc,W,"geometry"),this.Lk=this.Ta=a.freeze()):this.Lk=this.Ta=null;var c=this.U;c&&(c.Rj=NaN);this.lh=!0;this.ja();this.j("geometry",b,a)}});t.g(W,"geometryString",W.prototype.iF);
t.defineProperty(W,{iF:"geometryString"},function(){return this.td.toString()},function(a){var b=ed(a);a=b.normalize();this.td=b;var b=t.N(),c=this.position;c.P()?b.p(c.x-a.x,c.y-a.y):b.p(-a.x,-a.y);this.position=b;t.B(b)});t.defineProperty(W,{JA:"isGeometryPositioned"},function(){return this.ir},function(a){e&&t.i(a,"boolean",W,"isGeometryPositioned");var b=this.ir;b!==a&&(this.ir=a,this.ja(),this.j("isGeometryPositioned",b,a))});W.prototype.df=function(){this.lh?this.Lk=null:this.Ta=null;this.ja()};
t.g(W,"fill",W.prototype.fill);t.defineProperty(W,{fill:"fill"},function(){return this.Yc},function(a){var b=this.Yc;b!==a&&(e&&null!==a&&t.fp(a,"Shape.fill"),a instanceof qa&&a.freeze(),this.Yc=a,this.na(),this.j("fill",b,a))});t.g(W,"stroke",W.prototype.stroke);t.defineProperty(W,{stroke:"stroke"},function(){return this.Kb},function(a){var b=this.Kb;b!==a&&(e&&null!==a&&t.fp(a,"Shape.stroke"),a instanceof qa&&a.freeze(),this.Kb=a,this.na(),this.j("stroke",b,a))});t.g(W,"strokeWidth",W.prototype.lb);
t.defineProperty(W,{lb:"strokeWidth"},function(){return this.qe},function(a){var b=this.qe;if(b!==a)if(e&&t.q(a,W,"strokeWidth"),0<=a){this.qe=a;this.ja();var c=this.U;c&&(c.Rj=NaN);this.j("strokeWidth",b,a)}else t.ha(a,"val >= 0",W,"strokeWidth:val")});t.g(W,"strokeCap",W.prototype.OG);
t.defineProperty(W,{OG:"strokeCap"},function(){return this.Ro},function(a){var b=this.Ro;b!==a&&("string"!==typeof a||"butt"!==a&&"round"!==a&&"square"!==a?t.ha(a,'"butt", "round", or "square"',W,"strokeCap"):(this.Ro=a,this.na(),this.j("strokeCap",b,a)))});t.g(W,"strokeJoin",W.prototype.rK);
t.defineProperty(W,{rK:"strokeJoin"},function(){return this.So},function(a){var b=this.So;b!==a&&("string"!==typeof a||"miter"!==a&&"bevel"!==a&&"round"!==a?t.ha(a,'"miter", "bevel", or "round"',W,"strokeJoin"):(this.So=a,this.na(),this.j("strokeJoin",b,a)))});t.g(W,"strokeMiterLimit",W.prototype.sK);
t.defineProperty(W,{sK:"strokeMiterLimit"},function(){return this.Km},function(a){var b=this.Km;if(b!==a)if(e&&t.q(a,W,"strokeMiterLimit"),0<a){this.Km=a;this.na();var c=this.U;c&&(c.Rj=NaN);this.j("strokeMiterLimit",b,a)}else t.ha(a,"val > 0",W,"strokeWidth:val")});t.g(W,"strokeDashArray",W.prototype.Mx);
t.defineProperty(W,{Mx:"strokeDashArray"},function(){return this.Jm},function(a){var b=this.Jm;if(b!==a){null===a||Array.isArray(a)||t.jc(a,"Array",W,"strokeDashArray:val");if(null!==a)for(var c=a.length,d=0;d<c;d++){var f=a[d];("number"!==typeof f||isNaN(f)||0>f||!isFinite(f))&&t.m("strokeDashArray:val "+f+" is a negative number or not a real number.")}this.Jm=a;this.na();this.j("strokeDashArray",b,a)}});t.g(W,"strokeDashOffset",W.prototype.PG);
t.defineProperty(W,{PG:"strokeDashOffset"},function(){return this.qd},function(a){var b=this.qd;b!==a&&(e&&t.q(a,W,"strokeDashOffset"),0<=a&&(this.qd=a,this.na(),this.j("strokeDashOffset",b,a)))});t.g(W,"figure",W.prototype.Eb);
t.defineProperty(W,{Eb:"figure"},function(){return this.io},function(a){var b=this.io;if(b!==a){e&&t.i(a,"string",W,"figure");var c=K.oj[a];"function"===typeof c?c=a:(c=K.oj[a.toLowerCase()])||t.m("Unknown Shape.figure: "+a);if(b!==c){if(a=this.U)a.Rj=NaN;this.io=c;this.lh=!1;this.df();this.j("figure",b,c)}}});t.g(W,"toArrow",W.prototype.Gn);
t.defineProperty(W,{Gn:"toArrow"},function(){return this.Uo},function(a){var b=this.Uo;!0===a?a="Standard":!1===a&&(a="");if(b!==a){e&&t.i(a,"string",W,"toArrow");var c=K.qE(a);null===c?t.m("Unknown Shape.toArrow: "+a):b!==c&&(this.Uo=c,this.lh=!1,this.df(),fm(this),this.j("toArrow",b,c))}});t.g(W,"fromArrow",W.prototype.Vw);
t.defineProperty(W,{Vw:"fromArrow"},function(){return this.mo},function(a){var b=this.mo;!0===a?a="Standard":!1===a&&(a="");if(b!==a){e&&t.i(a,"string",W,"fromArrow");var c=K.qE(a);null===c?t.m("Unknown Shape.fromArrow: "+a):b!==c&&(this.mo=c,this.lh=!1,this.df(),fm(this),this.j("fromArrow",b,c))}});function fm(a){var b=a.h;null!==b&&b.ma.yb||(a.cu=gm,"None"!==a.Uo?(a.Gf=-1,a.ek=hc):"None"!==a.mo&&(a.Gf=0,a.ek=new L(1-hc.x,hc.y)))}
t.defineProperty(W,{G:"spot1"},function(){return this.Yi},function(a){t.l(a,L,W,"spot1");var b=this.Yi;b.O(a)||(this.Yi=a=a.ba(),this.ja(),this.j("spot1",b,a))});t.defineProperty(W,{H:"spot2"},function(){return this.Zi},function(a){t.l(a,L,W,"spot2");var b=this.Zi;b.O(a)||(this.Zi=a=a.ba(),this.ja(),this.j("spot2",b,a))});t.defineProperty(W,{Kc:"parameter1"},function(){return this.Yr},function(a){var b=this.Yr;b!==a&&(this.Yr=a,this.ja(),this.j("parameter1",b,a))});
t.defineProperty(W,{Vt:"parameter2"},function(){return this.Zr},function(a){var b=this.Zr;b!==a&&(this.Zr=a,this.ja(),this.j("parameter2",b,a))});t.A(W,{Ja:"naturalBounds"},function(){if(null!==this.Ta)return this.nd.assign(this.Ta.Tb),this.nd;var a=this.Ea;return new F(0,0,a.width,a.height)});t.g(W,"isRectangular",W.prototype.vJ);
t.defineProperty(W,{vJ:"isRectangular"},function(){return this.or},function(a){var b=this.or;b!==a&&(e&&t.i(a,"boolean",W,"isRectangular"),this.or=a,this.ja(),this.j("isRectangular",b,a))});t.g(W,"pathObject",W.prototype.cB);t.defineProperty(W,{cB:"pathObject"},function(){return this.as},function(a){var b=this.as;b!==a&&(e&&t.l(a,V,W,"pathObject"),this.as=a,this.na(),this.j("pathObject",b,a))});t.g(W,"geometryStretch",W.prototype.Ww);
t.defineProperty(W,{Ww:"geometryStretch"},function(){return this.dr},function(a){var b=this.dr;b!==a&&(t.Fa(a,V,W,"geometryStretch"),this.dr=a,this.j("geometryStretch",b,a))});t.g(W,"interval",W.prototype.interval);t.defineProperty(W,{interval:"interval"},function(){return this.hr},function(a){var b=this.hr;e&&t.q(a,W,"interval");a=Math.floor(a);b!==a&&0<=a&&(this.hr=a,this.h&&Pi(this.h),this.ja(),this.j("interval",b,a))});
W.defineFigureGenerator=function(a,b){t.i(a,"string",W,"defineFigureGenerator:name");t.i(b,"function",W,"defineFigureGenerator:func");var c=a.toLowerCase();""!==a&&"none"!==c&&a!==c||t.m("Shape.defineFigureGenerator name must not be empty or None or all-lower-case: "+a);var d=W.FigureGenerators;d[a]=b;d[c]=a};
W.defineArrowheadGeometry=function(a,b){t.i(a,"string",W,"defineArrowheadGeometry:name");t.i(b,"string",W,"defineArrowheadGeometry:pathstr");var c=a.toLowerCase();""!==a&&"none"!==c&&a!==c||t.m("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+a);var d=W.ArrowheadGeometries;d[a]=b;d[c]=a};
function za(){V.call(this);this.re="";this.Kb="black";this.$g="13px sans-serif";this.ae="start";this.lr=!0;this.im=this.jm=!1;this.cl=hm;this.Nm=im;this.sv=this.fh=0;this.lo=this.rz=this.sz=null;this.Eo={};this.Yq=!1;this.qf=this.fl=this.Ms=null;this.dk=this.ck=0;this.Qj=Infinity}t.ka("TextBlock",za);t.Qa(za,V);za.getEllipsis=function(){return t.ot};za.setEllipsis=function(a){t.ot=a;t.Uw={};t.wA=0};
za.prototype.cloneProtected=function(a){V.prototype.cloneProtected.call(this,a);a.re=this.re;a.Kb=this.Kb;a.$g=this.$g;a.ae=this.ae;a.lr=this.lr;a.jm=this.jm;a.im=this.im;a.Nm=this.Nm;a.cl=this.cl;a.fh=this.fh;a.sv=this.sv;a.sz=this.sz;a.rz=this.rz;a.lo=this.lo;a.Eo=this.Eo;a.Yq=this.Yq;a.Ms=this.Ms;a.fl=this.fl;a.qf=this.qf;a.ck=this.ck;a.dk=this.dk;a.Qj=this.Qj};za.prototype.toString=function(){return 22<this.re.length?'TextBlock("'+this.re.substring(0,20)+'"...)':'TextBlock("'+this.re+'")'};var jm;
za.None=jm=t.w(za,"None",0);var km;za.WrapFit=km=t.w(za,"WrapFit",1);var im;za.WrapDesiredSize=im=t.w(za,"WrapDesiredSize",2);var hm;za.OverflowClip=hm=t.w(za,"OverflowClip",0);var lm;za.OverflowEllipsis=lm=t.w(za,"OverflowEllipsis",1);za.prototype.ja=function(){V.prototype.ja.call(this);this.rz=this.sz=null};t.g(za,"font",za.prototype.font);
t.defineProperty(za,{font:"font"},function(){return this.$g},function(a){var b=this.$g;b!==a&&(e&&t.i(a,"string",za,"font"),this.$g=a,this.lo=null,this.ja(),this.j("font",b,a))});t.g(za,"text",za.prototype.text);t.defineProperty(za,{text:"text"},function(){return this.re},function(a){var b=this.re;a=null!==a&&void 0!==a?a.toString():"";b!==a&&(this.re=a,this.ja(),this.j("text",b,a))});t.g(za,"textAlign",za.prototype.textAlign);
t.defineProperty(za,{textAlign:"textAlign"},function(){return this.ae},function(a){var b=this.ae;b!==a&&(e&&t.i(a,"string",za,"textAlign"),"start"===a||"end"===a||"left"===a||"right"===a||"center"===a?(this.ae=a,this.na(),this.j("textAlign",b,a)):t.ha(a,'"start", "end", "left", "right", or "center"',za,"textAlign"))});
t.A(za,{Ja:"naturalBounds"},function(){if(!this.nd.P()){var a=mm(this,this.re,{},999999).width,b=nm(this,a,{}),c=this.Ea;isNaN(c.width)||(a=c.width);isNaN(c.height)||(b=c.height);ub(this.nd,a,b)}return this.nd});t.g(za,"isMultiline",za.prototype.kx);t.defineProperty(za,{kx:"isMultiline"},function(){return this.lr},function(a){var b=this.lr;b!==a&&(e&&t.i(a,"boolean",za,"isMultiline"),this.lr=a,this.ja(),this.j("isMultiline",b,a))});t.g(za,"isUnderline",za.prototype.yJ);
t.defineProperty(za,{yJ:"isUnderline"},function(){return this.jm},function(a){var b=this.jm;b!==a&&(e&&t.i(a,"boolean",za,"isUnderline"),this.jm=a,this.na(),this.j("isUnderline",b,a))});t.g(za,"isStrikethrough",za.prototype.wJ);t.defineProperty(za,{wJ:"isStrikethrough"},function(){return this.im},function(a){var b=this.im;b!==a&&(e&&t.i(a,"boolean",za,"isStrikethrough"),this.im=a,this.na(),this.j("isStrikethrough",b,a))});t.g(za,"wrap",za.prototype.OB);
t.defineProperty(za,{OB:"wrap"},function(){return this.Nm},function(a){var b=this.Nm;b!==a&&(e&&t.Fa(a,za,za,"wrap"),this.Nm=a,this.ja(),this.j("wrap",b,a))});t.g(za,"overflow",za.prototype.overflow);t.defineProperty(za,{overflow:"overflow"},function(){return this.cl},function(a){var b=this.cl;b!==a&&(e&&t.Fa(a,za,za,"overflow"),this.cl=a,this.ja(),this.j("overflow",b,a))});t.g(za,"stroke",za.prototype.stroke);
t.defineProperty(za,{stroke:"stroke"},function(){return this.Kb},function(a){var b=this.Kb;b!==a&&(e&&null!==a&&t.fp(a,"TextBlock.stroke"),a instanceof qa&&a.freeze(),this.Kb=a,this.na(),this.j("stroke",b,a))});t.A(za,{NF:"lineCount"},function(){return this.fh});t.g(za,"editable",za.prototype.Mw);t.defineProperty(za,{Mw:"editable"},function(){return this.Yq},function(a){var b=this.Yq;b!==a&&(e&&t.i(a,"boolean",za,"editable"),this.Yq=a,this.j("editable",b,a))});t.g(za,"textEditor",za.prototype.EB);
t.defineProperty(za,{EB:"textEditor"},function(){return this.Ms},function(a){var b=this.Ms;b!==a&&(a instanceof HTMLElement||t.m("textEditor must be an HTMLElement"),this.Ms=a,this.j("textEditor",b,a))});t.g(za,"errorFunction",za.prototype.pt);t.defineProperty(za,{pt:"errorFunction"},function(){return this.qf},function(a){var b=this.qf;b!==a&&(null!==a&&t.i(a,"function",za,"errorFunction"),this.qf=a,this.j("errorFunction",b,a))});function zk(a,b){var c=a.$g;null!==c&&b.su!==c&&(b.font=c,b.su=c)}
za.prototype.rl=function(a,b){if(null!==this.Kb&&0!==this.re.length&&null!==this.$g){var c=this.Ja.width,d=Hh(this);a.textAlign=this.ae;Ak(this,a,this.Kb,!0);(this.jm||this.im)&&Ak(this,a,this.Kb,!1);var f=this.Eo,g=0,h=!1,k=t.qc(0,0);this.se.Xa(k);var l=t.qc(0,d);this.se.Xa(l);var m=k.nk(l);t.B(k);t.B(l);k=b.scale;8>m*k*k&&(h=!0);for(var m=this.ck,k=this.dk,l=f.Ag.length,n=0;n<l;n++){var p=f.Ag[n],q=f.Tf[n];p>c&&(p=c);var g=g+m,r=q,q=a,s=g,u=c,w=d,D=0;h?("start"===this.ae||"left"===this.ae?D=0:"end"===
this.ae||"right"===this.ae?D=u-p:"center"===this.ae?D=(u-p)/2:t.m("textAlign must be start, end, left, right, or center"),q.fillRect(0+D,s+0.25*w,p,1)):("start"===this.ae||"left"===this.ae?D=0:"end"===this.ae||"right"===this.ae?D=u:"center"===this.ae?D=u/2:t.m("textAlign must be start, end, left, right, or center"),q.fillText(r,0+D,s+w-0.25*w),r=w/20|0,this.jm&&("end"===this.ae||"right"===this.ae?D-=p:"center"===this.ae&&(D-=p/2),q.beginPath(),q.lineWidth=r,q.moveTo(0+D,s+w-0.2*w),q.lineTo(0+D+p,
s+w-0.2*w),q.stroke()),this.im&&(q.beginPath(),q.lineWidth=r,s=s+w-w/2.2|0,0!==r%2&&(s+=0.5),q.moveTo(0,s),q.lineTo(0+p,s),q.stroke()));g+=d+k}}};
za.prototype.Kt=function(a,b,c,d){var f={},g=0,h=0;if(isNaN(this.Ea.width)){g=this.re;if(0===g.length)g=0;else if(this.kx){for(var k=h=0,l=!1,m={Bh:0};!l;){var n=om(g,k,m);-1===n&&(n=g.length,l=!0);k=pm(g.substr(k,n-k).replace(/^\s+|\s+$/g,""),this.$g);k>h&&(h=k);k=m.Bh}g=h}else h=om(g,0,{}),0<=h&&(g=g.substr(0,h)),g=k=pm(g,this.$g);g=Math.min(g,a/this.scale);g=Math.max(8,g)}else g=this.Ea.width;this.ia&&(g=Math.min(g,this.ia.Oe.width),g=Math.max(g,this.ia.Yf.width));h=nm(this,g,f);m=h=isNaN(this.Ea.height)?
Math.min(h,b/this.scale):this.Ea.height;if(0!==f.Gg&&1!==f.Tf.length&&this.cl===lm&&(b=this.$g,l=this.cl===lm?qm(b):0,k=this.ck+this.dk,k=Math.max(0,Hh(this)+k),m=Math.max(Math.floor(m/k)-1,0),!(m+1>=f.Tf.length))){k=f.Tf[m];for(a=Math.max(1,a-l);pm(k,b)>a&&1<k.length;)k=k.substr(0,k.length-1);k+=t.ot;a=pm(k,b);f.Tf[m]=k;f.Tf=f.Tf.slice(0,m+1);f.Ag[m]=a;f.Ag=f.Ag.slice(0,m+1);f.Bh=f.Tf.length;f.Gg=Math.max(f.Gg,a)}if(this.OB===km||isNaN(this.Ea.width))g=f.Gg,isNaN(this.Ea.width)&&(g=Math.max(8,g));
g=Math.max(c,g);h=Math.max(d,h);ub(this.nd,g,h);kk(this,0,0,g,h);this.Eo=f};za.prototype.ik=function(a,b,c,d){rk(this,a,b,c,d)};
function mm(a,b,c,d){b=b.replace(/^\s+|\s+$/g,"");void 0===c.Gg&&(c.Gg=0);void 0===c.Ag&&(c.Ag=[]);void 0===c.Tf&&(c.Tf=[]);var f=0,g,h,k=a.$g;g=a.ck+a.dk;var l=Math.max(0,Hh(a)+g),m=a.cl===lm?qm(k):0;if(!(a.fh>=a.Qj)){if(a.Nm===jm){c.Bh=1;g=pm(b,k);if(0===m||g<=d)return c.Gg=g,c.Ag.push(c.Gg),c.Tf.push(b),new ra(g,l);var n=rm(b);b=b.substr(n.length);h=rm(b);for(g=pm(n+h,k);0<h.length&&g<=d;)n+=h,b=b.substr(h.length),h=rm(b),g=pm((n+h).replace(/^\s+|\s+$/g,""),k);n+=h.replace(/^\s+|\s+$/g,"");for(d=
Math.max(1,d-m);pm(n,k)>d&&1<n.length;)n=n.substr(0,n.length-1);n+=t.ot;h=pm(n,k);c.Ag.push(h);c.Gg=h;c.Tf.push(n);return new ra(h,l)}m=0;0===b.length&&(m=1,c.Ag.push(0),c.Tf.push(b));for(;0<b.length;){n=rm(b);for(b=b.substr(n.length);pm(n,k)>d;){var p=1;g=pm(n.substr(0,p),k);for(h=0;g<=d;)p++,h=g,g=pm(n.substr(0,p),k);1===p?(c.Ag[m]=g,f=Math.max(f,g)):(c.Ag[m]=h,f=Math.max(f,h));p--;1>p&&(p=1);c.Tf[m]=n.substr(0,p);m++;if(a.fh+m===a.Qj)break;n=n.substr(p)}h=rm(b);for(g=pm(n+h,k);0<h.length&&g<=d;)n+=
h,b=b.substr(h.length),h=rm(b),g=pm((n+h).replace(/^\s+|\s+$/g,""),k);n=n.replace(/^\s+|\s+$/g,"");if(""!==n&&(0===h.length?(c.Ag.push(g),f=Math.max(f,g)):(h=pm(n,k),c.Ag.push(h),f=Math.max(f,h)),c.Tf.push(n),m++,a.fh+m===a.Qj))break}c.Bh=m;c.Gg=Math.max(c.Gg,f);return new ra(c.Gg,l*c.Bh)}}function rm(a){for(var b=a.length,c=0;c<b&&" "!==a.charAt(c);)c++;for(;c<b&&" "===a.charAt(c);)c++;return c>=b?a:a.substr(0,c)}function pm(a,b){t.fq!==b&&(t.Dn.font=b,t.fq=b);return t.Dn.measureText(a).width}
function Hh(a){if(null!==a.lo)return a.lo;var b=a.$g;t.fq!==b&&(t.Dn.font=b,t.fq=b);var c=0;void 0!==t.xA[b]&&5E3>t.dF?c=t.xA[b]:(c=1.3*t.Dn.measureText("M").width,t.xA[b]=c,t.dF++);return a.lo=c}function qm(a){t.fq!==a&&(t.Dn.font=a,t.fq=a);var b=0;void 0!==t.Uw[a]&&5E3>t.wA?b=t.Uw[a]:(b=t.Dn.measureText(t.ot).width,t.Uw[a]=b,t.wA++);return b}
function om(a,b,c){void 0===c.Bh&&(c.Bh=0);var d=a.indexOf("\r",b);-1===d&&(d=a.indexOf("\n",b));0<=d&&(c.Bh="\r"===a[d]&&d+1<a.length&&"\n"===a[d+1]?d+2:d+1);return d}
function nm(a,b,c){var d=a.re,f=a.ck+a.dk,f=Math.max(0,Hh(a)+f);if(0===d.length)return c.Gg=0,a.fh=1,f;if(!a.kx){var g=om(d,0,{});0<=g&&(d=d.substr(0,g))}for(var g=0,h=a.fh=0,k=-1,l={Bh:0},m=!1;!m;)k=om(d,h,l),-1===k&&(k=d.length,m=!0),h<=k&&(h=d.substr(h,k-h),a.Nm!==jm?(c.Bh=0,h=mm(a,h,c,b),g+=h.height,a.fh+=c.Bh):(mm(a,h,c,b),g+=f,a.fh++),a.fh===a.Qj&&(m=!0)),h=l.Bh;return a.sv=g}t.g(za,"textValidation",za.prototype.lu);
t.defineProperty(za,{lu:"textValidation"},function(){return this.fl},function(a){var b=this.fl;b!==a&&(null!==a&&t.i(a,"function",za,"textValidation"),this.fl=a,this.j("textValidation",b,a))});t.g(za,"spacingAbove",za.prototype.oK);t.defineProperty(za,{oK:"spacingAbove"},function(){return this.ck},function(a){var b=this.ck;b!==a&&(this.ck=a,this.j("spacingAbove",b,a))});t.g(za,"spacingBelow",za.prototype.pK);
t.defineProperty(za,{pK:"spacingBelow"},function(){return this.dk},function(a){var b=this.dk;b!==a&&(this.dk=a,this.j("spacingBelow",b,a))});t.g(za,"maxLines",za.prototype.KJ);t.defineProperty(za,{KJ:"maxLines"},function(){return this.Qj},function(a){var b=this.Qj;b!==a&&(this.Qj=a,this.j("maxLines",b,a))});function Xk(){V.call(this);this.jg=null;this.Es="";this.bk=(new F(NaN,NaN,NaN,NaN)).freeze();this.po=Sc;this.Ks=this.qf=null;this.jv=this.av=this.qm=!1}t.ka("Picture",Xk);t.Qa(Xk,V);var sm;
Xk.clearCache=sm=function(a){void 0===a&&(a="");t.i(a,"string",Xk,"clearCache:url");""!==a?t.yt[a]&&(delete t.yt[a],t.$w--):(t.yt={},t.$w=0)};Xk.prototype.cloneProtected=function(a){V.prototype.cloneProtected.call(this,a);a.element=this.jg;a.Es=this.Es;a.bk.assign(this.bk);a.po=this.po;a.qf=this.qf};Xk.prototype.toString=function(){return"Picture("+this.source+")#"+t.ud(this)};t.g(Xk,"element",Xk.prototype.element);
t.defineProperty(Xk,{element:"element"},function(){return this.jg},function(a){var b=this.jg;if(b!==a){a instanceof HTMLImageElement||a instanceof HTMLVideoElement||a instanceof HTMLCanvasElement||t.m("Picture.element must be an instance of Image, Canvas, or Video.");this.av=!1;var c=this;a instanceof HTMLCanvasElement?this.jv=!0:(this.jv=!1,a.onerror=function(a){c.av=!0;null!==c.qf&&c.qf(c,a)});this.jg=a;!0===a.complete||void 0===a.complete?(this.qm=!0,this.Ea.P()||(ok(this,!1),this.ja())):(t.KB.push(this),
null===t.zx&&(t.zx=setInterval(function(){for(var a=[],b=t.KB,c=b.length,h=0;h<c;h++){var k=b[h],l;l=k;var m=l.jg;if(m)if(m.complete){l.qm=!0;l.Ea.P()||(ok(l,!1),l.ja());if(l.h)l.Ea.P()||l.h.Sc(),l.h.na();else{l=t.oA;var n=l.length;if(0===n)for(var n=document.getElementsByTagName("canvas"),p=n.length,m=0;m<p;m++){var q=n[m];q.parentElement&&q.parentElement.W&&l.push(q.parentElement.W)}n=l.length;for(m=0;m<n;m++)l[m].na()}l=!0}else l=!1;else l=!0;l||a.push(k)}0===a.length&&(clearInterval(t.zx),t.zx=
null);t.KB=a},200)));this.j("element",b,a);this.na()}});t.g(Xk,"source",Xk.prototype.source);t.defineProperty(Xk,{source:"source"},function(){return this.Es},function(a){var b=this.Es;if(b!==a){t.i(a,"string",Xk,"source");this.Es=a;this.av=!1;var c=t.yt;if(void 0!==c[a])this.element=c[a];else{10<t.$w&&(sm(),c=t.yt);var d=document.createElement("img");d.src=a;c[a]=d;t.$w++;d instanceof HTMLImageElement&&(this.element=d)}this.na();this.j("source",b,a)}});t.g(Xk,"sourceRect",Xk.prototype.ti);
t.defineProperty(Xk,{ti:"sourceRect"},function(){return this.bk},function(a){var b=this.bk;b.O(a)||(t.l(a,F,Xk,"sourceRect"),this.bk=a=a.ba(),this.na(),this.j("sourceRect",b,a))});t.g(Xk,"imageStretch",Xk.prototype.nJ);t.defineProperty(Xk,{nJ:"imageStretch"},function(){return this.po},function(a){var b=this.po;b!==a&&(t.Fa(a,V,Xk,"imageStretch"),this.po=a,this.na(),this.j("imageStretch",b,a))});t.g(Xk,"errorFunction",Xk.prototype.pt);
t.defineProperty(Xk,{pt:"errorFunction"},function(){return this.qf},function(a){var b=this.qf;if(b!==a){null!==a&&t.i(a,"function",Xk,"errorFunction");this.qf=a;if(this.jg){var c=this;this.jg.onerror=function(a){null!==c.qf&&c.qf(c,a)}}this.j("errorFunction",b,a)}});
Xk.prototype.rl=function(a,b){if(!b.eo){if(null===this.Ks)if(null===this.jg)this.Ks=!1;else{var c=document.createElement("canvas").getContext("2d");0!==this.jg.width&&0!==this.jg.height&&c.drawImage(this.jg,0,0);try{c.getImageData(0,0,1,1),this.Ks=!1}catch(d){this.Ks=!0}}if(this.Ks)return}if(this.qm&&!this.av&&(c=this.jg,null!==c)){var f=c.src;null!==f&&""!==f||t.m("Element has no source attribute: "+c);var f=this.Ja,g=0,h=0,k=this.jv,l=k?+c.width:c.naturalWidth,k=k?+c.height:c.naturalHeight;void 0===
l&&c.videoWidth&&(l=c.videoWidth);void 0===k&&c.videoHeight&&(k=c.videoHeight);l=l||f.width;k=k||f.height;if(0!==l&&0!==k){this.ti.P()&&(g=this.bk.x,h=this.bk.y,l=this.bk.width,k=this.bk.height);var m=l,n=k,p=this.po;switch(p){case bh:if(this.ti.P())break;g+=Math.max((m-f.width)/2,0);h+=Math.max((n-f.height)/2,0);l=Math.min(f.width,m);k=Math.min(f.height,n);break;case Sc:m=f.width;n=f.height;break;case dh:case eh:p===dh?(p=Math.min(f.height/n,f.width/m),m*=p,n*=p):p===eh&&(p=Math.max(f.height/n,f.width/
m),m*=p,n*=p,g+=(m-f.width)/2,h+=(n-f.height)/2,l*=1/(m/f.width),k*=1/(n/f.height),m=f.width,n=f.height)}try{a.drawImage(c,g,h,l,k,Math.max((f.width-m)/2,0),Math.max((f.height-n)/2,0),Math.min(f.width,m),Math.min(f.height,n))}catch(q){}}}};t.A(Xk,{Ja:"naturalBounds"},function(){return this.nd});
Xk.prototype.Kt=function(a,b,c,d){var f=this.Ea,g=nk(this),h=this.jg,k=this.jv;if(k||!this.qm&&h&&h.complete)this.qm=!0;null===h&&(isFinite(a)||(a=0),isFinite(b)||(b=0));isFinite(f.width)||g===Sc||g===fk?(isFinite(a)||(a=this.ti.P()?this.ti.width:k?+h.width:h.naturalWidth),c=0):null!==h&&!1!==this.qm&&(a=this.ti.P()?this.ti.width:k?+h.width:h.naturalWidth);isFinite(f.height)||g===Sc||g===ek?(isFinite(b)||(b=this.ti.P()?this.ti.height:k?+h.height:h.naturalHeight),d=0):null!==h&&!1!==this.qm&&(b=this.ti.P()?
this.ti.height:k?+h.height:h.naturalHeight);isFinite(f.width)&&(a=f.width);isFinite(f.height)&&(b=f.height);f=this.Oe;g=this.Yf;c=Math.max(c,g.width);d=Math.max(d,g.height);a=Math.min(f.width,a);b=Math.min(f.height,b);a=Math.max(c,a);b=Math.max(d,b);null===h||h.complete||(isFinite(a)||(a=0),isFinite(b)||(b=0));ub(this.nd,a,b);kk(this,0,0,a,b)};Xk.prototype.ik=function(a,b,c,d){rk(this,a,b,c,d)};function ua(){this.s=new Pc;this.bc=null}aa=ua.prototype;aa.reset=function(){this.s=new Pc;this.bc=null};
function P(a,b,c,d,f,g){null===a.s&&t.m("StreamGeometryContext has been closed");void 0!==f&&!0===f?(null===a.bc&&t.m("Need to call beginFigure first"),d=new xd(kd),d.D=b,d.F=c,a.bc.Ka.add(d)):(a.bc=new Rc,a.bc.sa=b,a.bc.ta=c,a.bc.Cp=d,a.s.Fb.add(a.bc));void 0!==g&&(a.bc.vo=g)}function S(a){null===a.s&&t.m("StreamGeometryContext has been closed");null===a.bc&&t.m("Need to call beginFigure first");var b=a.bc.Ka.length;0<b&&a.bc.Ka.n[b-1].close()}
function hd(a){null===a.s&&t.m("StreamGeometryContext has been closed");null===a.bc&&t.m("Need to call beginFigure first");0<a.bc.Ka.length&&(a.bc.Cp=!0)}aa.jb=function(a){null===this.s&&t.m("StreamGeometryContext has been closed");null===this.bc&&t.m("Need to call beginFigure first");this.bc.qi=a};aa.moveTo=function(a,b,c){null===this.s&&t.m("StreamGeometryContext has been closed");null===this.bc&&t.m("Need to call beginFigure first");var d=new xd(kd);d.D=a;d.F=b;c&&d.close();this.bc.Ka.add(d)};
aa.lineTo=function(a,b,c){null===this.s&&t.m("StreamGeometryContext has been closed");null===this.bc&&t.m("Need to call beginFigure first");var d=new xd(bd);d.D=a;d.F=b;c&&d.close();this.bc.Ka.add(d)};function Q(a,b,c,d,f,g,h,k){null===a.s&&t.m("StreamGeometryContext has been closed");null===a.bc&&t.m("Need to call beginFigure first");var l=new xd(ld);l.Gb=b;l.Xb=c;l.ye=d;l.ze=f;l.D=g;l.F=h;k&&l.close();a.bc.Ka.add(l)}
function fd(a,b,c,d,f){null===a.s&&t.m("StreamGeometryContext has been closed");null===a.bc&&t.m("Need to call beginFigure first");var g=new xd(md);g.Gb=b;g.Xb=c;g.D=d;g.F=f;a.bc.Ka.add(g)}aa.arcTo=function(a,b,c,d,f,g,h){null===this.s&&t.m("StreamGeometryContext has been closed");null===this.bc&&t.m("Need to call beginFigure first");var k=new xd(sd);k.yh=a;k.vi=b;k.Ia=c;k.Ua=d;k.radiusX=f;k.radiusY=g?g:f;h&&k.close();this.bc.Ka.add(k)};
function gd(a,b,c,d,f,g,h,k){null===a.s&&t.m("StreamGeometryContext has been closed");null===a.bc&&t.m("Need to call beginFigure first");b=new xd(ud,h,k,b,c,d,f,g);a.bc.Ka.add(b)}
K.makeGeometry=function(a,b,c){var d=a.Ea,f=d.width,d=d.height;void 0!==b&&!isNaN(b)&&isFinite(b)&&(f=b);void 0!==c&&!isNaN(c)&&isFinite(c)&&(d=c);isFinite(f)||(f=100);isFinite(d)||(d=100);b=void 0;"None"!==a.Gn?b=K.Rm[a.Gn]:"None"!==a.Vw?b=K.Rm[a.Vw]:(c=K.oj[a.Eb],"string"===typeof c&&(c=K.oj[c]),void 0===c&&t.m("Unknown Shape.figure: "+a.Eb),b=c(a,f,d),b.to=f,b.so=d);void 0===b&&(c=K.oj.Rectangle)&&(b=c(a,f,d));return b};
K.hj=function(a,b,c,d,f,g,h,k,l,m,n,p,q,r){var s=1-l;a=a*s+c*l;b=b*s+d*l;c=c*s+f*l;d=d*s+g*l;f=f*s+h*l;g=g*s+k*l;k=a*s+c*l;h=b*s+d*l;c=c*s+f*l;d=d*s+g*l;m.x=a;m.y=b;n.x=k;n.y=h;p.x=k*s+c*l;p.y=h*s+d*l;q.x=c;q.y=d;r.x=f;r.y=g};K.ip=function(a){a=K.an(a);var b=t.Hb();b[0]=a[0];for(var c=1,d=1;c<a.length;c+=2,d+=3)b[d]=a[c],b[d+1]=a[c],b[d+2]=a[c+1];t.Ca(a);return b};
K.an=function(a){var b=K.pl(a),c=t.Hb(),d=Math.floor(b.length/2),f=b.length-1;a=0===a%2?2:1;for(var g=0;g<f;g++){var h=b[g],k=b[g+1],l=b[(d+g-1)%f],m=b[(d+g+a)%f];c[2*g]=h;c[2*g+1]=K.wl(h.x,h.y,l.x,l.y,k.x,k.y,m.x,m.y,new E)}c[c.length]=c[0];t.Ca(b);return c};K.wl=function(a,b,c,d,f,g,h,k,l){c=a-c;h=f-h;0===c||0===h?0===c?(h=(g-k)/h,k=a,f=h*k+(g-h*f)):(d=(b-d)/c,k=f,f=d*k+(b-d*a)):(d=(b-d)/c,h=(g-k)/h,a=b-d*a,k=(g-h*f-a)/(d-h),f=d*k+a);l.p(k,f);return l};
K.pl=function(a){for(var b=t.Hb(),c=1.5*Math.PI,d=0,f=0;f<a;f++)d=2*Math.PI/a*f+c,b[f]=new E(0.5+0.5*Math.cos(d),0.5+0.5*Math.sin(d));b.push(b[0]);return b};K.RB=(new L(0.156,0.156)).Oa();K.SB=(new L(0.844,0.844)).Oa();
K.oj={None:"Rectangle",Rectangle:function(a,b,c){a=new Pc;a.type=Uc;a.sa=0;a.ta=0;a.D=b;a.F=c;return a},Square:function(a,b,c){a=new Pc;a.Ac=dh;a.type=Uc;a.sa=0;a.ta=0;a.D=b;a.F=c;return a},Ellipse:function(a,b,c){a=new Pc;a.type=$c;a.sa=0;a.ta=0;a.D=b;a.F=c;a.G=K.RB;a.H=K.SB;return a},Circle:function(a,b,c){a=new Pc;a.Ac=dh;a.type=$c;a.sa=0;a.ta=0;a.D=b;a.F=c;a.G=K.RB;a.H=K.SB;return a},Connector:"Ellipse",TriangleRight:function(a,b,c){a=new Pc;var d=new Rc,f=new xd;f.D=b;f.F=0.5*c;d.Ka.add(f);b=
new xd;b.D=0;b.F=c;d.Ka.add(b.close());a.Fb.add(d);a.G=new L(0,0.25);a.H=new L(0.5,0.75);return a},TriangleDown:function(a,b,c){a=new Pc;var d=new Rc,f=new xd;f.D=b;f.F=0;d.Ka.add(f);f=new xd;f.D=0.5*b;f.F=c;d.Ka.add(f.close());a.Fb.add(d);a.G=new L(0.25,0);a.H=new L(0.75,0.5);return a},TriangleLeft:function(a,b,c){a=new Pc;var d=new Rc;d.sa=b;d.ta=c;var f=new xd;f.D=0;f.F=0.5*c;d.Ka.add(f);c=new xd;c.D=b;c.F=0;d.Ka.add(c.close());a.Fb.add(d);a.G=new L(0.5,0.25);a.H=new L(1,0.75);return a},TriangleUp:function(a,
b,c){a=new Pc;var d=new Rc;d.sa=b;d.ta=c;var f=new xd;f.D=0;f.F=c;d.Ka.add(f);c=new xd;c.D=0.5*b;c.F=0;d.Ka.add(c.close());a.Fb.add(d);a.G=new L(0.25,0.5);a.H=new L(0.75,1);return a},Line1:function(a,b,c){a=new Pc;a.type=Tc;a.sa=0;a.ta=0;a.D=b;a.F=c;return a},Line2:function(a,b,c){a=new Pc;a.type=Tc;a.sa=b;a.ta=0;a.D=0;a.F=c;return a},MinusLine:"LineH",LineH:function(a,b,c){a=new Pc;a.type=Tc;a.sa=0;a.ta=c/2;a.D=b;a.F=c/2;return a},LineV:function(a,b,c){a=new Pc;a.type=Tc;a.sa=b/2;a.ta=0;a.D=b/2;
a.F=c;return a},Curve1:function(a,b,c){var d=K.za;a=t.u();P(a,0,0,!1);Q(a,d*b,0,1*b,(1-d)*c,b,c);b=a.s;t.v(a);return b},Curve2:function(a,b,c){var d=K.za;a=t.u();P(a,0,0,!1);Q(a,0,d*c,(1-d)*b,c,b,c);b=a.s;t.v(a);return b},Curve3:function(a,b,c){var d=K.za;a=t.u();P(a,1*b,0,!1);Q(a,1*b,d*c,d*b,1*c,0,1*c);b=a.s;t.v(a);return b},Curve4:function(a,b,c){var d=K.za;a=t.u();P(a,1*b,0,!1);Q(a,(1-d)*b,0,0,(1-d)*c,0,1*c);b=a.s;t.v(a);return b},Alternative:"Triangle",Merge:"Triangle",Triangle:function(a,b,c){a=
t.u();P(a,0.5*b,0*c,!0);a.lineTo(0*b,1*c);a.lineTo(1*b,1*c,!0);b=a.s;b.G=new L(0.25,0.5);b.H=new L(0.75,1);t.v(a);return b},Decision:"Diamond",Diamond:function(a,b,c){a=t.u();P(a,0.5*b,0,!0);a.lineTo(0,0.5*c);a.lineTo(0.5*b,1*c);a.lineTo(1*b,0.5*c,!0);b=a.s;b.G=new L(0.25,0.25);b.H=new L(0.75,0.75);t.v(a);return b},Pentagon:function(a,b,c){var d=K.pl(5);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;5>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.2,0.22);b.H=new L(0.8,0.9);t.v(a);
return b},DataTransmission:"Hexagon",Hexagon:function(a,b,c){var d=K.pl(6);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;6>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.07,0.25);b.H=new L(0.93,0.75);t.v(a);return b},Heptagon:function(a,b,c){var d=K.pl(7);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;7>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.2,0.15);b.H=new L(0.8,0.85);t.v(a);return b},Octagon:function(a,b,c){var d=K.pl(8);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);
for(var f=1;8>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.15,0.15);b.H=new L(0.85,0.85);t.v(a);return b},Nonagon:function(a,b,c){var d=K.pl(9);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;9>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.17,0.13);b.H=new L(0.82,0.82);t.v(a);return b},Decagon:function(a,b,c){var d=K.pl(10);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;10>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.16,0.16);b.H=new L(0.84,
0.84);t.v(a);return b},Dodecagon:function(a,b,c){var d=K.pl(12);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;12>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.16,0.16);b.H=new L(0.84,0.84);t.v(a);return b},FivePointedStar:function(a,b,c){var d=K.an(5);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;10>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.312,0.383);b.H=new L(0.693,0.765);t.v(a);return b},SixPointedStar:function(a,b,c){var d=K.an(6);a=t.u();P(a,d[0].x*b,
d[0].y*c,!0);for(var f=1;12>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.17,0.251);b.H=new L(0.833,0.755);t.v(a);return b},SevenPointedStar:function(a,b,c){var d=K.an(7);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;14>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.363,0.361);b.H=new L(0.641,0.709);t.v(a);return b},EightPointedStar:function(a,b,c){var d=K.an(8);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;16>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;
b.G=new L(0.252,0.255);b.H=new L(0.75,0.75);t.v(a);return b},NinePointedStar:function(a,b,c){var d=K.an(9);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;18>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.355,0.361);b.H=new L(0.645,0.651);t.v(a);return b},TenPointedStar:function(a,b,c){var d=K.an(10);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;20>f;f++)a.lineTo(d[f].x*b,d[f].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.281,0.261);b.H=new L(0.723,0.748);t.v(a);return b},FivePointedBurst:function(a,
b,c){var d=K.ip(5);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;f<d.length;f+=3)Q(a,d[f].x*b,d[f].y*c,d[f+1].x*b,d[f+1].y*c,d[f+2].x*b,d[f+2].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.312,0.383);b.H=new L(0.693,0.765);t.v(a);return b},SixPointedBurst:function(a,b,c){var d=K.ip(6);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;f<d.length;f+=3)Q(a,d[f].x*b,d[f].y*c,d[f+1].x*b,d[f+1].y*c,d[f+2].x*b,d[f+2].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.17,0.251);b.H=new L(0.833,0.755);t.v(a);return b},SevenPointedBurst:function(a,
b,c){var d=K.ip(7);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;f<d.length;f+=3)Q(a,d[f].x*b,d[f].y*c,d[f+1].x*b,d[f+1].y*c,d[f+2].x*b,d[f+2].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.363,0.361);b.H=new L(0.641,0.709);t.v(a);return b},EightPointedBurst:function(a,b,c){var d=K.ip(8);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;f<d.length;f+=3)Q(a,d[f].x*b,d[f].y*c,d[f+1].x*b,d[f+1].y*c,d[f+2].x*b,d[f+2].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.252,0.255);b.H=new L(0.75,0.75);t.v(a);return b},NinePointedBurst:function(a,
b,c){var d=K.ip(9);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;f<d.length;f+=3)Q(a,d[f].x*b,d[f].y*c,d[f+1].x*b,d[f+1].y*c,d[f+2].x*b,d[f+2].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.355,0.361);b.H=new L(0.645,0.651);t.v(a);return b},TenPointedBurst:function(a,b,c){var d=K.ip(10);a=t.u();P(a,d[0].x*b,d[0].y*c,!0);for(var f=1;f<d.length;f+=3)Q(a,d[f].x*b,d[f].y*c,d[f+1].x*b,d[f+1].y*c,d[f+2].x*b,d[f+2].y*c);t.Ca(d);S(a);b=a.s;b.G=new L(0.281,0.261);b.H=new L(0.723,0.748);t.v(a);return b},Cloud:function(a,
b,c){a=t.u();P(a,0.08034461*b,0.1944299*c,!0);Q(a,-0.09239631*b,0.07836421*c,0.1406031*b,-0.0542823*c,0.2008615*b,0.05349299*c);Q(a,0.2450511*b,-0.00697547*c,0.3776197*b,-0.01112067*c,0.4338609*b,0.074219*c);Q(a,0.4539471*b,0,0.6066018*b,-0.02526587*c,0.6558228*b,0.07004196*c);Q(a,0.6914277*b,-0.01904177*c,0.8921095*b,-0.01220843*c,0.8921095*b,0.08370865*c);Q(a,1.036446*b,0.04105738*c,1.020377*b,0.3022052*c,0.9147671*b,0.3194596*c);Q(a,1.04448*b,0.360238*c,0.992256*b,0.5219009*c,0.9082935*b,0.562044*
c);Q(a,1.032337*b,0.5771781*c,1.018411*b,0.8120651*c,0.9212406*b,0.8217117*c);Q(a,1.028411*b,0.9571472*c,0.8556702*b,1.052487*c,0.7592566*b,0.9156953*c);Q(a,0.7431877*b,1.009325*c,0.5624123*b,1.021761*c,0.5101666*b,0.9310455*c);Q(a,0.4820677*b,1.031761*c,0.3030112*b,1.002796*c,0.2609328*b,0.9344623*c);Q(a,0.2329994*b,1.01518*c,0.03213784*b,1.01518*c,0.08034461*b,0.870098*c);Q(a,-0.02812061*b,0.9032597*c,-0.01205169*b,0.6835638*c,0.06829292*b,0.6545475*c);Q(a,-0.01812061*b,0.6089503*c,-0.00606892*
b,0.4555777*c,0.06427569*b,0.4265613*c);Q(a,-0.01606892*b,0.3892545*c,-0.01205169*b,0.1944299*c,0.08034461*b,0.1944299*c);S(a);b=a.s;b.G=new L(0.1,0.1);b.H=new L(0.9,0.9);t.v(a);return b},Gate:"Crescent",Crescent:function(a,b,c){a=t.u();P(a,0,0,!0);Q(a,1*b,0,1*b,1*c,0,1*c);Q(a,0.5*b,0.75*c,0.5*b,0.25*c,0,0);S(a);b=a.s;b.G=new L(0.511,0.19);b.H=new L(0.776,0.76);t.v(a);return b},FramedRectangle:function(a,b,c){var d=t.u(),f=a?a.Kc:0;a=a?a.Vt:0;0===f&&(f=0.1);0===a&&(a=0.1);P(d,0,0,!0);d.lineTo(1*b,
0);d.lineTo(1*b,1*c);d.lineTo(0,1*c,!0);P(d,f*b,a*c,!1,!0);d.lineTo(f*b,(1-a)*c);d.lineTo((1-f)*b,(1-a)*c);d.lineTo((1-f)*b,a*c,!0);b=d.s;b.G=new L(f,a);b.H=new L(1-f,1-a);t.v(d);return b},Delay:"HalfEllipse",HalfEllipse:function(a,b,c){var d=K.za;a=t.u();P(a,0,0,!0);Q(a,d*b,0,1*b,(0.5-d/2)*c,1*b,0.5*c);Q(a,1*b,(0.5+d/2)*c,d*b,1*c,0,1*c);S(a);b=a.s;b.G=new L(0,0.2);b.H=new L(0.75,0.8);t.v(a);return b},Heart:function(a,b,c){a=t.u();P(a,0.5*b,1*c,!0);Q(a,0.1*b,0.8*c,0,0.5*c,0*b,0.3*c);Q(a,0*b,0,0.45*
b,0,0.5*b,0.3*c);Q(a,0.55*b,0,1*b,0,1*b,0.3*c);Q(a,b,0.5*c,0.9*b,0.8*c,0.5*b,1*c);S(a);b=a.s;b.G=new L(0.15,0.29);b.H=new L(0.86,0.68);t.v(a);return b},Spade:function(a,b,c){a=t.u();P(a,0.5*b,0,!0);a.lineTo(0.51*b,0.01*c);Q(a,0.6*b,0.2*c,b,0.25*c,b,0.5*c);Q(a,b,0.8*c,0.6*b,0.8*c,0.55*b,0.7*c);Q(a,0.5*b,0.75*c,0.55*b,0.95*c,0.75*b,c);a.lineTo(0.25*b,c);Q(a,0.45*b,0.95*c,0.5*b,0.75*c,0.45*b,0.7*c);Q(a,0.4*b,0.8*c,0,0.8*c,0,0.5*c);Q(a,0,0.25*c,0.4*b,0.2*c,0.49*b,0.01*c);S(a);b=a.s;b.G=new L(0.19,0.26);
b.H=new L(0.8,0.68);t.v(a);return b},Club:function(a,b,c){a=t.u();P(a,0.4*b,0.6*c,!0);Q(a,0.5*b,0.75*c,0.45*b,0.95*c,0.15*b,1*c);a.lineTo(0.85*b,c);Q(a,0.55*b,0.95*c,0.5*b,0.75*c,0.6*b,0.6*c);var d=0.2,f=0.3,g=0,h=4*(Math.SQRT2-1)/3*d;Q(a,(0.5-d+f)*b,(0.5+h+g)*c,(0.5-h+f)*b,(0.5+d+g)*c,(0.5+f)*b,(0.5+d+g)*c);Q(a,(0.5+h+f)*b,(0.5+d+g)*c,(0.5+d+f)*b,(0.5+h+g)*c,(0.5+d+f)*b,(0.5+g)*c);Q(a,(0.5+d+f)*b,(0.5-h+g)*c,(0.5+h+f)*b,(0.5-d+g)*c,(0.5+f)*b,(0.5-d+g)*c);Q(a,(0.5-h+f)*b,(0.5-d+g)*c,(0.5-d+f+0.05)*
b,(0.5-h+g-0.02)*c,0.65*b,0.36771243*c);d=0.2;f=0;g=-0.3;h=4*(Math.SQRT2-1)/3*d;Q(a,(0.5+h+f)*b,(0.5+d+g)*c,(0.5+d+f)*b,(0.5+h+g)*c,(0.5+d+f)*b,(0.5+g)*c);Q(a,(0.5+d+f)*b,(0.5-h+g)*c,(0.5+h+f)*b,(0.5-d+g)*c,(0.5+f)*b,(0.5-d+g)*c);Q(a,(0.5-h+f)*b,(0.5-d+g)*c,(0.5-d+f)*b,(0.5-h+g)*c,(0.5-d+f)*b,(0.5+g)*c);Q(a,(0.5-d+f)*b,(0.5+h+g)*c,(0.5-h+f)*b,(0.5+d+g)*c,0.35*b,0.36771243*c);d=0.2;f=-0.3;g=0;h=4*(Math.SQRT2-1)/3*d;Q(a,(0.5+d+f-0.05)*b,(0.5-h+g-0.02)*c,(0.5+h+f)*b,(0.5-d+g)*c,(0.5+f)*b,(0.5-d+g)*c);
Q(a,(0.5-h+f)*b,(0.5-d+g)*c,(0.5-d+f)*b,(0.5-h+g)*c,(0.5-d+f)*b,(0.5+g)*c);Q(a,(0.5-d+f)*b,(0.5+h+g)*c,(0.5-h+f)*b,(0.5+d+g)*c,(0.5+f)*b,(0.5+d+g)*c);Q(a,(0.5+h+f)*b,(0.5+d+g)*c,(0.5+d+f)*b,(0.5+h+g)*c,0.4*b,0.6*c);S(a);b=a.s;b.G=new L(0.06,0.39);b.H=new L(0.93,0.58);t.v(a);return b},Ring:function(a,b,c){a=t.u();var d=4*(Math.SQRT2-1)/3*0.5;P(a,b,0.5*c,!0);Q(a,b,(0.5-d)*c,(0.5+d)*b,0,0.5*b,0);Q(a,(0.5-d)*b,0,0,(0.5-d)*c,0,0.5*c);Q(a,0,(0.5+d)*c,(0.5-d)*b,c,0.5*b,c);Q(a,(0.5+d)*b,c,b,(0.5+d)*c,b,0.5*
c);d=4*(Math.SQRT2-1)/3*0.4;P(a,0.5*b,0.1*c,!0,!0);Q(a,(0.5+d)*b,0.1*c,0.9*b,(0.5-d)*c,0.9*b,0.5*c);Q(a,0.9*b,(0.5+d)*c,(0.5+d)*b,0.9*c,0.5*b,0.9*c);Q(a,(0.5-d)*b,0.9*c,0.1*b,(0.5+d)*c,0.1*b,0.5*c);Q(a,0.1*b,(0.5-d)*c,(0.5-d)*b,0.1*c,0.5*b,0.1*c);b=a.s;b.G=new L(0.146,0.146);b.H=new L(0.853,0.853);b.Ac=dh;t.v(a);return b},YinYang:function(a,b,c){var d=0.5;a=t.u();d=0.5;P(a,0.5*b,0,!0);a.arcTo(270,180,0.5*b,0.5*b,0.5*b);Q(a,1*b,d*c,0,d*c,d*b,0,!0);var d=0.1,f=0.25;P(a,(0.5+d)*b,f*c,!0,!0);a.arcTo(0,
-360,0.5*b,c*f,d*b);S(a);P(a,0.5*b,0,!1);a.arcTo(270,-180,0.5*b,0.5*b,0.5*b);a.jb(!1);f=0.75;P(a,(0.5+d)*b,f*c,!0);a.arcTo(0,360,0.5*b,c*f,d*b);S(a);b=a.s;b.Ac=dh;t.v(a);return b},Peace:function(a,b,c){a=t.u();var d=4*(Math.SQRT2-1)/3*0.5;P(a,b,0.5*c,!0);Q(a,b,(0.5-d)*c,(0.5+d)*b,0,0.5*b,0);Q(a,(0.5-d)*b,0,0,(0.5-d)*c,0,0.5*c);Q(a,0,(0.5+d)*c,(0.5-d)*b,c,0.5*b,c);Q(a,(0.5+d)*b,c,b,(0.5+d)*c,b,0.5*c);d=4*(Math.SQRT2-1)/3*0.4;P(a,0.5*b,0.1*c,!0,!0);Q(a,(0.5+d)*b,0.1*c,0.9*b,(0.5-d)*c,0.9*b,0.5*c);Q(a,
0.9*b,(0.5+d)*c,(0.5+d)*b,0.9*c,0.5*b,0.9*c);Q(a,(0.5-d)*b,0.9*c,0.1*b,(0.5+d)*c,0.1*b,0.5*c);Q(a,0.1*b,(0.5-d)*c,(0.5-d)*b,0.1*c,0.5*b,0.1*c);var d=0.07,f=0,g=-0.707*0.11,h=4*(Math.SQRT2-1)/3*d;P(a,(0.5+d+f)*b,(0.5+g)*c,!0);Q(a,(0.5+d+f)*b,(0.5-h+g)*c,(0.5+h+f)*b,(0.5-d+g)*c,(0.5+f)*b,(0.5-d+g)*c);Q(a,(0.5-h+f)*b,(0.5-d+g)*c,(0.5-d+f)*b,(0.5-h+g)*c,(0.5-d+f)*b,(0.5+g)*c);Q(a,(0.5-d+f)*b,(0.5+h+g)*c,(0.5-h+f)*b,(0.5+d+g)*c,(0.5+f)*b,(0.5+d+g)*c);Q(a,(0.5+h+f)*b,(0.5+d+g)*c,(0.5+d+f)*b,(0.5+h+g)*c,
(0.5+d+f)*b,(0.5+g)*c);d=0.07;f=-0.707*0.11;g=0.707*0.11;h=4*(Math.SQRT2-1)/3*d;P(a,(0.5+d+f)*b,(0.5+g)*c,!0);Q(a,(0.5+d+f)*b,(0.5-h+g)*c,(0.5+h+f)*b,(0.5-d+g)*c,(0.5+f)*b,(0.5-d+g)*c);Q(a,(0.5-h+f)*b,(0.5-d+g)*c,(0.5-d+f)*b,(0.5-h+g)*c,(0.5-d+f)*b,(0.5+g)*c);Q(a,(0.5-d+f)*b,(0.5+h+g)*c,(0.5-h+f)*b,(0.5+d+g)*c,(0.5+f)*b,(0.5+d+g)*c);Q(a,(0.5+h+f)*b,(0.5+d+g)*c,(0.5+d+f)*b,(0.5+h+g)*c,(0.5+d+f)*b,(0.5+g)*c);d=0.07;f=0.707*0.11;g=0.707*0.11;h=4*(Math.SQRT2-1)/3*d;P(a,(0.5+d+f)*b,(0.5+g)*c,!0);Q(a,(0.5+
d+f)*b,(0.5-h+g)*c,(0.5+h+f)*b,(0.5-d+g)*c,(0.5+f)*b,(0.5-d+g)*c);Q(a,(0.5-h+f)*b,(0.5-d+g)*c,(0.5-d+f)*b,(0.5-h+g)*c,(0.5-d+f)*b,(0.5+g)*c);Q(a,(0.5-d+f)*b,(0.5+h+g)*c,(0.5-h+f)*b,(0.5+d+g)*c,(0.5+f)*b,(0.5+d+g)*c);Q(a,(0.5+h+f)*b,(0.5+d+g)*c,(0.5+d+f)*b,(0.5+h+g)*c,(0.5+d+f)*b,(0.5+g)*c);b=a.s;b.G=new L(0.146,0.146);b.H=new L(0.853,0.853);b.Ac=dh;t.v(a);return b},NotAllowed:function(a,b,c){var d=K.za,f=0.5*d,g=0.5;a=t.u();P(a,0.5*b,(0.5-g)*c,!0);Q(a,(0.5-f)*b,(0.5-g)*c,(0.5-g)*b,(0.5-f)*c,(0.5-
g)*b,0.5*c);Q(a,(0.5-g)*b,(0.5+f)*c,(0.5-f)*b,(0.5+g)*c,0.5*b,(0.5+g)*c);Q(a,(0.5+f)*b,(0.5+g)*c,(0.5+g)*b,(0.5+f)*c,(0.5+g)*b,0.5*c);Q(a,(0.5+g)*b,(0.5-f)*c,(0.5+f)*b,(0.5-g)*c,0.5*b,(0.5-g)*c);var g=0.4,f=0.4*d,d=t.N(),h=t.N(),k=t.N(),l=t.N();K.hj(0.5,0.5-g,0.5+f,0.5-g,0.5+g,0.5-f,0.5+g,0.5,0.42,d,h,k,l,l);var m=t.N(),n=t.N(),p=t.N();K.hj(0.5,0.5-g,0.5+f,0.5-g,0.5+g,0.5-f,0.5+g,0.5,0.58,l,l,p,m,n);var q=t.N(),r=t.N(),s=t.N();K.hj(0.5,0.5+g,0.5-f,0.5+g,0.5-g,0.5+f,0.5-g,0.5,0.42,q,r,s,l,l);var u=
t.N(),w=t.N(),D=t.N();K.hj(0.5,0.5+g,0.5-f,0.5+g,0.5-g,0.5+f,0.5-g,0.5,0.58,l,l,D,u,w);P(a,D.x*b,D.y*c,!0,!0);Q(a,u.x*b,u.y*c,w.x*b,w.y*c,(0.5-g)*b,0.5*c);Q(a,(0.5-g)*b,(0.5-f)*c,(0.5-f)*b,(0.5-g)*c,0.5*b,(0.5-g)*c);Q(a,d.x*b,d.y*c,h.x*b,h.y*c,k.x*b,k.y*c);a.lineTo(D.x*b,D.y*c);S(a);P(a,s.x*b,s.y*c,!0,!0);a.lineTo(p.x*b,p.y*c);Q(a,m.x*b,m.y*c,n.x*b,n.y*c,(0.5+g)*b,0.5*c);Q(a,(0.5+g)*b,(0.5+f)*c,(0.5+f)*b,(0.5+g)*c,0.5*b,(0.5+g)*c);Q(a,q.x*b,q.y*c,r.x*b,r.y*c,s.x*b,s.y*c);S(a);t.B(d);t.B(h);t.B(k);
t.B(l);t.B(m);t.B(n);t.B(p);t.B(q);t.B(r);t.B(s);t.B(u);t.B(w);t.B(D);b=a.s;t.v(a);b.Ac=dh;return b},Fragile:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(0.25*b,0);a.lineTo(0.2*b,0.15*c);a.lineTo(0.3*b,0.25*c);a.lineTo(0.29*b,0.33*c);a.lineTo(0.35*b,0.25*c);a.lineTo(0.3*b,0.15*c);a.lineTo(0.4*b,0);a.lineTo(1*b,0);Q(a,1*b,0.25*c,0.75*b,0.5*c,0.55*b,0.5*c);a.lineTo(0.55*b,0.9*c);a.lineTo(0.7*b,0.9*c);a.lineTo(0.7*b,1*c);a.lineTo(0.3*b,1*c);a.lineTo(0.3*b,0.9*c);a.lineTo(0.45*b,0.9*c);a.lineTo(0.45*
b,0.5*c);Q(a,0.25*b,0.5*c,0,0.25*c,0,0);S(a);b=a.s;b.G=new L(0.25,0);b.H=new L(0.75,0.4);t.v(a);return b},HourGlass:function(a,b,c){a=t.u();P(a,0.65*b,0.5*c,!0);a.lineTo(1*b,1*c);a.lineTo(0,1*c);a.lineTo(0.35*b,0.5*c);a.lineTo(0,0);a.lineTo(1*b,0);S(a);b=a.s;t.v(a);return b},Lightning:function(a,b,c){a=t.u();P(a,0*b,0.55*c,!0);a.lineTo(0.75*b,0);a.lineTo(0.25*b,0.45*c);a.lineTo(0.9*b,0.48*c);a.lineTo(0.4*b,1*c);a.lineTo(0.65*b,0.55*c);S(a);b=a.s;t.v(a);return b},Parallelogram1:function(a,b,c){a=a?
a.Kc:0;0===a&&(a=0.1);var d=t.u();P(d,a*b,0,!0);d.lineTo(1*b,0);d.lineTo((1-a)*b,1*c);d.lineTo(0,1*c);S(d);b=d.s;b.G=new L(a,0);b.H=new L(1-a,1);t.v(d);return b},Input:"Output",Output:function(a,b,c){a=t.u();P(a,0,1*c,!0);a.lineTo(0.1*b,0);a.lineTo(1*b,0);a.lineTo(0.9*b,1*c);S(a);b=a.s;b.G=new L(0.1,0);b.H=new L(0.9,1);t.v(a);return b},Parallelogram2:function(a,b,c){a=a?a.Kc:0;0===a&&(a=0.25);var d=t.u();P(d,a*b,0,!0);d.lineTo(1*b,0);d.lineTo((1-a)*b,1*c);d.lineTo(0,1*c);S(d);b=d.s;b.G=new L(a,0);
b.H=new L(1-a,1);t.v(d);return b},ThickCross:function(a,b,c){a=a?a.Kc:0;0===a&&(a=0.25);var d=t.u();P(d,(0.5-a/2)*b,0,!0);d.lineTo((0.5+a/2)*b,0);d.lineTo((0.5+a/2)*b,(0.5-a/2)*c);d.lineTo(1*b,(0.5-a/2)*c);d.lineTo(1*b,(0.5+a/2)*c);d.lineTo((0.5+a/2)*b,(0.5+a/2)*c);d.lineTo((0.5+a/2)*b,1*c);d.lineTo((0.5-a/2)*b,1*c);d.lineTo((0.5-a/2)*b,(0.5+a/2)*c);d.lineTo(0,(0.5+a/2)*c);d.lineTo(0,(0.5-a/2)*c);d.lineTo((0.5-a/2)*b,(0.5-a/2)*c);S(d);b=d.s;b.G=new L(0.5-a/2,0.5-a/2);b.H=new L(0.5+a/2,0.5+a/2);t.v(d);
return b},ThickX:function(a,b,c){a=0.25/Math.SQRT2;var d=t.u();P(d,0.3*b,0,!0);d.lineTo(0.5*b,0.2*c);d.lineTo(0.7*b,0);d.lineTo(1*b,0.3*c);d.lineTo(0.8*b,0.5*c);d.lineTo(1*b,0.7*c);d.lineTo(0.7*b,1*c);d.lineTo(0.5*b,0.8*c);d.lineTo(0.3*b,1*c);d.lineTo(0,0.7*c);d.lineTo(0.2*b,0.5*c);d.lineTo(0,0.3*c);S(d);b=d.s;b.G=new L(0.5-a,0.5-a);b.H=new L(0.5+a,0.5+a);t.v(d);return b},ThinCross:function(a,b,c){var d=a?a.Kc:0;0===d&&(d=0.1);a=t.u();P(a,(0.5-d/2)*b,0,!0);a.lineTo((0.5+d/2)*b,0);a.lineTo((0.5+d/
2)*b,(0.5-d/2)*c);a.lineTo(1*b,(0.5-d/2)*c);a.lineTo(1*b,(0.5+d/2)*c);a.lineTo((0.5+d/2)*b,(0.5+d/2)*c);a.lineTo((0.5+d/2)*b,1*c);a.lineTo((0.5-d/2)*b,1*c);a.lineTo((0.5-d/2)*b,(0.5+d/2)*c);a.lineTo(0,(0.5+d/2)*c);a.lineTo(0,(0.5-d/2)*c);a.lineTo((0.5-d/2)*b,(0.5-d/2)*c);S(a);b=a.s;t.v(a);return b},ThinX:function(a,b,c){a=t.u();P(a,0.1*b,0,!0);a.lineTo(0.5*b,0.4*c);a.lineTo(0.9*b,0);a.lineTo(1*b,0.1*c);a.lineTo(0.6*b,0.5*c);a.lineTo(1*b,0.9*c);a.lineTo(0.9*b,1*c);a.lineTo(0.5*b,0.6*c);a.lineTo(0.1*
b,1*c);a.lineTo(0,0.9*c);a.lineTo(0.4*b,0.5*c);a.lineTo(0,0.1*c);S(a);return a.s},RightTriangle:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(1*b,1*c);a.lineTo(0,1*c);S(a);b=a.s;b.G=new L(0,0.5);b.H=new L(0.5,1);t.v(a);return b},RoundedIBeam:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(1*b,0);Q(a,0.5*b,0.25*c,0.5*b,0.75*c,1*b,1*c);a.lineTo(0,1*c);Q(a,0.5*b,0.75*c,0.5*b,0.25*c,0,0);S(a);b=a.s;t.v(a);return b},RoundedRectangle:function(a,b,c){var d=a?a.Kc:0;0>=d&&(d=5);d=Math.min(d,b/3);d=Math.min(d,
c/3);a=d*K.za;var f=t.u();P(f,d,0,!0);f.lineTo(b-d,0);Q(f,b-a,0,b,a,b,d);f.lineTo(b,c-d);Q(f,b,c-a,b-a,c,b-d,c);f.lineTo(d,c);Q(f,a,c,0,c-a,0,c-d);f.lineTo(0,d);Q(f,0,a,a,0,d,0);S(f);b=f.s;1<a?(b.G=new L(0,0,a,a),b.H=new L(1,1,-a,-a)):(b.G=Vb,b.H=bc);t.v(f);return b},Border:function(a,b,c){var d=a?a.Kc:0;0>=d&&(d=5);d=Math.min(d,b/3);d=Math.min(d,c/3);a=t.u();P(a,d,0,!0);a.lineTo(b-d,0);Q(a,b-0,0,b,0,b,d);a.lineTo(b,c-d);Q(a,b,c-0,b-0,c,b-d,c);a.lineTo(d,c);Q(a,0,c,0,c-0,0,c-d);a.lineTo(0,d);Q(a,
0,0,0,0,d,0);S(a);b=a.s;b.G=Vb;b.H=bc;t.v(a);return b},SquareIBeam:function(a,b,c){var d=a?a.Kc:0;0===d&&(d=0.2);a=t.u();P(a,0,0,!0);a.lineTo(1*b,0);a.lineTo(1*b,d*c);a.lineTo((0.5+d/2)*b,d*c);a.lineTo((0.5+d/2)*b,(1-d)*c);a.lineTo(1*b,(1-d)*c);a.lineTo(1*b,1*c);a.lineTo(0,1*c);a.lineTo(0,(1-d)*c);a.lineTo((0.5-d/2)*b,(1-d)*c);a.lineTo((0.5-d/2)*b,d*c);a.lineTo(0,d*c);S(a);b=a.s;t.v(a);return b},Trapezoid:function(a,b,c){a=a?a.Kc:0;0===a&&(a=0.2);var d=t.u();P(d,a*b,0,!0);d.lineTo((1-a)*b,0);d.lineTo(1*
b,1*c);d.lineTo(0,1*c);S(d);b=d.s;b.G=new L(a,0);b.H=new L(1-a,1);t.v(d);return b},ManualLoop:"ManualOperation",ManualOperation:function(a,b,c){var d=a?a.Kc:0;a=t.u();P(a,d,0,!0);a.lineTo(0,0);a.lineTo(1*b,0);a.lineTo(0.9*b,1*c);a.lineTo(0.1*b,1*c);S(a);b=a.s;b.G=new L(0.1,0);b.H=new L(0.9,1);t.v(a);return b},GenderMale:function(a,b,c){a=t.u();var d=K.za,f=0.4*d,g=0.4,h=t.N(),k=t.N(),l=t.N(),m=t.N();P(a,(0.5-g)*b,0.5*c,!0);Q(a,(0.5-g)*b,(0.5-f)*c,(0.5-f)*b,(0.5-g)*c,0.5*b,(0.5-g)*c);K.hj(0.5,0.5-
g,0.5+f,0.5-g,0.5+g,0.5-f,0.5+g,0.5,0.44,l,m,k,h,h);Q(a,l.x*b,l.y*c,m.x*b,m.y*c,k.x*b,k.y*c);var n=t.qc(k.x,k.y);K.hj(0.5,0.5-g,0.5+f,0.5-g,0.5+g,0.5-f,0.5+g,0.5,0.56,h,h,k,l,m);var p=t.qc(k.x,k.y);a.lineTo((0.1*n.x+0.855)*b,0.1*n.y*c);a.lineTo(0.85*b,0.1*n.y*c);a.lineTo(0.85*b,0);a.lineTo(1*b,0);a.lineTo(1*b,0.15*c);a.lineTo((0.1*p.x+0.9)*b,0.15*c);a.lineTo((0.1*p.x+0.9)*b,(0.1*p.y+0.05*0.9)*c);a.lineTo(p.x*b,p.y*c);Q(a,l.x*b,l.y*c,m.x*b,m.y*c,(0.5+g)*b,0.5*c);Q(a,(0.5+g)*b,(0.5+f)*c,(0.5+f)*b,(0.5+
g)*c,0.5*b,(0.5+g)*c);Q(a,(0.5-f)*b,(0.5+g)*c,(0.5-g)*b,(0.5+f)*c,(0.5-g)*b,0.5*c);g=0.35;f=0.35*d;P(a,0.5*b,(0.5-g)*c,!0,!0);Q(a,(0.5-f)*b,(0.5-g)*c,(0.5-g)*b,(0.5-f)*c,(0.5-g)*b,0.5*c);Q(a,(0.5-g)*b,(0.5+f)*c,(0.5-f)*b,(0.5+g)*c,0.5*b,(0.5+g)*c);Q(a,(0.5+f)*b,(0.5+g)*c,(0.5+g)*b,(0.5+f)*c,(0.5+g)*b,0.5*c);Q(a,(0.5+g)*b,(0.5-f)*c,(0.5+f)*b,(0.5-g)*c,0.5*b,(0.5-g)*c);P(a,(0.5-g)*b,0.5*c,!0);t.B(h);t.B(k);t.B(l);t.B(m);t.B(n);t.B(p);b=a.s;b.G=new L(0.202,0.257);b.H=new L(0.692,0.839);b.Ac=dh;t.v(a);
return b},GenderFemale:function(a,b,c){a=t.u();var d=0.375,f=0,g=-0.125,h=4*(Math.SQRT2-1)/3*d;P(a,(0.525+f)*b,(0.5+d+g)*c,!0);Q(a,(0.5+h+f)*b,(0.5+d+g)*c,(0.5+d+f)*b,(0.5+h+g)*c,(0.5+d+f)*b,(0.5+g)*c);Q(a,(0.5+d+f)*b,(0.5-h+g)*c,(0.5+h+f)*b,(0.5-d+g)*c,(0.5+f)*b,(0.5-d+g)*c);Q(a,(0.5-h+f)*b,(0.5-d+g)*c,(0.5-d+f)*b,(0.5-h+g)*c,(0.5-d+f)*b,(0.5+g)*c);Q(a,(0.5-d+f)*b,(0.5+h+g)*c,(0.5-h+f)*b,(0.5+d+g)*c,(0.475+f)*b,(0.5+d+g)*c);a.lineTo(0.475*b,0.85*c);a.lineTo(0.425*b,0.85*c);a.lineTo(0.425*b,0.9*c);
a.lineTo(0.475*b,0.9*c);a.lineTo(0.475*b,1*c);a.lineTo(0.525*b,1*c);a.lineTo(0.525*b,0.9*c);a.lineTo(0.575*b,0.9*c);a.lineTo(0.575*b,0.85*c);a.lineTo(0.525*b,0.85*c);S(a);d=0.325;f=0;g=-0.125;h=4*(Math.SQRT2-1)/3*d;P(a,(0.5+d+f)*b,(0.5+g)*c,!0,!0);Q(a,(0.5+d+f)*b,(0.5+h+g)*c,(0.5+h+f)*b,(0.5+d+g)*c,(0.5+f)*b,(0.5+d+g)*c);Q(a,(0.5-h+f)*b,(0.5+d+g)*c,(0.5-d+f)*b,(0.5+h+g)*c,(0.5-d+f)*b,(0.5+g)*c);Q(a,(0.5-d+f)*b,(0.5-h+g)*c,(0.5-h+f)*b,(0.5-d+g)*c,(0.5+f)*b,(0.5-d+g)*c);Q(a,(0.5+h+f)*b,(0.5-d+g)*c,
(0.5+d+f)*b,(0.5-h+g)*c,(0.5+d+f)*b,(0.5+g)*c);P(a,(0.525+f)*b,(0.5+d+g)*c,!0);b=a.s;b.G=new L(0.232,0.136);b.H=new L(0.782,0.611);b.Ac=dh;t.v(a);return b},PlusLine:function(a,b,c){a=t.u();P(a,0,0.5*c,!1);a.lineTo(1*b,0.5*c);a.moveTo(0.5*b,0);a.lineTo(0.5*b,1*c);b=a.s;t.v(a);return b},XLine:function(a,b,c){a=t.u();P(a,0,1*c,!1);a.lineTo(1*b,0);a.moveTo(0,0);a.lineTo(1*b,1*c);b=a.s;t.v(a);return b},AsteriskLine:function(a,b,c){a=t.u();var d=0.2/Math.SQRT2;P(a,d*b,(1-d)*c,!1);a.lineTo((1-d)*b,d*c);
a.moveTo(d*b,d*c);a.lineTo((1-d)*b,(1-d)*c);a.moveTo(0*b,0.5*c);a.lineTo(1*b,0.5*c);a.moveTo(0.5*b,0*c);a.lineTo(0.5*b,1*c);b=a.s;t.v(a);return b},CircleLine:function(a,b,c){var d=0.5*K.za;a=t.u();P(a,1*b,0.5*c,!1);Q(a,1*b,(0.5+d)*c,(0.5+d)*b,1*c,0.5*b,1*c);Q(a,(0.5-d)*b,1*c,0,(0.5+d)*c,0,0.5*c);Q(a,0,(0.5-d)*c,(0.5-d)*b,0,0.5*b,0);Q(a,(0.5+d)*b,0,1*b,(0.5-d)*c,1*b,0.5*c);b=a.s;b.G=new L(0.146,0.146);b.H=new L(0.853,0.853);b.Ac=dh;t.v(a);return b},Pie:function(a,b,c){a=t.u();var d=4*(Math.SQRT2-1)/
3*0.5;P(a,(0.5*Math.SQRT2/2+0.5)*b,(0.5-0.5*Math.SQRT2/2)*c,!0);Q(a,0.7*b,0*c,0.5*b,0*c,0.5*b,0*c);Q(a,(0.5-d+0)*b,0*c,0*b,(0.5-d+0)*c,0*b,0.5*c);Q(a,0*b,(0.5+d+0)*c,(0.5-d+0)*b,1*c,0.5*b,1*c);Q(a,(0.5+d+0)*b,1*c,1*b,(0.5+d+0)*c,1*b,0.5*c);a.lineTo(0.5*b,0.5*c);S(a);b=a.s;t.v(a);return b},PiePiece:function(a,b,c){var d=K.za/Math.SQRT2*0.5,f=Math.SQRT2/2,g=1-Math.SQRT2/2;a=t.u();P(a,b,c,!0);Q(a,b,(1-d)*c,(f+d)*b,(g+d)*c,f*b,g*c);a.lineTo(0,c);S(a);b=a.s;t.v(a);return b},StopSign:function(a,b,c){a=
1/(Math.SQRT2+2);var d=t.u();P(d,a*b,0,!0);d.lineTo((1-a)*b,0);d.lineTo(1*b,a*c);d.lineTo(1*b,(1-a)*c);d.lineTo((1-a)*b,1*c);d.lineTo(a*b,1*c);d.lineTo(0,(1-a)*c);d.lineTo(0,a*c);S(d);b=d.s;b.G=new L(a/2,a/2);b.H=new L(1-a/2,1-a/2);t.v(d);return b},LogicImplies:function(a,b,c){var d=a?a.Kc:0;0===d&&(d=0.2);a=t.u();P(a,(1-d)*b,0*c,!1);a.lineTo(1*b,0.5*c);a.lineTo((1-d)*b,c);a.moveTo(0,0.5*c);a.lineTo(b,0.5*c);b=a.s;b.G=Vb;b.H=new L(0.8,0.5);t.v(a);return b},LogicIff:function(a,b,c){var d=a?a.Kc:0;
0===d&&(d=0.2);a=t.u();P(a,(1-d)*b,0*c,!1);a.lineTo(1*b,0.5*c);a.lineTo((1-d)*b,c);a.moveTo(0,0.5*c);a.lineTo(b,0.5*c);a.moveTo(d*b,0);a.lineTo(0,0.5*c);a.lineTo(d*b,c);b=a.s;b.G=new L(0.2,0);b.H=new L(0.8,0.5);t.v(a);return b},LogicNot:function(a,b,c){a=t.u();P(a,0,0,!1);a.lineTo(1*b,0);a.lineTo(1*b,1*c);b=a.s;t.v(a);return b},LogicAnd:function(a,b,c){a=t.u();P(a,0,1*c,!1);a.lineTo(0.5*b,0);a.lineTo(1*b,1*c);b=a.s;b.G=new L(0.25,0.5);b.H=new L(0.75,1);t.v(a);return b},LogicOr:function(a,b,c){a=t.u();
P(a,0,0,!1);a.lineTo(0.5*b,1*c);a.lineTo(1*b,0);b=a.s;b.G=new L(0.219,0);b.H=new L(0.78,0.409);t.v(a);return b},LogicXor:function(a,b,c){a=t.u();P(a,0.5*b,0,!1);a.lineTo(0.5*b,1*c);a.moveTo(0,0.5*c);a.lineTo(1*b,0.5*c);var d=0.5*K.za;Q(a,1*b,(0.5+d)*c,(0.5+d)*b,1*c,0.5*b,1*c);Q(a,(0.5-d)*b,1*c,0,(0.5+d)*c,0,0.5*c);Q(a,0,(0.5-d)*c,(0.5-d)*b,0,0.5*b,0);Q(a,(0.5+d)*b,0,1*b,(0.5-d)*c,1*b,0.5*c);b=a.s;b.Ac=dh;t.v(a);return b},LogicTruth:function(a,b,c){a=t.u();P(a,0,0,!1);a.lineTo(1*b,0);a.moveTo(0.5*
b,0);a.lineTo(0.5*b,1*c);b=a.s;t.v(a);return b},LogicFalsity:function(a,b,c){a=t.u();P(a,0,1*c,!1);a.lineTo(1*b,1*c);a.moveTo(0.5*b,1*c);a.lineTo(0.5*b,0);b=a.s;t.v(a);return b},LogicThereExists:function(a,b,c){a=t.u();P(a,0,0,!1);a.lineTo(1*b,0);a.lineTo(1*b,0.5*c);a.lineTo(0,0.5*c);a.moveTo(1*b,0.5*c);a.lineTo(1*b,1*c);a.lineTo(0,1*c);b=a.s;t.v(a);return b},LogicForAll:function(a,b,c){a=t.u();P(a,0,0,!1);a.lineTo(0.5*b,1*c);a.lineTo(1*b,0);a.moveTo(0.25*b,0.5*c);a.lineTo(0.75*b,0.5*c);b=a.s;b.G=
new L(0.25,0);b.H=new L(0.75,0.5);t.v(a);return b},LogicIsDefinedAs:function(a,b,c){a=t.u();P(a,0,0,!1);a.lineTo(b,0);a.moveTo(0,0.5*c);a.lineTo(b,0.5*c);a.moveTo(0,c);a.lineTo(b,c);b=a.s;b.G=new L(0.01,0.01);b.H=new L(0.99,0.49);t.v(a);return b},LogicIntersect:function(a,b,c){var d=0.5*K.za;a=t.u();P(a,0,1*c,!1);a.lineTo(0,0.5*c);Q(a,0,(0.5-d)*c,(0.5-d)*b,0,0.5*b,0);Q(a,(0.5+d)*b,0,1*b,(0.5-d)*c,1*b,0.5*c);a.lineTo(1*b,1*c);b=a.s;b.G=new L(0,0.5);b.H=bc;t.v(a);return b},LogicUnion:function(a,b,c){var d=
0.5*K.za;a=t.u();P(a,1*b,0,!1);a.lineTo(1*b,0.5*c);Q(a,1*b,(0.5+d)*c,(0.5+d)*b,1*c,0.5*b,1*c);Q(a,(0.5-d)*b,1*c,0,(0.5+d)*c,0,0.5*c);a.lineTo(0,0);b=a.s;b.G=Vb;b.H=new L(1,0.5);t.v(a);return b},Arrow:function(a,b,c){var d=a?a.Kc:0,f=a?a.Vt:0;0===d&&(d=0.3);0===f&&(f=0.3);a=t.u();P(a,0,(0.5-f/2)*c,!0);a.lineTo((1-d)*b,(0.5-f/2)*c);a.lineTo((1-d)*b,0);a.lineTo(1*b,0.5*c);a.lineTo((1-d)*b,1*c);a.lineTo((1-d)*b,(0.5+f/2)*c);a.lineTo(0,(0.5+f/2)*c);S(a);b=a.s;b.G=new L(0,0.5-f/2);d=K.wl(0,0.5+f/2,1,0.5+
f/2,1-d,1,1,0.5,t.N());b.H=new L(d.x,d.y);t.B(d);t.v(a);return b},ISOProcess:"Chevron",Chevron:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(0.5*b,0);a.lineTo(1*b,0.5*c);a.lineTo(0.5*b,1*c);a.lineTo(0,1*c);a.lineTo(0.5*b,0.5*c);S(a);b=a.s;t.v(a);return b},DoubleArrow:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(0.3*b,0.214*c);a.lineTo(0.3*b,0);a.lineTo(1*b,0.5*c);a.lineTo(0.3*b,1*c);a.lineTo(0.3*b,0.786*c);a.lineTo(0,1*c);S(a);P(a,0.3*b,0.214*c,!1);a.lineTo(0.3*b,0.786*c);a.jb(!1);b=a.s;t.v(a);return b},
DoubleEndArrow:function(a,b,c){a=t.u();P(a,1*b,0.5*c,!0);a.lineTo(0.7*b,1*c);a.lineTo(0.7*b,0.7*c);a.lineTo(0.3*b,0.7*c);a.lineTo(0.3*b,1*c);a.lineTo(0,0.5*c);a.lineTo(0.3*b,0);a.lineTo(0.3*b,0.3*c);a.lineTo(0.7*b,0.3*c);a.lineTo(0.7*b,0);S(a);b=a.s;c=K.wl(0,0.5,0.3,0,0,0.3,0.3,0.3,t.N());b.G=new L(c.x,c.y);c=K.wl(0.7,1,1,0.5,0.7,0.7,1,0.7,c);b.H=new L(c.x,c.y);t.B(c);t.v(a);return b},IBeamArrow:function(a,b,c){a=t.u();P(a,1*b,0.5*c,!0);a.lineTo(0.7*b,1*c);a.lineTo(0.7*b,0.7*c);a.lineTo(0.2*b,0.7*
c);a.lineTo(0.2*b,1*c);a.lineTo(0,1*c);a.lineTo(0,0);a.lineTo(0.2*b,0);a.lineTo(0.2*b,0.3*c);a.lineTo(0.7*b,0.3*c);a.lineTo(0.7*b,0);S(a);b=a.s;b.G=new L(0,0.3);c=K.wl(0.7,1,1,0.5,0.7,0.7,1,0.7,t.N());b.H=new L(c.x,c.y);t.B(c);t.v(a);return b},Pointer:function(a,b,c){a=t.u();P(a,1*b,0.5*c,!0);a.lineTo(0,1*c);a.lineTo(0.2*b,0.5*c);a.lineTo(0,0);S(a);b=a.s;b.G=new L(0.2,0.35);c=K.wl(0.2,0.65,1,0.65,0,1,1,0.5,t.N());b.H=new L(c.x,c.y);t.B(c);t.v(a);return b},RoundedPointer:function(a,b,c){a=t.u();P(a,
1*b,0.5*c,!0);a.lineTo(0,1*c);Q(a,0.5*b,0.75*c,0.5*b,0.25*c,0,0);S(a);b=a.s;b.G=new L(0.4,0.35);c=K.wl(0.2,0.65,1,0.65,0,1,1,0.5,t.N());b.H=new L(c.x,c.y);t.B(c);t.v(a);return b},SplitEndArrow:function(a,b,c){a=t.u();P(a,1*b,0.5*c,!0);a.lineTo(0.7*b,1*c);a.lineTo(0.7*b,0.7*c);a.lineTo(0,0.7*c);a.lineTo(0.2*b,0.5*c);a.lineTo(0,0.3*c);a.lineTo(0.7*b,0.3*c);a.lineTo(0.7*b,0);S(a);b=a.s;b.G=new L(0.2,0.3);c=K.wl(0.7,1,1,0.5,0.7,0.7,1,0.7,t.N());b.H=new L(c.x,c.y);t.B(c);t.v(a);return b},MessageToUser:"SquareArrow",
SquareArrow:function(a,b,c){a=t.u();P(a,1*b,0.5*c,!0);a.lineTo(0.7*b,1*c);a.lineTo(0,1*c);a.lineTo(0,0);a.lineTo(0.7*b,0);S(a);b=a.s;b.G=Vb;b.H=new L(0.7,1);t.v(a);return b},Cone1:function(a,b,c){var d=K.za;a=0.5*d;var f=0.1*d,d=t.u();P(d,0,0.9*c,!0);d.lineTo(0.5*b,0);d.lineTo(1*b,0.9*c);Q(d,1*b,(0.9+f)*c,(0.5+a)*b,1*c,0.5*b,1*c);Q(d,(0.5-a)*b,1*c,0,(0.9+f)*c,0,0.9*c);S(d);b=d.s;b.G=new L(0.25,0.5);b.H=new L(0.75,0.97);t.v(d);return b},Cone2:function(a,b,c){a=t.u();P(a,0,0.9*c,!0);Q(a,(1-0.85/0.9)*
b,1*c,0.85/0.9*b,1*c,1*b,0.9*c);a.lineTo(0.5*b,0);a.lineTo(0,0.9*c);S(a);P(a,0,0.9*c,!1);Q(a,(1-0.85/0.9)*b,0.8*c,0.85/0.9*b,0.8*c,1*b,0.9*c);a.jb(!1);b=a.s;b.G=new L(0.25,0.5);b.H=new L(0.75,0.82);t.v(a);return b},Cube1:function(a,b,c){a=t.u();P(a,0.5*b,1*c,!0);a.lineTo(1*b,0.85*c);a.lineTo(1*b,0.15*c);a.lineTo(0.5*b,0*c);a.lineTo(0*b,0.15*c);a.lineTo(0*b,0.85*c);S(a);P(a,0.5*b,1*c,!1);a.lineTo(0.5*b,0.3*c);a.lineTo(0,0.15*c);a.moveTo(0.5*b,0.3*c);a.lineTo(1*b,0.15*c);a.jb(!1);b=a.s;b.G=new L(0,
0.3);b.H=new L(0.5,0.85);t.v(a);return b},Cube2:function(a,b,c){a=t.u();P(a,0,0.3*c,!0);a.lineTo(0*b,1*c);a.lineTo(0.7*b,c);a.lineTo(1*b,0.7*c);a.lineTo(1*b,0*c);a.lineTo(0.3*b,0*c);S(a);P(a,0,0.3*c,!1);a.lineTo(0.7*b,0.3*c);a.lineTo(1*b,0*c);a.moveTo(0.7*b,0.3*c);a.lineTo(0.7*b,1*c);a.jb(!1);b=a.s;b.G=new L(0,0.3);b.H=new L(0.7,1);t.v(a);return b},MagneticData:"Cylinder1",Cylinder1:function(a,b,c){var d=K.za;a=0.5*d;var f=0.1*d,d=t.u();P(d,0,0.1*c,!0);Q(d,0,(0.1-f)*c,(0.5-a)*b,0,0.5*b,0);Q(d,(0.5+
a)*b,0,1*b,(0.1-f)*c,1*b,0.1*c);d.lineTo(b,0.9*c);Q(d,1*b,(0.9+f)*c,(0.5+a)*b,1*c,0.5*b,1*c);Q(d,(0.5-a)*b,1*c,0,(0.9+f)*c,0,0.9*c);d.lineTo(0,0.1*c);P(d,0,0.1*c,!1);Q(d,0,(0.1+f)*c,(0.5-a)*b,0.2*c,0.5*b,0.2*c);Q(d,(0.5+a)*b,0.2*c,1*b,(0.1+f)*c,1*b,0.1*c);d.jb(!1);b=d.s;b.G=new L(0,0.2);b.H=new L(1,0.9);t.v(d);return b},Cylinder2:function(a,b,c){var d=K.za;a=0.5*d;var f=0.1*d,d=t.u();P(d,0,0.9*c,!0);d.lineTo(0,0.1*c);Q(d,0,(0.1-f)*c,(0.5-a)*b,0,0.5*b,0);Q(d,(0.5+a)*b,0,1*b,(0.1-f)*c,1*b,0.1*c);d.lineTo(1*
b,0.9*c);Q(d,1*b,(0.9+f)*c,(0.5+a)*b,1*c,0.5*b,1*c);Q(d,(0.5-a)*b,1*c,0,(0.9+f)*c,0,0.9*c);P(d,0,0.9*c,!1);Q(d,0,(0.9-f)*c,(0.5-a)*b,0.8*c,0.5*b,0.8*c);Q(d,(0.5+a)*b,0.8*c,1*b,(0.9-f)*c,1*b,0.9*c);d.jb(!1);b=d.s;b.G=new L(0,0.1);b.H=new L(1,0.8);t.v(d);return b},Cylinder3:function(a,b,c){var d=K.za;a=0.1*d;var f=0.5*d,d=t.u();P(d,0.1*b,0,!0);d.lineTo(0.9*b,0);Q(d,(0.9+a)*b,0,1*b,(0.5-f)*c,1*b,0.5*c);Q(d,1*b,(0.5+f)*c,(0.9+a)*b,1*c,0.9*b,1*c);d.lineTo(0.1*b,1*c);Q(d,(0.1-a)*b,1*c,0,(0.5+f)*c,0,0.5*
c);Q(d,0,(0.5-f)*c,(0.1-a)*b,0,0.1*b,0);P(d,0.1*b,0,!1);Q(d,(0.1+a)*b,0,0.2*b,(0.5-f)*c,0.2*b,0.5*c);Q(d,0.2*b,(0.5+f)*c,(0.1+a)*b,1*c,0.1*b,1*c);d.jb(!1);b=d.s;b.G=new L(0.2,0);b.H=new L(0.9,1);t.v(d);return b},DirectData:"Cylinder4",Cylinder4:function(a,b,c){var d=K.za;a=0.1*d;var f=0.5*d,d=t.u();P(d,0.9*b,0,!0);Q(d,(0.9+a)*b,0,1*b,(0.5-f)*c,1*b,0.5*c);Q(d,1*b,(0.5+f)*c,(0.9+a)*b,1*c,0.9*b,1*c);d.lineTo(0.1*b,1*c);Q(d,(0.1-a)*b,1*c,0,(0.5+f)*c,0,0.5*c);Q(d,0,(0.5-f)*c,(0.1-a)*b,0,0.1*b,0);d.lineTo(0.9*
b,0);P(d,0.9*b,0,!1);Q(d,(0.9-a)*b,0,0.8*b,(0.5-f)*c,0.8*b,0.5*c);Q(d,0.8*b,(0.5+f)*c,(0.9-a)*b,1*c,0.9*b,1*c);d.jb(!1);b=d.s;b.G=new L(0.1,0);b.H=new L(0.8,1);t.v(d);return b},Prism1:function(a,b,c){a=t.u();P(a,0.25*b,0.25*c,!0);a.lineTo(0.75*b,0);a.lineTo(b,0.5*c);a.lineTo(0.5*b,c);a.lineTo(0,c);S(a);P(a,0.25*b,0.25*c,!1);a.lineTo(0.5*b,c);a.jb(!1);b=a.s;b.G=new L(0.408,0.172);b.H=new L(0.833,0.662);t.v(a);return b},Prism2:function(a,b,c){a=t.u();P(a,0,0.25*c,!0);a.lineTo(0.75*b,0);a.lineTo(1*b,
0.25*c);a.lineTo(0.75*b,0.75*c);a.lineTo(0,1*c);S(a);P(a,0,c,!1);a.lineTo(0.25*b,0.5*c);a.lineTo(b,0.25*c);a.moveTo(0,0.25*c);a.lineTo(0.25*b,0.5*c);a.jb(!1);b=a.s;b.G=new L(0.25,0.5);b.H=new L(0.75,0.75);t.v(a);return b},Pyramid1:function(a,b,c){a=t.u();P(a,0.5*b,0,!0);a.lineTo(b,0.75*c);a.lineTo(0.5*b,1*c);a.lineTo(0,0.75*c);S(a);P(a,0.5*b,0,!1);a.lineTo(0.5*b,1*c);a.jb(!1);b=a.s;b.G=new L(0.25,0.367);b.H=new L(0.75,0.875);t.v(a);return b},Pyramid2:function(a,b,c){a=t.u();P(a,0.5*b,0,!0);a.lineTo(b,
0.85*c);a.lineTo(0.5*b,1*c);a.lineTo(0,0.85*c);S(a);P(a,0.5*b,0,!1);a.lineTo(0.5*b,0.7*c);a.lineTo(0,0.85*c);a.moveTo(0.5*b,0.7*c);a.lineTo(1*b,0.85*c);a.jb(!1);b=a.s;b.G=new L(0.25,0.367);b.H=new L(0.75,0.875);t.v(a);return b},Actor:function(a,b,c){var d=K.za,f=0.2*d,g=0.1*d,h=0.5,k=0.1;a=t.u();P(a,h*b,(k+0.1)*c,!0);Q(a,(h-f)*b,(k+0.1)*c,(h-0.2)*b,(k+g)*c,(h-0.2)*b,k*c);Q(a,(h-0.2)*b,(k-g)*c,(h-f)*b,(k-0.1)*c,h*b,(k-0.1)*c);Q(a,(h+f)*b,(k-0.1)*c,(h+0.2)*b,(k-g)*c,(h+0.2)*b,k*c);Q(a,(h+0.2)*b,(k+
g)*c,(h+f)*b,(k+0.1)*c,h*b,(k+0.1)*c);f=0.05;g=d*f;P(a,0.5*b,0.2*c,!0);a.lineTo(0.95*b,0.2*c);h=0.95;k=0.25;Q(a,(h+g)*b,(k-f)*c,(h+f)*b,(k-g)*c,(h+f)*b,k*c);a.lineTo(1*b,0.6*c);a.lineTo(0.85*b,0.6*c);a.lineTo(0.85*b,0.35*c);f=0.025;g=d*f;h=0.825;k=0.35;Q(a,(h+f)*b,(k-g)*c,(h+g)*b,(k-f)*c,h*b,(k-f)*c);Q(a,(h-g)*b,(k-f)*c,(h-f)*b,(k-g)*c,(h-f)*b,k*c);a.lineTo(0.8*b,1*c);a.lineTo(0.55*b,1*c);a.lineTo(0.55*b,0.7*c);f=0.05;g=d*f;h=0.5;k=0.7;Q(a,(h+f)*b,(k-g)*c,(h+g)*b,(k-f)*c,h*b,(k-f)*c);Q(a,(h-g)*b,
(k-f)*c,(h-f)*b,(k-g)*c,(h-f)*b,k*c);a.lineTo(0.45*b,1*c);a.lineTo(0.2*b,1*c);a.lineTo(0.2*b,0.35*c);f=0.025;g=d*f;h=0.175;k=0.35;Q(a,(h+f)*b,(k-g)*c,(h+g)*b,(k-f)*c,h*b,(k-f)*c);Q(a,(h-g)*b,(k-f)*c,(h-f)*b,(k-g)*c,(h-f)*b,k*c);a.lineTo(0.15*b,0.6*c);a.lineTo(0*b,0.6*c);a.lineTo(0*b,0.25*c);f=0.05;g=d*f;h=0.05;k=0.25;Q(a,(h-f)*b,(k-g)*c,(h-g)*b,(k-f)*c,h*b,(k-f)*c);a.lineTo(0.5*b,0.2*c);b=a.s;b.G=new L(0.2,0.2);b.H=new L(0.8,0.65);t.v(a);return b},Card:function(a,b,c){a=t.u();P(a,1*b,0*c,!0);a.lineTo(1*
b,1*c);a.lineTo(0*b,1*c);a.lineTo(0*b,0.2*c);a.lineTo(0.2*b,0*c);S(a);b=a.s;b.G=new L(0,0.2);b.H=bc;t.v(a);return b},Collate:function(a,b,c){a=t.u();P(a,0.5*b,0.5*c,!0);a.lineTo(0,0);a.lineTo(1*b,0);a.lineTo(0.5*b,0.5*c);P(a,0.5*b,0.5*c,!0);a.lineTo(1*b,1*c);a.lineTo(0,1*c);a.lineTo(0.5*b,0.5*c);b=a.s;b.G=new L(0.25,0);b.H=new L(0.75,0.25);t.v(a);return b},CreateRequest:function(a,b,c){a=a?a.Kc:0;0===a&&(a=0.1);var d=t.u();P(d,0,0,!0);d.lineTo(1*b,0);d.lineTo(1*b,1*c);d.lineTo(0,1*c);S(d);P(d,0,a*
c,!1);d.lineTo(1*b,a*c);d.moveTo(0,(1-a)*c);d.lineTo(1*b,(1-a)*c);d.jb(!1);b=d.s;b.G=new L(0,a);b.H=new L(1,1-a);t.v(d);return b},Database:function(a,b,c){a=t.u();var d=K.za,f=0.5*d,d=0.1*d;P(a,1*b,0.1*c,!0);a.lineTo(1*b,0.9*c);Q(a,1*b,(0.9+d)*c,(0.5+f)*b,1*c,0.5*b,1*c);Q(a,(0.5-f)*b,1*c,0,(0.9+d)*c,0,0.9*c);a.lineTo(0,0.1*c);Q(a,0,(0.1-d)*c,(0.5-f)*b,0,0.5*b,0);Q(a,(0.5+f)*b,0,1*b,(0.1-d)*c,1*b,0.1*c);P(a,1*b,0.1*c,!1);Q(a,1*b,(0.1+d)*c,(0.5+f)*b,0.2*c,0.5*b,0.2*c);Q(a,(0.5-f)*b,0.2*c,0,(0.1+d)*
c,0,0.1*c);a.moveTo(1*b,0.2*c);Q(a,1*b,(0.2+d)*c,(0.5+f)*b,0.3*c,0.5*b,0.3*c);Q(a,(0.5-f)*b,0.3*c,0,(0.2+d)*c,0,0.2*c);a.moveTo(1*b,0.3*c);Q(a,1*b,(0.3+d)*c,(0.5+f)*b,0.4*c,0.5*b,0.4*c);Q(a,(0.5-f)*b,0.4*c,0,(0.3+d)*c,0,0.3*c);a.jb(!1);b=a.s;b.G=new L(0,0.4);b.H=new L(1,0.9);t.v(a);return b},StoredData:"DataStorage",DataStorage:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(0.75*b,0);Q(a,1*b,0,1*b,1*c,0.75*b,1*c);a.lineTo(0,1*c);Q(a,0.25*b,0.9*c,0.25*b,0.1*c,0,0);S(a);b=a.s;b.G=new L(0.226,0);b.H=new L(0.81,
1);t.v(a);return b},DiskStorage:function(a,b,c){a=t.u();var d=K.za,f=0.5*d,d=0.1*d;P(a,1*b,0.1*c,!0);a.lineTo(1*b,0.9*c);Q(a,1*b,(0.9+d)*c,(0.5+f)*b,1*c,0.5*b,1*c);Q(a,(0.5-f)*b,1*c,0,(0.9+d)*c,0,0.9*c);a.lineTo(0,0.1*c);Q(a,0,(0.1-d)*c,(0.5-f)*b,0,0.5*b,0);Q(a,(0.5+f)*b,0,1*b,(0.1-d)*c,1*b,0.1*c);P(a,1*b,0.1*c,!1);Q(a,1*b,(0.1+d)*c,(0.5+f)*b,0.2*c,0.5*b,0.2*c);Q(a,(0.5-f)*b,0.2*c,0,(0.1+d)*c,0,0.1*c);a.moveTo(1*b,0.2*c);Q(a,1*b,(0.2+d)*c,(0.5+f)*b,0.3*c,0.5*b,0.3*c);Q(a,(0.5-f)*b,0.3*c,0,(0.2+d)*
c,0,0.2*c);a.jb(!1);b=a.s;b.G=new L(0,0.3);b.H=new L(1,0.9);t.v(a);return b},Display:function(a,b,c){a=t.u();P(a,0.25*b,0,!0);a.lineTo(0.75*b,0);Q(a,1*b,0,1*b,1*c,0.75*b,1*c);a.lineTo(0.25*b,1*c);a.lineTo(0,0.5*c);S(a);b=a.s;b.G=new L(0.25,0);b.H=new L(0.75,1);t.v(a);return b},DividedEvent:function(a,b,c){a=a?a.Kc:0;0===a?a=0.2:0.15>a&&(a=0.15);var d=t.u(),f=0.2*K.za;P(d,0,0.2*c,!0);Q(d,0,(0.2-f)*c,(0.2-f)*b,0,0.2*b,0);d.lineTo(0.8*b,0);Q(d,(0.8+f)*b,0,1*b,(0.2-f)*c,1*b,0.2*c);d.lineTo(1*b,0.8*c);
Q(d,1*b,(0.8+f)*c,(0.8+f)*b,1*c,0.8*b,1*c);d.lineTo(0.2*b,1*c);Q(d,(0.2-f)*b,1*c,0,(0.8+f)*c,0,0.8*c);d.lineTo(0,0.2*c);P(d,0,a*c,!1);d.lineTo(1*b,a*c);d.jb(!1);b=d.s;b.G=new L(0,a);b.H=new L(1,1-a);t.v(d);return b},DividedProcess:function(a,b,c){a=a?a.Kc:0;0.1>a&&(a=0.1);var d=t.u();P(d,0,0,!0);d.lineTo(1*b,0);d.lineTo(1*b,1*c);d.lineTo(0,1*c);S(d);P(d,0,a*c,!1);d.lineTo(1*b,a*c);d.jb(!1);b=d.s;b.G=new L(0,a);b.H=bc;t.v(d);return b},Document:function(a,b,c){c/=0.8;a=t.u();P(a,0,0.7*c,!0);a.lineTo(0,
0);a.lineTo(1*b,0);a.lineTo(1*b,0.7*c);Q(a,0.5*b,0.4*c,0.5*b,1*c,0,0.7*c);S(a);b=a.s;b.G=Vb;b.H=new L(1,0.6);t.v(a);return b},ExternalOrganization:function(a,b,c){a=a?a.Kc:0;0.2>a&&(a=0.2);var d=t.u();P(d,0,0,!0);d.lineTo(1*b,0);d.lineTo(1*b,1*c);d.lineTo(0,1*c);S(d);P(d,a*b,0,!1);d.lineTo(0,a*c);d.moveTo(1*b,a*c);d.lineTo((1-a)*b,0);d.moveTo(0,(1-a)*c);d.lineTo(a*b,1*c);d.moveTo((1-a)*b,1*c);d.lineTo(1*b,(1-a)*c);d.jb(!1);b=d.s;b.G=new L(a/2,a/2);b.H=new L(1-a/2,1-a/2);t.v(d);return b},ExternalProcess:function(a,
b,c){a=t.u();P(a,0.5*b,0,!0);a.lineTo(1*b,0.5*c);a.lineTo(0.5*b,1*c);a.lineTo(0,0.5*c);S(a);P(a,0.1*b,0.4*c,!1);a.lineTo(0.1*b,0.6*c);a.moveTo(0.9*b,0.6*c);a.lineTo(0.9*b,0.4*c);a.moveTo(0.6*b,0.1*c);a.lineTo(0.4*b,0.1*c);a.moveTo(0.4*b,0.9*c);a.lineTo(0.6*b,0.9*c);a.jb(!1);b=a.s;b.G=new L(0.25,0.25);b.H=new L(0.75,0.75);t.v(a);return b},File:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(0.75*b,0);a.lineTo(1*b,0.25*c);a.lineTo(1*b,1*c);a.lineTo(0,1*c);S(a);P(a,0.75*b,0,!1);a.lineTo(0.75*b,0.25*c);
a.lineTo(1*b,0.25*c);a.jb(!1);b=a.s;b.G=new L(0,0.25);b.H=bc;t.v(a);return b},Interrupt:function(a,b,c){a=t.u();P(a,1*b,0.5*c,!0);a.lineTo(0,1*c);a.lineTo(0,0);a.lineTo(1*b,0.5*c);P(a,1*b,0.5*c,!1);a.lineTo(1*b,1*c);P(a,1*b,0.5*c,!1);a.lineTo(1*b,0);b=a.s;b.G=new L(0,0.25);b.H=new L(0.5,0.75);t.v(a);return b},InternalStorage:function(a,b,c){var d=a?a.Kc:0;a=a?a.Vt:0;0===d&&(d=0.1);0===a&&(a=0.1);var f=t.u();P(f,0,0,!0);f.lineTo(1*b,0);f.lineTo(1*b,1*c);f.lineTo(0,1*c);S(f);P(f,d*b,0,!1);f.lineTo(d*
b,1*c);f.moveTo(0,a*c);f.lineTo(1*b,a*c);f.jb(!1);b=f.s;b.G=new L(d,a);b.H=bc;t.v(f);return b},Junction:function(a,b,c){a=t.u();var d=1/Math.SQRT2,f=(1-1/Math.SQRT2)/2,g=0.5*K.za;P(a,1*b,0.5*c,!0);Q(a,1*b,(0.5+g)*c,(0.5+g)*b,1*c,0.5*b,1*c);Q(a,(0.5-g)*b,1*c,0,(0.5+g)*c,0,0.5*c);Q(a,0,(0.5-g)*c,(0.5-g)*b,0,0.5*b,0);Q(a,(0.5+g)*b,0,1*b,(0.5-g)*c,1*b,0.5*c);P(a,(f+d)*b,(f+d)*c,!1);a.lineTo(f*b,f*c);a.moveTo(f*b,(f+d)*c);a.lineTo((f+d)*b,f*c);a.jb(!1);b=a.s;b.Ac=dh;t.v(a);return b},LinedDocument:function(a,
b,c){c/=0.8;a=t.u();P(a,0,0.7*c,!0);a.lineTo(0,0);a.lineTo(1*b,0);a.lineTo(1*b,0.7*c);Q(a,0.5*b,0.4*c,0.5*b,1*c,0,0.7*c);S(a);P(a,0.1*b,0,!1);a.lineTo(0.1*b,0.75*c);a.jb(!1);b=a.s;b.G=new L(0.1,0);b.H=new L(1,0.6);t.v(a);return b},LoopLimit:function(a,b,c){a=t.u();P(a,0,1*c,!0);a.lineTo(0,0.25*c);a.lineTo(0.25*b,0);a.lineTo(0.75*b,0);a.lineTo(1*b,0.25*c);a.lineTo(1*b,1*c);S(a);b=a.s;b.G=new L(0,0.25);b.H=bc;t.v(a);return b},SequentialData:"MagneticTape",MagneticTape:function(a,b,c){a=t.u();var d=
0.5*K.za;P(a,0.5*b,1*c,!0);Q(a,(0.5-d)*b,1*c,0,(0.5+d)*c,0,0.5*c);Q(a,0,(0.5-d)*c,(0.5-d)*b,0,0.5*b,0);Q(a,(0.5+d)*b,0,1*b,(0.5-d)*c,1*b,0.5*c);Q(a,1*b,(0.5+d)*c,(0.5+d)*b,0.9*c,0.6*b,0.9*c);a.lineTo(1*b,0.9*c);a.lineTo(1*b,1*c);a.lineTo(0.5*b,1*c);b=a.s;b.G=new L(0.15,0.15);b.H=new L(0.85,0.8);t.v(a);return b},ManualInput:function(a,b,c){a=t.u();P(a,1*b,0,!0);a.lineTo(1*b,1*c);a.lineTo(0,1*c);a.lineTo(0,0.25*c);S(a);b=a.s;b.G=new L(0,0.25);b.H=bc;t.v(a);return b},MessageFromUser:function(a,b,c){a=
a?a.Kc:0;0===a&&(a=0.7);var d=t.u();P(d,0,0,!0);d.lineTo(1*b,0);d.lineTo(a*b,0.5*c);d.lineTo(1*b,1*c);d.lineTo(0,1*c);S(d);b=d.s;b.G=Vb;b.H=new L(a,1);t.v(d);return b},MicroformProcessing:function(a,b,c){a=a?a.Kc:0;0===a&&(a=0.25);var d=t.u();P(d,0,0,!0);d.lineTo(0.5*b,a*c);d.lineTo(1*b,0);d.lineTo(1*b,1*c);d.lineTo(0.5*b,(1-a)*c);d.lineTo(0,1*c);S(d);b=d.s;b.G=new L(0,a);b.H=new L(1,1-a);t.v(d);return b},MicroformRecording:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(0.75*b,0.25*c);a.lineTo(1*b,
0.15*c);a.lineTo(1*b,0.85*c);a.lineTo(0.75*b,0.75*c);a.lineTo(0,1*c);S(a);b=a.s;b.G=new L(0,0.25);b.H=new L(1,0.75);t.v(a);return b},MultiDocument:function(a,b,c){c/=0.8;a=t.u();P(a,b,0,!0);a.lineTo(b,0.5*c);Q(a,0.96*b,0.47*c,0.93*b,0.45*c,0.9*b,0.44*c);a.lineTo(0.9*b,0.6*c);Q(a,0.86*b,0.57*c,0.83*b,0.55*c,0.8*b,0.54*c);a.lineTo(0.8*b,0.7*c);Q(a,0.4*b,0.4*c,0.4*b,1*c,0,0.7*c);a.lineTo(0,0.2*c);a.lineTo(0.1*b,0.2*c);a.lineTo(0.1*b,0.1*c);a.lineTo(0.2*b,0.1*c);a.lineTo(0.2*b,0);S(a);P(a,0.1*b,0.2*c,
!1);a.lineTo(0.8*b,0.2*c);a.lineTo(0.8*b,0.54*c);a.moveTo(0.2*b,0.1*c);a.lineTo(0.9*b,0.1*c);a.lineTo(0.9*b,0.44*c);a.jb(!1);b=a.s;b.G=new L(0,0.25);b.H=new L(0.8,0.77);t.v(a);return b},MultiProcess:function(a,b,c){a=t.u();P(a,0.1*b,0.1*c,!0);a.lineTo(0.2*b,0.1*c);a.lineTo(0.2*b,0);a.lineTo(1*b,0);a.lineTo(1*b,0.8*c);a.lineTo(0.9*b,0.8*c);a.lineTo(0.9*b,0.9*c);a.lineTo(0.8*b,0.9*c);a.lineTo(0.8*b,1*c);a.lineTo(0,1*c);a.lineTo(0,0.2*c);a.lineTo(0.1*b,0.2*c);S(a);P(a,0.2*b,0.1*c,!1);a.lineTo(0.9*b,
0.1*c);a.lineTo(0.9*b,0.8*c);a.moveTo(0.1*b,0.2*c);a.lineTo(0.8*b,0.2*c);a.lineTo(0.8*b,0.9*c);a.jb(!1);b=a.s;b.G=new L(0,0.2);b.H=new L(0.8,1);t.v(a);return b},OfflineStorage:function(a,b,c){a=a?a.Kc:0;0===a&&(a=0.1);var d=1-a,f=t.u();P(f,0,0,!0);f.lineTo(1*b,0);f.lineTo(0.5*b,1*c);S(f);P(f,0.5*a*b,a*c,!1);f.lineTo((1-0.5*a)*b,a*c);f.jb(!1);b=f.s;b.G=new L(d/4+0.5*a,a);b.H=new L(3*d/4+0.5*a,a+0.5*d);t.v(f);return b},OffPageConnector:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(0.75*b,0);a.lineTo(1*
b,0.5*c);a.lineTo(0.75*b,1*c);a.lineTo(0,1*c);S(a);b=a.s;b.G=Vb;b.H=new L(0.75,1);t.v(a);return b},Or:function(a,b,c){a=t.u();var d=0.5*K.za;P(a,1*b,0.5*c,!0);Q(a,1*b,(0.5+d)*c,(0.5+d)*b,1*c,0.5*b,1*c);Q(a,(0.5-d)*b,1*c,0,(0.5+d)*c,0,0.5*c);Q(a,0,(0.5-d)*c,(0.5-d)*b,0,0.5*b,0);Q(a,(0.5+d)*b,0,1*b,(0.5-d)*c,1*b,0.5*c);P(a,1*b,0.5*c,!1);a.lineTo(0,0.5*c);a.moveTo(0.5*b,1*c);a.lineTo(0.5*b,0);a.jb(!1);b=a.s;b.Ac=dh;t.v(a);return b},PaperTape:function(a,b,c){c/=0.8;a=t.u();P(a,0,0.7*c,!0);a.lineTo(0,
0.3*c);Q(a,0.5*b,0.6*c,0.5*b,0,1*b,0.3);a.lineTo(1*b,0.7*c);Q(a,0.5*b,0.4*c,0.5*b,1*c,0,0.7*c);S(a);b=a.s;b.G=new L(0,0.49);b.H=new L(1,0.75);t.v(a);return b},PrimitiveFromCall:function(a,b,c){var d=a?a.Kc:0;a=a?a.Vt:0;0===d&&(d=0.1);0===a&&(a=0.3);var f=t.u();P(f,0,0,!0);f.lineTo(1*b,0);f.lineTo((1-a)*b,0.5*c);f.lineTo(1*b,1*c);f.lineTo(0,1*c);S(f);b=f.s;b.G=new L(d,0);b.H=new L(1-a,1);t.v(f);return b},PrimitiveToCall:function(a,b,c){var d=a?a.Kc:0;a=a?a.Vt:0;0===d&&(d=0.1);0===a&&(a=0.3);var f=
t.u();P(f,0,0,!0);f.lineTo((1-a)*b,0);f.lineTo(1*b,0.5*c);f.lineTo((1-a)*b,1*c);f.lineTo(0,1*c);S(f);b=f.s;b.G=new L(d,0);b.H=new L(1-a,1);t.v(f);return b},Subroutine:"Procedure",Procedure:function(a,b,c){a=a?a.Kc:0;0===a&&(a=0.1);var d=t.u();P(d,0,0,!0);d.lineTo(1*b,0);d.lineTo(1*b,1*c);d.lineTo(0,1*c);S(d);P(d,(1-a)*b,0,!1);d.lineTo((1-a)*b,1*c);d.moveTo(a*b,0);d.lineTo(a*b,1*c);d.jb(!1);b=d.s;b.G=new L(a,0);b.H=new L(1-a,1);t.v(d);return b},Process:function(a,b,c){a=a?a.Kc:0;0===a&&(a=0.1);var d=
t.u();P(d,0,0,!0);d.lineTo(1*b,0);d.lineTo(1*b,1*c);d.lineTo(0,1*c);S(d);P(d,a*b,0,!1);d.lineTo(a*b,1*c);d.jb(!1);b=d.s;b.G=new L(a,0);b.H=bc;t.v(d);return b},Sort:function(a,b,c){a=t.u();P(a,0.5*b,0,!0);a.lineTo(1*b,0.5*c);a.lineTo(0.5*b,1*c);a.lineTo(0,0.5*c);S(a);P(a,0,0.5*c,!1);a.lineTo(1*b,0.5*c);a.jb(!1);b=a.s;b.G=new L(0.25,0.25);b.H=new L(0.75,0.5);t.v(a);return b},Start:function(a,b,c){a=t.u();P(a,0.25*b,0,!0);P(a,0.25*b,0,!0);a.arcTo(270,180,0.75*b,0.5*c,0.25*b,0.5*c);a.arcTo(90,180,0.25*
b,0.5*c,0.25*b,0.5*c);P(a,0.25*b,0,!1);a.lineTo(0.25*b,1*c);a.moveTo(0.75*b,0);a.lineTo(0.75*b,1*c);a.jb(!1);b=a.s;b.G=new L(0.25,0);b.H=new L(0.75,1);t.v(a);return b},Terminator:function(a,b,c){a=t.u();P(a,0.25*b,0,!0);a.arcTo(270,180,0.75*b,0.5*c,0.25*b,0.5*c);a.arcTo(90,180,0.25*b,0.5*c,0.25*b,0.5*c);b=a.s;b.G=new L(0.23,0);b.H=new L(0.77,1);t.v(a);return b},TransmittalTape:function(a,b,c){a=a?a.Kc:0;0===a&&(a=0.1);var d=t.u();P(d,0,0,!0);d.lineTo(1*b,0);d.lineTo(1*b,1*c);d.lineTo(0.75*b,(1-a)*
c);d.lineTo(0,(1-a)*c);S(d);b=d.s;b.G=Vb;b.H=new L(1,1-a);t.v(d);return b},AndGate:function(a,b,c){a=t.u();var d=0.5*K.za;P(a,0,0,!0);a.lineTo(0.5*b,0);Q(a,(0.5+d)*b,0,1*b,(0.5-d)*c,1*b,0.5*c);Q(a,1*b,(0.5+d)*c,(0.5+d)*b,1*c,0.5*b,1*c);a.lineTo(0,1*c);S(a);b=a.s;b.G=Vb;b.H=new L(0.55,1);t.v(a);return b},Buffer:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(1*b,0.5*c);a.lineTo(0,1*c);S(a);b=a.s;b.G=new L(0,0.25);b.H=new L(0.5,0.75);t.v(a);return b},Clock:function(a,b,c){a=t.u();var d=0.5*K.za;P(a,1*
b,0.5*c,!0);Q(a,1*b,(0.5+d)*c,(0.5+d)*b,1*c,0.5*b,1*c);Q(a,(0.5-d)*b,1*c,0,(0.5+d)*c,0,0.5*c);Q(a,0,(0.5-d)*c,(0.5-d)*b,0,0.5*b,0);Q(a,(0.5+d)*b,0,1*b,(0.5-d)*c,1*b,0.5*c);P(a,1*b,0.5*c,!1);a.lineTo(1*b,0.5*c);P(a,0.8*b,0.75*c,!1);a.lineTo(0.8*b,0.25*c);a.lineTo(0.6*b,0.25*c);a.lineTo(0.6*b,0.75*c);a.lineTo(0.4*b,0.75*c);a.lineTo(0.4*b,0.25*c);a.lineTo(0.2*b,0.25*c);a.lineTo(0.2*b,0.75*c);a.jb(!1);b=a.s;b.Ac=dh;t.v(a);return b},Ground:function(a,b,c){a=t.u();P(a,0.5*b,0,!1);a.lineTo(0.5*b,0.4*c);
a.moveTo(0.2*b,0.6*c);a.lineTo(0.8*b,0.6*c);a.moveTo(0.3*b,0.8*c);a.lineTo(0.7*b,0.8*c);a.moveTo(0.4*b,1*c);a.lineTo(0.6*b,1*c);b=a.s;t.v(a);return b},Inverter:function(a,b,c){a=t.u();var d=0.1*K.za;P(a,0.8*b,0.5*c,!0);a.lineTo(0,1*c);a.lineTo(0,0);a.lineTo(0.8*b,0.5*c);P(a,1*b,0.5*c,!0);Q(a,1*b,(0.5+d)*c,(0.9+d)*b,0.6*c,0.9*b,0.6*c);Q(a,(0.9-d)*b,0.6*c,0.8*b,(0.5+d)*c,0.8*b,0.5*c);Q(a,0.8*b,(0.5-d)*c,(0.9-d)*b,0.4*c,0.9*b,0.4*c);Q(a,(0.9+d)*b,0.4*c,1*b,(0.5-d)*c,1*b,0.5*c);b=a.s;b.G=new L(0,0.25);
b.H=new L(0.4,0.75);t.v(a);return b},NandGate:function(a,b,c){a=t.u();var d=K.za,f=0.5*d,g=0.4*d,d=0.1*d;P(a,0.8*b,0.5*c,!0);Q(a,0.8*b,(0.5+g)*c,(0.4+f)*b,1*c,0.4*b,1*c);a.lineTo(0,1*c);a.lineTo(0,0);a.lineTo(0.4*b,0);Q(a,(0.4+f)*b,0,0.8*b,(0.5-g)*c,0.8*b,0.5*c);P(a,1*b,0.5*c,!0);Q(a,1*b,(0.5+d)*c,(0.9+d)*b,0.6*c,0.9*b,0.6*c);Q(a,(0.9-d)*b,0.6*c,0.8*b,(0.5+d)*c,0.8*b,0.5*c);Q(a,0.8*b,(0.5-d)*c,(0.9-d)*b,0.4*c,0.9*b,0.4*c);Q(a,(0.9+d)*b,0.4*c,1*b,(0.5-d)*c,1*b,0.5*c);b=a.s;b.G=new L(0,0.05);b.H=new L(0.55,
0.95);t.v(a);return b},NorGate:function(a,b,c){a=t.u();var d=K.za,f=0.5,g=d*f,h=0,k=0.5;P(a,0.8*b,0.5*c,!0);Q(a,0.7*b,(k+g)*c,(h+g)*b,(k+f)*c,0,1*c);Q(a,0.25*b,0.75*c,0.25*b,0.25*c,0,0);Q(a,(h+g)*b,(k-f)*c,0.7*b,(k-g)*c,0.8*b,0.5*c);f=0.1;g=0.1*d;h=0.9;k=0.5;P(a,(h-f)*b,k*c,!0);Q(a,(h-f)*b,(k-g)*c,(h-g)*b,(k-f)*c,h*b,(k-f)*c);Q(a,(h+g)*b,(k-f)*c,(h+f)*b,(k-g)*c,(h+f)*b,k*c);Q(a,(h+f)*b,(k+g)*c,(h+g)*b,(k+f)*c,h*b,(k+f)*c);Q(a,(h-g)*b,(k+f)*c,(h-f)*b,(k+g)*c,(h-f)*b,k*c);b=a.s;b.G=new L(0.2,0.25);
b.H=new L(0.6,0.75);t.v(a);return b},OrGate:function(a,b,c){a=t.u();var d=0.5*K.za;P(a,0,0,!0);Q(a,(0+d+d)*b,0*c,0.8*b,(0.5-d)*c,1*b,0.5*c);Q(a,0.8*b,(0.5+d)*c,(0+d+d)*b,1*c,0,1*c);Q(a,0.25*b,0.75*c,0.25*b,0.25*c,0,0);S(a);b=a.s;b.G=new L(0.2,0.25);b.H=new L(0.75,0.75);t.v(a);return b},XnorGate:function(a,b,c){a=t.u();var d=K.za,f=0.5,g=d*f,h=0.2,k=0.5;P(a,0.1*b,0,!1);Q(a,0.35*b,0.25*c,0.35*b,0.75*c,0.1*b,1*c);P(a,0.8*b,0.5*c,!0);Q(a,0.7*b,(k+g)*c,(h+g)*b,(k+f)*c,0.2*b,1*c);Q(a,0.45*b,0.75*c,0.45*
b,0.25*c,0.2*b,0);Q(a,(h+g)*b,(k-f)*c,0.7*b,(k-g)*c,0.8*b,0.5*c);f=0.1;g=0.1*d;h=0.9;k=0.5;P(a,(h-f)*b,k*c,!0);Q(a,(h-f)*b,(k-g)*c,(h-g)*b,(k-f)*c,h*b,(k-f)*c);Q(a,(h+g)*b,(k-f)*c,(h+f)*b,(k-g)*c,(h+f)*b,k*c);Q(a,(h+f)*b,(k+g)*c,(h+g)*b,(k+f)*c,h*b,(k+f)*c);Q(a,(h-g)*b,(k+f)*c,(h-f)*b,(k+g)*c,(h-f)*b,k*c);b=a.s;b.G=new L(0.4,0.25);b.H=new L(0.65,0.75);t.v(a);return b},XorGate:function(a,b,c){a=t.u();var d=0.5*K.za;P(a,0.1*b,0,!1);Q(a,0.35*b,0.25*c,0.35*b,0.75*c,0.1*b,1*c);P(a,0.2*b,0,!0);Q(a,(0.2+
d)*b,0*c,0.9*b,(0.5-d)*c,1*b,0.5*c);Q(a,0.9*b,(0.5+d)*c,(0.2+d)*b,1*c,0.2*b,1*c);Q(a,0.45*b,0.75*c,0.45*b,0.25*c,0.2*b,0);S(a);b=a.s;b.G=new L(0.4,0.25);b.H=new L(0.8,0.75);t.v(a);return b},Capacitor:function(a,b,c){a=t.u();P(a,0,0,!1);a.lineTo(0,1*c);a.moveTo(1*b,0);a.lineTo(1*b,1*c);b=a.s;t.v(a);return b},Resistor:function(a,b,c){a=t.u();P(a,0,0.5*c,!1);a.lineTo(0.1*b,0);a.lineTo(0.2*b,1*c);a.lineTo(0.3*b,0);a.lineTo(0.4*b,1*c);a.lineTo(0.5*b,0);a.lineTo(0.6*b,1*c);a.lineTo(0.7*b,0.5*c);b=a.s;t.v(a);
return b},Inductor:function(a,b,c){a=t.u();var d=0.1*K.za,f=0.1,g=0.5;P(a,(f-0.5*d)*b,(g+0.1)*c,!1);Q(a,(f-d)*b,(g+0.1)*c,(f-0.1)*b,(g+d)*c,(f+0.1)*b,(g+d)*c);f=0.3;g=0.5;Q(a,(f+0.1)*b,(g+d)*c,(f+d)*b,(g+0.1)*c,f*b,(g+0.1)*c);Q(a,(f-d)*b,(g+0.1)*c,(f-0.1)*b,(g+d)*c,(f+0.1)*b,(g+d)*c);g=f=0.5;Q(a,(f+0.1)*b,(g+d)*c,(f+d)*b,(g+0.1)*c,f*b,(g+0.1)*c);Q(a,(f-d)*b,(g+0.1)*c,(f-0.1)*b,(g+d)*c,(f+0.1)*b,(g+d)*c);f=0.7;g=0.5;Q(a,(f+0.1)*b,(g+d)*c,(f+d)*b,(g+0.1)*c,f*b,(g+0.1)*c);Q(a,(f-d)*b,(g+0.1)*c,(f-0.1)*
b,(g+d)*c,(f+0.1)*b,(g+d)*c);f=0.9;g=0.5;Q(a,(f+0.1)*b,(g+d)*c,(f+d)*b,(g+0.1)*c,(f+0.5*d)*b,(g+0.1)*c);b=a.s;t.v(a);return b},ACvoltageSource:function(a,b,c){a=t.u();var d=0.5*K.za;P(a,0*b,0.5*c,!1);Q(a,0*b,(0.5-d)*c,(0.5-d)*b,0*c,0.5*b,0*c);Q(a,(0.5+d)*b,0*c,1*b,(0.5-d)*c,1*b,0.5*c);Q(a,1*b,(0.5+d)*c,(0.5+d)*b,1*c,0.5*b,1*c);Q(a,(0.5-d)*b,1*c,0*b,(0.5+d)*c,0*b,0.5*c);a.moveTo(0.1*b,0.5*c);Q(a,0.5*b,0*c,0.5*b,1*c,0.9*b,0.5*c);b=a.s;b.Ac=dh;t.v(a);return b},DCvoltageSource:function(a,b,c){a=t.u();
P(a,0,0.75*c,!1);a.lineTo(0,0.25*c);a.moveTo(1*b,0);a.lineTo(1*b,1*c);b=a.s;t.v(a);return b},Diode:function(a,b,c){a=t.u();P(a,1*b,0,!1);a.lineTo(1*b,0.5*c);a.lineTo(0,1*c);a.lineTo(0,0);a.lineTo(1*b,0.5*c);a.lineTo(1*b,1*c);b=a.s;b.G=new L(0,0.25);b.H=new L(0.5,0.75);t.v(a);return b},Wifi:function(a,b,c){var d=b,f=c;b*=0.38;c*=0.6;a=t.u();var g=K.za,h=0.8*g,k=0.8,l=0,m=0.5,d=(d-b)/2,f=(f-c)/2;P(a,l*b+d,(m+k)*c+f,!0);Q(a,(l-h)*b+d,(m+k)*c+f,(l-k)*b+d,(m+h)*c+f,(l-k)*b+d,m*c+f);Q(a,(l-k)*b+d,(m-h)*
c+f,(l-h)*b+d,(m-k)*c+f,l*b+d,(m-k)*c+f);Q(a,l*b+d,(m-k)*c+f,(l-k+0.5*h)*b+d,(m-h)*c+f,(l-k+0.5*h)*b+d,m*c+f);Q(a,(l-k+0.5*h)*b+d,(m+h)*c+f,l*b+d,(m+k)*c+f,l*b+d,(m+k)*c+f);S(a);h=0.4*g;k=0.4;l=0.2;m=0.5;P(a,l*b+d,(m+k)*c+f,!0);Q(a,(l-h)*b+d,(m+k)*c+f,(l-k)*b+d,(m+h)*c+f,(l-k)*b+d,m*c+f);Q(a,(l-k)*b+d,(m-h)*c+f,(l-h)*b+d,(m-k)*c+f,l*b+d,(m-k)*c+f);Q(a,l*b+d,(m-k)*c+f,(l-k+0.5*h)*b+d,(m-h)*c+f,(l-k+0.5*h)*b+d,m*c+f);Q(a,(l-k+0.5*h)*b+d,(m+h)*c+f,l*b+d,(m+k)*c+f,l*b+d,(m+k)*c+f);S(a);h=0.2*g;k=0.2;
m=l=0.5;P(a,(l-k)*b+d,m*c+f,!0);Q(a,(l-k)*b+d,(m-h)*c+f,(l-h)*b+d,(m-k)*c+f,l*b+d,(m-k)*c+f);Q(a,(l+h)*b+d,(m-k)*c+f,(l+k)*b+d,(m-h)*c+f,(l+k)*b+d,m*c+f);Q(a,(l+k)*b+d,(m+h)*c+f,(l+h)*b+d,(m+k)*c+f,l*b+d,(m+k)*c+f);Q(a,(l-h)*b+d,(m+k)*c+f,(l-k)*b+d,(m+h)*c+f,(l-k)*b+d,m*c+f);h=0.4*g;k=0.4;l=0.8;m=0.5;P(a,l*b+d,(m-k)*c+f,!0);Q(a,(l+h)*b+d,(m-k)*c+f,(l+k)*b+d,(m-h)*c+f,(l+k)*b+d,m*c+f);Q(a,(l+k)*b+d,(m+h)*c+f,(l+h)*b+d,(m+k)*c+f,l*b+d,(m+k)*c+f);Q(a,l*b+d,(m+k)*c+f,(l+k-0.5*h)*b+d,(m+h)*c+f,(l+k-0.5*
h)*b+d,m*c+f);Q(a,(l+k-0.5*h)*b+d,(m-h)*c+f,l*b+d,(m-k)*c+f,l*b+d,(m-k)*c+f);S(a);h=0.8*g;k=0.8;l=1;m=0.5;P(a,l*b+d,(m-k)*c+f,!0);Q(a,(l+h)*b+d,(m-k)*c+f,(l+k)*b+d,(m-h)*c+f,(l+k)*b+d,m*c+f);Q(a,(l+k)*b+d,(m+h)*c+f,(l+h)*b+d,(m+k)*c+f,l*b+d,(m+k)*c+f);Q(a,l*b+d,(m+k)*c+f,(l+k-0.5*h)*b+d,(m+h)*c+f,(l+k-0.5*h)*b+d,m*c+f);Q(a,(l+k-0.5*h)*b+d,(m-h)*c+f,l*b+d,(m-k)*c+f,l*b+d,(m-k)*c+f);S(a);b=a.s;t.v(a);return b},Email:function(a,b,c){a=t.u();P(a,0,0,!0);a.lineTo(1*b,0);a.lineTo(1*b,1*c);a.lineTo(0,1*
c);a.lineTo(0,0);S(a);P(a,0,0,!1);a.lineTo(0.5*b,0.6*c);a.lineTo(1*b,0);a.moveTo(0,1*c);a.lineTo(0.45*b,0.54*c);a.moveTo(1*b,1*c);a.lineTo(0.55*b,0.54*c);a.jb(!1);b=a.s;t.v(a);return b},Ethernet:function(a,b,c){a=t.u();P(a,0.35*b,0,!0);a.lineTo(0.65*b,0);a.lineTo(0.65*b,0.4*c);a.lineTo(0.35*b,0.4*c);a.lineTo(0.35*b,0);S(a);P(a,0.1*b,1*c,!0,!0);a.lineTo(0.4*b,1*c);a.lineTo(0.4*b,0.6*c);a.lineTo(0.1*b,0.6*c);a.lineTo(0.1*b,1*c);S(a);P(a,0.6*b,1*c,!0,!0);a.lineTo(0.9*b,1*c);a.lineTo(0.9*b,0.6*c);a.lineTo(0.6*
b,0.6*c);a.lineTo(0.6*b,1*c);S(a);P(a,0,0.5*c,!1);a.lineTo(1*b,0.5*c);a.moveTo(0.5*b,0.5*c);a.lineTo(0.5*b,0.4*c);a.moveTo(0.75*b,0.5*c);a.lineTo(0.75*b,0.6*c);a.moveTo(0.25*b,0.5*c);a.lineTo(0.25*b,0.6*c);a.jb(!1);b=a.s;t.v(a);return b},Power:function(a,b,c){a=t.u();var d=K.za,f=0.4*d,g=0.4,h=t.N(),k=t.N(),l=t.N(),m=t.N();K.hj(0.5,0.5-g,0.5+f,0.5-g,0.5+g,0.5-f,0.5+g,0.5,0.5,h,h,k,l,m);var n=t.qc(k.x,k.y);P(a,k.x*b,k.y*c,!0);Q(a,l.x*b,l.y*c,m.x*b,m.y*c,(0.5+g)*b,0.5*c);Q(a,(0.5+g)*b,(0.5+f)*c,(0.5+
f)*b,(0.5+g)*c,0.5*b,(0.5+g)*c);Q(a,(0.5-f)*b,(0.5+g)*c,(0.5-g)*b,(0.5+f)*c,(0.5-g)*b,0.5*c);K.hj(0.5-g,0.5,0.5-g,0.5-f,0.5-f,0.5-g,0.5,0.5-g,0.5,l,m,k,h,h);Q(a,l.x*b,l.y*c,m.x*b,m.y*c,k.x*b,k.y*c);f=0.3*d;g=0.3;K.hj(0.5-g,0.5,0.5-g,0.5-f,0.5-f,0.5-g,0.5,0.5-g,0.5,l,m,k,h,h);a.lineTo(k.x*b,k.y*c);Q(a,m.x*b,m.y*c,l.x*b,l.y*c,(0.5-g)*b,0.5*c);Q(a,(0.5-g)*b,(0.5+f)*c,(0.5-f)*b,(0.5+g)*c,0.5*b,(0.5+g)*c);Q(a,(0.5+f)*b,(0.5+g)*c,(0.5+g)*b,(0.5+f)*c,(0.5+g)*b,0.5*c);K.hj(0.5,0.5-g,0.5+f,0.5-g,0.5+g,0.5-
f,0.5+g,0.5,0.5,h,h,k,l,m);Q(a,m.x*b,m.y*c,l.x*b,l.y*c,k.x*b,k.y*c);S(a);P(a,0.45*b,0,!0);a.lineTo(0.45*b,0.5*c);a.lineTo(0.55*b,0.5*c);a.lineTo(0.55*b,0);S(a);t.B(h);t.B(k);t.B(l);t.B(m);t.B(n);b=a.s;b.G=new L(0.25,0.55);b.H=new L(0.75,0.8);t.v(a);return b},Fallout:function(a,b,c){a=t.u();var d=0.5*K.za;P(a,0*b,0.5*c,!0);Q(a,0*b,(0.5-d)*c,(0.5-d)*b,0*c,0.5*b,0*c);Q(a,(0.5+d)*b,0*c,1*b,(0.5-d)*c,1*b,0.5*c);Q(a,1*b,(0.5+d)*c,(0.5+d)*b,1*c,0.5*b,1*c);Q(a,(0.5-d)*b,1*c,0*b,(0.5+d)*c,0*b,0.5*c);var f=
d=0;P(a,(0.3+d)*b,(0.8+f)*c,!0,!0);a.lineTo((0.5+d)*b,(0.5+f)*c);a.lineTo((0.1+d)*b,(0.5+f)*c);a.lineTo((0.3+d)*b,(0.8+f)*c);d=0.4;f=0;S(a);P(a,(0.3+d)*b,(0.8+f)*c,!0,!0);a.lineTo((0.5+d)*b,(0.5+f)*c);a.lineTo((0.1+d)*b,(0.5+f)*c);a.lineTo((0.3+d)*b,(0.8+f)*c);d=0.2;f=-0.3;S(a);P(a,(0.3+d)*b,(0.8+f)*c,!0,!0);a.lineTo((0.5+d)*b,(0.5+f)*c);a.lineTo((0.1+d)*b,(0.5+f)*c);a.lineTo((0.3+d)*b,(0.8+f)*c);S(a);b=a.s;b.Ac=dh;t.v(a);return b},IrritationHazard:function(a,b,c){a=t.u();P(a,0.2*b,0*c,!0);a.lineTo(0.5*
b,0.3*c);a.lineTo(0.8*b,0*c);a.lineTo(1*b,0.2*c);a.lineTo(0.7*b,0.5*c);a.lineTo(1*b,0.8*c);a.lineTo(0.8*b,1*c);a.lineTo(0.5*b,0.7*c);a.lineTo(0.2*b,1*c);a.lineTo(0*b,0.8*c);a.lineTo(0.3*b,0.5*c);a.lineTo(0*b,0.2*c);S(a);b=a.s;b.G=new L(0.3,0.3);b.H=new L(0.7,0.7);t.v(a);return b},ElectricalHazard:function(a,b,c){a=t.u();P(a,0.37,0*c,!0);a.lineTo(0.5*b,0.11*c);a.lineTo(0.77*b,0.04*c);a.lineTo(0.33*b,0.49*c);a.lineTo(1*b,0.37*c);a.lineTo(0.63*b,0.86*c);a.lineTo(0.77*b,0.91*c);a.lineTo(0.34*b,1*c);a.lineTo(0.34*
b,0.78*c);a.lineTo(0.44*b,0.8*c);a.lineTo(0.65*b,0.56*c);a.lineTo(0*b,0.68*c);S(a);b=a.s;t.v(a);return b},FireHazard:function(a,b,c){a=t.u();P(a,0.1*b,1*c,!0);Q(a,-0.25*b,0.63*c,0.45*b,0.44*c,0.29*b,0*c);Q(a,0.48*b,0.17*c,0.54*b,0.35*c,0.51*b,0.42*c);Q(a,0.59*b,0.29*c,0.58*b,0.28*c,0.59*b,0.18*c);Q(a,0.8*b,0.34*c,0.88*b,0.43*c,0.75*b,0.6*c);Q(a,0.87*b,0.48*c,0.88*b,0.43*c,0.88*b,0.31*c);Q(a,1.17*b,0.76*c,0.82*b,0.8*c,0.9*b,1*c);S(a);b=a.s;b.G=new L(0.05,0.645);b.H=new L(0.884,0.908);t.v(a);return b},
BpmnActivityLoop:function(a,b,c){a=t.u();var d=4*(Math.SQRT2-1)/3*0.5;P(a,(0.5*Math.SQRT2/2+0.5)*b,(1-(0.5-0.5*Math.SQRT2/2))*c,!1);Q(a,1*b,0.7*c,1*b,0.5*c,1*b,0.5*c);Q(a,1*b,(0.5-d+0)*c,(0.5+d+0)*b,0*c,0.5*b,0*c);Q(a,(0.5-d+0)*b,0*c,0*b,(0.5-d+0)*c,0*b,0.5*c);Q(a,0*b,(0.5+d+0)*c,(0.5-d+0)*b,1*c,0.35*b,0.98*c);a.moveTo(0.35*b,0.8*c);a.lineTo(0.35*b,1*c);a.lineTo(0.15*b,1*c);b=a.s;t.v(a);return b},BpmnActivityParallel:function(a,b,c){a=t.u();P(a,0,0,!1);a.lineTo(0,1*c);a.moveTo(0.5*b,0);a.lineTo(0.5*
b,1*c);a.moveTo(1*b,0);a.lineTo(1*b,1*c);b=a.s;t.v(a);return b},BpmnActivitySequential:function(a,b,c){a=t.u();P(a,0,0,!1);a.lineTo(1*b,0);a.moveTo(0,0.5*c);a.lineTo(1*b,0.5*c);a.moveTo(0,1*c);a.lineTo(1*b,1*c);b=a.s;t.v(a);return b},BpmnActivityAdHoc:function(a,b,c){a=t.u();P(a,0,0,!1);P(a,1*b,1*c,!1);P(a,0,0.5*c,!1);Q(a,0.2*b,0.35*c,0.3*b,0.35*c,0.5*b,0.5*c);Q(a,0.7*b,0.65*c,0.8*b,0.65*c,1*b,0.5*c);b=a.s;t.v(a);return b},BpmnActivityCompensation:function(a,b,c){a=t.u();P(a,0,0.5*c,!0);a.lineTo(0.5*
b,0);a.lineTo(0.5*b,0.5*c);a.lineTo(1*b,1*c);a.lineTo(1*b,0);a.lineTo(0.5*b,0.5*c);a.lineTo(0.5*b,1*c);S(a);b=a.s;t.v(a);return b},BpmnTaskMessage:function(a,b,c){a=t.u();P(a,0,0.2*c,!0);a.lineTo(1*b,0.2*c);a.lineTo(1*b,0.8*c);a.lineTo(0,0.8*c);a.lineTo(0,0.8*c);S(a);P(a,0,0.2*c,!1);a.lineTo(0.5*b,0.5*c);a.lineTo(1*b,0.2*c);a.jb(!1);b=a.s;t.v(a);return b},BpmnTaskScript:function(a,b,c){a=t.u();P(a,0.7*b,1*c,!0);a.lineTo(0.3*b,1*c);Q(a,0.6*b,0.5*c,0,0.5*c,0.3*b,0);a.lineTo(0.7*b,0);Q(a,0.4*b,0.5*c,
1*b,0.5*c,0.7*b,1*c);S(a);P(a,0.45*b,0.73*c,!1);a.lineTo(0.7*b,0.73*c);a.moveTo(0.38*b,0.5*c);a.lineTo(0.63*b,0.5*c);a.moveTo(0.31*b,0.27*c);a.lineTo(0.56*b,0.27*c);a.jb(!1);b=a.s;t.v(a);return b},BpmnTaskUser:function(a,b,c){a=t.u();P(a,0,0,!1);P(a,0.335*b,(1-0.555)*c,!0);a.lineTo(0.335*b,0.595*c);a.lineTo(0.665*b,0.595*c);a.lineTo(0.665*b,(1-0.555)*c);Q(a,0.88*b,0.46*c,0.98*b,0.54*c,1*b,0.68*c);a.lineTo(1*b,1*c);a.lineTo(0,1*c);a.lineTo(0,0.68*c);Q(a,0.02*b,0.54*c,0.12*b,0.46*c,0.335*b,(1-0.555)*
c);a.lineTo(0.365*b,0.405*c);var d=0.5-0.285,f=Math.PI/4,g=4*(1-Math.cos(f))/(3*Math.sin(f)),f=g*d,g=g*d;Q(a,(0.5-(f+d)/2)*b,(d+(d+g)/2)*c,(0.5-d)*b,(d+g)*c,(0.5-d)*b,d*c);Q(a,(0.5-d)*b,(d-g)*c,(0.5-f)*b,(d-d)*c,0.5*b,(d-d)*c);Q(a,(0.5+f)*b,(d-d)*c,(0.5+d)*b,(d-g)*c,(0.5+d)*b,d*c);Q(a,(0.5+d)*b,(d+g)*c,(0.5+(f+d)/2)*b,(d+(d+g)/2)*c,0.635*b,0.405*c);a.lineTo(0.635*b,0.405*c);a.lineTo(0.665*b,(1-0.555)*c);a.lineTo(0.665*b,0.595*c);a.lineTo(0.335*b,0.595*c);P(a,0.2*b,1*c,!1);a.lineTo(0.2*b,0.8*c);P(a,
0.8*b,1*c,!1);a.lineTo(0.8*b,0.8*c);b=a.s;t.v(a);return b},BpmnEventConditional:function(a,b,c){a=t.u();P(a,0.1*b,0,!0);a.lineTo(0.9*b,0);a.lineTo(0.9*b,1*c);a.lineTo(0.1*b,1*c);S(a);P(a,0.2*b,0.2*c,!1);a.lineTo(0.8*b,0.2*c);a.moveTo(0.2*b,0.4*c);a.lineTo(0.8*b,0.4*c);a.moveTo(0.2*b,0.6*c);a.lineTo(0.8*b,0.6*c);a.moveTo(0.2*b,0.8*c);a.lineTo(0.8*b,0.8*c);a.jb(!1);b=a.s;t.v(a);return b},BpmnEventError:function(a,b,c){a=t.u();P(a,0,1*c,!0);a.lineTo(0.33*b,0);a.lineTo(0.66*b,0.5*c);a.lineTo(1*b,0);a.lineTo(0.66*
b,1*c);a.lineTo(0.33*b,0.5*c);S(a);b=a.s;t.v(a);return b},BpmnEventEscalation:function(a,b,c){a=t.u();P(a,0,0,!1);P(a,1*b,1*c,!1);P(a,0.1*b,1*c,!0);a.lineTo(0.5*b,0);a.lineTo(0.9*b,1*c);a.lineTo(0.5*b,0.5*c);S(a);b=a.s;t.v(a);return b},BpmnEventTimer:function(a,b,c){a=t.u();var d=0.5*K.za;P(a,1*b,0.5*c,!0);Q(a,1*b,(0.5+d)*c,(0.5+d)*b,1*c,0.5*b,1*c);Q(a,(0.5-d)*b,1*c,0,(0.5+d)*c,0,0.5*c);Q(a,0,(0.5-d)*c,(0.5-d)*b,0,0.5*b,0);Q(a,(0.5+d)*b,0,1*b,(0.5-d)*c,1*b,0.5*c);P(a,0.5*b,0,!1);a.lineTo(0.5*b,0.15*
c);a.moveTo(0.5*b,1*c);a.lineTo(0.5*b,0.85*c);a.moveTo(0,0.5*c);a.lineTo(0.15*b,0.5*c);a.moveTo(1*b,0.5*c);a.lineTo(0.85*b,0.5*c);a.moveTo(0.5*b,0.5*c);a.lineTo(0.58*b,0.1*c);a.moveTo(0.5*b,0.5*c);a.lineTo(0.78*b,0.54*c);a.jb(!1);b=a.s;b.Ac=dh;t.v(a);return b}};K.eB={};for(var tm in K.oj)K.oj[tm.toLowerCase()]=tm;
K.tw={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",
BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",
BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",
TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",
BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",
DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",
TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",
OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",
OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};K.Rm={};K.mK=function(){if(K.tw){for(var a in K.tw){var b=ed(K.tw[a],!1);K.Rm[a]=b;a.toLowerCase()!==a&&(K.Rm[a.toLowerCase()]=a)}K.tw=void 0}};
K.qE=function(a){K.mK();var b=K.Rm[a];if(void 0===b){b=a.toLowerCase();if("none"===b)return"None";b=K.Rm[b]}return"string"===typeof b?b:b instanceof Pc?a:null};W.FigureGenerators=K.oj;W.ArrowheadGeometries=K.Rm;
function x(a){0===arguments.length?C.call(this):C.call(this,a);this.Z=311807;this.Xk=this.Eh="";this.ms=this.js=this.ws=this.xr=null;this.ys="";this.Vg=this.xs=this.Fm=null;this.ls="";this.Lo=null;this.ks=(new ra(NaN,NaN)).freeze();this.ns="";this.Mo=null;this.re="";this.Co=this.Lq=this.Mk=null;this.hh=(new E(NaN,NaN)).freeze();this.Er="";this.$k=null;this.Fr=Vb;this.Pr=K.tH;this.Hr=K.sH;this.Vq=null;this.yr=um;this.Im=(new E(6,6)).freeze();this.Hm="gray";this.Gm=4;this.$C=-1;this.DH=new F;this.Uj=
null;this.Rj=NaN}t.ka("Part",x);t.Qa(x,C);x.prototype.cloneProtected=function(a){C.prototype.cloneProtected.call(this,a);a.Z=this.Z&-4097|49152;a.Eh=this.Eh;a.Xk=this.Xk;a.xr=this.xr;a.ws=this.ws;a.js=this.js;a.ms=this.ms;a.ys=this.ys;a.xs=this.xs;a.Vg=null;a.ls=this.ls;a.ks.assign(this.ks);a.ns=this.ns;a.re=this.re;a.Lq=this.Lq;a.hh.assign(this.hh);a.Er=this.Er;a.Fr=this.Fr.ba();a.Pr=this.Pr.ba();a.Hr=this.Hr.ba();a.Vq=this.Vq;a.yr=this.yr;a.Im.assign(this.Im);a.Hm=this.Hm;a.Gm=this.Gm};
x.prototype.ji=function(a){C.prototype.ji.call(this,a);tk(a);a.Fm=null;a.Lo=null;a.Mo=null;a.$k=null;a.Uj=null};x.prototype.toString=function(){var a=t.Dg(Object.getPrototypeOf(this))+"#"+t.ud(this);this.data&&(a+="("+na(this.data)+")");return a};x.LayoutNone=0;var dj;x.LayoutAdded=dj=1;var jj;x.LayoutRemoved=jj=2;x.LayoutShown=4;x.LayoutHidden=8;x.LayoutNodeSized=16;var Oj;x.LayoutGroupLayout=Oj=32;x.LayoutNodeReplaced=64;var um;x.LayoutStandard=um=dj|jj|28|Oj|64;
x.prototype.yn=function(a,b,c,d,f,g,h){var k=this.h;null!==k&&(a===Md&&"elements"===b?f instanceof C&&ej(f,function(a){fj(k,a)}):a===Nd&&"elements"===b&&f instanceof C&&ej(f,function(a){ij(k,a)}),k.ed(a,b,c,d,f,g,h))};x.prototype.updateTargetBindings=x.prototype.Vb=function(a){C.prototype.Vb.call(this,a);if(null!==this.data){a=this.va.n;for(var b=a.length,c=0;c<b;c++){var d=a[c];d instanceof C&&ej(d,function(a){null!==a.data&&a.Vb()})}}};
x.prototype.updateModelDataReferences=function(){var a=this.data;if(null!==a&&!(this instanceof ea)){var b=this.h;if(null!==b){var c=b.ea;if(c instanceof T){var d=c.hn(a),b=b.dJ(d),f=this.fb;b!==f&&(b=null!==f?c.Lb(f.data):void 0,f=c.wn,"function"===typeof f?f(a,b):a[f]=b,c.Ix(a,d))}}}};t.A(x,{pw:"adornments"},function(){return null===this.Vg?t.fg:this.Vg.JF});x.prototype.findAdornment=x.prototype.np=function(a){e&&t.i(a,"string",x,"findAdornment:category");var b=this.Vg;return null===b?null:b.Da(a)};
x.prototype.addAdornment=x.prototype.il=function(a,b){if(null!==b){e&&(t.i(a,"string",x,"addAdornment:category"),t.l(b,ea,x,"addAdornment:ad"));var c=null,d=this.Vg;null!==d&&(c=d.Da(a));if(c!==b){if(null!==c){var f=c.h;null!==f&&f.remove(c)}null===d&&(this.Vg=d=new wa("string",ea));b.Eh!==a&&(b.cd=a);d.add(a,b);c=this.h;null!==c&&(c.add(b),b.data=this.data)}}};
x.prototype.removeAdornment=x.prototype.Hl=function(a){e&&t.i(a,"string",x,"removeAdornment:category");var b=this.Vg;if(null!==b){var c=b.Da(a);if(null!==c){var d=c.h;null!==d&&d.remove(c)}b.remove(a);0===b.count&&(this.Vg=null)}};x.prototype.clearAdornments=x.prototype.Uf=function(){var a=this.Vg;if(null!==a){for(var b=t.Hb(),a=a.k;a.next();)b.push(a.key);for(var a=b.length,c=0;c<a;c++)this.Hl(b[c]);t.Ca(b)}};
x.prototype.updateAdornments=function(){var a=this.h;if(null!==a){vm(this,a);for(var a=a.Cb.jf.n,b=a.length,c=0;c<b;c++){var d=a[c];d.isEnabled&&d.updateAdornments(this)}for(a=this.pw;a.next();)a.value.ja()}};
function vm(a,b){if(a.ib&&a.tB){var c=a.An;if(null===c||!(a.pa.P()&&a.Wa()&&c.Cl()&&c.pa.P()))return;var d=a.np("Selection");if(null===d){d=a.AG;null===d&&(a instanceof B?d=b.RF:a instanceof x&&(d=a instanceof z?b.nF:b.dG));if(!(d instanceof ea))return;cf(d);d=d.copy();if(!(d instanceof ea))return;d.cd="Selection";d.uc=c}if(null!==d){var f=d.placeholder;if(null!==f){var g=c.sk(),h=0;c instanceof W&&(h=c.lb);var k=t.Ml();k.p((c.Ja.width+h)*g,(c.Ja.height+h)*g);f.Ea=k;t.qk(k)}d.angle=c.ul();d.type!==
Lg?(f=t.N(),d.location=c.wb(Vb,f),t.B(f)):d.ja();a.il("Selection",d);return}}a.Hl("Selection")}t.A(x,{layer:"layer"},function(){return this.Co});t.A(x,{h:"diagram"},function(){var a=this.Co;return null!==a?a.h:null});t.g(x,"layerName",x.prototype.Ne);
t.defineProperty(x,{Ne:"layerName"},function(){return this.Xk},function(a){var b=this.Xk;if(b!==a){t.i(a,"string",x,"layerName");var c=this.h;if(null===c||null!==c.sl(a)&&!c.Ln)if(this.Xk=a,this.j("layerName",b,a),b=this.layer,null!==b&&b.name!==a&&(c=b.h,null!==c&&(a=c.sl(a),null!==a&&a!==b))){var d=b.cf(-1,this,!0);0<=d&&c.ed(Nd,"parts",b,this,null,d,!0);d=a.zp(99999999,this,!0);0<=d&&c.ed(Md,"parts",a,null,this,!0,d);d=this.Gp;if(null!==d){var f=c.Sa;c.Sa=!0;d(this,b,a);c.Sa=f}}}});
t.g(x,"layerChanged",x.prototype.Gp);t.defineProperty(x,{Gp:"layerChanged"},function(){return this.xr},function(a){var b=this.xr;b!==a&&(null!==a&&t.i(a,"function",x,"layerChanged"),this.xr=a,this.j("layerChanged",b,a))});t.A(x,{Dc:"isTemporary"},function(){return null!==this.Co?this.Co.Dc:!1});function wm(a){var b=a.h;null!==b&&(Di(b),0!==(a.Z&16384)!==!0&&(a.Z|=16384,b.ie()))}function Yh(a){0!==(a.Z&16384)!==!1&&(a.updateAdornments(),a.Z&=-16385,a=a.h,null!==a&&(a.Be=!0))}t.g(x,"location",x.prototype.location);
t.defineProperty(x,{location:"location"},function(){return this.hh},function(a){var b=this.hh;if(!(b.O(a)||this instanceof B)){e&&t.l(a,E,x,"location");a=a.ba();var c=this.h;this.hh=a;if(!1===Vi(this)){var d=this.Pa,f=a.x-b.x,g=a.y-b.y,h=d.copy();d.p(h.x+f,h.y+g);Nk(this,!0);!d.O(h)&&c&&this.j("position",h,d)}this.j("location",b,a)}});function Nk(a,b){if(!1===Wi(a)){var c=a.h;null!==c&&(a.Wa()&&c.lg.add(a),a instanceof y&&!c.ma.yb&&a.Cf(),b||c.ie());xm(a,!0)}}
function ym(a){if(!1!==Wi(a)){var b=a.position,c=a.location;c.P()&&b.P()||(zm(a,b,c),pk(a));var b=a.Pa,c=a.Pb,d=c.copy();c.Ra();c.x=b.x;c.y=b.y;c.freeze();qk(a,d,c);xm(a,!1)}}t.A(x,{Zb:"locationObject"},function(){if(null===this.$k){var a=this.Jt;void 0!==a&&null!==a&&""!==a?(a=this.ue(a),this.$k=null!==a?a:this):this.$k=this instanceof ea&&this.ga!==Lg&&null!==this.Nb?this.Nb:this}return this.$k.visible?this.$k:this});t.g(x,"minLocation",x.prototype.ZF);
t.defineProperty(x,{ZF:"minLocation"},function(){return this.Pr},function(a){var b=this.Pr;b.O(a)||(e&&t.l(a,E,x,"minLocation"),this.Pr=a=a.ba(),this.j("minLocation",b,a))});t.g(x,"maxLocation",x.prototype.TF);t.defineProperty(x,{TF:"maxLocation"},function(){return this.Hr},function(a){var b=this.Hr;b.O(a)||(e&&t.l(a,E,x,"maxLocation"),this.Hr=a=a.ba(),this.j("maxLocation",b,a))});t.g(x,"locationObjectName",x.prototype.Jt);
t.defineProperty(x,{Jt:"locationObjectName"},function(){return this.Er},function(a){var b=this.Er;b!==a&&(e&&t.i(a,"string",x,"locationObjectName"),this.Er=a,this.$k=null,Gk(this),this.j("locationObjectName",b,a))});t.g(x,"locationSpot",x.prototype.gf);
t.defineProperty(x,{gf:"locationSpot"},function(){return this.Fr},function(a){var b=this.Fr;b.O(a)||(e&&(t.l(a,L,x,"locationSpot"),a.Cd()||t.m("Part.locationSpot must be a specific Spot value, not: "+a)),this.Fr=a=a.ba(),Gk(this),this.j("locationSpot",b,a))});x.prototype.move=x.prototype.move=function(a){this.position=a};x.prototype.moveTo=x.prototype.moveTo=function(a,b){var c=t.qc(a,b);this.move(c);t.B(c)};
x.prototype.isVisible=x.prototype.Wa=function(){if(!this.visible)return!1;var a=this.layer;if(null!==a&&!a.visible)return!1;a=this.fb;if(!(null===a||a.xe&&a.Wa()))return!1;if(this instanceof y){a=this.uA();if(null!==a&&!a.Uc)return!1;a=this.Dd;if(null!==a)return a.Wa()}else if(this instanceof B){var b=!0,c=this.h;null!==c&&(b=c.vd);c=this.ca;if(null!==c){if(this.Ic&&b&&!c.Uc)return!1;c=c.findVisibleNode();if(null===c||c===a)return!1}c=this.fa;if(null!==c){if(this.Ic&&!b&&!c.Uc)return!1;b=c.findVisibleNode();
if(null===b||b===a)return!1}}return!0};x.prototype.sh=function(a){a?(this.M(4),wm(this),this.na(),a=this.h,null!==a&&a.lg.add(this)):(this.M(8),this.Uf())};
x.prototype.findObject=x.prototype.ue=function(a){if(this.name===a)return this;null===this.Uj&&(this.Uj={});var b=this.Uj;if(void 0!==b[a])return b[a];for(var c=this.va.n,d=c.length,f=0;f<d;f++){var g=c[f];if(g.name===a)return b[a]=g;if(g instanceof C)if(null===g.Li&&null===g.ng){if(g=g.ue(a),null!==g)return b[a]=g}else if(Wl(g)&&(g=g.va.gb(),null!==g&&g.name===a))return b[a]=g}return b[a]=null};
function Am(a,b,c,d){void 0===d&&(d=new E);c.Me()&&(c=Yb);var f=b.Ja;d.p(f.width*c.x+c.offsetX,f.height*c.y+c.offsetY);if(null===b||b===a)return d;b.transform.Xa(d);for(b=b.ia;null!==b&&b!==a;)b.transform.Xa(d),b=b.ia;a.Zk.Xa(d);d.offset(-a.$c.x,-a.$c.y);return d}x.prototype.ensureBounds=x.prototype.xf=function(){xh(this,Infinity,Infinity);this.Pc()};
function ai(a,b,c){c=void 0===c?a.DH:c;var d;isNaN(a.Rj)&&(a.Rj=Xl(a));d=a.Rj;var f=2*d;if(!a.qi)return c.p(b.x-1-d,b.y-1-d,b.width+2+f,b.height+2+f),c;d=b.x;var f=b.y,g=b.width;b=b.height;var h=a.shadowBlur;a=a.HG;g+=h;b+=h;d-=h/2;f-=h/2;0<a.x?g+=a.x:(d+=a.x,g-=a.x);0<a.y?b+=a.y:(f+=a.y,b-=a.y);c.p(d-1,f-1,g+2,b+2);return c}aa=x.prototype;
aa.Pc=function(){pk(this);if(!1===Vi(this))ym(this);else{var a=t.Jf();a.assign(this.Pb);Dk(this);this.Pb.Ra();var b=Xh(this);this.ik(0,0,this.$c.width,this.$c.height);var c=this.position;zm(this,c,this.location);var d=this.Pb;d.x=c.x;d.y=c.y;d.freeze();pk(this);qk(this,a,d);a.O(d)?this.bg(b):!this.Rd()||K.I(a.width,d.width)&&K.I(a.height,d.height)||0<=this.$C&&this.M(16);t.oc(a);xm(this,!1)}};
aa.FG=function(a,b){if(!a.P()||this instanceof B)return!1;if(this.h&&!(this instanceof ea)){var c=this.h.yi;c.zd&&Nh(c,this,b.copy(),a.copy())}var c=this.hh,d=c.copy();!1===Vi(this)?(c.p(c.x+(a.x-this.Pa.x),c.y+(a.y-this.Pa.y)),this.Pa=a,Nk(this,!0),pk(this),ym(this),c.O(d)||this.j("location",d,c)):(this.Pa=a,c.p(NaN,NaN));return!0};aa.GG=function(a,b){var c=this.hh;!1===Vi(this)?(this.hh.p(c.x+a-this.Pa.x,c.y+b-this.Pa.y),this.Pa.p(a,b),Nk(this,!1),pk(this)):(c.p(NaN,NaN),this.Pa.p(a,b))};
function zm(a,b,c){var d=NaN,f=NaN,g=t.N(),h=a.gf,k=a.Zb;h.Me()&&t.m("determineOffset: Part's locationSpot must be real: "+h.toString());var l=k.Ja,d=0;k.lb&&(d=k.qe);g.fu(0,0,l.width+d,l.height+d,h);if(k!==a)for(k.lb&&g.offset(-d/2,-d/2),k.transform.Xa(g),h=k.ia;null!==h&&h!==a;)h.transform.Xa(g),h=h.ia;a.Zk.Xa(g);g.offset(-a.$c.x,-a.$c.y);h=a.h;c.P()?(k=b.x,l=b.y,d=c.x-g.x,f=c.y-g.y,b.p(d,f),c=!1,null!==h&&(d=h.yi,d.Kj?c=!0:!d.zd||a instanceof ea||Nh(d,a,new E(k,l),b),c||b.x===k&&b.y===l||(d=h.ab,
h.ab=!0,a.j("position",new E(k,l),b),h.ab=d))):b.P()&&(d=b.x,f=b.y,b=c.copy(),c.p(d+g.x,f+g.y),c.O(b)||null===h||(d=h.ab,h.ab=!0,a.j("location",b,c),h.ab=d));t.B(g)}function gj(a,b,c){vk(a,!1);a instanceof y&&Vj(c,a);a.layer.Dc||b||c.Sc();b=a.Pb;var d=c.Ab;d.P()?(Xh(a)?Eb(b,d)||(a.bg(!1),wm(a)):b.Xf(d)&&a.bg(!0),a.updateAdornments()):c.Vk=!0}aa.Bl=function(){return!0};
function Zh(a,b){if(a.visible){var c=a.Pb;if(0!==c.width&&0!==c.height&&!isNaN(c.x)&&!isNaN(c.y)){var d=a.transform,f=a.ia,g=a.Ch;g.reset();null!==f&&(f.Kf()?g.multiply(f.se):null!==f.ia&&g.multiply(f.ia.se));g.multiply(a.Oc);null!==a.zc&&(Ak(a,b,a.zc,!0,!0),b.fillRect(c.x,c.y,c.width,c.height));null===a.zc&&null===a.Qb&&(b.fillStyle="rgba(0,0,0,0.4)",b.fillRect(c.x,c.y,c.width,c.height));null!==a.Qb&&(d.Et()||b.transform(d.m11,d.m12,d.m21,d.m22,d.dx,d.dy),f=a.Ja,c=f.width,f=f.height,Ak(a,b,a.Qb,
!0),b.fillRect(0,0,c+0,f+0),d.Et()||(c=1/(d.m11*d.m22-d.m12*d.m21),b.transform(d.m22*c,-d.m12*c,-d.m21*c,d.m11*c,c*(d.m21*d.dy-d.m22*d.dx),c*(d.m12*d.dx-d.m11*d.dy))))}}}aa.Rd=function(){return!0};t.g(x,"category",x.prototype.cd);
t.defineProperty(x,{cd:"category"},function(){return this.Eh},function(a){var b=this.Eh;if(b!==a){t.i(a,"string",x,"category");this.Eh=a;this.j("category",b,a);var c=this.h,d=this.data;if(null!==c&&null!==d){var f=c.ea;this instanceof B?(f instanceof T?f.DG(d,a):f instanceof ce&&f.kK(d,a),c=c.findTemplateForLinkData(d,a),c instanceof B&&(cf(c),c=c.copy(),c instanceof B&&Bm(this,c,b,a))):this instanceof ea||(null!==f&&f.Fx(d,a),c=c.findTemplateForNodeData(d,a),c instanceof x&&(cf(c),c=c.copy(),c instanceof
x&&!(c instanceof B)&&(c.location=this.location,Bm(this,c,b,a))))}this instanceof ea&&(a=this.hi,null!==a&&(c=a.Vg,null!==c&&c.remove(b),a.il(this.Eh,this)))}});
function Bm(a,b,c,d){b.constructor===a.constructor||t.gH||(t.gH=!0,t.trace('Should not change the class of the Part when changing category from "'+c+'" to "'+d+'"'),t.trace("  Old class: "+t.Dg(a)+", new class: "+t.Dg(b)+", part: "+a.toString()));a.Uf();var f=a.data;c=a.Ne;var g=a.ib,h=a.Fg,k=!0,l=!0,m=!1;a instanceof y&&(k=a.ri,l=a.Uc,m=a.Hn);b.ji(a);b.cloneProtected(a);a.Eh=d;a.ja();a.na();b=a.h;d=!0;null!==b&&(d=b.ab,b.ab=!0);a.Zl=f;null!==f&&a.Vb();null!==b&&(b.ab=d);f=a.Ne;f!==c&&(a.Xk=c,a.Ne=
f);a instanceof y&&(a.ri=k,a.Uc=l,a.Hn=m,a.Rd()&&a.M(64));a.ib=g;a.Fg=h}x.prototype.canCopy=function(){if(!this.lA)return!1;var a=this.layer;if(null===a)return!0;if(!a.dj)return!1;a=a.h;return null===a?!0:a.dj?!0:!1};x.prototype.canDelete=function(){if(!this.nA)return!1;var a=this.layer;if(null===a)return!0;if(!a.ll)return!1;a=a.h;return null===a?!0:a.ll?!0:!1};
x.prototype.canEdit=function(){if(!this.DB)return!1;var a=this.layer;if(null===a)return!0;if(!a.cp)return!1;a=a.h;return null===a?!0:a.cp?!0:!1};x.prototype.canGroup=function(){if(!this.DA)return!1;var a=this.layer;if(null===a)return!0;if(!a.Zo)return!1;a=a.h;return null===a?!0:a.Zo?!0:!1};x.prototype.canMove=function(){if(!this.WA)return!1;var a=this.layer;if(null===a)return!0;if(!a.fk)return!1;a=a.h;return null===a?!0:a.fk?!0:!1};
x.prototype.canReshape=function(){if(!this.oB)return!1;var a=this.layer;if(null===a)return!0;if(!a.$o)return!1;a=a.h;return null===a?!0:a.$o?!0:!1};x.prototype.canResize=function(){if(!this.pB)return!1;var a=this.layer;if(null===a)return!0;if(!a.ap)return!1;a=a.h;return null===a?!0:a.ap?!0:!1};x.prototype.canRotate=function(){if(!this.qB)return!1;var a=this.layer;if(null===a)return!0;if(!a.bp)return!1;a=a.h;return null===a?!0:a.bp?!0:!1};
x.prototype.canSelect=function(){if(!this.uk)return!1;var a=this.layer;if(null===a)return!0;if(!a.Ve)return!1;a=a.h;return null===a?!0:a.Ve?!0:!1};t.g(x,"copyable",x.prototype.lA);t.defineProperty(x,{lA:"copyable"},function(){return 0!==(this.Z&1)},function(a){var b=0!==(this.Z&1);b!==a&&(e&&t.i(a,"boolean",x,"copyable"),this.Z^=1,this.j("copyable",b,a))});t.g(x,"deletable",x.prototype.nA);
t.defineProperty(x,{nA:"deletable"},function(){return 0!==(this.Z&2)},function(a){var b=0!==(this.Z&2);b!==a&&(e&&t.i(a,"boolean",x,"deletable"),this.Z^=2,this.j("deletable",b,a))});t.g(x,"textEditable",x.prototype.DB);t.defineProperty(x,{DB:"textEditable"},function(){return 0!==(this.Z&4)},function(a){var b=0!==(this.Z&4);b!==a&&(e&&t.i(a,"boolean",x,"textEditable"),this.Z^=4,this.j("textEditable",b,a),this.updateAdornments())});t.g(x,"groupable",x.prototype.DA);
t.defineProperty(x,{DA:"groupable"},function(){return 0!==(this.Z&8)},function(a){var b=0!==(this.Z&8);b!==a&&(e&&t.i(a,"boolean",x,"groupable"),this.Z^=8,this.j("groupable",b,a))});t.g(x,"movable",x.prototype.WA);t.defineProperty(x,{WA:"movable"},function(){return 0!==(this.Z&16)},function(a){var b=0!==(this.Z&16);b!==a&&(e&&t.i(a,"boolean",x,"movable"),this.Z^=16,this.j("movable",b,a))});t.g(x,"selectionAdorned",x.prototype.tB);
t.defineProperty(x,{tB:"selectionAdorned"},function(){return 0!==(this.Z&32)},function(a){var b=0!==(this.Z&32);b!==a&&(e&&t.i(a,"boolean",x,"selectionAdorned"),this.Z^=32,this.j("selectionAdorned",b,a),this.updateAdornments())});t.g(x,"isInDocumentBounds",x.prototype.hx);t.defineProperty(x,{hx:"isInDocumentBounds"},function(){return 0!==(this.Z&64)},function(a){var b=0!==(this.Z&64);b!==a&&(e&&t.i(a,"boolean",x,"isInDocumentBounds"),this.Z^=64,this.j("isInDocumentBounds",b,a))});
t.g(x,"isLayoutPositioned",x.prototype.jx);t.defineProperty(x,{jx:"isLayoutPositioned"},function(){return 0!==(this.Z&128)},function(a){var b=0!==(this.Z&128);b!==a&&(e&&t.i(a,"boolean",x,"isLayoutPositioned"),this.Z^=128,this.j("isLayoutPositioned",b,a),this.M(a?4:8))});t.g(x,"selectable",x.prototype.uk);t.defineProperty(x,{uk:"selectable"},function(){return 0!==(this.Z&256)},function(a){var b=0!==(this.Z&256);b!==a&&(e&&t.i(a,"boolean",x,"selectable"),this.Z^=256,this.j("selectable",b,a),this.updateAdornments())});
t.g(x,"reshapable",x.prototype.oB);t.defineProperty(x,{oB:"reshapable"},function(){return 0!==(this.Z&512)},function(a){var b=0!==(this.Z&512);b!==a&&(e&&t.i(a,"boolean",x,"reshapable"),this.Z^=512,this.j("reshapable",b,a),this.updateAdornments())});t.g(x,"resizable",x.prototype.pB);t.defineProperty(x,{pB:"resizable"},function(){return 0!==(this.Z&1024)},function(a){var b=0!==(this.Z&1024);b!==a&&(e&&t.i(a,"boolean",x,"resizable"),this.Z^=1024,this.j("resizable",b,a),this.updateAdornments())});
t.g(x,"rotatable",x.prototype.qB);t.defineProperty(x,{qB:"rotatable"},function(){return 0!==(this.Z&2048)},function(a){var b=0!==(this.Z&2048);b!==a&&(e&&t.i(a,"boolean",x,"rotatable"),this.Z^=2048,this.j("rotatable",b,a),this.updateAdornments())});t.g(x,"isSelected",x.prototype.ib);
t.defineProperty(x,{ib:"isSelected"},function(){return 0!==(this.Z&4096)},function(a){var b=0!==(this.Z&4096);if(b!==a){e&&t.i(a,"boolean",x,"isSelected");var c=this.h;if(!a||this.canSelect()&&!(null!==c&&c.selection.count>=c.UF)){this.Z^=4096;var d=!1;if(null!==c){d=c.ab;c.ab=!0;var f=c.selection;f.Ra();a?f.add(this):f.remove(this);f.freeze()}this.j("isSelected",b,a);wm(this);a=this.BG;null!==a&&a(this);null!==c&&(c.ie(),c.ab=d)}}});t.g(x,"isHighlighted",x.prototype.Fg);
t.defineProperty(x,{Fg:"isHighlighted"},function(){return 0!==(this.Z&524288)},function(a){var b=0!==(this.Z&524288);if(b!==a){e&&t.i(a,"boolean",x,"isHighlighted");this.Z^=524288;var c=this.h;null!==c&&(c=c.Zw,c.Ra(),a?c.add(this):c.remove(this),c.freeze());this.j("isHighlighted",b,a);this.na()}});t.g(x,"isShadowed",x.prototype.qi);
t.defineProperty(x,{qi:"isShadowed"},function(){return 0!==(this.Z&8192)},function(a){var b=0!==(this.Z&8192);b!==a&&(e&&t.i(a,"boolean",x,"isShadowed"),this.Z^=8192,this.j("isShadowed",b,a),this.na())});function Wi(a){return 0!==(a.Z&32768)}function xm(a,b){a.Z=b?a.Z|32768:a.Z&-32769}function vk(a,b){a.Z=b?a.Z|65536:a.Z&-65537}function Xh(a){return 0!==(a.Z&131072)}x.prototype.bg=function(a){this.Z=a?this.Z|131072:this.Z&-131073};t.g(x,"isAnimated",x.prototype.GA);
t.defineProperty(x,{GA:"isAnimated"},function(){return 0!==(this.Z&262144)},function(a){var b=0!==(this.Z&262144);b!==a&&(e&&t.i(a,"boolean",x,"isAnimated"),this.Z^=262144,this.j("isAnimated",b,a))});t.g(x,"selectionObjectName",x.prototype.du);t.defineProperty(x,{du:"selectionObjectName"},function(){return this.ys},function(a){var b=this.ys;b!==a&&(e&&t.i(a,"string",x,"selectionObjectName"),this.ys=a,this.Fm=null,this.j("selectionObjectName",b,a))});t.g(x,"selectionAdornmentTemplate",x.prototype.AG);
t.defineProperty(x,{AG:"selectionAdornmentTemplate"},function(){return this.ws},function(a){var b=this.ws;b!==a&&(e&&t.l(a,ea,x,"selectionAdornmentTemplate"),this instanceof B&&(a.type=Lg),this.ws=a,this.j("selectionAdornmentTemplate",b,a))});t.A(x,{An:"selectionObject"},function(){if(null===this.Fm){var a=this.du;null!==a&&""!==a?(a=this.ue(a),this.Fm=null!==a?a:this):this instanceof B?(a=this.path,this.Fm=null!==a?a:this):this.Fm=this}return this.Fm});t.g(x,"selectionChanged",x.prototype.BG);
t.defineProperty(x,{BG:"selectionChanged"},function(){return this.xs},function(a){var b=this.xs;b!==a&&(null!==a&&t.i(a,"function",x,"selectionChanged"),this.xs=a,this.j("selectionChanged",b,a))});t.g(x,"resizeAdornmentTemplate",x.prototype.nG);t.defineProperty(x,{nG:"resizeAdornmentTemplate"},function(){return this.js},function(a){var b=this.js;b!==a&&(e&&t.l(a,ea,x,"resizeAdornmentTemplate"),this.js=a,this.j("resizeAdornmentTemplate",b,a))});t.g(x,"resizeObjectName",x.prototype.qG);
t.defineProperty(x,{qG:"resizeObjectName"},function(){return this.ls},function(a){var b=this.ls;b!==a&&(e&&t.i(a,"string",x,"resizeObjectName"),this.ls=a,this.Lo=null,this.j("resizeObjectName",b,a))});t.A(x,{pG:"resizeObject"},function(){if(null===this.Lo){var a=this.qG;null!==a&&""!==a?(a=this.ue(a),this.Lo=null!==a?a:this):this.Lo=this}return this.Lo});t.g(x,"resizeCellSize",x.prototype.oG);
t.defineProperty(x,{oG:"resizeCellSize"},function(){return this.ks},function(a){var b=this.ks;b.O(a)||(e&&t.l(a,ra,x,"resizeCellSize"),this.ks=a=a.ba(),this.j("resizeCellSize",b,a))});t.g(x,"rotateAdornmentTemplate",x.prototype.sG);t.defineProperty(x,{sG:"rotateAdornmentTemplate"},function(){return this.ms},function(a){var b=this.ms;b!==a&&(e&&t.l(a,ea,x,"rotateAdornmentTemplate"),this.ms=a,this.j("rotateAdornmentTemplate",b,a))});t.g(x,"rotateObjectName",x.prototype.uG);
t.defineProperty(x,{uG:"rotateObjectName"},function(){return this.ns},function(a){var b=this.ns;b!==a&&(e&&t.i(a,"string",x,"rotateObjectName"),this.ns=a,this.Mo=null,this.j("rotateObjectName",b,a))});t.A(x,{tG:"rotateObject"},function(){if(null===this.Mo){var a=this.uG;null!==a&&""!==a?(a=this.ue(a),this.Mo=null!==a?a:this):this.Mo=this}return this.Mo});t.g(x,"text",x.prototype.text);
t.defineProperty(x,{text:"text"},function(){return this.re},function(a){var b=this.re;b!==a&&(e&&t.i(a,"string",x,"text"),this.re=a,this.j("text",b,a))});t.g(x,"containingGroup",x.prototype.fb);
t.defineProperty(x,{fb:"containingGroup"},function(){return this.Mk},function(a){if(this.Rd()){var b=this.Mk;if(b!==a){e&&null!==a&&t.l(a,z,x,"containingGroup");null===a||this!==a&&!a.Al(this)||(this===a&&t.m("Cannot make a Group a member of itself: "+this.toString()),t.m("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+a.toString()));this.M(jj);var c=this.h;null!==b?Cm(b,this):this instanceof z&&null!==c&&c.gl.remove(this);this.Mk=a;null!==a?Dm(a,this):this instanceof
z&&null!==c&&c.gl.add(this);this.M(dj);if(null!==c){var d=this.data,f=c.ea;null!==d&&f instanceof T&&f.Ix(d,f.Lb(null!==a?a.data:null))}d=this.iA;null!==d&&(f=!0,null!==c&&(f=c.Sa,c.Sa=!0),d(this,b,a),null!==c&&(c.Sa=f));if(this instanceof z)for(c=new I(x),af(c,this,!0,0),c=c.k;c.next();)if(d=c.value,d instanceof y)for(d=d.Td;d.next();)f=d.value,Kj(f);if(this instanceof y)for(d=this.Td;d.next();)f=d.value,Kj(f);this.j("containingGroup",b,a);null!==a&&a.Kx()}}else t.m("cannot set the Part.containingGroup of a Link or Adornment")});
function tk(a){a=a.fb;null!==a&&(a.ja(),null!==a.Nb&&a.Nb.ja(),a.Cf())}x.prototype.zt=function(a){var b=this.Mk;null===b||a||Dm(b,this)};x.prototype.At=function(a){var b=this.Mk;null===b||a||Cm(b,this)};x.prototype.cn=function(){var a=this.data;if(null!==a){var b=this.h;null!==b&&(b=b.ea,null!==b&&b.Bx(a))}};t.g(x,"containingGroupChanged",x.prototype.iA);
t.defineProperty(x,{iA:"containingGroupChanged"},function(){return this.Lq},function(a){var b=this.Lq;b!==a&&(null!==a&&t.i(a,"function",x,"containingGroupChanged"),this.Lq=a,this.j("containingGroupChanged",b,a))});x.prototype.findTopLevelPart=function(){return Em(this,this)};function Em(a,b){var c=b.fb;return null!==c?Em(a,c):b instanceof y&&(c=b.Dd,null!==c)?Em(a,c):b}t.A(x,{Fp:"isTopLevel"},function(){return null!==this.fb||this instanceof y&&this.ni?!1:!0});
x.prototype.isMemberOf=x.prototype.Al=function(a){return a instanceof z?Fm(this,this,a):!1};function Fm(a,b,c){if(b===c||null===c)return!1;var d=b.fb;return null===d||d!==c&&!Fm(a,d,c)?b instanceof y&&(b=b.Dd,null!==b)?Fm(a,b,c):!1:!0}x.prototype.findCommonContainingGroup=x.prototype.cJ=function(a){return Gm(this,this,a)};
function Gm(a,b,c){if(null===b||null===c)return null;var d=b.fb;if(null===d)return null;if(b===c)return d;var f=c.fb;return null===f?null:d===f?f:Fm(a,c,d)?d:Fm(a,b,f)?f:Gm(a,d,f)}t.g(x,"layoutConditions",x.prototype.MF);t.defineProperty(x,{MF:"layoutConditions"},function(){return this.yr},function(a){var b=this.yr;b!==a&&(e&&t.i(a,"number",x,"layoutConditions"),this.yr=a,this.j("layoutConditions",b,a))});
x.prototype.canLayout=function(){if(!this.jx||!this.Wa())return!1;var a=this.layer;return null!==a&&a.Dc||this instanceof y&&this.ni?!1:!0};x.prototype.invalidateLayout=x.prototype.M=function(a){void 0===a&&(a=16777215);var b;this.jx&&0!==(a&this.MF)?(b=this.layer,null!==b&&b.Dc||this instanceof y&&this.ni?b=!1:(b=this.h,b=null!==b&&b.ma.yb?!1:!0)):b=!1;if(b)if(b=this.Mk,null!==b){var c=b.ic;null!==c?c.M():b.M(a)}else a=this.h,null!==a&&(c=a.ic,null!==c&&c.M())};
function hj(a){if(!a.Wa())return!1;a=a.layer;return null!==a&&a.Dc?!1:!0}t.g(x,"dragComputation",x.prototype.pA);t.defineProperty(x,{pA:"dragComputation"},function(){return this.Vq},function(a){var b=this.Vq;b!==a&&(null!==a&&t.i(a,"function",x,"dragComputation"),this.Vq=a,this.j("dragComputation",b,a))});t.g(x,"shadowOffset",x.prototype.HG);
t.defineProperty(x,{HG:"shadowOffset"},function(){return this.Im},function(a){var b=this.Im;b.O(a)||(e&&t.l(a,E,x,"shadowOffset"),this.Im=a=a.ba(),this.na(),this.j("shadowOffset",b,a))});t.g(x,"shadowColor",x.prototype.shadowColor);t.defineProperty(x,{shadowColor:"shadowColor"},function(){return this.Hm},function(a){var b=this.Hm;b!==a&&(e&&t.i(a,"string",x,"shadowColor"),this.Hm=a,this.na(),this.j("shadowColor",b,a))});t.g(x,"shadowBlur",x.prototype.shadowBlur);
t.defineProperty(x,{shadowBlur:"shadowBlur"},function(){return this.Gm},function(a){var b=this.Gm;b!==a&&(e&&t.i(a,"number",x,"shadowBlur"),this.Gm=a,this.na(),this.j("shadowBlur",b,a))});function ea(a){0===arguments.length?x.call(this,gh):x.call(this,a);this.Ne="Adornment";this.ob=null;this.Z&=-257;this.hh=new E(NaN,NaN);this.zi=new H(F);this.Nb=null}t.ka("Adornment",ea);t.Qa(ea,x);aa=ea.prototype;aa.toString=function(){var a=this.hi;return"Adornment("+this.cd+")"+(null!==a?a.toString():"")};
aa.Ij=function(){return this.ob&&this.ob.U instanceof B?this.ob.U.Ij():null};aa.er=function(){return null};aa.sx=function(){var a=this.uc.U,b=this.uc;if(a instanceof B&&b instanceof W){var c=a.path,b=c.Ta;a.sx();for(var b=c.Ta,a=this.va,c=a.length,d=0;d<c;d++){var f=a.n[d];f.oi&&f instanceof W&&(f.Ta=b)}}};aa.ez=function(){var a=this.hi;return a instanceof B?a.Bc:null};t.A(ea,{placeholder:"placeholder"},function(){return this.Nb});t.g(ea,"adornedObject",ea.prototype.uc);
t.defineProperty(ea,{uc:"adornedObject"},function(){return this.ob},function(a){e&&null!==a&&t.l(a,V,x,"adornedObject:val");var b=this.hi,c=null;null!==a&&(c=a.U);null===b||null!==a&&b===c||b.Hl(this.cd);this.ob=a;c&&c.il(this.cd,this)});t.A(ea,{hi:"adornedPart"},function(){var a=this.ob;return null!==a?a.U:null});ea.prototype.Bl=function(){var a=this.ob;if(null===a)return!0;a=a.U;return null===a||!Vi(a)};ea.prototype.Rd=function(){return!1};t.A(ea,{fb:"containingGroup"},function(){return null});
ea.prototype.yn=function(a,b,c,d,f,g,h){if(a===Md&&"elements"===b)if(f instanceof ah)null===this.Nb?this.Nb=f:this.Nb!==f&&t.m("Cannot insert a second Placeholder into the visual tree of an Adornment.");else{if(f instanceof C){var k=f.qt(function(a){return a instanceof ah});k instanceof ah&&(null===this.Nb?this.Nb=k:this.Nb!==k&&t.m("Cannot insert a second Placeholder into the visual tree of an Adornment."))}}else a===Nd&&"elements"===b&&null!==this.Nb&&(d===this.Nb?this.Nb=null:d instanceof C&&this.Nb.rj(d)&&
(this.Nb=null));x.prototype.yn.call(this,a,b,c,d,f,g,h)};ea.prototype.updateAdornments=function(){};ea.prototype.cn=function(){};function y(a){0===arguments.length?x.call(this,gh):x.call(this,a);this.sc=new H(B);this.Ao=this.Yk=this.Br=this.Ar=null;this.rr=!0;this.Vs=!1;this.Qs=null;this.Eq=this.sr=!0;this.Fq=K.vH;this.Ad=this.Dh=null;this.ds=Hm;this.fi=!1}t.ka("Node",y);t.Qa(y,x);
y.prototype.cloneProtected=function(a){x.prototype.cloneProtected.call(this,a);a.Ar=this.Ar;a.Br=this.Br;a.Yk=this.Yk;a.rr=this.rr;a.Vs=this.Vs;a.Qs=this.Qs;a.sr=this.sr;a.Eq=this.Eq;a.Fq=this.Fq.ba();a.ds=this.ds};y.prototype.ji=function(a){x.prototype.ji.call(this,a);a.Cf();a.Dh=this.Dh;a.Ad=null};var Im;y.DirectionDefault=Im=t.w(y,"DirectionDefault",0);y.DirectionAbsolute=t.w(y,"DirectionAbsolute",1);var Jm;y.DirectionRotatedNode=Jm=t.w(y,"DirectionRotatedNode",2);var hk;
y.DirectionRotatedNodeOrthogonal=hk=t.w(y,"DirectionRotatedNodeOrthogonal",3);y.SpreadingNone=t.w(y,"SpreadingNone",10);var Hm;y.SpreadingEvenly=Hm=t.w(y,"SpreadingEvenly",11);var Km;y.SpreadingPacked=Km=t.w(y,"SpreadingPacked",12);function Lm(a,b){null!==b&&(null===a.Dh&&(a.Dh=new I(Mm)),a.Dh.add(b))}
y.prototype.yn=function(a,b,c,d,f,g,h){a===Md&&"elements"===b?this.Ad=null:a===Nd&&"elements"===b&&(null===this.h?this.Ad=null:d instanceof V&&Sl(this,d,function(a,b){Ok(a,b,!0)}));x.prototype.yn.call(this,a,b,c,d,f,g,h)};y.prototype.invalidateConnectedLinks=y.prototype.Cf=function(a){void 0===a&&(a=null);for(var b=this.Td;b.next();){var c=b.value;null!==a&&a.contains(c)||(Nm(this,c.sd),Nm(this,c.Vd),c.hc())}};function Nm(a,b){if(null!==b){b.cs=null;var c=a.fb;null===c||c.xe||Nm(c,c.tl(""))}}
y.prototype.Bl=function(){return!0};t.defineProperty(y,{$J:"portSpreading"},function(){return this.ds},function(a){var b=this.ds;b!==a&&(e&&t.Fa(a,y,y,"portSpreading"),this.ds=a,this.j("portSpreading",b,a),a=this.h,null!==a&&a.ma.yb||this.Cf())});t.g(y,"avoidable",y.prototype.dA);t.defineProperty(y,{dA:"avoidable"},function(){return this.Eq},function(a){var b=this.Eq;if(b!==a){e&&t.i(a,"boolean",y,"avoidable");this.Eq=a;var c=this.h;null!==c&&Vj(c,this);this.j("avoidable",b,a)}});
t.g(y,"avoidableMargin",y.prototype.oE);t.defineProperty(y,{oE:"avoidableMargin"},function(){return this.Fq},function(a){"number"===typeof a?a=new wb(a):t.l(a,wb,y,"avoidableMargin");var b=this.Fq;if(!b.O(a)){this.Fq=a=a.ba();var c=this.h;null!==c&&Vj(c,this);this.j("avoidableMargin",b,a)}});y.prototype.canAvoid=function(){return this.dA&&!this.ni};y.prototype.getAvoidableRect=function(a){a.set(this.pa);a.ow(this.oE);return a};
y.prototype.findVisibleNode=function(){for(var a=this;null!==a&&!a.Wa();)a=a.fb;return a};y.prototype.sh=function(a){x.prototype.sh.call(this,a);for(var b=this.Td;b.next();)b.value.sh(a)};t.A(y,{Td:"linksConnected"},function(){return this.sc.k});y.prototype.findLinksConnected=y.prototype.$E=function(a){void 0===a&&(a=null);if(null===a)return this.sc.k;e&&t.i(a,"string",y,"findLinksConnected:pid");var b=new Oa(this.sc),c=this;b.Fl=function(b){return b.ca===c&&b.Af===a||b.fa===c&&b.dg===a};return b};
y.prototype.findLinksOutOf=y.prototype.Qw=function(a){void 0===a&&(a=null);e&&null!==a&&t.i(a,"string",y,"findLinksOutOf:pid");var b=new Oa(this.sc),c=this;b.Fl=function(b){return b.ca!==c?!1:null===a?!0:b.Af===a};return b};y.prototype.findLinksInto=y.prototype.Cg=function(a){void 0===a&&(a=null);e&&null!==a&&t.i(a,"string",y,"findLinksInto:pid");var b=new Oa(this.sc),c=this;b.Fl=function(b){return b.fa!==c?!1:null===a?!0:b.dg===a};return b};
y.prototype.findNodesConnected=y.prototype.aF=function(a){void 0===a&&(a=null);e&&null!==a&&t.i(a,"string",y,"findNodesConnected:pid");for(var b=null,c=null,d=this.sc.k;d.next();){var f=d.value;if(f.ca===this){if(null===a||f.Af===a)f=f.fa,null!==b?b.add(f):null!==c&&c!==f?(b=new I(y),b.add(c),b.add(f)):c=f}else f.fa!==this||null!==a&&f.dg!==a||(f=f.ca,null!==b?b.add(f):null!==c&&c!==f?(b=new I(y),b.add(c),b.add(f)):c=f)}return null!==b?b.k:null!==c?new Ma(c):t.fg};
y.prototype.findNodesOutOf=function(a){void 0===a&&(a=null);e&&null!==a&&t.i(a,"string",y,"findNodesOutOf:pid");for(var b=null,c=null,d=this.sc.k;d.next();){var f=d.value;f.ca!==this||null!==a&&f.Af!==a||(f=f.fa,null!==b?b.add(f):null!==c&&c!==f?(b=new I(y),b.add(c),b.add(f)):c=f)}return null!==b?b.k:null!==c?new Ma(c):t.fg};
y.prototype.findNodesInto=function(a){void 0===a&&(a=null);e&&null!==a&&t.i(a,"string",y,"findNodesInto:pid");for(var b=null,c=null,d=this.sc.k;d.next();){var f=d.value;f.fa!==this||null!==a&&f.dg!==a||(f=f.ca,null!==b?b.add(f):null!==c&&c!==f?(b=new I(y),b.add(c),b.add(f)):c=f)}return null!==b?b.k:null!==c?new Ma(c):t.fg};
y.prototype.findLinksBetween=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);e&&(t.l(a,y,y,"findLinksBetween:othernode"),null!==b&&t.i(b,"string",y,"findLinksBetween:pid"),null!==c&&t.i(c,"string",y,"findLinksBetween:otherpid"));var d=new Oa(this.sc),f=this;d.Fl=function(d){return(d.ca!==f||d.fa!==a||null!==b&&d.Af!==b||null!==c&&d.dg!==c)&&(d.ca!==a||d.fa!==f||null!==c&&d.Af!==c||null!==b&&d.dg!==b)?!1:!0};return d};
y.prototype.findLinksTo=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);e&&(t.l(a,y,y,"findLinksTo:othernode"),null!==b&&t.i(b,"string",y,"findLinksTo:pid"),null!==c&&t.i(c,"string",y,"findLinksTo:otherpid"));var d=new Oa(this.sc),f=this;d.Fl=function(d){return d.ca!==f||d.fa!==a||null!==b&&d.Af!==b||null!==c&&d.dg===c?!1:!0};return d};t.g(y,"linkConnected",y.prototype.OF);
t.defineProperty(y,{OF:"linkConnected"},function(){return this.Ar},function(a){var b=this.Ar;b!==a&&(null!==a&&t.i(a,"function",y,"linkConnected"),this.Ar=a,this.j("linkConnected",b,a))});t.g(y,"linkDisconnected",y.prototype.PF);t.defineProperty(y,{PF:"linkDisconnected"},function(){return this.Br},function(a){var b=this.Br;b!==a&&(null!==a&&t.i(a,"function",y,"linkDisconnected"),this.Br=a,this.j("linkDisconnected",b,a))});t.g(y,"linkValidation",y.prototype.Np);
t.defineProperty(y,{Np:"linkValidation"},function(){return this.Yk},function(a){var b=this.Yk;b!==a&&(null!==a&&t.i(a,"function",y,"linkValidation"),this.Yk=a,this.j("linkValidation",b,a))});
function Om(a,b,c){Nm(a,c);if(!a.sc.contains(b)){a.sc.add(b);var d=a.OF;if(null!==d){var f=!0,g=a.h;null!==g&&(f=g.Sa,g.Sa=!0);d(a,b,c);null!==g&&(g.Sa=f)}b.Ic&&(c=b.ca,b=b.fa,null!==c&&null!==b&&c!==b&&(d=!0,g=a.h,null!==g&&(d=g.vd),a=d?b:c,f=d?c:b,a.fi||(a.fi=f),!f.ri||null!==g&&g.ma.yb||(d?c===f&&(f.ri=!1):b===f&&(f.ri=!1))))}}
function Pm(a,b,c){Nm(a,c);if(a.sc.remove(b)){var d=a.PF,f=a.h;if(null!==d){var g=!0;null!==f&&(g=f.Sa,f.Sa=!0);d(a,b,c);null!==f&&(f.Sa=g)}b.Ic&&(c=!0,null!==f&&(c=f.vd),a=c?b.fa:b.ca,b=c?b.ca:b.fa,null!==a&&(a.fi=!1),null===b||b.ri||(0===b.sc.count?(b.fi=null,null!==f&&f.ma.yb||(b.ri=!0)):Pj(b)))}}
function Pj(a){a.fi=!1;if(0!==a.sc.count){var b=!0,c=a.h;if(null===c||!c.ma.yb){null!==c&&(b=c.vd);for(c=a.sc.k;c.next();){var d=c.value;if(d.Ic)if(b){if(d.ca===a){a.ri=!1;return}}else if(d.fa===a){a.ri=!1;return}}a.ri=!0}}}
y.prototype.updateModelDataReferences=function(){x.prototype.updateModelDataReferences.call(this);var a=this.data;if(null!==a){var b=this.h;if(null!==b){var c=b.ea;if(c instanceof ce){var d=c.jn(a),b=b.af(d),f=this.uA();b!==f&&(b=null!==f?c.Lb(f.data):void 0,f=c.xn,"function"===typeof f?f(a,b):a[f]=b,c.xh(a,d))}}}};y.prototype.zt=function(a){x.prototype.zt.call(this,a);a||Pj(this);var b=this.Ao;null===b||a||Qm(b,this)};
y.prototype.At=function(a){x.prototype.At.call(this,a);var b=this.Ao;null===b||a||null===b.Ce||(b.Ce.remove(this),b.ja())};y.prototype.cn=function(){if(0<this.sc.count){var a=this.h;if(null===a)return;for(var b=this.sc.copy().k;b.next();)a.remove(b.value)}this.Dd=null;x.prototype.cn.call(this)};t.A(y,{ni:"isLinkLabel"},function(){return null!==this.Ao});t.g(y,"labeledLink",y.prototype.Dd);
t.defineProperty(y,{Dd:"labeledLink"},function(){return this.Ao},function(a){var b=this.Ao;if(b!==a){e&&null!==a&&t.l(a,B,y,"labeledLink");var c=this.h,d=this.data;if(null!==b&&(null!==b.Ce&&(b.Ce.remove(this),b.ja()),null!==c&&null!==d&&!c.ma.yb)){var f=b.data,g=c.ea;if(null!==f&&g instanceof T){var h=g.Lb(d);void 0!==h&&g.eK(f,h)}}this.Ao=a;null!==a&&(Qm(a,this),null===c||null===d||c.ma.yb||(f=a.data,g=c.ea,null!==f&&g instanceof T&&(h=g.Lb(d),void 0!==h&&g.fE(f,h))));Gk(this);this.j("labeledLink",
b,a)}});y.prototype.findPort=y.prototype.tl=function(a){e&&t.i(a,"string",y,"findPort:pid");if(null===this.Ad){if(""===a&&!1===this.Qh)return this;Pk(this)}var b=this.Ad.Da(a);return null!==b||""!==a&&(b=this.Ad.Da(""),null!==b)?b:this};t.A(y,{port:"port"},function(){return this.tl("")});t.A(y,{ports:"ports"},function(){null===this.Ad&&Pk(this);return this.Ad.JF});
function Pk(a){null===a.Ad?a.Ad=new wa("string",V):a.Ad.clear();Sl(a,a,function(a,c){var d=c.Ud;null!==d&&a.Ad.add(d,c)});0===a.Ad.count&&a.Ad.add("",a)}function Ok(a,b,c){var d=b.Ud;if(null!==d&&(null!==a.Ad&&a.Ad.remove(d),b=a.h,null!==b&&c)){c=null;for(a=a.$E(d);a.next();)null===c&&(c=t.Hb()),c.push(a.value);if(null!==c){for(a=0;a<c.length;a++)b.remove(c[a]);t.Ca(c)}}}
y.prototype.isInTreeOf=function(a){if(null===a||a===this)return!1;var b=!0,c=this.h;null!==c&&(b=c.vd);c=this;if(b)for(;c!==a;){for(var b=null,d=c.sc.k;d.next();){var f=d.value;if(f.Ic&&(b=f.ca,b!==c&&b!==this))break}if(b===this||null===b||b===c)return!1;c=b}else for(;c!==a;){b=null;for(d=c.sc.k;d.next()&&(f=d.value,!f.Ic||(b=f.fa,b===c||b===this)););if(b===this||null===b||b===c)return!1;c=b}return!0};
y.prototype.findTreeRoot=function(){var a=!0,b=this.h;null!==b&&(a=b.vd);b=this;if(a)for(;;){for(var a=null,c=b.sc.k;c.next();){var d=c.value;if(d.Ic&&(a=d.ca,a!==b&&a!==this))break}if(a===this)return this;if(null===a||a===b)return b;b=a}else for(;;){a=null;for(c=b.sc.k;c.next()&&(d=c.value,!d.Ic||(a=d.fa,a===b||a===this)););if(a===this)return this;if(null===a||a===b)return b;b=a}};
y.prototype.findTreeParentLink=y.prototype.tt=function(){var a=!0,b=this.h;null!==b&&(a=b.vd);b=this.sc.k;if(a)for(;b.next();){if(a=b.value,a.Ic&&a.ca!==this)return a}else for(;b.next();)if(a=b.value,a.Ic&&a.fa!==this)return a;return null};
y.prototype.findTreeParentNode=y.prototype.uA=function(){if(null===this.fi||this.fi instanceof y)return this.fi;var a=!0,b=this.h;null!==b&&(a=b.vd);var b=this.sc.n,c=b.length;if(a)for(a=0;a<c;a++){var d=b[a];if(d.Ic&&(d=d.ca,d!==this))return this.fi=d}else for(a=0;a<c;a++)if(d=b[a],d.Ic&&(d=d.fa,d!==this))return this.fi=d;return this.fi=null};
y.prototype.findTreeChildrenLinks=y.prototype.Tw=function(){var a=!0,b=this.h;null!==b&&(a=b.vd);if(a){var a=new Oa(this.sc),c=this;a.Fl=function(a){return a.Ic&&a.ca===c?!0:!1}}else a=new Oa(this.sc),c=this,a.Fl=function(a){return a.Ic&&a.fa===c?!0:!1};return a};
y.prototype.findTreeChildrenNodes=y.prototype.cF=function(){var a=!0,b=this.h;null!==b&&(a=b.vd);var c=b=null,d=this.sc.k;if(a)for(;d.next();)a=d.value,a.Ic&&a.ca===this&&(a=a.fa,null!==b?b.add(a):null!==c&&c!==a?(b=new H(y),b.add(c),b.add(a)):c=a);else for(;d.next();)a=d.value,a.Ic&&a.fa===this&&(a=a.ca,null!==b?b.add(a):null!==c&&c!==a?(b=new H(y),b.add(c),b.add(a)):c=a);return null!==b?b.k:null!==c?new Ma(c):t.fg};
y.prototype.findTreeParts=function(a){void 0===a&&(a=Infinity);t.i(a,"number",y,"collapseTree:level");var b=new I(x);af(b,this,!1,a);return b};y.prototype.collapseTree=y.prototype.collapseTree=function(a){void 0===a&&(a=1);t.q(a,y,"collapseTree:level");1>a&&(a=1);var b=this.h;if(null!==b&&!b.ee){var c=b.mc;0!==b.ma.Qe&&c.Gl();b.ee=!0;var c=b.vd,d=new I(y);d.add(this);Rm(this,d,c,a,this.Uc);b.ee=!1;b.na()}};
function Rm(a,b,c,d,f){if(1<d)for(f=c?a.Qw():a.Cg();f.next();){var g=f.value;g.Ic&&(g=g.AA(a),null===g||g===a||b.contains(g)||(b.add(g),Rm(g,b,c,d-1,g.Uc)))}else Sm(a,b,c,f)}function Sm(a,b,c,d){a.Uc=!1;for(var f=c?a.Qw():a.Cg();f.next();){var g=f.value;d&&g.Uf();g.Ic&&(g=g.AA(a),null===g||g===a||b.contains(g)||(b.add(g),d&&(g.na(),tk(g),g.sh(!1)),g.Uc&&(g.Hn=g.Uc,Sm(g,b,c,g.Hn))))}}
y.prototype.expandTree=y.prototype.expandTree=function(a){void 0===a&&(a=2);t.q(a,y,"collapseTree:level");2>a&&(a=2);var b=this.h;if(null!==b&&!b.ee){var c=b.mc;0!==b.ma.Qe&&c.Gl();b.ee=!0;var d=b.vd,f=new I(y);f.add(this);Tm(this,f,d,a,this.Uc,c,this);b.ee=!1}};
function Tm(a,b,c,d,f,g,h){a.Uc=!0;for(var k=c?a.Qw():a.Cg();k.next();){var l=k.value;l.Ic&&(f||(l.xg||l.hc(),l.updateAdornments()),l=l.AA(a),null!==l&&l!==a&&!b.contains(l)&&(b.add(l),f||(l.sh(!0),tk(l),Vh(g,l,h)),2<d||l.Hn))&&(l.Hn=!1,Tm(l,b,c,d-1,l.Uc,g,h))}}t.g(y,"isTreeExpanded",y.prototype.Uc);
t.defineProperty(y,{Uc:"isTreeExpanded"},function(){return this.rr},function(a){var b=this.rr;if(b!==a){e&&t.i(a,"boolean",y,"isTreeExpanded");this.rr=a;var c=this.h;this.j("isTreeExpanded",b,a);b=this.aH;if(null!==b){var d=!0;null!==c&&(d=c.Sa,c.Sa=!0);b(this);null!==c&&(c.Sa=d)}null!==c&&c.ma.yb||(a?(a=2,2>a&&(a=2),null===c||c.ee||(0!==c.ma.Qe&&c.mc.Gl(),c.ee=!0,b=c.vd,d=new I(y),d.add(this),Tm(this,d,b,a,!1,c.mc,this),c.ee=!1)):(a=1,1>a&&(a=1),null===c||c.ee||(0!==c.ma.Qe&&c.mc.Gl(),c.ee=!0,b=
c.vd,d=new I(y),d.add(this),Rm(this,d,b,a,!0),c.ee=!1)))}});t.g(y,"wasTreeExpanded",y.prototype.Hn);t.defineProperty(y,{Hn:"wasTreeExpanded"},function(){return this.Vs},function(a){var b=this.Vs;b!==a&&(e&&t.i(a,"boolean",y,"wasTreeExpanded"),this.Vs=a,this.j("wasTreeExpanded",b,a))});t.g(y,"treeExpandedChanged",y.prototype.aH);
t.defineProperty(y,{aH:"treeExpandedChanged"},function(){return this.Qs},function(a){var b=this.Qs;b!==a&&(null!==a&&t.i(a,"function",y,"treeExpandedChanged"),this.Qs=a,this.j("treeExpandedChanged",b,a))});t.g(y,"isTreeLeaf",y.prototype.ri);t.defineProperty(y,{ri:"isTreeLeaf"},function(){return this.sr},function(a){var b=this.sr;b!==a&&(e&&t.i(a,"boolean",y,"isTreeLeaf"),this.sr=a,this.j("isTreeLeaf",b,a))});
function B(){x.call(this,Lg);this.kg=null;this.Nh="";this.wg=this.cr=null;this.ci="";this.Ps=null;this.is=this.hs=this.gs=!1;this.tr=!0;this.zq=Og;this.Mq=0;this.Pq=Og;this.Qq=NaN;this.Bm=al;this.Ds=0.5;this.Vi=this.Ce=null;this.Bc=(new H(E)).freeze();this.No=this.De=null;this.xg=!1;this.Bz=null;this.Iz=!1;this.On=this.Hi=this.Ta=null;this.nf=0;this.$n=this.Wn=null;this.zi=new H(F);this.Mz=new E;this.OD=this.MD=null;this.Ey=!1;this.R=null}t.ka("Link",B);t.Qa(B,x);
B.prototype.cloneProtected=function(a){x.prototype.cloneProtected.call(this,a);a.Nh=this.Nh;a.cr=this.cr;a.ci=this.ci;a.Ps=this.Ps;a.gs=this.gs;a.hs=this.hs;a.is=this.is;a.tr=this.tr;a.zq=this.zq;a.Mq=this.Mq;a.Pq=this.Pq;a.Qq=this.Qq;a.Bm=this.Bm;a.Ds=this.Ds;if(null!==this.R){var b=this.R;a.R={Ph:b.Ph.ba(),ei:b.ei.ba(),Mh:b.Mh,bi:b.bi,Lh:b.Lh,ai:b.ai,Oh:b.Oh,di:b.di}}else a.R=null};
B.prototype.ji=function(a){x.prototype.ji.call(this,a);this.Nh=a.Nh;this.ci=a.ci;a.Vi=null;a.De=null;a.hc();a.On=this.On;a.nf=this.nf};var al;B.Normal=al=t.w(B,"Normal",1);B.Orthogonal=t.w(B,"Orthogonal",2);B.AvoidsNodes=t.w(B,"AvoidsNodes",6);var Um;B.AvoidsNodesStraight=Um=t.w(B,"AvoidsNodesStraight",7);var Og;B.None=Og=t.w(B,"None",0);var Wg;B.Bezier=Wg=t.w(B,"Bezier",9);var Ng;B.JumpGap=Ng=t.w(B,"JumpGap",10);var Mg;B.JumpOver=Mg=t.w(B,"JumpOver",11);var Yk;B.End=Yk=t.w(B,"End",17);var Zk;
B.Scale=Zk=t.w(B,"Scale",18);var $k;B.Stretch=$k=t.w(B,"Stretch",19);var gm;B.OrientAlong=gm=t.w(B,"OrientAlong",21);var Vm;B.OrientPlus90=Vm=t.w(B,"OrientPlus90",22);var Wm;B.OrientMinus90=Wm=t.w(B,"OrientMinus90",23);var Xm;B.OrientOpposite=Xm=t.w(B,"OrientOpposite",24);var Ym;B.OrientUpright=Ym=t.w(B,"OrientUpright",25);var Zm;B.OrientPlus90Upright=Zm=t.w(B,"OrientPlus90Upright",26);var $m;B.OrientMinus90Upright=$m=t.w(B,"OrientMinus90Upright",27);var an;
B.OrientUpright45=an=t.w(B,"OrientUpright45",28);B.prototype.Le=function(){this.R={Ph:Ub,ei:Ub,Mh:NaN,bi:NaN,Lh:Im,ai:Im,Oh:NaN,di:NaN}};B.prototype.Bl=function(){var a=this.ca;if(null!==a){var b=a.findVisibleNode();null!==b&&(a=b);if(Vi(a)||Wi(a))return!1}a=this.fa;return null!==a&&(b=a.findVisibleNode(),null!==b&&(a=b),Vi(a)||Wi(a))?!1:!0};B.prototype.Rd=function(){return!1};
B.prototype.computeAngle=function(a,b,c){switch(b){default:case Og:a=0;break;case gm:a=c;break;case Vm:a=c+90;break;case Wm:a=c-90;break;case Xm:a=c+180;break;case Ym:a=K.Tt(c);90<a&&270>a&&(a-=180);break;case Zm:a=K.Tt(c+90);90<a&&270>a&&(a-=180);break;case $m:a=K.Tt(c-90);90<a&&270>a&&(a-=180);break;case an:a=K.Tt(c);if(45<a&&135>a||225<a&&315>a)return 0;90<a&&270>a&&(a-=180)}return K.Tt(a)};t.g(B,"fromNode",B.prototype.ca);
t.defineProperty(B,{ca:"fromNode"},function(){return this.kg},function(a){var b=this.kg;if(b!==a){e&&null!==a&&t.l(a,y,B,"fromNode");var c=this.sd;null!==b&&(this.wg!==b&&Pm(b,this,c),bn(this),this.M(jj));this.kg=a;this.Hi=null;this.hc();var d=this.h;if(null!==d){var f=this.data,g=d.ea;if(null!==f)if(g instanceof T){var h=null!==a?a.data:null;g.Hx(f,g.Lb(h))}else g instanceof ce&&(h=null!==a?a.data:null,d.vd?g.xh(f,g.Lb(h)):(null!==b&&g.xh(b.data,void 0),g.xh(h,g.Lb(null!==this.wg?this.wg.data:null))))}f=
this.sd;g=this.zA;null!==g&&(h=!0,null!==d&&(h=d.Sa,d.Sa=!0),g(this,c,f),null!==d&&(d.Sa=h));null!==a&&(this.wg!==a&&Om(a,this,f),cn(this),this.M(dj));this.j("fromNode",b,a);Kj(this)}});t.g(B,"fromPortId",B.prototype.Af);
t.defineProperty(B,{Af:"fromPortId"},function(){return this.Nh},function(a){var b=this.Nh;if(b!==a){e&&t.i(a,"string",B,"fromPortId");var c=this.sd;null!==c&&Nm(this.ca,c);bn(this);this.Nh=a;var d=this.sd;null!==d&&Nm(this.ca,d);var f=this.h;if(null!==f){var g=this.data,h=f.ea;null!==g&&h instanceof T&&h.vB(g,a)}c!==d&&(this.Hi=null,this.hc(),g=this.zA,null!==g&&(h=!0,null!==f&&(h=f.Sa,f.Sa=!0),g(this,c,d),null!==f&&(f.Sa=h)));cn(this);this.j("fromPortId",b,a)}});
t.A(B,{sd:"fromPort"},function(){var a=this.kg;return null===a?null:a.tl(this.Nh)});t.g(B,"fromPortChanged",B.prototype.zA);t.defineProperty(B,{zA:"fromPortChanged"},function(){return this.cr},function(a){var b=this.cr;b!==a&&(null!==a&&t.i(a,"function",B,"fromPortChanged"),this.cr=a,this.j("fromPortChanged",b,a))});t.g(B,"toNode",B.prototype.fa);
t.defineProperty(B,{fa:"toNode"},function(){return this.wg},function(a){var b=this.wg;if(b!==a){e&&null!==a&&t.l(a,y,B,"toNode");var c=this.Vd;null!==b&&(this.kg!==b&&Pm(b,this,c),bn(this),this.M(jj));this.wg=a;this.Hi=null;this.hc();var d=this.h;if(null!==d){var f=this.data,g=d.ea;if(null!==f)if(g instanceof T){var h=null!==a?a.data:null;g.Jx(f,g.Lb(h))}else g instanceof ce&&(h=null!==a?a.data:null,d.vd?(null!==b&&g.xh(b.data,void 0),g.xh(h,g.Lb(null!==this.kg?this.kg.data:null))):g.xh(f,g.Lb(h)))}f=
this.Vd;g=this.HB;null!==g&&(h=!0,null!==d&&(h=d.Sa,d.Sa=!0),g(this,c,f),null!==d&&(d.Sa=h));null!==a&&(this.kg!==a&&Om(a,this,f),cn(this),this.M(dj));this.j("toNode",b,a);Kj(this)}});t.g(B,"toPortId",B.prototype.dg);
t.defineProperty(B,{dg:"toPortId"},function(){return this.ci},function(a){var b=this.ci;if(b!==a){e&&t.i(a,"string",B,"toPortId");var c=this.Vd;null!==c&&Nm(this.fa,c);bn(this);this.ci=a;var d=this.Vd;null!==d&&Nm(this.fa,d);var f=this.h;if(null!==f){var g=this.data,h=f.ea;null!==g&&h instanceof T&&h.yB(g,a)}c!==d&&(this.Hi=null,this.hc(),g=this.HB,null!==g&&(h=!0,null!==f&&(h=f.Sa,f.Sa=!0),g(this,c,d),null!==f&&(f.Sa=h)));cn(this);this.j("toPortId",b,a)}});
t.A(B,{Vd:"toPort"},function(){var a=this.wg;return null===a?null:a.tl(this.ci)});t.g(B,"toPortChanged",B.prototype.HB);t.defineProperty(B,{HB:"toPortChanged"},function(){return this.Ps},function(a){var b=this.Ps;b!==a&&(null!==a&&t.i(a,"function",B,"toPortChanged"),this.Ps=a,this.j("toPortChanged",b,a))});
t.defineProperty(B,{vb:"fromSpot"},function(){return null!==this.R?this.R.Ph:Ub},function(a){null===this.R&&this.Le();var b=this.R.Ph;b.O(a)||(e&&t.l(a,L,B,"fromSpot"),a=a.ba(),this.R.Ph=a,this.j("fromSpot",b,a),this.hc())});
t.defineProperty(B,{rk:"fromEndSegmentLength"},function(){return null!==this.R?this.R.Mh:NaN},function(a){null===this.R&&this.Le();var b=this.R.Mh;b!==a&&(e&&t.i(a,"number",B,"fromEndSegmentLength"),0>a&&t.ha(a,">= 0",B,"fromEndSegmentLength"),this.R.Mh=a,this.j("fromEndSegmentLength",b,a),this.hc())});
t.defineProperty(B,{tp:"fromEndSegmentDirection"},function(){return null!==this.R?this.R.Lh:Im},function(a){null===this.R&&this.Le();var b=this.R.Lh;b!==a&&(e&&t.Fa(a,y,B,"fromEndSegmentDirection"),this.R.Lh=a,this.j("fromEndSegmentDirection",b,a),this.hc())});t.defineProperty(B,{up:"fromShortLength"},function(){return null!==this.R?this.R.Oh:NaN},function(a){null===this.R&&this.Le();var b=this.R.Oh;b!==a&&(e&&t.i(a,"number",B,"fromShortLength"),this.R.Oh=a,this.j("fromShortLength",b,a),this.hc())});
t.defineProperty(B,{zb:"toSpot"},function(){return null!==this.R?this.R.ei:Ub},function(a){null===this.R&&this.Le();var b=this.R.ei;b.O(a)||(e&&t.l(a,L,B,"toSpot"),a=a.ba(),this.R.ei=a,this.j("toSpot",b,a),this.hc())});
t.defineProperty(B,{xk:"toEndSegmentLength"},function(){return null!==this.R?this.R.bi:NaN},function(a){null===this.R&&this.Le();var b=this.R.bi;b!==a&&(e&&t.i(a,"number",B,"toEndSegmentLength"),0>a&&t.ha(a,">= 0",B,"toEndSegmentLength"),this.R.bi=a,this.j("toEndSegmentLength",b,a),this.hc())});
t.defineProperty(B,{kq:"toEndSegmentDirection"},function(){return null!==this.R?this.R.ai:Im},function(a){null===this.R&&this.Le();var b=this.R.ai;b!==a&&(e&&t.Fa(a,y,B,"toEndSegmentDirection"),this.R.ai=a,this.j("toEndSegmentDirection",b,a),this.hc())});t.defineProperty(B,{lq:"toShortLength"},function(){return null!==this.R?this.R.di:NaN},function(a){null===this.R&&this.Le();var b=this.R.di;b!==a&&(e&&t.i(a,"number",B,"toShortLength"),this.R.di=a,this.j("toShortLength",b,a),this.hc())});
function Kj(a){var b=a.ca,c=a.fa;null!==b&&null!==c?dn(a,b.cJ(c)):dn(a,null)}function dn(a,b){var c=a.Mk;if(c!==b){null!==c&&Cm(c,a);a.Mk=b;null!==b&&Dm(b,a);var d=a.iA;if(null!==d){var f=!0,g=a.h;null!==g&&(f=g.Sa,g.Sa=!0);d(a,c,b);null!==g&&(g.Sa=f)}!a.xg||a.MD!==c&&a.OD!==c||a.hc()}}B.prototype.getOtherNode=B.prototype.AA=function(a){e&&t.l(a,y,B,"getOtherNode:node");var b=this.ca;return a===b?this.fa:b};
B.prototype.getOtherPort=function(a){e&&t.l(a,V,B,"getOtherPort:port");var b=this.sd;return a===b?this.Vd:b};t.A(B,{JK:"isLabeledLink"},function(){return null===this.Ce?!1:0<this.Ce.count});t.A(B,{sj:"labelNodes"},function(){return null===this.Ce?t.fg:this.Ce.k});function Qm(a,b){null===a.Ce&&(a.Ce=new I(y));a.Ce.add(b);a.ja()}
B.prototype.zt=function(a){x.prototype.zt.call(this,a);en(this)&&Pg(this,this.pa);if(!a){a=this.kg;var b=this.wg;null!==a&&(Om(a,this,this.sd),cn(this));null!==b&&(Om(b,this,this.Vd),cn(this))}};B.prototype.At=function(a){x.prototype.At.call(this,a);en(this)&&Pg(this,this.pa);if(!a){a=this.kg;var b=this.wg;null!==a&&(Pm(a,this,this.sd),bn(this));null!==b&&(Pm(b,this,this.Vd),bn(this))}};
B.prototype.cn=function(){this.xg=!0;if(null!==this.Ce){var a=this.h;if(null===a)return;for(var b=this.Ce.copy().k;b.next();)a.remove(b.value)}b=this.data;null!==b&&(a=this.h,null!==a&&(a=a.ea,a instanceof T?a.lB(b):a instanceof ce&&a.xh(b,void 0)))};
B.prototype.updateModelDataReferences=function(){var a=this.data;if(null!==a){var b=this.h;if(null!==b){var c=b.ea;if(c instanceof T){var d=c.vl(a),f=b.af(d),g=this.ca;f!==g&&(f=null!==g?c.Lb(g.data):void 0,g=c.qn,"function"===typeof g?g(a,f):a[g]=f,c.Hx(a,d));d=c.zl(a);f=b.af(d);g=this.fa;f!==g&&(f=null!==g?c.Lb(g.data):void 0,g=c.rn,"function"===typeof g?g(a,f):a[g]=f,c.Jx(a,d))}}}};
B.prototype.move=B.prototype.move=function(a){var b=this.position,c=b.x;isNaN(c)&&(c=0);b=b.y;isNaN(b)&&(b=0);c=a.x-c;b=a.y-b;x.prototype.move.call(this,a);this.Dl(c,b);for(a=this.sj;a.next();){var d=a.value,f=d.position;d.moveTo(f.x+c,f.y+b)}};t.g(B,"relinkableFrom",B.prototype.iG);t.defineProperty(B,{iG:"relinkableFrom"},function(){return this.gs},function(a){var b=this.gs;b!==a&&(e&&t.i(a,"boolean",B,"relinkableFrom"),this.gs=a,this.j("relinkableFrom",b,a),this.updateAdornments())});
t.g(B,"relinkableTo",B.prototype.jG);t.defineProperty(B,{jG:"relinkableTo"},function(){return this.hs},function(a){var b=this.hs;b!==a&&(e&&t.i(a,"boolean",B,"relinkableTo"),this.hs=a,this.j("relinkableTo",b,a),this.updateAdornments())});B.prototype.canRelinkFrom=function(){if(!this.iG)return!1;var a=this.layer;if(null===a)return!0;if(!a.gk)return!1;a=a.h;return null===a||a.gk?!0:!1};
B.prototype.canRelinkTo=function(){if(!this.jG)return!1;var a=this.layer;if(null===a)return!0;if(!a.gk)return!1;a=a.h;return null===a||a.gk?!0:!1};t.g(B,"resegmentable",B.prototype.Xp);t.defineProperty(B,{Xp:"resegmentable"},function(){return this.is},function(a){var b=this.is;b!==a&&(e&&t.i(a,"boolean",B,"resegmentable"),this.is=a,this.j("resegmentable",b,a),this.updateAdornments())});t.g(B,"isTreeLink",B.prototype.Ic);
t.defineProperty(B,{Ic:"isTreeLink"},function(){return this.tr},function(a){var b=this.tr;b!==a&&(e&&t.i(a,"boolean",B,"isTreeLink"),this.tr=a,this.j("isTreeLink",b,a),null!==this.ca&&Pj(this.ca),null!==this.fa&&Pj(this.fa))});t.A(B,{path:"path"},function(){var a=this.Vi;if(null!==a)return a;a=this.va;a=Hk(this,a,a.length);return a instanceof W?this.Vi=a:null});B.prototype.er=function(){return this.path};B.prototype.ez=function(){return this.Bc};
B.prototype.Ij=function(){this.updateRoute();var a=new F;this.vf(a);return this.Bz=a};
B.prototype.vf=function(a){var b=Infinity,c=Infinity,d=this.ra;if(0===d)return a.p(NaN,NaN,0,0),a;if(1===d)d=this.o(0),b=Math.min(d.x,b),c=Math.min(d.y,c),a.p(d.x,d.y,0,0);else if(2===d){var f=this.o(0),g=this.o(1),b=Math.min(f.x,g.x),c=Math.min(f.y,g.y);a.p(f.x,f.y,0,0);a.xj(g)}else if(this.computeCurve()===Wg&&3<=d&&!this.pc)if(f=this.o(0),b=f.x,c=f.y,a.p(b,c,0,0),3===d)d=this.o(1),b=Math.min(d.x,b),c=Math.min(d.y,c),g=this.o(2),b=Math.min(g.x,b),c=Math.min(g.y,c),K.ep(f.x,f.y,d.x,d.y,d.x,d.y,g.x,
g.y,0.5,a);else for(var h,k,l=3;l<d;l+=3)h=this.o(l-2),l+3>=d&&(l=d-1),k=this.o(l-1),g=this.o(l),K.ep(f.x,f.y,h.x,h.y,k.x,k.y,g.x,g.y,0.5,a),b=Math.min(g.x,b),c=Math.min(g.y,c),f=g;else for(f=this.o(0),g=this.o(1),b=Math.min(f.x,g.x),c=Math.min(f.y,g.y),a.p(f.x,f.y,0,0),a.xj(g),l=2;l<d;l++)f=this.o(l),b=Math.min(f.x,b),c=Math.min(f.y,c),a.xj(f);this.Mz.p(b-a.x,c-a.y);return a};t.A(B,{YF:"midPoint"},function(){this.updateRoute();return this.computeMidPoint(new E)});
B.prototype.computeMidPoint=function(a){var b=this.ra;if(0===b)return a.assign(K.uH),a;if(1===b)return a.assign(this.o(0)),a;if(2===b){var c=this.o(0),d=this.o(1);a.p((c.x+d.x)/2,(c.y+d.y)/2);return a}if(this.computeCurve()===Wg&&3<=b&&!this.pc){if(3===b)return this.o(1);var b=(b-1)/3|0,f=3*(b/2|0);1===b%2?(c=this.o(f),d=this.o(f+1),b=this.o(f+2),f=this.o(f+3),K.qI(c.x,c.y,d.x,d.y,b.x,b.y,f.x,f.y,a)):a.assign(this.o(f));return a}for(var f=0,g=t.Hb(),h=0;h<b-1;h++)c=this.o(h),d=this.o(h+1),K.sb(c.x,
d.x)?(c=d.y-c.y,0>c&&(c=-c)):K.sb(c.y,d.y)?(c=d.x-c.x,0>c&&(c=-c)):c=Math.sqrt(c.nk(d)),g.push(c),f+=c;for(d=h=c=0;c<f/2&&h<b;){d=g[h];if(c+d>f/2)break;c+=d;h++}t.Ca(g);b=this.o(h);g=this.o(h+1);b.x===g.x?b.y>g.y?a.p(b.x,b.y-(f/2-c)):a.p(b.x,b.y+(f/2-c)):b.y===g.y?b.x>g.x?a.p(b.x-(f/2-c),b.y):a.p(b.x+(f/2-c),b.y):(f=(f/2-c)/d,a.p(b.x+f*(g.x-b.x),b.y+f*(g.y-b.y)));return a};t.A(B,{XF:"midAngle"},function(){this.updateRoute();return this.computeMidAngle()});
B.prototype.computeMidAngle=function(){var a=this.ra;if(2>a)return NaN;if(this.computeCurve()===Wg&&4<=a&&!this.pc){var b=(a-1)/3|0,c=3*(b/2|0);if(1===b%2){var c=Math.floor(c),a=this.o(c),b=this.o(c+1),d=this.o(c+2),c=this.o(c+3);return K.pI(a.x,a.y,b.x,b.y,d.x,d.y,c.x,c.y)}if(0<c&&c+1<a)return a=this.o(c-1),b=this.o(c+1),a.mj(b)}d=a/2|0;if(0===a%2)return a=this.o(d-1),b=this.o(d),a.mj(b);var a=this.o(d-1),b=this.o(d),d=this.o(d+1),c=a.nk(b),f=b.nk(d);return c>f?a.mj(b):b.mj(d)};t.g(B,"points",B.prototype.points);
t.defineProperty(B,{points:"points"},function(){return this.Bc},function(a){var b=this.Bc;if(b!==a){e&&(Array.isArray(a)||a instanceof H||t.m("Link.points value is not an instance of List or Array"));var c=a;if(Array.isArray(a)){var d=0===a.length%2;if(d)for(var f=0;f<a.length;f++)if("number"!==typeof a[f]){d=!1;break}if(d)for(c=new H(E),d=0;d<a.length/2;d++)f=(new E(a[2*d],a[2*d+1])).freeze(),c.add(f);else t.m("Link.points array must contain only numbers")}else for(c=a.copy(),a=c.k;a.next();)a.value.freeze();
c.freeze();this.Bc=c;this.df();fn(this);this.h&&this.h.mc.zd&&(this.No=c);this.j("points",b,c)}});t.A(B,{ra:"pointsCount"},function(){return this.Bc.count});B.prototype.getPoint=B.prototype.o=function(a){return this.Bc.n[a]};B.prototype.setPoint=B.prototype.Hf=function(a,b){e&&(t.l(b,E,B,"setPoint"),b.P()||t.m("Link.setPoint called with a Point that does not have real numbers: "+b.toString()));null===this.De&&t.m("Call Link.startRoute before modifying the points of the route.");this.Bc.Tg(a,b)};
B.prototype.setPointAt=B.prototype.aa=function(a,b,c){e&&(t.q(b,B,"setPointAt:x"),t.q(c,B,"setPointAt:y"));null===this.De&&t.m("Call Link.startRoute before modifying the points of the route.");this.Bc.Tg(a,new E(b,c))};B.prototype.insertPoint=function(a,b){e&&(t.l(b,E,B,"insertPoint"),b.P()||t.m("Link.insertPoint called with a Point that does not have real numbers: "+b.toString()));null===this.De&&t.m("Call Link.startRoute before modifying the points of the route.");this.Bc.Pd(a,b)};
B.prototype.insertPointAt=B.prototype.C=function(a,b,c){e&&(t.q(b,B,"insertPointAt:x"),t.q(c,B,"insertPointAt:y"));null===this.De&&t.m("Call Link.startRoute before modifying the points of the route.");this.Bc.Pd(a,new E(b,c))};B.prototype.addPoint=B.prototype.gi=function(a){e&&(t.l(a,E,B,"addPoint"),a.P()||t.m("Link.addPoint called with a Point that does not have real numbers: "+a.toString()));null===this.De&&t.m("Call Link.startRoute before modifying the points of the route.");this.Bc.add(a)};
B.prototype.addPointAt=B.prototype.jl=function(a,b){e&&(t.q(a,B,"insertPointAt:x"),t.q(b,B,"insertPointAt:y"));null===this.De&&t.m("Call Link.startRoute before modifying the points of the route.");this.Bc.add(new E(a,b))};B.prototype.removePoint=B.prototype.lG=function(a){null===this.De&&t.m("Call Link.startRoute before modifying the points of the route.");this.Bc.wd(a)};
B.prototype.clearPoints=B.prototype.gp=function(){null===this.De&&t.m("Call Link.startRoute before modifying the points of the route.");this.Bc.clear()};B.prototype.movePoints=B.prototype.Dl=function(a,b){for(var c=new H(E),d=this.Bc.k;d.next();){var f=d.value;c.add((new E(f.x+a,f.y+b)).freeze())}c.freeze();d=this.Bc;this.Bc=c;this.df();fn(this);this.h&&this.h.mc.zd&&(this.No=c);this.j("points",d,c)};B.prototype.startRoute=B.prototype.Kl=function(){null===this.De&&(this.De=this.Bc,this.Bc=this.Bc.copy())};
B.prototype.commitRoute=B.prototype.ij=function(){if(null!==this.De){for(var a=this.De,b=this.Bc,c=Infinity,d=Infinity,f=a.count,g=0;g<f;g++)var h=a.n[g],c=Math.min(h.x,c),d=Math.min(h.y,d);for(var k=Infinity,l=Infinity,m=b.count,g=0;g<m;g++)h=b.n[g],k=Math.min(h.x,k),l=Math.min(h.y,l),h.freeze();b.freeze();if(m===f)for(g=0;g<m;g++){if(f=a.n[g],h=b.n[g],f.x-c!==h.x-k||f.y-d!==h.y-l){this.df();break}}else this.df();this.De=null;this.h&&this.h.mc.zd&&(this.No=b);fn(this);this.j("points",a,b)}};
B.prototype.rollbackRoute=B.prototype.gK=function(){null!==this.De&&(this.Bc=this.De,this.De=null)};function fn(a){0===a.Bc.count?a.xg=!1:(a.xg=!0,a.Wn=a.o(0).copy(),a.$n=a.o(a.ra-1).copy(),gn(a,!1))}B.prototype.invalidateRoute=B.prototype.hc=function(){if(!(this.Iz||this.h&&this.h.ma.yb)){var a=this.er();null!==a&&(this.xg=!1,this.df(),a.ja())}};t.defineProperty(B,{jq:null},function(){return this.Iz},function(a){this.Iz=a});
B.prototype.updateRoute=function(){if(!this.xg&&!this.Ey){var a=!0;try{this.Ey=!0,this.Kl(),a=this.computePoints()}finally{this.Ey=!1,a?this.ij():this.gK()}}};
B.prototype.computePoints=function(){var a=this.h;if(null===a)return!1;var b=this.ca,c=null;null===b?(a.Cm||(a.Qv=new W,a.Qv.Ea=K.uq,a.Qv.lb=0,a.Cm=new y,a.Cm.add(a.Qv),a.Cm.xf()),this.Wn&&(a.Cm.position=a.Cm.location=this.Wn,a.Cm.xf(),b=a.Cm,c=a.Qv)):c=this.sd;if(null!==c){var d=Qk(c);d!==b&&b.Wa()?c=d:(d=b.findVisibleNode(),null!==d&&d!==b?(b=d,c=d.tl("")):b=d)}this.MD=b;if(null===b||null===c||!b.location.P())return!1;var d=this.fa,f=null;null===d?(a.Dm||(a.Rv=new W,a.Rv.Ea=K.uq,a.Rv.lb=0,a.Dm=
new y,a.Dm.add(a.Rv),a.Dm.xf()),this.$n&&(a.Dm.position=a.Dm.location=this.$n,a.Dm.xf(),d=a.Dm,f=a.Rv)):f=this.Vd;null!==f&&(a=Qk(f),a!==d&&d.Wa()?f=a:(a=d.findVisibleNode(),null!==a&&a!==d?(d=a,f=a.tl("")):d=a));this.OD=d;if(null===d||null===f||!d.location.P())return!1;var a=this.ra,g=hn(this,c),h=jn(this,f),k=c===f&&null!==c,l=this.pc,m=this.Je===Wg;this.Hi=k&&!l?m=!0:!1;var n=this.Yo===Og||k;if(l||g!==Tb||h!==Tb||k){m=this.qj;n&&(l&&m||k)&&this.gp();var p=k?this.computeCurviness():0,q=this.getLinkPoint(b,
c,g,!0,l,d,f),r=0,s=0,u=0;if(l||g!==Tb||k){var w=this.computeEndSegmentLength(b,c,g,!0),u=this.getLinkDirection(b,c,q,g,!0,l,d,f);k&&(u-=l?90:30,0>p&&(u-=180));0>u?u+=360:360<=u&&(u-=360);k&&(w+=Math.abs(p));0===u?r=w:90===u?s=w:180===u?r=-w:270===u?s=-w:(r=w*Math.cos(u*Math.PI/180),s=w*Math.sin(u*Math.PI/180));if(g.Me()&&k){var D=c.wb(Yb,t.N()),A=t.qc(D.x+1E3*r,D.y+1E3*s);this.getLinkPointFromPoint(b,c,D,A,!0,q);t.B(D);t.B(A)}}var w=this.getLinkPoint(d,f,h,!1,l,b,c),G=0,M=0,N=0;if(l||h!==Tb||k)D=
this.computeEndSegmentLength(d,f,h,!1),N=this.getLinkDirection(d,f,w,h,!1,l,b,c),k&&(N+=l?0:30,0>p&&(N+=180)),0>N?N+=360:360<=N&&(N-=360),k&&(D+=Math.abs(p)),0===N?G=D:90===N?M=D:180===N?G=-D:270===N?M=-D:(G=D*Math.cos(N*Math.PI/180),M=D*Math.sin(N*Math.PI/180)),h.Me()&&k&&(D=f.wb(Yb,t.N()),A=t.qc(D.x+1E3*G,D.y+1E3*M),this.getLinkPointFromPoint(d,f,D,A,!1,w),t.B(D),t.B(A));f=q;if(l||g!==Tb||k)f=new E(q.x+r,q.y+s);c=w;if(l||h!==Tb||k)c=new E(w.x+G,w.y+M);!n&&!l&&g===Tb&&3<a&&this.adjustPoints(0,q,
a-2,c)?this.Hf(a-1,w):!n&&!l&&h===Tb&&3<a&&this.adjustPoints(1,f,a-1,w)?this.Hf(0,q):!n&&!l&&4<a&&this.adjustPoints(1,f,a-2,c)?(this.Hf(0,q),this.Hf(a-1,w)):!n&&l&&6<=a&&!m&&this.adjustPoints(1,f,a-2,c)?(this.Hf(0,q),this.Hf(a-1,w)):(this.gp(),this.gi(q),(l||g!==Tb||k)&&this.gi(f),l&&this.addOrthoPoints(f,u,c,N,b,d),(l||h!==Tb||k)&&this.gi(c),this.gi(w))}else g=!1,!n&&3<=a&&(n=this.getLinkPoint(b,c,Tb,!0,!1,d,f),g=this.getLinkPoint(d,f,Tb,!1,!1,b,c),g=this.adjustPoints(0,n,a-1,g)),g||(this.gp(),m?
(a=this.getLinkPoint(b,c,Tb,!0,!1,d,f),n=this.getLinkPoint(d,f,Tb,!1,!1,b,c),g=n.x-a.x,h=n.y-a.y,k=this.computeCurviness(),m=l=0,q=a.x+g/3,u=a.y+h/3,r=q,s=u,K.I(h,0)?s=0<g?s-k:s+k:(l=-g/h,m=Math.sqrt(k*k/(l*l+1)),0>k&&(m=-m),r=(0>h?-1:1)*m+q,s=l*(r-q)+u),q=a.x+2*g/3,u=a.y+2*h/3,w=q,G=u,K.I(h,0)?G=0<g?G-k:G+k:(w=(0>h?-1:1)*m+q,G=l*(w-q)+u),this.gp(),this.gi(a),this.jl(r,s),this.jl(w,G),this.gi(n),this.Hf(0,this.getLinkPoint(b,c,Tb,!0,!1,d,f)),this.Hf(3,this.getLinkPoint(d,f,Tb,!1,!1,b,c))):(a=d,d=
this.getLinkPoint(b,c,Tb,!0,!1,a,f),f=this.getLinkPoint(a,f,Tb,!1,!1,b,c),this.hasCurviness()?(h=f.x-d.x,b=f.y-d.y,c=this.computeCurviness(),a=d.x+h/2,n=d.y+b/2,g=a,k=n,K.I(b,0)?k=0<h?k-c:k+c:(h=-h/b,g=Math.sqrt(c*c/(h*h+1)),0>c&&(g=-g),g=(0>b?-1:1)*g+a,k=h*(g-a)+n),this.gi(d),this.jl(g,k)):this.gi(d),this.gi(f)));return!0};function kn(a,b){Math.abs(b.x-a.x)>Math.abs(b.y-a.y)?(b.x=b.x>=a.x?a.x+9E9:a.x-9E9,b.y=a.y):(b.y=b.y>=a.y?a.y+9E9:a.y-9E9,b.x=a.x);return b}
B.prototype.getLinkPointFromPoint=function(a,b,c,d,f,g){void 0===g&&(g=new E);if(null===a||null===b)return g.assign(c),g;a.Wa()||(f=a.findVisibleNode(),null!==f&&f!==a&&(b=f.port));var h;a=null;f=b.ia;null===f||f.Kf()||(f=f.ia);if(null===f)f=d.x,d=d.y,h=c.x,c=c.y;else{a=f.se;f=1/(a.m11*a.m22-a.m12*a.m21);h=a.m22*f;var k=-a.m12*f,l=-a.m21*f,m=a.m11*f,n=f*(a.m21*a.dy-a.m22*a.dx),p=f*(a.m12*a.dx-a.m11*a.dy);f=d.x*h+d.y*l+n;d=d.x*k+d.y*m+p;h=c.x*h+c.y*l+n;c=c.x*k+c.y*m+p}b.wp(f,d,h,c,g);a&&g.transform(a);
return g};function ln(a,b){var c=b.cs;null===c&&(c=new mn,c.port=b,c.Jc=b.U,b.cs=c);return nn(c,a)}
B.prototype.getLinkPoint=function(a,b,c,d,f,g,h,k){void 0===k&&(k=new E);if(c.Cd())return b.wb(c,k),k;if(c.Ep()&&(c=ln(this,b),null!==c)){k.assign(c.Kp);if(f&&this.au===Um){var l=ln(this,h);if(c.$m<l.$m){c=t.N();var l=t.N(),m=new F(b.wb(Vb,c),b.wb(bc,l)),n=this.computeSpot(!d);a=this.getLinkPoint(g,h,n,!d,f,a,b,l);a.x>=m.x&&a.x<=m.x+m.width?k.x=a.x:a.y>=m.y&&a.y<=m.y+m.height&&(k.y=a.y);t.B(c);t.B(l)}}return k}g=b.wb(Yb,t.N());c=null;this.ra>(f?6:2)?(h=d?this.o(1):this.o(this.ra-2),f&&(h=kn(g,h.copy()))):
(c=t.N(),h=h.wb(Yb,c),f&&(h=kn(g,h)));this.getLinkPointFromPoint(a,b,g,h,d,k);t.B(g);null!==c&&t.B(c);return k};
B.prototype.getLinkDirection=function(a,b,c,d,f,g,h,k){a:if(d.Cd())c=d.x>d.y?d.x>1-d.y?0:d.x<1-d.y?270:315:d.x<d.y?d.x>1-d.y?90:d.x<1-d.y?180:135:0.5>d.x?225:0.5<d.x?45:0;else{if(d.Ep()&&(a=ln(this,b),null!==a))switch(a.je){case t.gd:c=270;break a;case t.Mc:c=180;break a;default:case t.Xc:c=0;break a;case t.Wc:c=90;break a}a=b.wb(Yb,t.N());d=null;this.ra>(g?6:2)?(k=f?this.o(1):this.o(this.ra-2),k=g?kn(a,k.copy()):c):(d=t.N(),k=k.wb(Yb,d));c=Math.abs(k.x-a.x)>Math.abs(k.y-a.y)?k.x>=a.x?0:180:k.y>=
a.y?90:270;t.B(a);null!==d&&t.B(d)}g=Im;g=f?this.tp:this.kq;g===Im&&(g=f?b.tp:b.kq);switch(g){case Jm:b=b.ul();c+=b;360<=c&&(c-=360);break;case Im:case hk:b=b.ul();if(0===b)break;45<=b&&135>b?c+=90:135<=b&&225>b?c+=180:225<=b&&315>b&&(c+=270);360<=c&&(c-=360)}return c};B.prototype.computeEndSegmentLength=function(a,b,c,d){if(null!==b&&c.Ep()&&(a=ln(this,b),null!==a))return a.Ow;a=NaN;a=d?this.rk:this.xk;null!==b&&isNaN(a)&&(a=d?b.rk:b.xk);isNaN(a)&&(a=10);return a};
B.prototype.computeSpot=function(a){return a?hn(this,this.sd):jn(this,this.Vd)};function hn(a,b){if(null===b)return Yb;var c=a.vb;c.Tc()&&(void 0===b&&(b=a.sd),null!==b&&(c=b.vb));return c===Ub?Tb:c}function jn(a,b){if(null===b)return Yb;var c=a.zb;c.Tc()&&(void 0===b&&(b=a.Vd),null!==b&&(c=b.zb));return c===Ub?Tb:c}B.prototype.computeOtherPoint=function(a,b){var c=b.wb(Yb),d;d=b.cs;d=null!==d?nn(d,this):null;null!==d&&(c=d.Kp);return c};
B.prototype.computeShortLength=function(a){return a?on(this):pn(this)};function on(a){var b=a.up;isNaN(b)&&(a=a.sd,null!==a&&(b=a.up));return isNaN(b)?0:b}function pn(a){var b=a.lq;isNaN(b)&&(a=a.Vd,null!==a&&(b=a.lq));return isNaN(b)?0:b}
B.prototype.pk=function(a,b,c,d,f,g){if(!1===this.kf)return!1;void 0===b&&(b=null);void 0===c&&(c=null);var h=g;void 0===g&&(h=t.Ah(),h.reset());h.multiply(this.transform);if(this.Ym(a,h))return Yl(this,b,c,f),void 0===g&&t.bf(h),!0;if(this.Xf(a,h)){var k=!1;if(!this.bh)for(var l=this.va.length;l--;){var m=this.va.n[l];if(m.visible||m===this.Zb){var n=m.pa,p=this.Ja;if(!(n.x>p.width||n.y>p.height||0>n.x+n.width||0>n.y+n.height)){n=t.Ah();n.set(h);if(m instanceof C)k=m.pk(a,b,c,d,f,n);else if(this.path===
m){var k=m,q=a,r=d,p=n;if(!1===k.kf)k=!1;else if(p.multiply(k.transform),r)b:{var s=q,u=p;if(k.Ym(s,u))k=!0;else{if(void 0===u&&(u=k.transform,s.kk(k.pa))){k=!0;break b}var p=s.left,q=s.right,r=s.top,s=s.bottom,w=t.N(),D=t.N(),A=t.N(),G=t.Ah();G.set(u);G.XA(k.transform);G.FA();D.x=q;D.y=r;D.transform(G);w.x=p;w.y=r;w.transform(G);u=!1;em(k,w,D,A)?u=!0:(w.x=q,w.y=s,w.transform(G),em(k,w,D,A)?u=!0:(D.x=p,D.y=s,D.transform(G),em(k,w,D,A)?u=!0:(w.x=p,w.y=r,w.transform(G),em(k,w,D,A)&&(u=!0))));t.bf(G);
t.B(w);t.B(D);t.B(A);k=u}}else k=k.Ym(q,p)}else k=mk(m,a,d,n);k&&(null!==b&&(m=b(m)),m&&(null===c||c(m))&&f.add(m));t.bf(n)}}}void 0===g&&t.bf(h);return k||null!==this.background||null!==this.hk}void 0===g&&t.bf(h);return!1};t.A(B,{pc:"isOrthogonal"},function(){return 2===(this.Bm.value&2)});t.A(B,{qj:"isAvoiding"},function(){return 4===(this.Bm.value&4)});B.prototype.computeCurve=function(){if(null===this.Hi){var a=this.sd,b=this.pc;this.Hi=null!==a&&a===this.Vd&&!b}return this.Hi?Wg:this.Je};
B.prototype.computeCorner=function(){if(this.Je===Wg)return 0;var a=this.Gw;if(isNaN(a)||0>a)a=10;return a};B.prototype.computeCurviness=function(){var a=this.kt;if(isNaN(a)){var b=this.nf;if(0!==b){var a=10,c=this.h;null!==c&&(a=c.Lp);c=Math.abs(b);a=a/2+((c-1)/2|0)*a;0===c%2&&(a=-a);0>b&&(a=-a)}else a=10}return a};B.prototype.computeThickness=function(){var a=this.path;return null!==a?Math.max(a.lb,1):1};B.prototype.hasCurviness=function(){return!isNaN(this.kt)||0!==this.nf&&!this.pc};
B.prototype.adjustPoints=function(a,b,c,d){var f=this.Yo;if(this.pc){if(f===Zk)return!1;f===$k&&(f=Yk)}switch(f){case Zk:var g=this.o(a),h=this.o(c);if(!g.O(b)||!h.O(d)){var f=g.x,g=g.y,k=h.x-f,l=h.y-g,m=Math.sqrt(k*k+l*l);if(!K.I(m,0)){var n;K.I(k,0)?n=0>l?-Math.PI/2:Math.PI/2:(n=Math.atan(l/Math.abs(k)),0>k&&(n=Math.PI-n));var h=b.x,p=b.y,k=d.x-h,q=d.y-p,l=Math.sqrt(k*k+q*q);K.I(k,0)?q=0>q?-Math.PI/2:Math.PI/2:(q=Math.atan(q/Math.abs(k)),0>k&&(q=Math.PI-q));m=l/m;n=q-n;this.Hf(a,b);for(a+=1;a<c;a++)b=
this.o(a),k=b.x-f,l=b.y-g,b=Math.sqrt(k*k+l*l),K.I(b,0)||(K.I(k,0)?l=0>l?-Math.PI/2:Math.PI/2:(l=Math.atan(l/Math.abs(k)),0>k&&(l=Math.PI-l)),k=l+n,b*=m,this.aa(a,h+b*Math.cos(k),p+b*Math.sin(k)));this.Hf(c,d)}}return!0;case $k:g=this.o(a);p=this.o(c);if(!g.O(b)||!p.O(d)){f=g.x;g=g.y;h=p.x;p=p.y;m=(h-f)*(h-f)+(p-g)*(p-g);k=b.x;n=b.y;var l=d.x,q=d.y,r=0,s=1,r=0!==l-k?(q-n)/(l-k):9E9;0!==r&&(s=Math.sqrt(1+1/(r*r)));this.Hf(a,b);for(a+=1;a<c;a++){b=this.o(a);var u=b.x,w=b.y,D=0.5;0!==m&&(D=((f-u)*(f-
h)+(g-w)*(g-p))/m);var A=f+D*(h-f),G=g+D*(p-g);b=Math.sqrt((u-A)*(u-A)+(w-G)*(w-G));w<r*(u-A)+G&&(b=-b);0<r&&(b=-b);u=k+D*(l-k);D=n+D*(q-n);0!==r?(b=u+b/s,this.aa(a,b,D-(b-u)/r)):this.aa(a,u,D+b)}this.Hf(c,d)}return!0;case Yk:return this.pc&&(f=this.o(a),g=this.o(a+1),h=this.o(a+2),K.I(f.y,g.y)?K.I(g.x,h.x)?this.aa(a+1,g.x,b.y):K.I(g.y,h.y)&&this.aa(a+1,b.x,g.y):K.I(f.x,g.x)&&(K.I(g.y,h.y)?this.aa(a+1,b.x,g.y):K.I(g.x,h.x)&&this.aa(a+1,g.x,b.y)),f=this.o(c),g=this.o(c-1),h=this.o(c-2),K.I(f.y,g.y)?
K.I(g.x,h.x)?this.aa(c-1,g.x,d.y):K.I(g.y,h.y)&&this.aa(c-1,d.x,g.y):K.I(f.x,g.x)&&(K.I(g.y,h.y)?this.aa(c-1,d.x,g.y):K.I(g.x,h.x)&&this.aa(c-1,g.x,d.y))),this.Hf(a,b),this.Hf(c,d),!0;default:return!1}};
B.prototype.addOrthoPoints=function(a,b,c,d,f,g){b=-45<=b&&45>b?0:45<=b&&135>b?90:135<=b&&225>b?180:270;d=-45<=d&&45>d?0:45<=d&&135>d?90:135<=d&&225>d?180:270;var h=f.pa.copy(),k=g.pa.copy();if(h.P()&&k.P()){h.Wf(8,8);k.Wf(8,8);h.xj(a);k.xj(c);var l,m;if(0===b)if(c.x>a.x||270===d&&c.y<a.y&&k.right>a.x||90===d&&c.y>a.y&&k.right>a.x)l=new E(c.x,a.y),m=new E(c.x,(a.y+c.y)/2),180===d?(l.x=this.computeMidOrthoPosition(a.x,c.x,!1),m.x=l.x,m.y=c.y):270===d&&c.y<a.y||90===d&&c.y>a.y?(l.x=a.x<k.left?this.computeMidOrthoPosition(a.x,
k.left,!1):a.x<k.right&&(270===d&&a.y<k.top||90===d&&a.y>k.bottom)?this.computeMidOrthoPosition(a.x,c.x,!1):k.right,m.x=l.x,m.y=c.y):0===d&&a.x<k.left&&a.y>k.top&&a.y<k.bottom&&(l.x=a.x,l.y=a.y<c.y?Math.min(c.y,k.top):Math.max(c.y,k.bottom),m.y=l.y);else{l=new E(a.x,c.y);m=new E((a.x+c.x)/2,c.y);if(180===d||90===d&&c.y<h.top||270===d&&c.y>h.bottom)180===d&&(k.La(a)||h.La(c))?l.y=this.computeMidOrthoPosition(a.y,c.y,!0):c.y<a.y&&(180===d||90===d)?l.y=this.computeMidOrthoPosition(h.top,Math.max(c.y,
k.bottom),!0):c.y>a.y&&(180===d||270===d)&&(l.y=this.computeMidOrthoPosition(h.bottom,Math.min(c.y,k.top),!0)),m.x=c.x,m.y=l.y;if(l.y>h.top&&l.y<h.bottom)if(c.x>=h.left&&c.x<=a.x||a.x<=k.right&&a.x>=c.x){if(90===d||270===d)l=new E(Math.max((a.x+c.x)/2,a.x),a.y),m=new E(l.x,c.y)}else l.y=270===d||(0===d||180===d)&&c.y<a.y?Math.min(c.y,0===d?h.top:Math.min(h.top,k.top)):Math.max(c.y,0===d?h.bottom:Math.max(h.bottom,k.bottom)),m.x=c.x,m.y=l.y}else if(180===b)if(c.x<a.x||270===d&&c.y<a.y&&k.left<a.x||
90===d&&c.y>a.y&&k.left<a.x)l=new E(c.x,a.y),m=new E(c.x,(a.y+c.y)/2),0===d?(l.x=this.computeMidOrthoPosition(a.x,c.x,!1),m.x=l.x,m.y=c.y):270===d&&c.y<a.y||90===d&&c.y>a.y?(l.x=a.x>k.right?this.computeMidOrthoPosition(a.x,k.right,!1):a.x>k.left&&(270===d&&a.y<k.top||90===d&&a.y>k.bottom)?this.computeMidOrthoPosition(a.x,c.x,!1):k.left,m.x=l.x,m.y=c.y):180===d&&a.x>k.right&&a.y>k.top&&a.y<k.bottom&&(l.x=a.x,l.y=a.y<c.y?Math.min(c.y,k.top):Math.max(c.y,k.bottom),m.y=l.y);else{l=new E(a.x,c.y);m=new E((a.x+
c.x)/2,c.y);if(0===d||90===d&&c.y<h.top||270===d&&c.y>h.bottom)0===d&&(k.La(a)||h.La(c))?l.y=this.computeMidOrthoPosition(a.y,c.y,!0):c.y<a.y&&(0===d||90===d)?l.y=this.computeMidOrthoPosition(h.top,Math.max(c.y,k.bottom),!0):c.y>a.y&&(0===d||270===d)&&(l.y=this.computeMidOrthoPosition(h.bottom,Math.min(c.y,k.top),!0)),m.x=c.x,m.y=l.y;if(l.y>h.top&&l.y<h.bottom)if(c.x<=h.right&&c.x>=a.x||a.x>=k.left&&a.x<=c.x){if(90===d||270===d)l=new E(Math.min((a.x+c.x)/2,a.x),a.y),m=new E(l.x,c.y)}else l.y=270===
d||(0===d||180===d)&&c.y<a.y?Math.min(c.y,180===d?h.top:Math.min(h.top,k.top)):Math.max(c.y,180===d?h.bottom:Math.max(h.bottom,k.bottom)),m.x=c.x,m.y=l.y}else if(90===b)if(c.y>a.y||180===d&&c.x<a.x&&k.bottom>a.y||0===d&&c.x>a.x&&k.bottom>a.y)l=new E(a.x,c.y),m=new E((a.x+c.x)/2,c.y),270===d?(l.y=this.computeMidOrthoPosition(a.y,c.y,!0),m.x=c.x,m.y=l.y):180===d&&c.x<a.x||0===d&&c.x>a.x?(l.y=a.y<k.top?this.computeMidOrthoPosition(a.y,k.top,!0):a.y<k.bottom&&(180===d&&a.x<k.left||0===d&&a.x>k.right)?
this.computeMidOrthoPosition(a.y,c.y,!0):k.bottom,m.x=c.x,m.y=l.y):90===d&&a.y<k.top&&a.x>k.left&&a.x<k.right&&(l.x=a.x<c.x?Math.min(c.x,k.left):Math.max(c.x,k.right),l.y=a.y,m.x=l.x);else{l=new E(c.x,a.y);m=new E(c.x,(a.y+c.y)/2);if(270===d||0===d&&c.x<h.left||180===d&&c.x>h.right)270===d&&(k.La(a)||h.La(c))?l.x=this.computeMidOrthoPosition(a.x,c.x,!1):c.x<a.x&&(270===d||0===d)?l.x=this.computeMidOrthoPosition(h.left,Math.max(c.x,k.right),!1):c.x>a.x&&(270===d||180===d)&&(l.x=this.computeMidOrthoPosition(h.right,
Math.min(c.x,k.left),!1)),m.x=l.x,m.y=c.y;if(l.x>h.left&&l.x<h.right)if(c.y>=h.top&&c.y<=a.y||a.y<=k.bottom&&a.y>=c.y){if(0===d||180===d)l=new E(a.x,Math.max((a.y+c.y)/2,a.y)),m=new E(c.x,l.y)}else l.x=180===d||(90===d||270===d)&&c.x<a.x?Math.min(c.x,90===d?h.left:Math.min(h.left,k.left)):Math.max(c.x,90===d?h.right:Math.max(h.right,k.right)),m.x=l.x,m.y=c.y}else if(c.y<a.y||180===d&&c.x<a.x&&k.top<a.y||0===d&&c.x>a.x&&k.top<a.y)l=new E(a.x,c.y),m=new E((a.x+c.x)/2,c.y),90===d?(l.y=this.computeMidOrthoPosition(a.y,
c.y,!0),m.x=c.x,m.y=l.y):180===d&&c.x<a.x||0===d&&c.x>=a.x?(l.y=a.y>k.bottom?this.computeMidOrthoPosition(a.y,k.bottom,!0):a.y>k.top&&(180===d&&a.x<k.left||0===d&&a.x>k.right)?this.computeMidOrthoPosition(a.y,c.y,!0):k.top,m.x=c.x,m.y=l.y):270===d&&a.y>k.bottom&&a.x>k.left&&a.x<k.right&&(l.x=a.x<c.x?Math.min(c.x,k.left):Math.max(c.x,k.right),l.y=a.y,m.x=l.x);else{l=new E(c.x,a.y);m=new E(c.x,(a.y+c.y)/2);if(90===d||0===d&&c.x<h.left||180===d&&c.x>h.right)90===d&&(k.La(a)||h.La(c))?l.x=this.computeMidOrthoPosition(a.x,
c.x,!1):c.x<a.x&&(90===d||0===d)?l.x=this.computeMidOrthoPosition(h.left,Math.max(c.x,k.right),!1):c.x>a.x&&(90===d||180===d)&&(l.x=this.computeMidOrthoPosition(h.right,Math.min(c.x,k.left),!1)),m.x=l.x,m.y=c.y;if(l.x>h.left&&l.x<h.right)if(c.y<=h.bottom&&c.y>=a.y||a.y>=k.top&&a.y<=c.y){if(0===d||180===d)l=new E(a.x,Math.min((a.y+c.y)/2,a.y)),m=new E(c.x,l.y)}else l.x=180===d||(90===d||270===d)&&c.x<a.x?Math.min(c.x,270===d?h.left:Math.min(h.left,k.left)):Math.max(c.x,270===d?h.right:Math.max(h.right,
k.right)),m.x=l.x,m.y=c.y}var n=l,p=m;if(this.qj){var q=this.h,r;(r=null===q)||(q.mc.Eg?r=!1:(r=q.Ya,r=r instanceof lf?!r.Is||r.AF:!0),r=!r);if(r||h.La(c)||k.La(a)||f===g||this.layer.Dc)a=!1;else if(f=ia(q,!0,this),qn(f,Math.min(a.x,n.x),Math.min(a.y,n.y),Math.abs(a.x-n.x),Math.abs(a.y-n.y))&&qn(f,Math.min(n.x,p.x),Math.min(n.y,p.y),Math.abs(n.x-p.x),Math.abs(n.y-p.y))&&qn(f,Math.min(p.x,c.x),Math.min(p.y,c.y),Math.abs(p.x-c.x),Math.abs(p.y-c.y)))a=!1;else if(h=h.copy().yj(k),h.Wf(2*f.Vm,2*f.Um),
rn(f,a,b,c,d,h),k=sn(f,c.x,c.y),f.abort||k!==ka||(Tj(f),k=f.KG,h.Wf(f.Vm*k,f.Um*k),rn(f,a,b,c,d,h),k=sn(f,c.x,c.y)),f.abort||k!==ka||(Tj(f),k=f.KF,h.Wf(f.Vm*k,f.Um*k),rn(f,a,b,c,d,h),k=sn(f,c.x,c.y)),!f.abort&&k===ka&&f.nH&&(Tj(f),rn(f,a,b,c,d,f.Tb),k=sn(f,c.x,c.y)),!f.abort&&k<ka&&sn(f,c.x,c.y)!==ja){tn(this,f,c.x,c.y,d,!0);d=this.o(2);if(4>this.ra)0===b||180===b?(d.x=a.x,d.y=c.y):(d.x=c.x,d.y=a.y),this.aa(2,d.x,d.y),this.C(3,d.x,d.y);else if(c=this.o(3),0===b||180===b)K.I(d.x,c.x)?(b=0===b?Math.max(d.x,
a.x):Math.min(d.x,a.x),this.aa(2,b,a.y),this.aa(3,b,c.y)):K.I(d.y,c.y)?(Math.abs(a.y-d.y)<=f.Um/2&&(this.aa(2,d.x,a.y),this.aa(3,c.x,a.y)),this.C(2,d.x,a.y)):this.aa(2,a.x,d.y);else if(90===b||270===b)K.I(d.y,c.y)?(b=90===b?Math.max(d.y,a.y):Math.min(d.y,a.y),this.aa(2,a.x,b),this.aa(3,c.x,b)):K.I(d.x,c.x)?(Math.abs(a.x-d.x)<=f.Vm/2&&(this.aa(2,a.x,d.y),this.aa(3,a.x,c.y)),this.C(2,a.x,d.y)):this.aa(2,d.x,a.y);a=!0}else a=!1}else a=!1;a||(this.gi(l),this.gi(m))}};
B.prototype.computeMidOrthoPosition=function(a,b){if(this.hasCurviness()){var c=this.computeCurviness();return(a+b)/2+c}return(a+b)/2};function Tf(a){if(!a.qj)return!1;var b=a.points.n,c=b.length;if(4>c)return!1;a=ia(a.h,!0,a);for(var d=1;d<c-2;d++){var f=b[d],g=b[d+1];if(!qn(a,Math.min(f.x,g.x),Math.min(f.y,g.y),Math.abs(f.x-g.x),Math.abs(f.y-g.y)))return!0}return!1}
function tn(a,b,c,d,f,g){var h=b.Vm,k=b.Um,l=sn(b,c,d),m=c,n=d;for(0===f?m+=h:90===f?n+=k:180===f?m-=h:n-=k;l>un&&sn(b,m,n)===l-vn;)c=m,d=n,0===f?m+=h:90===f?n+=k:180===f?m-=h:n-=k,l-=vn;if(g){if(l>un)if(180===f||0===f)c=Math.floor(c/h)*h+h/2;else if(90===f||270===f)d=Math.floor(d/k)*k+k/2}else c=Math.floor(c/h)*h+h/2,d=Math.floor(d/k)*k+k/2;l>un&&(g=f,m=c,n=d,0===f?(g=90,n+=k):90===f?(g=180,m-=h):180===f?(g=270,n-=k):270===f&&(g=0,m+=h),sn(b,m,n)===l-vn?tn(a,b,m,n,g,!1):(m=c,n=d,0===f?(g=270,n-=
k):90===f?(g=0,m+=h):180===f?(g=90,n+=k):270===f&&(g=180,m-=h),sn(b,m,n)===l-vn&&tn(a,b,m,n,g,!1)));a.jl(c,d)}B.prototype.findClosestSegment=function(a){e&&t.l(a,E,B,"findClosestSegment:p");var b=a.x;a=a.y;for(var c=this.o(0),d=this.o(1),f=nb(b,a,c.x,c.y,d.x,d.y),g=0,h=1;h<this.ra-1;h++){var c=this.o(h+1),k=nb(b,a,d.x,d.y,c.x,c.y),d=c;k<f&&(g=h,f=k)}return g};B.prototype.invalidateGeometry=B.prototype.df=function(){this.Vi=this.Ta=null;this.ja()};
t.A(B,{td:"geometry"},function(){null===this.Ta&&(this.updateRoute(),this.Ta=this.makeGeometry());return this.Ta});B.prototype.sx=function(){if(null===this.Ta&&!1!==this.xg){this.Ta=this.makeGeometry();var a=this.er();if(null!==a){a.Ta=this.Ta;for(var b=this.va,c=b.length,d=0;d<c;d++){var f=b.n[d];f!==a&&f.oi&&f instanceof W&&(f.Ta=this.Ta)}}}};
B.prototype.makeGeometry=function(){var a=this.ra;if(2>a){var b=new Pc(Qc),c=new Rc(0,0);b.Fb.add(c);return b}var d=!1,b=this.h;null!==b&&0!==b.ma.Qe&&en(this)&&(d=!0);var f=this.o(0).copy(),g=f.copy(),h=this.computeCurve();if(h===Wg&&3<=a&&!K.sb(this.En,0))if(3===a)var k=this.o(1),b=Math.min(f.x,k.x),c=Math.min(f.y,k.y),k=this.o(2),b=Math.min(b,k.x),c=Math.min(c,k.y);else{if(this.pc)for(k=0;k<a;k++)b=this.Bc.n[k],g.x=Math.min(b.x,g.x),g.y=Math.min(b.y,g.y);else for(var l,k=3;k<a;k+=3)k+3>=a&&(k=
a-1),l=this.o(k),g.x=Math.min(l.x,g.x),g.y=Math.min(l.y,g.y);b=g.x;c=g.y}else{for(k=0;k<a;k++)b=this.Bc.n[k],g.x=Math.min(b.x,g.x),g.y=Math.min(b.y,g.y);b=g.x;c=g.y}b-=this.Mz.x;c-=this.Mz.y;f.x-=b;f.y-=c;if(2===a){var m=this.o(1).copy();m.x-=b;m.y-=c;0!==on(this)&&wn(this,f,!0,g);0!==pn(this)&&wn(this,m,!1,g);b=new Pc(Tc);b.sa=f.x;b.ta=f.y;b.D=m.x;b.F=m.y}else{m=t.u();0!==on(this)&&wn(this,f,!0,g);P(m,f.x,f.y,!1,!1);if(h===Wg&&3<=a&&!K.sb(this.En,0))if(3===a)k=this.o(1),a=k.x-b,d=k.y-c,k=this.o(2).copy(),
k.x-=b,k.y-=c,0!==pn(this)&&wn(this,k,!1,g),Q(m,a,d,a,d,k.x,k.y);else if(this.pc){g=new E(b,c);f=this.o(1).copy();h=new E(b,c);a=new E(b,c);d=this.o(0);l=null;for(var n=this.En/3,k=1;k<this.ra-1;k++){l=this.o(k);var p=d,q=l,r=this.o(xn(this,l,k,!1));if(!K.sb(p.x,q.x)||!K.sb(q.x,r.x))if(!K.sb(p.y,q.y)||!K.sb(q.y,r.y)){var s=n,u=h,w=a;isNaN(s)&&(s=this.En/3);var D=p.x,p=p.y,A=q.x,q=q.y,G=r.x,r=r.y,M=s*yn(D,p,A,q),s=s*yn(A,q,G,r);K.sb(p,q)&&K.sb(A,G)&&(A>D?r>q?(u.x=A-M,u.y=q-M,w.x=A+s,w.y=q+s):(u.x=
A-M,u.y=q+M,w.x=A+s,w.y=q-s):r>q?(u.x=A+M,u.y=q-M,w.x=A-s,w.y=q+s):(u.x=A+M,u.y=q+M,w.x=A-s,w.y=q-s));K.sb(D,A)&&K.sb(q,r)&&(q>p?(G>A?(u.x=A-M,u.y=q-M,w.x=A+s):(u.x=A+M,u.y=q-M,w.x=A-s),w.y=q+s):(G>A?(u.x=A-M,u.y=q+M,w.x=A+s):(u.x=A+M,u.y=q+M,w.x=A-s),w.y=q-s));if(K.sb(D,A)&&K.sb(A,G)||K.sb(p,q)&&K.sb(q,r))D=0.5*(D+G),p=0.5*(p+r),u.x=D,u.y=p,w.x=D,w.y=p;1===k?(f.x=0.5*(d.x+l.x),f.y=0.5*(d.y+l.y)):2===k&&K.sb(d.x,this.o(0).x)&&K.sb(d.y,this.o(0).y)&&(f.x=0.5*(d.x+l.x),f.y=0.5*(d.y+l.y));Q(m,f.x-b,
f.y-c,h.x-b,h.y-c,l.x-b,l.y-c);g.set(h);f.set(a);d=l}}k=d.x;d=d.y;g=this.o(this.ra-1);k=0.5*(k+g.x);d=0.5*(d+g.y);Q(m,a.x-b,a.y-c,k-b,d-c,g.x-b,g.y-c)}else for(k=3;k<a;k+=3)d=this.o(k-2),k+3>=a&&(k=a-1),g=this.o(k-1),l=this.o(k),k===a-1&&0!==pn(this)&&(l=l.copy(),wn(this,l,!1,K.Aj)),Q(m,d.x-b,d.y-c,g.x-b,g.y-c,l.x-b,l.y-c);else{g=t.N();g.assign(this.o(0));for(k=1;k<a;){k=xn(this,g,k,1<k);u=this.o(k);if(k>=a-1){g!==u&&(0!==pn(this)&&(u=u.copy(),wn(this,u,!1,K.Aj)),zn(this,m,-b,-c,g,u,d));break}k=xn(this,
u,k+1,k<a-3);f=m;h=-b;l=-c;n=g;w=this.o(k);D=g;p=d;K.I(n.y,u.y)&&K.I(u.x,w.x)?(s=this.computeCorner(),s=Math.min(s,Math.abs(u.x-n.x)/2),s=A=Math.min(s,Math.abs(w.y-u.y)/2),K.I(s,0)?(zn(this,f,h,l,n,u,p),D.assign(u)):(q=u.x,G=u.y,r=q,M=G,q=u.x>n.x?u.x-s:u.x+s,M=w.y>u.y?u.y+A:u.y-A,zn(this,f,h,l,n,new E(q,G),p),fd(f,u.x+h,u.y+l,r+h,M+l),D.p(r,M))):K.I(n.x,u.x)&&K.I(u.y,w.y)?(s=this.computeCorner(),A=Math.min(s,Math.abs(u.y-n.y)/2),A=s=Math.min(A,Math.abs(w.x-u.x)/2),K.I(s,0)?(zn(this,f,h,l,n,u,p),D.assign(u)):
(q=u.x,M=G=u.y,G=u.y>n.y?u.y-A:u.y+A,r=w.x>u.x?u.x+s:u.x-s,zn(this,f,h,l,n,new E(q,G),p),fd(f,u.x+h,u.y+l,r+h,M+l),D.p(r,M))):(zn(this,f,h,l,n,u,p),D.assign(u))}t.B(g)}b=m.s;t.v(m)}return b};function yn(a,b,c,d){a=c-a;if(isNaN(a)||Infinity===a||-Infinity===a)return NaN;0>a&&(a=-a);b=d-b;if(isNaN(b)||Infinity===b||-Infinity===b)return NaN;0>b&&(b=-b);return K.sb(a,0)?b:K.sb(b,0)?a:Math.sqrt(a*a+b*b)}
function wn(a,b,c,d){var f=a.ra;if(!(2>f))if(c){var g=a.o(1);c=g.x-d.x;d=g.y-d.y;g=yn(b.x,b.y,c,d);0!==g&&(f=2===f?0.5*g:g,a=on(a),a>f&&(a=f),c=a*(c-b.x)/g,a=a*(d-b.y)/g,b.x+=c,b.y+=a)}else g=a.o(f-2),c=g.x-d.x,d=g.y-d.y,g=yn(b.x,b.y,c,d),0!==g&&(f=2===f?0.5*g:g,a=pn(a),a>f&&(a=f),c=a*(b.x-c)/g,a=a*(b.y-d)/g,b.x-=c,b.y-=a)}
function xn(a,b,c,d){for(var f=a.ra,g=b;K.sb(b.x,g.x)&&K.sb(b.y,g.y);){if(c>=f)return f-1;g=a.o(c++)}if(!K.sb(b.x,g.x)&&!K.sb(b.y,g.y))return c-1;for(var h=g;K.sb(b.x,g.x)&&K.sb(g.x,h.x)&&(!d||(b.y>=g.y?g.y>=h.y:g.y<=h.y))||K.sb(b.y,g.y)&&K.sb(g.y,h.y)&&(!d||(b.x>=g.x?g.x>=h.x:g.x<=h.x));){if(c>=f)return f-1;h=a.o(c++)}return c-2}
function zn(a,b,c,d,f,g,h){if(!h&&en(a)){h=[];var k=0;a.Wa()&&(k=An(a,f,g,h));var l=f.x,l=f.y;if(0<k)if(K.I(f.y,g.y))if(f.x<g.x)for(var m=0;m<k;){var n=Math.max(f.x,Math.min(h[m++]-5,g.x-10));b.lineTo(n+c,g.y+d);for(var l=n+c,p=Math.min(n+10,g.x);m<k;){var q=h[m];if(q<p+10)m++,p=Math.min(q+5,g.x);else break}q=(n+p)/2+c;q=g.y-10+d;n=p+c;p=g.y+d;a.Je===Ng?P(b,n,p,!1,!1):Q(b,l,q,n,q,n,p)}else for(m=k-1;0<=m;){n=Math.min(f.x,Math.max(h[m--]+5,g.x+10));b.lineTo(n+c,g.y+d);l=n+c;for(p=Math.max(n-10,g.x);0<=
m;)if(q=h[m],q>p-10)m--,p=Math.max(q-5,g.x);else break;q=g.y-10+d;n=p+c;p=g.y+d;a.Je===Ng?P(b,n,p,!1,!1):Q(b,l,q,n,q,n,p)}else if(K.I(f.x,g.x))if(f.y<g.y)for(m=0;m<k;){n=Math.max(f.y,Math.min(h[m++]-5,g.y-10));b.lineTo(g.x+c,n+d);l=n+d;for(p=Math.min(n+10,g.y);m<k;)if(q=h[m],q<p+10)m++,p=Math.min(q+5,g.y);else break;q=g.x-10+c;n=g.x+c;p+=d;a.Je===Ng?P(b,n,p,!1,!1):Q(b,q,l,q,p,n,p)}else for(m=k-1;0<=m;){n=Math.min(f.y,Math.max(h[m--]+5,g.y+10));b.lineTo(g.x+c,n+d);l=n+d;for(p=Math.max(n-10,g.y);0<=
m;)if(q=h[m],q>p-10)m--,p=Math.max(q-5,g.y);else break;q=g.x-10+c;n=g.x+c;p+=d;a.Je===Ng?P(b,n,p,!1,!1):Q(b,q,l,q,p,n,p)}}b.lineTo(g.x+c,g.y+d)}
function An(a,b,c,d){var f=a.h;if(null===f||b.O(c))return 0;for(f=f.pn;f.next();){var g=f.value;if(null!==g&&g.visible)for(var g=g.mb.n,h=g.length,k=0;k<h;k++){var l=g[k];if(l===a)return 0<d.length&&d.sort(function(a,b){return a-b}),d.length;if(l instanceof B&&l.Wa()&&en(l)){var m=l.Ij();m.P()&&a.Ij().Xf(m)&&!a.usesSamePort(l)&&(m=l.path,null!==m&&m.Cl()&&Bn(b,c,d,l))}}}0<d.length&&d.sort(function(a,b){return a-b});return d.length}
function Bn(a,b,c,d){for(var f=K.I(a.y,b.y),g=d.ra,h=d.o(0),k=t.N(),l=1;l<g;l++){var m=d.o(l);if(l<g-1){var n=d.o(l+1);if(h.y===m.y&&m.y===n.y){if(m.x>h.x&&n.x>m.x||m.x<h.x&&n.x<m.x)m=n,l++}else h.x===m.x&&m.x===n.x&&(m.y>h.y&&n.y>m.y||m.y<h.y&&n.y<m.y)&&(m=n,l++)}a:{var n=k,p=a.x,q=a.y,r=b.x,s=b.y,u=h.x,h=h.y,w=m.x,D=m.y;if(!K.I(p,r)){if(K.I(q,s)&&K.I(u,w)&&Math.min(p,r)<u&&Math.max(p,r)>u&&Math.min(h,D)<q&&Math.max(h,D)>q&&!K.I(h,D)){n.x=u;n.y=q;n=!0;break a}}else if(!K.I(q,s)&&K.I(h,D)&&Math.min(q,
s)<h&&Math.max(q,s)>h&&Math.min(u,w)<p&&Math.max(u,w)>p&&!K.I(u,w)){n.x=p;n.y=h;n=!0;break a}n.x=0;n.y=0;n=!1}n&&(f?c.push(k.x):c.push(k.y));h=m}t.B(k)}t.A(B,{ut:"firstPickIndex"},function(){return 2>=this.ra?0:this.pc||hn(this)!==Tb?1:0});t.A(B,{nx:"lastPickIndex"},function(){var a=this.ra;return 0===a?0:2>=a?a-1:this.pc||jn(this)!==Tb?a-2:a-1});function en(a){a=a.Je;return a===Mg||a===Ng}function gn(a,b){if(b||en(a)){var c=a.h;null===c||c.co.contains(a)||null===a.Bz||c.co.add(a,a.Bz)}}
function Pg(a,b){var c=a.layer;if(null!==c&&c.visible&&!c.Dc){var d=c.h;if(null!==d)for(var f=!1,d=d.pn;d.next();){var g=d.value;if(g.visible)if(g===c)for(var f=!0,h=!1,g=g.mb.n,k=g.length,l=0;l<k;l++){var m=g[l];m instanceof B&&(m===a?h=!0:h&&Cn(a,m,b))}else if(f)for(g=g.mb.n,k=g.length,l=0;l<k;l++)m=g[l],m instanceof B&&Cn(a,m,b)}}}function Cn(a,b,c){if(null!==b&&en(b)&&null!==b.Ta){var d=b.Ij();d.P()&&(a.Ij().Xf(d)||c.Xf(d))&&(a.usesSamePort(b)||b.df())}}
B.prototype.usesSamePort=function(a){var b=this.ra,c=a.ra;if(0<b&&0<c){if(this.o(0).yf(a.o(0))||this.o(b-1).yf(a.o(c-1)))return!0}else if(this.ca===a.ca||this.fa===a.fa)return!0;return!1};B.prototype.sh=function(a){x.prototype.sh.call(this,a);a&&this.updateRoute();if(null!==this.Ce)for(var b=this.Ce.k;b.next();)b.value.sh(a)};t.g(B,"adjusting",B.prototype.Yo);
t.defineProperty(B,{Yo:"adjusting"},function(){return this.zq},function(a){var b=this.zq;b!==a&&(e&&t.Fa(a,B,B,"adjusting"),this.zq=a,this.j("adjusting",b,a))});t.g(B,"corner",B.prototype.Gw);t.defineProperty(B,{Gw:"corner"},function(){return this.Mq},function(a){var b=this.Mq;b!==a&&(e&&t.i(a,"number",B,"corner"),this.Mq=a,this.df(),this.j("corner",b,a))});t.g(B,"curve",B.prototype.Je);
t.defineProperty(B,{Je:"curve"},function(){return this.Pq},function(a){var b=this.Pq;b!==a&&(e&&t.Fa(a,B,B,"curve"),this.Pq=a,this.hc(),gn(this,b===Ng||b===Mg||a===Ng||a===Mg),this.j("curve",b,a))});t.g(B,"curviness",B.prototype.kt);t.defineProperty(B,{kt:"curviness"},function(){return this.Qq},function(a){var b=this.Qq;b!==a&&(e&&t.i(a,"number",B,"curviness"),this.Qq=a,this.hc(),this.j("curviness",b,a))});t.g(B,"routing",B.prototype.au);
t.defineProperty(B,{au:"routing"},function(){return this.Bm},function(a){var b=this.Bm;b!==a&&(e&&t.Fa(a,B,B,"routing"),this.Bm=a,this.Hi=null,this.hc(),gn(this,2===(b.value&2)||2===(a.value&2)),this.j("routing",b,a))});t.g(B,"smoothness",B.prototype.En);t.defineProperty(B,{En:"smoothness"},function(){return this.Ds},function(a){var b=this.Ds;b!==a&&(e&&t.i(a,"number",B,"smoothness"),this.Ds=a,this.df(),this.j("smoothness",b,a))});
function cn(a){var b=a.kg;if(null!==b){var c=a.wg;if(null!==c){var d=a.Nh,f=a.ci;a:{if(null!==c&&null!==b.Dh)for(a=b.Dh.k;a.next();){var g=a.value;if(g.Up===b&&g.Qt===c&&g.wx===d&&g.xx===f||g.Up===c&&g.Qt===b&&g.wx===f&&g.xx===d){a=g;break a}}a=null}for(var h=g=null,k=b.sc.n,l=k.length,m=0;m<l;m++){var n=k[m];if(n.kg===b&&n.Nh===d&&n.wg===c&&n.ci===f||n.kg===c&&n.Nh===f&&n.wg===b&&n.ci===d)null===h?h=n:(null===g&&(g=new H(B),g.add(h)),g.add(n))}if(null!==g)for(null===a&&(a=new Mm,a.Up=b,a.wx=d,a.Qt=
c,a.xx=f,Lm(b,a),Lm(c,a)),a.links=g,m=0;m<g.count;m++)if(n=g.n[m],0===n.nf){b=1;for(c=0;c<g.count;c++)Math.abs(g.n[c].nf)===b&&(b++,c=-1);n.On=a;n.nf=n.ca===a.Up?b:-b;b=n.h;(null===b||b.rf)&&n.hc()}}}}
function bn(a){var b=a.On;if(null!==b){var c=a.nf;a.On=null;a.nf=0;b.links.remove(a);if(2>b.links.count)1===b.links.count&&(c=b.links.n[0],c.On=null,c.nf=0,c.hc()),c=b.Up,null!==b&&null!==c.Dh&&c.Dh.remove(b),c=b.Qt,null!==b&&null!==c.Dh&&c.Dh.remove(b);else for(c=Math.abs(c),a=0===c%2,b=b.links.k;b.next();){var d=b.value,f=Math.abs(d.nf),g=0===f%2;f>c&&a===g&&(d.nf=0<d.nf?d.nf-2:d.nf+2,d.hc())}}}function Mm(){t.Fc(this);this.links=this.xx=this.Qt=this.wx=this.Up=null}
t.ce(Mm,{Up:!0,wx:!0,Qt:!0,xx:!0,links:!0,spacing:!0});function Rj(){t.Fc(this);this.group=null;this.Ap=!0;this.abort=!1;this.Pf=this.Of=1;this.Jr=this.Ir=-1;this.xd=this.Fd=8;this.rc=null;this.nH=!1;this.KG=22;this.KF=111}t.ce(Rj,{group:!0,Ap:!0,abort:!0,nH:!0,KG:!0,KF:!0});var ja=0,un=1,vn=1,ka=999999999,Dn=ka;
Rj.prototype.initialize=function(a){if(!(0>=a.width||0>=a.height)){var b=a.y,c=a.x+a.width,d=a.y+a.height;this.Of=Math.floor((a.x-this.Fd)/this.Fd)*this.Fd;this.Pf=Math.floor((b-this.xd)/this.xd)*this.xd;this.Ir=Math.ceil((c+2*this.Fd)/this.Fd)*this.Fd;this.Jr=Math.ceil((d+2*this.xd)/this.xd)*this.xd;a=1+(Math.ceil((this.Ir-this.Of)/this.Fd)|0);b=1+(Math.ceil((this.Jr-this.Pf)/this.xd)|0);if(null===this.rc||this.Lm<a-1||this.Mm<b-1){c=[];for(d=0;d<=a;d++){for(var f=[],g=0;g<=b;g++)f[g]=0;c[d]=f}this.rc=
c;this.Lm=a-1;this.Mm=b-1}if(null!==this.rc)for(a=0;a<=this.Lm;a++)for(b=0;b<=this.Mm;b++)this.rc[a][b]=Dn}};t.A(Rj,{Tb:null},function(){return new F(this.Of,this.Pf,this.Ir-this.Of,this.Jr-this.Pf)});t.g(Rj,"cellWidth",Rj.prototype.Vm);t.defineProperty(Rj,{Vm:null},function(){return this.Fd},function(a){0<a&&a!==this.Fd&&(this.Fd=a,this.initialize(this.Tb))});t.g(Rj,"cellHeight",Rj.prototype.Um);t.defineProperty(Rj,{Um:null},function(){return this.xd},function(a){0<a&&a!==this.xd&&(this.xd=a,this.initialize(this.Tb))});
function En(a,b,c){return a.Of<=b&&b<=a.Ir&&a.Pf<=c&&c<=a.Jr}function sn(a,b,c){if(!En(a,b,c))return 0;b-=a.Of;b/=a.Fd;c-=a.Pf;c/=a.xd;return a.rc[b|0][c|0]}function Uj(a,b,c){En(a,b,c)&&(b-=a.Of,b/=a.Fd,c-=a.Pf,c/=a.xd,a.rc[b|0][c|0]=ja)}function Tj(a){if(null!==a.rc)for(var b=0;b<=a.Lm;b++)for(var c=0;c<=a.Mm;c++)a.rc[b][c]>=un&&(a.rc[b][c]|=ka)}
function qn(a,b,c,d,f){if(b>a.Ir||b+d<a.Of||c>a.Jr||c+f<a.Pf)return!0;b=(b-a.Of)/a.Fd|0;c=(c-a.Pf)/a.xd|0;d=Math.max(0,d)/a.Fd+1|0;var g=Math.max(0,f)/a.xd+1|0;0>b&&(d+=b,b=0);0>c&&(g+=c,c=0);if(0>d||0>g)return!0;f=Math.min(b+d-1,a.Lm)|0;for(d=Math.min(c+g-1,a.Mm)|0;b<=f;b++)for(g=c;g<=d;g++)if(a.rc[b][g]===ja)return!1;return!0}
function Fn(a,b,c,d,f,g,h,k,l){if(!(b<g||b>h||c<k||c>l)){var m,n;m=b|0;n=c|0;var p=a.rc[m][n];if(p>=un&&p<ka)for(f?n+=d:m+=d,p+=vn;g<=m&&m<=h&&k<=n&&n<=l&&!(p>=a.rc[m][n]);)a.rc[m][n]=p,p+=vn,f?n+=d:m+=d;m=f?n:m;if(f)if(0<d)for(c+=d;c<m;c+=d)Fn(a,b,c,1,!f,g,h,k,l),Fn(a,b,c,-1,!f,g,h,k,l);else for(c+=d;c>m;c+=d)Fn(a,b,c,1,!f,g,h,k,l),Fn(a,b,c,-1,!f,g,h,k,l);else if(0<d)for(b+=d;b<m;b+=d)Fn(a,b,c,1,!f,g,h,k,l),Fn(a,b,c,-1,!f,g,h,k,l);else for(b+=d;b>m;b+=d)Fn(a,b,c,1,!f,g,h,k,l),Fn(a,b,c,-1,!f,g,h,
k,l)}}function Gn(a,b,c,d,f,g,h,k,l,m,n){for(var p=b|0,q=c|0,r=a.rc[p][q];0===r&&p>k&&p<l&&q>m&&q<n;)if(h?q+=g:p+=g,r=a.rc[p][q],1>=Math.abs(p-d)&&1>=Math.abs(q-f))return a.abort=!0,0;p=b|0;q=c|0;r=a.rc[p][q];b=un;for(a.rc[p][q]=b;0===r&&p>k&&p<l&&q>m&&q<n;)h?q+=g:p+=g,r=a.rc[p][q],a.rc[p][q]=b,b+=vn;return h?q:p}
function rn(a,b,c,d,f,g){if(null!==a.rc){a.abort=!1;var h=b.x,k=b.y;if(En(a,h,k)){var h=h-a.Of,h=h/a.Fd,k=k-a.Pf,k=k/a.xd,l=d.x,m=d.y;if(En(a,l,m))if(l-=a.Of,l/=a.Fd,m-=a.Pf,m/=a.xd,1>=Math.abs(h-l)&&1>=Math.abs(k-m))a.abort=!0;else{var n=g.x;b=g.y;d=g.x+g.width;var p=g.y+g.height,n=n-a.Of,n=n/a.Fd;b-=a.Pf;b/=a.xd;d-=a.Of;d/=a.Fd;p-=a.Pf;p/=a.xd;g=Math.max(0,Math.min(a.Lm,n|0));d=Math.min(a.Lm,Math.max(0,d|0));b=Math.max(0,Math.min(a.Mm,b|0));var p=Math.min(a.Mm,Math.max(0,p|0)),h=h|0,k=k|0,l=l|0,
m=m|0,n=h,q=k,r=0===c||90===c?1:-1;(c=90===c||270===c)?q=Gn(a,h,k,l,m,r,c,g,d,b,p):n=Gn(a,h,k,l,m,r,c,g,d,b,p);if(!a.abort){a:{c=0===f||90===f?1:-1;f=90===f||270===f;for(var r=l|0,s=m|0,u=a.rc[r][s];0===u&&r>g&&r<d&&s>b&&s<p;)if(f?s+=c:r+=c,u=a.rc[r][s],1>=Math.abs(r-h)&&1>=Math.abs(s-k)){a.abort=!0;break a}r=l|0;s=m|0;u=a.rc[r][s];for(a.rc[r][s]=Dn;0===u&&r>g&&r<d&&s>b&&s<p;)f?s+=c:r+=c,u=a.rc[r][s],a.rc[r][s]=Dn}a.abort||(Fn(a,n,q,1,!1,g,d,b,p),Fn(a,n,q,-1,!1,g,d,b,p),Fn(a,n,q,1,!0,g,d,b,p),Fn(a,
n,q,-1,!0,g,d,b,p))}}}}}function mn(){t.Fc(this);this.port=this.Jc=null;this.Mg=[];this.Tp=!1}t.ce(mn,{Jc:!0,port:!0,Mg:!0,Tp:!0});mn.prototype.toString=function(){for(var a=this.Mg,b=this.Jc.toString()+" "+a.length.toString()+":",c=0;c<a.length;c++){var d=a[c];null!==d&&(b+="\n  "+d.toString())}return b};
function Hn(a,b,c,d){b=b.offsetY;switch(b){case t.Wc:return 90;case t.Mc:return 180;case t.gd:return 270;case t.Xc:return 0}switch(b){case t.Wc|t.gd:return 180<c?270:90;case t.Mc|t.Xc:return 90<c&&270>=c?180:0}a=180*Math.atan2(a.height,a.width)/Math.PI;switch(b){case t.Mc|t.gd:return c>a&&c<=180+a?180:270;case t.gd|t.Xc:return c>180-a&&c<=360-a?270:0;case t.Xc|t.Wc:return c>a&&c<=180+a?90:0;case t.Wc|t.Mc:return c>180-a&&c<=360-a?180:90;case t.Mc|t.gd|t.Xc:return 90<c&&c<=180+a?180:c>180+a&&c<=360-
a?270:0;case t.gd|t.Xc|t.Wc:return 180<c&&c<=360-a?270:c>a&&180>=c?90:0;case t.Xc|t.Wc|t.Mc:return c>a&&c<=180-a?90:c>180-a&&270>=c?180:0;case t.Wc|t.Mc|t.gd:return c>180-a&&c<=180+a?180:c>180+a?270:90}d&&b!==(t.Mc|t.gd|t.Xc|t.Wc)&&(c-=15,0>c&&(c+=360));return c>a&&c<180-a?90:c>=180-a&&c<=180+a?180:c>180+a&&c<360-a?270:0}
function nn(a,b){var c=a.Mg;if(0===c.length){a:if(!a.Tp){c=a.Tp;a.Tp=!0;var d,f=null,g=a.Jc;if(g instanceof z&&!g.xe){if(!g.pa.P()){a.Tp=c;break a}f=g;d=f.ZE()}else d=a.Jc.$E();var h=a.Mg.length=0,k=a.port.wb(Vb,t.N()),l=a.port.wb(bc,t.N()),g=t.wk(k.x,k.y,0,0);g.xj(l);t.B(k);t.B(l);k=t.qc(g.x+g.width/2,g.y+g.height/2);for(d=d.k;d.next();)if(l=d.value,l.Wa()){var m=Tb,n=l.sd===a.port||l.ca.Al(f),m=n?hn(l,a.port):jn(l,a.port);if(m.Ep()&&(n=n?l.Vd:l.sd,null!==n)){var p=n.U;if(null!==p){var n=l.computeOtherPoint(p,
n),p=k.mj(n),m=Hn(g,m,p,l.pc),q;0===m?(q=t.Xc,180<p&&(p-=360)):q=90===m?t.Wc:180===m?t.Mc:t.gd;(m=a.Mg[h])?(m.link=l,m.angle=p,m.je=q):(m=new In(l,p,q),a.Mg[h]=m);m.vx.set(n);h++}}}t.B(k);a.Mg.sort(mn.prototype.OJ);f=a.Mg.length;k=-1;for(h=d=0;h<f;h++)m=a.Mg[h],null!==m&&(m.je!==k&&(k=m.je,d=0),m.yp=d,d++);k=-1;d=0;for(h=f-1;0<=h;h--)m=a.Mg[h],null!==m&&(m.je!==k&&(k=m.je,d=m.yp+1),m.$m=d);h=a.Mg;n=a.port;f=a.Jc.$J;k=t.N();d=t.N();l=t.N();m=t.N();n.wb(Vb,k);n.wb(Xb,d);n.wb(bc,l);n.wb($b,m);var r=
q=p=n=0;if(f===Km)for(var s=0;s<h.length;s++){var u=h[s];if(null!==u){var w=u.link.computeThickness();switch(u.je){case t.Wc:q+=w;break;case t.Mc:r+=w;break;case t.gd:n+=w;break;default:case t.Xc:p+=w}}}for(var D=0,A,G,M=0,N=G=0,O=1,s=0;s<h.length;s++)if(u=h[s],null!==u){if(D!=u.je){D=u.je;switch(D){case t.Wc:A=l;G=m;break;case t.Mc:A=m;G=k;break;case t.gd:A=k;G=d;break;default:case t.Xc:A=d,G=l}M=G.x-A.x;G=G.y-A.y;switch(D){case t.Wc:q>Math.abs(M)?(O=Math.abs(M)/q,q=Math.abs(M)):O=1;break;case t.Mc:r>
Math.abs(G)?(O=Math.abs(G)/r,r=Math.abs(G)):O=1;break;case t.gd:n>Math.abs(M)?(O=Math.abs(M)/n,n=Math.abs(M)):O=1;break;default:case t.Xc:p>Math.abs(G)?(O=Math.abs(G)/p,p=Math.abs(G)):O=1}N=0}var U=u.Kp;if(f===Km){w=u.link.computeThickness();w*=O;U.set(A);switch(D){case t.Wc:U.x=A.x+M/2+q/2-N-w/2;break;case t.Mc:U.y=A.y+G/2+r/2-N-w/2;break;case t.gd:U.x=A.x+M/2-n/2+N+w/2;break;default:case t.Xc:U.y=A.y+G/2-p/2+N+w/2}N+=w}else w=0.5,f===Hm&&(w=(u.yp+1)/(u.$m+1)),U.x=A.x+M*w,U.y=A.y+G*w}t.B(k);t.B(d);
t.B(l);t.B(m);A=a.Mg;for(h=0;h<A.length;h++)f=A[h],null!==f&&(f.Ow=a.computeEndSegmentLength(f));a.Tp=c;t.oc(g)}c=a.Mg}for(g=0;g<c.length;g++)if(A=c[g],null!==A&&A.link===b)return A;return null}mn.prototype.OJ=function(a,b){return a===b?0:null===a?-1:null===b?1:a.je<b.je?-1:a.je>b.je?1:a.angle<b.angle?-1:a.angle>b.angle?1:0};
mn.prototype.computeEndSegmentLength=function(a){var b=a.link,c=b.computeEndSegmentLength(this.Jc,this.port,Tb,b.sd===this.port),d=a.yp;if(0>d)return c;var f=a.$m;if(1>=f||!b.pc)return c;var b=a.vx,g=a.Kp;if(a.je===t.Mc||a.je===t.Wc)d=f-1-d;return((a=a.je===t.Mc||a.je===t.Xc)?b.y<g.y:b.x<g.x)?c+8*d:(a?b.y===g.y:b.x===g.x)?c:c+8*(f-1-d)};function In(a,b,c){this.link=a;this.angle=b;this.je=c;this.vx=new E;this.$m=this.yp=0;this.Kp=new E;this.Ow=0}
t.ce(In,{link:!0,angle:!0,je:!0,vx:!0,yp:!0,$m:!0,Kp:!0,Ow:!0});In.prototype.toString=function(){return this.link.toString()+" "+this.angle.toString()+" "+this.je.toString()+":"+this.yp.toString()+"/"+this.$m.toString()+" "+this.Kp.toString()+" "+this.Ow.toString()+" "+this.vx.toString()};
function z(a){0===arguments.length?y.call(this,gh):y.call(this,a);this.Lr=new I(x);this.um=new I(z);this.al=this.Mr=this.Kr=null;this.Ts=!1;this.pr=!0;this.Us=!1;this.Nb=this.Hs=null;this.Iq=!1;this.Jq=!0;this.Kq=!1;this.Yd=new Ae;this.Yd.group=this}t.ka("Group",z);t.Qa(z,y);
z.prototype.cloneProtected=function(a){y.prototype.cloneProtected.call(this,a);a.Kr=this.Kr;a.Mr=this.Mr;a.al=this.al;a.Ts=this.Ts;a.pr=this.pr;a.Us=this.Us;a.Hs=this.Hs;var b=a.qt(function(a){return a instanceof ah});a.Nb=b instanceof ah?b:null;a.Iq=this.Iq;a.Jq=this.Jq;a.Kq=this.Kq;null!==this.Yd?(a.Yd=this.Yd.copy(),a instanceof z&&(a.Yd.group=a)):(null!==a.Yd&&(a.Yd.group=null),a.Yd=null)};
z.prototype.ji=function(a){y.prototype.ji.call(this,a);var b=a.pp();for(a=a.Vc;a.next();){var c=a.value;c.ja();c.M(8);c.Uf();c instanceof z&&(c.Qx=c.xe,Jn(c,b));if(c instanceof y)c.Cf(b);else if(c instanceof B)for(c=c.sj;c.next();)c.value.Cf(b)}};
z.prototype.yn=function(a,b,c,d,f,g,h){if(a===Md&&"elements"===b)if(f instanceof ah)null===this.Nb?this.Nb=f:this.Nb!==f&&t.m("Cannot insert a second Placeholder into the visual tree of a Group.");else{if(f instanceof C){var k=f.qt(function(a){return a instanceof ah});k instanceof ah&&(null===this.Nb?this.Nb=k:this.Nb!==k&&t.m("Cannot insert a second Placeholder into the visual tree of a Group."))}}else a===Nd&&"elements"===b&&null!==this.Nb&&(d===this.Nb?this.Nb=null:d instanceof C&&this.Nb.rj(d)&&
(this.Nb=null));y.prototype.yn.call(this,a,b,c,d,f,g,h)};z.prototype.ik=function(a,b,c,d){this.$k=this.Nb;C.prototype.ik.call(this,a,b,c,d)};z.prototype.Bl=function(){if(!y.prototype.Bl.call(this))return!1;for(var a=this.Vc;a.next();){var b=a.value;if(b instanceof y){if(b.Wa()&&Vi(b))return!1}else if(b instanceof B&&b.Wa()&&Vi(b)&&b.ca!==this&&b.fa!==this)return!1}return!0};t.A(z,{placeholder:"placeholder"},function(){return this.Nb});t.g(z,"computesBoundsAfterDrag",z.prototype.hA);
t.defineProperty(z,{hA:"computesBoundsAfterDrag"},function(){return this.Iq},function(a){var b=this.Iq;b!==a&&(t.i(a,"boolean",z,"computesBoundsAfterDrag"),this.Iq=a,this.j("computesBoundsAfterDrag",b,a))});t.g(z,"computesBoundsIncludingLinks",z.prototype.zE);t.defineProperty(z,{zE:"computesBoundsIncludingLinks"},function(){return this.Jq},function(a){t.i(a,"boolean",z,"computesBoundsIncludingLinks");var b=this.Jq;b!==a&&(this.Jq=a,this.j("computesBoundsIncludingLinks",b,a))});
t.g(z,"computesBoundsIncludingLocation",z.prototype.AE);t.defineProperty(z,{AE:"computesBoundsIncludingLocation"},function(){return this.Kq},function(a){t.i(a,"boolean",z,"computesBoundsIncludingLocation");var b=this.Kq;b!==a&&(this.Kq=a,this.j("computesBoundsIncludingLocation",b,a))});t.A(z,{Vc:"memberParts"},function(){return this.Lr.k});
function Dm(a,b){if(a.Lr.add(b)){b instanceof z&&a.um.add(b);var c=a.VF;if(null!==c){var d=!0,f=a.h;null!==f&&(d=f.Sa,f.Sa=!0);c(a,b);null!==f&&(f.Sa=d)}}c=a.Nb;null===c&&(c=a);c.ja()}function Cm(a,b){if(a.Lr.remove(b)){b instanceof z&&a.um.remove(b);var c=a.WF;if(null!==c){var d=!0,f=a.h;null!==f&&(d=f.Sa,f.Sa=!0);c(a,b);null!==f&&(f.Sa=d)}}c=a.Nb;null===c&&(c=a);c.ja()}z.prototype.cn=function(){if(0<this.Lr.count){var a=this.h;if(null===a)return;for(var b=this.Lr.copy().k;b.next();)a.remove(b.value)}y.prototype.cn.call(this)};
z.prototype.Kx=function(){var a=this.layer;null!==a&&a.Kx(this)};t.g(z,"layout",z.prototype.ic);t.defineProperty(z,{ic:"layout"},function(){return this.Yd},function(a){var b=this.Yd;b!==a&&(null!==a&&t.l(a,Ae,z,"layout"),null!==b&&(b.h=null,b.group=null),this.Yd=a,null!==a&&(a.h=this.h,a.group=this),this.j("layout",b,a))});t.g(z,"memberAdded",z.prototype.VF);
t.defineProperty(z,{VF:"memberAdded"},function(){return this.Kr},function(a){var b=this.Kr;b!==a&&(null!==a&&t.i(a,"function",z,"memberAdded"),this.Kr=a,this.j("memberAdded",b,a))});t.g(z,"memberRemoved",z.prototype.WF);t.defineProperty(z,{WF:"memberRemoved"},function(){return this.Mr},function(a){var b=this.Mr;b!==a&&(null!==a&&t.i(a,"function",z,"memberRemoved"),this.Mr=a,this.j("memberRemoved",b,a))});t.g(z,"memberValidation",z.prototype.Lt);
t.defineProperty(z,{Lt:"memberValidation"},function(){return this.al},function(a){var b=this.al;b!==a&&(null!==a&&t.i(a,"function",z,"memberValidation"),this.al=a,this.j("memberValidation",b,a))});z.prototype.canAddMembers=function(a){var b=this.h;if(null===b)return!1;b=b.Ye;for(a=ff(a).k;a.next();)if(!b.isValidMember(this,a.value))return!1;return!0};
z.prototype.addMembers=function(a,b){var c=this.h;if(null===c)return!1;for(var c=c.Ye,d=!0,f=ff(a).k;f.next();){var g=f.value;!b||c.isValidMember(this,g)?g.fb=this:d=!1}return d};t.g(z,"ungroupable",z.prototype.cH);t.defineProperty(z,{cH:"ungroupable"},function(){return this.Ts},function(a){var b=this.Ts;b!==a&&(t.i(a,"boolean",z,"ungroupable"),this.Ts=a,this.j("ungroupable",b,a))});
z.prototype.canUngroup=function(){if(!this.cH)return!1;var a=this.layer;if(null!==a&&!a.dp)return!1;a=a.h;return null===a||a.dp?!0:!1};z.prototype.invalidateConnectedLinks=z.prototype.Cf=function(a){void 0===a&&(a=null);y.prototype.Cf.call(this,a);for(var b=this.ZE();b.next();){var c=b.value;if(null===a||!a.contains(c)){var d=c.ca;null!==d&&d.Al(this)&&!d.Wa()?c.hc():(d=c.fa,null!==d&&d.Al(this)&&!d.Wa()&&c.hc())}}};
z.prototype.findExternalLinksConnected=z.prototype.ZE=function(){var a=this.pp();a.add(this);for(var b=new I(B),c=a.k;c.next();){var d=c.value;if(d instanceof y)for(d=d.Td;d.next();){var f=d.value;a.contains(f)||b.add(f)}}return b.k};z.prototype.findExternalNodesConnected=function(){var a=this.pp();a.add(this);for(var b=new I(y),c=a.k;c.next();){var d=c.value;if(d instanceof y)for(d=d.Td;d.next();){var f=d.value,g=f.ca;a.contains(g)&&g!==this||b.add(g);f=f.fa;a.contains(f)&&f!==this||b.add(f)}}return b.k};
z.prototype.findSubGraphParts=z.prototype.pp=function(){var a=new I(x);af(a,this,!0,0);a.remove(this);return a};z.prototype.collapseSubGraph=z.prototype.collapseSubGraph=function(){var a=this.h;if(null!==a&&!a.ee){a.ee=!0;var b=this.pp();Jn(this,b);a.ee=!1}};function Jn(a,b){a.xe=!1;for(var c=a.Vc;c.next();){var d=c.value;d.sh(!1);d instanceof z&&(d.Qx=d.xe,Jn(d,b));if(d instanceof y)d.Cf(b);else if(d instanceof B)for(d=d.sj;d.next();)d.value.Cf(b)}}
z.prototype.expandSubGraph=z.prototype.expandSubGraph=function(){var a=this.h;if(null!==a&&!a.ee){var b=a.mc;0!==a.ma.Qe&&b.Gl();a.ee=!0;var c=this.pp();Kn(this,c,b,this);a.ee=!1}};function Kn(a,b,c,d){a.xe=!0;for(a=a.Vc;a.next();){var f=a.value;f.ja();f.sh(!0);f instanceof z&&f.Qx&&Kn(f,b,c,d);if(f instanceof y)f.Cf(b),Vh(c,f,d);else if(f instanceof B)for(f=f.sj;f.next();)f.value.Cf(b)}}t.g(z,"isSubGraphExpanded",z.prototype.xe);
t.defineProperty(z,{xe:"isSubGraphExpanded"},function(){return this.pr},function(a){var b=this.pr;if(b!==a){t.i(a,"boolean",z,"isSubGraphExpanded");this.pr=a;var c=this.h;this.j("isSubGraphExpanded",b,a);b=this.QG;if(null!==b){var d=!0;null!==c&&(d=c.Sa,c.Sa=!0);b(this);null!==c&&(c.Sa=d)}null!==c&&c.ma.yb||(a?this.expandSubGraph():this.collapseSubGraph())}});t.g(z,"wasSubGraphExpanded",z.prototype.Qx);
t.defineProperty(z,{Qx:"wasSubGraphExpanded"},function(){return this.Us},function(a){var b=this.Us;b!==a&&(t.i(a,"boolean",z,"wasSubGraphExpanded"),this.Us=a,this.j("wasSubGraphExpanded",b,a))});t.g(z,"subGraphExpandedChanged",z.prototype.QG);t.defineProperty(z,{QG:"subGraphExpandedChanged"},function(){return this.Hs},function(a){var b=this.Hs;b!==a&&(null!==a&&t.i(a,"function",z,"subGraphExpandedChanged"),this.Hs=a,this.j("subGraphExpandedChanged",b,a))});
z.prototype.move=z.prototype.move=function(a){var b=this.position,c=b.x;isNaN(c)&&(c=0);b=b.y;isNaN(b)&&(b=0);var c=a.x-c,b=a.y-b,d=t.qc(c,b);y.prototype.move.call(this,a);for(a=this.pp().k;a.next();){var f=a.value;if(!(f instanceof B||f.ni)){var g=f.position;d.x=g.x+c;d.y=g.y+b;y.prototype.move.call(f,d)}}for(a.reset();a.next();)f=a.value,f instanceof B&&(g=f.position,d.x=g.x+c,d.y=g.y+b,f.move(d));t.B(d)};function ah(){V.call(this);this.Te=K.tq;this.qs=new F(NaN,NaN,NaN,NaN)}
t.ka("Placeholder",ah);t.Qa(ah,V);ah.prototype.cloneProtected=function(a){V.prototype.cloneProtected.call(this,a);a.Te=this.Te.ba();a.qs=this.qs.copy()};ah.prototype.jk=function(a){if(null===this.background&&null===this.hk)return!1;var b=this.Ja;return Gb(0,0,b.width,b.height,a.x,a.y)};
ah.prototype.Kt=function(){var a=this.U;null!==a&&(a instanceof z||a instanceof ea)||t.m("Placeholder is not inside a Group or Adornment.");if(a instanceof z){var b=this.computeBorder(this.qs),c=this.nd;ub(c,b.width||0,b.height||0);kk(this,0,0,c.width,c.height);for(var c=a.Vc,d=!1;c.next();)if(c.value.Wa()){d=!0;break}!d||isNaN(b.x)||isNaN(b.y)||(c=new E,c.eu(b,a.gf),a.location=new E(c.x,c.y))}else{var b=this.Ea,c=this.nd,a=this.padding,d=a.left+a.right,f=a.top+a.bottom;if(b.P())ub(c,b.width+d||0,
b.height+f||0),kk(this,-a.left,-a.top,c.width,c.height);else{var g=this.U,h=g.uc,k=h.wb(Vb,t.N()),b=t.wk(k.x,k.y,0,0);b.xj(h.wb(bc,k));b.xj(h.wb(Xb,k));b.xj(h.wb($b,k));g.hh.p(b.x,b.y);ub(c,b.width+d||0,b.height+f||0);kk(this,-a.left,-a.top,c.width,c.height);t.B(k);t.oc(b)}}};ah.prototype.ik=function(a,b,c,d){var f=this.pa;f.x=a;f.y=b;f.width=c;f.height=d};
ah.prototype.computeBorder=function(a){var b=this.U;if(b instanceof z&&b.hA&&this.qs.P()){var c=b.h;if(null!==c&&(c=c.Ya,c instanceof lf&&!c.Wq&&null!==c.Hc&&!c.Hc.contains(b)))return a.assign(this.qs),a}var c=t.Jf(),d=this.computeMemberBounds(c),f=this.padding;a.p(d.x-f.left,d.y-f.top,d.width+f.left+f.right,d.height+f.top+f.bottom);t.oc(c);b instanceof z&&b.AE&&b.location.P()&&a.xj(b.location);return a};
ah.prototype.computeMemberBounds=function(a){var b=this.U;if(!(b instanceof z))return a.p(0,0,0,0),a;for(var c=Infinity,d=Infinity,f=-Infinity,g=-Infinity,h=b.Vc;h.next();){var k=h.value;if(k.Wa()){if(k instanceof B){if(!b.zE)continue;if(Ui(k))continue;if(k.ca===b||k.fa===b)continue}k=k.pa;k.left<c&&(c=k.left);k.top<d&&(d=k.top);k.right>f&&(f=k.right);k.bottom>g&&(g=k.bottom)}}isFinite(c)&&isFinite(d)?a.p(c,d,f-c,g-d):(b=b.location,c=this.padding,a.p(b.x+c.left,b.y+c.top,0,0));return a};
t.g(ah,"padding",ah.prototype.padding);t.defineProperty(ah,{padding:"padding"},function(){return this.Te},function(a){"number"===typeof a?(0>a&&t.ha(a,">= 0",ah,"padding"),a=new wb(a)):(t.l(a,wb,ah,"padding"),0>a.left&&t.ha(a.left,">= 0",ah,"padding:val.left"),0>a.right&&t.ha(a.right,">= 0",ah,"padding:val.right"),0>a.top&&t.ha(a.top,">= 0",ah,"padding:val.top"),0>a.bottom&&t.ha(a.bottom,">= 0",ah,"padding:val.bottom"));var b=this.Te;b.O(a)||(this.Te=a=a.ba(),this.j("padding",b,a))});
function Ae(){0<arguments.length&&t.fd(Ae);t.Fc(this);this.iz=this.W=null;this.kr=this.mr=!0;this.ur=this.wo=!1;this.Bq=(new E(0,0)).freeze();this.nz=!0;this.xz=null;this.nr=!0}t.ka("Layout",Ae);Ae.prototype.cloneProtected=function(a){a.mr=this.mr;a.kr=this.kr;this.kr||(a.wo=!0);a.ur=this.ur;a.Bq.assign(this.Bq);a.nr=this.nr};Ae.prototype.copy=function(){var a=new this.constructor;this.cloneProtected(a);return a};
Ae.prototype.toString=function(){var a=t.Dg(Object.getPrototypeOf(this)),a=a+"(";null!==this.group&&(a+=" in "+this.group);null!==this.h&&(a+=" for "+this.h);return a+")"};t.g(Ae,"diagram",Ae.prototype.h);t.defineProperty(Ae,{h:"diagram"},function(){return this.W},function(a){this.W!==a&&(null!==a&&t.l(a,v,Ae,"diagram"),this.W=a)});t.g(Ae,"group",Ae.prototype.group);
t.defineProperty(Ae,{group:"group"},function(){return this.iz},function(a){this.iz!==a&&(null!==a&&t.l(a,z,Ae,"group"),this.iz=a,null!==a&&(this.W=a.h))});t.g(Ae,"isOngoing",Ae.prototype.FF);t.defineProperty(Ae,{FF:"isOngoing"},function(){return this.mr},function(a){this.mr!==a&&(t.i(a,"boolean",Ae,"isOngoing"),this.mr=a)});t.g(Ae,"isInitial",Ae.prototype.EF);t.defineProperty(Ae,{EF:"isInitial"},function(){return this.kr},function(a){t.i(a,"boolean",Ae,"isInitial");this.kr=a;a||(this.wo=!0)});
t.g(Ae,"isValidLayout",Ae.prototype.ff);t.defineProperty(Ae,{ff:"isValidLayout"},function(){return this.wo},function(a){this.wo!==a&&(t.i(a,"boolean",Ae,"isValidLayout"),this.wo=a,a||(a=this.h,null!==a&&(a.Bu=!0)))});Ae.prototype.invalidateLayout=Ae.prototype.M=function(){if(this.wo){var a=this.h;if(null!==a&&!a.ma.yb){var b=a.mc;!b.qr&&(b.Eg&&b.iq(),this.FF&&a.rf||this.EF&&!a.rf)&&(this.ff=!1,a.ie())}}};t.g(Ae,"isRealtime",Ae.prototype.NA);
t.defineProperty(Ae,{NA:"isRealtime"},function(){return this.nr},function(a){this.nr!==a&&(t.i(a,"boolean",Ae,"isRealtime"),this.nr=a)});t.g(Ae,"isViewportSized",Ae.prototype.Gt);t.defineProperty(Ae,{Gt:"isViewportSized"},function(){return this.ur},function(a){this.ur!==a&&(t.i(a,"boolean",Ae,"isViewportSized"),(this.ur=a)&&this.M())});t.g(Ae,"isRouting",Ae.prototype.Ft);
t.defineProperty(Ae,{Ft:"isRouting"},function(){return this.nz},function(a){this.nz!==a&&(t.i(a,"boolean",Ae,"isRouting"),this.nz=a)});t.g(Ae,"network",Ae.prototype.network);t.defineProperty(Ae,{network:"network"},function(){return this.xz},function(a){var b=this.xz;b!==a&&(null!==a&&t.l(a,Ea,Ae,"network"),null!==b&&Ln(b,null),this.xz=a,null!==a&&Ln(a,this))});Ae.prototype.createNetwork=function(){var a=new Ea;Ln(a,this);return a};
Ae.prototype.makeNetwork=function(a){var b=this.createNetwork();a instanceof v?(b.Zs(a.vh,!0),b.Zs(a.links,!0)):a instanceof z?b.Zs(a.Vc):b.Zs(a.k);return b};Ae.prototype.updateParts=function(){var a=this.h;if(null===a&&null!==this.network)for(var b=this.network.vertexes.k;b.next();){var c=b.value.Jc;if(null!==c&&(a=c.h,null!==a))break}this.ff=!0;null!==a&&a.yc("Layout");this.commitLayout();null!==a&&a.Ie("Layout")};Ae.prototype.commitLayout=function(){};
Ae.prototype.doLayout=function(a){a||t.m("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts");var b=new I(x);a===this.h?(Mn(this,b,a.vh,!0,this.YA,!0,!1,!0),Mn(this,b,a.vj,!0,this.YA,!0,!1,!0)):a===this.group?Mn(this,b,a.Vc,!1,this.YA,!0,!1,!0):b.Ue(a.k);var c=b.count;if(0<c){a=this.h;null!==a&&a.yc("Layout");for(var c=Math.ceil(Math.sqrt(c)),d=this.Nd.x,f=d,g=this.Nd.y,h=0,k=0,b=b.k;b.next();){var l=b.value;l.xf();var m=l.Ha,n=m.width,m=m.height;
l.moveTo(f,g);delete l.jD;f+=Math.max(n,50)+20;k=Math.max(k,Math.max(m,50));h>=c-1?(h=0,f=d,g+=k+20,k=0):h++}null!==a&&a.Ie("Layout")}this.ff=!0};Ae.prototype.YA=function(a){return!a.location.P()||a instanceof z&&a.jD?!0:!1};function Mn(a,b,c,d,f,g,h,k){for(c=c.k;c.next();){var l=c.value;d&&!l.Fp||f&&!f(l)||l.canLayout()&&(g&&l instanceof y?l.ni||(l instanceof z&&null===l.ic?Mn(a,b,l.Vc,!1,f,g,h,k):b.add(l)):h&&l instanceof B?b.add(l):!k||!l.Rd()||l instanceof y||b.add(l))}}
t.g(Ae,"arrangementOrigin",Ae.prototype.Nd);t.defineProperty(Ae,{Nd:"arrangementOrigin"},function(){return this.Bq},function(a){t.l(a,E,Ae,"arrangementOrigin");this.Bq.O(a)||(this.Bq.assign(a),this.M())});Ae.prototype.initialOrigin=function(a){var b=this.group;if(null!==b){var c=b.location;if(isNaN(c.x)||isNaN(c.y))return a;a=b.placeholder;null!==a?(c=a.wb(Vb),c.x+=a.padding.left,c.y+=a.padding.top):c=b.position.copy();return c}return a};function Ea(){t.Fc(this);this.Yd=null;this.clear()}
t.ka("LayoutNetwork",Ea);Ea.prototype.clear=function(){if(this.vertexes)for(var a=this.vertexes.k;a.next();){var b=a.value;b.clear();b.network=null}if(this.edges)for(a=this.edges.k;a.next();)b=a.value,b.clear(),b.network=null;this.vertexes=new I(Fa);this.edges=new I(Ha);this.aB=new wa(y,Fa);this.PA=new wa(B,Ha)};Ea.prototype.toString=function(){return"LayoutNetwork"+(null!==this.ic?"("+this.ic.toString()+")":"")};t.A(Ea,{ic:"layout"},function(){return this.Yd});
function Ln(a,b){e&&null!==b&&t.l(b,Ae,Ea,"setLayout");a.Yd=b}Ea.prototype.createVertex=function(){return new Fa};Ea.prototype.createEdge=function(){return new Ha};
Ea.prototype.addParts=Ea.prototype.Zs=function(a,b){if(null!==a){void 0===b&&(b=!1);t.i(b,"boolean",Ea,"addParts:toplevelonly");for(var c=a.k;c.next();){var d=c.value;if(d instanceof y&&(!b||d.Fp)&&d.canLayout()&&!d.ni)if(d instanceof z&&null===d.ic)this.Zs(d.Vc,!1);else if(null===this.gn(d)){var f=this.createVertex();f.Jc=d;this.kl(f)}}for(c.reset();c.next();)if(d=c.value,d instanceof B&&(!b||d.Fp)&&d.canLayout()&&null===this.Pw(d)){var g=d.ca,f=d.fa;g!==f&&(g=this.findGroupVertex(g),f=this.findGroupVertex(f),
null!==g&&null!==f&&this.sn(g,f,d))}}};Ea.prototype.findGroupVertex=function(a){if(null===a)return null;var b=a.findVisibleNode();if(null===b)return null;a=this.gn(b);if(null!==a)return a;for(b=b.fb;null!==b;){a=this.gn(b);if(null!==a)return a;b=b.fb}return null};Ea.prototype.addVertex=Ea.prototype.kl=function(a){if(null!==a){e&&t.l(a,Fa,Ea,"addVertex:vertex");this.vertexes.add(a);var b=a.Jc;null!==b&&this.aB.add(b,a);a.network=this}};
Ea.prototype.addNode=Ea.prototype.Xo=function(a){if(null===a)return null;e&&t.l(a,y,Ea,"addNode:node");var b=this.gn(a);null===b&&(b=this.createVertex(),b.Jc=a,this.kl(b));return b};Ea.prototype.deleteVertex=Ea.prototype.PE=function(a){if(null!==a&&(e&&t.l(a,Fa,Ea,"deleteVertex:vertex"),Nn(this,a))){for(var b=a.lf,c=b.count-1;0<=c;c--){var d=b.wa(c);this.kp(d)}b=a.Ze;for(c=b.count-1;0<=c;c--)d=b.wa(c),this.kp(d)}};
function Nn(a,b){if(null===b)return!1;var c=a.vertexes.remove(b);c&&(a.aB.remove(b.Jc),b.network=null);return c}Ea.prototype.deleteNode=function(a){null!==a&&(e&&t.l(a,y,Ea,"deleteNode:node"),a=this.gn(a),null!==a&&this.PE(a))};Ea.prototype.findVertex=Ea.prototype.gn=function(a){if(null===a)return null;e&&t.l(a,y,Ea,"findVertex:node");return this.aB.Da(a)};
Ea.prototype.addEdge=Ea.prototype.Wo=function(a){if(null!==a){e&&t.l(a,Ha,Ea,"addEdge:edge");this.edges.add(a);var b=a.link;null!==b&&null===this.Pw(b)&&this.PA.add(b,a);b=a.toVertex;null!==b&&b.gE(a);b=a.fromVertex;null!==b&&b.eE(a);a.network=this}};
Ea.prototype.addLink=function(a){if(null===a)return null;e&&t.l(a,B,Ea,"addLink:link");var b=a.ca,c=a.fa,d=this.Pw(a);null===d?(d=this.createEdge(),d.link=a,null!==b&&(d.fromVertex=this.Xo(b)),null!==c&&(d.toVertex=this.Xo(c)),this.Wo(d)):(d.fromVertex=null!==b?this.Xo(b):null,d.toVertex=null!==c?this.Xo(c):null);return d};Ea.prototype.deleteEdge=Ea.prototype.kp=function(a){if(null!==a){e&&t.l(a,Ha,Ea,"deleteEdge:edge");var b=a.toVertex;null!==b&&b.OE(a);b=a.fromVertex;null!==b&&b.NE(a);On(this,a)}};
function On(a,b){null!==b&&a.edges.remove(b)&&(a.PA.remove(b.link),b.network=null)}Ea.prototype.deleteLink=function(a){null!==a&&(e&&t.l(a,B,Ea,"deleteLink:link"),a=this.Pw(a),null!==a&&this.kp(a))};Ea.prototype.findEdge=Ea.prototype.Pw=function(a){if(null===a)return null;e&&t.l(a,B,Ea,"findEdge:link");return this.PA.Da(a)};
Ea.prototype.linkVertexes=Ea.prototype.sn=function(a,b,c){if(null===a||null===b)return null;e&&(t.l(a,Fa,Ea,"linkVertexes:fromVertex"),t.l(b,Fa,Ea,"linkVertexes:toVertex"),null!==c&&t.l(c,B,Ea,"linkVertexes:link"));if(a.network===this&&b.network===this){var d=this.createEdge();d.link=c;d.fromVertex=a;d.toVertex=b;this.Wo(d);return d}return null};
Ea.prototype.reverseEdge=Ea.prototype.Cx=function(a){if(null!==a){e&&t.l(a,Ha,Ea,"reverseEdge:edge");var b=a.fromVertex,c=a.toVertex;null!==b&&null!==c&&(b.NE(a),c.OE(a),a.Cx(),b.gE(a),c.eE(a))}};Ea.prototype.deleteSelfEdges=Ea.prototype.Lw=function(){for(var a=t.Hb(),b=this.edges.k;b.next();){var c=b.value;c.fromVertex===c.toVertex&&a.push(c)}b=a.length;for(c=0;c<b;c++)this.kp(a[c]);t.Ca(a)};
Ea.prototype.deleteArtificialVertexes=function(){for(var a=t.Hb(),b=this.vertexes.k;b.next();){var c=b.value;null===c.Jc&&a.push(c)}c=a.length;for(b=0;b<c;b++)this.PE(a[b]);c=t.Hb();for(b=this.edges.k;b.next();){var d=b.value;null===d.link&&c.push(d)}d=c.length;for(b=0;b<d;b++)this.kp(c[b]);t.Ca(a);t.Ca(c)};function Pn(a){for(var b=t.Hb(),c=a.edges.k;c.next();){var d=c.value;null!==d.fromVertex&&null!==d.toVertex||b.push(d)}c=b.length;for(d=0;d<c;d++)a.kp(b[d]);t.Ca(b)}
Ea.prototype.splitIntoSubNetworks=Ea.prototype.qK=function(){this.deleteArtificialVertexes();Pn(this);this.Lw();for(var a=new H(Ea),b=!0;b;)for(var b=!1,c=this.vertexes.k;c.next();){var d=c.value;if(0<d.lf.count||0<d.Ze.count){b=this.ic.createNetwork();a.add(b);Qn(this,b,d);b=!0;break}}a.sort(function(a,b){return null===a||null===b||a===b?0:b.vertexes.count-a.vertexes.count});return a};
function Qn(a,b,c){if(null!==c&&c.network!==b){Nn(a,c);b.kl(c);for(var d=c.xc;d.next();){var f=d.value;f.network!==b&&(On(a,f),b.Wo(f),Qn(a,b,f.fromVertex))}for(d=c.nc;d.next();)f=d.value,f.network!==b&&(On(a,f),b.Wo(f),Qn(a,b,f.toVertex))}}Ea.prototype.findAllParts=function(){for(var a=new I(x),b=this.vertexes.k;b.next();)a.add(b.value.Jc);for(b=this.edges.k;b.next();)a.add(b.value.link);return a};
function Fa(){t.Fc(this);this.network=null;this.V=(new F(0,0,10,10)).freeze();this.Q=(new E(5,5)).freeze();this.clear()}t.ka("LayoutVertex",Fa);Fa.prototype.clear=function(){this.yd=null;this.lf=new H(Ha);this.Ze=new H(Ha)};Fa.prototype.toString=function(){return"LayoutVertex#"+t.ud(this)+(null!==this.Jc?"("+this.Jc.toString()+")":"")};t.g(Fa,"node",Fa.prototype.Jc);
t.defineProperty(Fa,{Jc:"node"},function(){return this.yd},function(a){if(this.yd!==a){e&&null!==a&&t.l(a,y,Fa,"node");this.yd=a;a.xf();var b=a.pa,c=b.x,d=b.y,f=b.width,b=b.height;isNaN(c)&&(c=0);isNaN(d)&&(d=0);this.V.p(c,d,f,b);if(!(a instanceof z)&&(a=a.Zb.wb(Yb),a.P())){this.Q.p(a.x-c,a.y-d);return}this.Q.p(f/2,b/2)}});t.g(Fa,"bounds",Fa.prototype.Tb);t.defineProperty(Fa,{Tb:"bounds"},function(){return this.V},function(a){this.V.O(a)||(e&&t.l(a,F,Fa,"bounds"),this.V.assign(a))});
t.g(Fa,"focus",Fa.prototype.focus);t.defineProperty(Fa,{focus:"focus"},function(){return this.Q},function(a){this.Q.O(a)||(e&&t.l(a,E,Fa,"focus"),this.Q.assign(a))});t.g(Fa,"centerX",Fa.prototype.Ia);t.defineProperty(Fa,{Ia:"centerX"},function(){return this.V.x+this.Q.x},function(a){var b=this.V;b.x+this.Q.x!==a&&(e&&t.q(a,Fa,"centerX"),b.Ra(),b.x=a-this.Q.x,b.freeze())});t.g(Fa,"centerY",Fa.prototype.Ua);
t.defineProperty(Fa,{Ua:"centerY"},function(){return this.V.y+this.Q.y},function(a){var b=this.V;b.y+this.Q.y!==a&&(e&&t.q(a,Fa,"centerY"),b.Ra(),b.y=a-this.Q.y,b.freeze())});t.g(Fa,"focusX",Fa.prototype.rp);t.defineProperty(Fa,{rp:"focusX"},function(){return this.Q.x},function(a){var b=this.Q;b.x!==a&&(b.Ra(),b.x=a,b.freeze())});t.g(Fa,"focusY",Fa.prototype.sp);t.defineProperty(Fa,{sp:"focusY"},function(){return this.Q.y},function(a){var b=this.Q;b.y!==a&&(b.Ra(),b.y=a,b.freeze())});t.g(Fa,"x",Fa.prototype.x);
t.defineProperty(Fa,{x:"x"},function(){return this.V.x},function(a){var b=this.V;b.x!==a&&(b.Ra(),b.x=a,b.freeze())});t.g(Fa,"y",Fa.prototype.y);t.defineProperty(Fa,{y:"y"},function(){return this.V.y},function(a){var b=this.V;b.y!==a&&(b.Ra(),b.y=a,b.freeze())});t.g(Fa,"width",Fa.prototype.width);t.defineProperty(Fa,{width:"width"},function(){return this.V.width},function(a){var b=this.V;b.width!==a&&(b.Ra(),b.width=a,b.freeze())});t.g(Fa,"height",Fa.prototype.height);
t.defineProperty(Fa,{height:"height"},function(){return this.V.height},function(a){var b=this.V;b.height!==a&&(b.Ra(),b.height=a,b.freeze())});Fa.prototype.commit=function(){var a=this.Jc;if(null!==a){var b=this.Tb;if(!(a instanceof z)){var c=a.pa,d=a.Zb.wb(Yb);if(c.P()&&d.P()){a.moveTo(b.x+this.rp-(d.x-c.x),b.y+this.sp-(d.y-c.y));return}}a.moveTo(b.x,b.y)}};Fa.prototype.addSourceEdge=Fa.prototype.gE=function(a){null!==a&&(e&&t.l(a,Ha,Fa,"addSourceEdge:edge"),this.lf.contains(a)||this.lf.add(a))};
Fa.prototype.deleteSourceEdge=Fa.prototype.OE=function(a){null!==a&&(e&&t.l(a,Ha,Fa,"deleteSourceEdge:edge"),this.lf.remove(a))};Fa.prototype.addDestinationEdge=Fa.prototype.eE=function(a){null!==a&&(e&&t.l(a,Ha,Fa,"addDestinationEdge:edge"),this.Ze.contains(a)||this.Ze.add(a))};Fa.prototype.deleteDestinationEdge=Fa.prototype.NE=function(a){null!==a&&(e&&t.l(a,Ha,Fa,"deleteDestinationEdge:edge"),this.Ze.remove(a))};
t.A(Fa,{nK:"sourceVertexes"},function(){for(var a=new I(Fa),b=this.xc;b.next();){var c=b.value.fromVertex;null===c||a.contains(c)||a.add(c)}return a.k});t.A(Fa,{NI:"destinationVertexes"},function(){for(var a=new I(Fa),b=this.nc;b.next();){var c=b.value.toVertex;null===c||a.contains(c)||a.add(c)}return a.k});
t.A(Fa,{vertexes:"vertexes"},function(){for(var a=new I(Fa),b=this.xc;b.next();){var c=b.value,c=c.fromVertex;null===c||a.contains(c)||a.add(c)}for(b=this.nc;b.next();)c=b.value,c=c.toVertex,null===c||a.contains(c)||a.add(c);return a.k});t.A(Fa,{xc:"sourceEdges"},function(){return this.lf.k});t.A(Fa,{nc:"destinationEdges"},function(){return this.Ze.k});t.A(Fa,{edges:"edges"},function(){for(var a=new H(Ha),b=this.xc;b.next();){var c=b.value;a.add(c)}for(b=this.nc;b.next();)c=b.value,a.add(c);return a.k});
t.A(Fa,{bJ:"edgesCount"},function(){return this.lf.count+this.Ze.count});var Rn;Fa.standardComparer=Rn=function(a,b){e&&t.l(a,Fa,Fa,"standardComparer:m");e&&t.l(b,Fa,Fa,"standardComparer:n");var c=a.yd,d=b.yd;return c?d?(c=c.text,d=d.text,c<d?-1:c>d?1:0):1:null!==d?-1:0};
Fa.smartComparer=function(a,b){e&&t.l(a,Fa,Fa,"smartComparer:m");e&&t.l(b,Fa,Fa,"smartComparer:n");if(null!==a){if(null!==b){var c=a.yd,d=b.yd;if(null!==c){if(null!==d){var c=c.text.toLocaleLowerCase().split(/([+\-]?[\.]?\d+(?:\.\d*)?(?:e[+\-]?\d+)?)/),d=d.text.toLocaleLowerCase().split(/([+\-]?[\.]?\d+(?:\.\d*)?(?:e[+\-]?\d+)?)/),f;for(f=0;f<c.length;f++)if(""!==d[f]&&void 0!==d[f]){var g=parseFloat(c[f]),h=parseFloat(d[f]);if(isNaN(g)){if(!isNaN(h))return 1;if(0!==c[f].localeCompare(d[f]))return c[f].localeCompare(d[f])}else{if(isNaN(h))return-1;
if(0!==g-h)return g-h}}else if(""!==c[f])return 1;return""!==d[f]&&void 0!==d[f]?-1:0}return 1}return null!==d?-1:0}return 1}return null!==b?-1:0};function Ha(){t.Fc(this);this.network=null;this.clear()}t.ka("LayoutEdge",Ha);Ha.prototype.clear=function(){this.toVertex=this.fromVertex=this.link=null};Ha.prototype.toString=function(){return"LayoutEdge#"+t.ud(this)+(null!==this.link?"("+this.link.toString()+")":"")};
Ha.prototype.Cx=function(){var a=this.fromVertex;this.fromVertex=this.toVertex;this.toVertex=a};Ha.prototype.commit=function(){};Ha.prototype.getOtherVertex=Ha.prototype.gJ=function(a){e&&t.l(a,Fa,Ha,"getOtherVertex:v");return this.toVertex===a?this.fromVertex:this.fromVertex===a?this.toVertex:null};
function ak(){0<arguments.length&&t.fd(ak);Ae.call(this);this.Gt=!0;this.Ws=this.Xs=NaN;this.Dj=(new ra(NaN,NaN)).freeze();this.Zh=(new ra(10,10)).freeze();this.Ae=hl;this.hd=fl;this.Yh=bl;this.Gh=Sn}t.ka("GridLayout",ak);t.Qa(ak,Ae);ak.prototype.cloneProtected=function(a){Ae.prototype.cloneProtected.call(this,a);a.Xs=this.Xs;a.Ws=this.Ws;a.Dj.assign(this.Dj);a.Zh.assign(this.Zh);a.Ae=this.Ae;a.hd=this.hd;a.Yh=this.Yh;a.Gh=this.Gh};
ak.prototype.doLayout=function(a){a||t.m("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts");var b=this.h;null===b&&null===this.group&&t.m("The diagram for this layout is not set.");this.Nd=this.initialOrigin(this.Nd);var c=new I(x);a===b?(Mn(this,c,a.vh,!0,null,!0,!0,!0),Mn(this,c,a.links,!0,null,!0,!0,!0),Mn(this,c,a.vj,!0,null,!0,!0,!0)):a===this.group?Mn(this,c,a.Vc,!1,null,!0,!0,!0):c.Ue(a.k);for(a=c.copy().k;a.next();){var d=a.value;if(d instanceof
B&&(null!==d.ca||null!==d.fa))c.remove(d);else if(d.xf(),d instanceof z)for(d=d.Vc;d.next();)c.remove(d.value)}c=c.Pe();if(0!==c.length){switch(this.sorting){case el:c.reverse();break;case bl:c.sort(this.comparer);break;case cl:c.sort(this.comparer),c.reverse()}var f=this.pH;isNaN(f)&&(f=0);var g=this.PB,g=isNaN(g)?Math.max(b.Ab.width-b.padding.left-b.padding.right,0):Math.max(this.PB,0);0>=f&&0>=g&&(f=1);a=this.spacing.width;isFinite(a)||(a=0);d=this.spacing.height;isFinite(d)||(d=0);b.yc("Layout");
var h=[];switch(this.alignment){case il:var k=a,l=d,m=Math.max(this.ml.width,1);if(!isFinite(m))for(var n=m=0;n<c.length;n++)var p=c[n],q=p.Ha,m=Math.max(m,q.width);var m=Math.max(m+k,1),r=Math.max(this.ml.height,1);if(!isFinite(r))for(n=r=0;n<c.length;n++)p=c[n],q=p.Ha,r=Math.max(r,q.height);for(var r=Math.max(r+l,1),s=this.We,u=this.Nd.x,w=u,D=this.Nd.y,A=0,G=0,n=0;n<c.length;n++){var p=c[n],q=p.Ha,M=Math.ceil((q.width+k)/m)*m,N=Math.ceil((q.height+l)/r)*r,O;switch(s){case gl:O=Math.abs(w-q.width);
break;default:O=w+q.width}if(0<f&&A>f-1||0<g&&0<A&&O>g)h.push(new F(0,D,g,G+l)),A=0,w=u,D+=G,G=0;G=Math.max(G,N);switch(s){case gl:q=-q.width;break;default:q=0}p.moveTo(w+q,D);switch(s){case gl:w-=M;break;default:w+=M}A++}h.push(new F(0,D,g,G+l));break;case hl:k=a;l=d;m=Math.max(this.ml.width,1);n=A=q=0;p=t.N();for(r=0;r<c.length;r++)s=c[r],u=s.Ha,w=Am(s,s.Zb,s.gf,p),q=Math.max(q,w.x),A=Math.max(A,u.width-w.x),n=Math.max(n,w.y);D=this.We;switch(D){case gl:q+=k;break;default:A+=k}var m=isFinite(m)?
Math.max(m+k,1):Math.max(q+A,1),U=A=this.Nd.x,G=this.Nd.y,M=0;g>=q&&(g-=q);q=0;N=Math.max(this.ml.height,1);O=n=0;for(var Y=!0,ba=t.N(),r=0;r<c.length;r++){s=c[r];u=s.Ha;w=Am(s,s.Zb,s.gf,p);if(0<M)switch(D){case gl:U=Math.floor((U-A-(u.width-w.x))/m)*m+A;break;default:U=Math.ceil((U-A+w.x)/m)*m+A}else switch(D){case gl:q=U+w.x+u.width;break;default:q=U-w.x}var R;switch(D){case gl:R=-(U+w.x)+q;break;default:R=U+u.width-w.x-q}if(0<f&&M>f-1||0<g&&0<M&&R>g){h.push(new F(0,G,g,(Y?O:O+n)+l));for(U=0;U<
M&&r!==M;U++){R=c[r-M+U];var ya=Am(R,R.Zb,R.gf,ba);R.moveTo(R.position.x,R.position.y+n-ya.y)}O+=l;G=Y?G+O:G+(O+n);M=O=n=0;U=A;Y=!1}n=Math.max(n,w.y);O=Math.max(O,u.height-w.y);isFinite(N)&&(O=Math.max(O,Math.max(u.height,N)-w.y));Y?s.moveTo(U-w.x,G-w.y):s.moveTo(U-w.x,G);switch(D){case gl:U-=w.x+k;break;default:U+=u.width-w.x+k}M++}h.push(new F(0,G,g,(Y?O:O+n)+l));for(U=0;U<M&&r!==M;U++)R=c[r-M+U],ya=Am(R,R.Zb,R.gf,p),R.moveTo(R.position.x,R.position.y+n-ya.y);t.B(p);t.B(ba)}this.commitLayers(h,
new E(-a/2,-d/2));b.Ie("Layout");this.ff=!0}};ak.prototype.commitLayers=function(){};t.g(ak,"wrappingWidth",ak.prototype.PB);t.defineProperty(ak,{PB:"wrappingWidth"},function(){return this.Xs},function(a){this.Xs!==a&&(t.i(a,"number",ak,"wrappingWidth"),0<a||isNaN(a))&&(this.Xs=a,this.Gt=isNaN(a),this.M())});t.g(ak,"wrappingColumn",ak.prototype.pH);
t.defineProperty(ak,{pH:"wrappingColumn"},function(){return this.Ws},function(a){this.Ws!==a&&(t.i(a,"number",ak,"wrappingColumn"),0<a||isNaN(a))&&(this.Ws=a,this.M())});t.g(ak,"cellSize",ak.prototype.ml);t.defineProperty(ak,{ml:"cellSize"},function(){return this.Dj},function(a){t.l(a,ra,ak,"cellSize");this.Dj.O(a)||(this.Dj.assign(a),this.M())});t.g(ak,"spacing",ak.prototype.spacing);
t.defineProperty(ak,{spacing:"spacing"},function(){return this.Zh},function(a){t.l(a,ra,ak,"spacing");this.Zh.O(a)||(this.Zh.assign(a),this.M())});t.g(ak,"alignment",ak.prototype.alignment);t.defineProperty(ak,{alignment:"alignment"},function(){return this.Ae},function(a){this.Ae!==a&&(t.Fa(a,ak,ak,"alignment"),a===hl||a===il)&&(this.Ae=a,this.M())});t.g(ak,"arrangement",ak.prototype.We);
t.defineProperty(ak,{We:"arrangement"},function(){return this.hd},function(a){this.hd!==a&&(t.Fa(a,ak,ak,"arrangement"),a===fl||a===gl)&&(this.hd=a,this.M())});t.g(ak,"sorting",ak.prototype.sorting);t.defineProperty(ak,{sorting:"sorting"},function(){return this.Yh},function(a){this.Yh!==a&&(t.Fa(a,ak,ak,"sorting"),a===dl||a===el||a===bl||a===cl)&&(this.Yh=a,this.M())});t.g(ak,"comparer",ak.prototype.comparer);
t.defineProperty(ak,{comparer:"comparer"},function(){return this.Gh},function(a){this.Gh!==a&&(t.i(a,"function",ak,"comparer"),this.Gh=a,this.M())});var Sn;ak.standardComparer=Sn=function(a,b){e&&t.l(a,x,ak,"standardComparer:a");e&&t.l(b,x,ak,"standardComparer:b");var c=a.text,d=b.text;return c<d?-1:c>d?1:0};
ak.smartComparer=function(a,b){e&&t.l(a,x,ak,"standardComparer:a");e&&t.l(b,x,ak,"standardComparer:b");if(null!==a){if(null!==b){var c=a.text.toLocaleLowerCase().split(/([+\-]?[\.]?\d+(?:\.\d*)?(?:e[+\-]?\d+)?)/),d=b.text.toLocaleLowerCase().split(/([+\-]?[\.]?\d+(?:\.\d*)?(?:e[+\-]?\d+)?)/),f;for(f=0;f<c.length;f++)if(""!==d[f]&&void 0!==d[f]){var g=parseFloat(c[f]),h=parseFloat(d[f]);if(isNaN(g)){if(!isNaN(h))return 1;if(0!==c[f].localeCompare(d[f]))return c[f].localeCompare(d[f])}else{if(isNaN(h))return-1;
if(0!==g-h)return g-h}}else if(""!==c[f])return 1;return""!==d[f]&&void 0!==d[f]?-1:0}return 1}return null!==b?-1:0};var il;ak.Position=il=t.w(ak,"Position",0);var hl;ak.Location=hl=t.w(ak,"Location",1);var fl;ak.LeftToRight=fl=t.w(ak,"LeftToRight",2);var gl;ak.RightToLeft=gl=t.w(ak,"RightToLeft",3);var dl;ak.Forward=dl=t.w(ak,"Forward",4);var el;ak.Reverse=el=t.w(ak,"Reverse",5);var bl;ak.Ascending=bl=t.w(ak,"Ascending",6);var cl;ak.Descending=cl=t.w(ak,"Descending",7);
function jl(){0<arguments.length&&t.fd(jl);Ae.call(this);this.$y=this.fo=this.Hd=0;this.Xq=360;this.Zy=vl;this.Ok=0;this.EC=vl;this.Ju=this.zg=this.WD=0;this.kw=new Tn;this.Mu=this.ym=0;this.JH=600;this.es=NaN;this.Dq=1;this.Gs=0;this.Js=360;this.hd=vl;this.ua=rl;this.Yh=ol;this.Gh=Rn;this.Zh=6;this.Xr=Dl}t.ka("CircularLayout",jl);t.Qa(jl,Ae);
jl.prototype.cloneProtected=function(a){Ae.prototype.cloneProtected.call(this,a);a.es=this.es;a.Dq=this.Dq;a.Gs=this.Gs;a.Js=this.Js;a.hd=this.hd;a.ua=this.ua;a.Yh=this.Yh;a.Gh=this.Gh;a.Zh=this.Zh;a.Xr=this.Xr};jl.prototype.createNetwork=function(){var a=new Un;Ln(a,this);return a};
jl.prototype.doLayout=function(a){a||t.m("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts");null===this.network&&(this.network=this.makeNetwork(a));a=this.network.vertexes;if(1>=a.count)1===a.count&&(a=a.gb(),a.Ia=0,a.Ua=0);else{var b=new H(Vn);b.Ue(a.k);a=new H(Vn);var c=new H(Vn),b=this.sort(b);a=new H(Vn);var c=new H(Vn),d=this.Zy,f=this.EC,g=this.Hd,h=this.fo,k=this.$y,l=this.Xq,m=this.Ok,n=this.WD,p=this.zg,q=this.Ju,d=this.We,f=this.Rt,g=
this.hG;if(!isFinite(g)||0>=g)g=NaN;h=this.lE;if(!isFinite(h)||0>=h)h=1;k=this.yh;isFinite(k)||(k=0);l=this.vi;if(!isFinite(l)||360<l||1>l)l=360;m=this.spacing;isFinite(m)||(m=NaN);d===Bl&&f===Cl?d=vl:d===Bl&&f!==Cl&&(f=Cl,d=this.We);if((this.direction===pl||this.direction===ql)&&this.sorting!==ol){for(var r=0;!(r>=b.length);r+=2){a.add(b.wa(r));if(r+1>=b.length)break;c.add(b.wa(r+1))}this.direction===pl?(this.We===Bl&&a.reverse(),b=new H(Vn),b.Ue(a),b.Ue(c)):(this.We===Bl&&c.reverse(),b=new H(Vn),
b.Ue(c),b.Ue(a))}for(var s=b.length,u=n=0,r=0;r<b.length;r++){var p=k+l*u*(this.direction===rl?1:-1)/s,w=b.wa(r).diameter;isNaN(w)&&(w=Wn(b.wa(r),p));360>l&&(0===r||r===b.length-1)&&(w/=2);n+=w;u++}if(isNaN(g)||d===Bl){isNaN(m)&&(m=6);if(d!==vl&&d!==Bl){w=-Infinity;for(r=0;r<s;r++){var q=b.wa(r),D=b.wa(r===s-1?0:r+1);isNaN(q.diameter)&&Wn(q,0);isNaN(D.diameter)&&Wn(D,0);w=Math.max(w,(q.diameter+D.diameter)/2)}q=w+m;d===tl?(p=2*Math.PI/s,g=(w+m)/p):g=Xn(this,q*(360<=l?s:s-1),h,k*Math.PI/180,l*Math.PI/
180)}else g=Xn(this,n+(360<=l?s:s-1)*(d!==Bl?m:1.6*m),h,k*Math.PI/180,l*Math.PI/180);p=g*h}else if(p=g*h,u=Yn(this,g,p,k*Math.PI/180,l*Math.PI/180),isNaN(m)){if(d===vl||d===Bl)m=(u-n)/(360<=l?s:s-1)}else if(d===vl||d===Bl)r=(u-n)/(360<=l?s:s-1),r<m?(g=Xn(this,n+m*(360<=l?s:s-1),h,k*Math.PI/180,l*Math.PI/180),p=g*h):m=r;else{w=-Infinity;for(r=0;r<s;r++)q=b.wa(r),D=b.wa(r===s-1?0:r+1),isNaN(q.diameter)&&Wn(q,0),isNaN(D.diameter)&&Wn(D,0),w=Math.max(w,(q.diameter+D.diameter)/2);q=w+m;r=Xn(this,q*(360<=
l?s:s-1),h,k*Math.PI/180,l*Math.PI/180);r>g?(g=r,p=g*h):q=u/(360<=l?s:s-1)}this.Zy=d;this.EC=f;this.Hd=g;this.fo=h;this.$y=k;this.Xq=l;this.Ok=m;this.WD=n;this.zg=p;this.Ju=q;c=[b,a,c];b=c[0];a=c[1];c=c[2];d=this.Zy;f=this.Hd;h=this.$y;k=this.Xq;l=this.Ok;m=this.zg;n=this.Ju;if(this.direction!==pl&&this.direction!==ql||d!==Bl)if(this.direction===pl||this.direction===ql){g=0;switch(d){case ul:g=180*Zn(this,f,m,h,n)/Math.PI;break;case vl:n=b=0;g=a.gb();null!==g&&(b=Wn(g,Math.PI/2));g=c.gb();null!==
g&&(n=Wn(g,Math.PI/2));g=180*Zn(this,f,m,h,l+(b+n)/2)/Math.PI;break;case tl:g=k/b.length}if(this.direction===pl){switch(d){case ul:$n(this,a,h,sl);break;case vl:ao(this,a,h,sl);break;case tl:bo(this,a,k/2,h,sl)}switch(d){case ul:$n(this,c,h+g,rl);break;case vl:ao(this,c,h+g,rl);break;case tl:bo(this,c,k/2,h+g,rl)}}else{switch(d){case ul:$n(this,c,h,sl);break;case vl:ao(this,c,h,sl);break;case tl:bo(this,c,k/2,h,sl)}switch(d){case ul:$n(this,a,h+g,rl);break;case vl:ao(this,a,h+g,rl);break;case tl:bo(this,
a,k/2,h+g,rl)}}}else switch(d){case ul:$n(this,b,h,this.direction);break;case vl:ao(this,b,h,this.direction);break;case tl:bo(this,b,k,h,this.direction);break;case Bl:co(this,b,k,h,this.direction)}else co(this,b,k,h-k/2,rl)}this.updateParts();this.network=null;this.ff=!0};
function bo(a,b,c,d,f){var g=a.Xq,h=a.Hd;a=a.zg;d=d*Math.PI/180;c=c*Math.PI/180;for(var k=b.length,l=0;l<k;l++){var m=d+(f===rl?l*c/(360<=g?k:k-1):-(l*c)/k),n=b.wa(l),p=h*Math.tan(m)/a,p=Math.sqrt((h*h+a*a*p*p)/(1+p*p));n.Ia=p*Math.cos(m);n.Ua=p*Math.sin(m);n.actualAngle=180*m/Math.PI}}
function ao(a,b,c,d){var f=a.Hd,g=a.zg,h=a.Ok;c=c*Math.PI/180;for(var k=b.length,l=0;l<k;l++){var m=b.wa(l),n=b.wa(l===k-1?0:l+1),p=g*Math.sin(c);m.Ia=f*Math.cos(c);m.Ua=p;m.actualAngle=180*c/Math.PI;isNaN(m.diameter)&&Wn(m,0);isNaN(n.diameter)&&Wn(n,0);m=Zn(a,f,g,d===rl?c:-c,(m.diameter+n.diameter)/2+h);c+=d===rl?m:-m}}
function $n(a,b,c,d){var f=a.Hd,g=a.zg,h=a.Ju;c=c*Math.PI/180;for(var k=b.length,l=0;l<k;l++){var m=b.wa(l);m.Ia=f*Math.cos(c);m.Ua=g*Math.sin(c);m.actualAngle=180*c/Math.PI;m=Zn(a,f,g,d===rl?c:-c,h);c+=d===rl?m:-m}}function co(a,b,c,d,f){var g=a.Mu,g=a.Xq;a.ym=0;a.kw=new Tn;if(360>c){for(g=d+(f===rl?g:-g);0>g;)g+=360;g%=360;180<g&&(g-=360);g*=Math.PI/180;a.Mu=g;eo(a,b,c,d,f)}else fo(a,b,c,d,f);a.kw.commit(b)}
function fo(a,b,c,d,f){var g=a.Hd,h=a.Ok,k=a.fo,l=g*Math.cos(d*Math.PI/180),m=a.zg*Math.sin(d*Math.PI/180),n=b.Pe();if(3===n.length)n[0].Ia=g,n[0].Ua=0,n[1].Ia=n[0].Ia-n[0].width/2-n[1].width/2-h,n[1].y=n[0].y,n[2].Ia=(n[0].Ia+n[1].Ia)/2,n[2].y=n[0].y-n[2].height-h;else if(4===n.length)n[0].Ia=g,n[0].Ua=0,n[2].Ia=-n[0].Ia,n[2].Ua=n[0].Ua,n[1].Ia=0,n[1].y=Math.min(n[0].y,n[2].y)-n[1].height-h,n[3].Ia=0,n[3].y=Math.max(n[0].y+n[0].height+h,n[2].y+n[2].height+h);else{for(g=0;g<n.length;g++){n[g].Ia=
l;n[g].Ua=m;if(g>=n.length-1)break;var p=ho(a,l,m,n,g,f);p[0]||(p=io(a,l,m,n,g,f));l=p[1];m=p[2]}a.ym++;if(!(23<a.ym)){var l=n[0].Ia,m=n[0].Ua,g=n[n.length-1].Ia,p=n[n.length-1].Ua,q=Math.abs(l-g)-((n[0].width+n[n.length-1].width)/2+h),r=Math.abs(m-p)-((n[0].height+n[n.length-1].height)/2+h),h=0;1>Math.abs(r)?Math.abs(l-g)<(n[0].width+n[n.length-1].width)/2&&(h=0):h=0<r?r:1>Math.abs(q)?0:q;q=!1;q=Math.abs(g)>Math.abs(p)?0<g!==m>p:0<p!==l<g;if(q=f===rl?q:!q)h=-Math.abs(h),h=Math.min(h,-n[n.length-
1].width),h=Math.min(h,-n[n.length-1].height);l=a.kw;if(0<h&&0>l.vp||Math.abs(h)<Math.abs(l.vp)&&!(0>h&&0<l.vp))for(l.vp=h,l.In=[],l.nq=[],m=0;m<n.length;m++)l.In[m]=n[m].Tb.x,l.nq[m]=n[m].Tb.y;1<Math.abs(h)&&(a.Hd=8>a.ym?a.Hd-h/(2*Math.PI):5>n.length&&10<h?a.Hd/2:a.Hd-(0<h?1.7:-2.3),a.zg=a.Hd*k,fo(a,b,c,d,f))}}}
function eo(a,b,c,d,f){for(var g=a.Hd,h=a.zg,k=a.fo,l=g*Math.cos(d*Math.PI/180),m=h*Math.sin(d*Math.PI/180),n=b.Pe(),p=0;p<n.length;p++){n[p].Ia=l;n[p].Ua=m;if(p>=n.length-1)break;var q=ho(a,l,m,n,p,f);q[0]||(q=io(a,l,m,n,p,f));l=q[1];m=q[2]}a.ym++;if(!(23<a.ym)){l=Math.atan2(m,l);l=f===rl?a.Mu-l:l-a.Mu;l=Math.abs(l)<Math.abs(l-2*Math.PI)?l:l-2*Math.PI;g=l*(g+h)/2;h=a.kw;if(Math.abs(g)<Math.abs(h.vp))for(h.vp=g,h.In=[],h.nq=[],l=0;l<n.length;l++)h.In[l]=n[l].Tb.x,h.nq[l]=n[l].Tb.y;1<Math.abs(g)&&
(a.Hd=8>a.ym?a.Hd-g/(2*Math.PI):a.Hd-(0<g?1.7:-2.3),a.zg=a.Hd*k,eo(a,b,c,d,f))}}function ho(a,b,c,d,f,g){var h=a.Hd,k=a.zg,l=0,m=0;a=(d[f].width+d[f+1].width)/2+a.Ok;var n=!1;if(0<=c!==(g===rl)){if(l=b+a,l>h){l=b-a;if(l<-h)return b=[!1],b[1]=l,b[2]=m,b;n=!0}}else if(l=b-a,l<-h){l=b+a;if(l>h)return b=[!1],b[1]=l,b[2]=m,b;n=!0}m=Math.sqrt(1-Math.min(1,l*l/(h*h)))*k;0>c!==n&&(m=-m);b=Math.abs(c-m)>(d[f].height+d[f+1].height)/2?[!1]:[!0];b[1]=l;b[2]=m;return b}
function io(a,b,c,d,f,g){var h=a.Hd,k=a.zg,l=0,m=0;a=(d[f].height+d[f+1].height)/2+a.Ok;var n=!1;if(0<=b!==(g===rl)){if(m=c-a,m<-k){m=c+a;if(m>k)return b=[!1],b[1]=l,b[2]=m,b;n=!0}}else if(m=c+a,m>k){m=c-a;if(m<-k)return b=[!1],b[1]=l,b[2]=m,b;n=!0}l=Math.sqrt(1-Math.min(1,m*m/(k*k)))*h;0>b!==n&&(l=-l);b=Math.abs(b-l)>(d[f].width+d[f+1].width)/2?[!1]:[!0];b[1]=l;b[2]=m;return b}function Tn(){this.vp=-Infinity;this.nq=this.In=null}
Tn.prototype.commit=function(a){if(null!==this.In&&null!==this.nq)for(var b=0;b<this.In.length;b++){var c=a.wa(b);c.x=this.In[b];c.y=this.nq[b]}};jl.prototype.commitLayout=function(){this.commitNodes();this.Ft&&this.commitLinks()};jl.prototype.commitNodes=function(){for(var a=this.RH,b=this.network.vertexes.k,c;b.next();)c=b.value,c.x+=a.x,c.y+=a.y,c.commit()};jl.prototype.commitLinks=function(){for(var a=this.network.edges.k;a.next();)a.value.commit()};
function Yn(a,b,c,d,f){var g=a.JH;if(0.001>Math.abs(a.fo-1))return void 0!==d&&void 0!==f?f*b:2*Math.PI*b;a=b>c?Math.sqrt(b*b-c*c)/b:Math.sqrt(c*c-b*b)/c;var h=0,k;k=void 0!==d&&void 0!==f?f/(g+1):Math.PI/(2*(g+1));for(var l=0;l<=g;l++)var m=Math.sin(void 0!==d&&void 0!==f?d+l*f/g:l*Math.PI/(2*g)),h=h+Math.sqrt(1-a*a*m*m)*k;return void 0!==d&&void 0!==f?(b>c?b:c)*h:4*(b>c?b:c)*h}function Xn(a,b,c,d,f){a=void 0!==d&&void 0!==f?Yn(a,1,c,d,f):Yn(a,1,c);return b/a}
function Zn(a,b,c,d,f){if(0.001>Math.abs(a.fo-1))return f/b;var g=b>c?Math.sqrt(b*b-c*c)/b:Math.sqrt(c*c-b*b)/c,h=0;a=2*Math.PI/(700*a.network.vertexes.count);b>c&&(d+=Math.PI/2);for(var k=0;;k++){var l=Math.sin(d+k*a),h=h+(b>c?b:c)*Math.sqrt(1-g*g*l*l)*a;if(h>=f)return k*a}return 0}
jl.prototype.sort=function(a){switch(this.sorting){case ml:break;case nl:a.reverse();break;case kl:a.sort(this.comparer);break;case ll:a.sort(this.comparer);a.reverse();break;case ol:for(var b=[],c=0;c<a.length;c++)b.push(0);for(var d=new H(Vn),c=0;c<a.length;c++){var f=-1,g=-1;if(0===c)for(var h=0;h<a.length;h++){var k=a.wa(h).bJ;k>f&&(f=k,g=h)}else for(h=0;h<a.length;h++)k=b[h],k>f&&(f=k,g=h);d.add(a.wa(g));b[g]=-1;g=a.wa(g);f=g.xc;for(g=g.nc;f.next();)h=f.value,h=h.fromVertex,h=a.indexOf(h),0>
h||0<=b[h]&&b[h]++;for(;g.next();)h=g.value,h=h.toVertex,h=a.indexOf(h),0>h||0<=b[h]&&b[h]++}a=[];for(b=0;b<d.length;b++){k=d.wa(b);a[b]=[];for(var c=k.nc,f=k.xc,l,m;c.next();)l=c.value,m=d.indexOf(l.toVertex),m!==b&&0>a[b].indexOf(m)&&a[b].push(m);for(;f.next();)l=f.value,m=d.indexOf(l.fromVertex),m!==b&&0>a[b].indexOf(m)&&a[b].push(m)}k=[];for(b=0;b<a.length;b++)k[b]=0;for(var c=[],n=[],p=[],f=[],g=new H(Vn),h=b=0;b<a.length;b++){var q=a[b].length;if(1===q)f.push(b);else if(0===q)g.add(d.wa(b));
else{if(0===h)c.push(b);else{for(var r=Infinity,s=Infinity,u=-1,w=[],q=0;q<c.length;q++)0>a[c[q]].indexOf(c[q===c.length-1?0:q+1])&&w.push(q===c.length-1?0:q+1);if(0===w.length)for(q=0;q<c.length;q++)w.push(q);for(q=0;q<w.length;q++){var D=w[q],A;m=a[b];l=n;A=p;for(var G=k,M=D,N=c,O=0,U=0;U<l.length;U++){var Y=G[l[U]],ba=G[A[U]],R=0,ya=0;Y<ba?(R=Y,ya=ba):(R=ba,ya=Y);if(R<M&&M<=ya)for(Y=0;Y<m.length;Y++)ba=m[Y],0>N.indexOf(ba)||R<G[ba]&&G[ba]<ya||R===G[ba]||ya===G[ba]||O++;else for(Y=0;Y<m.length;Y++)ba=
m[Y],0>N.indexOf(ba)||R<G[ba]&&G[ba]<ya&&R!==G[ba]&&ya!==G[ba]&&O++}A=O;for(l=G=0;l<a[b].length;l++)m=c.indexOf(a[b][l]),0<=m&&(m=Math.abs(D-(m>=D?m+1:m)),G+=m<c.length+1-m?m:c.length+1-m);for(l=0;l<n.length;l++)m=k[n[l]],M=k[p[l]],m>=D&&m++,M>=D&&M++,m>M&&(N=M,M=m,m=N),M-m<(c.length+2)/2===(m<D&&D<=M)&&G++;if(A<r||A===r&&G<s)r=A,s=G,u=D}c.splice(u,0,b);for(q=0;q<c.length;q++)k[c[q]]=q;for(q=0;q<a[b].length;q++)r=a[b][q],0<=c.indexOf(r)&&(n.push(b),p.push(r))}h++}}n=!1;for(p=c.length;;){n=!0;for(k=
0;k<f.length;k++)if(b=f[k],q=a[b][0],m=c.indexOf(q),0<=m){for(h=s=0;h<a[q].length;h++)r=a[q][h],r=c.indexOf(r),0>r||r===m||(u=r>m?r-m:m-r,s+=r<m!==u>p-u?1:-1);c.splice(0>s?m:m+1,0,b);f.splice(k,1);k--}else n=!1;if(n)break;else c.push(f[0]),f.splice(0,1)}for(b=0;b<c.length;b++)m=c[b],g.add(d.wa(m));return g;default:t.m("Invalid sorting type.")}return a};t.g(jl,"radius",jl.prototype.hG);
t.defineProperty(jl,{hG:"radius"},function(){return this.es},function(a){this.es!==a&&(t.i(a,"number",jl,"radius"),0<a||isNaN(a))&&(this.es=a,this.M())});t.g(jl,"aspectRatio",jl.prototype.lE);t.defineProperty(jl,{lE:"aspectRatio"},function(){return this.Dq},function(a){this.Dq!==a&&(t.i(a,"number",jl,"aspectRatio"),0<a&&(this.Dq=a,this.M()))});t.g(jl,"startAngle",jl.prototype.yh);
t.defineProperty(jl,{yh:"startAngle"},function(){return this.Gs},function(a){this.Gs!==a&&(t.i(a,"number",jl,"startAngle"),this.Gs=a,this.M())});t.g(jl,"sweepAngle",jl.prototype.vi);t.defineProperty(jl,{vi:"sweepAngle"},function(){return this.Js},function(a){this.Js!==a&&(t.i(a,"number",jl,"sweepAngle"),this.Js=0<a&&360>=a?a:360,this.M())});t.g(jl,"arrangement",jl.prototype.We);
t.defineProperty(jl,{We:"arrangement"},function(){return this.hd},function(a){this.hd!==a&&(t.Fa(a,jl,jl,"arrangement"),a===Bl||a===vl||a===ul||a===tl)&&(this.hd=a,this.M())});t.g(jl,"direction",jl.prototype.direction);t.defineProperty(jl,{direction:"direction"},function(){return this.ua},function(a){this.ua!==a&&(t.Fa(a,jl,jl,"direction"),a===rl||a===sl||a===pl||a===ql)&&(this.ua=a,this.M())});t.g(jl,"sorting",jl.prototype.sorting);
t.defineProperty(jl,{sorting:"sorting"},function(){return this.Yh},function(a){this.Yh!==a&&(t.Fa(a,jl,jl,"sorting"),a===ml||a===nl||a===kl||ll||a===ol)&&(this.Yh=a,this.M())});t.g(jl,"comparer",jl.prototype.comparer);t.defineProperty(jl,{comparer:"comparer"},function(){return this.Gh},function(a){this.Gh!==a&&(t.i(a,"function",jl,"comparer"),this.Gh=a,this.M())});t.g(jl,"spacing",jl.prototype.spacing);
t.defineProperty(jl,{spacing:"spacing"},function(){return this.Zh},function(a){this.Zh!==a&&(t.i(a,"number",jl,"spacing"),this.Zh=a,this.M())});t.g(jl,"nodeDiameterFormula",jl.prototype.Rt);t.defineProperty(jl,{Rt:"nodeDiameterFormula"},function(){return this.Xr},function(a){this.Xr!==a&&(t.Fa(a,jl,jl,"nodeDiameterFormula"),a===Dl||a===Cl)&&(this.Xr=a,this.M())});t.A(jl,{SH:"actualXRadius"},function(){return this.Hd});t.A(jl,{TH:"actualYRadius"},function(){return this.zg});
t.A(jl,{AK:"actualSpacing"},function(){return this.Ok});t.A(jl,{RH:"actualCenter"},function(){return isNaN(this.Nd.x)||isNaN(this.Nd.y)?new E(0,0):new E(this.Nd.x+this.SH,this.Nd.y+this.TH)});var vl;jl.ConstantSpacing=vl=t.w(jl,"ConstantSpacing",0);var ul;jl.ConstantDistance=ul=t.w(jl,"ConstantDistance",1);var tl;jl.ConstantAngle=tl=t.w(jl,"ConstantAngle",2);var Bl;jl.Packed=Bl=t.w(jl,"Packed",3);var rl;jl.Clockwise=rl=t.w(jl,"Clockwise",4);var sl;
jl.Counterclockwise=sl=t.w(jl,"Counterclockwise",5);var pl;jl.BidirectionalLeft=pl=t.w(jl,"BidirectionalLeft",6);var ql;jl.BidirectionalRight=ql=t.w(jl,"BidirectionalRight",7);var ml;jl.Forwards=ml=t.w(jl,"Forwards",8);var nl;jl.Reverse=nl=t.w(jl,"Reverse",9);var kl;jl.Ascending=kl=t.w(jl,"Ascending",10);var ll;jl.Descending=ll=t.w(jl,"Descending",11);var ol;jl.Optimized=ol=t.w(jl,"Optimized",12);var Dl;jl.Pythagorean=Dl=t.w(jl,"Pythagorean",13);var Cl;jl.Circular=Cl=t.w(jl,"Circular",14);
function Un(){Ea.call(this)}t.ka("CircularNetwork",Un);t.Qa(Un,Ea);Un.prototype.createVertex=function(){return new Vn};Un.prototype.createEdge=function(){return new jo};function Vn(){Fa.call(this);this.actualAngle=this.diameter=NaN}t.ka("CircularVertex",Vn);t.Qa(Vn,Fa);
function Wn(a,b){var c=a.network;if(null===c)return NaN;c=c.ic;if(null===c)return NaN;if(c.We===Bl)if(c.Rt===Cl)a.diameter=Math.max(a.width,a.height);else{var c=Math.abs(Math.sin(b)),d=Math.abs(Math.cos(b));if(0===c)return a.width;if(0===d)return a.height;a.diameter=Math.min(a.height/c,a.width/d)}else a.diameter=c.Rt===Cl?Math.max(a.width,a.height):Math.sqrt(a.width*a.width+a.height*a.height);return a.diameter}function jo(){Ha.call(this)}t.ka("CircularEdge",jo);t.Qa(jo,Ha);
function lo(){0<arguments.length&&t.fd(lo);Ae.call(this);this.yg=null;this.wr=0;this.gg=(new ra(100,100)).freeze();this.Cq=!1;this.Xh=!0;this.Fh=!1;this.Fo=100;this.Zq=1;this.Rh=1E3;this.Zn=0.05;this.Yn=50;this.Vn=150;this.Xn=0;this.Tq=10;this.Sq=5}t.ka("ForceDirectedLayout",lo);t.Qa(lo,Ae);
lo.prototype.cloneProtected=function(a){Ae.prototype.cloneProtected.call(this,a);a.gg.assign(this.gg);a.Cq=this.Cq;a.Xh=this.Xh;a.Fh=this.Fh;a.Fo=this.Fo;a.Zq=this.Zq;a.Rh=this.Rh;a.Zn=this.Zn;a.Yn=this.Yn;a.Vn=this.Vn;a.Xn=this.Xn;a.Tq=this.Tq;a.Sq=this.Sq};lo.prototype.createNetwork=function(){var a=new mo;Ln(a,this);return a};
lo.prototype.doLayout=function(a){a||t.m("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts");null===this.network&&(this.network=this.makeNetwork(a));a=this.tx;if(0<this.network.vertexes.count){this.network.Lw();for(var b=this.network.vertexes.k;b.next();){var c=b.value;c.charge=this.electricalCharge(c);c.mass=this.gravitationalMass(c)}for(b=this.network.edges.k;b.next();)c=b.value,c.stiffness=this.springStiffness(c),c.length=this.springLength(c);
this.$z();this.wr=0;if(this.needsClusterLayout()){for(var b=this.network,d=b.qK().k;d.next();){var f=d.value;this.network=f;for(c=this.network.vertexes.k;c.next();){for(var f=c.value,g=0,h=f.vertexes;h.next();)g++;f.$f=g;f.tk=1;f.Xm=null;f.wh=null}no(this,0,a)}this.network=b;d.reset();e&&t.l(b,mo,lo,"arrangeConnectedGraphs:singletons");for(var c=this.sw,k=d.count,l=!0,g=f=0,h=t.Hb(),m=0;m<k+b.vertexes.count+2;m++)h[m]=null;k=0;d.reset();for(m=t.Jf();d.next();){var n=d.value;this.vf(n,m);if(l)l=!1,
f=m.x+m.width/2,g=m.y+m.height/2,h[0]=new E(m.x+m.width+c.width,m.y),h[1]=new E(m.x,m.y+m.height+c.height),k=2;else{var p=oo(h,k,f,g,m.width,m.height,c),q=h[p],r=new E(q.x+m.width+c.width,q.y),s=new E(q.x,q.y+m.height+c.height);p+1<k&&h.splice(p+1,0,null);h[p]=r;h[p+1]=s;k++;p=q.x-m.x;q=q.y-m.y;for(n=n.vertexes.k;n.next();){var u=n.value;u.Ia+=p;u.Ua+=q}}}t.oc(m);for(n=b.vertexes.k;n.next();)u=n.value,l=u.V,2>k?(f=l.x+l.width/2,g=l.y+l.height/2,h[0]=new E(l.x+l.width+c.width,l.y),h[1]=new E(l.x,l.y+
l.height+c.height),k=2):(p=oo(h,k,f,g,l.width,l.height,c),q=h[p],r=new E(q.x+l.width+c.width,q.y),s=new E(q.x,q.y+l.height+c.height),p+1<k&&h.splice(p+1,0,null),h[p]=r,h[p+1]=s,k++,u.Ia=q.x+u.width/2,u.Ua=q.y+u.height/2);t.Ca(h);for(d.reset();d.next();){f=d.value;for(g=f.vertexes.k;g.next();)c=g.value,b.kl(c);for(f=f.edges.k;f.next();)c=f.value,b.Wo(c)}}po(this,a);this.updateParts()}this.Fo=a;this.network=null;this.ff=!0};
lo.prototype.needsClusterLayout=function(){if(3>this.network.vertexes.count)return!1;var a=0,b=0,c=this.network.vertexes.k;c.next();for(var d=c.value.V;c.next();){if(c.value.V.Xf(d)&&(a++,1<a))return!0;if(10<b)break;b++}return!1};lo.prototype.vf=function(a,b){for(var c=!0,d=a.vertexes.k;d.next();){var f=d.value;c?(c=!1,b.set(f.V)):b.yj(f.V)}return b};
function qo(a,b,c){e&&(t.q(b,lo,"computeClusterLayoutIterations:level"),t.q(c,lo,"computeClusterLayoutIterations:maxiter"));return Math.max(Math.min(a.network.vertexes.count,c*(b+1)/11),10)}
function no(a,b,c){e&&(t.q(b,lo,"layoutClusters:level"),t.q(c,lo,"layoutClusters:maxiter"));if(ro(a,b)){var d=a.Rh;a.Rh*=1+1/(b+1);var f=so(a,b),g=Math.max(0,qo(a,b,c));a.tx+=g;no(a,b+1,c);po(a,g);to(a,f,b);c=a.yg;null===c?c=new H(uo):c.clear();c.Ue(f.vertexes);c.sort(function(a,b){return null===a||null===b||a===b?0:b.$f-a.$f});for(f=c.k;f.next();)vo(a,f.value,b);a.Rh=d}}
function ro(a,b){e&&t.q(b,lo,"hasClusters:level");if(10<b||3>a.network.vertexes.count)return!1;null===a.yg?a.yg=new H(uo):a.yg.clear();a.yg.Ue(a.network.vertexes);var c=a.yg;c.sort(function(a,b){return null===a||null===b||a===b?0:b.$f-a.$f});for(var d=c.count-1;0<=d&&1>=c.n[d].$f;)d--;return 1<c.count-d}
function so(a,b){e&&t.q(b,lo,"pushSubNetwork:level");for(var c=a.network,d=new mo,f=a.yg.k;f.next();){var g=f.value;if(1<g.$f){d.kl(g);var h={UB:g.$f,WB:g.width,TB:g.height,qH:g.Q.x,rH:g.Q.y};null===g.wh&&(g.wh=new H);g.wh.add(h);g.rB=g.wh.count-1}else break}for(var k=c.edges.k;k.next();){var l=k.value;if(l.fromVertex.network===d&&l.toVertex.network===d)d.Wo(l);else if(l.fromVertex.network===d){var m=l.fromVertex.Xm;null===m&&(m=new H(uo),l.fromVertex.Xm=m);m.add(l.toVertex);l.fromVertex.$f--;l.fromVertex.tk+=
l.toVertex.tk}else l.toVertex.network===d&&(m=l.toVertex.Xm,null===m&&(m=new H(uo),l.toVertex.Xm=m),m.add(l.fromVertex),l.toVertex.$f--,l.toVertex.tk+=l.fromVertex.tk)}for(k=d.edges.k;k.next();)l=k.value,l.length*=Math.max(1,K.sqrt((l.fromVertex.tk+l.toVertex.tk)/(4*b+1)));for(f=d.vertexes.k;f.next();)if(g=f.value,m=g.Xm,null!==m&&0<m.count&&(h=g.wh.n[g.wh.count-1],h=h.UB-g.$f,!(0>=h))){for(var n=0,p=0,q=m.count-h;q<m.count;q++){for(var r=m.n[q],l=null,k=r.edges.k;k.next();){var s=k.value;if(s.gJ(r)===
g){l=s;break}}null!==l&&(p+=l.length,n+=r.width*r.height)}m=g.Ia;k=g.Ua;l=g.width;q=g.height;r=g.Q;s=l*q;1>s&&(s=1);n=K.sqrt((n+s+p*p*4/(h*h))/s);h=(n-1)*l/2;n=(n-1)*q/2;g.Tb=new F(m-r.x-h,k-r.y-n,l+2*h,q+2*n);g.focus=new E(r.x+h,r.y+n)}a.network=d;return c}
function to(a,b,c){e&&(t.l(b,mo,lo,"popNetwork:oldnet"),t.q(c,lo,"popNetwork:level"));for(c=a.network.vertexes.k;c.next();){var d=c.value;d.network=b;if(null!==d.wh){var f=d.wh.n[d.rB];d.$f=f.UB;var g=f.qH,h=f.rH;d.Tb=new F(d.Ia-g,d.Ua-h,f.WB,f.TB);d.focus=new E(g,h);d.rB--}}for(c=a.network.edges.k;c.next();)c.value.network=b;a.network=b}
function vo(a,b,c){e&&(t.l(b,uo,lo,"surroundNode:oldnet"),t.q(c,lo,"surroundNode:level"));var d=b.Xm;if(null!==d&&0!==d.count){c=b.Ia;var f=b.Ua,g=b.width,h=b.height;null!==b.wh&&0<b.wh.count&&(h=b.wh.n[0],g=h.WB,h=h.TB);for(var g=K.sqrt(g*g+h*h)/2,k=!1,l=h=0,m=0,n=b.vertexes.k;n.next();){var p=n.value;1>=p.$f?l++:(k=!0,m++,h+=Math.atan2(b.Ua-p.Ua,b.Ia-p.Ia))}if(0!==l)for(0<m&&(h/=m),m=b=0,b=k?2*Math.PI/(l+1):2*Math.PI/l,0===l%2&&(m=b/2),1<d.count&&d.sort(function(a,b){return null===a||null===b||
a===b?0:b.width*b.height-a.width*a.height}),k=0===l%2?0:1,n=d.k;n.next();)if(p=n.value,!(1<p.$f||a.isFixed(p))){d=null;for(l=p.edges.k;l.next();){d=l.value;break}var l=p.width,q=p.height,l=K.sqrt(l*l+q*q)/2,d=g+d.length+l,l=h+(b*(k/2>>1)+m)*(0===k%2?1:-1);p.Ia=c+d*Math.cos(l);p.Ua=f+d*Math.sin(l);k++}}}
function oo(a,b,c,d,f,g,h){var k=9E19,l=-1,m=0;a:for(;m<b;m++){var n=a[m],p=n.x-c,q=n.y-d,p=p*p+q*q;if(p<k){for(q=m-1;0<=q;q--)if(a[q].y>n.y&&a[q].x-n.x<f+h.width)continue a;for(q=m+1;q<b;q++)if(a[q].x>n.x&&a[q].y-n.y<g+h.height)continue a;l=m;k=p}}return l}lo.prototype.$z=function(){if(this.comments)for(var a=this.network.vertexes.k;a.next();)this.addComments(a.value)};
lo.prototype.addComments=function(a){var b=a.Jc;if(null!==b)for(b=b.aF();b.next();){var c=b.value;if("Comment"===c.cd&&c.Wa()){var d=this.network.gn(c);null===d&&(d=this.network.Xo(c));d.charge=this.IE;for(var c=null,f=d.nc;f.next();)if(f.value.toVertex===a){c=f.value;break}if(null===c)for(f=d.xc;f.next();)if(f.value.fromVertex===a){c=f.value;break}null===c&&(c=this.network.sn(a,d,null));c.length=this.JE}}};
function wo(a,b){e&&(t.l(a,uo,lo,"getNodeDistance:vertexA"),t.l(b,uo,lo,"getNodeDistance:vertexB"));var c=a.V,d=c.x,f=c.y,g=c.width,c=c.height,h=b.V,k=h.x,l=h.y,m=h.width,h=h.height;return d+g<k?f>l+h?(d=d+g-k,f=f-l-h,K.sqrt(d*d+f*f)):f+c<l?(d=d+g-k,f=f+c-l,K.sqrt(d*d+f*f)):k-(d+g):d>k+m?f>l+h?(d=d-k-m,f=f-l-h,K.sqrt(d*d+f*f)):f+c<l?(d=d-k-m,f=f+c-l,K.sqrt(d*d+f*f)):d-(k+m):f>l+h?f-(l+h):f+c<l?l-(f+c):0.1}
function po(a,b){e&&t.q(b,lo,"performIterations:num");a.yg=null;for(var c=a.wr+b;a.wr<c&&(a.wr++,xo(a)););a.yg=null}
function xo(a){null===a.yg&&(a.yg=new H(uo),a.yg.Ue(a.network.vertexes));var b=a.yg.n;if(0>=b.length)return!1;var c=b[0];c.forceX=0;c.forceY=0;for(var d=c.Ia,f=d,g=c.Ua,h=g,c=1;c<b.length;c++){var k=b[c];k.forceX=0;k.forceY=0;var l=k.Ia,k=k.Ua,d=Math.min(d,l),f=Math.max(f,l),g=Math.min(g,k),h=Math.max(h,k)}(g=f-d>h-g)?b.sort(function(a,b){return null===a||null===b||a===b?0:a.Ia-b.Ia}):b.sort(function(a,b){return null===a||null===b||a===b?0:a.Ua-b.Ua});for(var h=a.Rh,m=0,n=0,p=0,c=0;c<b.length;c++){var k=
b[c],l=k.V,q=k.Q,d=l.x+q.x,l=l.y+q.y,n=k.charge*a.electricalFieldX(d,l),p=k.charge*a.electricalFieldY(d,l),n=n+k.mass*a.gravitationalFieldX(d,l),p=p+k.mass*a.gravitationalFieldY(d,l);k.forceX+=n;k.forceY+=p;for(q=c+1;q<b.length;q++)if(f=b[q],f!==k){var n=f.V,r=f.Q,p=n.x+r.x,r=n.y+r.y;if(d-p>h||p-d>h){if(g)break}else if(l-r>h||r-l>h){if(!g)break}else{var s=wo(k,f);1>s?(d>p?(n=Math.abs(f.V.right-k.V.x),n=(1+n)*Math.random()):d<p?(n=Math.abs(f.V.x-k.V.right),n=-(1+n)*Math.random()):(n=Math.max(f.width,
k.width),n=(1+n)*Math.random()-n/2),l>r?(p=Math.abs(f.V.bottom-k.V.y),p=(1+p)*Math.random()):d<p?(p=Math.abs(f.V.y-k.V.bottom),p=-(1+p)*Math.random()):(p=Math.max(f.height,k.height),p=(1+p)*Math.random()-p/2)):(m=-(k.charge*f.charge)/(s*s),n=(p-d)/s*m,p=(r-l)/s*m);k.forceX+=n;k.forceY+=p;f.forceX-=n;f.forceY-=p}}}for(c=a.network.edges.k;c.next();)g=c.value,k=g.fromVertex,f=g.toVertex,l=k.V,q=k.Q,d=l.x+q.x,l=l.y+q.y,n=f.V,r=f.Q,p=n.x+r.x,r=n.y+r.y,s=wo(k,f),1>s?(n=(d>p?1:-1)*(1+(f.width>k.width)?f.width:
k.width)*Math.random(),p=(l>r?1:-1)*(1+(f.height>k.height)?f.height:k.height)*Math.random()):(m=g.stiffness*(s-g.length),n=(p-d)/s*m,p=(r-l)/s*m),k.forceX+=n,k.forceY+=p,f.forceX-=n,f.forceY-=p;c=0;d=Math.max(a.Rh/20,50);for(f=0;f<b.length;f++)k=b[f],a.isFixed(k)?a.moveFixedVertex(k):(g=k.forceX,h=k.forceY,g<-d?g=-d:g>d&&(g=d),h<-d?h=-d:h>d&&(h=d),k.Ia+=g,k.Ua+=h,c=Math.max(c,g*g+h*h));return c>a.sA*a.sA}lo.prototype.moveFixedVertex=function(){};
lo.prototype.commitLayout=function(){this.xB();this.commitNodes();this.Ft&&this.commitLinks()};lo.prototype.xB=function(){if(this.Jl)for(var a=this.network.edges.k;a.next();){var b=a.value.link;null!==b&&(b.vb=Ub,b.zb=Ub)}};lo.prototype.commitNodes=function(){var a=0,b=0;if(this.jE){var c=t.Jf();this.vf(this.network,c);b=this.Nd;a=b.x-c.x;b=b.y-c.y;t.oc(c)}for(var c=t.Jf(),d=this.network.vertexes.k;d.next();){var f=d.value;if(0!==a||0!==b)c.assign(f.V),c.x+=a,c.y+=b,f.Tb=c;f.commit()}t.oc(c)};
lo.prototype.commitLinks=function(){for(var a=this.network.edges.k;a.next();)a.value.commit()};lo.prototype.springStiffness=function(a){a=a.stiffness;return isNaN(a)?this.Zn:a};lo.prototype.springLength=function(a){a=a.length;return isNaN(a)?this.Yn:a};lo.prototype.electricalCharge=function(a){a=a.charge;return isNaN(a)?this.Vn:a};lo.prototype.electricalFieldX=function(){return 0};lo.prototype.electricalFieldY=function(){return 0};
lo.prototype.gravitationalMass=function(a){a=a.mass;return isNaN(a)?this.Xn:a};lo.prototype.gravitationalFieldX=function(){return 0};lo.prototype.gravitationalFieldY=function(){return 0};lo.prototype.isFixed=function(a){return a.isFixed};t.A(lo,{CK:"currentIteration"},function(){return this.wr});t.g(lo,"arrangementSpacing",lo.prototype.sw);t.defineProperty(lo,{sw:"arrangementSpacing"},function(){return this.gg},function(a){t.l(a,ra,lo,"arrangementSpacing");this.gg.O(a)||(this.gg.assign(a),this.M())});
t.g(lo,"arrangesToOrigin",lo.prototype.jE);t.defineProperty(lo,{jE:"arrangesToOrigin"},function(){return this.Cq},function(a){this.Cq!==a&&(t.i(a,"boolean",lo,"arrangesToOrigin"),this.Cq=a,this.M())});t.g(lo,"setsPortSpots",lo.prototype.Jl);t.defineProperty(lo,{Jl:"setsPortSpots"},function(){return this.Xh},function(a){this.Xh!==a&&(t.i(a,"boolean",lo,"setsPortSpots"),this.Xh=a,this.M())});t.g(lo,"comments",lo.prototype.comments);
t.defineProperty(lo,{comments:"comments"},function(){return this.Fh},function(a){this.Fh!==a&&(t.i(a,"boolean",lo,"comments"),this.Fh=a,this.M())});t.g(lo,"maxIterations",lo.prototype.tx);t.defineProperty(lo,{tx:"maxIterations"},function(){return this.Fo},function(a){this.Fo!==a&&(t.i(a,"number",lo,"maxIterations"),0<=a&&(this.Fo=a,this.M()))});t.g(lo,"epsilonDistance",lo.prototype.sA);
t.defineProperty(lo,{sA:"epsilonDistance"},function(){return this.Zq},function(a){this.Zq!==a&&(t.i(a,"number",lo,"epsilonDistance"),0<a&&(this.Zq=a,this.M()))});t.g(lo,"infinityDistance",lo.prototype.oJ);t.defineProperty(lo,{oJ:"infinityDistance"},function(){return this.Rh},function(a){this.Rh!==a&&(t.i(a,"number",lo,"infinityDistance"),1<a&&(this.Rh=a,this.M()))});t.g(lo,"defaultSpringStiffness",lo.prototype.MI);
t.defineProperty(lo,{MI:"defaultSpringStiffness"},function(){return this.Zn},function(a){this.Zn!==a&&(t.i(a,"number",lo,"defaultSpringStiffness"),this.Zn=a,this.M())});t.g(lo,"defaultSpringLength",lo.prototype.LI);t.defineProperty(lo,{LI:"defaultSpringLength"},function(){return this.Yn},function(a){this.Yn!==a&&(t.i(a,"number",lo,"defaultSpringLength"),this.Yn=a,this.M())});t.g(lo,"defaultElectricalCharge",lo.prototype.FI);
t.defineProperty(lo,{FI:"defaultElectricalCharge"},function(){return this.Vn},function(a){this.Vn!==a&&(t.i(a,"number",lo,"defaultElectricalCharge"),this.Vn=a,this.M())});t.g(lo,"defaultGravitationalMass",lo.prototype.GI);t.defineProperty(lo,{GI:"defaultGravitationalMass"},function(){return this.Xn},function(a){this.Xn!==a&&(t.i(a,"number",lo,"defaultGravitationalMass"),this.Xn=a,this.M())});t.g(lo,"defaultCommentSpringLength",lo.prototype.JE);
t.defineProperty(lo,{JE:"defaultCommentSpringLength"},function(){return this.Tq},function(a){this.Tq!==a&&(t.i(a,"number",lo,"defaultCommentSpringLength"),this.Tq=a,this.M())});t.g(lo,"defaultCommentElectricalCharge",lo.prototype.IE);t.defineProperty(lo,{IE:"defaultCommentElectricalCharge"},function(){return this.Sq},function(a){this.Sq!==a&&(t.i(a,"number",lo,"defaultCommentElectricalCharge"),this.Sq=a,this.M())});function mo(){Ea.call(this)}t.ka("ForceDirectedNetwork",mo);t.Qa(mo,Ea);
mo.prototype.createVertex=function(){return new uo};mo.prototype.createEdge=function(){return new yo};function uo(){Fa.call(this);this.isFixed=!1;this.mass=this.charge=NaN;this.tk=this.$f=this.forceY=this.forceX=0;this.wh=this.Xm=null;this.rB=0}t.ka("ForceDirectedVertex",uo);t.Qa(uo,Fa);function yo(){Ha.call(this);this.length=this.stiffness=NaN}t.ka("ForceDirectedEdge",yo);t.Qa(yo,Ha);
function Z(){0<arguments.length&&t.fd(Z);Ae.call(this);this.Gd=this.om=25;this.ua=0;this.Un=zo;this.Do=Ao;this.ro=Bo;this.lm=4;this.Mn=Co;this.Ti=Do;this.Xh=!0;this.Mj=4;this.Mb=this.rv=this.qb=-1;this.Nf=this.Nr=0;this.Sb=this.Mf=this.og=this.dh=this.Xd=null;this.Ur=0;this.Av=this.tm=null;this.pg=0;this.Vr=null;this.ih=[];this.ih.length=100}t.ka("LayeredDigraphLayout",Z);t.Qa(Z,Ae);
Z.prototype.cloneProtected=function(a){Ae.prototype.cloneProtected.call(this,a);a.om=this.om;a.Gd=this.Gd;a.ua=this.ua;a.Un=this.Un;a.Do=this.Do;a.ro=this.ro;a.lm=this.lm;a.Mn=this.Mn;a.Ti=this.Ti;a.Xh=this.Xh;a.Mj=this.Mj};Z.prototype.createNetwork=function(){var a=new Eo;Ln(a,this);return a};
Z.prototype.doLayout=function(a){a||t.m("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts");null===this.network&&(this.network=this.makeNetwork(a));this.Nd=this.initialOrigin(this.Nd);this.rv=-1;this.Nf=this.Nr=0;this.Vr=this.Av=this.tm=null;for(a=0;a<this.ih.length;a++)this.ih[a]=null;if(0<this.network.vertexes.count){this.network.Lw();for(a=this.network.edges.k;a.next();)a.value.rev=!1;switch(this.Un){default:case Fo:var b=0,c=this.network.vertexes.count-
1;a=[];a.length=c+1;for(var d=this.network.vertexes.k;d.next();)d.value.valid=!0;for(;null!==Go(this.network);){for(d=Po(this.network);null!==d;)a[c]=d,c--,d.valid=!1,d=Po(this.network);for(d=To(this.network);null!==d;)a[b]=d,b++,d.valid=!1,d=To(this.network);for(var d=null,f=0,g=this.network.vertexes.k;g.next();){var h=g.value;if(h.valid){for(var k=0,l=h.nc;l.next();)l.value.toVertex.valid&&k++;for(var l=0,m=h.xc;m.next();)m.value.fromVertex.valid&&l++;if(null===d||f<k-l)d=h,f=k-l}}null!==d&&(a[b]=
d,b++,d.valid=!1)}for(b=0;b<this.network.vertexes.count;b++)a[b].index=b;for(a=this.network.edges.k;a.next();)b=a.value,b.fromVertex.index>b.toVertex.index&&(this.network.Cx(b),b.rev=!0);break;case zo:for(b=this.network.vertexes.k;b.next();)b.value.lp=-1,b.value.finish=-1;for(a=this.network.edges.k;a.next();)a.value.forest=!1;this.Ur=0;for(b.reset();b.next();)0===b.value.xc.count&&Uo(this,b.value);for(b.reset();b.next();)-1===b.value.lp&&Uo(this,b.value);for(a.reset();a.next();)b=a.value,b.forest||
(c=b.fromVertex,d=c.finish,f=b.toVertex,g=f.finish,f.lp<c.lp&&d<g&&(this.network.Cx(b),b.rev=!0))}for(a=this.network.vertexes.k;a.next();)b=a.value,b.layer=-1;this.qb=-1;this.assignLayers();for(a.reset();a.next();)this.qb=Math.max(this.qb,a.value.layer);c=this.network.edges.k;for(b=[];c.next();)a=c.value,a.valid=!1,b.push(a);for(c=0;c<b.length;c++)if(a=b[c],!a.valid&&(null!==a.fromVertex.yd&&null!==a.toVertex.yd||a.fromVertex.layer!==a.toVertex.layer)){g=k=h=l=0;f=a.fromVertex;d=a.toVertex;if(null!==
a.link){k=a.link;if(null===k)continue;var n=f.yd,g=d.yd;if(null===n||null===g)continue;var p=k.ca,h=k.fa,q=k.sd,l=k.Vd;a.rev&&(k=p,m=q,p=h,q=l,h=k,l=m);var r=f.Q,k=a.toVertex.Q,s=a.rev?d.V:f.V,m=t.N();isNaN(s.x)?m.assign(r):Am(p,q,Yb,m);n!==p&&!isNaN(s.x)&&p.Wa()&&(n=f.V,isNaN(n.x)||(m.x+=s.x-n.x,m.y+=s.y-n.y));p=a.rev?f.V:d.V;n=t.N();isNaN(p.x)?n.assign(k):Am(h,l,Yb,n);g!==h&&!isNaN(p.x)&&h.Wa()&&(g=d.V,isNaN(g.x)||(n.x+=p.x-g.x,n.y+=p.y-g.y));90===this.ua||270===this.ua?(g=Math.round((m.x-r.x)/
this.Gd),h=m.x,k=Math.round((n.x-k.x)/this.Gd),l=n.x):(g=Math.round((m.y-r.y)/this.Gd),h=m.y,k=Math.round((n.y-k.y)/this.Gd),l=n.y);t.B(m);t.B(n);a.portFromColOffset=g;a.portFromPos=h;a.portToColOffset=k;a.portToPos=l}else a.portFromColOffset=0,a.portFromPos=0,a.portToColOffset=0,a.portToPos=0;m=f.layer;r=d.layer;n=a;p=0;s=n.link;if(null!==s){var u=s.sd,w=s.Vd;if(null!==u&&null!==w){var D=s.ca,q=s.fa;if(null!==D&&null!==q){var A=u.vb,G=w.zb;this.Jl||(s.vb.Tc()||(A=s.vb),s.zb.Tc()||(G=s.zb));if(A.Tc()||
A===Tb)A=Vo(this,!0);if(G.Tc()||G===Tb)G=Vo(this,!1);var M=s.pc,N=s.getLinkPoint(D,u,A,!0,M,q,w,t.N()),A=s.getLinkDirection(D,u,N,A,!0,M,q,w);t.B(N);A===Wo(this,n,!0)?p+=1:this.Jl&&null!==D&&1===D.ports.count&&n.rev&&(p+=1);N=s.getLinkPoint(q,w,G,!1,M,D,u,t.N());s=s.getLinkDirection(q,w,N,G,!1,M,D,u);t.B(N);s===Wo(this,n,!1)?p+=2:this.Jl&&null!==q&&1===q.ports.count&&n.rev&&(p+=2)}}}n=1===p||3===p?!0:!1;if(p=2===p||3===p?!0:!1)q=this.network.createVertex(),q.yd=null,q.Sm=1,q.layer=m,q.near=f,this.network.kl(q),
f=this.network.sn(f,q,a.link),f.valid=!1,f.rev=a.rev,f.portFromColOffset=g,f.portToColOffset=0,f.portFromPos=h,f.portToPos=0,f=q;s=1;n&&s--;if(m-r>s&&0<m){a.valid=!1;q=this.network.createVertex();q.yd=null;q.Sm=2;q.layer=m-1;this.network.kl(q);f=this.network.sn(f,q,a.link);f.valid=!0;f.rev=a.rev;f.portFromColOffset=p?0:g;f.portToColOffset=0;f.portFromPos=p?0:h;f.portToPos=0;f=q;for(m--;m-r>s&&0<m;)q=this.network.createVertex(),q.yd=null,q.Sm=3,q.layer=m-1,this.network.kl(q),f=this.network.sn(f,q,
a.link),f.valid=!0,f.rev=a.rev,f.portFromColOffset=0,f.portToColOffset=0,f.portFromPos=0,f.portToPos=0,f=q,m--;f=this.network.sn(q,d,a.link);f.valid=!n;n&&(q.near=d);f.rev=a.rev;f.portFromColOffset=0;f.portToColOffset=k;f.portFromPos=0;f.portToPos=l}else a.valid=!0}b=this.Xd=[];for(c=0;c<=this.qb;c++)b[c]=0;for(a=this.network.vertexes.k;a.next();)a.value.index=-1;this.initializeIndices();this.rv=-1;for(c=this.Nf=this.Nr=0;c<=this.qb;c++)b[c]>b[this.Nf]&&(this.rv=b[c]-1,this.Nf=c),b[c]<b[this.Nr]&&
(this.Nr=c);this.Vr=[];for(c=0;c<b.length;c++)this.Vr[c]=[];for(a.reset();a.next();)c=a.value,b=c.layer,this.Vr[b][c.index]=c;this.Mb=-1;for(a=0;a<=this.qb;a++){b=Xo(this,a);c=0;d=this.Xd[a];for(f=0;f<d;f++)g=b[f],c+=this.nodeMinColumnSpace(g,!0),g.column=c,c+=1,c+=this.nodeMinColumnSpace(g,!1);this.Mb=Math.max(this.Mb,c-1);Yo(this,a,b)}this.reduceCrossings();this.straightenAndPack();this.updateParts()}this.network=null;this.ff=!0};
Z.prototype.linkMinLength=function(a){var b=a.toVertex,c=0;for(a=a.fromVertex.nc;a.next();)a.value.toVertex===b&&c++;return 1<c?2:1};function Zo(a){var b=a.fromVertex.yd;a=a.toVertex.yd;return null===b&&null===a?8:null===b||null===a?4:1}Z.prototype.nodeMinLayerSpace=function(a,b){return null===a.yd?0:90===this.ua||270===this.ua?b?a.Q.y+10:a.V.height-a.Q.y+10:b?a.Q.x+10:a.V.width-a.Q.x+10};
Z.prototype.nodeMinColumnSpace=function(a,b){if(null===a.yd)return 0;var c=b?a.$A:a.ZA;if(void 0!==c)return c;c=this.ua;return 90===c||270===c?b?a.$A=a.Q.x/this.Gd+1|0:a.ZA=(a.V.width-a.Q.x)/this.Gd+1|0:b?a.$A=a.Q.y/this.Gd+1|0:a.ZA=(a.V.height-a.Q.y)/this.Gd+1|0};function $o(a){null===a.tm&&(a.tm=[]);for(var b=0,c=a.network.vertexes.k,d;c.next();)d=c.value,a.tm[b]=d.layer,b++,a.tm[b]=d.column,b++,a.tm[b]=d.index,b++;return a.tm}
function ap(a,b){for(var c=0,d=a.network.vertexes.k,f;d.next();)f=d.value,f.layer=b[c],c++,f.column=b[c],c++,f.index=b[c],c++}
function bp(a,b,c){e&&(t.q(b,Z,"crossingMatrix:unfixedLayer"),t.q(c,Z,"crossingMatrix:direction"));var d=Xo(a,b),f=a.Xd[b];a.Av||(a.Av=[]);for(var g=a.Av,h,k=0;k<f;k++){h=0;var l=d[k],m=l.near,n,p;if(null!==m&&m.layer===l.layer)if(l=m.index,l>k)for(p=k+1;p<l;p++)n=d[p],n.near===m&&n.Sm===m.Sm||h++;else for(p=k-1;p>l;p--)n=d[p],n.near===m&&n.Sm===m.Sm||h++;var q,r,s,u,w,D;if(0<=c)for(l=d[k].lf,m=0;m<l.count;m++)if(q=l.n[m],q.valid&&q.fromVertex.layer!==b)for(n=q.fromVertex.index,p=q.portToPos,q=q.portFromPos,
r=m+1;r<l.count;r++)s=l.n[r],s.valid&&s.fromVertex.layer!==b&&(u=s.fromVertex.index,w=s.portToPos,s=s.portFromPos,p<w&&(n>u||n===u&&q>s)&&h++,w<p&&(u>n||u===n&&s>q)&&h++);if(0>=c)for(l=d[k].Ze,m=0;m<l.count;m++)if(q=l.n[m],q.valid&&q.toVertex.layer!==b)for(n=q.toVertex.index,p=q.portToPos,q=q.portFromPos,r=m+1;r<l.count;r++)s=l.n[r],s.valid&&s.toVertex.layer!==b&&(u=s.toVertex.index,w=s.portToPos,s=s.portFromPos,q<s&&(n>u||n===u&&p>w)&&h++,s<q&&(u>n||u===n&&w>p)&&h++);g[k*f+k]=h;for(l=k+1;l<f;l++){var A=
0,G=0;if(0<=c)for(h=d[k].lf,D=d[l].lf,m=0;m<h.count;m++)if(q=h.n[m],q.valid&&q.fromVertex.layer!==b)for(n=q.fromVertex.index,q=q.portFromPos,r=0;r<D.count;r++)s=D.n[r],s.valid&&s.fromVertex.layer!==b&&(u=s.fromVertex.index,s=s.portFromPos,(n<u||n===u&&q<s)&&G++,(u<n||u===n&&s<q)&&A++);if(0>=c)for(h=d[k].Ze,D=d[l].Ze,m=0;m<h.count;m++)if(q=h.n[m],q.valid&&q.toVertex.layer!==b)for(n=q.toVertex.index,p=q.portToPos,r=0;r<D.count;r++)s=D.n[r],s.valid&&s.toVertex.layer!==b&&(u=s.toVertex.index,w=s.portToPos,
(n<u||n===u&&p<w)&&G++,(u<n||u===n&&w<p)&&A++);g[k*f+l]=A;g[l*f+k]=G}}Yo(a,b,d);return g}Z.prototype.countCrossings=function(){var a,b=0,c,d;for(a=0;a<=this.qb;a++){c=bp(this,a,1);d=this.Xd[a];for(var f=0;f<d;f++)for(var g=f;g<d;g++)b+=c[f*d+g]}return b};
function cp(a){for(var b=0,c=0;c<=a.qb;c++){for(var d=a,f=c,g=Xo(d,f),h=d.Xd[f],k=0,l=void 0,l=0;l<h;l++){var m=g[l].Ze,n,p,q;if("undefined"!==typeof m)for(var r=0;r<m.count;r++)n=m.n[r],n.valid&&n.toVertex.layer!==f&&(p=n.fromVertex.column+n.portFromColOffset,q=n.toVertex.column+n.portToColOffset,k+=(Math.abs(p-q)+1)*Zo(n))}Yo(d,f,g);b+=k}return b}
Z.prototype.normalize=function(){var a=Infinity;this.Mb=-1;for(var b=this.network.vertexes.k,c;b.next();)c=b.value,a=Math.min(a,c.column-this.nodeMinColumnSpace(c,!0)),this.Mb=Math.max(this.Mb,c.column+this.nodeMinColumnSpace(c,!1));for(b.reset();b.next();)b.value.column-=a;this.Mb-=a};
function dp(a,b,c){e&&(t.q(b,Z,"barycenters:unfixedLayer"),t.q(c,Z,"barycenters:direction"));var d=Xo(a,b),f=a.Xd[b],g=[],h;for(h=0;h<f;h++){var k=d[h],l=null;0>=c&&(l=k.lf);var m=null;0<=c&&(m=k.Ze);var n=0,p=0,q=k.near;null!==q&&q.layer===k.layer&&(n+=q.column-1,p++);if(null!==l)for(q=0;q<l.count;q++){var k=l.n[q],r=k.fromVertex;k.valid&&!k.rev&&r.layer!==b&&(n+=r.column+k.portFromColOffset,p++)}if(null!==m)for(l=0;l<m.count;l++)k=m.n[l],q=k.toVertex,k.valid&&!k.rev&&q.layer!==b&&(n+=q.column+k.portToColOffset,
p++);g[h]=0===p?-1:n/p}Yo(a,b,d);return g}
function ep(a,b,c){e&&(t.q(b,Z,"medians:unfixedLayer"),t.q(c,Z,"medians:direction"));for(var d=Xo(a,b),f=a.Xd[b],g=[],h=0;h<f;h++){var k=d[h],l=null;0>=c&&(l=k.lf);var m=null;0<=c&&(m=k.Ze);var n=0,p=[],q=k.near;null!==q&&q.layer===k.layer&&(p[n]=q.column-1,n++);if(null!==l)for(q=0;q<l.count;q++){var k=l.n[q],r=k.fromVertex;k.valid&&!k.rev&&r.layer!==b&&(p[n]=r.column+k.portFromColOffset,n++)}if(null!==m)for(l=0;l<m.count;l++)k=m.n[l],q=k.toVertex,k.valid&&!k.rev&&q.layer!==b&&(p[n]=q.column+k.portToColOffset,
n++);0===n?g[h]=-1:(p.sort(function(a,b){return a-b}),m=n>>1,g[h]=n&1?p[m]:p[m-1]+p[m]>>1)}Yo(a,b,d);return g}function fp(a,b,c,d,f,g){if(b.component===d){b.component=c;var h,k;if(f)for(var l=b.nc;l.next();){var m=l.value.toVertex;h=b.layer-m.layer;k=a.linkMinLength(l.value);h===k&&fp(a,m,c,d,f,g)}if(g)for(l=b.xc;l.next();)m=l.value.fromVertex,h=m.layer-b.layer,k=a.linkMinLength(l.value),h===k&&fp(a,m,c,d,f,g)}}
function gp(a,b,c,d,f,g){if(b.component===d){b.component=c;if(f)for(var h=b.nc,k;h.next();)k=h.value.toVertex,gp(a,k,c,d,f,g);if(g)for(b=b.xc;b.next();)h=b.value.fromVertex,gp(a,h,c,d,f,g)}}function Go(a){for(a=a.vertexes.k;a.next();){var b=a.value;if(b.valid)return b}return null}function Po(a){for(a=a.vertexes.k;a.next();){var b=a.value;if(b.valid){for(var c=!0,d=b.nc;d.next();)if(d.value.toVertex.valid){c=!1;break}if(c)return b}}return null}
function To(a){for(a=a.vertexes.k;a.next();){var b=a.value;if(b.valid){for(var c=!0,d=b.xc;d.next();)if(d.value.fromVertex.valid){c=!1;break}if(c)return b}}return null}function Uo(a,b){b.lp=a.Ur;a.Ur++;for(var c=b.nc;c.next();){var d=c.value,f=d.toVertex;-1===f.lp&&(d.forest=!0,Uo(a,f))}b.finish=a.Ur;a.Ur++}
Z.prototype.assignLayers=function(){switch(this.Do){case hp:ip(this);break;case jp:for(var a,b=this.network.vertexes.k;b.next();)a=kp(this,b.value),this.qb=Math.max(a,this.qb);for(b.reset();b.next();)a=b.value,a.layer=this.qb-a.layer;break;default:case Ao:ip(this);for(b=this.network.vertexes.k;b.next();)b.value.valid=!1;for(b.reset();b.next();)0===b.value.xc.count&&lp(this,b.value);a=Infinity;for(b.reset();b.next();)a=Math.min(a,b.value.layer);this.qb=-1;for(b.reset();b.next();)b.value.layer-=a,this.qb=
Math.max(this.qb,b.value.layer)}};function ip(a){for(var b=a.network.vertexes.k;b.next();){var c=mp(a,b.value);a.qb=Math.max(c,a.qb)}}function mp(a,b){var c=0;if(-1===b.layer){for(var d=b.nc;d.next();)var f=d.value,g=a.linkMinLength(f),c=Math.max(c,mp(a,f.toVertex)+g);b.layer=c}else c=b.layer;return c}function kp(a,b){var c=0;if(-1===b.layer){for(var d,f,g=b.xc;g.next();)f=g.value,d=a.linkMinLength(f),c=Math.max(c,kp(a,f.fromVertex)+d);b.layer=c}else c=b.layer;return c}
function lp(a,b){if(!b.valid){b.valid=!0;for(var c=b.nc;c.next();)lp(a,c.value.toVertex);for(c=a.network.vertexes.k;c.next();)c.value.component=-1;for(var d=b.lf.n,f=d.length,g=0;g<f;g++){var h=d[g],k=a.linkMinLength(h);h.fromVertex.layer-h.toVertex.layer>k&&fp(a,h.fromVertex,0,-1,!0,!1)}for(fp(a,b,1,-1,!0,!0);0!==b.component;){for(var k=0,d=Infinity,l=0,m=null,n=a.network.vertexes.k;n.next();){var p=n.value;if(1===p.component){for(var q=0,r=!1,s=p.lf.n,f=s.length,g=0;g<f;g++){var h=s[g],u=h.fromVertex,
q=q+1;1!==u.component&&(k+=1,u=u.layer-p.layer,h=a.linkMinLength(h),d=Math.min(d,u-h))}h=p.Ze.n;f=h.length;for(g=0;g<f;g++)s=h[g].toVertex,q-=1,1!==s.component?k-=1:r=!0;(null===m||q<l)&&!r&&(m=p,l=q)}}if(0<k){for(c.reset();c.next();)f=c.value,1===f.component&&(f.layer+=d);b.component=0}else m.component=0}for(c=a.network.vertexes.k;c.next();)c.value.component=-1;for(fp(a,b,1,-1,!0,!1);0!==b.component;){g=0;f=Infinity;d=0;k=null;for(l=a.network.vertexes.k;l.next();)if(m=l.value,1===m.component){n=
0;p=!1;h=m.lf.n;q=h.length;for(r=0;r<q;r++)s=h[r].fromVertex,n+=1,1!==s.component?g+=1:p=!0;h=m.Ze.n;q=h.length;for(r=0;r<q;r++)s=h[r],u=s.toVertex,n-=1,1!==u.component&&(g-=1,u=m.layer-u.layer,s=a.linkMinLength(s),f=Math.min(f,u-s));(null===k||n>d)&&!p&&(k=m,d=n)}if(0>g){for(c.reset();c.next();)g=c.value,1===g.component&&(g.layer-=f);b.component=0}else k.component=0}}}
function Wo(a,b,c){return 90===a.ua?c&&!b.rev||!c&&b.rev?270:90:180===a.ua?c&&!b.rev||!c&&b.rev?0:180:270===a.ua?c&&!b.rev||!c&&b.rev?90:270:c&&!b.rev||!c&&b.rev?180:0}
Z.prototype.initializeIndices=function(){switch(this.ro){default:case np:for(var a,b=this.network.vertexes.k;b.next();){var c=b.value;a=c.layer;c.index=this.Xd[a];this.Xd[a]++}break;case Bo:b=this.network.vertexes.k;for(a=this.qb;0<=a;a--){for(;b.next();)b.value.layer===a&&-1===b.value.index&&op(this,b.value);b.reset()}break;case pp:for(b=this.network.vertexes.k,a=0;a<=this.qb;a++){for(;b.next();)b.value.layer===a&&-1===b.value.index&&qp(this,b.value);b.reset()}}};
function op(a,b){var c=b.layer;b.index=a.Xd[c];a.Xd[c]++;for(var c=b.Ze.Pe(),d=!0,f;d;)for(d=!1,f=0;f<c.length-1;f++){var g=c[f],h=c[f+1];g.portFromColOffset>h.portFromColOffset&&(d=!0,c[f]=h,c[f+1]=g)}for(f=0;f<c.length;f++)d=c[f],d.valid&&(d=d.toVertex,-1===d.index&&op(a,d))}
function qp(a,b){var c=b.layer;b.index=a.Xd[c];a.Xd[c]++;for(var c=b.lf.Pe(),d=!0,f;d;)for(d=!1,f=0;f<c.length-1;f++){var g=c[f],h=c[f+1];g.portToColOffset>h.portToColOffset&&(d=!0,c[f]=h,c[f+1]=g)}for(f=0;f<c.length;f++)d=c[f],d.valid&&(d=d.fromVertex,-1===d.index&&qp(a,d))}
Z.prototype.reduceCrossings=function(){var a=this.countCrossings(),b=$o(this),c,d,f;for(c=0;c<this.lm;c++){for(d=0;d<=this.qb;d++)rp(this,d,1),sp(this,d,1);f=this.countCrossings();f<a&&(a=f,b=$o(this));for(d=this.qb;0<=d;d--)rp(this,d,-1),sp(this,d,-1);f=this.countCrossings();f<a&&(a=f,b=$o(this))}ap(this,b);for(c=0;c<this.lm;c++){for(d=0;d<=this.qb;d++)rp(this,d,0),sp(this,d,0);f=this.countCrossings();f<a&&(a=f,b=$o(this));for(d=this.qb;0<=d;d--)rp(this,d,0),sp(this,d,0);f=this.countCrossings();
f<a&&(a=f,b=$o(this))}ap(this,b);var g,h,k;switch(this.Mn){case tp:break;case up:for(k=a+1;(d=this.countCrossings())<k;)for(k=d,c=this.qb;0<=c;c--)for(h=0;h<=c;h++){for(g=!0;g;)for(g=!1,d=c;d>=h;d--)g=sp(this,d,-1)||g;f=this.countCrossings();f>=a?ap(this,b):(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=c;d>=h;d--)g=sp(this,d,1)||g;f=this.countCrossings();f>=a?ap(this,b):(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=h;d<=c;d++)g=sp(this,d,1)||g;f>=a?ap(this,b):(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=h;d<=c;d++)g=
sp(this,d,-1)||g;f>=a?ap(this,b):(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=c;d>=h;d--)g=sp(this,d,0)||g;f>=a?ap(this,b):(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=h;d<=c;d++)g=sp(this,d,0)||g;f>=a?ap(this,b):(a=f,b=$o(this))}break;default:case Co:for(c=this.qb,h=0,k=a+1;(d=this.countCrossings())<k;){k=d;for(g=!0;g;)for(g=!1,d=c;d>=h;d--)g=sp(this,d,-1)||g;f=this.countCrossings();f>=a?ap(this,b):(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=c;d>=h;d--)g=sp(this,d,1)||g;f=this.countCrossings();f>=a?ap(this,b):
(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=h;d<=c;d++)g=sp(this,d,1)||g;f>=a?ap(this,b):(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=h;d<=c;d++)g=sp(this,d,-1)||g;f>=a?ap(this,b):(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=c;d>=h;d--)g=sp(this,d,0)||g;f>=a?ap(this,b):(a=f,b=$o(this));for(g=!0;g;)for(g=!1,d=h;d<=c;d++)g=sp(this,d,0)||g;f>=a?ap(this,b):(a=f,b=$o(this))}}ap(this,b)};
function rp(a,b,c){e&&(t.q(b,Z,"medianBarycenterCrossingReduction:unfixedLayer"),t.q(c,Z,"medianBarycenterCrossingReduction:direction"));var d=Xo(a,b),f=a.Xd[b],g=ep(a,b,c),h=dp(a,b,c);for(c=0;c<f;c++)-1===h[c]&&(h[c]=d[c].column),-1===g[c]&&(g[c]=d[c].column);for(var k=!0,l;k;)for(k=!1,c=0;c<f-1;c++)if(g[c+1]<g[c]||g[c+1]===g[c]&&h[c+1]<h[c])k=!0,l=g[c],g[c]=g[c+1],g[c+1]=l,l=h[c],h[c]=h[c+1],h[c+1]=l,l=d[c],d[c]=d[c+1],d[c+1]=l;for(c=g=0;c<f;c++)l=d[c],l.index=c,g+=a.nodeMinColumnSpace(l,!0),l.column=
g,g+=1,g+=a.nodeMinColumnSpace(l,!1);Yo(a,b,d)}
function sp(a,b,c){var d=Xo(a,b),f=a.Xd[b];c=bp(a,b,c);var g,h;h=[];for(g=0;g<f;g++)h[g]=-1;var k;k=[];for(g=0;g<f;g++)k[g]=-1;for(var l=!1,m=!0;m;)for(m=!1,g=0;g<f-1;g++){var n=c[d[g].index*f+d[g+1].index],p=c[d[g+1].index*f+d[g].index],q=0,r=0,s=d[g].column,u=d[g+1].column,w=a.nodeMinColumnSpace(d[g],!0),D=a.nodeMinColumnSpace(d[g],!1),A=a.nodeMinColumnSpace(d[g+1],!0),G=a.nodeMinColumnSpace(d[g+1],!1),w=s-w+A,D=u-D+G,M=d[g].xc.k;for(M.reset();M.next();)if(G=M.value,G.valid&&G.fromVertex.layer===
b){G=G.fromVertex;for(A=0;d[A]!==G;)A++;A<g&&(q+=2*(g-A),r+=2*(g+1-A));A===g+1&&(q+=1);A>g+1&&(q+=4*(A-g),r+=4*(A-(g+1)))}M=d[g].nc.k;for(M.reset();M.next();)if(G=M.value,G.valid&&G.toVertex.layer===b){G=G.toVertex;for(A=0;d[A]!==G;)A++;A===g+1&&(r+=1)}M=d[g+1].xc.k;for(M.reset();M.next();)if(G=M.value,G.valid&&G.fromVertex.layer===b){G=G.fromVertex;for(A=0;d[A]!==G;)A++;A<g&&(q+=2*(g+1-A),r+=2*(g-A));A===g&&(r+=1);A>g+1&&(q+=4*(A-(g+1)),r+=4*(A-g))}M=d[g+1].nc.k;for(M.reset();M.next();)if(G=M.value,
G.valid&&G.toVertex.layer===b){G=G.toVertex;for(A=0;d[A]!==G;)A++;A===g&&(q+=1)}var A=G=0,M=h[d[g].index],N=k[d[g].index],O=h[d[g+1].index],U=k[d[g+1].index];-1!==M&&(G+=Math.abs(M-s),A+=Math.abs(M-D));-1!==N&&(G+=Math.abs(N-s),A+=Math.abs(N-D));-1!==O&&(G+=Math.abs(O-u),A+=Math.abs(O-w));-1!==U&&(G+=Math.abs(U-u),A+=Math.abs(U-w));if(r<q-0.5||r===q&&p<n-0.5||r===q&&p===n&&A<G-0.5)m=l=!0,d[g].column=D,d[g+1].column=w,n=d[g],d[g]=d[g+1],d[g+1]=n}for(g=0;g<f;g++)d[g].index=g;Yo(a,b,d);return l}
Z.prototype.straightenAndPack=function(){var a,b,c=0!==(this.Ti&vp);a=this.Ti===Do;1E3<this.network.edges.count&&!a&&(c=!1);if(c){b=[];for(a=0;a<=this.qb;a++)b[a]=0;for(var d=this.network.vertexes.k,f,g;d.next();)f=d.value,a=f.layer,g=f.column,f=this.nodeMinColumnSpace(f,!1),b[a]=Math.max(b[a],g+f);for(d.reset();d.next();)f=d.value,a=f.layer,g=f.column,f.column=(8*(this.Mb-b[a])>>1)+8*g;this.Mb*=8}if(0!==(this.Ti&wp))for(b=!0;b;){b=!1;for(a=this.Nf+1;a<=this.qb;a++)b=xp(this,a,1)||b;for(a=this.Nf-
1;0<=a;a--)b=xp(this,a,-1)||b;b=xp(this,this.Nf,0)||b}if(0!==(this.Ti&yp)){for(a=this.Nf+1;a<=this.qb;a++)zp(this,a,1);for(a=this.Nf-1;0<=a;a--)zp(this,a,-1);zp(this,this.Nf,0)}c&&(Ap(this,-1),Ap(this,1));if(0!==(this.Ti&wp))for(b=!0;b;){b=!1;b=xp(this,this.Nf,0)||b;for(a=this.Nf+1;a<=this.qb;a++)b=xp(this,a,0)||b;for(a=this.Nf-1;0<=a;a--)b=xp(this,a,0)||b}};function xp(a,b,c){e&&(t.q(b,Z,"bendStraighten:unfixedLayer"),t.q(c,Z,"bendStraighten:direction"));for(var d=!1;Bp(a,b,c);)d=!0;return d}
function Bp(a,b,c){e&&(t.q(b,Z,"shiftbendStraighten:unfixedLayer"),t.q(c,Z,"shiftbendStraighten:direction"));var d,f=Xo(a,b),g=a.Xd[b],h=dp(a,b,-1);if(0<c)for(d=0;d<g;d++)h[d]=-1;var k=dp(a,b,1);if(0>c)for(d=0;d<g;d++)k[d]=-1;for(var l=!1,m=!0;m;)for(m=!1,d=0;d<g;d++){var n=f[d].column,p=a.nodeMinColumnSpace(f[d],!0),q=a.nodeMinColumnSpace(f[d],!1),p=0>d-1||n-f[d-1].column-1>p+a.nodeMinColumnSpace(f[d-1],!1)?n-1:n,q=d+1>=g||f[d+1].column-n-1>q+a.nodeMinColumnSpace(f[d+1],!0)?n+1:n,r=0,s=0,u=0,w,D,
A,G;if(0>=c)for(var M=f[d].xc.k;M.next();)w=M.value,w.valid&&w.fromVertex.layer!==b&&(D=Zo(w),A=w.portFromColOffset,G=w.portToColOffset,w=w.fromVertex.column,r+=(Math.abs(n+G-(w+A))+1)*D,s+=(Math.abs(p+G-(w+A))+1)*D,u+=(Math.abs(q+G-(w+A))+1)*D);if(0<=c)for(M=f[d].nc.k;M.next();)w=M.value,w.valid&&w.toVertex.layer!==b&&(D=Zo(w),A=w.portFromColOffset,G=w.portToColOffset,w=w.toVertex.column,r+=(Math.abs(n+A-(w+G))+1)*D,s+=(Math.abs(p+A-(w+G))+1)*D,u+=(Math.abs(q+A-(w+G))+1)*D);G=A=D=0;w=h[f[d].index];
M=k[f[d].index];-1!==w&&(D+=Math.abs(w-n),A+=Math.abs(w-p),G+=Math.abs(w-q));-1!==M&&(D+=Math.abs(M-n),A+=Math.abs(M-p),G+=Math.abs(M-q));if(s<r||s===r&&A<D)m=l=!0,f[d].column=p;if(u<r||u===r&&G<D)m=l=!0,f[d].column=q}Yo(a,b,f);a.normalize();return l}
function zp(a,b,c){e&&(t.q(b,Z,"medianStraighten:unfixedLayer"),t.q(c,Z,"medianStraighten:direction"));var d=Xo(a,b),f=a.Xd[b],g=ep(a,b,c),h=[];for(c=0;c<f;c++)h[c]=g[c];for(g=!0;g;)for(g=!1,c=0;c<f;c++){var k=d[c].column,l=a.nodeMinColumnSpace(d[c],!0),m=a.nodeMinColumnSpace(d[c],!1),n=0,p;-1===h[c]?0===c&&c===f-1?n=k:0===c?(p=d[c+1].column,n=p-k===m+a.nodeMinColumnSpace(d[c+1],!0)?k-1:k):c===f-1?(p=d[c-1].column,n=k-p===l+a.nodeMinColumnSpace(d[c-1],!1)?k+1:k):(p=d[c-1].column,l=p+a.nodeMinColumnSpace(d[c-
1],!1)+l+1,p=d[c+1].column,m=p-a.nodeMinColumnSpace(d[c+1],!0)-m-1,n=(l+m)/2|0):0===c&&c===f-1?n=h[c]:0===c?(p=d[c+1].column,m=p-a.nodeMinColumnSpace(d[c+1],!0)-m-1,n=Math.min(h[c],m)):c===f-1?(p=d[c-1].column,l=p+a.nodeMinColumnSpace(d[c-1],!1)+l+1,n=Math.max(h[c],l)):(p=d[c-1].column,l=p+a.nodeMinColumnSpace(d[c-1],!1)+l+1,p=d[c+1].column,m=p-a.nodeMinColumnSpace(d[c+1],!0)-m-1,l<h[c]&&h[c]<m?n=h[c]:l>=h[c]?n=l:m<=h[c]&&(n=m));n!==k&&(g=!0,d[c].column=n)}Yo(a,b,d);a.normalize()}
function Cp(a,b){e&&(t.q(b,Z,"packAux:column"),t.q(1,Z,"packAux:direction"));for(var c=!0,d=a.network.vertexes.k,f;d.next();){f=d.value;var g=a.nodeMinColumnSpace(f,!0),h=a.nodeMinColumnSpace(f,!1);if(f.column-g<=b&&f.column+h>=b){c=!1;break}}g=!1;if(c)for(d.reset();d.next();)f=d.value,f.column>b&&(f.column-=1,g=!0);return g}
function Dp(a,b){e&&(t.q(b,Z,"tightPackAux:column"),t.q(1,Z,"tightPackAux:direction"));var c=b,c=b+1,d,f=[],g=[];for(d=0;d<=a.qb;d++)f[d]=!1,g[d]=!1;for(var h=a.network.vertexes.k;h.next();){d=h.value;var k=d.column-a.nodeMinColumnSpace(d,!0),l=d.column+a.nodeMinColumnSpace(d,!1);k<=b&&l>=b&&(f[d.layer]=!0);k<=c&&l>=c&&(g[d.layer]=!0)}k=!0;c=!1;for(d=0;d<=a.qb;d++)k=k&&!(f[d]&&g[d]);if(k)for(h.reset();h.next();)d=h.value,d.column>b&&(d.column-=1,c=!0);return c}
function Ap(a,b){e&&t.q(b,Z,"componentPack:direction");for(var c=0;c<=a.Mb;c++)for(;Cp(a,c););a.normalize();for(c=0;c<a.Mb;c++)for(;Dp(a,c););a.normalize();var d,f,g,h;if(0<b)for(c=0;c<=a.Mb;c++)for(d=$o(a),f=cp(a),g=f+1;f<g;)g=f,Ep(a,c,1),h=cp(a),h>f?ap(a,d):h<f&&(f=h,d=$o(a));if(0>b)for(c=a.Mb;0<=c;c--)for(d=$o(a),f=cp(a),g=f+1;f<g;)g=f,Ep(a,c,-1),h=cp(a),h>f?ap(a,d):h<f&&(f=h,d=$o(a));a.normalize()}
function Ep(a,b,c){a.pg=0;for(var d=a.network.vertexes.k,f;d.next();)d.value.component=-1;if(0<c)for(d.reset();d.next();)f=d.value,f.column-a.nodeMinColumnSpace(f,!0)<=b&&(f.component=a.pg);if(0>c)for(d.reset();d.next();)f=d.value,f.column+a.nodeMinColumnSpace(f,!1)>=b&&(f.component=a.pg);a.pg++;for(d.reset();d.next();)f=d.value,-1===f.component&&(gp(a,f,a.pg,-1,!0,!0),a.pg++);b=[];for(f=0;f<a.pg*a.pg;f++)b[f]=!1;var g=[];for(f=0;f<(a.qb+1)*(a.Mb+1);f++)g[f]=-1;for(d.reset();d.next();){f=d.value;
for(var h=f.layer,k=Math.max(0,f.column-a.nodeMinColumnSpace(f,!0)),l=Math.min(a.Mb,f.column+a.nodeMinColumnSpace(f,!1));k<=l;k++)g[h*(a.Mb+1)+k]=f.component}for(f=0;f<=a.qb;f++){if(0<c)for(k=0;k<a.Mb;k++)-1!==g[f*(a.Mb+1)+k]&&-1!==g[f*(a.Mb+1)+k+1]&&g[f*(a.Mb+1)+k]!==g[f*(a.Mb+1)+k+1]&&(b[g[f*(a.Mb+1)+k]*a.pg+g[f*(a.Mb+1)+k+1]]=!0);if(0>c)for(k=a.Mb;0<k;k--)-1!==g[f*(a.Mb+1)+k]&&-1!==g[f*(a.Mb+1)+k-1]&&g[f*(a.Mb+1)+k]!==g[f*(a.Mb+1)+k-1]&&(b[g[f*(a.Mb+1)+k]*a.pg+g[f*(a.Mb+1)+k-1]]=!0)}g=[];for(f=
0;f<a.pg;f++)g[f]=!0;h=new H("number");for(h.add(0);0!==h.count;)if(l=h.n[h.count-1],h.wd(h.count-1),g[l])for(g[l]=!1,f=0;f<a.pg;f++)b[l*a.pg+f]&&h.Pd(0,f);if(0<c)for(d.reset();d.next();)f=d.value,g[f.component]&&(f.column-=1);if(0>c)for(d.reset();d.next();)f=d.value,g[f.component]&&(f.column+=1)}Z.prototype.commitLayout=function(){if(this.Jl)for(var a=Vo(this,!0),b=Vo(this,!1),c=this.network.edges.k,d;c.next();)d=c.value.link,null!==d&&(d.vb=a,d.zb=b);this.commitNodes();this.gA();this.Ft&&this.commitLinks()};
function Vo(a,b){return 270===a.ua?b?cc:mc:90===a.ua?b?mc:cc:180===a.ua?b?gc:hc:b?hc:gc}
Z.prototype.commitNodes=function(){this.dh=[];this.og=[];this.Mf=[];this.Sb=[];for(var a=0;a<=this.qb;a++)this.dh[a]=0,this.og[a]=0,this.Mf[a]=0,this.Sb[a]=0;for(var a=this.network.vertexes.k,b,c;a.next();)b=a.value,c=b.layer,this.dh[c]=Math.max(this.dh[c],this.nodeMinLayerSpace(b,!0)),this.og[c]=Math.max(this.og[c],this.nodeMinLayerSpace(b,!1));var d=0,f=this.om;for(b=0;b<=this.qb;b++)c=f,0>=this.dh[b]+this.og[b]&&(c=0),0<b&&(d+=c/2),90===this.ua||0===this.ua?(d+=this.og[b],this.Mf[b]=d,d+=this.dh[b]):
(d+=this.dh[b],this.Mf[b]=d,d+=this.og[b]),b<this.qb&&(d+=c/2),this.Sb[b]=d;f=d;d=this.Nd;for(b=0;b<=this.qb;b++)270===this.ua?this.Mf[b]=d.y+this.Mf[b]:90===this.ua?(this.Mf[b]=d.y+f-this.Mf[b],this.Sb[b]=f-this.Sb[b]):180===this.ua?this.Mf[b]=d.x+this.Mf[b]:(this.Mf[b]=d.x+f-this.Mf[b],this.Sb[b]=f-this.Sb[b]);for(a.reset();a.next();){b=a.value;c=b.layer;var g=b.column|0;270===this.ua||90===this.ua?(f=d.x+this.Gd*g,c=this.Mf[c]):(f=this.Mf[c],c=d.y+this.Gd*g);b.Ia=f;b.Ua=c;b.commit()}};
Z.prototype.gA=function(){for(var a=0,b=this.om,c=0;c<=this.qb;c++)a+=this.dh[c],a+=this.og[c];for(var a=a+this.qb*b,b=[],c=this.Gd*this.Mb,d=this.JJ;0<=d;d--)270===this.ua?0===d?b.push(new F(0,0,c,Math.abs(this.Sb[0]))):b.push(new F(0,this.Sb[d-1],c,Math.abs(this.Sb[d-1]-this.Sb[d]))):90===this.ua?0===d?b.push(new F(0,this.Sb[0],c,Math.abs(this.Sb[0]-a))):b.push(new F(0,this.Sb[d],c,Math.abs(this.Sb[d-1]-this.Sb[d]))):180===this.ua?0===d?b.push(new F(0,0,Math.abs(this.Sb[0]),c)):b.push(new F(this.Sb[d-
1],0,Math.abs(this.Sb[d-1]-this.Sb[d]),c)):0===d?b.push(new F(this.Sb[0],0,Math.abs(this.Sb[0]-a),c)):b.push(new F(this.Sb[d],0,Math.abs(this.Sb[d-1]-this.Sb[d]),c));this.commitLayers(b,K.Aj)};Z.prototype.commitLayers=function(){};
Z.prototype.commitLinks=function(){for(var a=this.network.edges.k,b,c;a.next();)c=a.value.link,"undefined"!==typeof c&&null!==c&&(c.Kl(),c.gp(),c.ij());for(a.reset();a.next();)c=a.value.link,"undefined"!==typeof c&&null!==c&&c.updateRoute();for(a.reset();a.next();)if(b=a.value,c=b.link){c.Kl();var d=c,f=d.ca,g=d.fa,h=d.sd,k=d.Vd;if(b.valid){if(c.Je===Wg&&4===c.ra){if(b.rev)var l=f,f=g,g=l,m=h,h=k,k=m;if(b.fromVertex.column===b.toVertex.column){var n=c.getLinkPoint(f,h,c.computeSpot(!0),!0,!1,g,k),
p=c.getLinkPoint(g,k,c.computeSpot(!1),!1,!1,f,h);c.gp();c.jl(n.x,n.y);c.jl((2*n.x+p.x)/3,(2*n.y+p.y)/3);c.jl((n.x+2*p.x)/3,(n.y+2*p.y)/3);c.jl(p.x,p.y)}else{var q=!1,r=!1;null!==h&&c.computeSpot(!0)===Tb&&(q=!0);null!==k&&c.computeSpot(!1)===Tb&&(r=!0);if(q||r){var s=c.o(0).x,u=c.o(0).y,w=c.o(1).x,D=c.o(1).y,A=c.o(2).x,G=c.o(2).y,M=c.o(3).x,N=c.o(3).y;if(q){90===this.ua||270===this.ua?(w=s,D=(u+N)/2):(w=(s+M)/2,D=u);c.aa(1,w,D);var O=c.getLinkPoint(f,h,c.computeSpot(!0),!0,!1,g,k);c.aa(0,O.x,O.y)}r&&
(90===this.ua||270===this.ua?(A=M,G=(u+N)/2):(A=(s+M)/2,G=N),c.aa(2,A,G),O=c.getLinkPoint(g,k,c.computeSpot(!1),!1,!1,f,h),c.aa(3,O.x,O.y))}}}c.ij()}else if(b.fromVertex.layer===b.toVertex.layer)c.ij();else{var U=!1,Y=!1,ba,R=c.ut+1;if(c.pc)Y=!0,ba=c.ra,4<ba&&c.points.removeRange(2,ba-3);else if(c.Je===Wg)U=!0,ba=c.ra,4<ba&&c.points.removeRange(2,ba-3),R=2;else{ba=c.ra;var ya=c.computeSpot(!0)===Tb,Ya=c.computeSpot(!1)===Tb;2<ba&&ya&&Ya?c.points.removeRange(1,ba-2):3<ba&&ya&&!Ya?c.points.removeRange(1,
ba-3):3<ba&&!ya&&Ya?c.points.removeRange(2,ba-2):4<ba&&!ya&&!Ya&&c.points.removeRange(2,ba-3)}var Aa=b.fromVertex,Na=b.toVertex,va,Pa;if(b.rev){for(var Ga;null!==Na&&Aa!==Na;){Pa=va=null;for(var Jf=Na.xc.k;Jf.next()&&(ic=Jf.value,ic.link!==b.link||(va=ic.fromVertex,Pa=ic.toVertex,null!==va.yd)););va!==Aa&&(jb=c.o(R-1).x,fb=c.o(R-1).y,Ia=va.Ia,Ja=va.Ua,Y?180===this.ua||0===this.ua?2===R?(c.C(R++,jb,fb),c.C(R++,jb,Ja)):(nd=null!==Pa?Pa.Ua:fb,nd!==Ja&&(Xa=this.Sb[va.layer-1],c.C(R++,Xa,fb),c.C(R++,Xa,
Ja))):2===R?(c.C(R++,jb,fb),c.C(R++,Ia,fb)):(nf=null!==Pa?Pa.Ia:jb,nf!==Ia&&(Xa=this.Sb[va.layer-1],c.C(R++,jb,Xa),c.C(R++,Ia,Xa))):2===R?U?(db=Math.max(10,this.dh[Na.layer]),Ab=Math.max(10,this.og[Na.layer]),180===this.ua?(Ga=Na.V.x,c.C(R++,Ga-db,Ja),c.C(R++,Ga,Ja),c.C(R++,Ga+Ab,Ja)):90===this.ua?(Ga=Na.V.y+Na.V.height,c.C(R++,Ia,Ga+Ab),c.C(R++,Ia,Ga),c.C(R++,Ia,Ga-db)):270===this.ua?(Ga=Na.V.y,c.C(R++,Ia,Ga-db),c.C(R++,Ia,Ga),c.C(R++,Ia,Ga+Ab)):(Ga=Na.V.x+Na.V.width,c.C(R++,Ga+Ab,Ja),c.C(R++,Ga,
Ja),c.C(R++,Ga-db,Ja))):(c.C(R++,jb,fb),180===this.ua||0===this.ua?c.C(R++,jb,Ja):c.C(R++,Ia,fb),c.C(R++,Ia,Ja)):(db=Math.max(10,this.dh[va.layer]),Ab=Math.max(10,this.og[va.layer]),180===this.ua?(U&&c.C(R++,Ia-db,Ja),c.C(R++,Ia,Ja),U&&c.C(R++,Ia+Ab,Ja)):90===this.ua?(U&&c.C(R++,Ia,Ja+Ab),c.C(R++,Ia,Ja),U&&c.C(R++,Ia,Ja-db)):270===this.ua?(U&&c.C(R++,Ia,Ja-db),c.C(R++,Ia,Ja),U&&c.C(R++,Ia,Ja+Ab)):(U&&c.C(R++,Ia+Ab,Ja),c.C(R++,Ia,Ja),U&&c.C(R++,Ia-db,Ja))));Na=va}if(null===k||c.computeSpot(!1)!==Tb)if(jb=
c.o(R-1).x,fb=c.o(R-1).y,Ia=c.o(R).x,Ja=c.o(R).y,Y){var mf=this.og[Aa.layer],Zb;180===this.ua||0===this.ua?(Zb=fb,Zb>=Aa.V.y&&Zb<=Aa.V.bottom&&(Ga=Aa.Ia+mf,Zb=Zb<Aa.V.y+Aa.V.height/2?Aa.V.y-this.Gd/2:Aa.V.bottom+this.Gd/2,c.C(R++,Ga,fb),c.C(R++,Ga,Zb)),c.C(R++,Ia,Zb)):(Zb=jb,Zb>=Aa.V.x&&Zb<=Aa.V.right&&(Ga=Aa.Ua+mf,Zb=Zb<Aa.V.x+Aa.V.width/2?Aa.V.x-this.Gd/2:Aa.V.right+this.Gd/2,c.C(R++,jb,Ga),c.C(R++,Zb,Ga)),c.C(R++,Zb,Ja));c.C(R++,Ia,Ja)}else U?(db=Math.max(10,this.dh[Aa.layer]),Ab=Math.max(10,this.og[Aa.layer]),
180===this.ua?(Ga=Aa.V.x+Aa.V.width,c.aa(R-2,Ga,fb),c.aa(R-1,Ga+Ab,fb)):90===this.ua?(Ga=Aa.V.y,c.aa(R-2,jb,Ga),c.aa(R-1,jb,Ga-db)):270===this.ua?(Ga=Aa.V.y+Aa.V.height,c.aa(R-2,jb,Ga),c.aa(R-1,jb,Ga+Ab)):(Ga=Aa.V.x,c.aa(R-2,Ga,fb),c.aa(R-1,Ga-db,fb))):(180===this.ua||0===this.ua?c.C(R++,Ia,fb):c.C(R++,jb,Ja),c.C(R++,Ia,Ja))}else{for(;null!==Aa&&Aa!==Na;){Pa=va=null;for(var hg=Aa.nc.k,ic;hg.next()&&(ic=hg.value,ic.link!==b.link||(va=ic.toVertex,Pa=ic.fromVertex,null!==Pa.yd&&(Pa=null),null!==va.yd)););
var jb,fb,Ia,Ja,Xa,db,Ab;if(va!==Na)if(jb=c.o(R-1).x,fb=c.o(R-1).y,Ia=va.Ia,Ja=va.Ua,Y)if(180===this.ua||0===this.ua){var nd=null!==Pa?Pa.Ua:fb;nd!==Ja&&(Xa=this.Sb[va.layer],2===R&&(Xa=0===this.ua?Math.max(Xa,jb):Math.min(Xa,jb)),c.C(R++,Xa,fb),c.C(R++,Xa,Ja))}else{var nf=null!==Pa?Pa.Ia:jb;nf!==Ia&&(Xa=this.Sb[va.layer],2===R&&(Xa=90===this.ua?Math.max(Xa,fb):Math.min(Xa,fb)),c.C(R++,jb,Xa),c.C(R++,Ia,Xa))}else db=Math.max(10,this.dh[va.layer]),Ab=Math.max(10,this.og[va.layer]),180===this.ua?(c.C(R++,
Ia+Ab,Ja),U&&c.C(R++,Ia,Ja),c.C(R++,Ia-db,Ja)):90===this.ua?(c.C(R++,Ia,Ja-db),U&&c.C(R++,Ia,Ja),c.C(R++,Ia,Ja+Ab)):270===this.ua?(c.C(R++,Ia,Ja+Ab),U&&c.C(R++,Ia,Ja),c.C(R++,Ia,Ja-db)):(c.C(R++,Ia-db,Ja),U&&c.C(R++,Ia,Ja),c.C(R++,Ia+Ab,Ja));Aa=va}Y&&(jb=c.o(R-1).x,fb=c.o(R-1).y,Ia=c.o(R).x,Ja=c.o(R).y,180===this.ua||0===this.ua?fb!==Ja&&(Xa=0===this.ua?Math.min(Math.max((Ia+jb)/2,this.Sb[Na.layer]),Ia):Math.max(Math.min((Ia+jb)/2,this.Sb[Na.layer]),Ia),c.C(R++,Xa,fb),c.C(R++,Xa,Ja)):jb!==Ia&&(Xa=
90===this.ua?Math.min(Math.max((Ja+fb)/2,this.Sb[Na.layer]),Ja):Math.max(Math.min((Ja+fb)/2,this.Sb[Na.layer]),Ja),c.C(R++,jb,Xa),c.C(R++,Ia,Xa)))}if(null!==d&&U){if(null!==h){if(c.computeSpot(!0)===Tb){var Dd=c.o(0),od=c.o(2);Dd.O(od)||c.aa(1,(Dd.x+od.x)/2,(Dd.y+od.y)/2)}O=c.getLinkPoint(f,h,Tb,!0,!1,g,k);c.aa(0,O.x,O.y)}null!==k&&(c.computeSpot(!1)===Tb&&(Dd=c.o(c.ra-1),od=c.o(c.ra-3),Dd.O(od)||c.aa(c.ra-2,(Dd.x+od.x)/2,(Dd.y+od.y)/2)),O=c.getLinkPoint(g,k,Tb,!1,!1,f,h),c.aa(c.ra-1,O.x,O.y))}c.ij();
b.commit()}}for(var Ne=new H(B),Ed=this.network.edges.k,te;Ed.next();)te=Ed.value.link,null!==te&&te.pc&&!Ne.contains(te)&&Ne.add(te);if(0<Ne.count)if(90===this.ua||270===this.ua){for(var Kf=0,Bb=new H(Fp),Cg=Ne.k,Hb,qb,Za;Cg.next();)if(Hb=Cg.value,null!==Hb&&Hb.pc)for(var yb=2;yb<Hb.ra-3;yb++)if(qb=Hb.o(yb),Za=Hb.o(yb+1),this.I(qb.y,Za.y)&&!this.I(qb.x,Za.x)){var jc=new Fp;jc.layer=Math.floor(qb.y/2);var Lf=Hb.o(0),Mf=Hb.o(Hb.ra-1);jc.gb=Lf.x*Lf.x+Lf.y;jc.he=Mf.x*Mf.x+Mf.y;jc.He=Math.min(qb.x,Za.x);
jc.be=Math.max(qb.x,Za.x);jc.index=yb;jc.link=Hb;if(yb+2<Hb.ra){var kc=Hb.o(yb-1),Vc=Hb.o(yb+2),pd=0;kc.y<qb.y?pd=Vc.y<qb.y?3:qb.x<Za.x?2:1:kc.y>qb.y&&(pd=Vc.y>qb.y?0:Za.x<qb.x?2:1);jc.wi=pd}Bb.add(jc)}if(1<Bb.count){Bb.sort(this.yG);for(var dc=0;dc<Bb.count;){for(var qd=Bb.n[dc].layer,$a=dc+1;$a<Bb.count&&Bb.n[$a].layer===qd;)$a++;if(1<$a-dc)for(var Ta=dc;Ta<$a;){for(var Qb=Bb.n[Ta].be,Ib=dc+1;Ib<$a&&Bb.n[Ib].He<Qb;)Qb=Math.max(Qb,Bb.n[Ib].be),Ib++;var Oe=Ib-Ta;if(1<Oe){Bb.gq(this.Ex,Ta,Ta+Oe);for(var Pd=
1,oc=Bb.n[Ta].he,Jb,yb=Ta;yb<Ib;yb++)Jb=Bb.n[yb],Jb.he!==oc&&(Pd++,oc=Jb.he);Bb.gq(this.xG,Ta,Ta+Oe);for(var ee=1,oc=Bb.n[Ta].gb,yb=Ta;yb<Ib;yb++)Jb=Bb.n[yb],Jb.gb!==oc&&(ee++,oc=Jb.gb);var rb,Fd;Pd<ee?(rb=!1,Fd=Pd,oc=Bb.n[Ta].he,Bb.gq(this.Ex,Ta,Ta+Oe)):(rb=!0,Fd=ee,oc=Bb.n[Ta].gb);for(var Dg=0,yb=Ta;yb<Ib;yb++){Jb=Bb.n[yb];(rb?Jb.gb:Jb.he)!==oc&&(Dg++,oc=rb?Jb.gb:Jb.he);Hb=Jb.link;qb=Hb.o(Jb.index);Za=Hb.o(Jb.index+1);var Pe=this.Lp*(Dg-(Fd-1)/2);if(!Hb.qj||Gp(qb.x,qb.y+Pe,Za.x,Za.y+Pe))Kf++,Hb.Kl(),
Hb.aa(Jb.index,qb.x,qb.y+Pe),Hb.aa(Jb.index+1,Za.x,Za.y+Pe),Hb.ij()}}Ta=Ib}dc=$a}}}else{for(var Gd=0,gb=new H(Fp),of=Ne.k,hb,sb,Wc;of.next();)if(hb=of.value,null!==hb&&hb.pc)for(var Mb=2;Mb<hb.ra-3;Mb++)if(sb=hb.o(Mb),Wc=hb.o(Mb+1),this.I(sb.x,Wc.x)&&!this.I(sb.y,Wc.y)){var Qd=new Fp;Qd.layer=Math.floor(sb.x/2);var Rd=hb.o(0),fe=hb.o(hb.ra-1);Qd.gb=Rd.x+Rd.y*Rd.y;Qd.he=fe.x+fe.y*fe.y;Qd.He=Math.min(sb.y,Wc.y);Qd.be=Math.max(sb.y,Wc.y);Qd.index=Mb;Qd.link=hb;if(Mb+2<hb.ra){var Fc=hb.o(Mb-1),ue=hb.o(Mb+
2),Gc=0;Fc.x<sb.x?Gc=ue.x<sb.x?3:sb.y<Wc.y?2:1:Fc.x>sb.x&&(Gc=ue.x>sb.x?0:Wc.y<sb.y?2:1);Qd.wi=Gc}gb.add(Qd)}if(1<gb.count){gb.sort(this.yG);for(var Cb=0;Cb<gb.count;){for(var Qe=gb.n[Cb].layer,rd=Cb+1;rd<gb.count&&gb.n[rd].layer===Qe;)rd++;if(1<rd-Cb)for(var kb=Cb;kb<rd;){for(var Hd=gb.n[kb].be,Db=Cb+1;Db<rd&&gb.n[Db].He<Hd;)Hd=Math.max(Hd,gb.n[Db].be),Db++;var Sd=Db-kb;if(1<Sd){gb.gq(this.Ex,kb,kb+Sd);for(var Id=1,lc=gb.n[kb].he,Nb,Mb=kb;Mb<Db;Mb++)Nb=gb.n[Mb],Nb.he!==lc&&(Id++,lc=Nb.he);gb.gq(this.xG,
kb,kb+Sd);for(var tb=1,lc=gb.n[kb].gb,Mb=kb;Mb<Db;Mb++)Nb=gb.n[Mb],Nb.gb!==lc&&(tb++,lc=Nb.gb);var pf,bb;Id<tb?(pf=!1,bb=Id,lc=gb.n[kb].he,gb.gq(this.Ex,kb,kb+Sd)):(pf=!0,bb=tb,lc=gb.n[kb].gb);for(var Jd=0,Mb=kb;Mb<Db;Mb++){Nb=gb.n[Mb];(pf?Nb.gb:Nb.he)!==lc&&(Jd++,lc=pf?Nb.gb:Nb.he);hb=Nb.link;sb=hb.o(Nb.index);Wc=hb.o(Nb.index+1);var Xc=this.Lp*(Jd-(bb-1)/2);if(!hb.qj||Gp(sb.x+Xc,sb.y,Wc.x+Xc,Wc.y))Gd++,hb.Kl(),hb.aa(Nb.index,sb.x+Xc,sb.y),hb.aa(Nb.index+1,Wc.x+Xc,Wc.y),hb.ij()}}kb=Db}Cb=rd}}}};
function Fp(){this.index=this.be=this.He=this.he=this.gb=this.layer=0;this.link=null;this.wi=0}t.ce(Fp,{layer:!0,gb:!0,he:!0,He:!0,be:!0,index:!0,link:!0,wi:!0});Z.prototype.yG=function(a,b){return a instanceof Fp&&b instanceof Fp&&a!==b?a.layer<b.layer?-1:a.layer>b.layer?1:a.He<b.He?-1:a.He>b.He?1:a.be<b.be?-1:a.be>b.be?1:0:0};
Z.prototype.xG=function(a,b){return a instanceof Fp&&b instanceof Fp&&a!==b?a.gb<b.gb?-1:a.gb>b.gb||a.wi<b.wi?1:a.wi>b.wi||a.He<b.He?-1:a.He>b.He?1:a.be<b.be?-1:a.be>b.be?1:0:0};Z.prototype.Ex=function(a,b){return a instanceof Fp&&b instanceof Fp&&a!==b?a.he<b.he?-1:a.he>b.he||a.wi<b.wi?1:a.wi>b.wi||a.He<b.He?-1:a.He>b.He?1:a.be<b.be?-1:a.be>b.be?1:0:0};Z.prototype.I=function(a,b){e&&(t.q(a,Z,"isApprox:a"),t.q(b,Z,"isApprox:b"));var c=a-b;return-1<c&&1>c};
function Gp(a,b,c,d){e&&(t.q(a,Z,"isUnoccupied2:px"),t.q(b,Z,"isUnoccupied2:py"),t.q(c,Z,"isUnoccupied2:qx"),t.q(d,Z,"isUnoccupied2:qy"));return!0}function Xo(a,b){var c,d=a.Xd[b];if(d>=a.ih.length){c=[];var f;for(f=0;f<a.ih.length;f++)c[f]=a.ih[f];a.ih=c}"undefined"===typeof a.ih[d]||null===a.ih[d]?c=[]:(c=a.ih[d],a.ih[d]=null);var d=a.Vr[b],g;for(f=0;f<d.length;f++)g=d[f],g instanceof Hp&&(c[g.index]=g);return c}function Yo(a,b,c){a.ih[a.Xd[b]]=c}t.g(Z,"layerSpacing",Z.prototype.layerSpacing);
t.defineProperty(Z,{layerSpacing:"layerSpacing"},function(){return this.om},function(a){this.om!==a&&(t.i(a,"number",Z,"layerSpacing"),0<=a&&(this.om=a,this.M()))});t.g(Z,"columnSpacing",Z.prototype.uI);t.defineProperty(Z,{uI:"columnSpacing"},function(){return this.Gd},function(a){this.Gd!==a&&(t.i(a,"number",Z,"columnSpacing"),0<=a&&(this.Gd=a,this.M()))});t.g(Z,"direction",Z.prototype.direction);
t.defineProperty(Z,{direction:"direction"},function(){return this.ua},function(a){this.ua!==a&&(t.i(a,"number",Z,"direction"),this.ua=a,this.M())});t.g(Z,"cycleRemoveOption",Z.prototype.GE);t.defineProperty(Z,{GE:"cycleRemoveOption"},function(){return this.Un},function(a){this.Un!==a&&(t.Fa(a,Z,Z,"cycleRemoveOption"),a===Fo||a===zo)&&(this.Un=a,this.M())});t.g(Z,"layeringOption",Z.prototype.LF);
t.defineProperty(Z,{LF:"layeringOption"},function(){return this.Do},function(a){this.Do!==a&&(t.Fa(a,Z,Z,"layeringOption"),a===Ao||a===hp||a===jp)&&(this.Do=a,this.M())});t.g(Z,"initializeOption",Z.prototype.yF);t.defineProperty(Z,{yF:"initializeOption"},function(){return this.ro},function(a){this.ro!==a&&(t.Fa(a,Z,Z,"initializeOption"),a===Bo||a===pp||a===np)&&(this.ro=a,this.M())});t.g(Z,"iterations",Z.prototype.CJ);
t.defineProperty(Z,{CJ:"iterations"},function(){return this.lm},function(a){this.lm!==a&&(t.q(a,Eo,"iterations"),0<=a&&(this.lm=a,this.M()))});t.g(Z,"aggressiveOption",Z.prototype.hE);t.defineProperty(Z,{hE:"aggressiveOption"},function(){return this.Mn},function(a){this.Mn!==a&&(t.Fa(a,Z,Z,"aggressiveOption"),a===tp||a===Co||a===up)&&(this.Mn=a,this.M())});t.g(Z,"packOption",Z.prototype.YJ);
t.defineProperty(Z,{YJ:"packOption"},function(){return this.Ti},function(a){this.Ti!==a&&(t.i(a,"number",Z,"packOption"),0<=a&&8>a&&(this.Ti=a,this.M()))});t.g(Z,"setsPortSpots",Z.prototype.Jl);t.defineProperty(Z,{Jl:"setsPortSpots"},function(){return this.Xh},function(a){this.Xh!==a&&(t.i(a,"boolean",Z,"setsPortSpots"),this.Xh=a,this.M())});t.g(Z,"linkSpacing",Z.prototype.Lp);
t.defineProperty(Z,{Lp:"linkSpacing"},function(){return this.Mj},function(a){this.Mj!==a&&(t.i(a,"number",Z,"linkSpacing"),0<=a&&(this.Mj=a,this.M()))});t.A(Z,{JJ:"maxLayer"},function(){return this.qb});t.A(Z,{OK:"maxIndex"},function(){return this.rv});t.A(Z,{NK:"maxColumn"},function(){return this.Mb});t.A(Z,{QK:"minIndexLayer"},function(){return this.Nr});t.A(Z,{PK:"maxIndexLayer"},function(){return this.Nf});var zo;Z.CycleDepthFirst=zo=t.w(Z,"CycleDepthFirst",0);var Fo;
Z.CycleGreedy=Fo=t.w(Z,"CycleGreedy",1);var Ao;Z.LayerOptimalLinkLength=Ao=t.w(Z,"LayerOptimalLinkLength",0);var hp;Z.LayerLongestPathSink=hp=t.w(Z,"LayerLongestPathSink",1);var jp;Z.LayerLongestPathSource=jp=t.w(Z,"LayerLongestPathSource",2);var Bo;Z.InitDepthFirstOut=Bo=t.w(Z,"InitDepthFirstOut",0);var pp;Z.InitDepthFirstIn=pp=t.w(Z,"InitDepthFirstIn",1);var np;Z.InitNaive=np=t.w(Z,"InitNaive",2);var tp;Z.AggressiveNone=tp=t.w(Z,"AggressiveNone",0);var Co;
Z.AggressiveLess=Co=t.w(Z,"AggressiveLess",1);var up;Z.AggressiveMore=up=t.w(Z,"AggressiveMore",2);Z.PackNone=0;var vp;Z.PackExpand=vp=1;var wp;Z.PackStraighten=wp=2;var yp;Z.PackMedian=yp=4;var Do;Z.PackAll=Do=7;function Eo(){Ea.call(this)}t.ka("LayeredDigraphNetwork",Eo);t.Qa(Eo,Ea);Eo.prototype.createVertex=function(){return new Hp};Eo.prototype.createEdge=function(){return new Ip};
function Hp(){Fa.call(this);this.index=this.column=this.layer=-1;this.component=NaN;this.near=null;this.valid=!1;this.finish=this.lp=NaN;this.Sm=0;this.ZA=this.$A=void 0}t.ka("LayeredDigraphVertex",Hp);t.Qa(Hp,Fa);function Ip(){Ha.call(this);this.forest=this.rev=this.valid=!1;this.portToPos=this.portFromPos=NaN;this.portToColOffset=this.portFromColOffset=0}t.ka("LayeredDigraphEdge",Ip);t.Qa(Ip,Ha);
function X(){0<arguments.length&&t.fd(X);Ae.call(this);this.bd=new I(Object);this.Vi=Jp;this.Lf=Kp;this.Rs=Lp;this.nv=Mp;this.cC=null;this.Fh=!0;this.hd=Np;this.gg=(new ra(10,10)).freeze();this.ya=new Op;this.xa=new Op}t.ka("TreeLayout",X);t.Qa(X,Ae);X.prototype.cloneProtected=function(a){Ae.prototype.cloneProtected.call(this,a);a.Vi=this.Vi;a.Rs=this.Rs;a.nv=this.nv;a.Fh=this.Fh;a.hd=this.hd;a.gg.assign(this.gg);a.ya.copyInheritedPropertiesFrom(this.ya);a.xa.copyInheritedPropertiesFrom(this.xa)};
X.prototype.createNetwork=function(){var a=new Pp;Ln(a,this);return a};X.prototype.makeNetwork=function(a){var b=this.createNetwork();a instanceof v?(Qp(this,b,a.vh,!0),Qp(this,b,a.links,!0)):a instanceof z?Qp(this,b,a.Vc,!1):Qp(this,b,a.k,!1);return b};
function Qp(a,b,c,d){for(c=c.k;c.next();){var f=c.value;f instanceof y&&f.canLayout()&&"Comment"!==f.cd&&(!d||f.Fp)&&(f.ni||(f instanceof z&&null===f.ic?Qp(a,b,f.Vc,!1):b.Xo(f)))}for(c.reset();c.next();)if(f=c.value,f instanceof B&&f.canLayout()&&"Comment"!==f.cd&&(!d||f.Fp)){var g=f.ca;a=f.fa;null!==g&&null!==a&&g!==a&&"Comment"!==g.cd&&"Comment"!==a.cd&&(g=b.findGroupVertex(g),a=b.findGroupVertex(a),null!==g&&null!==a&&b.sn(g,a,f))}}
X.prototype.doLayout=function(a){a||t.m("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts");null===this.network&&(this.network=this.makeNetwork(a));this.We!==Rp&&(this.Nd=this.initialOrigin(this.Nd));var b=this.h;null===b&&a instanceof v&&(b=a);this.Lf=this.path===Jp&&null!==b?b.vd?Kp:Sp:this.path===Jp?Kp:this.path;if(0<this.network.vertexes.count){this.network.Lw();for(b=this.network.vertexes.k;b.next();)a=b.value,a.initialized=!1,a.level=0,a.parent=
null,a.children=[];if(0<this.bd.count)for(b=this.bd.k,this.bd=new I(Op);b.next();)a=b.value,a instanceof y?(a=this.network.gn(a),null!==a&&this.bd.add(a)):a instanceof Op&&this.bd.add(a);if(0===this.bd.count){for(a=this.network.vertexes.k;a.next();)switch(b=a.value,this.Lf){case Kp:0===b.xc.count&&this.bd.add(b);break;case Sp:0===b.nc.count&&this.bd.add(b);break;default:t.m("Unhandled path value "+this.Lf.toString())}if(0===this.bd.count){a=999999;for(var b=null,c=this.network.vertexes.k;c.next();){var d=
c.value;switch(this.Lf){case Kp:d.xc.count<a&&(a=d.xc.count,b=d);break;case Sp:d.nc.count<a&&(a=d.nc.count,b=d);break;default:t.m("Unhandled path value "+this.Lf.toString())}}null!==b&&this.bd.add(b)}}for(b=this.bd.k;b.next();)a=b.value,a.initialized||(a.initialized=!0,Tp(this,a));for(a=this.bd.k;a.next();)Up(this,a.value);for(a=this.bd.k;a.next();)Vp(this,a.value);for(a=this.bd.k;a.next();)Wp(this,a.value);this.$z();if(this.ox===Xp){d=[];for(a=this.network.vertexes.k;a.next();){b=a.value;(c=b.parent)||
(c=b);var c=0===c.angle||180===c.angle,f=d[b.level];void 0===f&&(f=0);d[b.level]=Math.max(f,c?b.width:b.height)}for(f=0;f<d.length;f++)void 0===d[f]&&(d[f]=0);this.cC=d;for(a=this.network.vertexes.k;a.next();)b=a.value,(c=b.parent)||(c=b),0===c.angle||180===c.angle?(180===c.angle&&(b.rp+=d[b.level]-b.width),b.width=d[b.level]):(270===c.angle&&(b.sp+=d[b.level]-b.height),b.height=d[b.level])}else if(this.ox===Yp)for(a=this.network.vertexes.k;a.next();){b=a.value;c=0===b.angle||180===b.angle;d=-1;for(f=
0;f<b.children.length;f++)var g=b.children[f],d=Math.max(d,c?g.width:g.height);if(0<=d)for(f=0;f<b.children.length;f++)g=b.children[f],c?(180===b.angle&&(g.rp+=d-g.width),g.width=d):(270===b.angle&&(g.sp+=d-g.height),g.height=d)}for(a=this.bd.k;a.next();)this.layoutTree(a.value);this.arrangeTrees();this.updateParts()}this.network=null;this.bd=new I(Object);this.ff=!0};
function Tp(a,b){e&&t.l(b,Op,X,"walkTree:v");if(null!==b){switch(a.Lf){case Kp:if(0<b.nc.count){for(var c=new H(Op),d=b.NI;d.next();){var f=d.value;Zp(a,b,f)&&c.add(f)}0<c.count&&(b.children=c.Pe())}break;case Sp:if(0<b.xc.count){c=new H(Op);for(d=b.nK;d.next();)f=d.value,Zp(a,b,f)&&c.add(f);0<c.count&&(b.children=c.Pe())}break;default:t.m("Unhandled path value"+a.Lf.toString())}for(var c=b.children,d=c.length,g=0;g<d;g++)f=c[g],f.initialized=!0,f.level=b.level+1,f.parent=b,a.bd.remove(f);for(g=0;g<
d;g++)f=c[g],Tp(a,f)}}function Zp(a,b,c){e&&t.l(b,Op,X,"walkOK:v");e&&t.l(c,Op,X,"walkOK:c");if(c.initialized){var d;e&&t.l(c,Op,X,"isAncestor:a");e&&t.l(b,Op,X,"isAncestor:b");if(null===b)d=!1;else{for(d=b.parent;null!==d&&d!==c;)d=d.parent;d=d===c}if(d||c.level>b.level)return!1;a.removeChild(c.parent,c)}return!0}
X.prototype.removeChild=function(a,b){e&&t.l(a,Op,X,"removeChild:p");e&&t.l(b,Op,X,"removeChild:c");if(null!==a&&null!==b){for(var c=a.children,d=0,f=0;f<c.length;f++)c[f]===b&&d++;if(0<d){for(var d=Array(c.length-d),g=0,f=0;f<c.length;f++)c[f]!==b&&(d[g++]=c[f]);a.children=d}}};
function Up(a,b){e&&t.l(b,Op,X,"initializeTree:v");if(null!==b){a.initializeTreeVertexValues(b);b.alignment===$p&&a.sortTreeVertexChildren(b);for(var c=0,d=b.Wm,f=0,g=b.children,h=g.length,k=0;k<h;k++){var l=g[k];Up(a,l);c+=l.descendantCount+1;d=Math.max(d,l.maxChildrenCount);f=Math.max(f,l.maxGenerationCount)}b.descendantCount=c;b.maxChildrenCount=d;b.maxGenerationCount=0<d?f+1:0}}
function aq(a,b){e&&t.l(b,Op,X,"mom:v");switch(a.Rs){default:case Lp:return null!==b.parent?b.parent:a.ya;case bq:return null===b.parent?a.ya:null===b.parent.parent?a.xa:b.parent;case cq:if(null!==b.parent)return null!==b.parent.parent?b.parent.parent:a.xa;case dq:var c=!0;if(0===b.Wm)c=!1;else for(var d=b.children,f=d.length,g=0;g<f;g++)if(0<d[g].Wm){c=!1;break}return c&&null!==b.parent?a.xa:null!==b.parent?b.parent:a.ya}}
X.prototype.initializeTreeVertexValues=function(a){e&&t.l(a,Op,X,"initializeTreeVertexValues:v");var b=aq(this,a);a.copyInheritedPropertiesFrom(b);if(null!==a.parent&&a.parent.alignment===$p){for(var b=a.angle,c=a.parent.children,d=0;d<c.length&&a!==c[d];)d++;0===d%2?d!==c.length-1&&(b=90===b?180:180===b?270:270===b?180:270):b=90===b?0:180===b?90:270===b?0:90;a.angle=b}a.initialized=!0};
function Vp(a,b){e&&t.l(b,Op,X,"assignTree:v");if(null!==b){a.assignTreeVertexValues(b);for(var c=b.children,d=c.length,f=0;f<d;f++)Vp(a,c[f])}}X.prototype.assignTreeVertexValues=function(){};function Wp(a,b){e&&t.l(b,Op,X,"sortTree:v");if(null!==b){b.alignment!==$p&&a.sortTreeVertexChildren(b);for(var c=b.children,d=c.length,f=0;f<d;f++)Wp(a,c[f])}}
X.prototype.sortTreeVertexChildren=function(a){e&&t.l(a,Op,X,"sortTreeVertexChildren:v");switch(a.sorting){case eq:break;case fq:a.children.reverse();break;case gq:a.children.sort(a.comparer);break;case hq:a.children.sort(a.comparer);a.children.reverse();break;default:t.m("Unhandled sorting value "+a.sorting.toString())}};X.prototype.$z=function(){if(this.comments)for(var a=this.network.vertexes.k;a.next();)this.addComments(a.value)};
X.prototype.addComments=function(a){e&&t.l(a,Op,X,"addComments:v");var b=a.angle,c=a.parent,d=0,f=iq,f=!1;null!==c&&(d=c.angle,f=c.alignment,f=jq(f));var b=90===b||270===b,d=90===d||270===d,c=0===a.Wm,g=0,h=0,k=0,l=a.commentSpacing;if(null!==a.Jc)for(var m=a.Jc.aF();m.next();){var n=m.value;"Comment"===n.cd&&n.Wa()&&(null===a.comments&&(a.comments=[]),a.comments.push(n),n.xf(),n=n.Ha,b&&!c||!f&&!d&&c||f&&d&&c?(g=Math.max(g,n.width),h+=n.height+Math.abs(k)):(g+=n.width+Math.abs(k),h=Math.max(h,n.height)),
k=l)}null!==a.comments&&(b&&!c||!f&&!d&&c||f&&d&&c?(g+=Math.abs(a.commentMargin),h=Math.max(0,h-a.height)):(h+=Math.abs(a.commentMargin),g=Math.max(0,g-a.width)),f=t.wk(0,0,a.V.width+g,a.V.height+h),a.Tb=f,t.oc(f))};function jq(a){return a===kq||a===$p||a===lq||a===mq}function nq(a){return a===kq||a===$p}
function oq(a){e&&t.l(a,Op,X,"isLeftSideBus:v");var b=a.parent;if(null!==b){var c=b.alignment;if(jq(c)){if(nq(c)){b=b.children;for(c=0;c<b.length&&a!==b[c];)c++;return 0===c%2}if(c===lq)return!0}}return!1}
X.prototype.layoutComments=function(a){e&&t.l(a,Op,X,"layoutComments:v");if(null!==a.comments){var b=a.Jc.Ha,c=a.parent,d=a.angle,f=0,g=iq,g=!1;null!==c&&(f=c.angle,g=c.alignment,g=jq(g));for(var d=90===d||270===d,h=90===f||270===f,k=0===a.Wm,l=oq(a),m=0,n=a.comments,p=n.length,q=t.N(),r=0;r<p;r++){var c=n[r],s=c.Ha;if(d&&!k||!g&&!h&&k||g&&h&&k){if(135<f&&!g||h&&l)if(0<=a.commentMargin){q.p(a.V.x-a.commentMargin-s.width,a.V.y+m);c.move(q);for(var u=c.Cg();u.next();)c=u.value,c.vb=gc,c.zb=hc}else for(q.p(a.V.x+
2*a.Q.x-a.commentMargin,a.V.y+m),c.move(q),u=c.Cg();u.next();)c=u.value,c.vb=hc,c.zb=gc;else if(0<=a.commentMargin)for(q.p(a.V.x+2*a.Q.x+a.commentMargin,a.V.y+m),c.move(q),u=c.Cg();u.next();)c=u.value,c.vb=hc,c.zb=gc;else for(q.p(a.V.x+a.commentMargin-s.width,a.V.y+m),c.move(q),u=c.Cg();u.next();)c=u.value,c.vb=gc,c.zb=hc;m=0<=a.commentSpacing?m+(s.height+a.commentSpacing):m+(a.commentSpacing-s.height)}else{if(135<f&&!g||!h&&l)if(0<=a.commentMargin)for(q.p(a.V.x+m,a.V.y-a.commentMargin-s.height),
c.move(q),u=c.Cg();u.next();)c=u.value,c.vb=cc,c.zb=mc;else for(q.p(a.V.x+m,a.V.y+2*a.Q.y-a.commentMargin),c.move(q),u=c.Cg();u.next();)c=u.value,c.vb=mc,c.zb=cc;else if(0<=a.commentMargin)for(q.p(a.V.x+m,a.V.y+2*a.Q.y+a.commentMargin),c.move(q),u=c.Cg();u.next();)c=u.value,c.vb=mc,c.zb=cc;else for(q.p(a.V.x+m,a.V.y+a.commentMargin-s.height),c.move(q),u=c.Cg();u.next();)c=u.value,c.vb=cc,c.zb=mc;m=0<=a.commentSpacing?m+(s.width+a.commentSpacing):m+(a.commentSpacing-s.width)}}t.B(q);b=m-a.commentSpacing-
(d?b.height:b.width);if(this.Lf===Kp)for(a=a.nc;a.next();)f=a.value,(c=f.link)&&!c.qj&&(c.rk=0<b?b:NaN);else for(a=a.xc;a.next();)f=a.value,(c=f.link)&&!c.qj&&(c.xk=0<b?b:NaN)}};
X.prototype.layoutTree=function(a){e&&t.l(a,Op,X,"layoutTree:v");if(null!==a){for(var b=a.children,c=b.length,d=0;d<c;d++)this.layoutTree(b[d]);switch(a.compaction){case pq:qq(this,a);break;case rq:if(a.alignment===$p)qq(this,a);else if(e&&t.l(a,Op,X,"layoutTreeBlock:v"),0===a.Wm){var d=a.parent,b=!1,c=0,f=iq;null!==d&&(c=d.angle,f=d.alignment,b=jq(f));d=oq(a);a.qa.p(0,0);a.eb.p(a.width,a.height);null===a.parent||null===a.comments||(180!==c&&270!==c||b)&&!d?a.Na.p(0,0):180===c&&!b||(90===c||270===
c)&&d?a.Na.p(a.width-2*a.Q.x,0):a.Na.p(0,a.height-2*a.Q.y);a.It=null;a.$t=null}else{for(var g=sq(a),b=90===g||270===g,h=0,k=a.children,l=k.length,m=0;m<l;m++)var n=k[m],h=Math.max(h,b?n.eb.width:n.eb.height);var p=a.alignment,d=p===tq,q=p===uq,r=jq(p),s=Math.max(0,a.breadthLimit),c=vq(a),u=a.nodeSpacing,w=wq(a),D=a.rowSpacing,A=0;if(d||q||a.aq||a.bq&&1===a.maxGenerationCount)A=Math.max(0,a.rowIndent);var d=a.width,f=a.height,G=0,M=0,N=0,O=null,U=null,Y=0,ba=0,R=0,ya=0,Ya=0,Aa=0,Na=0,va=0,n=0;r&&!nq(p)&&
135<g&&k.reverse();if(nq(p))if(1<l)for(m=0;m<l;m++)0===m%2&&m!==l-1?va=Math.max(va,b?k[m].eb.width:k[m].eb.height):0!==m%2&&(n=Math.max(n,b?k[m].eb.width:k[m].eb.height));else 1===l&&(va=b?k[0].eb.width:k[0].eb.height);if(r){switch(p){case kq:ba=135>g?xq(a,k,va,G,M):yq(a,k,va,G,M);va=ba[0];G=ba[1];M=ba[2];break;case lq:for(m=0;m<l;m++){var n=k[m],Pa=n.eb,O=0===Aa?0:D;b?(n.qa.p(h-Pa.width,ya+O),G=Math.max(G,Pa.width),M=Math.max(M,ya+O+Pa.height),ya+=O+Pa.height):(n.qa.p(R+O,h-Pa.height),G=Math.max(G,
R+O+Pa.width),M=Math.max(M,Pa.height),R+=O+Pa.width);Aa++}break;case mq:for(m=0;m<l;m++)n=k[m],Pa=n.eb,O=0===Aa?0:D,b?(n.qa.p(u/2+a.Q.x,ya+O),G=Math.max(G,Pa.width),M=Math.max(M,ya+O+Pa.height),ya+=O+Pa.height):(n.qa.p(R+O,u/2+a.Q.y),G=Math.max(G,R+O+Pa.width),M=Math.max(M,Pa.height),R+=O+Pa.width),Aa++}O=zq(this,2);U=zq(this,2);b?(O[0].p(0,0),O[1].p(0,M),U[0].p(G,0)):(O[0].p(0,0),O[1].p(G,0),U[0].p(0,M));U[1].p(G,M)}else for(m=0;m<l;m++){n=k[m];Pa=n.eb;if(b){0<s&&0<Aa&&R+u+Pa.width>s&&(R<h&&Aq(a,
p,h-R,0,Na,m-1),Ya++,Aa=0,Na=m,N=M,R=0,ya=135<g?-M-D:M+D);Bq(this,n,0,ya);var Ga=0;if(0===Aa){if(O=n.It,U=n.$t,Y=Pa.width,ba=Pa.height,null===O||null===U||g!==sq(n))O=zq(this,2),U=zq(this,2),O[0].p(0,0),O[1].p(0,ba),U[0].p(Y,0),U[1].p(Y,ba)}else ba=Cq(this,a,n,O,U,Y,ba),Ga=ba[0],O=ba[1],U=ba[2],Y=ba[3],ba=ba[4],R<Pa.width&&0>Ga&&(Dq(a,-Ga,0,Na,m-1),Eq(O,-Ga,0),Eq(U,-Ga,0),Ga=0);n.qa.p(Ga,ya);G=Math.max(G,Y);M=Math.max(M,N+(0===Ya?0:D)+Pa.height);R=Y}else{0<s&&0<Aa&&ya+u+Pa.height>s&&(ya<h&&Aq(a,p,
0,h-ya,Na,m-1),Ya++,Aa=0,Na=m,N=G,ya=0,R=135<g?-G-D:G+D);Bq(this,n,R,0);Ga=0;if(0===Aa){if(O=n.It,U=n.$t,Y=Pa.width,ba=Pa.height,null===O||null===U||g!==sq(n))O=zq(this,2),U=zq(this,2),O[0].p(0,0),O[1].p(Y,0),U[0].p(0,ba),U[1].p(Y,ba)}else ba=Cq(this,a,n,O,U,Y,ba),Ga=ba[0],O=ba[1],U=ba[2],Y=ba[3],ba=ba[4],ya<Pa.height&&0>Ga&&(Dq(a,0,-Ga,Na,m-1),Eq(O,0,-Ga),Eq(U,0,-Ga),Ga=0);n.qa.p(R,Ga);M=Math.max(M,ba);G=Math.max(G,N+(0===Ya?0:D)+Pa.width);ya=ba}Aa++}0<Ya&&(b?(M+=Math.max(0,c),R<G&&Aq(a,p,G-R,0,
Na,l-1),0<A&&(q||Dq(a,A,0,0,l-1),G+=A)):(G+=Math.max(0,c),ya<M&&Aq(a,p,0,M-ya,Na,l-1),0<A&&(q||Dq(a,0,A,0,l-1),M+=A)));q=h=0;switch(p){case Fq:b?h+=G/2-a.Q.x-w/2:q+=M/2-a.Q.y-w/2;break;case iq:0<Ya?b?h+=G/2-a.Q.x-w/2:q+=M/2-a.Q.y-w/2:b?(m=k[0].qa.x+k[0].Na.x,va=k[l-1].qa.x+k[l-1].Na.x+2*k[l-1].Q.x,h+=m+(va-m)/2-a.Q.x-w/2):(m=k[0].qa.y+k[0].Na.y,va=k[l-1].qa.y+k[l-1].Na.y+2*k[l-1].Q.y,q+=m+(va-m)/2-a.Q.y-w/2);break;case tq:b?(h-=w,G+=w):(q-=w,M+=w);break;case uq:b?(h+=G-a.width+w,G+=w):(q+=M-a.height+
w,M+=w);break;case kq:b?h=1<l?h+(va+u/2-a.Q.x):h+(k[0].Q.x-a.Q.x+k[0].Na.x):q=1<l?q+(va+u/2-a.Q.y):q+(k[0].Q.y-a.Q.y+k[0].Na.y);break;case lq:b?h+=G+u/2-a.Q.x:q+=M+u/2-a.Q.y;break;case mq:break;default:t.m("Unhandled alignment value "+p.toString())}for(m=0;m<l;m++)n=k[m],b?n.qa.p(n.qa.x+n.Na.x-h,n.qa.y+(135<g?(r?-M:-n.eb.height)+n.Na.y-c:f+c+n.Na.y)):n.qa.p(n.qa.x+(135<g?(r?-G:-n.eb.width)+n.Na.x-c:d+c+n.Na.x),n.qa.y+n.Na.y-q);l=k=0;r?b?(G=Gq(a,G,h),0>h&&(h=0),135<g&&(q+=M+c),M+=f+c,p===mq&&(k+=u/
2+a.Q.x),l+=f+c):(135<g&&(h+=G+c),G+=d+c,M=Hq(a,M,q),0>q&&(q=0),p===mq&&(l+=u/2+a.Q.y),k+=d+c):b?(null===a.comments?d>G&&(p=Iq(p,d-G,0),k=p[0],l=p[1],G=d,h=0):G=Gq(a,G,h),0>h&&(k-=h,h=0),135<g&&(q+=M+c),M=Math.max(Math.max(M,f),M+f+c),l+=f+c):(135<g&&(h+=G+c),G=Math.max(Math.max(G,d),G+d+c),null===a.comments?f>M&&(p=Iq(p,0,f-M),k=p[0],l=p[1],M=f,q=0):M=Hq(a,M,q),0>q&&(l-=q,q=0),k+=d+c);if(0<Ya)g=zq(this,4),p=zq(this,4),b?(g[2].p(0,f+c),g[3].p(g[2].x,M),p[2].p(G,g[2].y),p[3].p(p[2].x,g[3].y)):(g[2].p(d+
c,0),g[3].p(G,g[2].y),p[2].p(g[2].x,M),p[3].p(g[3].x,p[2].y));else{g=zq(this,O.length+2);p=zq(this,U.length+2);for(m=0;m<O.length;m++)r=O[m],g[m+2].p(r.x+k,r.y+l);for(m=0;m<U.length;m++)r=U[m],p[m+2].p(r.x+k,r.y+l)}b?(g[0].p(h,0),g[1].p(g[0].x,f),g[2].y<g[1].y&&(g[2].x>g[0].x?g[2].assign(g[1]):g[1].assign(g[2])),g[3].y<g[2].y&&(g[3].x>g[0].x?g[3].assign(g[2]):g[2].assign(g[3])),p[0].p(h+d,0),p[1].p(p[0].x,f),p[2].y<p[1].y&&(p[2].x<p[0].x?p[2].assign(p[1]):p[1].assign(p[2])),p[3].y<p[2].y&&(p[3].x<
p[0].x?p[3].assign(p[2]):p[2].assign(p[3])),g[2].y-=c/2,p[2].y-=c/2):(g[0].p(0,q),g[1].p(d,g[0].y),g[2].x<g[1].x&&(g[2].y>g[0].y?g[2].assign(g[1]):g[1].assign(g[2])),g[3].x<g[2].x&&(g[3].y>g[0].y?g[3].assign(g[2]):g[2].assign(g[3])),p[0].p(0,q+f),p[1].p(d,p[0].y),p[2].x<p[1].x&&(p[2].y<p[0].y?p[2].assign(p[1]):p[1].assign(p[2])),p[3].x<p[2].x&&(p[3].y<p[0].y?p[3].assign(p[2]):p[2].assign(p[3])),g[2].x-=c/2,p[2].x-=c/2);Jq(this,O);Jq(this,U);a.It=g;a.$t=p;a.Na.p(h,q);a.eb.p(G,M)}break;default:t.m("Unhandled compaction value "+
a.compaction.toString())}}};
function qq(a,b){e&&t.l(b,Op,X,"layoutTreeNone:v");if(0===b.Wm){var c=!1,d=0,f=iq;null!==b.parent&&(d=b.parent.angle,f=b.parent.alignment,c=jq(f));f=oq(b);b.qa.p(0,0);b.eb.p(b.width,b.height);null===b.parent||null===b.comments||(180!==d&&270!==d||c)&&!f?b.Na.p(0,0):180===d&&!c||(90===d||270===d)&&f?b.Na.p(b.width-2*b.Q.x,0):b.Na.p(0,b.height-2*b.Q.y)}else{for(var c=sq(b),d=90===c||270===c,g=0,f=b.children,h=f.length,k=0;k<h;k++)var l=f[k],g=Math.max(g,d?l.eb.width:l.eb.height);var m=b.alignment,n=
m===tq,p=m===uq,q=jq(m),r=Math.max(0,b.breadthLimit),s=vq(b),u=b.nodeSpacing,w=wq(b),D=n||p?0:w/2,A=b.rowSpacing,G=0;if(n||p||b.aq||b.bq&&1===b.maxGenerationCount)G=Math.max(0,b.rowIndent);var n=b.width,M=b.height,N=0,O=0,U=0,Y=0,ba=0,R=0,ya=0,Ya=0,Aa=0,Na=0;q&&!nq(m)&&135<c&&f.reverse();if(nq(m))if(1<h)for(k=0;k<h;k++){var l=f[k],va=l.eb;0===k%2&&k!==h-1?Aa=Math.max(Aa,(d?va.width:va.height)+Kq(l)-u):0!==k%2&&(Na=Math.max(Na,(d?va.width:va.height)+Kq(l)-u))}else 1===h&&(Aa=d?f[0].eb.width:f[0].eb.height);
if(q)switch(m){case kq:case $p:O=135>c?xq(b,f,Aa,N,O):yq(b,f,Aa,N,O);Aa=O[0];N=O[1];O=O[2];break;case lq:for(k=0;k<h;k++)l=f[k],va=l.eb,r=0===ya?0:A,d?(l.qa.p(g-va.width,ba+r),N=Math.max(N,va.width),O=Math.max(O,ba+r+va.height),ba+=r+va.height):(l.qa.p(Y+r,g-va.height),N=Math.max(N,Y+r+va.width),O=Math.max(O,va.height),Y+=r+va.width),ya++;break;case mq:for(g=0;g<h;g++)l=f[g],va=l.eb,r=0===ya?0:A,d?(l.qa.p(u/2+b.Q.x,ba+r),N=Math.max(N,va.width),O=Math.max(O,ba+r+va.height),ba+=r+va.height):(l.qa.p(Y+
r,u/2+b.Q.y),N=Math.max(N,Y+r+va.width),O=Math.max(O,va.height),Y+=r+va.width),ya++}else for(k=0;k<h;k++)l=f[k],va=l.eb,d?(0<r&&0<ya&&Y+u+va.width>r&&(Y<g&&Aq(b,m,g-Y,0,Ya,k-1),R++,ya=0,Ya=k,U=O,Y=0,ba=135<c?-O-A:O+A),Na=0===ya?D:u,Bq(a,l,0,ba),l.qa.p(Y+Na,ba),N=Math.max(N,Y+Na+va.width),O=Math.max(O,U+(0===R?0:A)+va.height),Y+=Na+va.width):(0<r&&0<ya&&ba+u+va.height>r&&(ba<g&&Aq(b,m,0,g-ba,Ya,k-1),R++,ya=0,Ya=k,U=N,ba=0,Y=135<c?-N-A:N+A),Na=0===ya?D:u,Bq(a,l,Y,0),l.qa.p(Y,ba+Na),O=Math.max(O,ba+
Na+va.height),N=Math.max(N,U+(0===R?0:A)+va.width),ba+=Na+va.height),ya++;0<R&&(d?(O+=Math.max(0,s),Y<N&&Aq(b,m,N-Y,0,Ya,h-1),0<G&&(p||Dq(b,G,0,0,h-1),N+=G)):(N+=Math.max(0,s),ba<O&&Aq(b,m,0,O-ba,Ya,h-1),0<G&&(p||Dq(b,0,G,0,h-1),O+=G)));G=p=0;switch(m){case Fq:d?p+=N/2-b.Q.x-w/2:G+=O/2-b.Q.y-w/2;break;case iq:0<R?d?p+=N/2-b.Q.x-w/2:G+=O/2-b.Q.y-w/2:d?(m=f[0].qa.x+f[0].Na.x,u=f[h-1].qa.x+f[h-1].Na.x+2*f[h-1].Q.x,p+=m+(u-m)/2-b.Q.x-w/2):(m=f[0].qa.y+f[0].Na.y,u=f[h-1].qa.y+f[h-1].Na.y+2*f[h-1].Q.y,
G+=m+(u-m)/2-b.Q.y-w/2);break;case tq:d?(p-=w,N+=w):(G-=w,O+=w);break;case uq:d?(p+=N-b.width+w,N+=w):(G+=O-b.height+w,O+=w);break;case kq:case $p:d?p=1<h?p+(Aa+u/2-b.Q.x):p+(f[0].Q.x-b.Q.x+f[0].Na.x):G=1<h?G+(Aa+u/2-b.Q.y):G+(f[0].Q.y-b.Q.y+f[0].Na.y);break;case lq:d?p+=N+u/2-b.Q.x:G+=O+u/2-b.Q.y;break;case mq:break;default:t.m("Unhandled alignment value "+m.toString())}for(k=0;k<h;k++)l=f[k],d?l.qa.p(l.qa.x+l.Na.x-p,l.qa.y+(135<c?(q?-O:-l.eb.height)+l.Na.y-s:M+s+l.Na.y)):l.qa.p(l.qa.x+(135<c?(q?
-N:-l.eb.width)+l.Na.x-s:n+s+l.Na.x),l.qa.y+l.Na.y-G);d?(N=Gq(b,N,p),0>p&&(p=0),135<c&&(G+=O+s),O+=M+s):(135<c&&(p+=N+s),N+=n+s,O=Hq(b,O,G),0>G&&(G=0));b.Na.p(p,G);b.eb.p(N,O)}}
function xq(a,b,c,d,f){e&&t.l(a,Op,X,"layoutBusChildrenPosDir:v");var g=b.length;if(0===g)return a=[],a[0]=c,a[1]=d,a[2]=f,a;if(1===g){var h=b[0];d=h.eb.width;f=h.eb.height;a=[];a[0]=c;a[1]=d;a[2]=f;return a}for(var k=a.nodeSpacing,l=a.rowSpacing,m=90===sq(a),n=0,p=0,q=0,r=0;r<g;r++)if(!(0!==r%2||1<g&&r===g-1)){var h=b[r],s=h.eb,u=0===n?0:l;if(m){var w=Kq(h)-k;h.qa.p(c-(s.width+w),q+u);d=Math.max(d,s.width+w);f=Math.max(f,q+u+s.height);q+=u+s.height}else w=Kq(h)-k,h.qa.p(p+u,c-(s.height+w)),f=Math.max(f,
s.height+w),d=Math.max(d,p+u+s.width),p+=u+s.width;n++}var n=0,D=p,A=q;m?(p=c+k,q=0):(p=0,q=c+k);for(r=0;r<g;r++)0!==r%2&&(h=b[r],s=h.eb,u=0===n?0:l,m?(w=Kq(h)-k,h.qa.p(p+w,q+u),d=Math.max(d,p+s.width+w),f=Math.max(f,q+u+s.height),q+=u+s.height):(w=Kq(h)-k,h.qa.p(p+u,q+w),d=Math.max(d,p+u+s.width),f=Math.max(f,q+s.height+w),p+=u+s.width),n++);1<g&&1===g%2&&(h=b[g-1],s=h.eb,b=Lq(h,m?Math.max(Math.abs(A),Math.abs(q)):Math.max(Math.abs(D),Math.abs(p))),m?(h.qa.p(c+k/2-h.Q.x-h.Na.x,f+b),m=c+k/2-h.Q.x-
h.Na.x,d=Math.max(d,m+s.width),0>m&&(d-=m),f=Math.max(f,Math.max(A,q)+b+s.height),0>h.qa.x&&(c=Rq(a,h.qa.x,!1,c,k))):(h.qa.p(d+b,c+k/2-h.Q.y-h.Na.y),d=Math.max(d,Math.max(D,p)+b+s.width),m=c+k/2-h.Q.y-h.Na.y,f=Math.max(f,m+s.height),0>m&&(f-=m),0>h.qa.y&&(c=Rq(a,h.qa.y,!0,c,k))));a=[];a[0]=c;a[1]=d;a[2]=f;return a}
function yq(a,b,c,d,f){e&&t.l(a,Op,X,"layoutBusChildrenNegDir:v");var g=b.length;if(0===g)return a=[],a[0]=c,a[1]=d,a[2]=f,a;if(1===g){var h=b[0];d=h.eb.width;f=h.eb.height;a=[];a[0]=c;a[1]=d;a[2]=f;return a}for(var k=a.nodeSpacing,l=a.rowSpacing,m=270===sq(a),n=0,p=0,q=0,r=0;r<g;r++)if(!(0!==r%2||1<g&&r===g-1)){var h=b[r],s=h.eb,u=0===n?0:l;if(m){var w=Kq(h)-k,q=q-(u+s.height);h.qa.p(c-(s.width+w),q);d=Math.max(d,s.width+w);f=Math.max(f,Math.abs(q))}else w=Kq(h)-k,p-=u+s.width,h.qa.p(p,c-(s.height+
w)),f=Math.max(f,s.height+w),d=Math.max(d,Math.abs(p));n++}var n=0,D=p,A=q;m?(p=c+k,q=0):(p=0,q=c+k);for(r=0;r<g;r++)0!==r%2&&(h=b[r],s=h.eb,u=0===n?0:l,m?(w=Kq(h)-k,q-=u+s.height,h.qa.p(p+w,q),d=Math.max(d,p+s.width+w),f=Math.max(f,Math.abs(q))):(w=Kq(h)-k,p-=u+s.width,h.qa.p(p,q+w),f=Math.max(f,q+s.height+w),d=Math.max(d,Math.abs(p))),n++);1<g&&1===g%2&&(h=b[g-1],s=h.eb,l=Lq(h,m?Math.max(Math.abs(A),Math.abs(q)):Math.max(Math.abs(D),Math.abs(p))),m?(h.qa.p(c+k/2-h.Q.x-h.Na.x,-f-s.height-l),p=c+
k/2-h.Q.x-h.Na.x,d=Math.max(d,p+s.width),0>p&&(d-=p),f=Math.max(f,Math.abs(Math.min(A,q))+l+s.height),0>h.qa.x&&(c=Rq(a,h.qa.x,!1,c,k))):(h.qa.p(-d-s.width-l,c+k/2-h.Q.y-h.Na.y),d=Math.max(d,Math.abs(Math.min(D,p))+l+s.width),p=c+k/2-h.Q.y-h.Na.y,f=Math.max(f,p+s.height),0>p&&(f-=p),0>h.qa.y&&(c=Rq(a,h.qa.y,!0,c,k))));for(r=0;r<g;r++)h=b[r],m?h.qa.p(h.qa.x,h.qa.y+f):h.qa.p(h.qa.x+d,h.qa.y);a=[];a[0]=c;a[1]=d;a[2]=f;return a}
function Kq(a){e&&t.l(a,Op,X,"fixRelativePostions:child");return null===a.parent?0:a.parent.nodeSpacing}function Lq(a){e&&t.l(a,Op,X,"fixRelativePostions:lastchild");return null===a.parent?0:a.parent.rowSpacing}function Rq(a,b,c,d,f){e&&t.l(a,Op,X,"fixRelativePostions:v");a=a.children;for(var g=a.length,h=0;h<g;h++)c?a[h].qa.p(a[h].qa.x,a[h].qa.y-b):a[h].qa.p(a[h].qa.x-b,a[h].qa.y);b=a[g-1];return Math.max(d,c?b.Na.y+b.Q.y-f/2:b.Na.x+b.Q.x-f/2)}
function Gq(a,b,c){e&&t.l(a,Op,X,"calculateSubwidth:v");switch(a.alignment){case iq:case Fq:var d=b;c+a.width>d&&(d=c+a.width);0>c&&(d-=c);return d;case tq:return a.width>b?a.width:b;case uq:return 2*a.Q.x>b?a.width:b+a.width-2*a.Q.x;case kq:case $p:return d=Math.min(0,c),c=Math.max(b,c+a.width),Math.max(a.width,c-d);case lq:return a.width-a.Q.x+a.nodeSpacing/2+b;case mq:return Math.max(a.width,a.Q.x+a.nodeSpacing/2+b);default:return b}}
function Hq(a,b,c){e&&t.l(a,Op,X,"calculateSubheight:v");switch(a.alignment){case iq:case Fq:var d=b;c+a.height>d&&(d=c+a.height);0>c&&(d-=c);return d;case tq:return a.height>b?a.height:b;case uq:return 2*a.Q.y>b?a.height:b+a.height-2*a.Q.y;case kq:case $p:return d=Math.min(0,c),c=Math.max(b,c+a.height),Math.max(a.height,c-d);case lq:return a.height-a.Q.y+a.nodeSpacing/2+b;case mq:return Math.max(a.height,a.Q.y+a.nodeSpacing/2+b);default:return b}}
function Iq(a,b,c){e&&t.l(a,oa,X,"alignOffset:align");switch(a){case Fq:b/=2;c/=2;break;case iq:b/=2;c/=2;break;case tq:c=b=0;break;case uq:break;default:t.m("Unhandled alignment value "+a.toString())}a=[];a[0]=b;a[1]=c;return a}function Aq(a,b,c,d,f,g){e&&t.l(a,Op,X,"shiftRelPosAlign:v");e&&t.l(b,oa,X,"shiftRelPosAlign:align");b=Iq(b,c,d);Dq(a,b[0],b[1],f,g)}function Dq(a,b,c,d,f){e&&t.l(a,Op,X,"shiftRelPos:v");if(0!==b||0!==c)for(a=a.children;d<=f;d++){var g=a[d].qa;g.x+=b;g.y+=c}}
function Bq(a,b,c,d){e&&(t.l(b,Op,X,"recordMidPoints:v"),t.i(c,"number",X,"recordMidPoints:x"),t.i(d,"number",X,"recordMidPoints:y"));var f=b.parent;switch(a.Lf){case Kp:for(a=b.xc;a.next();)b=a.value,b.fromVertex===f&&b.fs.p(c,d);break;case Sp:for(a=b.nc;a.next();)b=a.value,b.toVertex===f&&b.fs.p(c,d);break;default:t.m("Unhandled path value "+a.Lf.toString())}}function Eq(a,b,c){for(var d=0;d<a.length;d++){var f=a[d];f.x+=b;f.y+=c}}
function Cq(a,b,c,d,f,g,h){e&&t.l(b,Op,X,"mergeFringes:parent");e&&t.l(c,Op,X,"mergeFringes:child");var k=sq(b),l=90===k||270===k,m=b.nodeSpacing;b=d;var n=f;d=g;f=h;var p=c.It,q=c.$t;h=c.eb;var r=l?Math.max(f,h.height):Math.max(d,h.width);if(null===p||k!==sq(c))p=zq(a,2),q=zq(a,2),l?(p[0].p(0,0),p[1].p(0,h.height),q[0].p(h.width,0),q[1].p(q[0].x,p[1].y)):(p[0].p(0,0),p[1].p(h.width,0),q[0].p(0,h.height),q[1].p(p[1].x,q[0].y));if(l){c=d;d=9999999;if(!(null===n||2>n.length||null===p||2>p.length))for(g=
f=0;f<n.length&&g<p.length;){var k=n[f],s=p[g],l=s.x,u=s.y,l=l+c,w=k;f+1<n.length&&(w=n[f+1]);var D=s,s=D.x,D=D.y;g+1<p.length&&(D=p[g+1],s=D.x,D=D.y,s+=c);var A=d;k.y===u?A=l-k.x:k.y>u&&k.y<D?A=l+(k.y-u)/(D-u)*(s-l)-k.x:u>k.y&&u<w.y&&(A=l-(k.x+(u-k.y)/(w.y-k.y)*(w.x-k.x)));A<d&&(d=A);w.y<=k.y?f++:D<=u?g++:(w.y<=D&&f++,D<=w.y&&g++)}c-=d;c+=m;f=p;g=c;if(null===b||2>b.length||null===f||2>f.length)d=null;else{m=zq(a,b.length+f.length);for(d=l=k=0;l<f.length&&f[l].y<b[0].y;)u=f[l++],m[d++].p(u.x+g,u.y);
for(;k<b.length;)u=b[k++],m[d++].p(u.x,u.y);for(k=b[b.length-1].y;l<f.length&&f[l].y<=k;)l++;for(;l<f.length&&f[l].y>k;)u=f[l++],m[d++].p(u.x+g,u.y);f=zq(a,d);for(k=0;k<d;k++)f[k].assign(m[k]);Jq(a,m);d=f}l=q;u=c;if(null===n||2>n.length||null===l||2>l.length)f=null;else{m=zq(a,n.length+l.length);for(g=w=f=0;f<n.length&&n[f].y<l[0].y;)k=n[f++],m[g++].p(k.x,k.y);for(;w<l.length;)k=l[w++],m[g++].p(k.x+u,k.y);for(l=l[l.length-1].y;f<n.length&&n[f].y<=l;)f++;for(;f<n.length&&n[f].y>l;)k=n[f++],m[g++].p(k.x,
k.y);k=zq(a,g);for(f=0;f<g;f++)k[f].assign(m[f]);Jq(a,m);f=k}g=Math.max(0,c)+h.width;h=r}else{c=f;d=9999999;if(!(null===n||2>n.length||null===p||2>p.length))for(g=f=0;f<n.length&&g<p.length;)k=n[f],s=p[g],l=s.x,u=s.y,u+=c,w=k,f+1<n.length&&(w=n[f+1]),D=s,s=D.x,D=D.y,g+1<p.length&&(D=p[g+1],s=D.x,D=D.y,D+=c),A=d,k.x===l?A=u-k.y:k.x>l&&k.x<s?A=u+(k.x-l)/(s-l)*(D-u)-k.y:l>k.x&&l<w.x&&(A=u-(k.y+(l-k.x)/(w.x-k.x)*(w.y-k.y))),A<d&&(d=A),w.x<=k.x?f++:s<=l?g++:(w.x<=s&&f++,s<=w.x&&g++);c-=d;c+=m;f=p;g=c;
if(null===b||2>b.length||null===f||2>f.length)d=null;else{m=zq(a,b.length+f.length);for(d=l=k=0;l<f.length&&f[l].x<b[0].x;)u=f[l++],m[d++].p(u.x,u.y+g);for(;k<b.length;)u=b[k++],m[d++].p(u.x,u.y);for(k=b[b.length-1].x;l<f.length&&f[l].x<=k;)l++;for(;l<f.length&&f[l].x>k;)u=f[l++],m[d++].p(u.x,u.y+g);f=zq(a,d);for(k=0;k<d;k++)f[k].assign(m[k]);Jq(a,m);d=f}l=q;u=c;if(null===n||2>n.length||null===l||2>l.length)f=null;else{m=zq(a,n.length+l.length);for(g=w=f=0;f<n.length&&n[f].x<l[0].x;)k=n[f++],m[g++].p(k.x,
k.y);for(;w<l.length;)k=l[w++],m[g++].p(k.x,k.y+u);for(l=l[l.length-1].x;f<n.length&&n[f].x<=l;)f++;for(;f<n.length&&n[f].x>l;)k=n[f++],m[g++].p(k.x,k.y);k=zq(a,g);for(f=0;f<g;f++)k[f].assign(m[f]);Jq(a,m);f=k}g=r;h=Math.max(0,c)+h.height}Jq(a,b);Jq(a,p);Jq(a,n);Jq(a,q);a=[];a[0]=c;a[1]=d;a[2]=f;a[3]=g;a[4]=h;return a}function zq(a,b){a.Ls||(a.Ls=[]);var c=a.Ls[b];if(void 0!==c&&(c=c.pop(),void 0!==c))return c;for(var c=[],d=0;d<b;d++)c[d]=new E;return c}
function Jq(a,b){if(a.Ls){var c=b.length,d=a.Ls[c];void 0===d&&(d=[],a.Ls[c]=d);d.push(b)}}
X.prototype.arrangeTrees=function(){if(this.hd===Rp)for(var a=this.bd.k;a.next();){var b=a.value,c=b.Jc;if(null!==c){var d=c.position,c=d.x,d=d.y;isFinite(c)||(c=0);isFinite(d)||(d=0);Sq(this,b,c,d)}}else for(a=this.Nd,c=a.x,d=a.y,a=this.bd.k;a.next();)switch(b=a.value,Sq(this,b,c+b.Na.x,d+b.Na.y),this.hd){case Np:d+=b.eb.height+this.gg.height;break;case Tq:c+=b.eb.width+this.gg.width;break;default:t.m("Unhandled arrangement value "+this.hd.toString())}};
function Sq(a,b,c,d){if(null!==b){e&&t.l(b,Op,X,"assignAbsolutePositions:v");b.x=c;b.y=d;b=b.children;for(var f=b.length,g=0;g<f;g++){var h=b[g];Sq(a,h,c+h.qa.x,d+h.qa.y)}}}X.prototype.commitLayout=function(){this.xB();this.commitNodes();this.gA();this.Ft&&this.commitLinks()};X.prototype.commitNodes=function(){for(var a=this.network.vertexes.k,b;a.next();)b=a.value,b.commit();for(a.reset();a.next();)b=a.value,this.layoutComments(b)};
X.prototype.gA=function(){if(this.ox===Xp){for(var a=this.cC,b=[],c=null,d=this.network.vertexes.k;d.next();){var f=d.value;null===c?c=f.Tb.copy():c.yj(f.Tb);var g=b[f.level],g=void 0===g?vq(f):Math.max(g,vq(f));b[f.level]=g}for(d=0;d<b.length;d++)void 0===b[d]&&(b[d]=0);90===this.angle||270===this.angle?(c.Wf(this.nodeSpacing/2,this.layerSpacing),f=new E(-this.nodeSpacing/2,-this.layerSpacing/2)):(c.Wf(this.layerSpacing,this.nodeSpacing/2),f=new E(-this.layerSpacing/2,-this.nodeSpacing/2));var g=
[],c=90===this.angle||270===this.angle?c.width:c.height,h=0;if(180===this.angle||270===this.angle)for(d=0;d<a.length;d++)h+=a[d]+b[d];for(d=0;d<a.length;d++){var k=a[d]+b[d];270===this.angle?(h-=k,g.push(new F(0,h,c,k))):90===this.angle?(g.push(new F(0,h,c,k)),h+=k):180===this.angle?(h-=k,g.push(new F(h,0,k,c))):(g.push(new F(h,0,k,c)),h+=k)}this.commitLayers(g,f)}};X.prototype.commitLayers=function(){};X.prototype.commitLinks=function(){for(var a=this.network.edges.k;a.next();)a.value.commit()};
X.prototype.xB=function(){for(var a=this.bd.k;a.next();)Uq(this,a.value)};function Uq(a,b){if(null!==b){e&&t.l(b,Op,X,"setPortSpotsTree:v");a.setPortSpots(b);for(var c=b.children,d=c.length,f=0;f<d;f++)Uq(a,c[f])}}
X.prototype.setPortSpots=function(a){e&&t.l(a,Op,X,"setPortSpots:v");var b=a.alignment;if(jq(b)){e&&t.l(a,Op,X,"setPortSpotsBus:v");e&&t.l(b,oa,X,"setPortSpots:align");var c=this.Lf===Kp,d=sq(a),f;switch(d){case 0:f=hc;break;case 90:f=mc;break;case 180:f=gc;break;default:f=cc}var g=a.children,h=g.length;switch(b){case kq:case $p:for(b=0;b<h;b++){var k=g[b],k=c?k.xc:k.nc;if(k.next()){var l=k.value,l=l.link;if(null!==l){var m=90===d||270===d?gc:cc;if(1===h||b===h-1&&1===h%2)switch(d){case 0:m=gc;break;
case 90:m=cc;break;case 180:m=hc;break;default:m=mc}else 0===b%2&&(m=90===d||270===d?hc:mc);c?(a.setsPortSpot&&(l.vb=f),a.setsChildPortSpot&&(l.zb=m)):(a.setsPortSpot&&(l.vb=m),a.setsChildPortSpot&&(l.zb=f))}}}break;case lq:m=90===d||270===d?hc:mc;for(k=c?a.nc:a.xc;k.next();)l=k.value,l=l.link,null!==l&&(c?(a.setsPortSpot&&(l.vb=f),a.setsChildPortSpot&&(l.zb=m)):(a.setsPortSpot&&(l.vb=m),a.setsChildPortSpot&&(l.zb=f)));break;case mq:for(m=90===d||270===d?gc:cc,k=c?a.nc:a.xc;k.next();)l=k.value,l=
l.link,null!==l&&(c?(a.setsPortSpot&&(l.vb=f),a.setsChildPortSpot&&(l.zb=m)):(a.setsPortSpot&&(l.vb=m),a.setsChildPortSpot&&(l.zb=f)))}}else if(c=sq(a),this.Lf===Kp)for(d=a.nc;d.next();){if(f=d.value,f=f.link,null!==f){if(a.setsPortSpot)if(a.portSpot.Tc())switch(c){case 0:f.vb=hc;break;case 90:f.vb=mc;break;case 180:f.vb=gc;break;default:f.vb=cc}else f.vb=a.portSpot;if(a.setsChildPortSpot)if(a.childPortSpot.Tc())switch(c){case 0:f.zb=gc;break;case 90:f.zb=cc;break;case 180:f.zb=hc;break;default:f.zb=
mc}else f.zb=a.childPortSpot}}else for(d=a.xc;d.next();)if(f=d.value,f=f.link,null!==f){if(a.setsPortSpot)if(a.portSpot.Tc())switch(c){case 0:f.zb=hc;break;case 90:f.zb=mc;break;case 180:f.zb=gc;break;default:f.zb=cc}else f.zb=a.portSpot;if(a.setsChildPortSpot)if(a.childPortSpot.Tc())switch(c){case 0:f.vb=gc;break;case 90:f.vb=cc;break;case 180:f.vb=hc;break;default:f.vb=mc}else f.vb=a.childPortSpot}};function sq(a){a=a.angle;return 45>=a?0:135>=a?90:225>=a?180:315>=a?270:0}
function vq(a){e&&t.l(a,Op,X,"computeLayerSpacing:v");var b=sq(a),b=90===b||270===b,c=a.layerSpacing;if(0<a.layerSpacingParentOverlap)var d=Math.min(1,a.layerSpacingParentOverlap),c=c-(b?a.height*d:a.width*d);c<(b?-a.height:-a.width)&&(c=b?-a.height:-a.width);return c}function wq(a){e&&t.l(a,Op,X,"computeNodeIndent:v");var b=sq(a),b=90===b||270===b,c=a.nodeIndent;if(0<a.nodeIndentPastParent)var d=Math.min(1,a.nodeIndentPastParent),c=c+(b?a.width*d:a.height*d);return c=Math.max(0,c)}
t.g(X,"roots",X.prototype.iK);t.defineProperty(X,{iK:"roots"},function(){return this.bd},function(a){this.bd!==a&&(t.l(a,I,X,"roots"),this.bd=a,this.M())});t.g(X,"path",X.prototype.path);t.defineProperty(X,{path:"path"},function(){return this.Vi},function(a){this.Vi!==a&&(t.Fa(a,X,X,"path"),this.Vi=a,this.M())});t.g(X,"treeStyle",X.prototype.bH);
t.defineProperty(X,{bH:"treeStyle"},function(){return this.Rs},function(a){this.hd!==a&&(t.Fa(a,X,X,"treeStyle"),a===Lp||a===cq||a===dq||a===bq)&&(this.Rs=a,this.M())});t.g(X,"layerStyle",X.prototype.ox);t.defineProperty(X,{ox:"layerStyle"},function(){return this.nv},function(a){this.hd!==a&&(t.Fa(a,X,X,"layerStyle"),a===Mp||a===Yp||a===Xp)&&(this.nv=a,this.M())});t.g(X,"comments",X.prototype.comments);
t.defineProperty(X,{comments:"comments"},function(){return this.Fh},function(a){this.Fh!==a&&(t.i(a,"boolean",X,"comments"),this.Fh=a,this.M())});t.g(X,"arrangement",X.prototype.We);t.defineProperty(X,{We:"arrangement"},function(){return this.hd},function(a){this.hd!==a&&(t.Fa(a,X,X,"arrangement"),a===Np||a===Tq||a===Rp)&&(this.hd=a,this.M())});t.g(X,"arrangementSpacing",X.prototype.sw);
t.defineProperty(X,{sw:"arrangementSpacing"},function(){return this.gg},function(a){t.l(a,ra,X,"arrangementSpacing");this.gg.O(a)||(this.gg.assign(a),this.M())});t.g(X,"rootDefaults",X.prototype.hK);t.defineProperty(X,{hK:"rootDefaults"},function(){return this.ya},function(a){this.ya!==a&&(t.l(a,Op,X,"rootDefaults"),this.ya=a,this.M())});t.g(X,"alternateDefaults",X.prototype.dI);
t.defineProperty(X,{dI:"alternateDefaults"},function(){return this.xa},function(a){this.xa!==a&&(t.l(a,Op,X,"alternateDefaults"),this.xa=a,this.M())});t.g(X,"sorting",X.prototype.sorting);t.defineProperty(X,{sorting:"sorting"},function(){return this.ya.sorting},function(a){this.ya.sorting!==a&&(t.Fa(a,X,X,"sorting"),a===eq||a===fq||a===gq||hq)&&(this.ya.sorting=a,this.M())});t.g(X,"comparer",X.prototype.comparer);
t.defineProperty(X,{comparer:"comparer"},function(){return this.ya.comparer},function(a){this.ya.comparer!==a&&(t.i(a,"function",X,"comparer"),this.ya.comparer=a,this.M())});t.g(X,"angle",X.prototype.angle);t.defineProperty(X,{angle:"angle"},function(){return this.ya.angle},function(a){this.ya.angle!==a&&(t.i(a,"number",X,"angle"),0===a||90===a||180===a||270===a)&&(this.ya.angle=a,this.M())});t.g(X,"alignment",X.prototype.alignment);
t.defineProperty(X,{alignment:"alignment"},function(){return this.ya.alignment},function(a){this.ya.alignment!==a&&(t.Fa(a,X,X,"alignment"),this.ya.alignment=a,this.M())});t.g(X,"nodeIndent",X.prototype.nodeIndent);t.defineProperty(X,{nodeIndent:"nodeIndent"},function(){return this.ya.nodeIndent},function(a){this.ya.nodeIndent!==a&&(t.i(a,"number",X,"nodeIndent"),0<=a&&(this.ya.nodeIndent=a,this.M()))});t.g(X,"nodeIndentPastParent",X.prototype.nodeIndentPastParent);
t.defineProperty(X,{nodeIndentPastParent:"nodeIndentPastParent"},function(){return this.ya.nodeIndentPastParent},function(a){this.ya.nodeIndentPastParent!==a&&(t.i(a,"number",X,"nodeIndentPastParent"),0<=a&&1>=a&&(this.ya.nodeIndentPastParent=a,this.M()))});t.g(X,"nodeSpacing",X.prototype.nodeSpacing);t.defineProperty(X,{nodeSpacing:"nodeSpacing"},function(){return this.ya.nodeSpacing},function(a){this.ya.nodeSpacing!==a&&(t.i(a,"number",X,"nodeSpacing"),this.ya.nodeSpacing=a,this.M())});
t.g(X,"layerSpacing",X.prototype.layerSpacing);t.defineProperty(X,{layerSpacing:"layerSpacing"},function(){return this.ya.layerSpacing},function(a){this.ya.layerSpacing!==a&&(t.i(a,"number",X,"layerSpacing"),this.ya.layerSpacing=a,this.M())});t.g(X,"layerSpacingParentOverlap",X.prototype.layerSpacingParentOverlap);
t.defineProperty(X,{layerSpacingParentOverlap:"layerSpacingParentOverlap"},function(){return this.ya.layerSpacingParentOverlap},function(a){this.ya.layerSpacingParentOverlap!==a&&(t.i(a,"number",X,"layerSpacingParentOverlap"),0<=a&&1>=a&&(this.ya.layerSpacingParentOverlap=a,this.M()))});t.g(X,"compaction",X.prototype.compaction);
t.defineProperty(X,{compaction:"compaction"},function(){return this.ya.compaction},function(a){this.ya.compaction!==a&&(t.Fa(a,X,X,"compaction"),a===pq||a===rq)&&(this.ya.compaction=a,this.M())});t.g(X,"breadthLimit",X.prototype.breadthLimit);t.defineProperty(X,{breadthLimit:"breadthLimit"},function(){return this.ya.breadthLimit},function(a){this.ya.breadthLimit!==a&&(t.i(a,"number",X,"breadthLimit"),0<=a&&(this.ya.breadthLimit=a,this.M()))});t.g(X,"rowSpacing",X.prototype.rowSpacing);
t.defineProperty(X,{rowSpacing:"rowSpacing"},function(){return this.ya.rowSpacing},function(a){this.ya.rowSpacing!==a&&(t.i(a,"number",X,"rowSpacing"),this.ya.rowSpacing=a,this.M())});t.g(X,"rowIndent",X.prototype.rowIndent);t.defineProperty(X,{rowIndent:"rowIndent"},function(){return this.ya.rowIndent},function(a){this.ya.rowIndent!==a&&(t.i(a,"number",X,"rowIndent"),0<=a&&(this.ya.rowIndent=a,this.M()))});t.g(X,"commentSpacing",X.prototype.commentSpacing);
t.defineProperty(X,{commentSpacing:"commentSpacing"},function(){return this.ya.commentSpacing},function(a){this.ya.commentSpacing!==a&&(t.i(a,"number",X,"commentSpacing"),this.ya.commentSpacing=a,this.M())});t.g(X,"commentMargin",X.prototype.commentMargin);t.defineProperty(X,{commentMargin:"commentMargin"},function(){return this.ya.commentMargin},function(a){this.ya.commentMargin!==a&&(t.i(a,"number",X,"commentMargin"),this.ya.commentMargin=a,this.M())});t.g(X,"setsPortSpot",X.prototype.setsPortSpot);
t.defineProperty(X,{setsPortSpot:"setsPortSpot"},function(){return this.ya.setsPortSpot},function(a){this.ya.setsPortSpot!==a&&(t.i(a,"boolean",X,"setsPortSpot"),this.ya.setsPortSpot=a,this.M())});t.g(X,"portSpot",X.prototype.portSpot);t.defineProperty(X,{portSpot:"portSpot"},function(){return this.ya.portSpot},function(a){t.l(a,L,X,"portSpot");this.ya.portSpot.O(a)||(this.ya.portSpot=a,this.M())});t.g(X,"setsChildPortSpot",X.prototype.setsChildPortSpot);
t.defineProperty(X,{setsChildPortSpot:"setsChildPortSpot"},function(){return this.ya.setsChildPortSpot},function(a){this.ya.setsChildPortSpot!==a&&(t.i(a,"boolean",X,"setsChildPortSpot"),this.ya.setsChildPortSpot=a,this.M())});t.g(X,"childPortSpot",X.prototype.childPortSpot);t.defineProperty(X,{childPortSpot:"childPortSpot"},function(){return this.ya.childPortSpot},function(a){t.l(a,L,X,"childPortSpot");this.ya.childPortSpot.O(a)||(this.ya.childPortSpot=a,this.M())});t.g(X,"alternateSorting",X.prototype.oI);
t.defineProperty(X,{oI:"alternateSorting"},function(){return this.xa.sorting},function(a){this.xa.sorting!==a&&(t.Fa(a,X,X,"alternateSorting"),a===eq||a===fq||a===gq||hq)&&(this.xa.sorting=a,this.M())});t.g(X,"alternateComparer",X.prototype.cI);t.defineProperty(X,{cI:"alternateComparer"},function(){return this.xa.comparer},function(a){this.xa.comparer!==a&&(t.i(a,"function",X,"alternateComparer"),this.xa.comparer=a,this.M())});t.g(X,"alternateAngle",X.prototype.XH);
t.defineProperty(X,{XH:"alternateAngle"},function(){return this.xa.angle},function(a){this.xa.angle!==a&&(t.i(a,"number",X,"alternateAngle"),0===a||90===a||180===a||270===a)&&(this.xa.angle=a,this.M())});t.g(X,"alternateAlignment",X.prototype.WH);t.defineProperty(X,{WH:"alternateAlignment"},function(){return this.xa.alignment},function(a){this.xa.alignment!==a&&(t.Fa(a,X,X,"alternateAlignment"),this.xa.alignment=a,this.M())});t.g(X,"alternateNodeIndent",X.prototype.gI);
t.defineProperty(X,{gI:"alternateNodeIndent"},function(){return this.xa.nodeIndent},function(a){this.xa.nodeIndent!==a&&(t.i(a,"number",X,"alternateNodeIndent"),0<=a&&(this.xa.nodeIndent=a,this.M()))});t.g(X,"alternateNodeIndentPastParent",X.prototype.hI);
t.defineProperty(X,{hI:"alternateNodeIndentPastParent"},function(){return this.xa.nodeIndentPastParent},function(a){this.xa.nodeIndentPastParent!==a&&(t.i(a,"number",X,"alternateNodeIndentPastParent"),0<=a&&1>=a&&(this.xa.nodeIndentPastParent=a,this.M()))});t.g(X,"alternateNodeSpacing",X.prototype.iI);t.defineProperty(X,{iI:"alternateNodeSpacing"},function(){return this.xa.nodeSpacing},function(a){this.xa.nodeSpacing!==a&&(t.i(a,"number",X,"alternateNodeSpacing"),this.xa.nodeSpacing=a,this.M())});
t.g(X,"alternateLayerSpacing",X.prototype.eI);t.defineProperty(X,{eI:"alternateLayerSpacing"},function(){return this.xa.layerSpacing},function(a){this.xa.layerSpacing!==a&&(t.i(a,"number",X,"alternateLayerSpacing"),this.xa.layerSpacing=a,this.M())});t.g(X,"alternateLayerSpacingParentOverlap",X.prototype.fI);
t.defineProperty(X,{fI:"alternateLayerSpacingParentOverlap"},function(){return this.xa.layerSpacingParentOverlap},function(a){this.xa.layerSpacingParentOverlap!==a&&(t.i(a,"number",X,"alternateLayerSpacingParentOverlap"),0<=a&&1>=a&&(this.xa.layerSpacingParentOverlap=a,this.M()))});t.g(X,"alternateCompaction",X.prototype.bI);
t.defineProperty(X,{bI:"alternateCompaction"},function(){return this.xa.compaction},function(a){this.xa.compaction!==a&&(t.Fa(a,X,X,"alternateCompaction"),a===pq||a===rq)&&(this.xa.compaction=a,this.M())});t.g(X,"alternateBreadthLimit",X.prototype.YH);t.defineProperty(X,{YH:"alternateBreadthLimit"},function(){return this.xa.breadthLimit},function(a){this.xa.breadthLimit!==a&&(t.i(a,"number",X,"alternateBreadthLimit"),0<=a&&(this.xa.breadthLimit=a,this.M()))});t.g(X,"alternateRowSpacing",X.prototype.lI);
t.defineProperty(X,{lI:"alternateRowSpacing"},function(){return this.xa.rowSpacing},function(a){this.xa.rowSpacing!==a&&(t.i(a,"number",X,"alternateRowSpacing"),this.xa.rowSpacing=a,this.M())});t.g(X,"alternateRowIndent",X.prototype.kI);t.defineProperty(X,{kI:"alternateRowIndent"},function(){return this.xa.rowIndent},function(a){this.xa.rowIndent!==a&&(t.i(a,"number",X,"alternateRowIndent"),0<=a&&(this.xa.rowIndent=a,this.M()))});t.g(X,"alternateCommentSpacing",X.prototype.aI);
t.defineProperty(X,{aI:"alternateCommentSpacing"},function(){return this.xa.commentSpacing},function(a){this.xa.commentSpacing!==a&&(t.i(a,"number",X,"alternateCommentSpacing"),this.xa.commentSpacing=a,this.M())});t.g(X,"alternateCommentMargin",X.prototype.$H);t.defineProperty(X,{$H:"alternateCommentMargin"},function(){return this.xa.commentMargin},function(a){this.xa.commentMargin!==a&&(t.i(a,"number",X,"alternateCommentMargin"),this.xa.commentMargin=a,this.M())});t.g(X,"alternateSetsPortSpot",X.prototype.nI);
t.defineProperty(X,{nI:"alternateSetsPortSpot"},function(){return this.xa.setsPortSpot},function(a){this.xa.setsPortSpot!==a&&(t.i(a,"boolean",X,"alternateSetsPortSpot"),this.xa.setsPortSpot=a,this.M())});t.g(X,"alternatePortSpot",X.prototype.jI);t.defineProperty(X,{jI:"alternatePortSpot"},function(){return this.xa.portSpot},function(a){t.l(a,L,X,"alternatePortSpot");this.xa.portSpot.O(a)||(this.xa.portSpot=a,this.M())});t.g(X,"alternateSetsChildPortSpot",X.prototype.mI);
t.defineProperty(X,{mI:"alternateSetsChildPortSpot"},function(){return this.xa.setsChildPortSpot},function(a){this.xa.setsChildPortSpot!==a&&(t.i(a,"boolean",X,"alternateSetsChildPortSpot"),this.xa.setsChildPortSpot=a,this.M())});t.g(X,"alternateChildPortSpot",X.prototype.ZH);t.defineProperty(X,{ZH:"alternateChildPortSpot"},function(){return this.xa.childPortSpot},function(a){t.l(a,L,X,"alternateChildPortSpot");this.xa.childPortSpot.O(a)||(this.xa.childPortSpot=a,this.M())});var Jp;
X.PathDefault=Jp=t.w(X,"PathDefault",-1);var Kp;X.PathDestination=Kp=t.w(X,"PathDestination",0);var Sp;X.PathSource=Sp=t.w(X,"PathSource",1);var eq;X.SortingForwards=eq=t.w(X,"SortingForwards",10);var fq;X.SortingReverse=fq=t.w(X,"SortingReverse",11);var gq;X.SortingAscending=gq=t.w(X,"SortingAscending",12);var hq;X.SortingDescending=hq=t.w(X,"SortingDescending",13);var Fq;X.AlignmentCenterSubtrees=Fq=t.w(X,"AlignmentCenterSubtrees",20);var iq;
X.AlignmentCenterChildren=iq=t.w(X,"AlignmentCenterChildren",21);var tq;X.AlignmentStart=tq=t.w(X,"AlignmentStart",22);var uq;X.AlignmentEnd=uq=t.w(X,"AlignmentEnd",23);var kq;X.AlignmentBus=kq=t.w(X,"AlignmentBus",24);var $p;X.AlignmentBusBranching=$p=t.w(X,"AlignmentBusBranching",25);var lq;X.AlignmentTopLeftBus=lq=t.w(X,"AlignmentTopLeftBus",26);var mq;X.AlignmentBottomRightBus=mq=t.w(X,"AlignmentBottomRightBus",27);var pq;X.CompactionNone=pq=t.w(X,"CompactionNone",30);var rq;
X.CompactionBlock=rq=t.w(X,"CompactionBlock",31);var Lp;X.StyleLayered=Lp=t.w(X,"StyleLayered",40);var dq;X.StyleLastParents=dq=t.w(X,"StyleLastParents",41);var cq;X.StyleAlternating=cq=t.w(X,"StyleAlternating",42);var bq;X.StyleRootOnly=bq=t.w(X,"StyleRootOnly",43);var Np;X.ArrangementVertical=Np=t.w(X,"ArrangementVertical",50);var Tq;X.ArrangementHorizontal=Tq=t.w(X,"ArrangementHorizontal",51);var Rp;X.ArrangementFixedRoots=Rp=t.w(X,"ArrangementFixedRoots",52);var Mp;
X.LayerIndividual=Mp=t.w(X,"LayerIndividual",60);var Yp;X.LayerSiblings=Yp=t.w(X,"LayerSiblings",61);var Xp;X.LayerUniform=Xp=t.w(X,"LayerUniform",62);function Pp(){Ea.call(this)}t.ka("TreeNetwork",Pp);t.Qa(Pp,Ea);Pp.prototype.createVertex=function(){return new Op};Pp.prototype.createEdge=function(){return new Vq};
function Op(){Fa.call(this);this.initialized=!1;this.parent=null;this.children=[];this.maxGenerationCount=this.maxChildrenCount=this.descendantCount=this.level=0;this.comments=null;this.qa=new E(0,0);this.eb=new ra(0,0);this.Na=new E(0,0);this.bq=this.aq=this.jK=!1;this.$t=this.It=null;this.sorting=eq;this.comparer=Rn;this.angle=0;this.alignment=iq;this.nodeIndentPastParent=this.nodeIndent=0;this.nodeSpacing=20;this.layerSpacing=50;this.layerSpacingParentOverlap=0;this.compaction=rq;this.breadthLimit=
0;this.rowSpacing=25;this.commentSpacing=this.rowIndent=10;this.commentMargin=20;this.setsPortSpot=!0;this.portSpot=Ub;this.setsChildPortSpot=!0;this.childPortSpot=Ub}t.ka("TreeVertex",Op);t.Qa(Op,Fa);
Op.prototype.copyInheritedPropertiesFrom=function(a){null!==a&&(this.sorting=a.sorting,this.comparer=a.comparer,this.angle=a.angle,this.alignment=a.alignment,this.nodeIndent=a.nodeIndent,this.nodeIndentPastParent=a.nodeIndentPastParent,this.nodeSpacing=a.nodeSpacing,this.layerSpacing=a.layerSpacing,this.layerSpacingParentOverlap=a.layerSpacingParentOverlap,this.compaction=a.compaction,this.breadthLimit=a.breadthLimit,this.rowSpacing=a.rowSpacing,this.rowIndent=a.rowIndent,this.commentSpacing=a.commentSpacing,
this.commentMargin=a.commentMargin,this.setsPortSpot=a.setsPortSpot,this.portSpot=a.portSpot,this.setsChildPortSpot=a.setsChildPortSpot,this.childPortSpot=a.childPortSpot)};t.A(Op,{Wm:"childrenCount"},function(){return this.children.length});t.g(Op,"relativePosition",Op.prototype.dK);t.defineProperty(Op,{dK:"relativePosition"},function(){return this.qa},function(a){this.qa.set(a)});t.g(Op,"subtreeSize",Op.prototype.vK);t.defineProperty(Op,{vK:"subtreeSize"},function(){return this.eb},function(a){this.eb.set(a)});
t.g(Op,"subtreeOffset",Op.prototype.uK);t.defineProperty(Op,{uK:"subtreeOffset"},function(){return this.Na},function(a){this.Na.set(a)});function Vq(){Ha.call(this);this.fs=new E(0,0)}t.ka("TreeEdge",Vq);t.Qa(Vq,Ha);
Vq.prototype.commit=function(){var a=this.link;if(null!==a&&!a.qj){var b=this.network.ic,c=null,d=null;switch(b.Lf){case Kp:c=this.fromVertex;d=this.toVertex;break;case Sp:c=this.toVertex;d=this.fromVertex;break;default:t.m("Unhandled path value "+b.Lf.toString())}if(null!==c&&null!==d)if(b=this.fs,0!==b.x||0!==b.y||c.jK){var d=c.Tb,f=sq(c),g=vq(c),h=c.rowSpacing;a.updateRoute();var k=a.Je===Wg,l=a.pc,m,n,p,q;a.Kl();if(l||k){for(m=2;4<a.ra;)a.lG(2);n=a.o(1);p=a.o(2)}else{for(m=1;3<a.ra;)a.lG(1);n=
a.o(0);p=a.o(a.ra-1)}q=a.o(a.ra-1);0===f?(c.alignment===uq?(f=d.bottom+b.y,0===b.y&&n.y>q.y+c.rowIndent&&(f=Math.min(f,Math.max(n.y,f-wq(c))))):c.alignment===tq?(f=d.top+b.y,0===b.y&&n.y<q.y-c.rowIndent&&(f=Math.max(f,Math.min(n.y,f+wq(c))))):f=c.aq||c.bq&&1===c.maxGenerationCount?d.top-c.Na.y+b.y:d.y+d.height/2+b.y,k?(a.C(m,n.x,f),m++,a.C(m,d.right+g,f),m++,a.C(m,d.right+g+(b.x-h)/3,f),m++,a.C(m,d.right+g+2*(b.x-h)/3,f),m++,a.C(m,d.right+g+(b.x-h),f),m++,a.C(m,p.x,f)):(l&&(a.C(m,d.right+g/2,n.y),
m++),a.C(m,d.right+g/2,f),m++,a.C(m,d.right+g+b.x-(l?h/2:h),f),m++,l&&a.C(m,a.o(m-1).x,p.y))):90===f?(c.alignment===uq?(f=d.right+b.x,0===b.x&&n.x>q.x+c.rowIndent&&(f=Math.min(f,Math.max(n.x,f-wq(c))))):c.alignment===tq?(f=d.left+b.x,0===b.x&&n.x<q.x-c.rowIndent&&(f=Math.max(f,Math.min(n.x,f+wq(c))))):f=c.aq||c.bq&&1===c.maxGenerationCount?d.left-c.Na.x+b.x:d.x+d.width/2+b.x,k?(a.C(m,f,n.y),m++,a.C(m,f,d.bottom+g),m++,a.C(m,f,d.bottom+g+(b.y-h)/3),m++,a.C(m,f,d.bottom+g+2*(b.y-h)/3),m++,a.C(m,f,d.bottom+
g+(b.y-h)),m++,a.C(m,f,p.y)):(l&&(a.C(m,n.x,d.bottom+g/2),m++),a.C(m,f,d.bottom+g/2),m++,a.C(m,f,d.bottom+g+b.y-(l?h/2:h)),m++,l&&a.C(m,p.x,a.o(m-1).y))):180===f?(c.alignment===uq?(f=d.bottom+b.y,0===b.y&&n.y>q.y+c.rowIndent&&(f=Math.min(f,Math.max(n.y,f-wq(c))))):c.alignment===tq?(f=d.top+b.y,0===b.y&&n.y<q.y-c.rowIndent&&(f=Math.max(f,Math.min(n.y,f+wq(c))))):f=c.aq||c.bq&&1===c.maxGenerationCount?d.top-c.Na.y+b.y:d.y+d.height/2+b.y,k?(a.C(m,n.x,f),m++,a.C(m,d.left-g,f),m++,a.C(m,d.left-g+(b.x+
h)/3,f),m++,a.C(m,d.left-g+2*(b.x+h)/3,f),m++,a.C(m,d.left-g+(b.x+h),f),m++,a.C(m,p.x,f)):(l&&(a.C(m,d.left-g/2,n.y),m++),a.C(m,d.left-g/2,f),m++,a.C(m,d.left-g+b.x+(l?h/2:h),f),m++,l&&a.C(m,a.o(m-1).x,p.y))):270===f?(c.alignment===uq?(f=d.right+b.x,0===b.x&&n.x>q.x+c.rowIndent&&(f=Math.min(f,Math.max(n.x,f-wq(c))))):c.alignment===tq?(f=d.left+b.x,0===b.x&&n.x<q.x-c.rowIndent&&(f=Math.max(f,Math.min(n.x,f+wq(c))))):f=c.aq||c.bq&&1===c.maxGenerationCount?d.left-c.Na.x+b.x:d.x+d.width/2+b.x,k?(a.C(m,
f,n.y),m++,a.C(m,f,d.top-g),m++,a.C(m,f,d.top-g+(b.y+h)/3),m++,a.C(m,f,d.top-g+2*(b.y+h)/3),m++,a.C(m,f,d.top-g+(b.y+h)),m++,a.C(m,f,p.y)):(l&&(a.C(m,n.x,d.top-g/2),m++),a.C(m,f,d.top-g/2),m++,a.C(m,f,d.top-g+b.y+(l?h/2:h)),m++,l&&a.C(m,p.x,a.o(m-1).y))):t.m("Invalid angle "+f);a.ij()}else g=c,h=d,e&&t.l(g,Op,Vq,"adjustRouteForAngleChange:parent"),e&&t.l(h,Op,Vq,"adjustRouteForAngleChange:child"),a=this.link,c=sq(g),c!==sq(h)&&(b=vq(g),d=g.Tb,g=h.Tb,0===c&&g.left-d.right<b+1||90===c&&g.top-d.bottom<
b+1||180===c&&d.left-g.right<b+1||270===c&&d.top-g.bottom<b+1||(a.updateRoute(),g=a.Je===Wg,h=a.pc,k=jq(this.fromVertex.alignment),a.Kl(),0===c?(c=d.right+b/2,g?4===a.ra&&(b=a.o(3).y,a.aa(1,c-20,a.o(1).y),a.C(2,c-20,b),a.C(3,c,b),a.C(4,c+20,b),a.aa(5,a.o(5).x,b)):h?k?a.aa(3,a.o(2).x,a.o(4).y):6===a.ra&&(a.aa(2,c,a.o(2).y),a.aa(3,c,a.o(3).y)):4===a.ra?a.C(2,c,a.o(2).y):3===a.ra?a.aa(1,c,a.o(2).y):2===a.ra&&a.C(1,c,a.o(1).y)):90===c?(b=d.bottom+b/2,g?4===a.ra&&(c=a.o(3).x,a.aa(1,a.o(1).x,b-20),a.C(2,
c,b-20),a.C(3,c,b),a.C(4,c,b+20),a.aa(5,c,a.o(5).y)):h?k?a.aa(3,a.o(2).x,a.o(4).y):6===a.ra&&(a.aa(2,a.o(2).x,b),a.aa(3,a.o(3).x,b)):4===a.ra?a.C(2,a.o(2).x,b):3===a.ra?a.aa(1,a.o(2).x,b):2===a.ra&&a.C(1,a.o(1).x,b)):180===c?(c=d.left-b/2,g?4===a.ra&&(b=a.o(3).y,a.aa(1,c+20,a.o(1).y),a.C(2,c+20,b),a.C(3,c,b),a.C(4,c-20,b),a.aa(5,a.o(5).x,b)):h?k?a.aa(3,a.o(2).x,a.o(4).y):6===a.ra&&(a.aa(2,c,a.o(2).y),a.aa(3,c,a.o(3).y)):4===a.ra?a.C(2,c,a.o(2).y):3===a.ra?a.aa(1,c,a.o(2).y):2===a.ra&&a.C(1,c,a.o(1).y)):
270===c&&(b=d.top-b/2,g?4===a.ra&&(c=a.o(3).x,a.aa(1,a.o(1).x,b+20),a.C(2,c,b+20),a.C(3,c,b),a.C(4,c,b-20),a.aa(5,c,a.o(5).y)):h?k?a.aa(3,a.o(2).x,a.o(4).y):6===a.ra&&(a.aa(2,a.o(2).x,b),a.aa(3,a.o(3).x,b)):4===a.ra?a.C(2,a.o(2).x,b):3===a.ra?a.aa(1,a.o(2).x,b):2===a.ra&&a.C(1,a.o(1).x,b)),a.ij()))}};t.g(Vq,"relativePoint",Vq.prototype.cK);t.defineProperty(Vq,{cK:"relativePoint"},function(){return this.fs},function(a){this.fs.set(a)});function Wq(){this.oo=[]}
function Tk(a){var b=new Wq,c;if("string"===typeof a)c=(new DOMParser).parseFromString(a,"text/xml");else if(a instanceof Document)c=a.implementation.createDocument("http://www.w3.org/2000/svg","svg",null),c.appendChild(c.importNode(a.documentElement,!0));else return null;a=c.getElementsByTagName("svg");if(0===a.length)return null;var d=a[0],f=c.getElementsByTagName("linearGradient"),g=c.getElementsByTagName("radialGradient");for(a=0;a<f.length;a++){for(var h=f[a],k=Uk(qa,qe,{start:nc,end:qc}),l=
h.childNodes,m=0;m<l.length;m++)if("stop"===l[m].tagName){var n=Xq(b,l[m],"stop-color");if(n){var p=Xq(b,l[m],"offset");p||(p="0");var q=parseFloat(p);isNaN(q)&&(q=0);k.addColorStop((-1!==p.indexOf("%")?0.01:1)*q,n)}}h=h.getAttribute("id");"string"===typeof h&&(b["_brush"+h]=k)}for(a=0;a<g.length;a++){h=g[a];k=Uk(qa,re,{start:Yb,end:Yb});l=h.childNodes;for(m=0;m<l.length;m++)"stop"===l[m].tagName&&(n=Xq(b,l[m],"stop-color"))&&((p=Xq(b,l[m],"offset"))||(p="0"),q=parseFloat(p),isNaN(q)&&(q=0),k.addColorStop((-1!==
p.indexOf("%")?0.01:1)*q,n));h=h.getAttribute("id");"string"===typeof h&&(b["_brush"+h]=k)}for(f=!0;f;)for(f=!1,g=c.getElementsByTagName("use"),a=0;a<g.length;a++)k=g[a],0===k.childNodes.length&&(h=k.href,void 0!==h&&(h=c.getElementById(h.baseVal.substring(1)),null!==h&&(h=h.cloneNode(!0),h.removeAttribute("id"),l=parseFloat(k.getAttribute("x")),isNaN(l)&&(l=0),m=parseFloat(k.getAttribute("y")),isNaN(m)&&(m=0),n=k.getAttribute("transform"),null===n&&(n=""),k.setAttribute("transform",n+" translate("+
l+","+m+")"),k.appendChild(h),"use"===h.tagName&&(f=!0))));Yq(b,d,null);c=new C;if(0===b.oo.length)return c;if(1===b.oo.length)return b.oo[0];for(a=0;a<b.oo.length;a++)c.add(b.oo[a]);return c}function Zq(a,b){var c=a.getAttribute(b);"string"!==typeof c&&a.style&&(c=a.style[b]);return"string"!==typeof c?null:c}
function Xq(a,b,c){var d=b.getAttribute(c);"string"!==typeof d&&b.style&&(d=b.style[c]);return"string"!==typeof d||""===d||"inherit"===d?(b=b.parentNode,"g"===b.tagName||"use"===b.tagName?Xq(a,b,c):null):d}
function Yq(a,b,c){var d=b.tagName;if(("g"===d||"svg"===d||"use"===d||"symbol"===d)&&"none"!==Xq(a,b,"display")){for(var d=b.childNodes,f=0;f<d.length;f++){var g=d[f],h=null;if(void 0!==g.getAttribute){var k=g.getAttribute("transform");switch(g.tagName){case "g":null===k?Yq(a,g,null):(h=new C,Yq(a,g,h));break;case "use":null===k?Yq(a,g,null):(h=new C,Yq(a,g,h));break;case "symbol":if("use"!==b.tagName)break;h=new C;Yq(a,g,h);var l=h,m=a,n=g;Xq(m,n,"preserveAspectRatio");Xq(m,n,"viewBox");l.scale=
1;break;case "path":l=g;h=new W;l=l.getAttribute("d");"string"===typeof l&&(h.iF=dd(l));break;case "line":var p=g,h=new W,l=parseFloat(p.getAttribute("x1"));isNaN(l)&&(l=0);m=parseFloat(p.getAttribute("y1"));isNaN(m)&&(m=0);n=parseFloat(p.getAttribute("x2"));isNaN(n)&&(n=0);p=parseFloat(p.getAttribute("y2"));isNaN(p)&&(p=0);var q=new Pc(Tc);h.position=new E(Math.min(l,n),Math.min(m,p));0<(n-l)/(p-m)?(q.sa=0,q.ta=0,q.D=Math.abs(n-l),q.F=Math.abs(p-m)):(q.sa=0,q.ta=Math.abs(p-m),q.D=Math.abs(n-l),q.F=
0);h.td=q;break;case "circle":n=g;h=new W;l=parseFloat(n.getAttribute("r"));isNaN(l)||0>l?h=null:(m=parseFloat(n.getAttribute("cx")),isNaN(m)&&(m=0),n=parseFloat(n.getAttribute("cy")),isNaN(n)&&(n=0),p=new Pc($c),p.sa=0,p.ta=0,p.D=2*l,p.F=2*l,h.position=new E(m-l,n-l),h.td=p);break;case "ellipse":p=g;h=new W;l=parseFloat(p.getAttribute("rx"));isNaN(l)||0>l?h=null:(m=parseFloat(p.getAttribute("ry")),isNaN(m)||0>m?h=null:(n=parseFloat(p.getAttribute("cx")),isNaN(n)&&(n=0),p=parseFloat(p.getAttribute("cy")),
isNaN(p)&&(p=0),q=new Pc($c),q.sa=0,q.ta=0,q.D=2*l,q.F=2*m,h.position=new E(n-l,p-m),h.td=q));break;case "rect":q=g;h=new W;l=parseFloat(q.getAttribute("width"));if(isNaN(l)||0>l)h=null;else if(m=parseFloat(q.getAttribute("height")),isNaN(m)||0>m)h=null;else{n=parseFloat(q.getAttribute("x"));isNaN(n)&&(n=0);p=parseFloat(q.getAttribute("y"));isNaN(p)&&(p=0);var r=q.getAttribute("rx"),s=q.getAttribute("ry"),q=parseFloat(r);if(isNaN(q)||0>q)q=0;var u=parseFloat(s);if(isNaN(u)||0>u)u=0;!r&&s?q=u:r&&!s&&
(u=q);q=Math.min(q,l/2);u=Math.min(u,m/2);s=void 0;0===q&&0===u?(s=new Pc(Uc),s.sa=0,s.ta=0,s.D=l,s.F=m):(s=K.za/2,r=t.u(),P(r,q,0,!0),r.lineTo(l-q,0),Q(r,l-q*s,0,l,u*s,l,u),r.lineTo(l,m-u),Q(r,l,m-u*s,l-q*s,m,l-q,m),r.lineTo(q,m),Q(r,q*s,m,0,m-u*s,0,m-u),r.lineTo(0,u),Q(r,0,u*s,q*s,0,q,0),S(r),s=r.s,t.v(r));h.position=new E(n,p);h.td=s}break;case "polygon":h=$q(g);break;case "polyline":h=$q(g)}if(null!==h){if(h instanceof W){l=Xq(a,g,"fill");null!==l&&-1!==l.indexOf("url")?(l=l.substring(l.indexOf("#")+
1,l.length-1),l=a["_brush"+l],h.fill=l instanceof qa?l:"black"):h.fill=null===l?"black":"none"===l?null:l;l=Xq(a,g,"stroke");null!==l&&-1!==l.indexOf("url")?(l=l.substring(l.indexOf("#")+1,l.length-1),l=a["_brush"+l],h.stroke=l instanceof qa?l:"black"):h.stroke="none"===l?null:l;l=parseFloat(Xq(a,g,"stroke-width"));isNaN(l)||(h.lb=l);l=Xq(a,g,"stroke-linecap");null!==l&&(h.OG=l);if(l=Xq(a,g,"stroke-dasharray")){m=l.split(",");n=[];for(l=0;l<m.length;l++)p=parseFloat(m[l]),!isNaN(p)&&0<p&&n.push(p);
h.Mx=n}if(g=Xq(a,g,"stroke-dashoffset"))g=parseFloat(g),isNaN(g)||(h.PG=g);h.JA=!0}if(null!==k){k=k.split(")");g=!0;for(l=0;l<k.length;l++)/\(.*[^0-9\.,\s-]/.test(k[l])&&(g=!1),/\(.*[0-9]-[0-9]/.test(k[l])&&(g=!1);if(g)for(l=k.length-1;0<=l;l--)if(m=k[l],""!==m)switch(n=m.indexOf("("),g=m.substring(0,n).replace(/\s*/,""),n=m.substring(n+1).split(/\s*[\s,]\s*/),g){case "rotate":ar(a,h,n);break;case "translate":g=h;m=parseFloat(n[0]);isNaN(m)&&(m=0);n=parseFloat(n[1]);isNaN(n)&&(n=0);if(0!==m||0!==
n)p=g.position.copy(),isNaN(p.x)&&(p.x=0),isNaN(p.y)&&(p.y=0),g.position=new E(m+p.x,n+p.y);break;case "scale":br(a,h,n);break;case "skewX":cr(a,h,n);break;case "skewY":dr(a,h,n);break;case "matrix":er(a,h,n)}}if(h instanceof C){k=h.elements.k;l=g=0;m=h.position.copy();isNaN(m.x)&&(m.x=0);isNaN(m.y)&&(m.y=0);for(;k.next();)n=k.value.position.copy(),isNaN(n.x)&&(n.x=0),isNaN(n.y)&&(n.y=0),n.x<g&&(g=n.x),n.y<l&&(l=n.y);m.x+=g;m.y+=l;h.position=m}null===c?a.oo.push(h):c.add(h)}}}if(null!==h){a=Zq(b,
"visibility");if("hidden"===a||"collapse"===a)h.visible=!1;if(b=Zq(b,"opacity"))b=parseFloat(b),isNaN(b)||(h.opacity=b)}}}
function er(a,b,c){var d=parseFloat(c[0]),f=parseFloat(c[1]),g=parseFloat(c[2]),h=parseFloat(c[3]),k=parseFloat(c[4]),l=parseFloat(c[5]);if(!isNaN(d+f+g+h+k+l)){var m=b.position.copy();isNaN(m.x)&&(m.x=0);isNaN(m.y)&&(m.y=0);if(b instanceof W){c=b.td.copy();if(c.type===Uc)c=a.Ss(c);else if(c.type===$c)c=fr(c);else if(c.type===Tc){c.type=Qc;a=new Rc(c.sa,c.ta);var n=new xd(bd,c.D,c.F);a.Ka.add(n);c.Fb.add(a)}c.offset(m.x,m.y);c.transform(d,f,g,h,k-m.x,l-m.y);a=c.normalize();b.td=c;m.x-=a.x;m.y-=a.y;
b.position=m}else{for(b=b.elements.k;b.next();)d=b.value.position.copy(),d.x+=m.x,d.y+=m.y,b.value.position=d;for(b.reset();b.next();)er(a,b.value,c);for(b.reset();b.next();)d=b.value.position.copy(),d.x-=m.x,d.y-=m.y,b.value.position=d}}}
function ar(a,b,c){var d=parseFloat(c[0]);isNaN(d)&&(d=0);var f=parseFloat(c[1]);isNaN(f)&&(f=0);var g=parseFloat(c[2]);isNaN(g)&&(g=0);if(0!==d){var h=d*Math.PI/180,k=b.position.copy();isNaN(k.x)&&(k.x=0);isNaN(k.y)&&(k.y=0);if(b instanceof W){c=b.td.copy();c.type===$c?c=fr(c):c.type===Uc&&(c=a.Ss(c));if(c.type===Qc)c.rotate(d,f-k.x,g-k.y),g=c.normalize(),b.td=c,k.x-=g.x,k.y-=g.y,b.position=k;else{var d=c.sa-f+k.x,l=c.ta-g+k.y,m=c.D-f+k.x,n=c.F-g+k.y;a=d*Math.cos(h)-l*Math.sin(h)+f-k.x;d=l*Math.cos(h)+
d*Math.sin(h)+g-k.y;f=m*Math.cos(h)-n*Math.sin(h)+f-k.x;g=n*Math.cos(h)+m*Math.sin(h)+g-k.y;m=Math.min(a,f);n=Math.min(d,g);c.sa=a-m;c.ta=d-n;c.D=f-m;c.F=g-n;k.x+=m;k.y+=n;b.position=k;b.td=c}b.fill instanceof qa&&(k=b.fill.copy(),c=Math.atan((0.5-k.start.y)/(0.5-k.start.x)),isNaN(c)||(c+=h,k.start=new L((1-Math.cos(c))/2,(1-Math.sin(c))/2),k.end=new L((1+Math.cos(c))/2,(1+Math.sin(c))/2)),b.fill=k);b.stroke instanceof qa&&(k=b.stroke.copy(),c=Math.atan((0.5-k.start.y)/(0.5-k.start.x)),isNaN(c)||
(c+=h,k.start=new L((1-Math.cos(c))/2,(1-Math.sin(c))/2),k.end=new L((1+Math.cos(c))/2,(1+Math.sin(c))/2)),b.stroke=k)}else{for(b=b.elements.k;b.next();)h=b.value.position.copy(),h.x+=k.x,h.y+=k.y,b.value.position=h;for(b.reset();b.next();)ar(a,b.value,c);for(b.reset();b.next();)h=b.value.position.copy(),h.x-=k.x,h.y-=k.y,b.value.position=h}}}
function br(a,b,c){var d=parseFloat(c[0]);isNaN(d)&&(d=1);var f=parseFloat(c[1]);isNaN(f)&&(f=d);if(1!==d||1!==f){var g=b.position.copy();isNaN(g.x)&&(g.x=0);isNaN(g.y)&&(g.y=0);if(b instanceof W)a=b.td.copy(),g.x*=d,g.y*=f,b.position=g,a.scale(d,f),b.td=a;else{for(b=b.elements.k;b.next();)d=b.value.position.copy(),d.x+=g.x,d.y+=g.y,b.value.position=d;for(b.reset();b.next();)br(a,b.value,c);for(b.reset();b.next();)d=b.value.position.copy(),d.x-=g.x,d.y-=g.y,b.value.position=d}}}
function cr(a,b,c){var d=parseFloat(c[0]);if(!isNaN(d)){var d=d*Math.PI/180,f=b.position.copy();isNaN(f.x)&&(f.x=0);isNaN(f.y)&&(f.y=0);if(b instanceof W){c=b.td.copy();if(c.type===Uc)c=a.Ss(c);else if(c.type===$c)c=fr(c);else if(c.type===Tc){c.type=Qc;a=new Rc(c.sa,c.ta);var g=new xd(bd,c.D,c.F);a.Ka.add(g);c.Fb.add(a)}c.offset(f.x,f.y);c.transform(1,0,Math.tan(d),1,-f.x,-f.y);a=c.normalize();b.td=c;f.x-=a.x;f.y-=a.y;b.position=f}else{for(b=b.elements.k;b.next();)d=b.value.position.copy(),d.x+=f.x,
d.y+=f.y,b.value.position=d;for(b.reset();b.next();)cr(a,b.value,c);for(b.reset();b.next();)d=b.value.position.copy(),d.x-=f.x,d.y-=f.y,b.value.position=d}}}
function dr(a,b,c){var d=parseFloat(c[0]);if(!isNaN(d)){var d=d*Math.PI/180,f=b.position.copy();isNaN(f.x)&&(f.x=0);isNaN(f.y)&&(f.y=0);if(b instanceof W){c=b.td.copy();if(c.type===Uc)c=a.Ss(c);else if(c.type===$c)c=fr(c);else if(c.type===Tc){c.type=Qc;a=new Rc(c.sa,c.ta);var g=new xd(bd,c.D,c.F);a.Ka.add(g);c.Fb.add(a)}c.offset(f.x,f.y);c.transform(1,Math.tan(d),0,1,-f.x,-f.y);a=c.normalize();b.td=c;f.x-=a.x;f.y-=a.y;b.position=f}else{for(b=b.elements.k;b.next();)d=b.value.position.copy(),d.x+=f.x,
d.y+=f.y,b.value.position=d;for(b.reset();b.next();)dr(a,b.value,c);for(b.reset();b.next();)d=b.value.position.copy(),d.x-=f.x,d.y-=f.y,b.value.position=d}}}
function $q(a){var b=!1;if("polygon"===a.tagName)b=!0;else if("polyline"!==a.tagName)return null;var c=new W,d=a.getAttribute("points");a=new Pc;var f=new H(Rc),g=d.split(/\s*[\s,]\s*/);if(4>g.length)return null;for(var h,d=new H(xd),k,l,m=1;m<g.length;m+=2){k=eval(g[m-1]);l=eval(g[m]);if("number"!==typeof k||isNaN(k)||"number"!==typeof l||isNaN(l))return null;1===m?h=new Rc(k,l):d.add(new xd(bd,k,l))}b&&(b=new xd(bd,h.sa,h.ta),b.close(),d.add(b));h.Ka=d;f.add(h);a.Fb=f;h=a.normalize();c.position=
new E(-h.x,-h.y);c.td=a;return c}
function fr(a){var b=a.sa,c=a.ta,d=a.D,f=a.F,g=Math.abs(d-b)/2,h=Math.abs(f-c)/2,b=Math.min(b,d)+g,c=Math.min(c,f)+h;new E;f=new Rc(b,c-h);d=new xd(ld);d.Gb=b+K.za*g;d.Xb=c-h;d.ye=b+g;d.ze=c-K.za*h;d.D=b+g;d.F=c;f.Ka.add(d);d=new xd(ld);d.Gb=b+g;d.Xb=c+K.za*h;d.ye=b+K.za*g;d.ze=c+h;d.D=b;d.F=c+h;f.Ka.add(d);d=new xd(ld);d.Gb=b-K.za*g;d.Xb=c+h;d.ye=b-g;d.ze=c+K.za*h;d.D=b-g;d.F=c;f.Ka.add(d);d=new xd(ld);d.Gb=b-g;d.Xb=c-K.za*h;d.ye=b-K.za*g;d.ze=c-h;d.D=b;d.F=c-h;f.Ka.add(d);a.type=Qc;a.Fb.add(f);
return a}Wq.prototype.Ss=function(a){var b=a.sa,c=a.ta,d=a.D,f=a.F,g=Math.min(b,d),h=Math.min(c,f),b=Math.abs(d-b),c=Math.abs(f-c),f=new Rc(g,h);f.Ka.add(new xd(bd,g+b,h));f.Ka.add(new xd(bd,g+b,h+c));f.Ka.add((new xd(bd,g,h+c)).close());a.type=Qc;a.Fb.add(f);return a};ca.version="1.4.13";
window&&(window.module&&"object"===typeof window.module&&"object"===typeof window.module.exports?window.module.exports=ca:window.define&&"function"===typeof window.define&&window.define.amd?(window.go=ca,window.define(ca)):window.go=ca); })(window);
/*
 HTML5 Shiv v3.6.2 | @afarkas @jdalton @jon_neal @rem | MIT/GPL2 Licensed
*/
(function(l,f){function m(){var a=e.elements;return"string"==typeof a?a.split(" "):a}function i(a){var b=n[a[o]];b||(b={},h++,a[o]=h,n[h]=b);return b}function p(a,b,c){b||(b=f);if(g)return b.createElement(a);c||(c=i(b));b=c.cache[a]?c.cache[a].cloneNode():r.test(a)?(c.cache[a]=c.createElem(a)).cloneNode():c.createElem(a);return b.canHaveChildren&&!s.test(a)?c.frag.appendChild(b):b}function t(a,b){if(!b.cache)b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag();
a.createElement=function(c){return!e.shivMethods?b.createElem(c):p(c,a,b)};a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+m().join().replace(/\w+/g,function(a){b.createElem(a);b.frag.createElement(a);return'c("'+a+'")'})+");return n}")(e,b.frag)}function q(a){a||(a=f);var b=i(a);if(e.shivCSS&&!j&&!b.hasCSS){var c,d=a;c=d.createElement("p");d=d.getElementsByTagName("head")[0]||d.documentElement;c.innerHTML="x<style>article,aside,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}</style>";
c=d.insertBefore(c.lastChild,d.firstChild);b.hasCSS=!!c}g||t(a,b);return a}var k=l.html5||{},s=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,r=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,j,o="_html5shiv",h=0,n={},g;(function(){try{var a=f.createElement("a");a.innerHTML="<xyz></xyz>";j="hidden"in a;var b;if(!(b=1==a.childNodes.length)){f.createElement("a");var c=f.createDocumentFragment();b="undefined"==typeof c.cloneNode||
"undefined"==typeof c.createDocumentFragment||"undefined"==typeof c.createElement}g=b}catch(d){g=j=!0}})();var e={elements:k.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup main mark meter nav output progress section summary time video",version:"3.6.2",shivCSS:!1!==k.shivCSS,supportsUnknownElements:g,shivMethods:!1!==k.shivMethods,type:"default",shivDocument:q,createElement:p,createDocumentFragment:function(a,b){a||(a=f);if(g)return a.createDocumentFragment();
for(var b=b||i(a),c=b.frag.cloneNode(),d=0,e=m(),h=e.length;d<h;d++)c.createElement(e[d]);return c}};l.html5=e;q(f)})(this,document);

if(!AmCharts)var AmCharts={themes:{},maps:{},inheriting:{},charts:[],onReadyArray:[],useUTC:!1,updateRate:40,uid:0,lang:{},translations:{},mapTranslations:{},windows:{},initHandlers:[]};
AmCharts.Class=function(a){var b=function(){arguments[0]!==AmCharts.inheriting&&(this.events={},this.construct.apply(this,arguments))};a.inherits?(b.prototype=new a.inherits(AmCharts.inheriting),b.base=a.inherits.prototype,delete a.inherits):(b.prototype.createEvents=function(){for(var a=0,b=arguments.length;a<b;a++)this.events[arguments[a]]=[]},b.prototype.listenTo=function(a,b,c){this.removeListener(a,b,c);a.events[b].push({handler:c,scope:this})},b.prototype.addListener=function(a,b,c){this.removeListener(this,
a,b);this.events[a].push({handler:b,scope:c})},b.prototype.removeListener=function(a,b,c){if(a&&a.events)for(a=a.events[b],b=a.length-1;0<=b;b--)a[b].handler===c&&a.splice(b,1)},b.prototype.fire=function(a,b){for(var c=this.events[a],g=0,h=c.length;g<h;g++){var k=c[g];k.handler.call(k.scope,b)}});for(var c in a)b.prototype[c]=a[c];return b};AmCharts.addChart=function(a){AmCharts.charts.push(a)};AmCharts.removeChart=function(a){for(var b=AmCharts.charts,c=b.length-1;0<=c;c--)b[c]==a&&b.splice(c,1)};
AmCharts.isModern=!0;AmCharts.getIEVersion=function(){var a=0;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent,c=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=c.exec(b)&&(a=parseFloat(RegExp.$1))}else"Netscape"==navigator.appName&&(b=navigator.userAgent,c=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/,null!=c.exec(b)&&(a=parseFloat(RegExp.$1)));return a};
AmCharts.applyLang=function(a,b){var c=AmCharts.translations;b.dayNames=AmCharts.dayNames;b.shortDayNames=AmCharts.shortDayNames;b.monthNames=AmCharts.monthNames;b.shortMonthNames=AmCharts.shortMonthNames;c&&(c=c[a])&&(AmCharts.lang=c,c.monthNames&&(b.dayNames=c.dayNames,b.shortDayNames=c.shortDayNames,b.monthNames=c.monthNames,b.shortMonthNames=c.shortMonthNames))};AmCharts.IEversion=AmCharts.getIEVersion();9>AmCharts.IEversion&&0<AmCharts.IEversion&&(AmCharts.isModern=!1,AmCharts.isIE=!0);
AmCharts.dx=0;AmCharts.dy=0;if(document.addEventListener||window.opera)AmCharts.isNN=!0,AmCharts.isIE=!1,AmCharts.dx=.5,AmCharts.dy=.5;document.attachEvent&&(AmCharts.isNN=!1,AmCharts.isIE=!0,AmCharts.isModern||(AmCharts.dx=0,AmCharts.dy=0));window.chrome&&(AmCharts.chrome=!0);AmCharts.handleResize=function(){for(var a=AmCharts.charts,b=0;b<a.length;b++){var c=a[b];c&&c.div&&c.handleResize()}};AmCharts.handleMouseUp=function(a){for(var b=AmCharts.charts,c=0;c<b.length;c++){var d=b[c];d&&d.handleReleaseOutside(a)}};
AmCharts.handleMouseMove=function(a){for(var b=AmCharts.charts,c=0;c<b.length;c++){var d=b[c];d&&d.handleMouseMove(a)}};AmCharts.resetMouseOver=function(){for(var a=AmCharts.charts,b=0;b<a.length;b++){var c=a[b];c&&(c.mouseIsOver=!1)}};AmCharts.ready=function(a){AmCharts.onReadyArray.push(a)};AmCharts.handleLoad=function(){AmCharts.isReady=!0;for(var a=AmCharts.onReadyArray,b=0;b<a.length;b++){var c=a[b];isNaN(AmCharts.processDelay)?c():setTimeout(c,AmCharts.processDelay*b)}};
AmCharts.addInitHandler=function(a,b){AmCharts.initHandlers.push({method:a,types:b})};AmCharts.callInitHandler=function(a){var b=AmCharts.initHandlers;if(AmCharts.initHandlers)for(var c=0;c<b.length;c++){var d=b[c];d.types&&-1!=d.types.indexOf(a.type)&&d.method(a)}};AmCharts.getUniqueId=function(){AmCharts.uid++;return"AmChartsEl-"+AmCharts.uid};
AmCharts.isNN&&(document.addEventListener("mousemove",AmCharts.handleMouseMove,!0),window.addEventListener("resize",AmCharts.handleResize,!0),document.addEventListener("mouseup",AmCharts.handleMouseUp,!0),window.addEventListener("load",AmCharts.handleLoad,!0));AmCharts.isIE&&(document.attachEvent("onmousemove",AmCharts.handleMouseMove),window.attachEvent("onresize",AmCharts.handleResize),document.attachEvent("onmouseup",AmCharts.handleMouseUp),window.attachEvent("onload",AmCharts.handleLoad));
AmCharts.clear=function(){var a=AmCharts.charts;if(a)for(var b=0;b<a.length;b++)a[b].clear();AmCharts.charts=null;AmCharts.isNN&&(document.removeEventListener("mousemove",AmCharts.handleMouseMove,!0),window.removeEventListener("resize",AmCharts.handleResize,!0),document.removeEventListener("mouseup",AmCharts.handleMouseUp,!0),window.removeEventListener("load",AmCharts.handleLoad,!0));AmCharts.isIE&&(document.detachEvent("onmousemove",AmCharts.handleMouseMove),window.detachEvent("onresize",AmCharts.handleResize),
document.detachEvent("onmouseup",AmCharts.handleMouseUp),window.detachEvent("onload",AmCharts.handleLoad))};
AmCharts.makeChart=function(a,b,c){var d=b.type,e=b.theme;AmCharts.isString(e)&&(e=AmCharts.themes[e],b.theme=e);var f;switch(d){case "serial":f=new AmCharts.AmSerialChart(e);break;case "xy":f=new AmCharts.AmXYChart(e);break;case "pie":f=new AmCharts.AmPieChart(e);break;case "radar":f=new AmCharts.AmRadarChart(e);break;case "gauge":f=new AmCharts.AmAngularGauge(e);break;case "funnel":f=new AmCharts.AmFunnelChart(e);break;case "map":f=new AmCharts.AmMap(e);break;case "stock":f=new AmCharts.AmStockChart(e)}AmCharts.extend(f,
b);AmCharts.isReady?isNaN(c)?f.write(a):setTimeout(function(){AmCharts.realWrite(f,a)},c):AmCharts.ready(function(){isNaN(c)?f.write(a):setTimeout(function(){AmCharts.realWrite(f,a)},c)});return f};AmCharts.realWrite=function(a,b){a.write(b)};AmCharts.toBoolean=function(a,b){if(void 0===a)return b;switch(String(a).toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1;default:return Boolean(a)}};AmCharts.removeFromArray=function(a,b){var c;for(c=a.length-1;0<=c;c--)a[c]==b&&a.splice(c,1)};AmCharts.getDecimals=function(a){var b=0;isNaN(a)||(a=String(a),-1!=a.indexOf("e-")?b=Number(a.split("-")[1]):-1!=a.indexOf(".")&&(b=a.split(".")[1].length));return b};
AmCharts.wrappedText=function(a,b,c,d,e,f,g,h,k){var l=AmCharts.text(a,b,c,d,e,f,g),m="\n";AmCharts.isModern||(m="<br>");if(10<k)return l;if(l){var n=l.getBBox();if(n.width>h){l.remove();for(var l=[],p=0;-1<(index=b.indexOf(" ",p));)l.push(index),p=index+1;for(var q=Math.round(b.length/2),r=1E3,s,p=0;p<l.length;p++){var w=Math.abs(l[p]-q);w<r&&(s=l[p],r=w)}if(isNaN(s)){h=Math.ceil(n.width/h);if(0==k)for(p=1;p<h;p++)s=Math.round(b.length/h*p),b=b.substr(0,s)+m+b.substr(s);return AmCharts.text(a,b,
c,d,e,f,g)}b=b.substr(0,s)+m+b.substr(s+1);return AmCharts.wrappedText(a,b,c,d,e,f,g,h,k+1)}return l}};AmCharts.getStyle=function(a,b){var c="";document.defaultView&&document.defaultView.getComputedStyle?c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b):a.currentStyle&&(b=b.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),c=a.currentStyle[b]);return c};AmCharts.removePx=function(a){if(void 0!=a)return Number(a.substring(0,a.length-2))};
AmCharts.getURL=function(a,b){if(a)if("_self"!=b&&b)if("_top"==b&&window.top)window.top.location.href=a;else if("_parent"==b&&window.parent)window.parent.location.href=a;else if("_blank"==b)window.open(a);else{var c=document.getElementsByName(b)[0];c?c.src=a:(c=AmCharts.windows[b])?c.opener&&!c.opener.closed?c.location.href=a:AmCharts.windows[b]=window.open(a):AmCharts.windows[b]=window.open(a)}else window.location.href=a};AmCharts.ifArray=function(a){return a&&0<a.length?!0:!1};
AmCharts.callMethod=function(a,b){var c;for(c=0;c<b.length;c++){var d=b[c];if(d){if(d[a])d[a]();var e=d.length;if(0<e){var f;for(f=0;f<e;f++){var g=d[f];if(g&&g[a])g[a]()}}}}};AmCharts.toNumber=function(a){return"number"==typeof a?a:Number(String(a).replace(/[^0-9\-.]+/g,""))};
AmCharts.toColor=function(a){if(""!==a&&void 0!==a)if(-1!=a.indexOf(",")){a=a.split(",");var b;for(b=0;b<a.length;b++){var c=a[b].substring(a[b].length-6,a[b].length);a[b]="#"+c}}else a=a.substring(a.length-6,a.length),a="#"+a;return a};AmCharts.toCoordinate=function(a,b,c){var d;void 0!==a&&(a=String(a),c&&c<b&&(b=c),d=Number(a),-1!=a.indexOf("!")&&(d=b-Number(a.substr(1))),-1!=a.indexOf("%")&&(d=b*Number(a.substr(0,a.length-1))/100));return d};
AmCharts.fitToBounds=function(a,b,c){a<b&&(a=b);a>c&&(a=c);return a};AmCharts.isDefined=function(a){return void 0===a?!1:!0};AmCharts.stripNumbers=function(a){return a.replace(/[0-9]+/g,"")};AmCharts.roundTo=function(a,b){if(0>b)return a;var c=Math.pow(10,b);return Math.round(a*c)/c};AmCharts.toFixed=function(a,b){var c=String(Math.round(a*Math.pow(10,b)));if(0<b){var d=c.length;if(d<b){var e;for(e=0;e<b-d;e++)c="0"+c}d=c.substring(0,c.length-b);""===d&&(d=0);return d+"."+c.substring(c.length-b,c.length)}return String(c)};
AmCharts.formatDuration=function(a,b,c,d,e,f){var g=AmCharts.intervals,h=f.decimalSeparator;if(a>=g[b].contains){var k=a-Math.floor(a/g[b].contains)*g[b].contains;"ss"==b&&(k=AmCharts.formatNumber(k,f),1==k.split(h)[0].length&&(k="0"+k));("mm"==b||"hh"==b)&&10>k&&(k="0"+k);c=k+""+d[b]+""+c;a=Math.floor(a/g[b].contains);b=g[b].nextInterval;return AmCharts.formatDuration(a,b,c,d,e,f)}"ss"==b&&(a=AmCharts.formatNumber(a,f),1==a.split(h)[0].length&&(a="0"+a));("mm"==b||"hh"==b)&&10>a&&(a="0"+a);c=a+""+
d[b]+""+c;if(g[e].count>g[b].count)for(a=g[b].count;a<g[e].count;a++)b=g[b].nextInterval,"ss"==b||"mm"==b||"hh"==b?c="00"+d[b]+""+c:"DD"==b&&(c="0"+d[b]+""+c);":"==c.charAt(c.length-1)&&(c=c.substring(0,c.length-1));return c};
AmCharts.formatNumber=function(a,b,c,d,e){a=AmCharts.roundTo(a,b.precision);isNaN(c)&&(c=b.precision);var f=b.decimalSeparator;b=b.thousandsSeparator;var g;g=0>a?"-":"";a=Math.abs(a);var h=String(a),k=!1;-1!=h.indexOf("e")&&(k=!0);0<=c&&!k&&(h=AmCharts.toFixed(a,c));var l="";if(k)l=h;else{var h=h.split("."),k=String(h[0]),m;for(m=k.length;0<=m;m-=3)l=m!=k.length?0!==m?k.substring(m-3,m)+b+l:k.substring(m-3,m)+l:k.substring(m-3,m);void 0!==h[1]&&(l=l+f+h[1]);void 0!==c&&0<c&&"0"!=l&&(l=AmCharts.addZeroes(l,
f,c))}l=g+l;""===g&&!0===d&&0!==a&&(l="+"+l);!0===e&&(l+="%");return l};AmCharts.addZeroes=function(a,b,c){a=a.split(b);void 0===a[1]&&0<c&&(a[1]="0");return a[1].length<c?(a[1]+="0",AmCharts.addZeroes(a[0]+b+a[1],b,c)):void 0!==a[1]?a[0]+b+a[1]:a[0]};
AmCharts.scientificToNormal=function(a){var b;a=String(a).split("e");var c;if("-"==a[1].substr(0,1)){b="0.";for(c=0;c<Math.abs(Number(a[1]))-1;c++)b+="0";b+=a[0].split(".").join("")}else{var d=0;b=a[0].split(".");b[1]&&(d=b[1].length);b=a[0].split(".").join("");for(c=0;c<Math.abs(Number(a[1]))-d;c++)b+="0"}return b};
AmCharts.toScientific=function(a,b){if(0===a)return"0";var c=Math.floor(Math.log(Math.abs(a))*Math.LOG10E);Math.pow(10,c);mantissa=String(mantissa).split(".").join(b);return String(mantissa)+"e"+c};AmCharts.randomColor=function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)};
AmCharts.hitTest=function(a,b,c){var d=!1,e=a.x,f=a.x+a.width,g=a.y,h=a.y+a.height,k=AmCharts.isInRectangle;d||(d=k(e,g,b));d||(d=k(e,h,b));d||(d=k(f,g,b));d||(d=k(f,h,b));d||!0===c||(d=AmCharts.hitTest(b,a,!0));return d};AmCharts.isInRectangle=function(a,b,c){return a>=c.x-5&&a<=c.x+c.width+5&&b>=c.y-5&&b<=c.y+c.height+5?!0:!1};AmCharts.isPercents=function(a){if(-1!=String(a).indexOf("%"))return!0};
AmCharts.findPosX=function(a){var b=a,c=a.offsetLeft;if(a.offsetParent){for(;a=a.offsetParent;)c+=a.offsetLeft;for(;(b=b.parentNode)&&b!=document.body;)c-=b.scrollLeft||0}return c};AmCharts.findPosY=function(a){var b=a,c=a.offsetTop;if(a.offsetParent){for(;a=a.offsetParent;)c+=a.offsetTop;for(;(b=b.parentNode)&&b!=document.body;)c-=b.scrollTop||0}return c};AmCharts.findIfFixed=function(a){if(a.offsetParent)for(;a=a.offsetParent;)if("fixed"==AmCharts.getStyle(a,"position"))return!0;return!1};
AmCharts.findIfAuto=function(a){return a.style&&"auto"==AmCharts.getStyle(a,"overflow")?!0:a.parentNode?AmCharts.findIfAuto(a.parentNode):!1};AmCharts.findScrollLeft=function(a,b){a.scrollLeft&&(b+=a.scrollLeft);return a.parentNode?AmCharts.findScrollLeft(a.parentNode,b):b};AmCharts.findScrollTop=function(a,b){a.scrollTop&&(b+=a.scrollTop);return a.parentNode?AmCharts.findScrollTop(a.parentNode,b):b};
AmCharts.formatValue=function(a,b,c,d,e,f,g,h){if(b){void 0===e&&(e="");var k;for(k=0;k<c.length;k++){var l=c[k],m=b[l];void 0!==m&&(m=f?AmCharts.addPrefix(m,h,g,d):AmCharts.formatNumber(m,d),a=a.replace(new RegExp("\\[\\["+e+""+l+"\\]\\]","g"),m))}}return a};AmCharts.formatDataContextValue=function(a,b){if(a){var c=a.match(/\[\[.*?\]\]/g),d;for(d=0;d<c.length;d++){var e=c[d],e=e.substr(2,e.length-4);void 0!==b[e]&&(a=a.replace(new RegExp("\\[\\["+e+"\\]\\]","g"),b[e]))}}return a};
AmCharts.massReplace=function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];void 0===d&&(d="");a=a.replace(c,d)}return a};AmCharts.cleanFromEmpty=function(a){return a.replace(/\[\[[^\]]*\]\]/g,"")};
AmCharts.addPrefix=function(a,b,c,d,e){var f=AmCharts.formatNumber(a,d),g="",h,k,l;if(0===a)return"0";0>a&&(g="-");a=Math.abs(a);if(1<a)for(h=b.length-1;-1<h;h--){if(a>=b[h].number&&(k=a/b[h].number,l=Number(d.precision),1>l&&(l=1),c=AmCharts.roundTo(k,l),l=AmCharts.formatNumber(c,{precision:-1,decimalSeparator:d.decimalSeparator,thousandsSeparator:d.thousandsSeparator}),!e||k==c)){f=g+""+l+""+b[h].prefix;break}}else for(h=0;h<c.length;h++)if(a<=c[h].number){k=a/c[h].number;l=Math.abs(Math.round(Math.log(k)*
Math.LOG10E));k=AmCharts.roundTo(k,l);f=g+""+k+""+c[h].prefix;break}return f};AmCharts.remove=function(a){a&&a.remove()};AmCharts.recommended=function(){var a="js";document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")||swfobject&&swfobject.hasFlashPlayerVersion("8")&&(a="flash");return a};AmCharts.getEffect=function(a){">"==a&&(a="easeOutSine");"<"==a&&(a="easeInSine");"elastic"==a&&(a="easeOutElastic");return a};
AmCharts.getObjById=function(a,b){var c,d;for(d=0;d<a.length;d++){var e=a[d];e.id==b&&(c=e)}return c};AmCharts.applyTheme=function(a,b,c){b||(b=AmCharts.theme);b&&b[c]&&AmCharts.extend(a,b[c])};AmCharts.isString=function(a){return"string"==typeof a?!0:!1};AmCharts.extend=function(a,b,c){for(var d in b)c?a.hasOwnProperty(d)||(a[d]=b[d]):a[d]=b[d];return a};
AmCharts.copyProperties=function(a,b){for(var c in a)a.hasOwnProperty(c)&&"events"!=c&&void 0!==a[c]&&"function"!=typeof a[c]&&"cname"!=c&&(b[c]=a[c])};AmCharts.processObject=function(a,b,c){!1===a instanceof b&&(a=AmCharts.extend(new b(c),a));return a};AmCharts.fixNewLines=function(a){var b=RegExp("\\n","g");a&&(a=a.replace(b,"<br />"));return a};AmCharts.fixBrakes=function(a){if(AmCharts.isModern){var b=RegExp("<br>","g");a&&(a=a.replace(b,"\n"))}else a=AmCharts.fixNewLines(a);return a};
AmCharts.deleteObject=function(a,b){if(a){if(void 0===b||null===b)b=20;if(0!==b)if("[object Array]"===Object.prototype.toString.call(a))for(var c=0;c<a.length;c++)AmCharts.deleteObject(a[c],b-1),a[c]=null;else if(a&&!a.tagName)try{for(c in a)a[c]&&("object"==typeof a[c]&&AmCharts.deleteObject(a[c],b-1),"function"!=typeof a[c]&&(a[c]=null))}catch(d){}}};
AmCharts.bounce=function(a,b,c,d,e){return(b/=e)<1/2.75?7.5625*d*b*b+c:b<2/2.75?d*(7.5625*(b-=1.5/2.75)*b+.75)+c:b<2.5/2.75?d*(7.5625*(b-=2.25/2.75)*b+.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+.984375)+c};AmCharts.easeInSine=function(a,b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c};AmCharts.easeOutSine=function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c};
AmCharts.easeOutElastic=function(a,b,c,d,e){a=1.70158;var f=0,g=d;if(0===b)return c;if(1==(b/=e))return c+d;f||(f=.3*e);g<Math.abs(d)?(g=d,a=f/4):a=f/(2*Math.PI)*Math.asin(d/g);return g*Math.pow(2,-10*b)*Math.sin(2*(b*e-a)*Math.PI/f)+d+c};AmCharts.AxisBase=AmCharts.Class({construct:function(a){this.createEvents("clickItem","rollOverItem","rollOutItem");this.viY=this.viX=this.y=this.x=this.dy=this.dx=0;this.axisThickness=1;this.axisColor="#000000";this.axisAlpha=1;this.gridCount=this.tickLength=5;this.gridAlpha=.15;this.gridThickness=1;this.gridColor="#000000";this.dashLength=0;this.labelFrequency=1;this.showLastLabel=this.showFirstLabel=!0;this.fillColor="#FFFFFF";this.fillAlpha=0;this.labelsEnabled=!0;this.labelRotation=0;this.autoGridCount=
!0;this.valueRollOverColor="#CC0000";this.offset=0;this.guides=[];this.visible=!0;this.counter=0;this.guides=[];this.ignoreAxisWidth=this.inside=!1;this.minHorizontalGap=75;this.minVerticalGap=35;this.titleBold=!0;this.minorGridEnabled=!1;this.minorGridAlpha=.07;this.autoWrap=!1;this.titleAlign="middle";this.labelOffset=0;AmCharts.applyTheme(this,a,"AxisBase")},zoom:function(a,b){this.start=a;this.end=b;this.dataChanged=!0;this.draw()},fixAxisPosition:function(){var a=this.position;"H"==this.orientation?
("left"==a&&(a="bottom"),"right"==a&&(a="top")):("bottom"==a&&(a="left"),"top"==a&&(a="right"));this.position=a},draw:function(){var a=this.chart;this.allLabels=[];this.counter=0;this.destroy();this.fixAxisPosition();this.labels=[];var b=a.container,c=b.set();a.gridSet.push(c);this.set=c;b=b.set();a.axesLabelsSet.push(b);this.labelsSet=b;this.axisLine=new this.axisRenderer(this);this.autoGridCount?("V"==this.orientation?(a=this.height/this.minVerticalGap,3>a&&(a=3)):a=this.width/this.minHorizontalGap,
this.gridCountR=Math.max(a,1)):this.gridCountR=this.gridCount;this.axisWidth=this.axisLine.axisWidth;this.addTitle()},setOrientation:function(a){this.orientation=a?"H":"V"},addTitle:function(){var a=this.title;if(a){var b=this.chart,c=this.titleColor;void 0===c&&(c=b.color);var d=this.titleFontSize;isNaN(d)&&(d=b.fontSize+1);this.titleLabel=AmCharts.text(b.container,a,c,b.fontFamily,d,this.titleAlign,this.titleBold)}},positionTitle:function(){var a=this.titleLabel;if(a){var b,c,d=this.labelsSet,e=
{};0<d.length()?e=d.getBBox():(e.x=0,e.y=0,e.width=this.viW,e.height=this.viH);d.push(a);var d=e.x,f=e.y;AmCharts.VML&&(this.rotate?d-=this.x:f-=this.y);var g=e.width,e=e.height,h=this.viW,k=this.viH,l=0,m=a.getBBox().height/2,n=this.inside,p=this.titleAlign;switch(this.position){case "top":b="left"==p?-1:"right"==p?h:h/2;c=f-10-m;break;case "bottom":b="left"==p?-1:"right"==p?h:h/2;c=f+e+10+m;break;case "left":b=d-10-m;n&&(b-=5);c="left"==p?k+1:"right"==p?-1:k/2;l=-90;break;case "right":b=d+g+10+
m-3,n&&(b+=7),c="left"==p?k+2:"right"==p?-2:k/2,l=-90}this.marginsChanged?(a.translate(b,c),this.tx=b,this.ty=c):a.translate(this.tx,this.ty);this.marginsChanged=!1;0!==l&&a.rotate(l)}},pushAxisItem:function(a,b){var c=this,d=a.graphics();0<d.length()&&(b?c.labelsSet.push(d):c.set.push(d));if(d=a.getLabel())this.labelsSet.push(d),d.click(function(b){c.handleMouse(b,a,"clickItem")}).mouseover(function(b){c.handleMouse(b,a,"rollOverItem")}).mouseout(function(b){c.handleMouse(b,a,"rollOutItem")})},handleMouse:function(a,
b,c){this.fire(c,{type:c,value:b.value,serialDataItem:b.serialDataItem,axis:this,target:b.label,chart:this.chart,event:a})},addGuide:function(a){for(var b=this.guides,c=!1,d=0;d<b.length;d++)b[d]==a&&(c=!0);c||b.push(a)},removeGuide:function(a){var b=this.guides,c;for(c=0;c<b.length;c++)b[c]==a&&b.splice(c,1)},handleGuideOver:function(a){clearTimeout(this.chart.hoverInt);var b=a.graphics.getBBox(),c=b.x+b.width/2,b=b.y+b.height/2,d=a.fillColor;void 0===d&&(d=a.lineColor);this.chart.showBalloon(a.balloonText,
d,!0,c,b)},handleGuideOut:function(a){this.chart.hideBalloon()},addEventListeners:function(a,b){var c=this;a.mouseover(function(){c.handleGuideOver(b)});a.mouseout(function(){c.handleGuideOut(b)})},getBBox:function(){var a=this.labelsSet.getBBox();AmCharts.VML||(a={x:a.x+this.x,y:a.y+this.y,width:a.width,height:a.height});return a},destroy:function(){AmCharts.remove(this.set);AmCharts.remove(this.labelsSet);var a=this.axisLine;a&&AmCharts.remove(a.set);AmCharts.remove(this.grid0)}});AmCharts.ValueAxis=AmCharts.Class({inherits:AmCharts.AxisBase,construct:function(a){this.cname="ValueAxis";this.createEvents("axisChanged","logarithmicAxisFailed","axisSelfZoomed","axisZoomed");AmCharts.ValueAxis.base.construct.call(this,a);this.dataChanged=!0;this.stackType="none";this.position="left";this.unitPosition="right";this.recalculateToPercents=this.includeHidden=this.includeGuidesInMinMax=this.integersOnly=!1;this.durationUnits={DD:"d. ",hh:":",mm:":",ss:""};this.scrollbar=!1;this.baseValue=
0;this.radarCategoriesEnabled=!0;this.gridType="polygons";this.useScientificNotation=!1;this.axisTitleOffset=10;this.minMaxMultiplier=1;this.logGridLimit=2;AmCharts.applyTheme(this,a,this.cname)},updateData:function(){0>=this.gridCountR&&(this.gridCountR=1);this.totals=[];this.data=this.chart.chartData;var a=this.chart;"xy"!=a.type&&(this.stackGraphs("smoothedLine"),this.stackGraphs("line"),this.stackGraphs("column"),this.stackGraphs("step"));this.recalculateToPercents&&this.recalculate();this.synchronizationMultiplier&&
this.synchronizeWith?(AmCharts.isString(this.synchronizeWith)&&(this.synchronizeWith=a.getValueAxisById(this.synchronizeWith)),this.synchronizeWith&&(this.synchronizeWithAxis(this.synchronizeWith),this.foundGraphs=!0)):(this.foundGraphs=!1,this.getMinMax())},draw:function(){AmCharts.ValueAxis.base.draw.call(this);var a=this.chart,b=this.set;"duration"==this.type&&(this.duration="ss");!0===this.dataChanged&&(this.updateData(),this.dataChanged=!1);if(this.logarithmic&&(0>=this.getMin(0,this.data.length-
1)||0>=this.minimum))this.fire("logarithmicAxisFailed",{type:"logarithmicAxisFailed",chart:a});else{this.grid0=null;var c,d,e=a.dx,f=a.dy,g=!1,h=this.logarithmic;if(isNaN(this.min)||isNaN(this.max)||!this.foundGraphs||Infinity==this.min||-Infinity==this.max)g=!0;else{var k=this.labelFrequency,l=this.showFirstLabel,m=this.showLastLabel,n=1,p=0,q=Math.round((this.max-this.min)/this.step)+1,r;!0===h?(r=Math.log(this.max)*Math.LOG10E-Math.log(this.minReal)*Math.LOG10E,this.stepWidth=this.axisWidth/r,
r>this.logGridLimit&&(q=Math.ceil(Math.log(this.max)*Math.LOG10E)+1,p=Math.round(Math.log(this.minReal)*Math.LOG10E),q>this.gridCountR&&(n=Math.ceil(q/this.gridCountR)))):this.stepWidth=this.axisWidth/(this.max-this.min);var s=0;1>this.step&&-1<this.step&&(s=AmCharts.getDecimals(this.step));this.integersOnly&&(s=0);s>this.maxDecCount&&(s=this.maxDecCount);var w=this.precision;isNaN(w)||(s=w);this.max=AmCharts.roundTo(this.max,this.maxDecCount);this.min=AmCharts.roundTo(this.min,this.maxDecCount);
d={};d.precision=s;d.decimalSeparator=a.nf.decimalSeparator;d.thousandsSeparator=a.nf.thousandsSeparator;this.numberFormatter=d;var v,t=this.guides;c=t.length;if(0<c){var u=this.fillAlpha;for(d=this.fillAlpha=0;d<c;d++){var x=t[d],E=NaN,A=x.above;isNaN(x.toValue)||(E=this.getCoordinate(x.toValue),v=new this.axisItemRenderer(this,E,"",!0,NaN,NaN,x),this.pushAxisItem(v,A));var z=NaN;isNaN(x.value)||(z=this.getCoordinate(x.value),v=new this.axisItemRenderer(this,z,x.label,!0,NaN,(E-z)/2,x),this.pushAxisItem(v,
A));isNaN(E-z)||(v=new this.guideFillRenderer(this,z,E,x),this.pushAxisItem(v,A),v=v.graphics(),x.graphics=v,x.balloonText&&this.addEventListeners(v,x))}this.fillAlpha=u}this.exponential=!1;for(d=p;d<q;d+=n)t=AmCharts.roundTo(this.step*d+this.min,s),-1!=String(t).indexOf("e")&&(this.exponential=!0,String(t).split("e"));this.duration&&(this.maxInterval=AmCharts.getMaxInterval(this.max,this.duration));var s=this.step,H,t=this.minorGridAlpha;this.minorGridEnabled&&(H=this.getMinorGridStep(s,this.stepWidth*
s));for(d=p;d<q;d+=n)if(p=s*d+this.min,h&&this.max-this.min>5*this.min&&(p-=this.min),p=AmCharts.roundTo(p,this.maxDecCount+1),!this.integersOnly||Math.round(p)==p)if(isNaN(w)||Number(AmCharts.toFixed(p,w))==p){!0===h&&(0===p&&(p=this.minReal),r>this.logGridLimit&&(p=Math.pow(10,d)));v=this.formatValue(p,!1,d);Math.round(d/k)!=d/k&&(v=void 0);if(0===d&&!l||d==q-1&&!m)v=" ";c=this.getCoordinate(p);v=new this.axisItemRenderer(this,c,v,void 0,void 0,void 0,void 0,this.boldLabels);this.pushAxisItem(v);
if(p==this.baseValue&&"radar"!=a.type){var F,G,x=this.viW,A=this.viH;v=this.viX;u=this.viY;"H"==this.orientation?0<=c&&c<=x+1&&(F=[c,c,c+e],G=[A,0,f]):0<=c&&c<=A+1&&(F=[0,x,x+e],G=[c,c,c+f]);F&&(c=AmCharts.fitToBounds(2*this.gridAlpha,0,1),c=AmCharts.line(a.container,F,G,this.gridColor,c,1,this.dashLength),c.translate(v,u),this.grid0=c,a.axesSet.push(c),c.toBack())}if(!isNaN(H)&&0<t&&d<q-1){v=this.gridAlpha;this.gridAlpha=this.minorGridAlpha;for(c=1;c<s/H;c++)u=this.getCoordinate(p+H*c),u=new this.axisItemRenderer(this,
u,"",!1,0,0,!1,!1,0,!0),this.pushAxisItem(u);this.gridAlpha=v}}e=this.baseValue;this.min>this.baseValue&&this.max>this.baseValue&&(e=this.min);this.min<this.baseValue&&this.max<this.baseValue&&(e=this.max);h&&e<this.minReal&&(e=this.minReal);this.baseCoord=this.getCoordinate(e);e={type:"axisChanged",target:this,chart:a};e.min=h?this.minReal:this.min;e.max=this.max;this.fire("axisChanged",e);this.axisCreated=!0}h=this.axisLine.set;e=this.labelsSet;this.positionTitle();"radar"!=a.type?(a=this.viX,f=
this.viY,b.translate(a,f),e.translate(a,f)):h.toFront();!this.visible||g?(b.hide(),h.hide(),e.hide()):(b.show(),h.show(),e.show());this.axisY=this.y-this.viY;this.axisX=this.x-this.viX}},formatValue:function(a,b,c){var d=this.exponential,e=this.logarithmic,f=this.numberFormatter,g=this.chart;!0===this.logarithmic&&(d=-1!=String(a).indexOf("e")?!0:!1);this.useScientificNotation&&(d=!0);this.usePrefixes&&(d=!1);d?(valueText=-1==String(a).indexOf("e")?a.toExponential(15):String(a),c=valueText.split("e"),
b=Number(c[0]),c=Number(c[1]),b=AmCharts.roundTo(b,14),10==b&&(b=1,c+=1),valueText=b+"e"+c,0===a&&(valueText="0"),1==a&&(valueText="1")):(e&&(d=String(a).split("."),d[1]?(f.precision=d[1].length,0>c&&(f.precision=Math.abs(c))):f.precision=-1),valueText=this.usePrefixes?AmCharts.addPrefix(a,g.prefixesOfBigNumbers,g.prefixesOfSmallNumbers,f,!b):AmCharts.formatNumber(a,f,f.precision));this.duration&&(valueText=AmCharts.formatDuration(a,this.duration,"",this.durationUnits,this.maxInterval,f));this.recalculateToPercents?
valueText+="%":(f=this.unit)&&(valueText="left"==this.unitPosition?f+valueText:valueText+f);this.labelFunction&&(valueText=this.labelFunction(a,valueText,this).toString());return valueText},getMinorGridStep:function(a,b){var c=[5,4,2];60>b&&c.shift();for(var d=Math.floor(Math.log(Math.abs(a))*Math.LOG10E),e=0;e<c.length;e++){var f=a/c[e],g=Math.floor(Math.log(Math.abs(f))*Math.LOG10E);if(!(0<Math.abs(d-g)))if(1>a){if(g=Math.pow(10,-g)*f,g==Math.round(g))return f}else if(f==Math.round(f))return f}},
stackGraphs:function(a){var b=this.stackType;"stacked"==b&&(b="regular");"line"==b&&(b="none");"100% stacked"==b&&(b="100%");this.stackType=b;var c=[],d=[],e=[],f=[],g,h=this.chart.graphs,k,l,m,n,p=this.baseValue,q=!1;if("line"==a||"step"==a||"smoothedLine"==a)q=!0;if(q&&("regular"==b||"100%"==b))for(n=0;n<h.length;n++)m=h[n],m.hidden||(l=m.type,m.chart==this.chart&&m.valueAxis==this&&a==l&&m.stackable&&(k&&(m.stackGraph=k),k=m));for(k=this.start;k<=this.end;k++){var r=0;for(n=0;n<h.length;n++)if(m=
h[n],m.hidden)m.newStack&&(e[k]=NaN,d[k]=NaN);else if(l=m.type,m.chart==this.chart&&m.valueAxis==this&&a==l&&m.stackable)if(l=this.data[k].axes[this.id].graphs[m.id],g=l.values.value,isNaN(g))m.newStack&&(e[k]=NaN,d[k]=NaN);else{var s=AmCharts.getDecimals(g);r<s&&(r=s);isNaN(f[k])?f[k]=Math.abs(g):f[k]+=Math.abs(g);f[k]=AmCharts.roundTo(f[k],r);s=m.fillToGraph;q&&s&&(s=this.data[k].axes[this.id].graphs[s.id])&&(l.values.open=s.values.value);"regular"==b&&(q&&(isNaN(c[k])?(c[k]=g,l.values.close=g,
l.values.open=this.baseValue):(isNaN(g)?l.values.close=c[k]:l.values.close=g+c[k],l.values.open=c[k],c[k]=l.values.close)),"column"==a&&(m.newStack&&(e[k]=NaN,d[k]=NaN),l.values.close=g,0>g?(l.values.close=g,isNaN(d[k])?l.values.open=p:(l.values.close+=d[k],l.values.open=d[k]),d[k]=l.values.close):(l.values.close=g,isNaN(e[k])?l.values.open=p:(l.values.close+=e[k],l.values.open=e[k]),e[k]=l.values.close)))}}for(k=this.start;k<=this.end;k++)for(n=0;n<h.length;n++)(m=h[n],m.hidden)?m.newStack&&(e[k]=
NaN,d[k]=NaN):(l=m.type,m.chart==this.chart&&m.valueAxis==this&&a==l&&m.stackable&&(l=this.data[k].axes[this.id].graphs[m.id],g=l.values.value,isNaN(g)||(c=g/f[k]*100,l.values.percents=c,l.values.total=f[k],m.newStack&&(e[k]=NaN,d[k]=NaN),"100%"==b&&(isNaN(d[k])&&(d[k]=0),isNaN(e[k])&&(e[k]=0),0>c?(l.values.close=AmCharts.fitToBounds(c+d[k],-100,100),l.values.open=d[k],d[k]=l.values.close):(l.values.close=AmCharts.fitToBounds(c+e[k],-100,100),l.values.open=e[k],e[k]=l.values.close)))))},recalculate:function(){var a=
this.chart,b=a.graphs,c;for(c=0;c<b.length;c++){var d=b[c];if(d.valueAxis==this){var e="value";if("candlestick"==d.type||"ohlc"==d.type)e="open";var f,g,h=this.end+2,h=AmCharts.fitToBounds(this.end+1,0,this.data.length-1),k=this.start;0<k&&k--;var l;g=this.start;d.compareFromStart&&(g=0);if(!isNaN(a.startTime)&&(l=a.categoryAxis)){minDuration=l.minDuration();var m=new Date(a.startTime+minDuration/2),n=AmCharts.resetDateToMin(new Date(a.startTime),l.minPeriod).getTime();AmCharts.resetDateToMin(new Date(m),
l.minPeriod).getTime()>n&&g++}if(l=a.recalculateFromDate)a.dataDateFormat&&(l=AmCharts.stringToDate(l,a.dataDateFormat)),g=a.getClosestIndex(a.chartData,"time",l.getTime(),!0,0,a.chartData.length),h=a.chartData.length-1;for(l=g;l<=h&&(g=this.data[l].axes[this.id].graphs[d.id],f=g.values[e],isNaN(f));l++);this.recBaseValue=f;for(e=k;e<=h;e++){g=this.data[e].axes[this.id].graphs[d.id];g.percents={};var k=g.values,p;for(p in k)g.percents[p]="percents"!=p?k[p]/f*100-100:k[p]}}}},getMinMax:function(){var a=
!1,b=this.chart,c=b.graphs,d;for(d=0;d<c.length;d++){var e=c[d].type;("line"==e||"step"==e||"smoothedLine"==e)&&this.expandMinMax&&(a=!0)}a&&(0<this.start&&this.start--,this.end<this.data.length-1&&this.end++);"serial"==b.type&&(!0!==b.categoryAxis.parseDates||a||this.end<this.data.length-1&&this.end++);a=this.minMaxMultiplier;this.min=this.getMin(this.start,this.end);this.max=this.getMax();a=(this.max-this.min)*(a-1);this.min-=a;this.max+=a;a=this.guides.length;if(this.includeGuidesInMinMax&&0<a)for(b=
0;b<a;b++)c=this.guides[b],c.toValue<this.min&&(this.min=c.toValue),c.value<this.min&&(this.min=c.value),c.toValue>this.max&&(this.max=c.toValue),c.value>this.max&&(this.max=c.value);isNaN(this.minimum)||(this.min=this.minimum);isNaN(this.maximum)||(this.max=this.maximum);this.min>this.max&&(a=this.max,this.max=this.min,this.min=a);isNaN(this.minTemp)||(this.min=this.minTemp);isNaN(this.maxTemp)||(this.max=this.maxTemp);this.minReal=this.min;this.maxReal=this.max;0===this.min&&0===this.max&&(this.max=
9);this.min>this.max&&(this.min=this.max-1);a=this.min;b=this.max;c=this.max-this.min;d=0===c?Math.pow(10,Math.floor(Math.log(Math.abs(this.max))*Math.LOG10E))/10:Math.pow(10,Math.floor(Math.log(Math.abs(c))*Math.LOG10E))/10;isNaN(this.maximum)&&isNaN(this.maxTemp)&&(this.max=Math.ceil(this.max/d)*d+d);isNaN(this.minimum)&&isNaN(this.minTemp)&&(this.min=Math.floor(this.min/d)*d-d);0>this.min&&0<=a&&(this.min=0);0<this.max&&0>=b&&(this.max=0);"100%"==this.stackType&&(this.min=0>this.min?-100:0,this.max=
0>this.max?0:100);c=this.max-this.min;d=Math.pow(10,Math.floor(Math.log(Math.abs(c))*Math.LOG10E))/10;this.step=Math.ceil(c/this.gridCountR/d)*d;c=Math.pow(10,Math.floor(Math.log(Math.abs(this.step))*Math.LOG10E));c=this.fixStepE(c);d=Math.ceil(this.step/c);5<d&&(d=10);5>=d&&2<d&&(d=5);this.step=Math.ceil(this.step/(c*d))*c*d;1>c?(this.maxDecCount=Math.abs(Math.log(Math.abs(c))*Math.LOG10E),this.maxDecCount=Math.round(this.maxDecCount),this.step=AmCharts.roundTo(this.step,this.maxDecCount+1)):this.maxDecCount=
0;this.min=this.step*Math.floor(this.min/this.step);this.max=this.step*Math.ceil(this.max/this.step);0>this.min&&0<=a&&(this.min=0);0<this.max&&0>=b&&(this.max=0);1<this.minReal&&1<this.max-this.minReal&&(this.minReal=Math.floor(this.minReal));c=Math.pow(10,Math.floor(Math.log(Math.abs(this.minReal))*Math.LOG10E));0===this.min&&(this.minReal=c);0===this.min&&1<this.minReal&&(this.minReal=1);0<this.min&&0<this.minReal-this.step&&(this.minReal=this.min+this.step<this.minReal?this.min+this.step:this.min);
c=Math.log(b)*Math.LOG10E-Math.log(a)*Math.LOG10E;this.logarithmic&&(2<c?(this.minReal=this.min=Math.pow(10,Math.floor(Math.log(Math.abs(a))*Math.LOG10E)),this.max=Math.pow(10,Math.ceil(Math.log(Math.abs(b))*Math.LOG10E))):(b=Math.pow(10,Math.floor(Math.log(Math.abs(this.min))*Math.LOG10E))/10,a=Math.pow(10,Math.floor(Math.log(Math.abs(a))*Math.LOG10E))/10,b<a&&(this.minReal=this.min=10*a)))},fixStepE:function(a){a=a.toExponential(0).split("e");var b=Number(a[1]);9==Number(a[0])&&b++;return this.generateNumber(1,
b)},generateNumber:function(a,b){var c="",d;d=0>b?Math.abs(b)-1:Math.abs(b);var e;for(e=0;e<d;e++)c+="0";return 0>b?Number("0."+c+String(a)):Number(String(a)+c)},getMin:function(a,b){var c,d;for(d=a;d<=b;d++){var e=this.data[d].axes[this.id].graphs,f;for(f in e)if(e.hasOwnProperty(f)){var g=this.chart.getGraphById(f);if(g.includeInMinMax&&(!g.hidden||this.includeHidden)){isNaN(c)&&(c=Infinity);this.foundGraphs=!0;g=e[f].values;this.recalculateToPercents&&(g=e[f].percents);var h;if(this.minMaxField)h=
g[this.minMaxField],h<c&&(c=h);else for(var k in g)g.hasOwnProperty(k)&&"percents"!=k&&"total"!=k&&(h=g[k],h<c&&(c=h))}}}return c},getMax:function(){var a,b;for(b=this.start;b<=this.end;b++){var c=this.data[b].axes[this.id].graphs,d;for(d in c)if(c.hasOwnProperty(d)){var e=this.chart.getGraphById(d);if(e.includeInMinMax&&(!e.hidden||this.includeHidden)){isNaN(a)&&(a=-Infinity);this.foundGraphs=!0;e=c[d].values;this.recalculateToPercents&&(e=c[d].percents);var f;if(this.minMaxField)f=e[this.minMaxField],
f>a&&(a=f);else for(var g in e)e.hasOwnProperty(g)&&"percents"!=g&&"total"!=g&&(f=e[g],f>a&&(a=f))}}}return a},dispatchZoomEvent:function(a,b){var c={type:"axisZoomed",startValue:a,endValue:b,target:this,chart:this.chart};this.fire(c.type,c)},zoomToValues:function(a,b){if(b<a){var c=b;b=a;a=c}a<this.min&&(a=this.min);b>this.max&&(b=this.max);c={type:"axisSelfZoomed"};c.chart=this.chart;c.valueAxis=this;c.multiplier=this.axisWidth/Math.abs(this.getCoordinate(b)-this.getCoordinate(a));c.position="V"==
this.orientation?this.reversed?this.getCoordinate(a):this.getCoordinate(b):this.reversed?this.getCoordinate(b):this.getCoordinate(a);this.fire(c.type,c)},coordinateToValue:function(a){if(isNaN(a))return NaN;var b=this.axisWidth,c=this.stepWidth,d=this.reversed,e=this.rotate,f=this.min,g=this.minReal;return!0===this.logarithmic?Math.pow(10,(e?!0===d?(b-a)/c:a/c:!0===d?a/c:(b-a)/c)+Math.log(g)*Math.LOG10E):!0===d?e?f-(a-b)/c:a/c+f:e?a/c+f:f-(a-b)/c},getCoordinate:function(a){if(isNaN(a))return NaN;
var b=this.rotate,c=this.reversed,d=this.axisWidth,e=this.stepWidth,f=this.min,g=this.minReal;!0===this.logarithmic?(a=Math.log(a)*Math.LOG10E-Math.log(g)*Math.LOG10E,b=b?!0===c?d-e*a:e*a:!0===c?e*a:d-e*a):b=!0===c?b?d-e*(a-f):e*(a-f):b?e*(a-f):d-e*(a-f);b=this.rotate?b+(this.x-this.viX):b+(this.y-this.viY);1E7<Math.abs(b)&&(b=1E7*(b/Math.abs(b)));return Math.round(b)},synchronizeWithAxis:function(a){this.synchronizeWith=a;this.listenTo(this.synchronizeWith,"axisChanged",this.handleSynchronization)},
handleSynchronization:function(a){var b=this.synchronizeWith;a=b.min;var c=b.max,b=b.step,d=this.synchronizationMultiplier;d&&(this.min=a*d,this.max=c*d,this.step=b*d,a=Math.pow(10,Math.floor(Math.log(Math.abs(this.step))*Math.LOG10E)),a=Math.abs(Math.log(Math.abs(a))*Math.LOG10E),this.maxDecCount=a=Math.round(a),this.draw())}});AmCharts.RecAxis=AmCharts.Class({construct:function(a){var b=a.chart,c=a.axisThickness,d=a.axisColor,e=a.axisAlpha,f=a.offset,g=a.dx,h=a.dy,k=a.viX,l=a.viY,m=a.viH,n=a.viW,p=b.container;"H"==a.orientation?(d=AmCharts.line(p,[0,n],[0,0],d,e,c),this.axisWidth=a.width,"bottom"==a.position?(a=c/2+f+m+l-1,c=k):(a=-c/2-f+l+h,c=g+k)):(this.axisWidth=a.height,"right"==a.position?(d=AmCharts.line(p,[0,0,-g],[0,m,m-h],d,e,c),a=l+h,c=c/2+f+g+n+k-1):(d=AmCharts.line(p,[0,0],[0,m],d,e,c),a=l,c=-c/2-f+k));d.translate(c,
a);b.axesSet.push(d);this.set=d}});AmCharts.RecItem=AmCharts.Class({construct:function(a,b,c,d,e,f,g,h,k,l,m){b=Math.round(b);this.value=c;void 0==c&&(c="");k||(k=0);void 0==d&&(d=!0);var n=a.chart.fontFamily,p=a.fontSize;void 0==p&&(p=a.chart.fontSize);var q=a.color;void 0==q&&(q=a.chart.color);void 0!==m&&(q=m);var r=a.chart.container,s=r.set();this.set=s;var w=a.axisThickness,v=a.axisColor,t=a.axisAlpha,u=a.tickLength,x=a.gridAlpha,E=a.gridThickness,A=a.gridColor,z=a.dashLength,H=a.fillColor,F=a.fillAlpha,G=a.labelsEnabled;m=a.labelRotation;
var V=a.counter,N=a.inside,ia=a.labelOffset,da=a.dx,ba=a.dy,Sa=a.orientation,na=a.position,ta=a.previousCoord,L=a.viH,Y=a.viW,$=a.offset,oa,W;g?(G=!0,isNaN(g.tickLength)||(u=g.tickLength),void 0!=g.lineColor&&(A=g.lineColor),void 0!=g.color&&(q=g.color),isNaN(g.lineAlpha)||(x=g.lineAlpha),isNaN(g.dashLength)||(z=g.dashLength),isNaN(g.lineThickness)||(E=g.lineThickness),!0===g.inside&&(N=!0),isNaN(g.labelRotation)||(m=g.labelRotation),isNaN(g.fontSize)||(p=g.fontSize),g.position&&(na=g.position),void 0!==
g.boldLabel&&(h=g.boldLabel),isNaN(g.labelOffset)||(ia=g.labelOffset)):""===c&&(u=0);W="start";e&&(W="middle");var Z=m*Math.PI/180,pa,I=0,D=0,aa=0,S=pa=0,Ta=0;"V"==Sa&&(m=0);var T;G&&(T=a.autoWrap&&0===m?AmCharts.wrappedText(r,c,q,n,p,W,h,e,0):AmCharts.text(r,c,q,n,p,W,h),W=T.getBBox(),S=W.width,Ta=W.height);if("H"==Sa){if(0<=b&&b<=Y+1&&(0<u&&0<t&&b+k<=Y+1&&(oa=AmCharts.line(r,[b+k,b+k],[0,u],v,t,E),s.push(oa)),0<x&&(W=AmCharts.line(r,[b,b+da,b+da],[L,L+ba,ba],A,x,E,z),s.push(W))),D=0,I=b,g&&90==
m&&N&&(I-=p),!1===d?(W="start",D="bottom"==na?N?D+u:D-u:N?D-u:D+u,I+=3,e&&(I+=e/2-3,W="middle"),0<m&&(W="middle")):W="middle",1==V&&0<F&&!g&&!l&&ta<Y&&(d=AmCharts.fitToBounds(b,0,Y),ta=AmCharts.fitToBounds(ta,0,Y),pa=d-ta,0<pa&&(fill=AmCharts.rect(r,pa,a.height,H,F),fill.translate(d-pa+da,ba),s.push(fill))),"bottom"==na?(D+=L+p/2+$,N?(0<m?(D=L-S/2*Math.sin(Z)-u-3,I+=S/2*Math.cos(Z)-4+2):0>m?(D=L+S*Math.sin(Z)-u-3+2,I+=-S*Math.cos(Z)-Ta*Math.sin(Z)-4):D-=u+p+3+3,D-=ia):(0<m?(D=L+S/2*Math.sin(Z)+u+
3,I-=S/2*Math.cos(Z)):0>m?(D=L+u+3-S/2*Math.sin(Z)+2,I+=S/2*Math.cos(Z)):D+=u+w+3+3,D+=ia)):(D+=ba+p/2-$,I+=da,N?(0<m?(D=S/2*Math.sin(Z)+u+3,I-=S/2*Math.cos(Z)):D+=u+3,D+=ia):(0<m?(D=-(S/2)*Math.sin(Z)-u-6,I+=S/2*Math.cos(Z)):D-=u+p+3+w+3,D-=ia)),"bottom"==na?pa=(N?L-u-1:L+w-1)+$:(aa=da,pa=(N?ba:ba-u-w+1)-$),f&&(I+=f),f=I,0<m&&(f+=S/2*Math.cos(Z)),T&&(p=0,N&&(p=S/2*Math.cos(Z)),f+p>Y+2||0>f))T.remove(),T=null}else{0<=b&&b<=L+1&&(0<u&&0<t&&b+k<=L+1&&(oa=AmCharts.line(r,[0,u],[b+k,b+k],v,t,E),s.push(oa)),
0<x&&(W=AmCharts.line(r,[0,da,Y+da],[b,b+ba,b+ba],A,x,E,z),s.push(W)));W="end";if(!0===N&&"left"==na||!1===N&&"right"==na)W="start";D=b-p/2;1==V&&0<F&&!g&&!l&&(d=AmCharts.fitToBounds(b,0,L),ta=AmCharts.fitToBounds(ta,0,L),Z=d-ta,fill=AmCharts.polygon(r,[0,a.width,a.width,0],[0,0,Z,Z],H,F),fill.translate(da,d-Z+ba),s.push(fill));D+=p/2;"right"==na?(I+=da+Y+$,D+=ba,N?(f||(D-=p/2+3),I=I-(u+4)-ia):(I+=u+4+w,D-=2,I+=ia)):N?(I+=u+4-$,f||(D-=p/2+3),g&&(I+=da,D+=ba),I+=ia):(I+=-u-w-4-2-$,D-=2,I-=ia);oa&&
("right"==na?(aa+=da+$+Y,pa+=ba,aa=N?aa-w:aa+w):(aa-=$,N||(aa-=u+w)));f&&(D+=f);N=-3;"right"==na&&(N+=ba);T&&(D>L+1||D<N)&&(T.remove(),T=null)}oa&&oa.translate(aa,pa);!1===a.visible&&(oa&&oa.remove(),T&&(T.remove(),T=null));T&&(T.attr({"text-anchor":W}),T.translate(I,D),0!==m&&T.rotate(-m,a.chart.backgroundColor),a.allLabels.push(T)," "!=c&&(this.label=T));l||(a.counter=0===V?1:0,a.previousCoord=b);0===this.set.node.childNodes.length&&this.set.remove()},graphics:function(){return this.set},getLabel:function(){return this.label}});AmCharts.RecFill=AmCharts.Class({construct:function(a,b,c,d){var e=a.dx,f=a.dy,g=a.orientation,h=0;if(c<b){var k=b;b=c;c=k}var l=d.fillAlpha;isNaN(l)&&(l=0);k=a.chart.container;d=d.fillColor;"V"==g?(b=AmCharts.fitToBounds(b,0,a.viH),c=AmCharts.fitToBounds(c,0,a.viH)):(b=AmCharts.fitToBounds(b,0,a.viW),c=AmCharts.fitToBounds(c,0,a.viW));c-=b;isNaN(c)&&(c=4,h=2,l=0);0>c&&"object"==typeof d&&(d=d.join(",").split(",").reverse());"V"==g?(a=AmCharts.rect(k,a.width,c,d,l),a.translate(e,b-h+f)):(a=AmCharts.rect(k,
c,a.height,d,l),a.translate(b-h+e,f));this.set=k.set([a])},graphics:function(){return this.set},getLabel:function(){}});AmCharts.AmChart=AmCharts.Class({construct:function(a){this.theme=a;this.version="3.11.1";AmCharts.addChart(this);this.createEvents("dataUpdated","init","rendered","drawn","failed");this.height=this.width="100%";this.dataChanged=!0;this.chartCreated=!1;this.previousWidth=this.previousHeight=0;this.backgroundColor="#FFFFFF";this.borderAlpha=this.backgroundAlpha=0;this.color=this.borderColor="#000000";this.fontFamily="Verdana";this.fontSize=11;this.usePrefixes=!1;this.precision=-1;this.percentPrecision=
2;this.decimalSeparator=".";this.thousandsSeparator=",";this.labels=[];this.allLabels=[];this.titles=[];this.marginRight=this.marginLeft=this.autoMarginOffset=0;this.timeOuts=[];this.creditsPosition="top-left";var b=document.createElement("div"),c=b.style;c.overflow="hidden";c.position="relative";c.textAlign="left";this.chartDiv=b;b=document.createElement("div");c=b.style;c.overflow="hidden";c.position="relative";c.textAlign="left";this.legendDiv=b;this.titleHeight=0;this.hideBalloonTime=150;this.handDrawScatter=
2;this.handDrawThickness=1;this.prefixesOfBigNumbers=[{number:1E3,prefix:"k"},{number:1E6,prefix:"M"},{number:1E9,prefix:"G"},{number:1E12,prefix:"T"},{number:1E15,prefix:"P"},{number:1E18,prefix:"E"},{number:1E21,prefix:"Z"},{number:1E24,prefix:"Y"}];this.prefixesOfSmallNumbers=[{number:1E-24,prefix:"y"},{number:1E-21,prefix:"z"},{number:1E-18,prefix:"a"},{number:1E-15,prefix:"f"},{number:1E-12,prefix:"p"},{number:1E-9,prefix:"n"},{number:1E-6,prefix:"\u03bc"},{number:.001,prefix:"m"}];this.panEventsEnabled=
!0;AmCharts.bezierX=3;AmCharts.bezierY=6;this.product="amcharts";this.animations=[];this.balloon=new AmCharts.AmBalloon(this.theme);this.balloon.chart=this;AmCharts.applyTheme(this,a,"AmChart")},drawChart:function(){this.drawBackground();this.redrawLabels();this.drawTitles();this.brr()},drawBackground:function(){AmCharts.remove(this.background);var a=this.container,b=this.backgroundColor,c=this.backgroundAlpha,d=this.set;AmCharts.isModern||0!==c||(c=.001);var e=this.updateWidth();this.realWidth=e;
var f=this.updateHeight();this.realHeight=f;this.background=b=AmCharts.polygon(a,[0,e-1,e-1,0],[0,0,f-1,f-1],b,c,1,this.borderColor,this.borderAlpha);d.push(b);if(b=this.backgroundImage)this.path&&(b=this.path+b),this.bgImg=a=a.image(b,0,0,e,f),d.push(a)},drawTitles:function(){var a=this.titles;if(AmCharts.ifArray(a)){var b=20,c;for(c=0;c<a.length;c++){var d=a[c],e=d.color;void 0===e&&(e=this.color);var f=d.size;isNaN(f)&&(f=this.fontSize+2);isNaN(d.alpha);var g=this.marginLeft,e=AmCharts.text(this.container,
d.text,e,this.fontFamily,f);e.translate(g+(this.realWidth-this.marginRight-g)/2,b);e.node.style.pointerEvents="none";g=!0;void 0!==d.bold&&(g=d.bold);g&&e.attr({"font-weight":"bold"});e.attr({opacity:d.alpha});b+=f+6;this.freeLabelsSet.push(e)}}},write:function(a){if(a="object"!=typeof a?document.getElementById(a):a){a.innerHTML="";this.div=a;a.style.overflow="hidden";a.style.textAlign="left";var b=this.chartDiv,c=this.legendDiv,d=this.legend,e=c.style,f=b.style;this.measure();var g,h=document.createElement("div");
g=h.style;g.position="relative";this.containerDiv=h;a.appendChild(h);var k=this.exportConfig;k&&AmCharts.AmExport&&!this.AmExport&&(this.AmExport=new AmCharts.AmExport(this,k));this.amExport&&AmCharts.AmExport&&(this.AmExport=AmCharts.extend(this.amExport,new AmCharts.AmExport(this),!0));this.AmExport&&this.AmExport.init&&this.AmExport.init();if(d)switch(d=this.addLegend(d,d.divId),d.position){case "bottom":h.appendChild(b);h.appendChild(c);break;case "top":h.appendChild(c);h.appendChild(b);break;
case "absolute":g.width=a.style.width;g.height=a.style.height;e.position="absolute";f.position="absolute";void 0!==d.left&&(e.left=d.left+"px");void 0!==d.right&&(e.right=d.right+"px");void 0!==d.top&&(e.top=d.top+"px");void 0!==d.bottom&&(e.bottom=d.bottom+"px");d.marginLeft=0;d.marginRight=0;h.appendChild(b);h.appendChild(c);break;case "right":g.width=a.style.width;g.height=a.style.height;e.position="relative";f.position="absolute";h.appendChild(b);h.appendChild(c);break;case "left":g.width=a.style.width;
g.height=a.style.height;e.position="absolute";f.position="relative";h.appendChild(b);h.appendChild(c);break;case "outside":h.appendChild(b)}else h.appendChild(b);this.listenersAdded||(this.addListeners(),this.listenersAdded=!0);this.initChart()}},createLabelsSet:function(){AmCharts.remove(this.labelsSet);this.labelsSet=this.container.set();this.freeLabelsSet.push(this.labelsSet)},initChart:function(){AmCharts.callInitHandler(this);AmCharts.applyLang(this.language,this);var a=this.numberFormatter;
a&&(isNaN(a.precision)||(this.precision=a.precision),void 0!==a.thousandsSeparator&&(this.thousandsSeparator=a.thousandsSeparator),void 0!==a.decimalSeparator&&(this.decimalSeparator=a.decimalSeparator));(a=this.percentFormatter)&&!isNaN(a.precision)&&(this.percentPrecision=a.precision);this.nf={precision:this.precision,thousandsSeparator:this.thousandsSeparator,decimalSeparator:this.decimalSeparator};this.pf={precision:this.percentPrecision,thousandsSeparator:this.thousandsSeparator,decimalSeparator:this.decimalSeparator};
this.divIsFixed=AmCharts.findIfFixed(this.chartDiv);this.previousHeight=this.divRealHeight;this.previousWidth=this.divRealWidth;this.destroy();this.startInterval();a=0;document.attachEvent&&!window.opera&&(a=1);this.dmouseX=this.dmouseY=0;var b=document.getElementsByTagName("html")[0];b&&window.getComputedStyle&&(b=window.getComputedStyle(b,null))&&(this.dmouseY=AmCharts.removePx(b.getPropertyValue("margin-top")),this.dmouseX=AmCharts.removePx(b.getPropertyValue("margin-left")));this.mouseMode=a;
(a=this.container)?(a.container.innerHTML="",this.chartDiv.appendChild(a.container),a.setSize(this.realWidth,this.realHeight)):a=new AmCharts.AmDraw(this.chartDiv,this.realWidth,this.realHeight,this);AmCharts.VML||AmCharts.SVG?(a.handDrawn=this.handDrawn,a.handDrawScatter=this.handDrawScatter,a.handDrawThickness=this.handDrawThickness,this.container=a,this.set&&this.set.remove(),this.set=a.set(),this.gridSet&&this.gridSet.remove(),this.gridSet=a.set(),this.cursorLineSet&&this.cursorLineSet.remove(),
this.cursorLineSet=a.set(),this.graphsBehindSet&&this.graphsBehindSet.remove(),this.graphsBehindSet=a.set(),this.bulletBehindSet&&this.bulletBehindSet.remove(),this.bulletBehindSet=a.set(),this.columnSet&&this.columnSet.remove(),this.columnSet=a.set(),this.graphsSet&&this.graphsSet.remove(),this.graphsSet=a.set(),this.trendLinesSet&&this.trendLinesSet.remove(),this.trendLinesSet=a.set(),this.axesLabelsSet&&this.axesLabelsSet.remove(),this.axesLabelsSet=a.set(),this.axesSet&&this.axesSet.remove(),
this.axesSet=a.set(),this.cursorSet&&this.cursorSet.remove(),this.cursorSet=a.set(),this.scrollbarsSet&&this.scrollbarsSet.remove(),this.scrollbarsSet=a.set(),this.bulletSet&&this.bulletSet.remove(),this.bulletSet=a.set(),this.freeLabelsSet&&this.freeLabelsSet.remove(),this.freeLabelsSet=a.set(),this.balloonsSet&&this.balloonsSet.remove(),this.balloonsSet=a.set(),this.zoomButtonSet&&this.zoomButtonSet.remove(),this.zoomButtonSet=a.set(),this.linkSet&&this.linkSet.remove(),this.linkSet=a.set(),this.renderFix()):
this.fire("failed",{type:"failed",chart:this})},measure:function(){var a=this.div;if(a){var b=this.chartDiv,c=a.offsetWidth,d=a.offsetHeight,e=this.container;a.clientHeight&&(c=a.clientWidth,d=a.clientHeight);var f=AmCharts.removePx(AmCharts.getStyle(a,"padding-left")),g=AmCharts.removePx(AmCharts.getStyle(a,"padding-right")),h=AmCharts.removePx(AmCharts.getStyle(a,"padding-top")),k=AmCharts.removePx(AmCharts.getStyle(a,"padding-bottom"));isNaN(f)||(c-=f);isNaN(g)||(c-=g);isNaN(h)||(d-=h);isNaN(k)||
(d-=k);f=a.style;a=f.width;f=f.height;-1!=a.indexOf("px")&&(c=AmCharts.removePx(a));-1!=f.indexOf("px")&&(d=AmCharts.removePx(f));a=AmCharts.toCoordinate(this.width,c);f=AmCharts.toCoordinate(this.height,d);this.balloon=AmCharts.processObject(this.balloon,AmCharts.AmBalloon,this.theme);this.balloon.chart=this;(a!=this.previousWidth||f!=this.previousHeight)&&0<a&&0<f&&(b.style.width=a+"px",b.style.height=f+"px",e&&e.setSize(a,f));this.balloon.setBounds(2,2,a-2,f);this.realWidth=a;this.realHeight=f;
this.divRealWidth=c;this.divRealHeight=d}},destroy:function(){this.chartDiv.innerHTML="";this.clearTimeOuts();this.interval&&clearInterval(this.interval);this.interval=NaN},clearTimeOuts:function(){var a=this.timeOuts;if(a){var b;for(b=0;b<a.length;b++)clearTimeout(a[b])}this.timeOuts=[]},clear:function(a){AmCharts.callMethod("clear",[this.chartScrollbar,this.scrollbarV,this.scrollbarH,this.chartCursor]);this.chartCursor=this.scrollbarH=this.scrollbarV=this.chartScrollbar=null;this.clearTimeOuts();
this.interval&&clearInterval(this.interval);this.container&&(this.container.remove(this.chartDiv),this.container.remove(this.legendDiv));a||AmCharts.removeChart(this)},setMouseCursor:function(a){"auto"==a&&AmCharts.isNN&&(a="default");this.chartDiv.style.cursor=a;this.legendDiv.style.cursor=a},redrawLabels:function(){this.labels=[];var a=this.allLabels;this.createLabelsSet();var b;for(b=0;b<a.length;b++)this.drawLabel(a[b])},drawLabel:function(a){if(this.container){var b=a.y,c=a.text,d=a.align,e=
a.size,f=a.color,g=a.rotation,h=a.alpha,k=a.bold,l=AmCharts.toCoordinate(a.x,this.realWidth),b=AmCharts.toCoordinate(b,this.realHeight);l||(l=0);b||(b=0);void 0===f&&(f=this.color);isNaN(e)&&(e=this.fontSize);d||(d="start");"left"==d&&(d="start");"right"==d&&(d="end");"center"==d&&(d="middle",g?b=this.realHeight-b+b/2:l=this.realWidth/2-l);void 0===h&&(h=1);void 0===g&&(g=0);b+=e/2;c=AmCharts.text(this.container,c,f,this.fontFamily,e,d,k,h);c.translate(l,b);0!==g&&c.rotate(g);a.url?(c.setAttr("cursor",
"pointer"),c.click(function(){AmCharts.getURL(a.url)})):c.node.style.pointerEvents="none";this.labelsSet.push(c);this.labels.push(c)}},addLabel:function(a,b,c,d,e,f,g,h,k,l){a={x:a,y:b,text:c,align:d,size:e,color:f,alpha:h,rotation:g,bold:k,url:l};this.container&&this.drawLabel(a);this.allLabels.push(a)},clearLabels:function(){var a=this.labels,b;for(b=a.length-1;0<=b;b--)a[b].remove();this.labels=[];this.allLabels=[]},updateHeight:function(){var a=this.divRealHeight,b=this.legend;if(b){var c=this.legendDiv.offsetHeight,
b=b.position;if("top"==b||"bottom"==b){a-=c;if(0>a||isNaN(a))a=0;this.chartDiv.style.height=a+"px"}}return a},updateWidth:function(){var a=this.divRealWidth,b=this.divRealHeight,c=this.legend;if(c){var d=this.legendDiv,e=d.offsetWidth;isNaN(c.width)||(e=c.width);var f=d.offsetHeight,d=d.style,g=this.chartDiv.style,c=c.position;if("right"==c||"left"==c){a-=e;if(0>a||isNaN(a))a=0;g.width=a+"px";"left"==c?g.left=e+"px":d.left=a+"px";b>f&&(d.top=(b-f)/2+"px")}}return a},getTitleHeight:function(){var a=
0,b=this.titles;if(0<b.length){var a=15,c;for(c=0;c<b.length;c++){var d=b[c].size;isNaN(d)&&(d=this.fontSize+2);a+=d+6}}return a},addTitle:function(a,b,c,d,e){isNaN(b)&&(b=this.fontSize+2);a={text:a,size:b,color:c,alpha:d,bold:e};this.titles.push(a);return a},addMouseWheel:function(){var a=this;window.addEventListener&&!a.wheelAdded&&(window.addEventListener("DOMMouseScroll",function(b){a.handleWheel.call(a,b)},!1),document.addEventListener("mousewheel",function(b){a.handleWheel.call(a,b)},!1),a.wheelAdded=
!0)},handleWheel:function(a){if(this.mouseIsOver){var b=0;a||(a=window.event);a.wheelDelta?b=a.wheelDelta/120:a.detail&&(b=-a.detail/3);b&&this.handleWheelReal(b,a.shiftKey);a.preventDefault&&a.preventDefault()}},handleWheelReal:function(a){},addListeners:function(){var a=this,b=a.chartDiv;document.addEventListener?(a.panEventsEnabled&&(b.style.msTouchAction="none","ontouchstart"in document.documentElement&&(b.addEventListener("touchstart",function(b){a.handleTouchMove.call(a,b);a.handleTouchStart.call(a,
b)},!0),b.addEventListener("touchmove",function(b){a.handleTouchMove.call(a,b)},!0),b.addEventListener("touchend",function(b){a.handleTouchEnd.call(a,b)},!0))),b.addEventListener("mousedown",function(b){a.mouseIsOver=!0;a.handleMouseMove.call(a,b);a.handleMouseDown.call(a,b)},!0),b.addEventListener("mouseover",function(b){a.handleMouseOver.call(a,b)},!0),b.addEventListener("mouseout",function(b){a.handleMouseOut.call(a,b)},!0)):(b.attachEvent("onmousedown",function(b){a.handleMouseDown.call(a,b)}),
b.attachEvent("onmouseover",function(b){a.handleMouseOver.call(a,b)}),b.attachEvent("onmouseout",function(b){a.handleMouseOut.call(a,b)}))},dispDUpd:function(){var a;this.dispatchDataUpdated&&(this.dispatchDataUpdated=!1,a="dataUpdated",this.fire(a,{type:a,chart:this}));this.chartCreated||(a="init",this.fire(a,{type:a,chart:this}));this.chartRendered||(a="rendered",this.fire(a,{type:a,chart:this}),this.chartRendered=!0);a="drawn";this.fire(a,{type:a,chart:this})},validateSize:function(){var a=this;
a.measure();var b=a.legend;if((a.realWidth!=a.previousWidth||a.realHeight!=a.previousHeight)&&0<a.realWidth&&0<a.realHeight){a.sizeChanged=!0;if(b){clearTimeout(a.legendInitTO);var c=setTimeout(function(){b.invalidateSize()},100);a.timeOuts.push(c);a.legendInitTO=c}a.marginsUpdated="xy"!=a.type?!1:!0;clearTimeout(a.initTO);c=setTimeout(function(){a.initChart()},150);a.timeOuts.push(c);a.initTO=c}a.renderFix();b&&b.renderFix()},invalidateSize:function(){this.previousHeight=this.previousWidth=NaN;this.invalidateSizeReal()},
invalidateSizeReal:function(){var a=this;a.marginsUpdated=!1;clearTimeout(a.validateTO);var b=setTimeout(function(){a.validateSize()},5);a.timeOuts.push(b);a.validateTO=b},validateData:function(a){this.chartCreated&&(this.dataChanged=!0,this.marginsUpdated="xy"!=this.type?!1:!0,this.initChart(a))},validateNow:function(){this.chartRendered=!1;this.write(this.div)},showItem:function(a){a.hidden=!1;this.initChart()},hideItem:function(a){a.hidden=!0;this.initChart()},hideBalloon:function(){var a=this;
clearInterval(a.hoverInt);clearTimeout(a.balloonTO);a.hoverInt=setTimeout(function(){a.hideBalloonReal.call(a)},a.hideBalloonTime)},cleanChart:function(){},hideBalloonReal:function(){var a=this.balloon;a&&a.hide()},showBalloon:function(a,b,c,d,e){var f=this;clearTimeout(f.balloonTO);clearInterval(f.hoverInt);f.balloonTO=setTimeout(function(){f.showBalloonReal.call(f,a,b,c,d,e)},1)},showBalloonReal:function(a,b,c,d,e){this.handleMouseMove();var f=this.balloon;f.enabled&&(f.followCursor(!1),f.changeColor(b),
!c||f.fixedPosition?(f.setPosition(d,e),f.followCursor(!1)):f.followCursor(!0),a&&f.showBalloon(a))},handleTouchMove:function(a){this.hideBalloon();var b=this.chartDiv;a.touches&&(a=a.touches.item(0),this.mouseX=a.pageX-AmCharts.findPosX(b),this.mouseY=a.pageY-AmCharts.findPosY(b))},handleMouseOver:function(a){AmCharts.resetMouseOver();this.mouseIsOver=!0},handleMouseOut:function(a){AmCharts.resetMouseOver();this.mouseIsOver=!1},handleMouseMove:function(a){if(this.mouseIsOver){var b=this.chartDiv;
a||(a=window.event);var c,d;if(a){this.posX=AmCharts.findPosX(b);this.posY=AmCharts.findPosY(b);switch(this.mouseMode){case 1:c=a.clientX-this.posX;d=a.clientY-this.posY;if(!this.divIsFixed){var b=document.body,e,f;b&&(e=b.scrollLeft,y1=b.scrollTop);if(b=document.documentElement)f=b.scrollLeft,y2=b.scrollTop;e=Math.max(e,f);f=Math.max(y1,y2);c+=e;d+=f}break;case 0:this.divIsFixed?(c=a.clientX-this.posX,d=a.clientY-this.posY):(c=a.pageX-this.posX,d=a.pageY-this.posY)}a.touches&&(a=a.touches.item(0),
c=a.pageX-this.posX,d=a.pageY-this.posY);this.mouseX=c-this.dmouseX;this.mouseY=d-this.dmouseY}}},handleTouchStart:function(a){this.handleMouseDown(a)},handleTouchEnd:function(a){AmCharts.resetMouseOver();this.handleReleaseOutside(a)},handleReleaseOutside:function(a){},handleMouseDown:function(a){AmCharts.resetMouseOver();this.mouseIsOver=!0;a&&a.preventDefault&&a.preventDefault()},addLegend:function(a,b){a=AmCharts.processObject(a,AmCharts.AmLegend,this.theme);a.divId=b;var c;c="object"!=typeof b&&
b?document.getElementById(b):b;this.legend=a;a.chart=this;c?(a.div=c,a.position="outside",a.autoMargins=!1):a.div=this.legendDiv;c=this.handleLegendEvent;this.listenTo(a,"showItem",c);this.listenTo(a,"hideItem",c);this.listenTo(a,"clickMarker",c);this.listenTo(a,"rollOverItem",c);this.listenTo(a,"rollOutItem",c);this.listenTo(a,"rollOverMarker",c);this.listenTo(a,"rollOutMarker",c);this.listenTo(a,"clickLabel",c);return a},removeLegend:function(){this.legend=void 0;this.legendDiv.innerHTML=""},handleResize:function(){(AmCharts.isPercents(this.width)||
AmCharts.isPercents(this.height))&&this.invalidateSizeReal();this.renderFix()},renderFix:function(){if(!AmCharts.VML){var a=this.container;a&&a.renderFix()}},getSVG:function(){if(AmCharts.hasSVG)return this.container},animate:function(a,b,c,d,e,f,g){a["an_"+b]&&AmCharts.removeFromArray(this.animations,a["an_"+b]);c={obj:a,frame:0,attribute:b,from:c,to:d,time:e,effect:f,suffix:g};a["an_"+b]=c;this.animations.push(c);return c},setLegendData:function(a){var b=this.legend;b&&b.setData(a)},startInterval:function(){var a=
this;clearInterval(a.interval);a.interval=setInterval(function(){a.updateAnimations.call(a)},AmCharts.updateRate)},stopAnim:function(a){AmCharts.removeFromArray(this.animations,a)},updateAnimations:function(){var a;this.container&&this.container.update();for(a=this.animations.length-1;0<=a;a--){var b=this.animations[a],c=1E3*b.time/AmCharts.updateRate,d=b.frame+1,e=b.obj,f=b.attribute;if(d<=c){b.frame++;var g=Number(b.from),h=Number(b.to)-g,c=AmCharts[b.effect](0,d,g,h,c);0===h?(this.animations.splice(a,
1),e.node.style[f]=Number(b.to)+b.suffix):e.node.style[f]=c+b.suffix}else e.node.style[f]=Number(b.to)+b.suffix,this.animations.splice(a,1)}},inIframe:function(){try{return window.self!==window.top}catch(a){return!0}},brr:function(){}});AmCharts.Slice=AmCharts.Class({construct:function(){}});AmCharts.SerialDataItem=AmCharts.Class({construct:function(){}});AmCharts.GraphDataItem=AmCharts.Class({construct:function(){}});
AmCharts.Guide=AmCharts.Class({construct:function(a){this.cname="Guide";AmCharts.applyTheme(this,a,this.cname)}});AmCharts.AmGraph=AmCharts.Class({construct:function(a){this.cname="AmGraph";this.createEvents("rollOverGraphItem","rollOutGraphItem","clickGraphItem","doubleClickGraphItem","rightClickGraphItem","clickGraph","rollOverGraph","rollOutGraph");this.type="line";this.stackable=!0;this.columnCount=1;this.columnIndex=0;this.centerCustomBullets=this.showBalloon=!0;this.maxBulletSize=50;this.minBulletSize=4;this.balloonText="[[value]]";this.hidden=this.scrollbar=this.animationPlayed=!1;this.pointPosition="middle";
this.depthCount=1;this.includeInMinMax=!0;this.negativeBase=0;this.visibleInLegend=!0;this.showAllValueLabels=!1;this.showBulletsAt=this.showBalloonAt="close";this.lineThickness=1;this.dashLength=0;this.connect=!0;this.lineAlpha=1;this.bullet="none";this.bulletBorderThickness=2;this.bulletBorderAlpha=0;this.bulletAlpha=1;this.bulletSize=8;this.hideBulletsCount=this.bulletOffset=0;this.labelPosition="top";this.cornerRadiusTop=0;this.cursorBulletAlpha=1;this.gradientOrientation="vertical";this.dy=this.dx=
0;this.periodValue="";this.clustered=!0;this.periodSpan=1;this.y=this.x=0;this.switchable=!0;this.tcc=this.minDistance=1;AmCharts.applyTheme(this,a,this.cname)},draw:function(){var a=this.chart;isNaN(this.precision)||(this.numberFormatter?this.numberFormatter.precision=this.precision:this.numberFormatter={precision:this.precision,decimalSeparator:a.decimalSeparator,thousandsSeparator:a.thousandsSeparator});var b=a.container;this.container=b;this.destroy();var c=b.set(),d=b.set();this.behindColumns?
(a.graphsBehindSet.push(c),a.bulletBehindSet.push(d)):(a.graphsSet.push(c),a.bulletSet.push(d));var e=this.bulletAxis;AmCharts.isString(e)&&(this.bulletAxis=a.getValueAxisById(e));this.bulletSet=d;this.scrollbar||(e=a.marginLeftReal,a=a.marginTopReal,c.translate(e,a),d.translate(e,a));b=b.set();AmCharts.remove(this.columnsSet);c.push(b);this.set=c;this.columnsSet=b;this.columnsArray=[];this.ownColumns=[];this.allBullets=[];this.animationArray=[];AmCharts.ifArray(this.data)&&(c=!1,"xy"==this.chart.type?
this.xAxis.axisCreated&&this.yAxis.axisCreated&&(c=!0):this.valueAxis.axisCreated&&(c=!0),!this.hidden&&c&&this.createGraph())},createGraph:function(){var a=this,b=a.chart;"inside"==a.labelPosition&&"column"!=a.type&&(a.labelPosition="bottom");a.startAlpha=b.startAlpha;a.seqAn=b.sequencedAnimation;a.baseCoord=a.valueAxis.baseCoord;void 0===a.fillAlphas&&(a.fillAlphas=0);a.bulletColorR=a.bulletColor;void 0===a.bulletColorR&&(a.bulletColorR=a.lineColorR,a.bulletColorNegative=a.negativeLineColor);void 0===
a.bulletAlpha&&(a.bulletAlpha=a.lineAlpha);clearTimeout(a.playedTO);if(!isNaN(a.valueAxis.min)&&!isNaN(a.valueAxis.max)){switch(b.type){case "serial":a.categoryAxis&&(a.createSerialGraph(),"candlestick"==a.type&&1>a.valueAxis.minMaxMultiplier&&a.positiveClip(a.set));break;case "radar":a.createRadarGraph();break;case "xy":a.createXYGraph(),a.positiveClip(a.set)}a.playedTO=setTimeout(function(){a.setAnimationPlayed.call(a)},500*a.chart.startDuration)}},setAnimationPlayed:function(){this.animationPlayed=
!0},createXYGraph:function(){var a=[],b=[],c=this.xAxis,d=this.yAxis;this.pmh=d.viH+1;this.pmw=c.viW+1;this.pmy=this.pmx=0;var e;for(e=this.start;e<=this.end;e++){var f=this.data[e].axes[c.id].graphs[this.id],g=f.values,h=g.x,k=g.y,g=c.getCoordinate(h),l=d.getCoordinate(k);!isNaN(h)&&!isNaN(k)&&(a.push(g),b.push(l),(h=this.createBullet(f,g,l,e))||(h=0),k=this.labelText)&&(f=this.createLabel(f,g,l,k),this.allBullets.push(f),this.positionLabel(g,l,f,this.labelPosition,h))}this.drawLineGraph(a,b);this.launchAnimation()},
createRadarGraph:function(){var a=this.valueAxis.stackType,b=[],c=[],d,e,f;for(f=this.start;f<=this.end;f++){var g=this.data[f].axes[this.valueAxis.id].graphs[this.id],h;h="none"==a||"3d"==a?g.values.value:g.values.close;if(isNaN(h))this.drawLineGraph(b,c),b=[],c=[];else{var k=this.y-(this.valueAxis.getCoordinate(h)-this.height),l=180-360/(this.end-this.start+1)*f;h=k*Math.sin(l/180*Math.PI);k*=Math.cos(l/180*Math.PI);b.push(h);c.push(k);(l=this.createBullet(g,h,k,f))||(l=0);var m=this.labelText;
m&&(g=this.createLabel(g,h,k,m),this.allBullets.push(g),this.positionLabel(h,k,g,this.labelPosition,l));isNaN(d)&&(d=h);isNaN(e)&&(e=k)}}b.push(d);c.push(e);this.drawLineGraph(b,c);this.launchAnimation()},positionLabel:function(a,b,c,d,e){var f=c.getBBox();switch(d){case "left":a-=(f.width+e)/2+2;break;case "top":b-=(e+f.height)/2+1;break;case "right":a+=(f.width+e)/2+2;break;case "bottom":b+=(e+f.height)/2+1}c.translate(a,b)},getGradRotation:function(){var a=270;"horizontal"==this.gradientOrientation&&
(a=0);return this.gradientRotation=a},createSerialGraph:function(){this.dashLengthSwitched=this.fillColorsSwitched=this.lineColorSwitched=void 0;var a=this.chart,b=this.id,c=this.index,d=this.data,e=this.chart.container,f=this.valueAxis,g=this.type,h=this.columnWidthReal,k=this.showBulletsAt;isNaN(this.columnWidth)||(h=this.columnWidth);isNaN(h)&&(h=.8);var l=this.useNegativeColorIfDown,m=this.width,n=this.height,p=this.y,q=this.rotate,r=this.columnCount,s=AmCharts.toCoordinate(this.cornerRadiusTop,
h/2),w=this.connect,v=[],t=[],u,x,E,A,z=this.chart.graphs.length,H,F=this.dx/this.tcc,G=this.dy/this.tcc,V=f.stackType,N=this.labelPosition,ia=this.start,da=this.end,ba=this.scrollbar,Sa=this.categoryAxis,na=this.baseCoord,ta=this.negativeBase,L=this.columnIndex,Y=this.lineThickness,$=this.lineAlpha,oa=this.lineColorR,W=this.dashLength,Z=this.set,pa,I=N,D=this.getGradRotation(),aa=this.chart.columnSpacing,S=Sa.cellWidth,Ta=(S*h-r)/r;aa>Ta&&(aa=Ta);var T,y,bb,kb=n+1,lb=m+1,cb=0,mb=0,nb,ob,db,eb,pb=
this.fillColorsR,Da=this.negativeFillColors,wa=this.negativeLineColor,Ua=this.fillAlphas,Va=this.negativeFillAlphas;"object"==typeof Ua&&(Ua=Ua[0]);"object"==typeof Va&&(Va=Va[0]);var fb=f.getCoordinate(f.min);f.logarithmic&&(fb=f.getCoordinate(f.minReal));this.minCoord=fb;this.resetBullet&&(this.bullet="none");if(!(ba||"line"!=g&&"smoothedLine"!=g&&"step"!=g||(1==d.length&&"step"!=g&&"none"==this.bullet&&(this.bullet="round",this.resetBullet=!0),!Da&&void 0==wa||l))){var Na=ta;Na>f.max&&(Na=f.max);
Na<f.min&&(Na=f.min);f.logarithmic&&(Na=f.minReal);var Aa=f.getCoordinate(Na),Hb=f.getCoordinate(f.max);q?(kb=n,lb=Math.abs(Hb-Aa),nb=n,ob=Math.abs(fb-Aa),eb=mb=0,f.reversed?(cb=0,db=Aa):(cb=Aa,db=0)):(lb=m,kb=Math.abs(Hb-Aa),ob=m,nb=Math.abs(fb-Aa),db=cb=0,f.reversed?(eb=p,mb=Aa):eb=Aa+1)}var Ba=Math.round;this.pmx=Ba(cb);this.pmy=Ba(mb);this.pmh=Ba(kb);this.pmw=Ba(lb);this.nmx=Ba(db);this.nmy=Ba(eb);this.nmh=Ba(nb);this.nmw=Ba(ob);AmCharts.isModern||(this.nmy=this.nmx=0,this.nmh=this.height);this.clustered||
(r=1);h="column"==g?(S*h-aa*(r-1))/r:S*h;1>h&&(h=1);var J;if("line"==g||"step"==g||"smoothedLine"==g){if(0<ia){for(J=ia-1;-1<J;J--)if(T=d[J],y=T.axes[f.id].graphs[b],bb=y.values.value,!isNaN(bb)){ia=J;break}if(this.lineColorField)for(J=ia;-1<J;J--)if(T=d[J],y=T.axes[f.id].graphs[b],y.lineColor){this.bulletColorSwitched=this.lineColorSwitched=y.lineColor;break}if(this.fillColorsField)for(J=ia;-1<J;J--)if(T=d[J],y=T.axes[f.id].graphs[b],y.fillColors){this.fillColorsSwitched=y.fillColors;break}if(this.dashLengthField)for(J=
ia;-1<J;J--)if(T=d[J],y=T.axes[f.id].graphs[b],!isNaN(y.dashLength)){this.dashLengthSwitched=y.dashLength;break}}if(da<d.length-1)for(J=da+1;J<d.length;J++)if(T=d[J],y=T.axes[f.id].graphs[b],bb=y.values.value,!isNaN(bb)){da=J;break}}da<d.length-1&&da++;var O=[],P=[],Ea=!1;if("line"==g||"step"==g||"smoothedLine"==g)if(this.stackable&&"regular"==V||"100%"==V||this.fillToGraph)Ea=!0;var Ib=this.noStepRisers,gb=-1E3,hb=-1E3,ib=this.minDistance,Fa=!0,Wa=!1;for(J=ia;J<=da;J++){T=d[J];y=T.axes[f.id].graphs[b];
y.index=J;var Xa,Ga=NaN;if(l&&void 0==this.openField)for(var qb=J+1;qb<d.length&&(!d[qb]||!(Xa=d[J+1].axes[f.id].graphs[b])||!Xa.values||(Ga=Xa.values.value,isNaN(Ga)));qb++);var X,Q,R,ea,la=NaN,C=NaN,B=NaN,M=NaN,K=NaN,Ha=NaN,xa=NaN,Ia=NaN,ya=NaN,ca=NaN,ja=NaN,fa=NaN,ga=NaN,U=NaN,rb=NaN,sb=NaN,ka=NaN,ra=void 0,Ca=pb,Oa=Ua,ua=oa,qa,sa,tb=this.proCandlesticks,Ya=this.pattern;void 0!=y.pattern&&(Ya=y.pattern);void 0!=y.color&&(Ca=y.color);y.fillColors&&(Ca=y.fillColors);isNaN(y.alpha)||(Oa=y.alpha);
isNaN(y.dashLength)||(W=y.dashLength);var va=y.values;f.recalculateToPercents&&(va=y.percents);if(va){U=this.stackable&&"none"!=V&&"3d"!=V?va.close:va.value;if("candlestick"==g||"ohlc"==g)U=va.close,sb=va.low,xa=f.getCoordinate(sb),rb=va.high,ya=f.getCoordinate(rb);ka=va.open;B=f.getCoordinate(U);isNaN(ka)||(K=f.getCoordinate(ka),l&&(Ga=ka,ka=K=NaN));l&&(void 0==this.openField?Xa&&(Xa.isNegative=Ga<U?!0:!1,isNaN(Ga)&&(y.isNegative=!Fa)):y.isNegative=Ga>U?!0:!1);if(!ba)switch(this.showBalloonAt){case "close":y.y=
B;break;case "open":y.y=K;break;case "high":y.y=ya;break;case "low":y.y=xa}var la=T.x[Sa.id],Pa=this.periodSpan-1,ma=Math.floor(S/2)+Math.floor(Pa*S/2),za=ma,Jb=0;"left"==this.stepDirection&&(Jb=(2*S+Pa*S)/2,la-=Jb);"start"==this.pointPosition&&(la-=S/2+Math.floor(Pa*S/2),ma=0,za=Math.floor(S)+Math.floor(Pa*S));"end"==this.pointPosition&&(la+=S/2+Math.floor(Pa*S/2),ma=Math.floor(S)+Math.floor(Pa*S),za=0);if(Ib){var ub=this.columnWidth;isNaN(ub)||(ma*=ub,za*=ub)}ba||(y.x=la);-1E5>la&&(la=-1E5);la>
m+1E5&&(la=m+1E5);q?(C=B,M=K,K=B=la,isNaN(ka)&&!this.fillToGraph&&(M=na),Ha=xa,Ia=ya):(M=C=la,isNaN(ka)&&!this.fillToGraph&&(K=na));if(!tb&&U<ka||tb&&U<pa)y.isNegative=!0,Da&&(Ca=Da),Va&&(Oa=Va),void 0!=wa&&(ua=wa);Wa=!1;isNaN(U)||(l?U>Ga?(Fa&&(Wa=!0),Fa=!1):(Fa||(Wa=!0),Fa=!0):y.isNegative=U<ta?!0:!1,pa=U);switch(g){case "line":if(isNaN(U))w||(this.drawLineGraph(v,t,O,P),v=[],t=[],O=[],P=[]);else{if(Math.abs(C-gb)>=ib||Math.abs(B-hb)>=ib)v.push(C),t.push(B),gb=C,hb=B;ca=C;ja=B;fa=C;ga=B;!Ea||isNaN(K)||
isNaN(M)||(O.push(M),P.push(K));if(Wa||void 0!=y.lineColor||void 0!=y.fillColors||!isNaN(y.dashLength))this.drawLineGraph(v,t,O,P),v=[C],t=[B],O=[],P=[],!Ea||isNaN(K)||isNaN(M)||(O.push(M),P.push(K)),l?Fa?(this.lineColorSwitched=oa,this.fillColorsSwitched=pb):(this.lineColorSwitched=wa,this.fillColorsSwitched=Da):(this.lineColorSwitched=y.lineColor,this.fillColorsSwitched=y.fillColors),this.dashLengthSwitched=y.dashLength;y.gap&&(this.drawLineGraph(v,t,O,P),v=[],t=[],O=[],P=[])}break;case "smoothedLine":if(isNaN(U))w||
(this.drawSmoothedGraph(v,t,O,P),v=[],t=[],O=[],P=[]);else{if(Math.abs(C-gb)>=ib||Math.abs(B-hb)>=ib)v.push(C),t.push(B),gb=C,hb=B;ca=C;ja=B;fa=C;ga=B;!Ea||isNaN(K)||isNaN(M)||(O.push(M),P.push(K));void 0==y.lineColor&&void 0==y.fillColors&&isNaN(y.dashLength)||(this.drawSmoothedGraph(v,t,O,P),v=[C],t=[B],O=[],P=[],!Ea||isNaN(K)||isNaN(M)||(O.push(M),P.push(K)),this.lineColorSwitched=y.lineColor,this.fillColorsSwitched=y.fillColors,this.dashLengthSwitched=y.dashLength);y.gap&&(this.drawSmoothedGraph(v,
t,O,P),v=[],t=[],O=[],P=[])}break;case "step":if(!isNaN(U)){if(void 0==y.lineColor&&void 0==y.fillColors&&isNaN(y.dashLength)||(this.drawLineGraph(v,t,O,P),v=[],t=[],O=[],P=[],this.lineColorSwitched=y.lineColor,this.fillColorsSwitched=y.fillColors,this.dashLengthSwitched=y.dashLength),q?(isNaN(u)||(v.push(u),t.push(B-ma)),t.push(B-ma),v.push(C),t.push(B+za),v.push(C),!Ea||isNaN(K)||isNaN(M)||(O.push(E),P.push(K-ma),O.push(M),P.push(K-ma),O.push(M),P.push(K+za))):(isNaN(x)||(t.push(x),v.push(u),t.push(x),
v.push(C-ma)),v.push(C-ma),t.push(B),v.push(C+za),t.push(B),!Ea||isNaN(K)||isNaN(M)||(O.push(M-ma),P.push(A),O.push(M-ma),P.push(K),O.push(M+za),P.push(K))),u=C,x=B,E=M,A=K,ca=C,ja=B,fa=C,ga=B,Wa&&(this.drawLineGraph(v,t,O,P),v=[],t=[],O=[],P=[],l&&(Fa?(this.lineColorSwitched=oa,this.fillColorsSwitched=pb):(this.lineColorSwitched=wa,this.fillColorsSwitched=Da))),Ib||y.gap)u=x=NaN,this.drawLineGraph(v,t,O,P),v=[],t=[],O=[],P=[]}else if(!w){if(1>=this.periodSpan||1<this.periodSpan&&C-u>ma+za)u=x=NaN;
this.drawLineGraph(v,t,O,P);v=[];t=[];O=[];P=[]}break;case "column":qa=ua;void 0!=y.lineColor&&(qa=y.lineColor);var Kb=this.topRadius;if(!isNaN(U)){l||(y.isNegative=U<ta?!0:!1);y.isNegative&&(Da&&(Ca=Da),void 0!=wa&&(qa=wa));var Lb=f.min,Mb=f.max;if(!(U<Lb&&ka<Lb||U>Mb&&ka>Mb))if(q){"3d"==V?(Q=B-(r/2-this.depthCount+1)*(h+aa)+aa/2+G*L,X=M+F*L):(Q=Math.floor(B-(r/2-L)*(h+aa)+aa/2),X=M);R=h;ca=C;ja=Q+h/2;fa=C;ga=Q+h/2;Q+R>n+L*G&&(R=n-Q+L*G);Q<L*G&&(R+=Q,Q=L*G);ea=C-M;var Yb=X;X=AmCharts.fitToBounds(X,
0,m);ea+=Yb-X;ea=AmCharts.fitToBounds(ea,-X,m-X+F*L);Q<n&&0<R&&(ra=new AmCharts.Cuboid(e,ea,R,F-a.d3x,G-a.d3y,Ca,Oa,Y,qa,$,D,s,q,W,Ya,Kb),"bottom"!=N&&"inside"!=N&&"middle"!=N&&(N=f.reversed?"left":"right",0>U&&(N=f.reversed?"right":"left")),"regular"==V||"100%"==V)&&(ca+=this.dx)}else{"3d"==V?(X=C-(r/2-this.depthCount+1)*(h+aa)+aa/2+F*L,Q=K+G*L):(X=C-(r/2-L)*(h+aa)+aa/2,Q=K);R=h;ca=X+h/2;ja=B;fa=X+h/2;ga=B;X+R>m+L*F&&(R=m-X+L*F);X<L*F&&(R+=X-L*F,X=L*F);ea=B-K;var Zb=Q;Q=AmCharts.fitToBounds(Q,this.dy,
n);ea+=Zb-Q;ea=AmCharts.fitToBounds(ea,-Q+G*L,n-Q);if(X<m+L*F&&0<R)if(this.showOnAxis&&(Q-=G/2),ra=new AmCharts.Cuboid(e,R,ea,F-a.d3x,G-a.d3y,Ca,Oa,Y,qa,this.lineAlpha,D,s,q,W,Ya,Kb),0>U&&"middle"!=N&&"inside"!=N)N="bottom";else if(N=I,"regular"==V||"100%"==V)ja+=this.dy}if(ra&&(sa=ra.set,y.columnGraphics=sa,sa.translate(X,Q),this.columnsSet.push(sa),(y.url||this.showHandOnHover)&&sa.setAttr("cursor","pointer"),!ba)){"none"==V&&(H=q?(this.end+1-J)*z-c:z*J+c);"3d"==V&&(q?(H=(this.end+1-J)*z-c-1E3*
this.depthCount,ca+=F*this.columnIndex,fa+=F*this.columnIndex,y.y+=F*this.columnIndex):(H=(z-c)*(J+1)+1E3*this.depthCount,ca+=3,ja+=G*this.columnIndex+7,ga+=G*this.columnIndex,y.y+=G*this.columnIndex));if("regular"==V||"100%"==V)"inside"!=N&&(N="middle"),H=q?0<va.value?(this.end+1-J)*z+c:(this.end+1-J)*z-c:0<va.value?z*J+c:z*J-c;this.columnsArray.push({column:ra,depth:H});y.x=q?Q+R/2:X+R/2;this.ownColumns.push(ra);this.animateColumns(ra,J,C,M,B,K);this.addListeners(sa,y)}}break;case "candlestick":if(!isNaN(ka)&&
!isNaN(U)){var jb,vb;qa=ua;void 0!=y.lineColor&&(qa=y.lineColor);if(q){if(Q=B-h/2,X=M,R=h,Q+R>n&&(R=n-Q),0>Q&&(R+=Q,Q=0),Q<n&&0<R){var wb,xb;U>ka?(wb=[C,Ia],xb=[M,Ha]):(wb=[M,Ia],xb=[C,Ha]);!isNaN(Ia)&&!isNaN(Ha)&&B<n&&0<B&&(jb=AmCharts.line(e,wb,[B,B],qa,$,Y),vb=AmCharts.line(e,xb,[B,B],qa,$,Y));ea=C-M;ra=new AmCharts.Cuboid(e,ea,R,F,G,Ca,Ua,Y,qa,$,D,s,q,W,Ya)}}else if(X=C-h/2,Q=K+Y/2,R=h,X+R>m&&(R=m-X),0>X&&(R+=X,X=0),ea=B-K,X<m&&0<R){tb&&U>=ka&&(Oa=0);var ra=new AmCharts.Cuboid(e,R,ea,F,G,Ca,Oa,
Y,qa,$,D,s,q,W,Ya),yb,zb;U>ka?(yb=[B,ya],zb=[K,xa]):(yb=[K,ya],zb=[B,xa]);!isNaN(ya)&&!isNaN(xa)&&C<m&&0<C&&(jb=AmCharts.line(e,[C,C],yb,qa,$,Y),vb=AmCharts.line(e,[C,C],zb,qa,$,Y))}ra&&(sa=ra.set,y.columnGraphics=sa,Z.push(sa),sa.translate(X,Q-Y/2),(y.url||this.showHandOnHover)&&sa.setAttr("cursor","pointer"),jb&&(Z.push(jb),Z.push(vb)),ca=C,ja=B,q?(ga=B,fa=C,"open"==k&&(fa=M),"high"==k&&(fa=Ia),"low"==k&&(fa=Ha)):(ga=B,"open"==k&&(ga=K),"high"==k&&(ga=ya),"low"==k&&(ga=xa),fa=C),ba||(y.x=q?Q+R/
2:X+R/2,this.animateColumns(ra,J,C,M,B,K),this.addListeners(sa,y)))}break;case "ohlc":if(!(isNaN(ka)||isNaN(rb)||isNaN(sb)||isNaN(U))){U<ka&&(y.isNegative=!0,void 0!=wa&&(ua=wa));var Ab,Bb,Cb;if(q){var Db=B-h/2,Db=AmCharts.fitToBounds(Db,0,n),Nb=AmCharts.fitToBounds(B,0,n),Eb=B+h/2,Eb=AmCharts.fitToBounds(Eb,0,n);Bb=AmCharts.line(e,[M,M],[Db,Nb],ua,$,Y,W);0<B&&B<n&&(Ab=AmCharts.line(e,[Ha,Ia],[B,B],ua,$,Y,W));Cb=AmCharts.line(e,[C,C],[Nb,Eb],ua,$,Y,W);ga=B;fa=C;"open"==k&&(fa=M);"high"==k&&(fa=Ia);
"low"==k&&(fa=Ha)}else{var Fb=C-h/2,Fb=AmCharts.fitToBounds(Fb,0,m),Ob=AmCharts.fitToBounds(C,0,m),Gb=C+h/2,Gb=AmCharts.fitToBounds(Gb,0,m);Bb=AmCharts.line(e,[Fb,Ob],[K,K],ua,$,Y,W);0<C&&C<m&&(Ab=AmCharts.line(e,[C,C],[xa,ya],ua,$,Y,W));Cb=AmCharts.line(e,[Ob,Gb],[B,B],ua,$,Y,W);ga=B;"open"==k&&(ga=K);"high"==k&&(ga=ya);"low"==k&&(ga=xa);fa=C}Z.push(Bb);Z.push(Ab);Z.push(Cb);ca=C;ja=B}}if(!ba&&!isNaN(U)){var Pb=this.hideBulletsCount;if(this.end-this.start<=Pb||0===Pb){var Ja=this.createBullet(y,
fa,ga,J);Ja||(Ja=0);var Qb=this.labelText;if(Qb){var ha=this.createLabel(y,0,0,Qb),Ka=0,La=0,Rb=ha.getBBox(),Qa=Rb.width,Ma=Rb.height;switch(N){case "left":Ka=-(Qa/2+Ja/2+3);break;case "top":La=-(Ma/2+Ja/2+3);break;case "right":Ka=Ja/2+2+Qa/2;break;case "bottom":q&&"column"==g?(ca=na,0>U||0<U&&f.reversed?(Ka=-6,ha.attr({"text-anchor":"end"})):(Ka=6,ha.attr({"text-anchor":"start"}))):(La=Ja/2+Ma/2,ha.x=-(Qa/2+2));break;case "middle":"column"==g&&(q?(La=-(Ma/2)+this.fontSize/2,Ka=-(C-M)/2-F,Math.abs(C-
M)<Qa&&!this.showAllValueLabels&&(ha.remove(),ha=null)):(La=-(B-K)/2-G,Math.abs(B-K)<Ma&&!this.showAllValueLabels&&(ha.remove(),ha=null)));break;case "inside":q?(La=-(Ma/2)+this.fontSize/2,Ka=0>ea?Qa/2+6:-Qa/2-6):La=0>ea?Ma:-Ma}if(ha){if(isNaN(ja)||isNaN(ca))ha.remove(),ha=null;else if(ca+=Ka,ja+=La,ha.translate(ca,ja),q){if(0>ja||ja>n)ha.remove(),ha=null}else{var Sb=0;"3d"==V&&(Sb=F*L);if(0>ca||ca>m+Sb)ha.remove(),ha=null}ha&&this.allBullets.push(ha)}}if("regular"==V||"100%"==V){var Tb=f.totalText;
if(Tb){var Ra=this.createLabel(y,0,0,Tb,f.totalTextColor);this.allBullets.push(Ra);var Ub=Ra.getBBox(),Vb=Ub.width,Wb=Ub.height,Za,$a,Xb=f.totals[J];Xb&&Xb.remove();var ab=0;"column"!=g&&(ab=Ja);q?($a=B,Za=0>U?C-Vb/2-2-ab:C+Vb/2+3+ab):(Za=C,$a=0>U?B+Wb/2+ab:B-Wb/2-3-ab);Ra.translate(Za,$a);f.totals[J]=Ra;q?(0>$a||$a>n)&&Ra.remove():(0>Za||Za>m)&&Ra.remove()}}}}}}if("line"==g||"step"==g||"smoothedLine"==g)"smoothedLine"==g?this.drawSmoothedGraph(v,t,O,P):this.drawLineGraph(v,t,O,P),ba||this.launchAnimation();
this.bulletsHidden&&this.hideBullets()},animateColumns:function(a,b,c,d,e,f){var g=this;c=g.chart.startDuration;0<c&&!g.animationPlayed&&(g.seqAn?(a.set.hide(),g.animationArray.push(a),a=setTimeout(function(){g.animate.call(g)},c/(g.end-g.start+1)*(b-g.start)*1E3),g.timeOuts.push(a)):g.animate(a))},createLabel:function(a,b,c,d,e){var f=this.chart,g=a.labelColor;g||(g=this.color);g||(g=f.color);e&&(g=e);e=this.fontSize;void 0===e&&(this.fontSize=e=f.fontSize);var h=this.labelFunction;d=f.formatString(d,
a);d=AmCharts.cleanFromEmpty(d);h&&(d=h(a,d));a=AmCharts.text(this.container,d,g,f.fontFamily,e);a.node.style.pointerEvents="none";a.translate(b,c);this.bulletSet.push(a);return a},positiveClip:function(a){a.clipRect(this.pmx,this.pmy,this.pmw,this.pmh)},negativeClip:function(a){a.clipRect(this.nmx,this.nmy,this.nmw,this.nmh)},drawLineGraph:function(a,b,c,d){var e=this;if(1<a.length){var f=e.set,g=e.chart,h=e.container,k=h.set(),l=h.set();f.push(l);f.push(k);var m=e.lineAlpha,n=e.lineThickness,f=
e.fillAlphas,p=e.lineColorR,q=e.negativeLineAlpha;isNaN(q)&&(q=m);var r=e.lineColorSwitched;r&&(p=r);var r=e.fillColorsR,s=e.fillColorsSwitched;s&&(r=s);var w=e.dashLength;(s=e.dashLengthSwitched)&&(w=s);var s=e.negativeLineColor,v=e.negativeFillColors,t=e.negativeFillAlphas,u=e.baseCoord;0!==e.negativeBase&&(u=e.valueAxis.getCoordinate(e.negativeBase));m=AmCharts.line(h,a,b,p,m,n,w,!1,!0);k.push(m);k.click(function(a){e.handleGraphEvent(a,"clickGraph")}).mouseover(function(a){e.handleGraphEvent(a,
"rollOverGraph")}).mouseout(function(a){e.handleGraphEvent(a,"rollOutGraph")});void 0===s||e.useNegativeColorIfDown||(n=AmCharts.line(h,a,b,s,q,n,w,!1,!0),l.push(n));if(0<f||0<t)if(n=a.join(";").split(";"),q=b.join(";").split(";"),m=g.type,"serial"==m?0<c.length?(c.reverse(),d.reverse(),n=a.concat(c),q=b.concat(d)):e.rotate?(q.push(q[q.length-1]),n.push(u),q.push(q[0]),n.push(u),q.push(q[0]),n.push(n[0])):(n.push(n[n.length-1]),q.push(u),n.push(n[0]),q.push(u),n.push(a[0]),q.push(q[0])):"xy"==m&&
(b=e.fillToAxis)&&(AmCharts.isString(b)&&(b=g.getValueAxisById(b)),"H"==b.orientation?(u="top"==b.position?0:b.viH,n.push(n[n.length-1]),q.push(u),n.push(n[0]),q.push(u),n.push(a[0]),q.push(q[0])):(u="left"==b.position?0:b.viW,q.push(q[q.length-1]),n.push(u),q.push(q[0]),n.push(u),q.push(q[0]),n.push(n[0]))),a=e.gradientRotation,0<f&&(g=AmCharts.polygon(h,n,q,r,f,1,"#000",0,a),g.pattern(e.pattern),k.push(g)),v||void 0!==s)isNaN(t)&&(t=f),v||(v=s),h=AmCharts.polygon(h,n,q,v,t,1,"#000",0,a),h.pattern(e.pattern),
l.push(h),l.click(function(a){e.handleGraphEvent(a,"clickGraph")}).mouseover(function(a){e.handleGraphEvent(a,"rollOverGraph")}).mouseout(function(a){e.handleGraphEvent(a,"rollOutGraph")});e.applyMask(l,k)}},applyMask:function(a,b){var c=a.length();"serial"!=this.chart.type||this.scrollbar||(this.positiveClip(b),0<c&&this.negativeClip(a))},drawSmoothedGraph:function(a,b,c,d){if(1<a.length){var e=this.set,f=this.container,g=f.set(),h=f.set();e.push(h);e.push(g);var k=this.lineAlpha,l=this.lineThickness,
e=this.dashLength,m=this.fillAlphas,n=this.lineColorR,p=this.fillColorsR,q=this.negativeLineColor,r=this.negativeFillColors,s=this.negativeFillAlphas,w=this.baseCoord,v=this.lineColorSwitched;v&&(n=v);(v=this.fillColorsSwitched)&&(p=v);v=this.negativeLineAlpha;isNaN(v)&&(v=k);k=new AmCharts.Bezier(f,a,b,n,k,l,p,0,e);g.push(k.path);void 0!==q&&(l=new AmCharts.Bezier(f,a,b,q,v,l,p,0,e),h.push(l.path));0<m&&(k=a.join(";").split(";"),n=b.join(";").split(";"),l="",0<c.length?(c.push("M"),d.push("M"),c.reverse(),
d.reverse(),k=a.concat(c),n=b.concat(d)):(this.rotate?(l+=" L"+w+","+b[b.length-1],l+=" L"+w+","+b[0]):(l+=" L"+a[a.length-1]+","+w,l+=" L"+a[0]+","+w),l+=" L"+a[0]+","+b[0]),c=new AmCharts.Bezier(f,k,n,NaN,0,0,p,m,e,l),c.path.pattern(this.pattern),g.push(c.path),r||void 0!==q)&&(s||(s=m),r||(r=q),a=new AmCharts.Bezier(f,a,b,NaN,0,0,r,s,e,l),a.path.pattern(this.pattern),h.push(a.path));this.applyMask(h,g)}},launchAnimation:function(){var a=this,b=a.chart.startDuration;if(0<b&&!a.animationPlayed){var c=
a.set,d=a.bulletSet;AmCharts.VML||(c.attr({opacity:a.startAlpha}),d.attr({opacity:a.startAlpha}));c.hide();d.hide();a.seqAn?(b=setTimeout(function(){a.animateGraphs.call(a)},a.index*b*1E3),a.timeOuts.push(b)):a.animateGraphs()}},animateGraphs:function(){var a=this.chart,b=this.set,c=this.bulletSet,d=this.x,e=this.y;b.show();c.show();var f=a.startDuration,a=a.startEffect;b&&(this.rotate?(b.translate(-1E3,e),c.translate(-1E3,e)):(b.translate(d,-1E3),c.translate(d,-1E3)),b.animate({opacity:1,translate:d+
","+e},f,a),c.animate({opacity:1,translate:d+","+e},f,a))},animate:function(a){var b=this.chart,c=this.animationArray;!a&&0<c.length&&(a=c[0],c.shift());c=AmCharts[AmCharts.getEffect(b.startEffect)];b=b.startDuration;a&&(this.rotate?a.animateWidth(b,c):a.animateHeight(b,c),a.set.show())},legendKeyColor:function(){var a=this.legendColor,b=this.lineAlpha;void 0===a&&(a=this.lineColorR,0===b&&(b=this.fillColorsR)&&(a="object"==typeof b?b[0]:b));return a},legendKeyAlpha:function(){var a=this.legendAlpha;
void 0===a&&(a=this.lineAlpha,this.fillAlphas>a&&(a=this.fillAlphas),0===a&&(a=this.bulletAlpha),0===a&&(a=1));return a},createBullet:function(a,b,c,d){if(!isNaN(b)&&!isNaN(c)){d=this.container;var e=this.bulletOffset,f=this.bulletSize;isNaN(a.bulletSize)||(f=a.bulletSize);var g=a.values.value,h=this.maxValue,k=this.minValue,l=this.maxBulletSize,m=this.minBulletSize;isNaN(h)||(isNaN(g)||(f=(g-k)/(h-k)*(l-m)+m),k==h&&(f=l));h=f;this.bulletAxis&&(f=a.values.error,isNaN(f)||(g=f),f=this.bulletAxis.stepWidth*
g);f<this.minBulletSize&&(f=this.minBulletSize);this.rotate?b=a.isNegative?b-e:b+e:c=a.isNegative?c+e:c-e;var n,m=this.bulletColorR;a.lineColor&&(this.bulletColorSwitched=a.lineColor);this.bulletColorSwitched&&(m=this.bulletColorSwitched);a.isNegative&&void 0!==this.bulletColorNegative&&(m=this.bulletColorNegative);void 0!==a.color&&(m=a.color);var p;"xy"==this.chart.type&&this.valueField&&(p=this.pattern,a.pattern&&(p=a.pattern));e=this.bullet;a.bullet&&(e=a.bullet);var g=this.bulletBorderThickness,
k=this.bulletBorderColorR,l=this.bulletBorderAlpha,q=this.bulletAlpha;k||(k=m);this.useLineColorForBulletBorder&&(k=this.lineColorR);var r=a.alpha;isNaN(r)||(q=r);if("none"!=this.bullet||a.bullet)n=AmCharts.bullet(d,e,f,m,q,g,k,l,h,0,p);if(this.customBullet||a.customBullet)p=this.customBullet,a.customBullet&&(p=a.customBullet),p&&(n&&n.remove(),"function"==typeof p?(n=new p,n.chart=this.chart,a.bulletConfig&&(n.availableSpace=c,n.graph=this,n.graphDataItem=a,n.bulletY=c,a.bulletConfig.minCoord=this.minCoord-
c,n.bulletConfig=a.bulletConfig),n.write(d),n=n.set):(this.chart.path&&(p=this.chart.path+p),n=d.set(),d=d.image(p,0,0,f,f),n.push(d),this.centerCustomBullets&&d.translate(-f/2,-f/2)));n&&((a.url||this.showHandOnHover)&&n.setAttr("cursor","pointer"),"serial"==this.chart.type&&(0>b-0||b-0>this.width||c<-f/2||c-0>this.height)&&(n.remove(),n=null),n&&(this.bulletSet.push(n),n.translate(b,c),this.addListeners(n,a),this.allBullets.push(n)),a.bx=b,a.by=c);a.bulletGraphics=n;return f}},showBullets:function(){var a=
this.allBullets,b;this.bulletsHidden=!1;for(b=0;b<a.length;b++)a[b].show()},hideBullets:function(){var a=this.allBullets,b;this.bulletsHidden=!0;for(b=0;b<a.length;b++)a[b].hide()},addListeners:function(a,b){var c=this;a.mouseover(function(a){c.handleRollOver(b,a)}).mouseout(function(a){c.handleRollOut(b,a)}).touchend(function(a){c.handleRollOver(b,a);c.chart.panEventsEnabled&&c.handleClick(b,a)}).touchstart(function(a){c.handleRollOver(b,a)}).click(function(a){c.handleClick(b,a)}).dblclick(function(a){c.handleDoubleClick(b,
a)}).contextmenu(function(a){c.handleRightClick(b,a)})},handleRollOver:function(a,b){if(a){var c=this.chart,d={type:"rollOverGraphItem",item:a,index:a.index,graph:this,target:this,chart:this.chart,event:b};this.fire("rollOverGraphItem",d);c.fire("rollOverGraphItem",d);clearTimeout(c.hoverInt);d=this.showBalloon;c.chartCursor&&"serial"==c.type&&(d=!1,!c.chartCursor.valueBalloonsEnabled&&this.showBalloon&&(d=!0));if(d){var d=c.formatString(this.balloonText,a,!0),e=this.balloonFunction;e&&(d=e(a,a.graph));
d=AmCharts.cleanFromEmpty(d);e=c.getBalloonColor(this,a);c.balloon.showBullet=!1;c.balloon.pointerOrientation="V";var f=a.x,g=a.y;c.rotate&&(f=a.y,g=a.x);c.showBalloon(d,e,!0,f+c.marginLeftReal,g+c.marginTopReal)}}this.handleGraphEvent(b,"rollOverGraph")},handleRollOut:function(a,b){this.chart.hideBalloon();if(a){var c={type:"rollOutGraphItem",item:a,index:a.index,graph:this,target:this,chart:this.chart,event:b};this.fire("rollOutGraphItem",c);this.chart.fire("rollOutGraphItem",c)}this.handleGraphEvent(b,
"rollOutGraph")},handleClick:function(a,b){if(a){var c={type:"clickGraphItem",item:a,index:a.index,graph:this,target:this,chart:this.chart,event:b};this.fire("clickGraphItem",c);this.chart.fire("clickGraphItem",c);AmCharts.getURL(a.url,this.urlTarget)}this.handleGraphEvent(b,"clickGraph")},handleGraphEvent:function(a,b){var c={type:b,graph:this,target:this,chart:this.chart,event:a};this.fire(b,c);this.chart.fire(b,c)},handleRightClick:function(a,b){if(a){var c={type:"rightClickGraphItem",item:a,index:a.index,
graph:this,target:this,chart:this.chart,event:b};this.fire("rightClickGraphItem",c);this.chart.fire("rightClickGraphItem",c)}},handleDoubleClick:function(a,b){if(a){var c={type:"doubleClickGraphItem",item:a,index:a.index,graph:this,target:this,chart:this.chart,event:b};this.fire("doubleClickGraphItem",c);this.chart.fire("doubleClickGraphItem",c)}},zoom:function(a,b){this.start=a;this.end=b;this.draw()},changeOpacity:function(a){var b=this.set;b&&b.setAttr("opacity",a);if(b=this.ownColumns){var c;
for(c=0;c<b.length;c++){var d=b[c].set;d&&d.setAttr("opacity",a)}}(b=this.bulletSet)&&b.setAttr("opacity",a)},destroy:function(){AmCharts.remove(this.set);AmCharts.remove(this.bulletSet);var a=this.timeOuts;if(a){var b;for(b=0;b<a.length;b++)clearTimeout(a[b])}this.timeOuts=[]}});AmCharts.ChartCursor=AmCharts.Class({construct:function(a){this.cname="ChartCursor";this.createEvents("changed","zoomed","onHideCursor","draw","selected","moved");this.enabled=!0;this.cursorAlpha=1;this.selectionAlpha=.2;this.cursorColor="#CC0000";this.categoryBalloonAlpha=1;this.color="#FFFFFF";this.type="cursor";this.zoomed=!1;this.zoomable=!0;this.pan=!1;this.categoryBalloonDateFormat="MMM DD, YYYY";this.categoryBalloonEnabled=this.valueBalloonsEnabled=!0;this.rolledOver=!1;this.cursorPosition=
"middle";this.bulletsEnabled=this.skipZoomDispatch=!1;this.bulletSize=8;this.selectWithoutZooming=this.oneBalloonOnly=!1;this.graphBulletSize=1.7;this.animationDuration=.3;this.zooming=!1;this.adjustment=0;this.avoidBalloonOverlapping=!0;AmCharts.applyTheme(this,a,this.cname)},draw:function(){var a=this;a.destroy();var b=a.chart,c=b.container;a.rotate=b.rotate;a.container=c;c=c.set();c.translate(a.x,a.y);a.set=c;b.cursorSet.push(c);c=new AmCharts.AmBalloon;c.chart=b;a.categoryBalloon=c;AmCharts.copyProperties(b.balloon,
c);c.cornerRadius=0;c.shadowAlpha=0;c.borderThickness=1;c.borderAlpha=1;c.showBullet=!1;var d=a.categoryBalloonColor;void 0===d&&(d=a.cursorColor);c.fillColor=d;c.fillAlpha=a.categoryBalloonAlpha;c.borderColor=d;c.color=a.color;d=a.valueLineAxis;AmCharts.isString(d)&&(d=b.getValueAxisById(d));d||(d=b.valueAxes[0]);a.valueLineAxis=d;a.valueLineBalloonEnabled&&(d=new AmCharts.AmBalloon,a.vaBalloon=d,AmCharts.copyProperties(c,d),d.animationDuration=0,a.rotate||(d.pointerOrientation="H"));a.rotate&&(c.pointerOrientation=
"H");a.extraWidth=0;a.prevX=[];a.prevY=[];a.prevTX=[];a.prevTY=[];if(a.valueBalloonsEnabled)for(c=0;c<b.graphs.length;c++)d=new AmCharts.AmBalloon,d.chart=b,AmCharts.copyProperties(b.balloon,d),b.graphs[c].valueBalloon=d;"cursor"==a.type?a.createCursor():a.createCrosshair();a.interval=setInterval(function(){a.detectMovement.call(a)},40)},updateData:function(){var a=this.chart;this.data=a.chartData;this.firstTime=a.firstTime;this.lastTime=a.lastTime},createCursor:function(){var a=this.chart,b=this.cursorAlpha,
c=a.categoryAxis,d=this.categoryBalloon,e,f,g,h;g=a.dx;h=a.dy;var k=this.width,l=this.height,a=a.rotate;d.pointerWidth=c.tickLength;a?(e=[0,k,k+g],f=[0,0,h],g=[g,0,0],h=[h,0,l]):(e=[g,0,0],f=[h,0,l],g=[0,k,k+g],h=[0,0,h]);this.line=e=AmCharts.line(this.container,e,f,this.cursorColor,b,1);(f=this.fullRectSet)?(f.push(e),f.translate(this.x,this.y)):this.set.push(e);this.valueLineEnabled&&(e=this.valueLineAlpha,isNaN(e)||(b=e),this.vLine=b=AmCharts.line(this.container,g,h,this.cursorColor,b,1),this.set.push(b));
this.setBalloonBounds(d,c,a);(c=this.vaBalloon)&&this.setBalloonBounds(c,this.valueLineAxis,!a);this.hideCursor()},createCrosshair:function(){var a=this.cursorAlpha,b=this.container,c=AmCharts.line(b,[0,0],[0,this.height],this.cursorColor,a,1),a=AmCharts.line(b,[0,this.width],[0,0],this.cursorColor,a,1);this.set.push(c);this.set.push(a);this.vLine=c;this.hLine=a;this.hideCursor()},detectMovement:function(){var a=this.chart;if(a.mouseIsOver){var b=a.mouseX-this.x,c=a.mouseY-this.y;-.5<b&&b<this.width+
1&&0<c&&c<this.height?(this.drawing?this.rolledOver||a.setMouseCursor("crosshair"):this.pan&&(this.rolledOver||a.setMouseCursor("move")),this.rolledOver=!0,(this.valueLineEnabled||this.valueLineBalloonEnabled)&&this.updateVLine(b,c),this.setPosition()):this.rolledOver&&(this.handleMouseOut(),this.rolledOver=!1)}else this.rolledOver&&(this.handleMouseOut(),this.rolledOver=!1)},updateVLine:function(a,b){var c=this.vLine,d=this.vaBalloon;if((c||d)&&!this.panning&&!this.drawing){c&&c.show();var e=this.valueLineAxis,
f,g=this.rotate;g?(c&&c.translate(a,0),e&&(f=e.coordinateToValue(a)),c=a):(c&&c.translate(0,b),e&&(f=e.coordinateToValue(b)),c=b-1);if(d&&!isNaN(f)&&this.prevLineValue!=f){var h=e.formatValue(f,!0);d&&(this.setBalloonPosition(d,e,c,!g),d.showBalloon(h))}this.prevLineValue=f}},getMousePosition:function(){var a,b=this.width,c=this.height;a=this.chart;this.rotate?(a=a.mouseY-this.y,0>a&&(a=0),a>c&&(a=c)):(a=a.mouseX-this.x-1,0>a&&(a=0),a>b&&(a=b));return a},updateCrosshair:function(){var a=this.chart,
b=a.mouseX-this.x,c=a.mouseY-this.y,d=this.vLine,e=this.hLine,b=AmCharts.fitToBounds(b,0,this.width),c=AmCharts.fitToBounds(c,0,this.height);0<this.cursorAlpha&&(d.show(),e.show(),d.translate(b,0),e.translate(0,c));this.zooming&&(a.hideXScrollbar&&(b=NaN),a.hideYScrollbar&&(c=NaN),this.updateSelectionSize(b,c));this.fireMoved();a.mouseIsOver||this.zooming||this.hideCursor()},fireMoved:function(){var a=this.chart,b={type:"moved",target:this};b.chart=a;b.zooming=this.zooming;b.x=a.mouseX-this.x;b.y=
a.mouseY-this.y;this.fire("moved",b)},updateSelectionSize:function(a,b){AmCharts.remove(this.selection);var c=this.selectionPosX,d=this.selectionPosY,e=0,f=0,g=this.width,h=this.height;isNaN(a)||(c>a&&(e=a,g=c-a),c<a&&(e=c,g=a-c),c==a&&(e=a,g=0),g+=this.extraWidth,e-=this.extraWidth/2);isNaN(b)||(d>b&&(f=b,h=d-b),d<b&&(f=d,h=b-d),d==b&&(f=b,h=0),h+=this.extraWidth,f-=this.extraWidth/2);0<g&&0<h&&(c=AmCharts.rect(this.container,g,h,this.cursorColor,this.selectionAlpha),c.translate(e+this.x,f+this.y),
this.selection=c)},arrangeBalloons:function(){var a=this.valueBalloons,b=this.x,c=this.y,d=this.height+c;a.sort(this.compareY);var e;for(e=0;e<a.length;e++){var f=a[e].balloon;f.setBounds(b,c,b+this.width,d);f.prevX=this.prevX[e];f.prevY=this.prevY[e];f.prevTX=this.prevTX[e];f.prevTY=this.prevTY[e];f.draw();d=f.yPos-3}this.arrangeBalloons2()},compareY:function(a,b){return a.yy<b.yy?1:-1},arrangeBalloons2:function(){var a=this.valueBalloons;a.reverse();var b,c=this.x,d,e,f=a.length;for(e=0;e<f;e++){var g=
a[e].balloon;b=g.bottom;var h=g.bottom-g.yPos,k=f-e-1;0<e&&b-h<d+3&&(g.setBounds(c,d+3,c+this.width,d+h+3),g.prevX=this.prevX[k],g.prevY=this.prevY[k],g.prevTX=this.prevTX[k],g.prevTY=this.prevTY[k],g.draw());g.set&&g.set.show();this.prevX[k]=g.prevX;this.prevY[k]=g.prevY;this.prevTX[k]=g.prevTX;this.prevTY[k]=g.prevTY;d=g.bottom}},showBullets:function(){AmCharts.remove(this.allBullets);var a=this.container,b=a.set();this.set.push(b);this.set.show();this.allBullets=b;var b=this.chart.graphs,c;for(c=
0;c<b.length;c++){var d=b[c];if(!d.hidden&&d.balloonText){var e=this.data[this.index].axes[d.valueAxis.id].graphs[d.id],f=e.y;if(!isNaN(f)){var g,h;g=e.x;this.rotate?(h=f,f=g):h=g;d=AmCharts.circle(a,this.bulletSize/2,this.chart.getBalloonColor(d,e,!0),d.cursorBulletAlpha);d.translate(h,f);this.allBullets.push(d)}}}},destroy:function(){this.clear();AmCharts.remove(this.selection);this.selection=null;var a=this.categoryBalloon;a&&a.destroy();(a=this.vaBalloon)&&a.destroy();this.destroyValueBalloons();
AmCharts.remove(this.set)},clear:function(){clearInterval(this.interval)},destroyValueBalloons:function(){var a=this.valueBalloons;if(a){var b;for(b=0;b<a.length;b++)a[b].balloon.hide()}},zoom:function(a,b,c,d){var e=this.chart;this.destroyValueBalloons();this.zooming=!1;var f;this.rotate?this.selectionPosY=f=e.mouseY:this.selectionPosX=f=e.mouseX;this.start=a;this.end=b;this.startTime=c;this.endTime=d;this.zoomed=!0;d=e.categoryAxis;e=this.rotate;b=this.width;c=this.height;a=d.stepWidth;this.fullWidth&&
(f=1,d.parseDates&&!d.equalSpacing&&(f=d.minDuration()),e?this.extraWidth=c=a*f:(this.extraWidth=b=a*f,this.categoryBalloon.minWidth=b),this.line&&this.line.remove(),this.line=AmCharts.rect(this.container,b,c,this.cursorColor,this.cursorAlpha,0),this.fullRectSet&&this.fullRectSet.push(this.line));this.stepWidth=a;this.tempVal=this.valueBalloonsEnabled;this.valueBalloonsEnabled=!1;this.setPosition();this.valueBalloonsEnabled=this.tempVal;this.hideCursor()},hideObj:function(a){a&&a.hide()},hideCursor:function(a){void 0===
a&&(a=!0);this.hideObj(this.set);this.hideObj(this.categoryBalloon);this.hideObj(this.line);this.hideObj(this.vLine);this.hideObj(this.hLine);this.hideObj(this.vaBalloon);this.hideObj(this.allBullets);this.destroyValueBalloons();this.selectWithoutZooming||AmCharts.remove(this.selection);this.previousIndex=NaN;a&&this.fire("onHideCursor",{type:"onHideCursor",chart:this.chart,target:this});this.drawing||this.chart.setMouseCursor("auto");this.normalizeBulletSize()},setPosition:function(a,b,c){void 0===
b&&(b=!0);if("cursor"==this.type){if(this.tempPosition=NaN,AmCharts.ifArray(this.data))isNaN(a)&&(a=this.getMousePosition()),(a!=this.previousMousePosition||!0===this.zoomed||this.oneBalloonOnly)&&!isNaN(a)&&("mouse"==this.cursorPosition&&(this.tempPosition=a),isNaN(c)&&(c=this.chart.categoryAxis.xToIndex(a)),c!=this.previousIndex||this.zoomed||"mouse"==this.cursorPosition||this.oneBalloonOnly)&&(this.updateCursor(c,b),this.zoomed=!1),this.previousMousePosition=a}else this.updateCrosshair()},normalizeBulletSize:function(){var a=
this.resizedBullets;if(a)for(var b=0;b<a.length;b++){var c=a[b],d=c.bulletGraphics;d&&(d.translate(c.bx,c.by,1),c=c.graph,isNaN(this.graphBulletAlpha)||(d.setAttr("fill-opacity",c.bulletAlpha),d.setAttr("stroke-opacity",c.bulletBorderAlpha)))}},updateCursor:function(a,b){var c=this.chart,d=this.fullWidth,e=c.mouseX-this.x,f=c.mouseY-this.y;this.drawingNow&&(AmCharts.remove(this.drawingLine),this.drawingLine=AmCharts.line(this.container,[this.x+this.drawStartX,this.x+e],[this.y+this.drawStartY,this.y+
f],this.cursorColor,1,1));if(this.enabled){void 0===b&&(b=!0);this.index=a+=this.adjustment;var g=c.categoryAxis,h=c.dx,k=c.dy,l=this.x+1,m=this.y+1,n=this.width,p=this.height,q=this.data[a];this.fireMoved();if(q){var r=q.x[g.id],s=c.rotate,w=this.stepWidth,v=this.categoryBalloon,t=this.firstTime,u=this.lastTime,x=this.cursorPosition,E=this.zooming,A=this.panning,z=c.graphs;if(c.mouseIsOver||E||A||this.forceShow)if(this.forceShow=!1,A){var h=this.panClickPos,c=this.panClickEndTime,E=this.panClickStartTime,
H=this.panClickEnd,l=this.panClickStart,e=(s?h-f:h-e)/w;if(!g.parseDates||g.equalSpacing)e=Math.round(e);0!==e&&(h={type:"zoomed",target:this},h.chart=this.chart,g.parseDates&&!g.equalSpacing?(c+e>u&&(e=u-c),E+e<t&&(e=t-E),h.start=Math.round(E+e),h.end=Math.round(c+e),this.fire(h.type,h)):H+e>=this.data.length||0>l+e||(h.start=l+e,h.end=H+e,this.fire(h.type,h)))}else{"start"==x?r-=g.cellWidth/2:"mouse"==x&&(c.mouseIsOver?r=s?f-2:e-2:isNaN(this.tempPosition)||(r=this.tempPosition-2));if(s){if(0>r)if(E)r=
0;else{this.hideCursor();return}if(r>p+1)if(E)r=p+1;else{this.hideCursor();return}}else{if(0>r)if(E)r=0;else{this.hideCursor();return}if(r>n)if(E)r=n;else{this.hideCursor();return}}if(0<this.cursorAlpha){var F=this.line;s?(t=0,u=r+k,d&&(u-=g.cellWidth/2)):(t=r,u=0,d&&(t-=g.cellWidth/2));w=this.animationDuration;0<w&&!this.zooming?isNaN(this.previousX)?F.translate(t,u):(F.translate(this.previousX,this.previousY),F.animate({translate:t+","+u},w,"easeOutSine")):F.translate(t,u);this.previousX=t;this.previousY=
u;F.show()}this.linePos=s?r+k:r;E&&(d&&F.hide(),s?this.updateSelectionSize(NaN,r):this.updateSelectionSize(r,NaN));w=!0;E&&(w=!1);this.categoryBalloonEnabled&&w?(this.setBalloonPosition(v,g,r,s),(t=this.categoryBalloonFunction)?v.showBalloon(t(q.category)):g.parseDates?(g=AmCharts.formatDate(q.category,this.categoryBalloonDateFormat,c),-1!=g.indexOf("fff")&&(g=AmCharts.formatMilliseconds(g,q.category)),v.showBalloon(g)):v.showBalloon(AmCharts.fixNewLines(q.category))):v.hide();z&&this.bulletsEnabled&&
this.showBullets();if(this.oneBalloonOnly){r=Infinity;for(g=0;g<z.length;g++)t=z[g],t.showBalloon&&!t.hidden&&t.balloonText&&(u=q.axes[t.valueAxis.id].graphs[t.id],v=u.y,isNaN(v)||(s?Math.abs(e-v)<r&&(r=Math.abs(e-v),H=t):Math.abs(f-v)<r&&(r=Math.abs(f-v),H=t)));this.mostCloseGraph&&(H=this.mostCloseGraph)}if(a!=this.previousIndex||H!=this.previousMostCloseGraph)if(this.normalizeBulletSize(),this.destroyValueBalloons(),this.resizedBullets=[],z&&this.valueBalloonsEnabled&&w&&c.balloon.enabled){this.valueBalloons=
w=[];for(g=0;g<z.length;g++)if(t=z[g],v=NaN,(!this.oneBalloonOnly||t==H)&&t.showBalloon&&!t.hidden&&t.balloonText&&("step"==t.type&&"left"==t.stepDirection&&(q=this.data[a+1]),q)){if(u=q.axes[t.valueAxis.id].graphs[t.id])v=u.y;if(this.showNextAvailable&&isNaN(v)&&a+1<this.data.length)for(r=a+1;r<this.data.length;r++)if(d=this.data[r])if(u=d.axes[t.valueAxis.id].graphs[t.id],v=u.y,!isNaN(v))break;if(!isNaN(v)){d=u.x;k=!0;if(s){if(r=v,0>d||d>p)k=!1}else if(r=d,d=v,0>r||r>n+h+1)k=!1;k&&(k=this.graphBulletSize,
F=this.graphBulletAlpha,1==k&&isNaN(F)||!AmCharts.isModern||!(x=u.bulletGraphics)||(x.getBBox(),x.translate(u.bx,u.by,k),this.resizedBullets.push(u),isNaN(F)||(x.setAttr("fill-opacity",F),x.setAttr("stroke-opacity",F))),k=t.valueBalloon,F=c.getBalloonColor(t,u),k.setBounds(l,m,l+n,m+p),k.pointerOrientation="H",x=this.balloonPointerOrientation,"vertical"==x&&(k.pointerOrientation="V"),"horizontal"==x&&(k.pointerOrientation="H"),k.changeColor(F),void 0!==t.balloonAlpha&&(k.fillAlpha=t.balloonAlpha),
void 0!==t.balloonTextColor&&(k.color=t.balloonTextColor),k.setPosition(r+l,d+m),r=c.formatString(t.balloonText,u,!0),(d=t.balloonFunction)&&(r=d(u,t).toString()),""!==r&&(s?k.showBalloon(r):(k.text=r,k.show=!0),w.push({yy:v,balloon:k})),!s&&k.set&&(k.set.hide(),t=k.textDiv)&&(t.style.visibility="hidden"))}}this.avoidBalloonOverlapping&&this.arrangeBalloons()}b?(h={type:"changed"},h.index=a,h.chart=this.chart,h.zooming=E,h.mostCloseGraph=H,h.position=s?f:e,h.target=this,c.fire("changed",h),this.fire("changed",
h),this.skipZoomDispatch=!1):(this.skipZoomDispatch=!0,c.updateLegendValues(a));this.previousIndex=a;this.previousMostCloseGraph=H}}}else this.hideCursor()},setBalloonPosition:function(a,b,c,d){var e=b.position,f=b.inside;b=b.axisThickness;var g=this.chart,h=g.dx,g=g.dy,k=this.x,l=this.y,m=this.width,n=this.height;d?(f&&("right"==e?a.setBounds(k,l+g,k+m+h,l+c+g):a.setBounds(k,l+g,k+m+h,l+c)),"right"==e?f?a.setPosition(k+m+h,l+c+g):a.setPosition(k+m+h+b,l+c+g):f?a.setPosition(k,l+c):a.setPosition(k-
b,l+c)):"top"==e?f?a.setPosition(k+c+h,l+g):a.setPosition(k+c+h,l+g-b+1):f?a.setPosition(k+c,l+n):a.setPosition(k+c,l+n+b-1)},setBalloonBounds:function(a,b,c){var d=b.position,e=b.inside,f=b.axisThickness,g=b.tickLength,h=this.chart,k=h.dx,h=h.dy,l=this.x,m=this.y,n=this.width,p=this.height;c?(e&&(a.pointerWidth=0),"right"==d?e?a.setBounds(l,m+h,l+n+k,m+p+h):a.setBounds(l+n+k+f,m+h,l+n+1E3,m+p+h):e?a.setBounds(l,m,n+l,p+m):a.setBounds(-1E3,-1E3,l-g-f,m+p+15)):(a.maxWidth=n,b.parseDates&&(g=0,a.pointerWidth=
0),"top"==d?e?a.setBounds(l+k,m+h,n+k+l,p+m):a.setBounds(l+k,-1E3,n+k+l,m+h-g-f):e?a.setBounds(l,m,n+l,p+m-g):a.setBounds(l,m+p+g+f-1,l+n,m+p+g+f))},enableDrawing:function(a){this.enabled=!a;this.hideCursor();this.rolledOver=!1;this.drawing=a},isZooming:function(a){a&&a!=this.zooming&&this.handleMouseDown("fake");a||a==this.zooming||this.handleMouseUp()},handleMouseOut:function(){if(this.enabled)if(this.zooming)this.setPosition();else{this.index=void 0;var a={type:"changed",index:void 0,target:this};
a.chart=this.chart;this.fire("changed",a);this.hideCursor()}},handleReleaseOutside:function(){this.handleMouseUp()},handleMouseUp:function(){var a=this.chart,b=this.data,c;if(a){var d=a.mouseX-this.x,e=a.mouseY-this.y;if(this.drawingNow){this.drawingNow=!1;AmCharts.remove(this.drawingLine);c=this.drawStartX;var f=this.drawStartY;if(2<Math.abs(c-d)||2<Math.abs(f-e))c={type:"draw",target:this,chart:a,initialX:c,initialY:f,finalX:d,finalY:e},this.fire(c.type,c)}if(this.enabled&&0<b.length){if(this.pan)this.rolledOver=
!1;else if(this.zoomable&&this.zooming){c=this.selectWithoutZooming?{type:"selected"}:{type:"zoomed"};c.target=this;c.chart=a;if("cursor"==this.type)this.rotate?this.selectionPosY=e:this.selectionPosX=e=d,2>Math.abs(e-this.initialMouse)&&this.fromIndex==this.index||(this.index<this.fromIndex?(c.end=this.fromIndex,c.start=this.index):(c.end=this.index,c.start=this.fromIndex),e=a.categoryAxis,e.parseDates&&!e.equalSpacing&&(b[c.start]&&(c.start=b[c.start].time),b[c.end]&&(c.end=a.getEndTime(b[c.end].time))),
this.skipZoomDispatch||this.fire(c.type,c));else{var g=this.initialMouseX,h=this.initialMouseY;3>Math.abs(d-g)&&3>Math.abs(e-h)||(b=Math.min(g,d),f=Math.min(h,e),d=Math.abs(g-d),e=Math.abs(h-e),a.hideXScrollbar&&(b=0,d=this.width),a.hideYScrollbar&&(f=0,e=this.height),c.selectionHeight=e,c.selectionWidth=d,c.selectionY=f,c.selectionX=b,this.skipZoomDispatch||this.fire(c.type,c))}this.selectWithoutZooming||AmCharts.remove(this.selection)}this.skipZoomDispatch=!1}}this.panning=this.zooming=!1},showCursorAt:function(a){var b=
this.chart.categoryAxis;a=b.parseDates?b.dateToCoordinate(a):b.categoryToCoordinate(a);this.previousMousePosition=NaN;this.forceShow=!0;this.setPosition(a,!1)},clearSelection:function(){AmCharts.remove(this.selection)},handleMouseDown:function(a){if(this.zoomable||this.pan||this.drawing){var b=this.rotate,c=this.chart,d=c.mouseX-this.x,e=c.mouseY-this.y;if(0<d&&d<this.width&&0<e&&e<this.height||"fake"==a)this.setPosition(),this.selectWithoutZooming&&AmCharts.remove(this.selection),this.drawing?(this.drawStartY=
e,this.drawStartX=d,this.drawingNow=!0):this.pan?(this.zoomable=!1,c.setMouseCursor("move"),this.panning=!0,this.panClickPos=b?e:d,this.panClickStart=this.start,this.panClickEnd=this.end,this.panClickStartTime=this.startTime,this.panClickEndTime=this.endTime):this.zoomable&&("cursor"==this.type?(this.fromIndex=this.index,b?(this.initialMouse=e,this.selectionPosY=this.linePos):(this.initialMouse=d,this.selectionPosX=this.linePos)):(this.initialMouseX=d,this.initialMouseY=e,this.selectionPosX=d,this.selectionPosY=
e),this.zooming=!0)}}});AmCharts.SimpleChartScrollbar=AmCharts.Class({construct:function(a){this.createEvents("zoomed");this.backgroundColor="#D4D4D4";this.backgroundAlpha=1;this.selectedBackgroundColor="#EFEFEF";this.scrollDuration=this.selectedBackgroundAlpha=1;this.resizeEnabled=!0;this.hideResizeGrips=!1;this.scrollbarHeight=20;this.updateOnReleaseOnly=!1;9>document.documentMode&&(this.updateOnReleaseOnly=!0);this.dragIconWidth=18;this.dragIconHeight=25;AmCharts.applyTheme(this,a,"SimpleChartScrollbar")},draw:function(){var a=
this;a.destroy();a.interval=setInterval(function(){a.updateScrollbar.call(a)},40);var b=a.chart.container,c=a.rotate,d=a.chart,e=b.set();a.set=e;d.scrollbarsSet.push(e);var f,g;c?(f=a.scrollbarHeight,g=d.plotAreaHeight):(g=a.scrollbarHeight,f=d.plotAreaWidth);a.width=f;if((a.height=g)&&f){var h=AmCharts.rect(b,f,g,a.backgroundColor,a.backgroundAlpha,1,a.backgroundColor,a.backgroundAlpha);a.bg=h;e.push(h);h=AmCharts.rect(b,f,g,"#000",.005);e.push(h);a.invisibleBg=h;h.click(function(){a.handleBgClick()}).mouseover(function(){a.handleMouseOver()}).mouseout(function(){a.handleMouseOut()}).touchend(function(){a.handleBgClick()});
h=AmCharts.rect(b,f,g,a.selectedBackgroundColor,a.selectedBackgroundAlpha);a.selectedBG=h;e.push(h);f=AmCharts.rect(b,f,g,"#000",.005);a.dragger=f;e.push(f);f.mousedown(function(b){a.handleDragStart(b)}).mouseup(function(){a.handleDragStop()}).mouseover(function(){a.handleDraggerOver()}).mouseout(function(){a.handleMouseOut()}).touchstart(function(b){a.handleDragStart(b)}).touchend(function(){a.handleDragStop()});f=d.pathToImages;c?(h=f+"dragIconH.gif",f=a.dragIconWidth,c=a.dragIconHeight):(h=f+"dragIcon.gif",
c=a.dragIconWidth,f=a.dragIconHeight);g=b.image(h,0,0,c,f);var h=b.image(h,0,0,c,f),k=10,l=20;d.panEventsEnabled&&(k=25,l=a.scrollbarHeight);var m=AmCharts.rect(b,k,l,"#000",.005),n=AmCharts.rect(b,k,l,"#000",.005);n.translate(-(k-c)/2,-(l-f)/2);m.translate(-(k-c)/2,-(l-f)/2);c=b.set([g,n]);b=b.set([h,m]);a.iconLeft=c;a.iconRight=b;c.mousedown(function(){a.leftDragStart()}).mouseup(function(){a.leftDragStop()}).mouseover(function(){a.iconRollOver()}).mouseout(function(){a.iconRollOut()}).touchstart(function(b){a.leftDragStart()}).touchend(function(){a.leftDragStop()});
b.mousedown(function(){a.rightDragStart()}).mouseup(function(){a.rightDragStop()}).mouseover(function(){a.iconRollOver()}).mouseout(function(){a.iconRollOut()}).touchstart(function(b){a.rightDragStart()}).touchend(function(){a.rightDragStop()});AmCharts.ifArray(d.chartData)?e.show():e.hide();a.hideDragIcons();a.clipDragger(!1)}e.translate(a.x,a.y)},updateScrollbarSize:function(a,b){var c=this.dragger,d,e,f,g;this.rotate?(d=0,e=a,f=this.width+1,g=b-a,c.setAttr("height",b-a),c.setAttr("y",e)):(d=a,
e=0,f=b-a,g=this.height+1,c.setAttr("width",b-a),c.setAttr("x",d));this.clipAndUpdate(d,e,f,g)},updateScrollbar:function(){var a,b=!1,c,d,e=this.x,f=this.y,g=this.dragger,h=this.getDBox();c=h.x+e;d=h.y+f;var k=h.width,h=h.height,l=this.rotate,m=this.chart,n=this.width,p=this.height,q=m.mouseX,r=m.mouseY;a=this.initialMouse;this.forceClip&&this.clipDragger(!0);m.mouseIsOver&&(this.dragging&&(m=this.initialCoord,l?(a=m+(r-a),0>a&&(a=0),m=p-h,a>m&&(a=m),g.setAttr("y",a)):(a=m+(q-a),0>a&&(a=0),m=n-k,
a>m&&(a=m),g.setAttr("x",a)),this.clipDragger(!0)),this.resizingRight&&(l?(a=r-d,a+d>p+f&&(a=p-d+f),0>a?(this.resizingRight=!1,b=this.resizingLeft=!0):(0===a&&(a=.1),g.setAttr("height",a))):(a=q-c,a+c>n+e&&(a=n-c+e),0>a?(this.resizingRight=!1,b=this.resizingLeft=!0):(0===a&&(a=.1),g.setAttr("width",a))),this.clipDragger(!0)),this.resizingLeft&&(l?(c=d,d=r,d<f&&(d=f),d>p+f&&(d=p+f),a=!0===b?c-d:h+c-d,0>a?(this.resizingRight=!0,this.resizingLeft=!1,g.setAttr("y",c+h-f)):(0===a&&(a=.1),g.setAttr("y",
d-f),g.setAttr("height",a))):(d=q,d<e&&(d=e),d>n+e&&(d=n+e),a=!0===b?c-d:k+c-d,0>a?(this.resizingRight=!0,this.resizingLeft=!1,g.setAttr("x",c+k-e)):(0===a&&(a=.1),g.setAttr("x",d-e),g.setAttr("width",a))),this.clipDragger(!0)))},stopForceClip:function(){this.forceClip=!1},clipDragger:function(a){var b=this.getDBox();if(b){var c=b.x,d=b.y,e=b.width,b=b.height,f=!1;if(this.rotate){if(c=0,e=this.width+1,this.clipY!=d||this.clipH!=b)f=!0}else if(d=0,b=this.height+1,this.clipX!=c||this.clipW!=e)f=!0;
f&&(this.clipAndUpdate(c,d,e,b),a&&(this.updateOnReleaseOnly||this.dispatchScrollbarEvent()))}},maskGraphs:function(){},clipAndUpdate:function(a,b,c,d){this.clipX=a;this.clipY=b;this.clipW=c;this.clipH=d;this.selectedBG.clipRect(a,b,c,d);this.updateDragIconPositions();this.maskGraphs(a,b,c,d)},dispatchScrollbarEvent:function(){if(this.skipEvent)this.skipEvent=!1;else{var a=this.chart;a.hideBalloon();var b=this.getDBox(),c=b.x,d=b.y,e=b.width,b=b.height;this.rotate?(c=d,e=this.height/b):e=this.width/
e;a={type:"zoomed",position:c,chart:a,target:this,multiplier:e};this.fire(a.type,a)}},updateDragIconPositions:function(){var a=this.getDBox(),b=a.x,c=a.y,d=this.iconLeft,e=this.iconRight,f,g,h=this.scrollbarHeight;this.rotate?(f=this.dragIconWidth,g=this.dragIconHeight,d.translate(this.x+(h-g)/2,this.y+c-f/2),e.translate(this.x+(h-g)/2,this.y+c+a.height-f/2)):(f=this.dragIconHeight,g=this.dragIconWidth,d.translate(this.x+b-g/2,this.y+(h-f)/2),e.translate(this.x+b-g/2+a.width,this.y+(h-f)/2))},showDragIcons:function(){this.resizeEnabled&&
(this.iconLeft.show(),this.iconRight.show())},hideDragIcons:function(){if(!this.resizingLeft&&!this.resizingRight&&!this.dragging){if(this.hideResizeGrips||!this.resizeEnabled)this.iconLeft.hide(),this.iconRight.hide();this.removeCursors()}},removeCursors:function(){this.chart.setMouseCursor("auto")},relativeZoom:function(a,b){this.dragger.stop();this.multiplier=a;this.position=b;this.updateScrollbarSize(b,this.rotate?b+this.height/a:b+this.width/a)},destroy:function(){this.clear();AmCharts.remove(this.set);
AmCharts.remove(this.iconRight);AmCharts.remove(this.iconLeft)},clear:function(){clearInterval(this.interval)},handleDragStart:function(){var a=this.chart;this.dragger.stop();this.removeCursors();this.dragging=!0;var b=this.getDBox();this.rotate?(this.initialCoord=b.y,this.initialMouse=a.mouseY):(this.initialCoord=b.x,this.initialMouse=a.mouseX)},handleDragStop:function(){this.updateOnReleaseOnly&&(this.updateScrollbar(),this.skipEvent=!1,this.dispatchScrollbarEvent());this.dragging=!1;this.mouseIsOver&&
this.removeCursors();this.updateScrollbar()},handleDraggerOver:function(){this.handleMouseOver()},leftDragStart:function(){this.dragger.stop();this.resizingLeft=!0},leftDragStop:function(){this.resizingLeft=!1;this.mouseIsOver||this.removeCursors();this.updateOnRelease()},rightDragStart:function(){this.dragger.stop();this.resizingRight=!0},rightDragStop:function(){this.resizingRight=!1;this.mouseIsOver||this.removeCursors();this.updateOnRelease()},iconRollOut:function(){this.removeCursors()},iconRollOver:function(){this.rotate?
this.chart.setMouseCursor("n-resize"):this.chart.setMouseCursor("e-resize");this.handleMouseOver()},getDBox:function(){if(this.dragger)return this.dragger.getBBox()},handleBgClick:function(){var a=this;if(!a.resizingRight&&!a.resizingLeft){a.zooming=!0;var b,c,d=a.scrollDuration,e=a.dragger;b=a.getDBox();var f=b.height,g=b.width;c=a.chart;var h=a.y,k=a.x,l=a.rotate;l?(b="y",c=c.mouseY-f/2-h,c=AmCharts.fitToBounds(c,0,a.height-f)):(b="x",c=c.mouseX-g/2-k,c=AmCharts.fitToBounds(c,0,a.width-g));a.updateOnReleaseOnly?
(a.skipEvent=!1,e.setAttr(b,c),a.dispatchScrollbarEvent(),a.clipDragger()):(c=Math.round(c),l?e.animate({y:c},d,">"):e.animate({x:c},d,">"),a.forceClip=!0,clearTimeout(a.forceTO),a.forceTO=setTimeout(function(){a.stopForceClip.call(a)},3E3*d))}},updateOnRelease:function(){this.updateOnReleaseOnly&&(this.updateScrollbar(),this.skipEvent=!1,this.dispatchScrollbarEvent())},handleReleaseOutside:function(){if(this.set){if(this.resizingLeft||this.resizingRight||this.dragging)this.updateOnRelease(),this.removeCursors();
this.mouseIsOver=this.dragging=this.resizingRight=this.resizingLeft=!1;this.hideDragIcons();this.updateScrollbar()}},handleMouseOver:function(){this.mouseIsOver=!0;this.showDragIcons()},handleMouseOut:function(){this.mouseIsOver=!1;this.hideDragIcons()}});AmCharts.ChartScrollbar=AmCharts.Class({inherits:AmCharts.SimpleChartScrollbar,construct:function(a){this.cname="ChartScrollbar";AmCharts.ChartScrollbar.base.construct.call(this,a);this.graphLineColor="#BBBBBB";this.graphLineAlpha=0;this.graphFillColor="#BBBBBB";this.graphFillAlpha=1;this.selectedGraphLineColor="#888888";this.selectedGraphLineAlpha=0;this.selectedGraphFillColor="#888888";this.selectedGraphFillAlpha=1;this.gridCount=0;this.gridColor="#FFFFFF";this.gridAlpha=.7;this.skipEvent=this.autoGridCount=
!1;this.color="#FFFFFF";this.scrollbarCreated=!1;this.offset=0;AmCharts.applyTheme(this,a,this.cname)},init:function(){var a=this.categoryAxis,b=this.chart;a||(this.categoryAxis=a=new AmCharts.CategoryAxis);a.chart=b;a.id="scrollbar";a.dateFormats=b.categoryAxis.dateFormats;a.markPeriodChange=b.categoryAxis.markPeriodChange;a.boldPeriodBeginning=b.categoryAxis.boldPeriodBeginning;a.axisItemRenderer=AmCharts.RecItem;a.axisRenderer=AmCharts.RecAxis;a.guideFillRenderer=AmCharts.RecFill;a.inside=!0;a.fontSize=
this.fontSize;a.tickLength=0;a.axisAlpha=0;AmCharts.isString(this.graph)&&(this.graph=AmCharts.getObjById(b.graphs,this.graph));if(a=this.graph){var c=this.valueAxis;c||(this.valueAxis=c=new AmCharts.ValueAxis,c.visible=!1,c.scrollbar=!0,c.axisItemRenderer=AmCharts.RecItem,c.axisRenderer=AmCharts.RecAxis,c.guideFillRenderer=AmCharts.RecFill,c.labelsEnabled=!1,c.chart=b);b=this.unselectedGraph;b||(b=new AmCharts.AmGraph,b.scrollbar=!0,this.unselectedGraph=b,b.negativeBase=a.negativeBase,b.noStepRisers=
a.noStepRisers);b=this.selectedGraph;b||(b=new AmCharts.AmGraph,b.scrollbar=!0,this.selectedGraph=b,b.negativeBase=a.negativeBase,b.noStepRisers=a.noStepRisers)}this.scrollbarCreated=!0},draw:function(){var a=this;AmCharts.ChartScrollbar.base.draw.call(a);a.scrollbarCreated||a.init();var b=a.chart,c=b.chartData,d=a.categoryAxis,e=a.rotate,f=a.x,g=a.y,h=a.width,k=a.height,l=b.categoryAxis,m=a.set;d.setOrientation(!e);d.parseDates=l.parseDates;d.rotate=e;d.equalSpacing=l.equalSpacing;d.minPeriod=l.minPeriod;
d.startOnAxis=l.startOnAxis;d.viW=h;d.viH=k;d.width=h;d.height=k;d.gridCount=a.gridCount;d.gridColor=a.gridColor;d.gridAlpha=a.gridAlpha;d.color=a.color;d.tickLength=0;d.axisAlpha=0;d.autoGridCount=a.autoGridCount;d.parseDates&&!d.equalSpacing&&d.timeZoom(b.firstTime,b.lastTime);d.zoom(0,c.length-1);if(l=a.graph){var n=a.valueAxis,p=l.valueAxis;n.id=p.id;n.rotate=e;n.setOrientation(e);n.width=h;n.height=k;n.viW=h;n.viH=k;n.dataProvider=c;n.reversed=p.reversed;n.logarithmic=p.logarithmic;n.gridAlpha=
0;n.axisAlpha=0;m.push(n.set);e?(n.y=g,n.x=0):(n.x=f,n.y=0);var f=Infinity,g=-Infinity,q;for(q=0;q<c.length;q++){var r=c[q].axes[p.id].graphs[l.id].values,s;for(s in r)if(r.hasOwnProperty(s)&&"percents"!=s&&"total"!=s){var w=r[s];w<f&&(f=w);w>g&&(g=w)}}Infinity!=f&&(n.minimum=f);-Infinity!=g&&(n.maximum=g+.1*(g-f));f==g&&(n.minimum-=1,n.maximum+=1);void 0!==a.minimum&&(n.minimum=a.minimum);void 0!==a.maximum&&(n.maximum=a.maximum);n.zoom(0,c.length-1);s=a.unselectedGraph;s.id=l.id;s.rotate=e;s.chart=
b;s.data=c;s.valueAxis=n;s.chart=l.chart;s.categoryAxis=a.categoryAxis;s.periodSpan=l.periodSpan;s.valueField=l.valueField;s.openField=l.openField;s.closeField=l.closeField;s.highField=l.highField;s.lowField=l.lowField;s.lineAlpha=a.graphLineAlpha;s.lineColorR=a.graphLineColor;s.fillAlphas=a.graphFillAlpha;s.fillColorsR=a.graphFillColor;s.connect=l.connect;s.hidden=l.hidden;s.width=h;s.height=k;s.pointPosition=l.pointPosition;s.stepDirection=l.stepDirection;s.periodSpan=l.periodSpan;p=a.selectedGraph;
p.id=l.id;p.rotate=e;p.chart=b;p.data=c;p.valueAxis=n;p.chart=l.chart;p.categoryAxis=d;p.periodSpan=l.periodSpan;p.valueField=l.valueField;p.openField=l.openField;p.closeField=l.closeField;p.highField=l.highField;p.lowField=l.lowField;p.lineAlpha=a.selectedGraphLineAlpha;p.lineColorR=a.selectedGraphLineColor;p.fillAlphas=a.selectedGraphFillAlpha;p.fillColorsR=a.selectedGraphFillColor;p.connect=l.connect;p.hidden=l.hidden;p.width=h;p.height=k;p.pointPosition=l.pointPosition;p.stepDirection=l.stepDirection;
p.periodSpan=l.periodSpan;b=a.graphType;b||(b=l.type);s.type=b;p.type=b;c=c.length-1;s.zoom(0,c);p.zoom(0,c);p.set.click(function(){a.handleBackgroundClick()}).mouseover(function(){a.handleMouseOver()}).mouseout(function(){a.handleMouseOut()});s.set.click(function(){a.handleBackgroundClick()}).mouseover(function(){a.handleMouseOver()}).mouseout(function(){a.handleMouseOut()});m.push(s.set);m.push(p.set)}m.push(d.set);m.push(d.labelsSet);a.bg.toBack();a.invisibleBg.toFront();a.dragger.toFront();a.iconLeft.toFront();
a.iconRight.toFront()},timeZoom:function(a,b,c){this.startTime=a;this.endTime=b;this.timeDifference=b-a;this.skipEvent=!AmCharts.toBoolean(c);this.zoomScrollbar();this.skipEvent||this.dispatchScrollbarEvent()},zoom:function(a,b){this.start=a;this.end=b;this.skipEvent=!0;this.zoomScrollbar()},dispatchScrollbarEvent:function(){if(this.skipEvent)this.skipEvent=!1;else{var a=this.chart.chartData,b,c,d=this.dragger.getBBox();b=d.x;var e=d.y,f=d.width,d=d.height,g=this.chart;this.rotate?(b=e,c=d):c=f;f=
{type:"zoomed",target:this};f.chart=g;var h=this.categoryAxis,k=this.stepWidth,e=g.minSelectedTime,d=!1;if(h.parseDates&&!h.equalSpacing){if(a=g.lastTime,g=g.firstTime,h.minDuration(),h=Math.round(b/k)+g,b=this.dragging?h+this.timeDifference:Math.round((b+c)/k)+g,h>b&&(h=b),0<e&&b-h<e&&(b=Math.round(h+(b-h)/2),d=Math.round(e/2),h=b-d,b+=d,d=!0),b>a&&(b=a),b-e<h&&(h=b-e),h<g&&(h=g),h+e>b&&(b=h+e),h!=this.startTime||b!=this.endTime)this.startTime=h,this.endTime=b,f.start=h,f.end=b,f.startDate=new Date(h),
f.endDate=new Date(b),this.fire(f.type,f)}else if(h.startOnAxis||(b+=k/2),c-=this.stepWidth/2,e=h.xToIndex(b),b=h.xToIndex(b+c),e!=this.start||this.end!=b)h.startOnAxis&&(this.resizingRight&&e==b&&b++,this.resizingLeft&&e==b&&(0<e?e--:b=1)),this.start=e,this.end=this.dragging?this.start+this.difference:b,f.start=this.start,f.end=this.end,h.parseDates&&(a[this.start]&&(f.startDate=new Date(a[this.start].time)),a[this.end]&&(f.endDate=new Date(a[this.end].time))),this.fire(f.type,f);d&&this.zoomScrollbar()}},
zoomScrollbar:function(){var a,b;a=this.chart;var c=a.chartData,d=this.categoryAxis;d.parseDates&&!d.equalSpacing?(c=d.stepWidth,d=a.firstTime,a=c*(this.startTime-d),b=c*(this.endTime-d)):(a=c[this.start].x[d.id],b=c[this.end].x[d.id],c=d.stepWidth,d.startOnAxis||(d=c/2,a-=d,b+=d));this.stepWidth=c;this.updateScrollbarSize(a,b)},maskGraphs:function(a,b,c,d){var e=this.selectedGraph;e&&e.set.clipRect(a,b,c,d)},handleDragStart:function(){AmCharts.ChartScrollbar.base.handleDragStart.call(this);this.difference=
this.end-this.start;this.timeDifference=this.endTime-this.startTime;0>this.timeDifference&&(this.timeDifference=0)},handleBackgroundClick:function(){AmCharts.ChartScrollbar.base.handleBackgroundClick.call(this);this.dragging||(this.difference=this.end-this.start,this.timeDifference=this.endTime-this.startTime,0>this.timeDifference&&(this.timeDifference=0))}});AmCharts.AmBalloon=AmCharts.Class({construct:function(a){this.cname="AmBalloon";this.enabled=!0;this.fillColor="#FFFFFF";this.fillAlpha=.8;this.borderThickness=2;this.borderColor="#FFFFFF";this.borderAlpha=1;this.cornerRadius=0;this.maximumWidth=220;this.horizontalPadding=8;this.verticalPadding=4;this.pointerWidth=6;this.pointerOrientation="V";this.color="#000000";this.adjustBorderColor=!0;this.show=this.follow=this.showBullet=!1;this.bulletSize=3;this.shadowAlpha=.4;this.shadowColor="#000000";this.fadeOutDuration=
this.animationDuration=.3;this.fixedPosition=!1;this.offsetY=6;this.offsetX=1;this.textAlign="center";AmCharts.isModern||(this.offsetY*=1.5);AmCharts.applyTheme(this,a,this.cname)},draw:function(){var a=this.pointToX,b=this.pointToY;this.deltaSignX=this.deltaSignY=1;var c=this.chart;AmCharts.VML&&(this.fadeOutDuration=0);this.xAnim&&c.stopAnim(this.xAnim);this.yAnim&&c.stopAnim(this.yAnim);if(!isNaN(a)){var d=this.follow,e=c.container,f=this.set;AmCharts.remove(f);this.removeDiv();f=e.set();f.node.style.pointerEvents=
"none";this.set=f;c.balloonsSet.push(f);if(this.show){var g=this.l,h=this.t,k=this.r,l=this.b,m=this.balloonColor,n=this.fillColor,p=this.borderColor,q=n;void 0!=m&&(this.adjustBorderColor?q=p=m:n=m);var r=this.horizontalPadding,s=this.verticalPadding,w=this.pointerWidth,v=this.pointerOrientation,t=this.cornerRadius,u=c.fontFamily,x=this.fontSize;void 0==x&&(x=c.fontSize);var m=document.createElement("div"),E=m.style;E.pointerEvents="none";E.position="absolute";var A=this.minWidth,z="";isNaN(A)||
(z="min-width:"+(A-2*r)+"px; ");m.innerHTML='<div style="text-align:'+this.textAlign+"; "+z+"max-width:"+this.maxWidth+"px; font-size:"+x+"px; color:"+this.color+"; font-family:"+u+'">'+this.text+"</div>";c.chartDiv.appendChild(m);this.textDiv=m;x=m.offsetWidth;u=m.offsetHeight;m.clientHeight&&(x=m.clientWidth,u=m.clientHeight);u+=2*s;z=x+2*r;!isNaN(A)&&z<A&&(z=A);window.opera&&(u+=2);var H=!1,x=this.offsetY;c.handDrawn&&(x+=c.handDrawScatter+2);"H"!=v?(A=a-z/2,b<h+u+10&&"down"!=v?(H=!0,d&&(b+=x),
x=b+w,this.deltaSignY=-1):(d&&(b-=x),x=b-u-w,this.deltaSignY=1)):(2*w>u&&(w=u/2),x=b-u/2,a<g+(k-g)/2?(A=a+w,this.deltaSignX=-1):(A=a-z-w,this.deltaSignX=1));x+u>=l&&(x=l-u);x<h&&(x=h);A<g&&(A=g);A+z>k&&(A=k-z);var h=x+s,l=A+r,s=this.shadowAlpha,F=this.shadowColor,r=this.borderThickness,G=this.bulletSize,V;0<t||0===w?(0<s&&(a=AmCharts.rect(e,z,u,n,0,r+1,F,s,this.cornerRadius),AmCharts.isModern?a.translate(1,1):a.translate(4,4),f.push(a)),n=AmCharts.rect(e,z,u,n,this.fillAlpha,r,p,this.borderAlpha,
this.cornerRadius),this.showBullet&&(V=AmCharts.circle(e,G,q,this.fillAlpha),f.push(V))):(q=[],t=[],"H"!=v?(g=a-A,g>z-w&&(g=z-w),g<w&&(g=w),q=[0,g-w,a-A,g+w,z,z,0,0],t=H?[0,0,b-x,0,0,u,u,0]:[u,u,b-x,u,u,0,0,u]):(q=b-x,q>u-w&&(q=u-w),q<w&&(q=w),t=[0,q-w,b-x,q+w,u,u,0,0],q=a<g+(k-g)/2?[0,0,A<a?0:a-A,0,0,z,z,0]:[z,z,A+z>a?z:a-A,z,z,0,0,z]),0<s&&(a=AmCharts.polygon(e,q,t,n,0,r,F,s),a.translate(1,1),f.push(a)),n=AmCharts.polygon(e,q,t,n,this.fillAlpha,r,p,this.borderAlpha));this.bg=n;f.push(n);n.toFront();
e=1*this.deltaSignX;E.left=l+"px";E.top=h+"px";f.translate(A-e,x);n=n.getBBox();this.bottom=x+u+1;this.yPos=n.y+x;V&&V.translate(this.pointToX-A+e,b-x);b=this.animationDuration;0<this.animationDuration&&!d&&!isNaN(this.prevX)&&(f.translate(this.prevX,this.prevY),f.animate({translate:A-e+","+x},b,"easeOutSine"),m&&(E.left=this.prevTX+"px",E.top=this.prevTY+"px",this.xAnim=c.animate({node:m},"left",this.prevTX,l,b,"easeOutSine","px"),this.yAnim=c.animate({node:m},"top",this.prevTY,h,b,"easeOutSine",
"px")));this.prevX=A-e;this.prevY=x;this.prevTX=l;this.prevTY=h}}},followMouse:function(){if(this.follow&&this.show){var a=this.chart.mouseX-this.offsetX*this.deltaSignX,b=this.chart.mouseY;this.pointToX=a;this.pointToY=b;if(a!=this.previousX||b!=this.previousY)if(this.previousX=a,this.previousY=b,0===this.cornerRadius)this.draw();else{var c=this.set;if(c){var d=c.getBBox(),a=a-d.width/2,e=b-d.height-10;a<this.l&&(a=this.l);a>this.r-d.width&&(a=this.r-d.width);e<this.t&&(e=b+10);c.translate(a,e);
b=this.textDiv.style;b.left=a+this.horizontalPadding+"px";b.top=e+this.verticalPadding+"px"}}}},changeColor:function(a){this.balloonColor=a},setBounds:function(a,b,c,d){this.l=a;this.t=b;this.r=c;this.b=d;this.destroyTO&&clearTimeout(this.destroyTO)},showBalloon:function(a){this.text=a;this.show=!0;this.destroyTO&&clearTimeout(this.destroyTO);a=this.chart;this.fadeAnim1&&a.stopAnim(this.fadeAnim1);this.fadeAnim2&&a.stopAnim(this.fadeAnim2);this.draw()},hide:function(){var a=this,b=a.fadeOutDuration,
c=a.chart;if(0<b){a.destroyTO=setTimeout(function(){a.destroy.call(a)},1E3*b);a.follow=!1;a.show=!1;var d=a.set;d&&(d.setAttr("opacity",a.fillAlpha),a.fadeAnim1=d.animate({opacity:0},b,"easeInSine"));a.textDiv&&(a.fadeAnim2=c.animate({node:a.textDiv},"opacity",1,0,b,"easeInSine",""))}else a.show=!1,a.follow=!1,a.destroy()},setPosition:function(a,b,c){this.pointToX=a;this.pointToY=b;c&&(a==this.previousX&&b==this.previousY||this.draw());this.previousX=a;this.previousY=b},followCursor:function(a){var b=
this;(b.follow=a)?(b.pShowBullet=b.showBullet,b.showBullet=!1):void 0!==b.pShowBullet&&(b.showBullet=b.pShowBullet);clearInterval(b.interval);var c=b.chart.mouseX,d=b.chart.mouseY;!isNaN(c)&&a&&(b.pointToX=c-b.offsetX*b.deltaSignX,b.pointToY=d,b.followMouse(),b.interval=setInterval(function(){b.followMouse.call(b)},40))},removeDiv:function(){if(this.textDiv){var a=this.textDiv.parentNode;a&&a.removeChild(this.textDiv)}},destroy:function(){clearInterval(this.interval);AmCharts.remove(this.set);this.removeDiv();
this.set=null}});AmCharts.AmCoordinateChart=AmCharts.Class({inherits:AmCharts.AmChart,construct:function(a){AmCharts.AmCoordinateChart.base.construct.call(this,a);this.theme=a;this.createEvents("rollOverGraphItem","rollOutGraphItem","clickGraphItem","doubleClickGraphItem","rightClickGraphItem","clickGraph","rollOverGraph","rollOutGraph");this.startAlpha=1;this.startDuration=0;this.startEffect="elastic";this.sequencedAnimation=!0;this.colors="#FF6600 #FCD202 #B0DE09 #0D8ECF #2A0CD0 #CD0D74 #CC0000 #00CC00 #0000CC #DDDDDD #999999 #333333 #990000".split(" ");
this.balloonDateFormat="MMM DD, YYYY";this.valueAxes=[];this.graphs=[];this.guides=[];this.gridAboveGraphs=!1;AmCharts.applyTheme(this,a,"AmCoordinateChart")},initChart:function(){AmCharts.AmCoordinateChart.base.initChart.call(this);var a=this.categoryAxis;a&&(this.categoryAxis=AmCharts.processObject(a,AmCharts.CategoryAxis,this.theme));this.processValueAxes();this.createValueAxes();this.processGraphs();this.processGuides();AmCharts.VML&&(this.startAlpha=1);this.setLegendData(this.graphs);this.gridAboveGraphs&&
this.gridSet.toFront()},createValueAxes:function(){if(0===this.valueAxes.length){var a=new AmCharts.ValueAxis;this.addValueAxis(a)}},parseData:function(){this.processValueAxes();this.processGraphs()},parseSerialData:function(){var a=this.graphs,b,c={},d=this.seriesIdField;d||(d=this.categoryField);this.chartData=[];var e=this.dataProvider;if(e){var f=!1,g,h=this.categoryAxis,k,l;h&&(f=h.parseDates,k=h.forceShowField,l=h.labelColorField,g=h.categoryFunction);var m,n,p={},q;f&&(b=AmCharts.extractPeriod(h.minPeriod),
m=b.period,n=b.count,q=AmCharts.getPeriodDuration(m,n));var r={};this.lookupTable=r;var s,w=this.dataDateFormat,v={};for(s=0;s<e.length;s++){var t={},u=e[s];b=u[this.categoryField];t.dataContext=u;t.category=g?g(b,u,h):String(b);k&&(t.forceShow=u[k]);l&&(t.labelColor=u[l]);r[u[d]]=t;if(f&&(b=h.categoryFunction?h.categoryFunction(b,u,h):b instanceof Date?AmCharts.newDate(b,h.minPeriod):w?AmCharts.stringToDate(b,w):new Date(b),b=AmCharts.resetDateToMin(b,m,n,h.firstDayOfWeek),t.category=b,t.time=b.getTime(),
isNaN(t.time)))continue;var x=this.valueAxes;t.axes={};t.x={};var E;for(E=0;E<x.length;E++){var A=x[E].id;t.axes[A]={};t.axes[A].graphs={};var z;for(z=0;z<a.length;z++){b=a[z];var H=b.id,F=b.periodValue;if(b.valueAxis.id==A){t.axes[A].graphs[H]={};var G={};G.index=s;var V=u;b.dataProvider&&(V=c);G.values=this.processValues(V,b,F);!b.connect&&v&&v[H]&&t.time-p[H]>1.1*q&&(v[H].gap=!0);this.processFields(b,G,V);G.category=t.category;G.serialDataItem=t;G.graph=b;t.axes[A].graphs[H]=G;p[H]=t.time;v[H]=
G}}}this.chartData[s]=t}}for(c=0;c<a.length;c++)b=a[c],b.dataProvider&&this.parseGraphData(b)},processValues:function(a,b,c){var d={},e,f=!1;"candlestick"!=b.type&&"ohlc"!=b.type||""===c||(f=!0);e=Number(a[b.valueField+c]);isNaN(e)||(d.value=e);e=Number(a[b.errorField+c]);isNaN(e)||(d.error=e);f&&(c="Open");e=Number(a[b.openField+c]);isNaN(e)||(d.open=e);f&&(c="Close");e=Number(a[b.closeField+c]);isNaN(e)||(d.close=e);f&&(c="Low");e=Number(a[b.lowField+c]);isNaN(e)||(d.low=e);f&&(c="High");e=Number(a[b.highField+
c]);isNaN(e)||(d.high=e);return d},parseGraphData:function(a){var b=a.dataProvider,c=a.seriesIdField;c||(c=this.seriesIdField);c||(c=this.categoryField);var d;for(d=0;d<b.length;d++){var e=b[d],f=this.lookupTable[String(e[c])],g=a.valueAxis.id;f&&(g=f.axes[g].graphs[a.id],g.serialDataItem=f,g.values=this.processValues(e,a,a.periodValue),this.processFields(a,g,e))}},addValueAxis:function(a){a.chart=this;this.valueAxes.push(a);this.validateData()},removeValueAxesAndGraphs:function(){var a=this.valueAxes,
b;for(b=a.length-1;-1<b;b--)this.removeValueAxis(a[b])},removeValueAxis:function(a){var b=this.graphs,c;for(c=b.length-1;0<=c;c--){var d=b[c];d&&d.valueAxis==a&&this.removeGraph(d)}b=this.valueAxes;for(c=b.length-1;0<=c;c--)b[c]==a&&b.splice(c,1);this.validateData()},addGraph:function(a){this.graphs.push(a);this.chooseGraphColor(a,this.graphs.length-1);this.validateData()},removeGraph:function(a){var b=this.graphs,c;for(c=b.length-1;0<=c;c--)b[c]==a&&(b.splice(c,1),a.destroy());this.validateData()},
processValueAxes:function(){var a=this.valueAxes,b;for(b=0;b<a.length;b++){var c=a[b],c=AmCharts.processObject(c,AmCharts.ValueAxis,this.theme);a[b]=c;c.chart=this;c.id||(c.id="valueAxisAuto"+b+"_"+(new Date).getTime());void 0===c.usePrefixes&&(c.usePrefixes=this.usePrefixes)}},processGuides:function(){var a=this.guides,b=this.categoryAxis;if(a)for(var c=0;c<a.length;c++){var d=a[c];(void 0!==d.category||void 0!==d.date)&&b&&b.addGuide(d);var e=d.valueAxis;e?(AmCharts.isString(e)&&(e=this.getValueAxisById(e)),
e?e.addGuide(d):this.valueAxes[0].addGuide(d)):isNaN(d.value)||this.valueAxes[0].addGuide(d)}},processGraphs:function(){var a=this.graphs,b;for(b=0;b<a.length;b++){var c=a[b],c=AmCharts.processObject(c,AmCharts.AmGraph,this.theme);a[b]=c;this.chooseGraphColor(c,b);c.chart=this;AmCharts.isString(c.valueAxis)&&(c.valueAxis=this.getValueAxisById(c.valueAxis));c.valueAxis||(c.valueAxis=this.valueAxes[0]);c.id||(c.id="graphAuto"+b+"_"+(new Date).getTime())}},formatString:function(a,b,c){var d=b.graph,
e=d.valueAxis;e.duration&&b.values.value&&(e=AmCharts.formatDuration(b.values.value,e.duration,"",e.durationUnits,e.maxInterval,e.numberFormatter),a=a.split("[[value]]").join(e));a=AmCharts.massReplace(a,{"[[title]]":d.title,"[[description]]":b.description});a=c?AmCharts.fixNewLines(a):AmCharts.fixBrakes(a);return a=AmCharts.cleanFromEmpty(a)},getBalloonColor:function(a,b,c){var d=a.lineColor,e=a.balloonColor;c&&(e=d);c=a.fillColorsR;"object"==typeof c?d=c[0]:void 0!==c&&(d=c);b.isNegative&&(c=a.negativeLineColor,
a=a.negativeFillColors,"object"==typeof a?c=a[0]:void 0!==a&&(c=a),void 0!==c&&(d=c));void 0!==b.color&&(d=b.color);void 0===e&&(e=d);return e},getGraphById:function(a){return AmCharts.getObjById(this.graphs,a)},getValueAxisById:function(a){return AmCharts.getObjById(this.valueAxes,a)},processFields:function(a,b,c){if(a.itemColors){var d=a.itemColors,e=b.index;b.color=e<d.length?d[e]:AmCharts.randomColor()}d="lineColor color alpha fillColors description bullet customBullet bulletSize bulletConfig url labelColor dashLength pattern".split(" ");
for(e=0;e<d.length;e++){var f=d[e],g=a[f+"Field"];g&&(g=c[g],AmCharts.isDefined(g)&&(b[f]=g))}b.dataContext=c},chooseGraphColor:function(a,b){if(a.lineColor)a.lineColorR=a.lineColor;else{var c;c=this.colors.length>b?this.colors[b]:AmCharts.randomColor();a.lineColorR=c}a.fillColorsR=a.fillColors?a.fillColors:a.lineColorR;a.bulletBorderColorR=a.bulletBorderColor?a.bulletBorderColor:a.useLineColorForBulletBorder?a.lineColorR:a.bulletColor;a.bulletColorR=a.bulletColor?a.bulletColor:a.lineColorR;if(c=
this.patterns)a.pattern=c[b]},handleLegendEvent:function(a){var b=a.type;a=a.dataItem;if(!this.legend.data&&a){var c=a.hidden,d=a.showBalloon;switch(b){case "clickMarker":this.textClickEnabled&&(d?this.hideGraphsBalloon(a):this.showGraphsBalloon(a));break;case "clickLabel":d?this.hideGraphsBalloon(a):this.showGraphsBalloon(a);break;case "rollOverItem":c||this.highlightGraph(a);break;case "rollOutItem":c||this.unhighlightGraph();break;case "hideItem":this.hideGraph(a);break;case "showItem":this.showGraph(a)}}},
highlightGraph:function(a){var b=this.graphs,c,d=.2;this.legend&&(d=this.legend.rollOverGraphAlpha);if(1!=d)for(c=0;c<b.length;c++){var e=b[c];e!=a&&e.changeOpacity(d)}},unhighlightGraph:function(){var a;this.legend&&(a=this.legend.rollOverGraphAlpha);if(1!=a){a=this.graphs;var b;for(b=0;b<a.length;b++)a[b].changeOpacity(1)}},showGraph:function(a){a.switchable&&(a.hidden=!1,this.dataChanged=!0,"xy"!=this.type&&(this.marginsUpdated=!1),this.chartCreated&&this.initChart())},hideGraph:function(a){a.switchable&&
(this.dataChanged=!0,"xy"!=this.type&&(this.marginsUpdated=!1),a.hidden=!0,this.chartCreated&&this.initChart())},hideGraphsBalloon:function(a){a.showBalloon=!1;this.updateLegend()},showGraphsBalloon:function(a){a.showBalloon=!0;this.updateLegend()},updateLegend:function(){this.legend&&this.legend.invalidateSize()},resetAnimation:function(){var a=this.graphs;if(a){var b;for(b=0;b<a.length;b++)a[b].animationPlayed=!1}},animateAgain:function(){this.resetAnimation();this.validateNow()}});AmCharts.AmSlicedChart=AmCharts.Class({inherits:AmCharts.AmChart,construct:function(a){this.createEvents("rollOverSlice","rollOutSlice","clickSlice","pullOutSlice","pullInSlice","rightClickSlice");AmCharts.AmSlicedChart.base.construct.call(this,a);this.colors="#FF0F00 #FF6600 #FF9E01 #FCD202 #F8FF01 #B0DE09 #04D215 #0D8ECF #0D52D1 #2A0CD0 #8A0CCF #CD0D74 #754DEB #DDDDDD #999999 #333333 #000000 #57032A #CA9726 #990000 #4B0C25".split(" ");this.alpha=1;this.groupPercent=0;this.groupedTitle="Other";this.groupedPulled=
!1;this.groupedAlpha=1;this.marginLeft=0;this.marginBottom=this.marginTop=10;this.marginRight=0;this.hoverAlpha=1;this.outlineColor="#FFFFFF";this.outlineAlpha=0;this.outlineThickness=1;this.startAlpha=0;this.startDuration=1;this.startEffect="bounce";this.sequencedAnimation=!0;this.pullOutDuration=1;this.pullOutEffect="bounce";this.pullOnHover=this.pullOutOnlyOne=!1;this.labelsEnabled=!0;this.labelTickColor="#000000";this.labelTickAlpha=.2;this.hideLabelsPercent=0;this.urlTarget="_self";this.autoMarginOffset=
10;this.gradientRatio=[];this.maxLabelWidth=200;AmCharts.applyTheme(this,a,"AmSlicedChart")},initChart:function(){AmCharts.AmSlicedChart.base.initChart.call(this);this.dataChanged&&(this.parseData(),this.dispatchDataUpdated=!0,this.dataChanged=!1,this.setLegendData(this.chartData));this.drawChart()},handleLegendEvent:function(a){var b=a.type,c=a.dataItem,d=this.legend;if(!d.data&&c){var e=c.hidden;a=a.event;switch(b){case "clickMarker":e||d.switchable||this.clickSlice(c,a);break;case "clickLabel":e||
this.clickSlice(c,a,!1);break;case "rollOverItem":e||this.rollOverSlice(c,!1,a);break;case "rollOutItem":e||this.rollOutSlice(c,a);break;case "hideItem":this.hideSlice(c,a);break;case "showItem":this.showSlice(c,a)}}},invalidateVisibility:function(){this.recalculatePercents();this.initChart();var a=this.legend;a&&a.invalidateSize()},addEventListeners:function(a,b){var c=this;a.mouseover(function(a){c.rollOverSlice(b,!0,a)}).mouseout(function(a){c.rollOutSlice(b,a)}).touchend(function(a){c.rollOverSlice(b,
a);c.panEventsEnabled&&c.clickSlice(b,a)}).touchstart(function(a){c.rollOverSlice(b,a)}).click(function(a){c.clickSlice(b,a)}).contextmenu(function(a){c.handleRightClick(b,a)})},formatString:function(a,b,c){a=AmCharts.formatValue(a,b,["value"],this.nf,"",this.usePrefixes,this.prefixesOfSmallNumbers,this.prefixesOfBigNumbers);a=AmCharts.formatValue(a,b,["percents"],this.pf);a=AmCharts.massReplace(a,{"[[title]]":b.title,"[[description]]":b.description});-1!=a.indexOf("[[")&&(a=AmCharts.formatDataContextValue(a,
b.dataContext));a=c?AmCharts.fixNewLines(a):AmCharts.fixBrakes(a);return a=AmCharts.cleanFromEmpty(a)},startSlices:function(){var a;for(a=0;a<this.chartData.length;a++)0<this.startDuration&&this.sequencedAnimation?this.setStartTO(a):this.startSlice(this.chartData[a])},setStartTO:function(a){var b=this;a=setTimeout(function(){b.startSequenced.call(b)},b.startDuration/b.chartData.length*500*a);b.timeOuts.push(a)},pullSlices:function(a){var b=this.chartData,c;for(c=0;c<b.length;c++){var d=b[c];d.pulled&&
this.pullSlice(d,1,a)}},startSequenced:function(){var a=this.chartData,b;for(b=0;b<a.length;b++)if(!a[b].started){this.startSlice(this.chartData[b]);break}},startSlice:function(a){a.started=!0;var b=a.wedge,c=this.startDuration;b&&0<c&&(0<a.alpha&&b.show(),b.translate(a.startX,a.startY),b.animate({opacity:1,translate:"0,0"},c,this.startEffect))},showLabels:function(){var a=this.chartData,b;for(b=0;b<a.length;b++){var c=a[b];if(0<c.alpha){var d=c.label;d&&d.show();(c=c.tick)&&c.show()}}},showSlice:function(a){isNaN(a)?
a.hidden=!1:this.chartData[a].hidden=!1;this.invalidateVisibility()},hideSlice:function(a){isNaN(a)?a.hidden=!0:this.chartData[a].hidden=!0;this.hideBalloon();this.invalidateVisibility()},rollOverSlice:function(a,b,c){isNaN(a)||(a=this.chartData[a]);clearTimeout(this.hoverInt);if(!a.hidden){this.pullOnHover&&this.pullSlice(a,1);1>this.hoverAlpha&&a.wedge&&a.wedge.attr({opacity:this.hoverAlpha});var d=a.balloonX,e=a.balloonY;a.pulled&&(d+=a.pullX,e+=a.pullY);var f=this.formatString(this.balloonText,
a,!0),g=this.balloonFunction;g&&(f=g(a,f));g=AmCharts.adjustLuminosity(a.color,-.15);this.showBalloon(f,g,b,d,e);a={type:"rollOverSlice",dataItem:a,chart:this,event:c};this.fire(a.type,a)}},rollOutSlice:function(a,b){isNaN(a)||(a=this.chartData[a]);a.wedge&&a.wedge.attr({opacity:1});this.hideBalloon();var c={type:"rollOutSlice",dataItem:a,chart:this,event:b};this.fire(c.type,c)},clickSlice:function(a,b,c){isNaN(a)||(a=this.chartData[a]);a.pulled?this.pullSlice(a,0):this.pullSlice(a,1);AmCharts.getURL(a.url,
this.urlTarget);c||(a={type:"clickSlice",dataItem:a,chart:this,event:b},this.fire(a.type,a))},handleRightClick:function(a,b){isNaN(a)||(a=this.chartData[a]);var c={type:"rightClickSlice",dataItem:a,chart:this,event:b};this.fire(c.type,c)},drawTicks:function(){var a=this.chartData,b;for(b=0;b<a.length;b++){var c=a[b];if(c.label){var d=c.ty,d=AmCharts.line(this.container,[c.tx0,c.tx,c.tx2],[c.ty0,d,d],this.labelTickColor,this.labelTickAlpha);c.tick=d;c.wedge.push(d)}}},initialStart:function(){var a=
this,b=a.startDuration,c=setTimeout(function(){a.showLabels.call(a)},1E3*b);a.timeOuts.push(c);a.chartCreated?a.pullSlices(!0):(a.startSlices(),0<b?(b=setTimeout(function(){a.pullSlices.call(a)},1200*b),a.timeOuts.push(b)):a.pullSlices(!0))},pullSlice:function(a,b,c){var d=this.pullOutDuration;!0===c&&(d=0);(c=a.wedge)&&(0<d?c.animate({translate:b*a.pullX+","+b*a.pullY},d,this.pullOutEffect):c.translate(b*a.pullX,b*a.pullY));1==b?(a.pulled=!0,this.pullOutOnlyOne&&this.pullInAll(a.index),a={type:"pullOutSlice",
dataItem:a,chart:this}):(a.pulled=!1,a={type:"pullInSlice",dataItem:a,chart:this});this.fire(a.type,a)},pullInAll:function(a){var b=this.chartData,c;for(c=0;c<this.chartData.length;c++)c!=a&&b[c].pulled&&this.pullSlice(b[c],0)},pullOutAll:function(a){a=this.chartData;var b;for(b=0;b<a.length;b++)a[b].pulled||this.pullSlice(a[b],1)},parseData:function(){var a=[];this.chartData=a;var b=this.dataProvider;isNaN(this.pieAlpha)||(this.alpha=this.pieAlpha);if(void 0!==b){var c=b.length,d=0,e,f,g;for(e=0;e<
c;e++){f={};var h=b[e];f.dataContext=h;f.value=Number(h[this.valueField]);(g=h[this.titleField])||(g="");f.title=g;f.pulled=AmCharts.toBoolean(h[this.pulledField],!1);(g=h[this.descriptionField])||(g="");f.description=g;f.labelRadius=Number(h[this.labelRadiusField]);f.switchable=!0;f.url=h[this.urlField];g=h[this.patternField];!g&&this.patterns&&(g=this.patterns[e]);f.pattern=g;f.visibleInLegend=AmCharts.toBoolean(h[this.visibleInLegendField],!0);g=h[this.alphaField];f.alpha=void 0!==g?Number(g):
this.alpha;g=h[this.colorField];void 0!==g&&(f.color=AmCharts.toColor(g));f.labelColor=AmCharts.toColor(h[this.labelColorField]);d+=f.value;f.hidden=!1;a[e]=f}for(e=b=0;e<c;e++)f=a[e],f.percents=f.value/d*100,f.percents<this.groupPercent&&b++;1<b&&(this.groupValue=0,this.removeSmallSlices(),a.push({title:this.groupedTitle,value:this.groupValue,percents:this.groupValue/d*100,pulled:this.groupedPulled,color:this.groupedColor,url:this.groupedUrl,description:this.groupedDescription,alpha:this.groupedAlpha,
pattern:this.groupedPattern,dataContext:{}}));c=this.baseColor;c||(c=this.pieBaseColor);d=this.brightnessStep;d||(d=this.pieBrightnessStep);for(e=0;e<a.length;e++)c?g=AmCharts.adjustLuminosity(c,e*d/100):(g=this.colors[e],void 0===g&&(g=AmCharts.randomColor())),void 0===a[e].color&&(a[e].color=g);this.recalculatePercents()}},recalculatePercents:function(){var a=this.chartData,b=0,c,d;for(c=0;c<a.length;c++)d=a[c],!d.hidden&&0<d.value&&(b+=d.value);for(c=0;c<a.length;c++)d=this.chartData[c],d.percents=
!d.hidden&&0<d.value?100*d.value/b:0},removeSmallSlices:function(){var a=this.chartData,b;for(b=a.length-1;0<=b;b--)a[b].percents<this.groupPercent&&(this.groupValue+=a[b].value,a.splice(b,1))},animateAgain:function(){var a=this;a.startSlices();for(var b=0;b<a.chartData.length;b++){var c=a.chartData[b];c.started=!1;var d=c.wedge;d&&d.translate(c.startX,c.startY)}b=a.startDuration;0<b?(b=setTimeout(function(){a.pullSlices.call(a)},1200*b),a.timeOuts.push(b)):a.pullSlices()},measureMaxLabel:function(){var a=
this.chartData,b=0,c;for(c=0;c<a.length;c++){var d=a[c],e=this.formatString(this.labelText,d),f=this.labelFunction;f&&(e=f(d,e));d=AmCharts.text(this.container,e,this.color,this.fontFamily,this.fontSize);e=d.getBBox().width;e>b&&(b=e);d.remove()}return b}});AmCharts.AmRectangularChart=AmCharts.Class({inherits:AmCharts.AmCoordinateChart,construct:function(a){AmCharts.AmRectangularChart.base.construct.call(this,a);this.theme=a;this.createEvents("zoomed");this.marginRight=this.marginBottom=this.marginTop=this.marginLeft=20;this.verticalPosition=this.horizontalPosition=this.depth3D=this.angle=0;this.heightMultiplier=this.widthMultiplier=1;this.plotAreaFillColors="#FFFFFF";this.plotAreaFillAlphas=0;this.plotAreaBorderColor="#000000";this.plotAreaBorderAlpha=
0;this.zoomOutButtonImageSize=17;this.zoomOutButtonImage="lens.png";this.zoomOutText="Show all";this.zoomOutButtonColor="#e5e5e5";this.zoomOutButtonAlpha=0;this.zoomOutButtonRollOverAlpha=1;this.zoomOutButtonPadding=8;this.trendLines=[];this.autoMargins=!0;this.marginsUpdated=!1;this.autoMarginOffset=10;AmCharts.applyTheme(this,a,"AmRectangularChart")},initChart:function(){AmCharts.AmRectangularChart.base.initChart.call(this);this.updateDxy();var a=!0;!this.marginsUpdated&&this.autoMargins&&(this.resetMargins(),
a=!1);this.processScrollbars();this.updateMargins();this.updatePlotArea();this.updateScrollbars();this.updateTrendLines();this.updateChartCursor();this.updateValueAxes();a&&(this.scrollbarOnly||this.updateGraphs())},drawChart:function(){AmCharts.AmRectangularChart.base.drawChart.call(this);this.drawPlotArea();if(AmCharts.ifArray(this.chartData)){var a=this.chartCursor;a&&a.draw();a=this.zoomOutText;""!==a&&a&&this.drawZoomOutButton()}},resetMargins:function(){var a={},b;if("serial"==this.type){var c=
this.valueAxes;for(b=0;b<c.length;b++){var d=c[b];d.ignoreAxisWidth||(d.setOrientation(this.rotate),d.fixAxisPosition(),a[d.position]=!0)}(b=this.categoryAxis)&&!b.ignoreAxisWidth&&(b.setOrientation(!this.rotate),b.fixAxisPosition(),b.fixAxisPosition(),a[b.position]=!0)}else{d=this.xAxes;c=this.yAxes;for(b=0;b<d.length;b++){var e=d[b];e.ignoreAxisWidth||(e.setOrientation(!0),e.fixAxisPosition(),a[e.position]=!0)}for(b=0;b<c.length;b++)d=c[b],d.ignoreAxisWidth||(d.setOrientation(!1),d.fixAxisPosition(),
a[d.position]=!0)}a.left&&(this.marginLeft=0);a.right&&(this.marginRight=0);a.top&&(this.marginTop=0);a.bottom&&(this.marginBottom=0);this.fixMargins=a},measureMargins:function(){var a=this.valueAxes,b,c=this.autoMarginOffset,d=this.fixMargins,e=this.realWidth,f=this.realHeight,g=c,h=c,k=e;b=f;var l;for(l=0;l<a.length;l++)b=this.getAxisBounds(a[l],g,k,h,b),g=Math.round(b.l),k=Math.round(b.r),h=Math.round(b.t),b=Math.round(b.b);if(a=this.categoryAxis)b=this.getAxisBounds(a,g,k,h,b),g=Math.round(b.l),
k=Math.round(b.r),h=Math.round(b.t),b=Math.round(b.b);d.left&&g<c&&(this.marginLeft=Math.round(-g+c));d.right&&k>=e-c&&(this.marginRight=Math.round(k-e+c));d.top&&h<c+this.titleHeight&&(this.marginTop=Math.round(this.marginTop-h+c+this.titleHeight));d.bottom&&b>f-c&&(this.marginBottom=Math.round(this.marginBottom+b-f+c));this.initChart()},getAxisBounds:function(a,b,c,d,e){if(!a.ignoreAxisWidth){var f=a.labelsSet,g=a.tickLength;a.inside&&(g=0);if(f)switch(f=a.getBBox(),a.position){case "top":a=f.y;
d>a&&(d=a);break;case "bottom":a=f.y+f.height;e<a&&(e=a);break;case "right":a=f.x+f.width+g+3;c<a&&(c=a);break;case "left":a=f.x-g,b>a&&(b=a)}}return{l:b,t:d,r:c,b:e}},drawZoomOutButton:function(){var a=this,b=a.container.set();a.zoomButtonSet.push(b);var c=a.color,d=a.fontSize,e=a.zoomOutButtonImageSize,f=a.zoomOutButtonImage,g=AmCharts.lang.zoomOutText||a.zoomOutText,h=a.zoomOutButtonColor,k=a.zoomOutButtonAlpha,l=a.zoomOutButtonFontSize,m=a.zoomOutButtonPadding;isNaN(l)||(d=l);(l=a.zoomOutButtonFontColor)&&
(c=l);var l=a.zoomOutButton,n;l&&(l.fontSize&&(d=l.fontSize),l.color&&(c=l.color),l.backgroundColor&&(h=l.backgroundColor),isNaN(l.backgroundAlpha)||(a.zoomOutButtonRollOverAlpha=l.backgroundAlpha));var p=l=0;void 0!==a.pathToImages&&f&&(n=a.container.image(a.pathToImages+f,0,0,e,e),b.push(n),n=n.getBBox(),l=n.width+5);void 0!==g&&(c=AmCharts.text(a.container,g,c,a.fontFamily,d,"start"),d=c.getBBox(),p=n?n.height/2-3:d.height/2,c.translate(l,p),b.push(c));n=b.getBBox();c=1;AmCharts.isModern||(c=0);
h=AmCharts.rect(a.container,n.width+2*m+5,n.height+2*m-2,h,1,1,h,c);h.setAttr("opacity",k);h.translate(-m,-m);b.push(h);h.toBack();a.zbBG=h;n=h.getBBox();b.translate(a.marginLeftReal+a.plotAreaWidth-n.width+m,a.marginTopReal+m);b.hide();b.mouseover(function(){a.rollOverZB()}).mouseout(function(){a.rollOutZB()}).click(function(){a.clickZB()}).touchstart(function(){a.rollOverZB()}).touchend(function(){a.rollOutZB();a.clickZB()});for(k=0;k<b.length;k++)b[k].attr({cursor:"pointer"});a.zbSet=b},rollOverZB:function(){this.zbBG.setAttr("opacity",
this.zoomOutButtonRollOverAlpha)},rollOutZB:function(){this.zbBG.setAttr("opacity",this.zoomOutButtonAlpha)},clickZB:function(){this.zoomOut()},zoomOut:function(){this.updateScrollbar=!0;this.zoom()},drawPlotArea:function(){var a=this.dx,b=this.dy,c=this.marginLeftReal,d=this.marginTopReal,e=this.plotAreaWidth-1,f=this.plotAreaHeight-1,g=this.plotAreaFillColors,h=this.plotAreaFillAlphas,k=this.plotAreaBorderColor,l=this.plotAreaBorderAlpha;this.trendLinesSet.clipRect(c,d,e,f);"object"==typeof h&&
(h=h[0]);g=AmCharts.polygon(this.container,[0,e,e,0,0],[0,0,f,f,0],g,h,1,k,l,this.plotAreaGradientAngle);g.translate(c+a,d+b);this.set.push(g);0!==a&&0!==b&&(g=this.plotAreaFillColors,"object"==typeof g&&(g=g[0]),g=AmCharts.adjustLuminosity(g,-.15),e=AmCharts.polygon(this.container,[0,a,e+a,e,0],[0,b,b,0,0],g,h,1,k,l),e.translate(c,d+f),this.set.push(e),a=AmCharts.polygon(this.container,[0,0,a,a,0],[0,f,f+b,b,0],g,h,1,k,l),a.translate(c,d),this.set.push(a));(c=this.bbset)&&this.scrollbarOnly&&c.remove()},
updatePlotArea:function(){var a=this.updateWidth(),b=this.updateHeight(),c=this.container;this.realWidth=a;this.realWidth=b;c&&this.container.setSize(a,b);a=a-this.marginLeftReal-this.marginRightReal-this.dx;b=b-this.marginTopReal-this.marginBottomReal;1>a&&(a=1);1>b&&(b=1);this.plotAreaWidth=Math.round(a);this.plotAreaHeight=Math.round(b)},updateDxy:function(){this.dx=Math.round(this.depth3D*Math.cos(this.angle*Math.PI/180));this.dy=Math.round(-this.depth3D*Math.sin(this.angle*Math.PI/180));this.d3x=
Math.round(this.columnSpacing3D*Math.cos(this.angle*Math.PI/180));this.d3y=Math.round(-this.columnSpacing3D*Math.sin(this.angle*Math.PI/180))},updateMargins:function(){var a=this.getTitleHeight();this.titleHeight=a;this.marginTopReal=this.marginTop-this.dy+a;this.marginBottomReal=this.marginBottom;this.marginLeftReal=this.marginLeft;this.marginRightReal=this.marginRight},updateValueAxes:function(){var a=this.valueAxes,b=this.marginLeftReal,c=this.marginTopReal,d=this.plotAreaHeight,e=this.plotAreaWidth,
f;for(f=0;f<a.length;f++){var g=a[f];g.axisRenderer=AmCharts.RecAxis;g.guideFillRenderer=AmCharts.RecFill;g.axisItemRenderer=AmCharts.RecItem;g.dx=this.dx;g.dy=this.dy;g.viW=e-1;g.viH=d-1;g.marginsChanged=!0;g.viX=b;g.viY=c;this.updateObjectSize(g)}},updateObjectSize:function(a){a.width=(this.plotAreaWidth-1)*this.widthMultiplier;a.height=(this.plotAreaHeight-1)*this.heightMultiplier;a.x=this.marginLeftReal+this.horizontalPosition;a.y=this.marginTopReal+this.verticalPosition},updateGraphs:function(){var a=
this.graphs,b;for(b=0;b<a.length;b++){var c=a[b];c.x=this.marginLeftReal+this.horizontalPosition;c.y=this.marginTopReal+this.verticalPosition;c.width=this.plotAreaWidth*this.widthMultiplier;c.height=this.plotAreaHeight*this.heightMultiplier;c.index=b;c.dx=this.dx;c.dy=this.dy;c.rotate=this.rotate}},updateChartCursor:function(){var a=this.chartCursor;a&&(a=AmCharts.processObject(a,AmCharts.ChartCursor,this.theme),this.addChartCursor(a),a.x=this.marginLeftReal,a.y=this.marginTopReal,a.width=this.plotAreaWidth-
1,a.height=this.plotAreaHeight-1,a.chart=this)},processScrollbars:function(){var a=this.chartScrollbar;a&&(a=AmCharts.processObject(a,AmCharts.ChartScrollbar,this.theme),this.addChartScrollbar(a))},updateScrollbars:function(){},addChartCursor:function(a){AmCharts.callMethod("destroy",[this.chartCursor]);a&&(this.listenTo(a,"changed",this.handleCursorChange),this.listenTo(a,"zoomed",this.handleCursorZoom));this.chartCursor=a},removeChartCursor:function(){AmCharts.callMethod("destroy",[this.chartCursor]);
this.chartCursor=null},zoomTrendLines:function(){var a=this.trendLines,b;for(b=0;b<a.length;b++){var c=a[b];c.valueAxis.recalculateToPercents?c.set&&c.set.hide():(c.x=this.marginLeftReal+this.horizontalPosition,c.y=this.marginTopReal+this.verticalPosition,c.draw())}},addTrendLine:function(a){this.trendLines.push(a)},removeTrendLine:function(a){var b=this.trendLines,c;for(c=b.length-1;0<=c;c--)b[c]==a&&b.splice(c,1)},adjustMargins:function(a,b){var c=a.scrollbarHeight+a.offset;"top"==a.position?b?
this.marginLeftReal+=c:this.marginTopReal+=c:b?this.marginRightReal+=c:this.marginBottomReal+=c},getScrollbarPosition:function(a,b,c){a.position=b?"bottom"==c||"left"==c?"bottom":"top":"top"==c||"right"==c?"bottom":"top"},updateChartScrollbar:function(a,b){if(a){a.rotate=b;var c=this.marginTopReal,d=this.marginLeftReal,e=a.scrollbarHeight,f=this.dx,g=this.dy,h=a.offset;"top"==a.position?b?(a.y=c,a.x=d-e-h):(a.y=c-e+g-1-h,a.x=d+f):b?(a.y=c+g,a.x=d+this.plotAreaWidth+f+h):(a.y=c+this.plotAreaHeight+
h,a.x=this.marginLeftReal)}},showZB:function(a){var b=this.zbSet;b&&(a?b.show():b.hide(),this.rollOutZB())},handleReleaseOutside:function(a){AmCharts.AmRectangularChart.base.handleReleaseOutside.call(this,a);(a=this.chartCursor)&&a.handleReleaseOutside()},handleMouseDown:function(a){AmCharts.AmRectangularChart.base.handleMouseDown.call(this,a);var b=this.chartCursor;b&&b.handleMouseDown(a)},handleCursorChange:function(a){}});AmCharts.TrendLine=AmCharts.Class({construct:function(a){this.cname="TrendLine";this.createEvents("click");this.isProtected=!1;this.dashLength=0;this.lineColor="#00CC00";this.lineThickness=this.lineAlpha=1;AmCharts.applyTheme(this,a,this.cname)},draw:function(){var a=this;a.destroy();var b=a.chart,c=b.container,d,e,f,g,h=a.categoryAxis,k=a.initialDate,l=a.initialCategory,m=a.finalDate,n=a.finalCategory,p=a.valueAxis,q=a.valueAxisX,r=a.initialXValue,s=a.finalXValue,w=a.initialValue,v=a.finalValue,
t=p.recalculateToPercents,u=b.dataDateFormat;h&&(k&&(k instanceof Date||(k=u?AmCharts.stringToDate(k,u):new Date(k)),a.initialDate=k,d=h.dateToCoordinate(k)),l&&(d=h.categoryToCoordinate(l)),m&&(m instanceof Date||(m=u?AmCharts.stringToDate(m,u):new Date(m)),a.finalDate=m,e=h.dateToCoordinate(m)),n&&(e=h.categoryToCoordinate(n)));q&&!t&&(isNaN(r)||(d=q.getCoordinate(r)),isNaN(s)||(e=q.getCoordinate(s)));p&&!t&&(isNaN(w)||(f=p.getCoordinate(w)),isNaN(v)||(g=p.getCoordinate(v)));isNaN(d)||isNaN(e)||
isNaN(f)||isNaN(f)||(b.rotate?(h=[f,g],e=[d,e]):(h=[d,e],e=[f,g]),f=a.lineColor,d=AmCharts.line(c,h,e,f,a.lineAlpha,a.lineThickness,a.dashLength),g=h,k=e,n=h[1]-h[0],p=e[1]-e[0],0===n&&(n=.01),0===p&&(p=.01),l=n/Math.abs(n),m=p/Math.abs(p),p=n*p/Math.abs(n*p)*Math.sqrt(Math.pow(n,2)+Math.pow(p,2)),n=Math.asin(n/p),p=90*Math.PI/180-n,n=Math.abs(5*Math.cos(p)),p=Math.abs(5*Math.sin(p)),g.push(h[1]-l*p,h[0]-l*p),k.push(e[1]+m*n,e[0]+m*n),h=AmCharts.polygon(c,g,k,f,.005,0),c=c.set([h,d]),c.translate(b.marginLeftReal,
b.marginTopReal),b.trendLinesSet.push(c),a.line=d,a.set=c,h.mouseup(function(){a.handleLineClick()}).mouseover(function(){a.handleLineOver()}).mouseout(function(){a.handleLineOut()}),h.touchend&&h.touchend(function(){a.handleLineClick()}))},handleLineClick:function(){var a={type:"click",trendLine:this,chart:this.chart};this.fire(a.type,a)},handleLineOver:function(){var a=this.rollOverColor;void 0!==a&&this.line.attr({stroke:a})},handleLineOut:function(){this.line.attr({stroke:this.lineColor})},destroy:function(){AmCharts.remove(this.set)}});AmCharts.circle=function(a,b,c,d,e,f,g,h,k){if(void 0==e||0===e)e=.01;void 0===f&&(f="#000000");void 0===g&&(g=0);d={fill:c,stroke:f,"fill-opacity":d,"stroke-width":e,"stroke-opacity":g};a=isNaN(k)?a.circle(0,0,b).attr(d):a.ellipse(0,0,b,k).attr(d);h&&a.gradient("radialGradient",[c,AmCharts.adjustLuminosity(c,-.6)]);return a};
AmCharts.text=function(a,b,c,d,e,f,g,h){f||(f="middle");"right"==f&&(f="end");isNaN(h)&&(h=1);void 0!==b&&(b=String(b),AmCharts.isIE&&!AmCharts.isModern&&(b=b.replace("&amp;","&"),b=b.replace("&","&amp;")));c={fill:c,"font-family":d,"font-size":e,opacity:h};!0===g&&(c["font-weight"]="bold");c["text-anchor"]=f;return a.text(b,c)};
AmCharts.polygon=function(a,b,c,d,e,f,g,h,k,l,m){isNaN(f)&&(f=.01);isNaN(h)&&(h=e);var n=d,p=!1;"object"==typeof n&&1<n.length&&(p=!0,n=n[0]);void 0===g&&(g=n);e={fill:n,stroke:g,"fill-opacity":e,"stroke-width":f,"stroke-opacity":h};void 0!==m&&0<m&&(e["stroke-dasharray"]=m);m=AmCharts.dx;f=AmCharts.dy;a.handDrawn&&(c=AmCharts.makeHD(b,c,a.handDrawScatter),b=c[0],c=c[1]);g=Math.round;l&&(g=AmCharts.doNothing);l="M"+(g(b[0])+m)+","+(g(c[0])+f);for(h=1;h<b.length;h++)l+=" L"+(g(b[h])+m)+","+(g(c[h])+
f);a=a.path(l+" Z").attr(e);p&&a.gradient("linearGradient",d,k);return a};
AmCharts.rect=function(a,b,c,d,e,f,g,h,k,l,m){isNaN(f)&&(f=0);void 0===k&&(k=0);void 0===l&&(l=270);isNaN(e)&&(e=0);var n=d,p=!1;"object"==typeof n&&(n=n[0],p=!0);void 0===g&&(g=n);void 0===h&&(h=e);b=Math.round(b);c=Math.round(c);var q=0,r=0;0>b&&(b=Math.abs(b),q=-b);0>c&&(c=Math.abs(c),r=-c);q+=AmCharts.dx;r+=AmCharts.dy;e={fill:n,stroke:g,"fill-opacity":e,"stroke-opacity":h};void 0!==m&&0<m&&(e["stroke-dasharray"]=m);a=a.rect(q,r,b,c,k,f).attr(e);p&&a.gradient("linearGradient",d,l);return a};
AmCharts.bullet=function(a,b,c,d,e,f,g,h,k,l,m){var n;"circle"==b&&(b="round");switch(b){case "round":n=AmCharts.circle(a,c/2,d,e,f,g,h);break;case "square":n=AmCharts.polygon(a,[-c/2,c/2,c/2,-c/2],[c/2,c/2,-c/2,-c/2],d,e,f,g,h,l-180);break;case "rectangle":n=AmCharts.polygon(a,[-c,c,c,-c],[c/2,c/2,-c/2,-c/2],d,e,f,g,h,l-180);break;case "diamond":n=AmCharts.polygon(a,[-c/2,0,c/2,0],[0,-c/2,0,c/2],d,e,f,g,h);break;case "triangleUp":n=AmCharts.triangle(a,c,0,d,e,f,g,h);break;case "triangleDown":n=AmCharts.triangle(a,
c,180,d,e,f,g,h);break;case "triangleLeft":n=AmCharts.triangle(a,c,270,d,e,f,g,h);break;case "triangleRight":n=AmCharts.triangle(a,c,90,d,e,f,g,h);break;case "bubble":n=AmCharts.circle(a,c/2,d,e,f,g,h,!0);break;case "line":n=AmCharts.line(a,[-c/2,c/2],[0,0],d,e,f,g,h);break;case "yError":n=a.set();n.push(AmCharts.line(a,[0,0],[-c/2,c/2],d,e,f));n.push(AmCharts.line(a,[-k,k],[-c/2,-c/2],d,e,f));n.push(AmCharts.line(a,[-k,k],[c/2,c/2],d,e,f));break;case "xError":n=a.set(),n.push(AmCharts.line(a,[-c/
2,c/2],[0,0],d,e,f)),n.push(AmCharts.line(a,[-c/2,-c/2],[-k,k],d,e,f)),n.push(AmCharts.line(a,[c/2,c/2],[-k,k],d,e,f))}n&&n.pattern(m);return n};
AmCharts.triangle=function(a,b,c,d,e,f,g,h){if(void 0===f||0===f)f=1;void 0===g&&(g="#000");void 0===h&&(h=0);d={fill:d,stroke:g,"fill-opacity":e,"stroke-width":f,"stroke-opacity":h};b/=2;var k;0===c&&(k=" M"+-b+","+b+" L0,"+-b+" L"+b+","+b+" Z");180==c&&(k=" M"+-b+","+-b+" L0,"+b+" L"+b+","+-b+" Z");90==c&&(k=" M"+-b+","+-b+" L"+b+",0 L"+-b+","+b+" Z");270==c&&(k=" M"+-b+",0 L"+b+","+b+" L"+b+","+-b+" Z");return a.path(k).attr(d)};
AmCharts.line=function(a,b,c,d,e,f,g,h,k,l,m){if(a.handDrawn&&!m)return AmCharts.handDrawnLine(a,b,c,d,e,f,g,h,k,l,m);f={fill:"none","stroke-width":f};void 0!==g&&0<g&&(f["stroke-dasharray"]=g);isNaN(e)||(f["stroke-opacity"]=e);d&&(f.stroke=d);d=Math.round;l&&(d=AmCharts.doNothing);l=AmCharts.dx;e=AmCharts.dy;g="M"+(d(b[0])+l)+","+(d(c[0])+e);for(h=1;h<b.length;h++)g+=" L"+(d(b[h])+l)+","+(d(c[h])+e);if(AmCharts.VML)return a.path(g,void 0,!0).attr(f);k&&(g+=" M0,0 L0,0");return a.path(g).attr(f)};
AmCharts.makeHD=function(a,b,c){for(var d=[],e=[],f=1;f<a.length;f++)for(var g=Number(a[f-1]),h=Number(b[f-1]),k=Number(a[f]),l=Number(b[f]),m=Math.sqrt(Math.pow(k-g,2)+Math.pow(l-h,2)),m=Math.round(m/50)+1,k=(k-g)/m,l=(l-h)/m,n=0;n<=m;n++){var p=g+n*k+Math.random()*c,q=h+n*l+Math.random()*c;d.push(p);e.push(q)}return[d,e]};
AmCharts.handDrawnLine=function(a,b,c,d,e,f,g,h,k,l,m){var n=a.set();for(m=1;m<b.length;m++)for(var p=[b[m-1],b[m]],q=[c[m-1],c[m]],q=AmCharts.makeHD(p,q,a.handDrawScatter),p=q[0],q=q[1],r=1;r<p.length;r++)n.push(AmCharts.line(a,[p[r-1],p[r]],[q[r-1],q[r]],d,e,f+Math.random()*a.handDrawThickness-a.handDrawThickness/2,g,h,k,l,!0));return n};AmCharts.doNothing=function(a){return a};
AmCharts.wedge=function(a,b,c,d,e,f,g,h,k,l,m,n){var p=Math.round;f=p(f);g=p(g);h=p(h);var q=p(g/f*h),r=AmCharts.VML,s=359.5+f/100;359.94<s&&(s=359.94);e>=s&&(e=s);var w=1/180*Math.PI,s=b+Math.sin(d*w)*h,v=c-Math.cos(d*w)*q,t=b+Math.sin(d*w)*f,u=c-Math.cos(d*w)*g,x=b+Math.sin((d+e)*w)*f,E=c-Math.cos((d+e)*w)*g,A=b+Math.sin((d+e)*w)*h,w=c-Math.cos((d+e)*w)*q,z={fill:AmCharts.adjustLuminosity(l.fill,-.2),"stroke-opacity":0,"fill-opacity":l["fill-opacity"]},H=0;180<Math.abs(e)&&(H=1);d=a.set();var F;
r&&(s=p(10*s),t=p(10*t),x=p(10*x),A=p(10*A),v=p(10*v),u=p(10*u),E=p(10*E),w=p(10*w),b=p(10*b),k=p(10*k),c=p(10*c),f*=10,g*=10,h*=10,q*=10,1>Math.abs(e)&&1>=Math.abs(x-t)&&1>=Math.abs(E-u)&&(F=!0));e="";var G;n&&(z["fill-opacity"]=0,z["stroke-opacity"]=l["stroke-opacity"]/2,z.stroke=l.stroke);0<k&&(G=" M"+s+","+(v+k)+" L"+t+","+(u+k),r?(F||(G+=" A"+(b-f)+","+(k+c-g)+","+(b+f)+","+(k+c+g)+","+t+","+(u+k)+","+x+","+(E+k)),G+=" L"+A+","+(w+k),0<h&&(F||(G+=" B"+(b-h)+","+(k+c-q)+","+(b+h)+","+(k+c+q)+
","+A+","+(k+w)+","+s+","+(k+v)))):(G+=" A"+f+","+g+",0,"+H+",1,"+x+","+(E+k)+" L"+A+","+(w+k),0<h&&(G+=" A"+h+","+q+",0,"+H+",0,"+s+","+(v+k))),G=a.path(G+" Z",void 0,void 0,"1000,1000").attr(z),d.push(G),G=a.path(" M"+s+","+v+" L"+s+","+(v+k)+" L"+t+","+(u+k)+" L"+t+","+u+" L"+s+","+v+" Z",void 0,void 0,"1000,1000").attr(z),k=a.path(" M"+x+","+E+" L"+x+","+(E+k)+" L"+A+","+(w+k)+" L"+A+","+w+" L"+x+","+E+" Z",void 0,void 0,"1000,1000").attr(z),d.push(G),d.push(k));r?(F||(e=" A"+p(b-f)+","+p(c-g)+
","+p(b+f)+","+p(c+g)+","+p(t)+","+p(u)+","+p(x)+","+p(E)),f=" M"+p(s)+","+p(v)+" L"+p(t)+","+p(u)+e+" L"+p(A)+","+p(w)):f=" M"+s+","+v+" L"+t+","+u+(" A"+f+","+g+",0,"+H+",1,"+x+","+E)+" L"+A+","+w;0<h&&(r?F||(f+=" B"+(b-h)+","+(c-q)+","+(b+h)+","+(c+q)+","+A+","+w+","+s+","+v):f+=" A"+h+","+q+",0,"+H+",0,"+s+","+v);a.handDrawn&&(b=AmCharts.line(a,[s,t],[v,u],l.stroke,l.thickness*Math.random()*a.handDrawThickness,l["stroke-opacity"]),d.push(b));a=a.path(f+" Z",void 0,void 0,"1000,1000").attr(l);
if(m){b=[];for(c=0;c<m.length;c++)b.push(AmCharts.adjustLuminosity(l.fill,m[c]));0<b.length&&a.gradient("linearGradient",b)}a.pattern(n);d.push(a);return d};AmCharts.adjustLuminosity=function(a,b){a=String(a).replace(/[^0-9a-f]/gi,"");6>a.length&&(a=String(a[0])+String(a[0])+String(a[1])+String(a[1])+String(a[2])+String(a[2]));b=b||0;var c="#",d,e;for(e=0;3>e;e++)d=parseInt(a.substr(2*e,2),16),d=Math.round(Math.min(Math.max(0,d+d*b),255)).toString(16),c+=("00"+d).substr(d.length);return c};AmCharts.Bezier=AmCharts.Class({construct:function(a,b,c,d,e,f,g,h,k,l){"object"==typeof g&&(g=g[0]);"object"==typeof h&&(h=h[0]);f={fill:g,"fill-opacity":h,"stroke-width":f};void 0!==k&&0<k&&(f["stroke-dasharray"]=k);isNaN(e)||(f["stroke-opacity"]=e);d&&(f.stroke=d);d="M"+Math.round(b[0])+","+Math.round(c[0]);e=[];for(k=0;k<b.length;k++)e.push({x:Number(b[k]),y:Number(c[k])});1<e.length&&(b=this.interpolate(e),d+=this.drawBeziers(b));l?d+=l:AmCharts.VML||(d+="M0,0 L0,0");this.path=a.path(d).attr(f)},
interpolate:function(a){var b=[];b.push({x:a[0].x,y:a[0].y});var c=a[1].x-a[0].x,d=a[1].y-a[0].y,e=AmCharts.bezierX,f=AmCharts.bezierY;b.push({x:a[0].x+c/e,y:a[0].y+d/f});var g;for(g=1;g<a.length-1;g++){var h=a[g-1],k=a[g],d=a[g+1];isNaN(d.x)&&(d=k);isNaN(k.x)&&(k=h);isNaN(h.x)&&(h=k);c=d.x-k.x;d=d.y-h.y;h=k.x-h.x;h>c&&(h=c);b.push({x:k.x-h/e,y:k.y-d/f});b.push({x:k.x,y:k.y});b.push({x:k.x+h/e,y:k.y+d/f})}d=a[a.length-1].y-a[a.length-2].y;c=a[a.length-1].x-a[a.length-2].x;b.push({x:a[a.length-1].x-
c/e,y:a[a.length-1].y-d/f});b.push({x:a[a.length-1].x,y:a[a.length-1].y});return b},drawBeziers:function(a){var b="",c;for(c=0;c<(a.length-1)/3;c++)b+=this.drawBezierMidpoint(a[3*c],a[3*c+1],a[3*c+2],a[3*c+3]);return b},drawBezierMidpoint:function(a,b,c,d){var e=Math.round,f=this.getPointOnSegment(a,b,.75),g=this.getPointOnSegment(d,c,.75),h=(d.x-a.x)/16,k=(d.y-a.y)/16,l=this.getPointOnSegment(a,b,.375);a=this.getPointOnSegment(f,g,.375);a.x-=h;a.y-=k;b=this.getPointOnSegment(g,f,.375);b.x+=h;b.y+=
k;c=this.getPointOnSegment(d,c,.375);h=this.getMiddle(l,a);f=this.getMiddle(f,g);g=this.getMiddle(b,c);l=" Q"+e(l.x)+","+e(l.y)+","+e(h.x)+","+e(h.y);l+=" Q"+e(a.x)+","+e(a.y)+","+e(f.x)+","+e(f.y);l+=" Q"+e(b.x)+","+e(b.y)+","+e(g.x)+","+e(g.y);return l+=" Q"+e(c.x)+","+e(c.y)+","+e(d.x)+","+e(d.y)},getMiddle:function(a,b){return{x:(a.x+b.x)/2,y:(a.y+b.y)/2}},getPointOnSegment:function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}}});AmCharts.AmDraw=AmCharts.Class({construct:function(a,b,c,d){AmCharts.SVG_NS="http://www.w3.org/2000/svg";AmCharts.SVG_XLINK="http://www.w3.org/1999/xlink";AmCharts.hasSVG=!!document.createElementNS&&!!document.createElementNS(AmCharts.SVG_NS,"svg").createSVGRect;1>b&&(b=10);1>c&&(c=10);this.div=a;this.width=b;this.height=c;this.rBin=document.createElement("div");if(AmCharts.hasSVG){AmCharts.SVG=!0;var e=this.createSvgElement("svg");e.style.position="absolute";e.style.width=b+"px";e.style.height=c+
"px";b=this.createSvgElement("desc");b.appendChild(document.createTextNode("JavaScript chart by amCharts "+d.version));e.appendChild(b);AmCharts.rtl&&(e.setAttribute("direction","rtl"),e.style.left="auto",e.style.right="0px");e.setAttribute("version","1.1");a.appendChild(e);this.container=e;this.R=new AmCharts.SVGRenderer(this)}else AmCharts.isIE&&AmCharts.VMLRenderer&&(AmCharts.VML=!0,AmCharts.vmlStyleSheet||(document.namespaces.add("amvml","urn:schemas-microsoft-com:vml"),31>document.styleSheets.length?
(e=document.createStyleSheet(),e.addRule(".amvml","behavior:url(#default#VML); display:inline-block; antialias:true"),AmCharts.vmlStyleSheet=e):document.styleSheets[0].addRule(".amvml","behavior:url(#default#VML); display:inline-block; antialias:true")),this.container=a,this.R=new AmCharts.VMLRenderer(this,d),this.R.disableSelection(a))},createSvgElement:function(a){return document.createElementNS(AmCharts.SVG_NS,a)},circle:function(a,b,c,d){var e=new AmCharts.AmDObject("circle",this);e.attr({r:c,
cx:a,cy:b});this.addToContainer(e.node,d);return e},ellipse:function(a,b,c,d,e){var f=new AmCharts.AmDObject("ellipse",this);f.attr({rx:c,ry:d,cx:a,cy:b});this.addToContainer(f.node,e);return f},setSize:function(a,b){0<a&&0<b&&(this.container.style.width=a+"px",this.container.style.height=b+"px")},rect:function(a,b,c,d,e,f,g){var h=new AmCharts.AmDObject("rect",this);AmCharts.VML&&(e=Math.round(100*e/Math.min(c,d)),c+=2*f,d+=2*f,h.bw=f,h.node.style.marginLeft=-f,h.node.style.marginTop=-f);1>c&&(c=
1);1>d&&(d=1);h.attr({x:a,y:b,width:c,height:d,rx:e,ry:e,"stroke-width":f});this.addToContainer(h.node,g);return h},image:function(a,b,c,d,e,f){var g=new AmCharts.AmDObject("image",this);g.attr({x:b,y:c,width:d,height:e});this.R.path(g,a);this.addToContainer(g.node,f);return g},addToContainer:function(a,b){b||(b=this.container);b.appendChild(a)},text:function(a,b,c){return this.R.text(a,b,c)},path:function(a,b,c,d){var e=new AmCharts.AmDObject("path",this);d||(d="100,100");e.attr({cs:d});c?e.attr({dd:a}):
e.attr({d:a});this.addToContainer(e.node,b);return e},set:function(a){return this.R.set(a)},remove:function(a){if(a){var b=this.rBin;b.appendChild(a);b.innerHTML=""}},renderFix:function(){var a=this.container,b=a.style,c;try{c=a.getScreenCTM()||a.createSVGMatrix()}catch(d){c=a.createSVGMatrix()}a=1-c.e%1;c=1-c.f%1;.5<a&&(a-=1);.5<c&&(c-=1);a&&(b.left=a+"px");c&&(b.top=c+"px")},update:function(){this.R.update()}});AmCharts.AmDObject=AmCharts.Class({construct:function(a,b){this.D=b;this.R=b.R;this.node=this.R.create(this,a);this.y=this.x=0;this.scale=1},attr:function(a){this.R.attr(this,a);return this},getAttr:function(a){return this.node.getAttribute(a)},setAttr:function(a,b){this.R.setAttr(this,a,b);return this},clipRect:function(a,b,c,d){this.R.clipRect(this,a,b,c,d)},translate:function(a,b,c,d){d||(a=Math.round(a),b=Math.round(b));this.R.move(this,a,b,c);this.x=a;this.y=b;this.scale=c;this.angle&&this.rotate(this.angle)},
rotate:function(a,b){this.R.rotate(this,a,b);this.angle=a},animate:function(a,b,c){for(var d in a)if(a.hasOwnProperty(d)){var e=d,f=a[d];c=AmCharts.getEffect(c);this.R.animate(this,e,f,b,c)}},push:function(a){if(a){var b=this.node;b.appendChild(a.node);var c=a.clipPath;c&&b.appendChild(c);(a=a.grad)&&b.appendChild(a)}},text:function(a){this.R.setText(this,a)},remove:function(){this.R.remove(this)},clear:function(){var a=this.node;if(a.hasChildNodes())for(;1<=a.childNodes.length;)a.removeChild(a.firstChild)},
hide:function(){this.setAttr("visibility","hidden")},show:function(){this.setAttr("visibility","visible")},getBBox:function(){return this.R.getBBox(this)},toFront:function(){var a=this.node;if(a){this.prevNextNode=a.nextSibling;var b=a.parentNode;b&&b.appendChild(a)}},toPrevious:function(){var a=this.node;a&&this.prevNextNode&&(a=a.parentNode)&&a.insertBefore(this.prevNextNode,null)},toBack:function(){var a=this.node;if(a){this.prevNextNode=a.nextSibling;var b=a.parentNode;if(b){var c=b.firstChild;
c&&b.insertBefore(a,c)}}},mouseover:function(a){this.R.addListener(this,"mouseover",a);return this},mouseout:function(a){this.R.addListener(this,"mouseout",a);return this},click:function(a){this.R.addListener(this,"click",a);return this},dblclick:function(a){this.R.addListener(this,"dblclick",a);return this},mousedown:function(a){this.R.addListener(this,"mousedown",a);return this},mouseup:function(a){this.R.addListener(this,"mouseup",a);return this},touchstart:function(a){this.R.addListener(this,
"touchstart",a);return this},touchend:function(a){this.R.addListener(this,"touchend",a);return this},contextmenu:function(a){this.node.addEventListener?this.node.addEventListener("contextmenu",a,!0):this.R.addListener(this,"contextmenu",a);return this},stop:function(a){(a=this.animationX)&&AmCharts.removeFromArray(this.R.animations,a);(a=this.animationY)&&AmCharts.removeFromArray(this.R.animations,a)},length:function(){return this.node.childNodes.length},gradient:function(a,b,c){this.R.gradient(this,
a,b,c)},pattern:function(a,b){a&&this.R.pattern(this,a,b)}});AmCharts.VMLRenderer=AmCharts.Class({construct:function(a,b){this.chart=b;this.D=a;this.cNames={circle:"oval",ellipse:"oval",rect:"roundrect",path:"shape"};this.styleMap={x:"left",y:"top",width:"width",height:"height","font-family":"fontFamily","font-size":"fontSize",visibility:"visibility"}},create:function(a,b){var c;if("group"==b)c=document.createElement("div"),a.type="div";else if("text"==b)c=document.createElement("div"),a.type="text";else if("image"==b)c=document.createElement("img"),a.type=
"image";else{a.type="shape";a.shapeType=this.cNames[b];c=document.createElement("amvml:"+this.cNames[b]);var d=document.createElement("amvml:stroke");c.appendChild(d);a.stroke=d;var e=document.createElement("amvml:fill");c.appendChild(e);a.fill=e;e.className="amvml";d.className="amvml";c.className="amvml"}c.style.position="absolute";c.style.top=0;c.style.left=0;return c},path:function(a,b){a.node.setAttribute("src",b)},setAttr:function(a,b,c){if(void 0!==c){var d;8===document.documentMode&&(d=!0);
var e=a.node,f=a.type,g=e.style;"r"==b&&(g.width=2*c,g.height=2*c);"oval"==a.shapeType&&("rx"==b&&(g.width=2*c),"ry"==b&&(g.height=2*c));"roundrect"!=a.shapeType||"width"!=b&&"height"!=b||(c-=1);"cursor"==b&&(g.cursor=c);"cx"==b&&(g.left=c-AmCharts.removePx(g.width)/2);"cy"==b&&(g.top=c-AmCharts.removePx(g.height)/2);var h=this.styleMap[b];void 0!==h&&(g[h]=c);"text"==f&&("text-anchor"==b&&(a.anchor=c,h=e.clientWidth,"end"==c&&(g.marginLeft=-h+"px"),"middle"==c&&(g.marginLeft=-(h/2)+"px",g.textAlign=
"center"),"start"==c&&(g.marginLeft="0px")),"fill"==b&&(g.color=c),"font-weight"==b&&(g.fontWeight=c));if(g=a.children)for(h=0;h<g.length;h++)g[h].setAttr(b,c);if("shape"==f){"cs"==b&&(e.style.width="100px",e.style.height="100px",e.setAttribute("coordsize",c));"d"==b&&e.setAttribute("path",this.svgPathToVml(c));"dd"==b&&e.setAttribute("path",c);f=a.stroke;a=a.fill;"stroke"==b&&(d?f.color=c:f.setAttribute("color",c));"stroke-width"==b&&(d?f.weight=c:f.setAttribute("weight",c));"stroke-opacity"==b&&
(d?f.opacity=c:f.setAttribute("opacity",c));"stroke-dasharray"==b&&(g="solid",0<c&&3>c&&(g="dot"),3<=c&&6>=c&&(g="dash"),6<c&&(g="longdash"),d?f.dashstyle=g:f.setAttribute("dashstyle",g));if("fill-opacity"==b||"opacity"==b)0===c?d?a.on=!1:a.setAttribute("on",!1):d?a.opacity=c:a.setAttribute("opacity",c);"fill"==b&&(d?a.color=c:a.setAttribute("color",c));"rx"==b&&(d?e.arcSize=c+"%":e.setAttribute("arcsize",c+"%"))}}},attr:function(a,b){for(var c in b)b.hasOwnProperty(c)&&this.setAttr(a,c,b[c])},text:function(a,
b,c){var d=new AmCharts.AmDObject("text",this.D),e=d.node;e.style.whiteSpace="pre";e.innerHTML=a;this.D.addToContainer(e,c);this.attr(d,b);return d},getBBox:function(a){return this.getBox(a.node)},getBox:function(a){var b=a.offsetLeft,c=a.offsetTop,d=a.offsetWidth,e=a.offsetHeight,f;if(a.hasChildNodes()){var g,h,k;for(k=0;k<a.childNodes.length;k++){f=this.getBox(a.childNodes[k]);var l=f.x;isNaN(l)||(isNaN(g)?g=l:l<g&&(g=l));var m=f.y;isNaN(m)||(isNaN(h)?h=m:m<h&&(h=m));l=f.width+l;isNaN(l)||(d=Math.max(d,
l));f=f.height+m;isNaN(f)||(e=Math.max(e,f))}0>g&&(b+=g);0>h&&(c+=h)}return{x:b,y:c,width:d,height:e}},setText:function(a,b){var c=a.node;c&&(c.innerHTML=b);this.setAttr(a,"text-anchor",a.anchor)},addListener:function(a,b,c){a.node["on"+b]=c},move:function(a,b,c){var d=a.node,e=d.style;"text"==a.type&&(c-=AmCharts.removePx(e.fontSize)/2-1);"oval"==a.shapeType&&(b-=AmCharts.removePx(e.width)/2,c-=AmCharts.removePx(e.height)/2);a=a.bw;isNaN(a)||(b-=a,c-=a);isNaN(b)||isNaN(c)||(d.style.left=b+"px",d.style.top=
c+"px")},svgPathToVml:function(a){var b=a.split(" ");a="";var c,d=Math.round,e;for(e=0;e<b.length;e++){var f=b[e],g=f.substring(0,1),f=f.substring(1),h=f.split(","),k=d(h[0])+","+d(h[1]);"M"==g&&(a+=" m "+k);"L"==g&&(a+=" l "+k);"Z"==g&&(a+=" x e");if("Q"==g){var l=c.length,m=c[l-1],n=h[0],p=h[1],k=h[2],q=h[3];c=d(c[l-2]/3+2/3*n);m=d(m/3+2/3*p);n=d(2/3*n+k/3);p=d(2/3*p+q/3);a+=" c "+c+","+m+","+n+","+p+","+k+","+q}"A"==g&&(a+=" wa "+f);"B"==g&&(a+=" at "+f);c=h}return a},animate:function(a,b,c,d,
e){var f=a.node,g=this.chart;if("translate"==b){b=c.split(",");c=b[1];var h=f.offsetTop;g.animate(a,"left",f.offsetLeft,b[0],d,e,"px");g.animate(a,"top",h,c,d,e,"px")}},clipRect:function(a,b,c,d,e){a=a.node;0===b&&0===c?(a.style.width=d+"px",a.style.height=e+"px",a.style.overflow="hidden"):a.style.clip="rect("+c+"px "+(b+d)+"px "+(c+e)+"px "+b+"px)"},rotate:function(a,b,c){if(0!==Number(b)){var d=a.node;a=d.style;c||(c=this.getBGColor(d.parentNode));a.backgroundColor=c;a.paddingLeft=1;c=b*Math.PI/
180;var e=Math.cos(c),f=Math.sin(c),g=AmCharts.removePx(a.left),h=AmCharts.removePx(a.top),k=d.offsetWidth,d=d.offsetHeight;b/=Math.abs(b);a.left=g+k/2-k/2*Math.cos(c)-b*d/2*Math.sin(c)+3;a.top=h-b*k/2*Math.sin(c)+b*d/2*Math.sin(c);a.cssText=a.cssText+"; filter:progid:DXImageTransform.Microsoft.Matrix(M11='"+e+"', M12='"+-f+"', M21='"+f+"', M22='"+e+"', sizingmethod='auto expand');"}},getBGColor:function(a){var b="#FFFFFF";if(a.style){var c=a.style.backgroundColor;""!==c?b=c:a.parentNode&&(b=this.getBGColor(a.parentNode))}return b},
set:function(a){var b=new AmCharts.AmDObject("group",this.D);this.D.container.appendChild(b.node);if(a){var c;for(c=0;c<a.length;c++)b.push(a[c])}return b},gradient:function(a,b,c,d){var e="";"radialGradient"==b&&(b="gradientradial",c.reverse());"linearGradient"==b&&(b="gradient");var f;for(f=0;f<c.length;f++){var g=Math.round(100*f/(c.length-1)),e=e+(g+"% "+c[f]);f<c.length-1&&(e+=",")}a=a.fill;90==d?d=0:270==d?d=180:180==d?d=90:0===d&&(d=270);8===document.documentMode?(a.type=b,a.angle=d):(a.setAttribute("type",
b),a.setAttribute("angle",d));e&&(a.colors.value=e)},remove:function(a){a.clipPath&&this.D.remove(a.clipPath);this.D.remove(a.node)},disableSelection:function(a){void 0!==typeof a.onselectstart&&(a.onselectstart=function(){return!1});a.style.cursor="default"},pattern:function(a,b){var c=a.node,d=a.fill,e="none";b.color&&(e=b.color);c.fillColor=e;8===document.documentMode?(d.type="tile",d.src=b.url):(d.setAttribute("type","tile"),d.setAttribute("src",b.url))},update:function(){}});AmCharts.SVGRenderer=AmCharts.Class({construct:function(a){this.D=a;this.animations=[]},create:function(a,b){return document.createElementNS(AmCharts.SVG_NS,b)},attr:function(a,b){for(var c in b)b.hasOwnProperty(c)&&this.setAttr(a,c,b[c])},setAttr:function(a,b,c){void 0!==c&&a.node.setAttribute(b,c)},animate:function(a,b,c,d,e){var f=a.node;a["an_"+b]&&AmCharts.removeFromArray(this.animations,a["an_"+b]);"translate"==b?(f=(f=f.getAttribute("transform"))?String(f).substring(10,f.length-1):"0,0",f=
f.split(", ").join(" "),f=f.split(" ").join(","),0===f&&(f="0,0")):f=Number(f.getAttribute(b));c={obj:a,frame:0,attribute:b,from:f,to:c,time:d,effect:e};this.animations.push(c);a["an_"+b]=c},update:function(){var a,b=this.animations;for(a=b.length-1;0<=a;a--){var c=b[a],d=1E3*c.time/AmCharts.updateRate,e=c.frame+1,f=c.obj,g=c.attribute,h,k,l;e<=d?(c.frame++,"translate"==g?(h=c.from.split(","),g=Number(h[0]),h=Number(h[1]),isNaN(h)&&(h=0),k=c.to.split(","),l=Number(k[0]),k=Number(k[1]),l=0===l-g?l:
Math.round(AmCharts[c.effect](0,e,g,l-g,d)),c=0===k-h?k:Math.round(AmCharts[c.effect](0,e,h,k-h,d)),g="transform",c="translate("+l+","+c+")"):(k=Number(c.from),h=Number(c.to),l=h-k,c=AmCharts[c.effect](0,e,k,l,d),isNaN(c)&&(c=h),0===l&&this.animations.splice(a,1)),this.setAttr(f,g,c)):("translate"==g?(k=c.to.split(","),l=Number(k[0]),k=Number(k[1]),f.translate(l,k)):(h=Number(c.to),this.setAttr(f,g,h)),this.animations.splice(a,1))}},getBBox:function(a){if(a=a.node)try{return a.getBBox()}catch(b){}return{width:0,
height:0,x:0,y:0}},path:function(a,b){a.node.setAttributeNS(AmCharts.SVG_XLINK,"xlink:href",b)},clipRect:function(a,b,c,d,e){var f=a.node,g=a.clipPath;g&&this.D.remove(g);var h=f.parentNode;h&&(f=document.createElementNS(AmCharts.SVG_NS,"clipPath"),g=AmCharts.getUniqueId(),f.setAttribute("id",g),this.D.rect(b,c,d,e,0,0,f),h.appendChild(f),b="#",AmCharts.baseHref&&!AmCharts.isIE&&(b=window.location.href+b),this.setAttr(a,"clip-path","url("+b+g+")"),this.clipPathC++,a.clipPath=f)},text:function(a,b,
c){var d=new AmCharts.AmDObject("text",this.D);a=String(a).split("\n");var e=b["font-size"],f;for(f=0;f<a.length;f++){var g=this.create(null,"tspan");g.appendChild(document.createTextNode(a[f]));g.setAttribute("y",(e+2)*f+Math.round(e/2));g.setAttribute("x",0);d.node.appendChild(g)}d.node.setAttribute("y",Math.round(e/2));this.attr(d,b);this.D.addToContainer(d.node,c);return d},setText:function(a,b){var c=a.node;c&&(c.removeChild(c.firstChild),c.appendChild(document.createTextNode(b)))},move:function(a,
b,c,d){b="translate("+b+","+c+")";d&&(b=b+" scale("+d+")");this.setAttr(a,"transform",b)},rotate:function(a,b){var c=a.node.getAttribute("transform"),d="rotate("+b+")";c&&(d=c+" "+d);this.setAttr(a,"transform",d)},set:function(a){var b=new AmCharts.AmDObject("g",this.D);this.D.container.appendChild(b.node);if(a){var c;for(c=0;c<a.length;c++)b.push(a[c])}return b},addListener:function(a,b,c){a.node["on"+b]=c},gradient:function(a,b,c,d){var e=a.node,f=a.grad;f&&this.D.remove(f);b=document.createElementNS(AmCharts.SVG_NS,
b);f=AmCharts.getUniqueId();b.setAttribute("id",f);if(!isNaN(d)){var g=0,h=0,k=0,l=0;90==d?k=100:270==d?l=100:180==d?g=100:0===d&&(h=100);b.setAttribute("x1",g+"%");b.setAttribute("x2",h+"%");b.setAttribute("y1",k+"%");b.setAttribute("y2",l+"%")}for(d=0;d<c.length;d++)g=document.createElementNS(AmCharts.SVG_NS,"stop"),h=100*d/(c.length-1),0===d&&(h=0),g.setAttribute("offset",h+"%"),g.setAttribute("stop-color",c[d]),b.appendChild(g);e.parentNode.appendChild(b);c="#";AmCharts.baseHref&&!AmCharts.isIE&&
(c=window.location.href+c);e.setAttribute("fill","url("+c+f+")");a.grad=b},pattern:function(a,b,c){var d=a.node;isNaN(c)&&(c=1);var e=a.patternNode;e&&this.D.remove(e);var e=document.createElementNS(AmCharts.SVG_NS,"pattern"),f=AmCharts.getUniqueId(),g=b;b.url&&(g=b.url);var h=Number(b.width);isNaN(h)&&(h=4);var k=Number(b.height);isNaN(k)&&(k=4);h/=c;k/=c;c=b.x;isNaN(c)&&(c=0);var l=-Math.random()*Number(b.randomX);isNaN(l)||(c=l);l=b.y;isNaN(l)&&(l=0);var m=-Math.random()*Number(b.randomY);isNaN(m)||
(l=m);e.setAttribute("id",f);e.setAttribute("width",h);e.setAttribute("height",k);e.setAttribute("patternUnits","userSpaceOnUse");e.setAttribute("xlink:href",g);b.color&&(m=document.createElementNS(AmCharts.SVG_NS,"rect"),m.setAttributeNS(null,"height",h),m.setAttributeNS(null,"width",k),m.setAttributeNS(null,"fill",b.color),e.appendChild(m));this.D.image(g,0,0,h,k,e).translate(c,l);g="#";AmCharts.baseHref&&!AmCharts.isIE&&(g=window.location.href+g);d.setAttribute("fill","url("+g+f+")");a.patternNode=
e;d.parentNode.appendChild(e)},remove:function(a){a.clipPath&&this.D.remove(a.clipPath);a.grad&&this.D.remove(a.grad);a.patternNode&&this.D.remove(a.patternNode);this.D.remove(a.node)}});AmCharts.AmDSet=AmCharts.Class({construct:function(a){this.create("g")},attr:function(a){this.R.attr(this.node,a)},move:function(a,b){this.R.move(this.node,a,b)}});AmCharts.AmLegend=AmCharts.Class({construct:function(a){this.cname="AmLegend";this.createEvents("rollOverMarker","rollOverItem","rollOutMarker","rollOutItem","showItem","hideItem","clickMarker","rollOverItem","rollOutItem","clickLabel");this.position="bottom";this.borderColor=this.color="#000000";this.borderAlpha=0;this.markerLabelGap=5;this.verticalGap=10;this.align="left";this.horizontalGap=0;this.spacing=10;this.markerDisabledColor="#AAB3B3";this.markerType="square";this.markerSize=16;this.markerBorderThickness=
this.markerBorderAlpha=1;this.marginBottom=this.marginTop=0;this.marginLeft=this.marginRight=20;this.autoMargins=!0;this.valueWidth=50;this.switchable=!0;this.switchType="x";this.switchColor="#FFFFFF";this.rollOverColor="#CC0000";this.reversedOrder=!1;this.labelText="[[title]]";this.valueText="[[value]]";this.useMarkerColorForLabels=!1;this.rollOverGraphAlpha=1;this.textClickEnabled=!1;this.equalWidths=!0;this.dateFormat="DD-MM-YYYY";this.backgroundColor="#FFFFFF";this.backgroundAlpha=0;this.useGraphSettings=
!1;this.showEntries=!0;AmCharts.applyTheme(this,a,this.cname)},setData:function(a){this.legendData=a;this.invalidateSize()},invalidateSize:function(){this.destroy();this.entries=[];this.valueLabels=[];(AmCharts.ifArray(this.legendData)||AmCharts.ifArray(this.data))&&this.drawLegend()},drawLegend:function(){var a=this.chart,b=this.position,c=this.width,d=a.divRealWidth,e=a.divRealHeight,f=this.div,g=this.legendData;this.data&&(g=this.data);isNaN(this.fontSize)&&(this.fontSize=a.fontSize);if("right"==
b||"left"==b)this.maxColumns=1,this.autoMargins&&(this.marginLeft=this.marginRight=10);else if(this.autoMargins){this.marginRight=a.marginRight;this.marginLeft=a.marginLeft;var h=a.autoMarginOffset;"bottom"==b?(this.marginBottom=h,this.marginTop=0):(this.marginTop=h,this.marginBottom=0)}var k;void 0!==c?k=AmCharts.toCoordinate(c,d):"right"!=b&&"left"!=b&&(k=a.realWidth);"outside"==b?(k=f.offsetWidth,e=f.offsetHeight,f.clientHeight&&(k=f.clientWidth,e=f.clientHeight)):(isNaN(k)||(f.style.width=k+"px"),
f.className="amChartsLegend");this.divWidth=k;(b=this.container)?(b.container.innerHTML="",f.appendChild(b.container),b.setSize(k,e)):b=new AmCharts.AmDraw(f,k,e,a);this.container=b;this.lx=0;this.ly=8;e=this.markerSize;e>this.fontSize&&(this.ly=e/2-1);0<e&&(this.lx+=e+this.markerLabelGap);this.titleWidth=0;if(e=this.title)a=AmCharts.text(this.container,e,this.color,a.fontFamily,this.fontSize,"start",!0),a.translate(this.marginLeft,this.marginTop+this.verticalGap+this.ly+1),a=a.getBBox(),this.titleWidth=
a.width+15,this.titleHeight=a.height+6;this.index=this.maxLabelWidth=0;if(this.showEntries){for(a=0;a<g.length;a++)this.createEntry(g[a]);for(a=this.index=0;a<g.length;a++)this.createValue(g[a])}this.arrangeEntries();this.updateValues()},arrangeEntries:function(){var a=this.position,b=this.marginLeft+this.titleWidth,c=this.marginRight,d=this.marginTop,e=this.marginBottom,f=this.horizontalGap,g=this.div,h=this.divWidth,k=this.maxColumns,l=this.verticalGap,m=this.spacing,n=h-c-b,p=0,q=0,r=this.container;
this.set&&this.set.remove();var s=r.set();this.set=s;r=r.set();s.push(r);var w=this.entries,v,t;for(t=0;t<w.length;t++){v=w[t].getBBox();var u=v.width;u>p&&(p=u);v=v.height;v>q&&(q=v)}var u=q=0,x=f,E=0,A=0;for(t=0;t<w.length;t++){var z=w[t];this.reversedOrder&&(z=w[w.length-t-1]);v=z.getBBox();var H;this.equalWidths?H=f+u*(p+m+this.markerLabelGap):(H=x,x=x+v.width+f+m);v.height>A&&(A=v.height);H+v.width>n&&0<t&&0!==u&&(q++,u=0,H=f,x=H+v.width+f+m,E=E+A+l,A=0);z.translate(H,E);u++;!isNaN(k)&&u>=k&&
(u=0,q++,E=E+A+l,A=0);r.push(z)}v=r.getBBox();k=v.height+2*l-1;"left"==a||"right"==a?(h=v.width+2*f,g.style.width=h+b+c+"px"):h=h-b-c-1;c=AmCharts.polygon(this.container,[0,h,h,0],[0,0,k,k],this.backgroundColor,this.backgroundAlpha,1,this.borderColor,this.borderAlpha);s.push(c);s.translate(b,d);c.toBack();b=f;if("top"==a||"bottom"==a||"absolute"==a||"outside"==a)"center"==this.align?b=f+(h-v.width)/2:"right"==this.align&&(b=f+h-v.width);r.translate(b,l+1);this.titleHeight>k&&(k=this.titleHeight);
a=k+d+e+1;0>a&&(a=0);g.style.height=Math.round(a)+"px"},createEntry:function(a){if(!1!==a.visibleInLegend){var b=this.chart,c=a.markerType;c||(c=this.markerType);var d=a.color,e=a.alpha;a.legendKeyColor&&(d=a.legendKeyColor());a.legendKeyAlpha&&(e=a.legendKeyAlpha());var f;!0===a.hidden&&(f=d=this.markerDisabledColor);var g=a.pattern,h=a.customMarker;h||(h=this.customMarker);var k=this.container,l=this.markerSize,m=0,n=0,p=l/2;if(this.useGraphSettings)if(m=a.type,this.switchType=void 0,"line"==m||
"step"==m||"smoothedLine"==m||"ohlc"==m)g=k.set(),a.hidden||(d=a.lineColorR,f=a.bulletBorderColorR),n=AmCharts.line(k,[0,2*l],[l/2,l/2],d,a.lineAlpha,a.lineThickness,a.dashLength),g.push(n),a.bullet&&(a.hidden||(d=a.bulletColorR),n=AmCharts.bullet(k,a.bullet,a.bulletSize,d,a.bulletAlpha,a.bulletBorderThickness,f,a.bulletBorderAlpha))&&(n.translate(l+1,l/2),g.push(n)),p=0,m=l,n=l/3;else{var q;a.getGradRotation&&(q=a.getGradRotation());m=a.fillColorsR;!0===a.hidden&&(m=d);if(g=this.createMarker("rectangle",
m,a.fillAlphas,a.lineThickness,d,a.lineAlpha,q,g))p=l,g.translate(p,l/2);m=l}else h?(b.path&&(h=b.path+h),g=k.image(h,0,0,l,l)):(g=this.createMarker(c,d,e,void 0,void 0,void 0,void 0,g))&&g.translate(l/2,l/2);this.addListeners(g,a);k=k.set([g]);this.switchable&&a.switchable&&k.setAttr("cursor","pointer");(f=this.switchType)&&"none"!=f&&("x"==f?(q=this.createX(),q.translate(l/2,l/2)):q=this.createV(),q.dItem=a,!0!==a.hidden?"x"==f?q.hide():q.show():"x"!=f&&q.hide(),this.switchable||q.hide(),this.addListeners(q,
a),a.legendSwitch=q,k.push(q));f=this.color;a.showBalloon&&this.textClickEnabled&&void 0!==this.selectedColor&&(f=this.selectedColor);this.useMarkerColorForLabels&&(f=d);!0===a.hidden&&(f=this.markerDisabledColor);d=AmCharts.massReplace(this.labelText,{"[[title]]":a.title});q=this.fontSize;g&&l<=q&&g.translate(p,l/2+this.ly-q/2+(q+2-l)/2-n);var r;d&&(d=AmCharts.fixBrakes(d),a.legendTextReal=d,r=this.labelWidth,r=isNaN(r)?AmCharts.text(this.container,d,f,b.fontFamily,q,"start"):AmCharts.wrappedText(this.container,
d,f,b.fontFamily,q,"start",!1,r,0),r.translate(this.lx+m,this.ly),k.push(r),b=r.getBBox().width,this.maxLabelWidth<b&&(this.maxLabelWidth=b));this.entries[this.index]=k;a.legendEntry=this.entries[this.index];a.legendLabel=r;this.index++}},addListeners:function(a,b){var c=this;a&&a.mouseover(function(a){c.rollOverMarker(b,a)}).mouseout(function(a){c.rollOutMarker(b,a)}).click(function(a){c.clickMarker(b,a)})},rollOverMarker:function(a,b){this.switchable&&this.dispatch("rollOverMarker",a,b);this.dispatch("rollOverItem",
a,b)},rollOutMarker:function(a,b){this.switchable&&this.dispatch("rollOutMarker",a,b);this.dispatch("rollOutItem",a,b)},clickMarker:function(a,b){this.switchable&&(!0===a.hidden?this.dispatch("showItem",a,b):this.dispatch("hideItem",a,b));this.dispatch("clickMarker",a,b)},rollOverLabel:function(a,b){a.hidden||(this.textClickEnabled&&a.legendLabel&&a.legendLabel.attr({fill:this.rollOverColor}),this.dispatch("rollOverItem",a,b))},rollOutLabel:function(a,b){if(!a.hidden){if(this.textClickEnabled&&a.legendLabel){var c=
this.color;void 0!==this.selectedColor&&a.showBalloon&&(c=this.selectedColor);this.useMarkerColorForLabels&&(c=a.lineColor,void 0===c&&(c=a.color));a.legendLabel.attr({fill:c})}this.dispatch("rollOutItem",a,b)}},clickLabel:function(a,b){this.textClickEnabled?a.hidden||this.dispatch("clickLabel",a,b):this.switchable&&(!0===a.hidden?this.dispatch("showItem",a,b):this.dispatch("hideItem",a,b))},dispatch:function(a,b,c){this.fire(a,{type:a,dataItem:b,target:this,event:c,chart:this.chart})},createValue:function(a){var b=
this,c=b.fontSize;if(!1!==a.visibleInLegend){var d=b.maxLabelWidth;b.equalWidths||(b.valueAlign="left");"left"==b.valueAlign&&(d=a.legendEntry.getBBox().width);var e=d;if(b.valueText&&0<b.valueWidth){var f=b.color;b.useMarkerColorForValues&&(f=a.color,a.legendKeyColor&&(f=a.legendKeyColor()));!0===a.hidden&&(f=b.markerDisabledColor);var g=b.valueText,d=d+b.lx+b.markerLabelGap+b.valueWidth,h="end";"left"==b.valueAlign&&(d-=b.valueWidth,h="start");f=AmCharts.text(b.container,g,f,b.chart.fontFamily,
c,h);f.translate(d,b.ly);b.entries[b.index].push(f);e+=b.valueWidth+2*b.markerLabelGap;f.dItem=a;b.valueLabels.push(f)}b.index++;f=b.markerSize;f<c+7&&(f=c+7,AmCharts.VML&&(f+=3));c=b.container.rect(b.markerSize,0,e,f,0,0).attr({stroke:"none",fill:"#ffffff","fill-opacity":.005});c.dItem=a;b.entries[b.index-1].push(c);c.mouseover(function(c){b.rollOverLabel(a,c)}).mouseout(function(c){b.rollOutLabel(a,c)}).click(function(c){b.clickLabel(a,c)})}},createV:function(){var a=this.markerSize;return AmCharts.polygon(this.container,
[a/5,a/2,a-a/5,a/2],[a/3,a-a/5,a/5,a/1.7],this.switchColor)},createX:function(){var a=(this.markerSize-4)/2,b={stroke:this.switchColor,"stroke-width":3},c=this.container,d=AmCharts.line(c,[-a,a],[-a,a]).attr(b),a=AmCharts.line(c,[-a,a],[a,-a]).attr(b);return this.container.set([d,a])},createMarker:function(a,b,c,d,e,f,g,h){var k=this.markerSize,l=this.container;e||(e=this.markerBorderColor);e||(e=b);isNaN(d)&&(d=this.markerBorderThickness);isNaN(f)&&(f=this.markerBorderAlpha);return AmCharts.bullet(l,
a,k,b,c,d,e,f,k,g,h)},validateNow:function(){this.invalidateSize()},updateValues:function(){var a=this.valueLabels,b=this.chart,c,d=this.data;for(c=0;c<a.length;c++){var e=a[c],f=e.dItem,g=" ";if(d)f.value?e.text(f.value):e.text("");else{if(void 0!==f.type){var h=f.currentDataItem,k=this.periodValueText;f.legendPeriodValueText&&(k=f.legendPeriodValueText);h?(g=this.valueText,f.legendValueText&&(g=f.legendValueText),g=b.formatString(g,h)):k&&(g=b.formatPeriodString(k,f))}else g=b.formatString(this.valueText,
f);if(k=this.valueFunction)h&&(f=h),g=k(f,g);e.text(g)}}},renderFix:function(){if(!AmCharts.VML){var a=this.container;a&&a.renderFix()}},destroy:function(){this.div.innerHTML="";AmCharts.remove(this.set)}});AmCharts.formatMilliseconds=function(a,b){if(-1!=a.indexOf("fff")){var c=b.getMilliseconds(),d=String(c);10>c&&(d="00"+c);10<=c&&100>c&&(d="0"+c);a=a.replace(/fff/g,d)}return a};AmCharts.extractPeriod=function(a){var b=AmCharts.stripNumbers(a),c=1;b!=a&&(c=Number(a.slice(0,a.indexOf(b))));return{period:b,count:c}};
AmCharts.newDate=function(a,b){return date="fff"==b?AmCharts.useUTC?new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()):new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()):new Date(a)};
AmCharts.resetDateToMin=function(a,b,c,d){void 0===d&&(d=1);var e,f,g,h,k,l,m;AmCharts.useUTC?(e=a.getUTCFullYear(),f=a.getUTCMonth(),g=a.getUTCDate(),h=a.getUTCHours(),k=a.getUTCMinutes(),l=a.getUTCSeconds(),m=a.getUTCMilliseconds(),a=a.getUTCDay()):(e=a.getFullYear(),f=a.getMonth(),g=a.getDate(),h=a.getHours(),k=a.getMinutes(),l=a.getSeconds(),m=a.getMilliseconds(),a=a.getDay());switch(b){case "YYYY":e=Math.floor(e/c)*c;f=0;g=1;m=l=k=h=0;break;case "MM":f=Math.floor(f/c)*c;g=1;m=l=k=h=0;break;case "WW":0===
a&&0<d&&(a=7);g=g-a+d;m=l=k=h=0;break;case "DD":m=l=k=h=0;break;case "hh":h=Math.floor(h/c)*c;m=l=k=0;break;case "mm":k=Math.floor(k/c)*c;m=l=0;break;case "ss":l=Math.floor(l/c)*c;m=0;break;case "fff":m=Math.floor(m/c)*c}AmCharts.useUTC?(a=new Date,a.setUTCFullYear(e,f,g),a.setUTCHours(h,k,l,m)):a=new Date(e,f,g,h,k,l,m);return a};
AmCharts.getPeriodDuration=function(a,b){void 0===b&&(b=1);var c;switch(a){case "YYYY":c=316224E5;break;case "MM":c=26784E5;break;case "WW":c=6048E5;break;case "DD":c=864E5;break;case "hh":c=36E5;break;case "mm":c=6E4;break;case "ss":c=1E3;break;case "fff":c=1}return c*b};AmCharts.intervals={s:{nextInterval:"ss",contains:1E3},ss:{nextInterval:"mm",contains:60,count:0},mm:{nextInterval:"hh",contains:60,count:1},hh:{nextInterval:"DD",contains:24,count:2},DD:{nextInterval:"",contains:Infinity,count:3}};
AmCharts.getMaxInterval=function(a,b){var c=AmCharts.intervals;return a>=c[b].contains?(a=Math.round(a/c[b].contains),b=c[b].nextInterval,AmCharts.getMaxInterval(a,b)):"ss"==b?c[b].nextInterval:b};AmCharts.dayNames="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");AmCharts.shortDayNames="Sun Mon Tue Wed Thu Fri Sat".split(" ");AmCharts.monthNames="January February March April May June July August September October November December".split(" ");AmCharts.shortMonthNames="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");
AmCharts.getWeekNumber=function(a){a=new Date(a);a.setHours(0,0,0);a.setDate(a.getDate()+4-(a.getDay()||7));var b=new Date(a.getFullYear(),0,1);return Math.ceil(((a-b)/864E5+1)/7)};
AmCharts.stringToDate=function(a,b){var c={},d=[{pattern:"YYYY",period:"year"},{pattern:"YY",period:"year"},{pattern:"MM",period:"month"},{pattern:"M",period:"month"},{pattern:"DD",period:"date"},{pattern:"D",period:"date"},{pattern:"JJ",period:"hours"},{pattern:"J",period:"hours"},{pattern:"HH",period:"hours"},{pattern:"H",period:"hours"},{pattern:"KK",period:"hours"},{pattern:"K",period:"hours"},{pattern:"LL",period:"hours"},{pattern:"L",period:"hours"},{pattern:"NN",period:"minutes"},{pattern:"N",
period:"minutes"},{pattern:"SS",period:"seconds"},{pattern:"S",period:"seconds"},{pattern:"QQQ",period:"milliseconds"},{pattern:"QQ",period:"milliseconds"},{pattern:"Q",period:"milliseconds"}],e=!0,f=b.indexOf("AA");-1!=f&&(a.substr(f,2),"pm"==a.toLowerCase&&(e=!1));var f=b,g,h,k;for(k=0;k<d.length;k++)h=d[k].period,c[h]=0,"date"==h&&(c[h]=1);for(k=0;k<d.length;k++)if(g=d[k].pattern,h=d[k].period,-1!=b.indexOf(g)){var l=AmCharts.getFromDateString(g,a,f);b=b.replace(g,"");if("KK"==g||"K"==g||"LL"==
g||"L"==g)e||(l+=12);c[h]=l}AmCharts.useUTC?(d=new Date,d.setUTCFullYear(c.year,c.month,c.date),d.setUTCHours(c.hours,c.minutes,c.seconds,c.milliseconds)):d=new Date(c.year,c.month,c.date,c.hours,c.minutes,c.seconds,c.milliseconds);return d};AmCharts.getFromDateString=function(a,b,c){if(void 0!==b)return c=c.indexOf(a),b=b.substr(c,a.length),"0"==b.charAt(0)&&(b=b.substr(1,b.length-1)),b=Number(b),isNaN(b)&&(b=0),-1!=a.indexOf("M")&&b--,b};
AmCharts.formatDate=function(a,b,c){c||(c=AmCharts);var d,e,f,g,h,k,l,m=AmCharts.getWeekNumber(a);AmCharts.useUTC?(d=a.getUTCFullYear(),e=a.getUTCMonth(),f=a.getUTCDate(),g=a.getUTCDay(),h=a.getUTCHours(),k=a.getUTCMinutes(),l=a.getUTCSeconds(),a=a.getUTCMilliseconds()):(d=a.getFullYear(),e=a.getMonth(),f=a.getDate(),g=a.getDay(),h=a.getHours(),k=a.getMinutes(),l=a.getSeconds(),a=a.getMilliseconds());var n=String(d).substr(2,2),p=e+1;9>e&&(p="0"+p);var q="0"+g;b=b.replace(/W/g,m);m=h;24==m&&(m=0);
var r=m;10>r&&(r="0"+r);b=b.replace(/JJ/g,r);b=b.replace(/J/g,m);r=h;0===r&&(r=24,-1!=b.indexOf("H")&&f--);m=f;10>f&&(m="0"+f);var s=r;10>s&&(s="0"+s);b=b.replace(/HH/g,s);b=b.replace(/H/g,r);r=h;11<r&&(r-=12);s=r;10>s&&(s="0"+s);b=b.replace(/KK/g,s);b=b.replace(/K/g,r);r=h;0===r&&(r=12);12<r&&(r-=12);s=r;10>s&&(s="0"+s);b=b.replace(/LL/g,s);b=b.replace(/L/g,r);r=k;10>r&&(r="0"+r);b=b.replace(/NN/g,r);b=b.replace(/N/g,k);k=l;10>k&&(k="0"+k);b=b.replace(/SS/g,k);b=b.replace(/S/g,l);l=a;10>l&&(l="00"+
l);100>l&&(l="0"+l);k=a;10>k&&(k="00"+k);b=b.replace(/QQQ/g,l);b=b.replace(/QQ/g,k);b=b.replace(/Q/g,a);b=12>h?b.replace(/A/g,"am"):b.replace(/A/g,"pm");b=b.replace(/YYYY/g,"@IIII@");b=b.replace(/YY/g,"@II@");b=b.replace(/MMMM/g,"@XXXX@");b=b.replace(/MMM/g,"@XXX@");b=b.replace(/MM/g,"@XX@");b=b.replace(/M/g,"@X@");b=b.replace(/DD/g,"@RR@");b=b.replace(/D/g,"@R@");b=b.replace(/EEEE/g,"@PPPP@");b=b.replace(/EEE/g,"@PPP@");b=b.replace(/EE/g,"@PP@");b=b.replace(/E/g,"@P@");b=b.replace(/@IIII@/g,d);b=
b.replace(/@II@/g,n);b=b.replace(/@XXXX@/g,c.monthNames[e]);b=b.replace(/@XXX@/g,c.shortMonthNames[e]);b=b.replace(/@XX@/g,p);b=b.replace(/@X@/g,e+1);b=b.replace(/@RR@/g,m);b=b.replace(/@R@/g,f);b=b.replace(/@PPPP@/g,c.dayNames[g]);b=b.replace(/@PPP@/g,c.shortDayNames[g]);b=b.replace(/@PP@/g,q);return b=b.replace(/@P@/g,g)};
AmCharts.changeDate=function(a,b,c,d,e){var f=-1;void 0===d&&(d=!0);void 0===e&&(e=!1);!0===d&&(f=1);switch(b){case "YYYY":a.setFullYear(a.getFullYear()+c*f);d||e||a.setDate(a.getDate()+1);break;case "MM":b=a.getMonth();a.setMonth(a.getMonth()+c*f);a.getMonth()>b+c*f&&a.setDate(a.getDate()-1);d||e||a.setDate(a.getDate()+1);break;case "DD":a.setDate(a.getDate()+c*f);break;case "WW":a.setDate(a.getDate()+c*f*7);break;case "hh":a.setHours(a.getHours()+c*f);break;case "mm":a.setMinutes(a.getMinutes()+
c*f);break;case "ss":a.setSeconds(a.getSeconds()+c*f);break;case "fff":a.setMilliseconds(a.getMilliseconds()+c*f)}return a};
AmCharts.AmFunnelChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(g){this.type="funnel";AmCharts.AmFunnelChart.base.construct.call(this,g);this.cname="AmFunnelChart";this.startX=this.startY=0;this.baseWidth="100%";this.neckHeight=this.neckWidth=0;this.rotate=!1;this.valueRepresents="height";this.pullDistance=30;this.labelPosition="center";this.labelText="[[title]]: [[value]]";this.balloonText="[[title]]: [[value]]\n[[description]]";AmCharts.applyTheme(this,g,this.cname)},drawChart:function(){AmCharts.AmFunnelChart.base.drawChart.call(this);
var g=this.chartData;if(AmCharts.ifArray(g))if(0<this.realWidth&&0<this.realHeight){var d=Math.round(this.depth3D*Math.cos(this.angle*Math.PI/180)),a=Math.round(-this.depth3D*Math.sin(this.angle*Math.PI/180)),b=this.container,n=this.startDuration,e=this.rotate,u=this.updateWidth();this.realWidth=u;var f=this.updateHeight();this.realHeight=f;var l=AmCharts.toCoordinate,s=l(this.marginLeft,u),p=l(this.marginRight,u),c=l(this.marginTop,f)+this.getTitleHeight(),l=l(this.marginBottom,f);0<d&&0>a&&(this.neckHeight=
this.neckWidth=0,e?l-=a/2:c-=a/2);var p=u-s-p,E=AmCharts.toCoordinate(this.baseWidth,p),C=AmCharts.toCoordinate(this.neckWidth,p),F=f-l-c,y=AmCharts.toCoordinate(this.neckHeight,F),w=c+F-y;e&&(c=f-l,w=c-F+y);this.firstSliceY=c;AmCharts.VML&&(this.startAlpha=1);for(var q=p/2+s,D=(F-y)/((E-C)/2),H=1,z=E/2,E=(F-y)*(E+C)/2+C*y,G=c,I=0,y=0;y<g.length;y++){var h=g[y],m;if(!0!==h.hidden){var A=[],t=[],k;if("height"==this.valueRepresents)k=F*h.percents/100;else{var r=-E*h.percents/100/2,B=z;m=-1/(2*D);k=
Math.pow(B,2)-4*m*r;0>k&&(k=0);k=(Math.sqrt(k)-B)/(2*m);if(!e&&c>=w||e&&c<=w)k=2*-r/C;else if(!e&&c+k>w||e&&c-k<w)m=e?Math.round(k+(c-k-w)):Math.round(k-(c+k-w)),k=m/D,k=m+2*(-r-(B-k/2)*m)/C}r=z-k/D;B=!1;!e&&c+k>w||e&&c-k<w?(r=C/2,A.push(q-z,q+z,q+r,q+r,q-r,q-r),e?(m=k+(c-k-w),c<w&&(m=0),t.push(c,c,c-m,c-k,c-k,c-m,c)):(m=k-(c+k-w),c>w&&(m=0),t.push(c,c,c+m,c+k,c+k,c+m,c)),B=!0):(A.push(q-z,q+z,q+r,q-r),e?t.push(c,c,c-k,c-k):t.push(c,c,c+k,c+k));b.set();m=b.set();0<d&&0>a?(A=r/z,t=-1,e||(t=1),wedgeGraphics=
(new AmCharts.Cuboid(b,2*z,t*k,d,a*H,h.color,h.alpha,this.outlineThickness,this.outlineColor,this.outlineAlpha,90,0,!1,0,h.pattern,A)).set,wedgeGraphics.translate(q-z,c-a/2*H),H*=A):wedgeGraphics=AmCharts.polygon(b,A,t,h.color,h.alpha,this.outlineThickness,this.outlineColor,this.outlineAlpha);m.push(wedgeGraphics);this.graphsSet.push(m);e||m.toBack();h.wedge=m;h.index=y;if(A=this.gradientRatio){var t=[],v;for(v=0;v<A.length;v++)t.push(AmCharts.adjustLuminosity(h.color,A[v]));0<t.length&&wedgeGraphics.gradient("linearGradient",
t);h.pattern&&wedgeGraphics.pattern(h.pattern)}0<n&&(this.chartCreated||m.setAttr("opacity",this.startAlpha));this.addEventListeners(m,h);h.ty0=c-k/2;if(this.labelsEnabled&&this.labelText&&h.percents>=this.hideLabelsPercent){t=this.formatString(this.labelText,h);(A=this.labelFunction)&&(t=A(h,t));v=h.labelColor;v||(v=this.color);var A=this.labelPosition,x="left";"center"==A&&(x="middle");"left"==A&&(x="right");t=AmCharts.wrappedText(b,t,v,this.fontFamily,this.fontSize,x,!1,this.maxLabelWidth);t.node.style.pointerEvents=
"none";m.push(t);v=q;e?(x=c-k/2,h.ty0=x):(x=c+k/2,h.ty0=x,x<G+I+5&&(x=G+I+5),x>f-l&&(x=f-l));"right"==A&&(v=p+10+s,h.tx0=q+(z-k/2/D),B&&(h.tx0=q+r));"left"==A&&(h.tx0=q-(z-k/2/D),B&&(h.tx0=q-r),v=s);h.label=t;h.labelX=v;h.labelY=x;h.labelHeight=t.getBBox().height;t.translate(v,x);z=t.getBBox();G=AmCharts.rect(b,z.width+5,z.height+5,"#ffffff",.005);G.translate(v+z.x,x+z.y);m.push(G);h.hitRect=G;I=t.getBBox().height;G=x}(0===h.alpha||0<n&&!this.chartCreated)&&m.hide();c=e?c-k:c+k;z=r;h.startX=AmCharts.toCoordinate(this.startX,
u);h.startY=AmCharts.toCoordinate(this.startY,f);h.pullX=AmCharts.toCoordinate(this.pullDistance,u);h.pullY=0;h.balloonX=q;h.balloonY=h.ty0}}this.arrangeLabels();this.initialStart();(g=this.legend)&&g.invalidateSize()}else this.cleanChart();this.dispDUpd();this.chartCreated=!0},arrangeLabels:function(){var g=this.rotate,d;d=g?0:this.realHeight;for(var a=0,b=this.chartData,n=b.length,e,u=0;u<n;u++){e=b[n-u-1];var f=e.label,l=e.labelY,s=e.labelX,p=e.labelHeight,c=l;g?d+a+5>l&&(c=d+a+5):l+p+5>d&&(c=
d-5-p);d=c;a=p;if(f){f.translate(s,c);var E=f.getBBox()}e.hitRect.translate(s+E.x,c+E.y);e.labelY=c;e.tx=s;e.ty=c;e.tx2=s}"center"!=this.labelPosition&&this.drawTicks()}});AmCharts.Cuboid=AmCharts.Class({construct:function(g,d,a,b,n,e,u,f,l,s,p,c,E,C,F,y){this.set=g.set();this.container=g;this.h=Math.round(a);this.w=Math.round(d);this.dx=b;this.dy=n;this.colors=e;this.alpha=u;this.bwidth=f;this.bcolor=l;this.balpha=s;this.dashLength=C;this.topRadius=y;this.pattern=F;(this.rotate=E)?0>d&&0===p&&(p=180):0>a&&270==p&&(p=90);this.gradientRotation=p;0===b&&0===n&&(this.cornerRadius=c);this.draw()},draw:function(){var g=this.set;g.clear();var d=this.container,a=this.w,b=
this.h,n=this.dx,e=this.dy,u=this.colors,f=this.alpha,l=this.bwidth,s=this.bcolor,p=this.balpha,c=this.gradientRotation,E=this.cornerRadius,C=this.dashLength,F=this.pattern,y=this.topRadius,w=u,q=u;"object"==typeof u&&(w=u[0],q=u[u.length-1]);var D,H,z,G,I,h,m,A,t,k=f;F&&(f=0);var r,B,v,x,J=this.rotate;if(0<Math.abs(n)||0<Math.abs(e))if(isNaN(y))m=q,q=AmCharts.adjustLuminosity(w,-.2),q=AmCharts.adjustLuminosity(w,-.2),D=AmCharts.polygon(d,[0,n,a+n,a,0],[0,e,e,0,0],q,f,1,s,0,c),0<p&&(t=AmCharts.line(d,
[0,n,a+n],[0,e,e],s,p,l,C)),H=AmCharts.polygon(d,[0,0,a,a,0],[0,b,b,0,0],q,f,1,s,0,c),H.translate(n,e),0<p&&(z=AmCharts.line(d,[n,n],[e,e+b],s,p,l,C)),G=AmCharts.polygon(d,[0,0,n,n,0],[0,b,b+e,e,0],q,f,1,s,0,c),I=AmCharts.polygon(d,[a,a,a+n,a+n,a],[0,b,b+e,e,0],q,f,1,s,0,c),0<p&&(h=AmCharts.line(d,[a,a+n,a+n,a],[0,e,b+e,b],s,p,l,C)),q=AmCharts.adjustLuminosity(m,.2),m=AmCharts.polygon(d,[0,n,a+n,a,0],[b,b+e,b+e,b,b],q,f,1,s,0,c),0<p&&(A=AmCharts.line(d,[0,n,a+n],[b,b+e,b+e],s,p,l,C));else{var K,L,
M;J?(K=b/2,q=n/2,M=b/2,L=a+n/2,B=Math.abs(b/2),r=Math.abs(n/2)):(q=a/2,K=e/2,L=a/2,M=b+e/2+1,r=Math.abs(a/2),B=Math.abs(e/2));v=r*y;x=B*y;.1<r&&.1<r&&(D=AmCharts.circle(d,r,w,f,l,s,p,!1,B),D.translate(q,K));.1<v&&.1<v&&(m=AmCharts.circle(d,v,AmCharts.adjustLuminosity(w,.5),f,l,s,p,!1,x),m.translate(L,M))}f=k;1>Math.abs(b)&&(b=0);1>Math.abs(a)&&(a=0);!isNaN(y)&&(0<Math.abs(n)||0<Math.abs(e))?(u=[w],u={fill:u,stroke:s,"stroke-width":l,"stroke-opacity":p,"fill-opacity":f},J?(f="M0,0 L"+a+","+(b/2-b/
2*y),l=" B",0<a&&(l=" A"),AmCharts.VML?(f+=l+Math.round(a-v)+","+Math.round(b/2-x)+","+Math.round(a+v)+","+Math.round(b/2+x)+","+a+",0,"+a+","+b,f=f+(" L0,"+b)+(l+Math.round(-r)+","+Math.round(b/2-B)+","+Math.round(r)+","+Math.round(b/2+B)+",0,"+b+",0,0")):(f+="A"+v+","+x+",0,0,0,"+a+","+(b-b/2*(1-y))+"L0,"+b,f+="A"+r+","+B+",0,0,1,0,0"),r=90):(l=a/2-a/2*y,f="M0,0 L"+l+","+b,AmCharts.VML?(f="M0,0 L"+l+","+b,l=" B",0>b&&(l=" A"),f+=l+Math.round(a/2-v)+","+Math.round(b-x)+","+Math.round(a/2+v)+","+
Math.round(b+x)+",0,"+b+","+a+","+b,f+=" L"+a+",0",f+=l+Math.round(a/2+r)+","+Math.round(B)+","+Math.round(a/2-r)+","+Math.round(-B)+","+a+",0,0,0"):(f+="A"+v+","+x+",0,0,0,"+(a-a/2*(1-y))+","+b+"L"+a+",0",f+="A"+r+","+B+",0,0,1,0,0"),r=180),d=d.path(f).attr(u),d.gradient("linearGradient",[w,AmCharts.adjustLuminosity(w,-.3),AmCharts.adjustLuminosity(w,-.3),w],r),J?d.translate(n/2,0):d.translate(0,e/2)):d=0===b?AmCharts.line(d,[0,a],[0,0],s,p,l,C):0===a?AmCharts.line(d,[0,0],[0,b],s,p,l,C):0<E?AmCharts.rect(d,
a,b,u,f,l,s,p,E,c,C):AmCharts.polygon(d,[0,0,a,a,0],[0,b,b,0,0],u,f,l,s,p,c,!1,C);a=isNaN(y)?0>b?[D,t,H,z,G,I,h,m,A,d]:[m,A,H,z,G,I,D,t,h,d]:J?0<a?[D,d,m]:[m,d,D]:0>b?[D,d,m]:[m,d,D];for(b=0;b<a.length;b++)(n=a[b])&&g.push(n);F&&d.pattern(F)},width:function(g){this.w=Math.round(g);this.draw()},height:function(g){this.h=Math.round(g);this.draw()},animateHeight:function(g,d){var a=this;a.easing=d;a.totalFrames=Math.round(1E3*g/AmCharts.updateRate);a.rh=a.h;a.frame=0;a.height(1);setTimeout(function(){a.updateHeight.call(a)},
AmCharts.updateRate)},updateHeight:function(){var g=this;g.frame++;var d=g.totalFrames;g.frame<=d&&(d=g.easing(0,g.frame,1,g.rh-1,d),g.height(d),setTimeout(function(){g.updateHeight.call(g)},AmCharts.updateRate))},animateWidth:function(g,d){var a=this;a.easing=d;a.totalFrames=Math.round(1E3*g/AmCharts.updateRate);a.rw=a.w;a.frame=0;a.width(1);setTimeout(function(){a.updateWidth.call(a)},AmCharts.updateRate)},updateWidth:function(){var g=this;g.frame++;var d=g.totalFrames;g.frame<=d&&(d=g.easing(0,
g.frame,1,g.rw-1,d),g.width(d),setTimeout(function(){g.updateWidth.call(g)},AmCharts.updateRate))}});
AmCharts.GaugeAxis=AmCharts.Class({construct:function(a){this.cname="GaugeAxis";this.radius="95%";this.startAngle=-120;this.endAngle=120;this.startValue=0;this.endValue=200;this.gridCount=5;this.tickLength=10;this.minorTickLength=5;this.tickColor="#555555";this.labelFrequency=this.tickThickness=this.tickAlpha=1;this.inside=!0;this.labelOffset=10;this.showLastLabel=this.showFirstLabel=!0;this.axisThickness=1;this.axisColor="#000000";this.axisAlpha=1;this.gridInside=!0;this.topTextYOffset=0;this.topTextBold=
!0;this.bottomTextYOffset=0;this.bottomTextBold=!0;this.centerY=this.centerX="0%";this.bandOutlineAlpha=this.bandOutlineThickness=0;this.bandOutlineColor="#000000";this.bandAlpha=1;AmCharts.applyTheme(this,a,"GaugeAxis")},value2angle:function(a){return(a-this.startValue)/(this.endValue-this.startValue)*(this.endAngle-this.startAngle)+this.startAngle},setTopText:function(a){if(void 0!==a){this.topText=a;var b=this.chart;if(this.axisCreated){this.topTF&&this.topTF.remove();var c=this.topTextFontSize;
c||(c=b.fontSize);var d=this.topTextColor;d||(d=b.color);a=AmCharts.text(b.container,a,d,b.fontFamily,c,void 0,this.topTextBold);a.translate(this.centerXReal,this.centerYReal-this.radiusReal/2+this.topTextYOffset);this.chart.graphsSet.push(a);this.topTF=a}}},setBottomText:function(a){if(void 0!==a){this.bottomText=a;var b=this.chart;if(this.axisCreated){this.bottomTF&&this.bottomTF.remove();var c=this.bottomTextFontSize;c||(c=b.fontSize);var d=this.bottomTextColor;d||(d=b.color);a=AmCharts.text(b.container,
a,d,b.fontFamily,c,void 0,this.bottomTextBold);a.translate(this.centerXReal,this.centerYReal+this.radiusReal/2+this.bottomTextYOffset);this.bottomTF=a;this.chart.graphsSet.push(a)}}},draw:function(){var a=this.chart,b=a.graphsSet,c=this.startValue,d=this.endValue,f=this.valueInterval;isNaN(f)&&(f=(d-c)/this.gridCount);var h=this.minorTickInterval;isNaN(h)&&(h=f/5);var p=this.startAngle,k=this.endAngle,e=this.tickLength,l=(d-c)/f+1,g=(k-p)/(l-1);this.singleValueAngle=d=g/f;var m=a.container,q=this.tickColor,
u=this.tickAlpha,C=this.tickThickness,D=f/h,G=g/D,h=this.minorTickLength,I=this.labelFrequency,s=this.radiusReal;this.inside||(s-=15);var y=a.centerX+AmCharts.toCoordinate(this.centerX,a.realWidth),z=a.centerY+AmCharts.toCoordinate(this.centerY,a.realHeight);this.centerXReal=y;this.centerYReal=z;var J={fill:this.axisColor,"fill-opacity":this.axisAlpha,"stroke-width":0,"stroke-opacity":0},n,A;this.gridInside?A=n=s:(n=s-e,A=n+h);var r=this.axisThickness/2,k=AmCharts.wedge(m,y,z,p,k-p,n+r,n+r,n-r,0,
J);b.push(k);k=AmCharts.doNothing;AmCharts.isModern||(k=Math.round);J=AmCharts.getDecimals(f);for(n=0;n<l;n++){var v=c+n*f,r=p+n*g,w=k(y+s*Math.sin(r/180*Math.PI)),B=k(z-s*Math.cos(r/180*Math.PI)),x=k(y+(s-e)*Math.sin(r/180*Math.PI)),t=k(z-(s-e)*Math.cos(r/180*Math.PI)),w=AmCharts.line(m,[w,x],[B,t],q,u,C,0,!1,!1,!0);b.push(w);w=-1;x=this.labelOffset;this.inside||(x=-x-e,w=1);var B=Math.sin(r/180*Math.PI),t=Math.cos(r/180*Math.PI),B=y+(s-e-x)*B,x=z-(s-e-x)*t,E=this.fontSize;isNaN(E)&&(E=a.fontSize);
var t=Math.sin((r-90)/180*Math.PI),K=Math.cos((r-90)/180*Math.PI);if(0<I&&n/I==Math.round(n/I)&&(this.showLastLabel||n!=l-1)&&(this.showFirstLabel||0!==n)){var F;F=this.usePrefixes?AmCharts.addPrefix(v,a.prefixesOfBigNumbers,a.prefixesOfSmallNumbers,a.nf,!0):AmCharts.formatNumber(v,a.nf,J);var H=this.unit;H&&(F="left"==this.unitPosition?H+F:F+H);(H=this.labelFunction)&&(F=H(v));v=AmCharts.text(m,F,a.color,a.fontFamily,E);E=v.getBBox();v.translate(B+w*E.width/2*K,x+w*E.height/2*t);b.push(v)}if(n<l-
1)for(v=1;v<D;v++)t=r+G*v,w=k(y+A*Math.sin(t/180*Math.PI)),B=k(z-A*Math.cos(t/180*Math.PI)),x=k(y+(A-h)*Math.sin(t/180*Math.PI)),t=k(z-(A-h)*Math.cos(t/180*Math.PI)),w=AmCharts.line(m,[w,x],[B,t],q,u,C,0,!1,!1,!0),b.push(w)}if(b=this.bands)for(c=0;c<b.length;c++)if(f=b[c])q=f.startValue,u=f.endValue,e=AmCharts.toCoordinate(f.radius,s),isNaN(e)&&(e=A),l=AmCharts.toCoordinate(f.innerRadius,s),isNaN(l)&&(l=e-h),g=p+d*(q-this.startValue),u=d*(u-q),C=f.outlineColor,void 0==C&&(C=this.bandOutlineColor),
D=f.outlineThickness,isNaN(D)&&(D=this.bandOutlineThickness),G=f.outlineAlpha,isNaN(G)&&(G=this.bandOutlineAlpha),q=f.alpha,isNaN(q)&&(q=this.bandAlpha),e=AmCharts.wedge(m,y,z,g,u,e,e,l,0,{fill:f.color,stroke:C,"stroke-width":D,"stroke-opacity":G}),e.setAttr("opacity",q),a.gridSet.push(e),this.addEventListeners(e,f);this.axisCreated=!0;this.setTopText(this.topText);this.setBottomText(this.bottomText);a=a.graphsSet.getBBox();this.width=a.width;this.height=a.height},addEventListeners:function(a,b){var c=
this.chart;a.mouseover(function(a){c.showBalloon(b.balloonText,b.color,!0)}).mouseout(function(a){c.hideBalloon()})}});AmCharts.GaugeArrow=AmCharts.Class({construct:function(a){this.cname="GaugeArrow";this.color="#000000";this.nailAlpha=this.alpha=1;this.startWidth=this.nailRadius=8;this.endWidth=0;this.borderAlpha=1;this.radius="90%";this.nailBorderAlpha=this.innerRadius=0;this.nailBorderThickness=1;this.frame=0;AmCharts.applyTheme(this,a,"GaugeArrow")},setValue:function(a){var b=this.chart;b?b.setValue?b.setValue(this,a):this.previousValue=this.value=a:this.previousValue=this.value=a}});
AmCharts.GaugeBand=AmCharts.Class({construct:function(){this.cname="GaugeBand"}});AmCharts.AmAngularGauge=AmCharts.Class({inherits:AmCharts.AmChart,construct:function(a){this.cname="AmAngularGauge";AmCharts.AmAngularGauge.base.construct.call(this,a);this.theme=a;this.type="gauge";this.minRadius=this.marginRight=this.marginBottom=this.marginTop=this.marginLeft=10;this.faceColor="#FAFAFA";this.faceAlpha=0;this.faceBorderWidth=1;this.faceBorderColor="#555555";this.faceBorderAlpha=0;this.arrows=[];this.axes=[];this.startDuration=1;this.startEffect="easeOutSine";this.adjustSize=!0;
this.extraHeight=this.extraWidth=0;AmCharts.applyTheme(this,a,this.cname)},addAxis:function(a){this.axes.push(a)},formatString:function(a,b){return a=AmCharts.formatValue(a,b,["value"],this.nf,"",this.usePrefixes,this.prefixesOfSmallNumbers,this.prefixesOfBigNumbers)},initChart:function(){AmCharts.AmAngularGauge.base.initChart.call(this);var a;0===this.axes.length&&(a=new AmCharts.GaugeAxis(this.theme),this.addAxis(a));var b;for(b=0;b<this.axes.length;b++)a=this.axes[b],a=AmCharts.processObject(a,
AmCharts.GaugeAxis,this.theme),a.chart=this,this.axes[b]=a;var c=this.arrows;for(b=0;b<c.length;b++){a=c[b];a=AmCharts.processObject(a,AmCharts.GaugeArrow,this.theme);a.chart=this;c[b]=a;var d=a.axis;AmCharts.isString(d)&&(a.axis=AmCharts.getObjById(this.axes,d));a.axis||(a.axis=this.axes[0]);isNaN(a.value)&&a.setValue(a.axis.startValue);isNaN(a.previousValue)&&(a.previousValue=a.axis.startValue)}this.setLegendData(c);this.drawChart();this.totalFrames=1E3*this.startDuration/AmCharts.updateRate},drawChart:function(){AmCharts.AmAngularGauge.base.drawChart.call(this);
var a=this.container,b=this.updateWidth();this.realWidth=b;var c=this.updateHeight();this.realHeight=c;var d=AmCharts.toCoordinate,f=d(this.marginLeft,b),h=d(this.marginRight,b),p=d(this.marginTop,c)+this.getTitleHeight(),k=d(this.marginBottom,c),e=d(this.radius,b,c),d=b-f-h,l=c-p-k+this.extraHeight;e||(e=Math.min(d,l)/2);e<this.minRadius&&(e=this.minRadius);this.radiusReal=e;this.centerX=(b-f-h)/2+f;this.centerY=(c-p-k)/2+p+this.extraHeight/2;isNaN(this.gaugeX)||(this.centerX=this.gaugeX);isNaN(this.gaugeY)||
(this.centerY=this.gaugeY);var b=this.faceAlpha,c=this.faceBorderAlpha,g;if(0<b||0<c)g=AmCharts.circle(a,e,this.faceColor,b,this.faceBorderWidth,this.faceBorderColor,c,!1),g.translate(this.centerX,this.centerY),g.toBack(),(a=this.facePattern)&&g.pattern(a);for(b=e=a=0;b<this.axes.length;b++)c=this.axes[b],f=c.radius,c.radiusReal=AmCharts.toCoordinate(f,this.radiusReal),c.draw(),h=1,-1!==String(f).indexOf("%")&&(h=1+(100-Number(f.substr(0,f.length-1)))/100),c.width*h>a&&(a=c.width*h),c.height*h>e&&
(e=c.height*h);(b=this.legend)&&b.invalidateSize();if(this.adjustSize&&!this.chartCreated){g&&(g=g.getBBox(),g.width>a&&(a=g.width),g.height>e&&(e=g.height));g=0;if(l>e||d>a)g=Math.min(l-e,d-a);0<g&&(this.extraHeight=l-e,this.chartCreated=!0,this.validateNow())}this.dispDUpd();this.chartCreated=!0},validateSize:function(){this.extraHeight=this.extraWidth=0;this.chartCreated=!1;AmCharts.AmAngularGauge.base.validateSize.call(this)},addArrow:function(a){this.arrows.push(a)},removeArrow:function(a){AmCharts.removeFromArray(this.arrows,
a);this.validateNow()},removeAxis:function(a){AmCharts.removeFromArray(this.axes,a);this.validateNow()},drawArrow:function(a,b){a.set&&a.set.remove();var c=this.container;a.set=c.set();if(!a.hidden){var d=a.axis,f=d.radiusReal,h=d.centerXReal,p=d.centerYReal,k=a.startWidth,e=a.endWidth,l=AmCharts.toCoordinate(a.innerRadius,d.radiusReal),g=AmCharts.toCoordinate(a.radius,d.radiusReal);d.inside||(g-=15);var m=a.nailColor;m||(m=a.color);var q=a.nailColor;q||(q=a.color);m=AmCharts.circle(c,a.nailRadius,
m,a.nailAlpha,a.nailBorderThickness,m,a.nailBorderAlpha);a.set.push(m);m.translate(h,p);isNaN(g)&&(g=f-d.tickLength);var d=Math.sin(b/180*Math.PI),f=Math.cos(b/180*Math.PI),m=Math.sin((b+90)/180*Math.PI),u=Math.cos((b+90)/180*Math.PI),c=AmCharts.polygon(c,[h-k/2*m+l*d,h+g*d-e/2*m,h+g*d+e/2*m,h+k/2*m+l*d],[p+k/2*u-l*f,p-g*f+e/2*u,p-g*f-e/2*u,p-k/2*u-l*f],a.color,a.alpha,1,q,a.borderAlpha,void 0,!0);a.set.push(c);this.graphsSet.push(a.set)}},setValue:function(a,b){a.axis&&a.axis.value2angle&&(a.axis.value2angle(b),
a.frame=0,a.previousValue=a.value);a.value=b;var c=this.legend;c&&c.updateValues()},handleLegendEvent:function(a){var b=a.type;a=a.dataItem;if(!this.legend.data&&a)switch(b){case "hideItem":this.hideArrow(a);break;case "showItem":this.showArrow(a)}},hideArrow:function(a){a.set.hide();a.hidden=!0},showArrow:function(a){a.set.show();a.hidden=!1},updateAnimations:function(){AmCharts.AmAngularGauge.base.updateAnimations.call(this);for(var a=this.arrows.length,b,c=0;c<a;c++){b=this.arrows[c];var d;b.frame>=
this.totalFrames?d=b.value:(b.frame++,b.clockWiseOnly&&b.value<b.previousValue&&(d=b.axis,b.previousValue-=d.endValue-d.startValue),d=AmCharts.getEffect(this.startEffect),d=AmCharts[d](0,b.frame,b.previousValue,b.value-b.previousValue,this.totalFrames),isNaN(d)&&(d=b.value));d=b.axis.value2angle(d);this.drawArrow(b,d)}}});
AmCharts.AmPieChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(e){this.type="pie";AmCharts.AmPieChart.base.construct.call(this,e);this.cname="AmPieChart";this.pieBrightnessStep=30;this.minRadius=10;this.depth3D=0;this.startAngle=90;this.angle=this.innerRadius=0;this.startRadius="500%";this.pullOutRadius="20%";this.labelRadius=20;this.labelText="[[title]]: [[percents]]%";this.balloonText="[[title]]: [[percents]]% ([[value]])\n[[description]]";this.previousScale=1;AmCharts.applyTheme(this,
e,this.cname)},drawChart:function(){AmCharts.AmPieChart.base.drawChart.call(this);var e=this.chartData;if(AmCharts.ifArray(e)){if(0<this.realWidth&&0<this.realHeight){AmCharts.VML&&(this.startAlpha=1);var f=this.startDuration,c=this.container,b=this.updateWidth();this.realWidth=b;var h=this.updateHeight();this.realHeight=h;var d=AmCharts.toCoordinate,k=d(this.marginLeft,b),a=d(this.marginRight,b),t=d(this.marginTop,h)+this.getTitleHeight(),m=d(this.marginBottom,h),w,x,g,v=AmCharts.toNumber(this.labelRadius),
q=this.measureMaxLabel();q>this.maxLabelWidth&&(q=this.maxLabelWidth);this.labelText&&this.labelsEnabled||(v=q=0);w=void 0===this.pieX?(b-k-a)/2+k:d(this.pieX,this.realWidth);x=void 0===this.pieY?(h-t-m)/2+t:d(this.pieY,h);g=d(this.radius,b,h);g||(b=0<=v?b-k-a-2*q:b-k-a,h=h-t-m,g=Math.min(b,h),h<b&&(g/=1-this.angle/90,g>b&&(g=b)),h=AmCharts.toCoordinate(this.pullOutRadius,g),g=(0<=v?g-1.8*(v+h):g-1.8*h)/2);g<this.minRadius&&(g=this.minRadius);h=d(this.pullOutRadius,g);t=AmCharts.toCoordinate(this.startRadius,
g);d=d(this.innerRadius,g);d>=g&&(d=g-1);m=AmCharts.fitToBounds(this.startAngle,0,360);0<this.depth3D&&(m=270<=m?270:90);m-=90;b=g-g*this.angle/90;for(k=0;k<e.length;k++)if(a=e[k],!0!==a.hidden&&0<a.percents){var n=360*a.percents/100,q=Math.sin((m+n/2)/180*Math.PI),y=-Math.cos((m+n/2)/180*Math.PI)*(b/g),p=this.outlineColor;p||(p=a.color);var z=this.alpha;isNaN(a.alpha)||(z=a.alpha);p={fill:a.color,stroke:p,"stroke-width":this.outlineThickness,"stroke-opacity":this.outlineAlpha,"fill-opacity":z};a.url&&
(p.cursor="pointer");p=AmCharts.wedge(c,w,x,m,n,g,b,d,this.depth3D,p,this.gradientRatio,a.pattern);this.addEventListeners(p,a);a.startAngle=m;e[k].wedge=p;0<f&&(this.chartCreated||p.setAttr("opacity",this.startAlpha));a.ix=q;a.iy=y;a.wedge=p;a.index=k;if(this.labelsEnabled&&this.labelText&&a.percents>=this.hideLabelsPercent){var l=m+n/2;360<l&&(l-=360);var r=v;isNaN(a.labelRadius)||(r=a.labelRadius);var n=w+q*(g+r),z=x+y*(g+r),A,u=0;if(0<=r){var B;90>=l&&0<=l?(B=0,A="start",u=8):90<=l&&180>l?(B=1,
A="start",u=8):180<=l&&270>l?(B=2,A="end",u=-8):270<=l&&360>l&&(B=3,A="end",u=-8);a.labelQuarter=B}else A="middle";var l=this.formatString(this.labelText,a),s=this.labelFunction;s&&(l=s(a,l));s=a.labelColor;s||(s=this.color);l=AmCharts.wrappedText(c,l,s,this.fontFamily,this.fontSize,A,!1,this.maxLabelWidth);l.translate(n+1.5*u,z);l.node.style.pointerEvents="none";a.tx=n+1.5*u;a.ty=z;0<=r?(r=l.getBBox(),s=AmCharts.rect(c,r.width+5,r.height+5,"#FFFFFF",.005),s.translate(n+1.5*u+r.x,z+r.y),a.hitRect=
s,p.push(l),p.push(s)):this.freeLabelsSet.push(l);a.label=l;a.tx=n;a.tx2=n+u;a.tx0=w+q*g;a.ty0=x+y*g}n=d+(g-d)/2;a.pulled&&(n+=this.pullOutRadiusReal);a.balloonX=q*n+w;a.balloonY=y*n+x;a.startX=Math.round(q*t);a.startY=Math.round(y*t);a.pullX=Math.round(q*h);a.pullY=Math.round(y*h);this.graphsSet.push(p);(0===a.alpha||0<f&&!this.chartCreated)&&p.hide();m+=360*a.percents/100}0<v&&!this.labelRadiusField&&this.arrangeLabels();this.pieXReal=w;this.pieYReal=x;this.radiusReal=g;this.innerRadiusReal=d;0<
v&&this.drawTicks();this.initialStart();this.setDepths()}(e=this.legend)&&e.invalidateSize()}else this.cleanChart();this.dispDUpd();this.chartCreated=!0},setDepths:function(){var e=this.chartData,f;for(f=0;f<e.length;f++){var c=e[f],b=c.wedge,c=c.startAngle;0<=c&&180>c?b.toFront():180<=c&&b.toBack()}},arrangeLabels:function(){var e=this.chartData,f=e.length,c,b;for(b=f-1;0<=b;b--)c=e[b],0!==c.labelQuarter||c.hidden||this.checkOverlapping(b,c,0,!0,0);for(b=0;b<f;b++)c=e[b],1!=c.labelQuarter||c.hidden||
this.checkOverlapping(b,c,1,!1,0);for(b=f-1;0<=b;b--)c=e[b],2!=c.labelQuarter||c.hidden||this.checkOverlapping(b,c,2,!0,0);for(b=0;b<f;b++)c=e[b],3!=c.labelQuarter||c.hidden||this.checkOverlapping(b,c,3,!1,0)},checkOverlapping:function(e,f,c,b,h){var d,k,a=this.chartData,t=a.length,m=f.label;if(m){if(!0===b)for(k=e+1;k<t;k++)a[k].labelQuarter==c&&(d=this.checkOverlappingReal(f,a[k],c))&&(k=t);else for(k=e-1;0<=k;k--)a[k].labelQuarter==c&&(d=this.checkOverlappingReal(f,a[k],c))&&(k=0);!0===d&&100>
h&&(d=f.ty+3*f.iy,f.ty=d,m.translate(f.tx2,d),f.hitRect&&(m=m.getBBox(),f.hitRect.translate(f.tx2+m.x,d+m.y)),this.checkOverlapping(e,f,c,b,h+1))}},checkOverlappingReal:function(e,f,c){var b=!1,h=e.label,d=f.label;e.labelQuarter!=c||e.hidden||f.hidden||!d||(h=h.getBBox(),c={},c.width=h.width,c.height=h.height,c.y=e.ty,c.x=e.tx,e=d.getBBox(),d={},d.width=e.width,d.height=e.height,d.y=f.ty,d.x=f.tx,AmCharts.hitTest(c,d)&&(b=!0));return b}});
AmCharts.AmRadarChart=AmCharts.Class({inherits:AmCharts.AmCoordinateChart,construct:function(a){this.type="radar";AmCharts.AmRadarChart.base.construct.call(this,a);this.cname="AmRadarChart";this.marginRight=this.marginBottom=this.marginTop=this.marginLeft=0;this.radius="35%";AmCharts.applyTheme(this,a,this.cname)},initChart:function(){AmCharts.AmRadarChart.base.initChart.call(this);this.dataChanged&&(this.updateData(),this.dataChanged=!1,this.dispatchDataUpdated=!0);this.drawChart()},updateData:function(){this.parseData();
var a=this.graphs,b;for(b=0;b<a.length;b++)a[b].data=this.chartData},updateGraphs:function(){var a=this.graphs,b;for(b=0;b<a.length;b++){var c=a[b];c.index=b;c.width=this.realRadius;c.height=this.realRadius;c.x=this.marginLeftReal;c.y=this.marginTopReal}},parseData:function(){AmCharts.AmRadarChart.base.parseData.call(this);this.parseSerialData()},updateValueAxes:function(){var a=this.valueAxes,b;for(b=0;b<a.length;b++){var c=a[b];c.axisRenderer=AmCharts.RadAxis;c.guideFillRenderer=AmCharts.RadarFill;
c.axisItemRenderer=AmCharts.RadItem;c.autoGridCount=!1;c.x=this.marginLeftReal;c.y=this.marginTopReal;c.width=this.realRadius;c.height=this.realRadius}},drawChart:function(){AmCharts.AmRadarChart.base.drawChart.call(this);var a=this.updateWidth(),b=this.updateHeight(),c=this.marginTop+this.getTitleHeight(),d=this.marginLeft,b=b-c-this.marginBottom;this.marginLeftReal=d+(a-d-this.marginRight)/2;this.marginTopReal=c+b/2;this.realRadius=AmCharts.toCoordinate(this.radius,a,b);this.updateValueAxes();this.updateGraphs();
a=this.chartData;if(AmCharts.ifArray(a)){if(0<this.realWidth&&0<this.realHeight){a=a.length-1;d=this.valueAxes;for(c=0;c<d.length;c++)d[c].zoom(0,a);d=this.graphs;for(c=0;c<d.length;c++)d[c].zoom(0,a);(a=this.legend)&&a.invalidateSize()}}else this.cleanChart();this.dispDUpd();this.chartCreated=!0},formatString:function(a,b,c){var d=b.graph;-1!=a.indexOf("[[category]]")&&(a=a.replace(/\[\[category\]\]/g,String(b.serialDataItem.category)));d=d.numberFormatter;d||(d=this.nf);a=AmCharts.formatValue(a,
b.values,["value"],d,"",this.usePrefixes,this.prefixesOfSmallNumbers,this.prefixesOfBigNumbers);-1!=a.indexOf("[[")&&(a=AmCharts.formatDataContextValue(a,b.dataContext));return a=AmCharts.AmRadarChart.base.formatString.call(this,a,b,c)},cleanChart:function(){AmCharts.callMethod("destroy",[this.valueAxes,this.graphs])}});AmCharts.RadAxis=AmCharts.Class({construct:function(a){var b=a.chart,c=a.axisThickness,d=a.axisColor,m=a.axisAlpha,p=a.x,e=a.y;this.set=b.container.set();b.axesSet.push(this.set);var f=a.axisTitleOffset,n=a.radarCategoriesEnabled,l=a.chart.fontFamily,g=a.fontSize;void 0===g&&(g=a.chart.fontSize);var r=a.color;void 0===r&&(r=a.chart.color);if(b){this.axisWidth=a.height;a=b.chartData;var w=a.length,t;for(t=0;t<w;t++){var k=180-360/w*t,h=p+this.axisWidth*Math.sin(k/180*Math.PI),q=e+this.axisWidth*Math.cos(k/
180*Math.PI);0<m&&(h=AmCharts.line(b.container,[p,h],[e,q],d,m,c),this.set.push(h));if(n){var u="start",h=p+(this.axisWidth+f)*Math.sin(k/180*Math.PI),q=e+(this.axisWidth+f)*Math.cos(k/180*Math.PI);if(180==k||0===k)u="middle",h-=5;0>k&&(u="end",h-=10);180==k&&(q-=5);0===k&&(q+=5);k=AmCharts.text(b.container,a[t].category,r,l,g,u);k.translate(h+5,q);this.set.push(k);k.getBBox()}}}}});AmCharts.RadItem=AmCharts.Class({construct:function(a,b,c,d,m,p,e,f){void 0===c&&(c="");var n=a.chart.fontFamily,l=a.fontSize;void 0===l&&(l=a.chart.fontSize);var g=a.color;void 0===g&&(g=a.chart.color);var r=a.chart.container;this.set=d=r.set();var w=a.axisColor,t=a.axisAlpha,k=a.tickLength,h=a.gridAlpha,q=a.gridThickness,u=a.gridColor,A=a.dashLength,B=a.fillColor,y=a.fillAlpha,C=a.labelsEnabled;m=a.counter;var D=a.inside,E=a.gridType,s,H=a.labelOffset;b-=a.height;var x;p=a.x;var F=a.y;e?(C=!0,isNaN(e.tickLength)||
(k=e.tickLength),void 0!=e.lineColor&&(u=e.lineColor),isNaN(e.lineAlpha)||(h=e.lineAlpha),isNaN(e.dashLength)||(A=e.dashLength),isNaN(e.lineThickness)||(q=e.lineThickness),!0===e.inside&&(D=!0),void 0!==e.boldLabel&&(f=e.boldLabel)):c||(h/=3,k/=2);var G="end",z=-1;D&&(G="start",z=1);var v;C&&(v=AmCharts.text(r,c,g,n,l,G,f),v.translate(p+(k+3+H)*z,b),d.push(v),this.label=v,x=AmCharts.line(r,[p,p+k*z],[b,b],w,t,q),d.push(x));b=Math.round(a.y-b);f=[];n=[];if(0<h){if("polygons"==E){s=a.data.length;for(l=
0;l<s;l++)g=180-360/s*l,f.push(b*Math.sin(g/180*Math.PI)),n.push(b*Math.cos(g/180*Math.PI));f.push(f[0]);n.push(n[0]);h=AmCharts.line(r,f,n,u,h,q,A)}else h=AmCharts.circle(r,b,"#FFFFFF",0,q,u,h);h.translate(p,F);d.push(h)}if(1==m&&0<y&&!e&&""!==c){e=a.previousCoord;if("polygons"==E){for(l=s;0<=l;l--)g=180-360/s*l,f.push(e*Math.sin(g/180*Math.PI)),n.push(e*Math.cos(g/180*Math.PI));s=AmCharts.polygon(r,f,n,B,y)}else s=AmCharts.wedge(r,0,0,0,360,b,b,e,0,{fill:B,"fill-opacity":y,stroke:"#000","stroke-opacity":0,
"stroke-width":1});d.push(s);s.translate(p,F)}!1===a.visible&&(x&&x.hide(),v&&v.hide());""!==c&&(a.counter=0===m?1:0,a.previousCoord=b)},graphics:function(){return this.set},getLabel:function(){return this.label}});AmCharts.RadarFill=AmCharts.Class({construct:function(a,b,c,d){b-=a.axisWidth;c-=a.axisWidth;var m=Math.max(b,c);b=c=Math.min(b,c);c=a.chart.container;var p=d.fillAlpha,e=d.fillColor,m=Math.abs(m-a.y);b=Math.abs(b-a.y);var f=Math.max(m,b);b=Math.min(m,b);m=f;f=d.angle+90;d=d.toAngle+90;isNaN(f)&&(f=0);isNaN(d)&&(d=360);this.set=c.set();void 0===e&&(e="#000000");isNaN(p)&&(p=0);if("polygons"==a.gridType){d=[];var n=[],l=a.data.length,g;for(g=0;g<l;g++)f=180-360/l*g,d.push(m*Math.sin(f/180*Math.PI)),
n.push(m*Math.cos(f/180*Math.PI));d.push(d[0]);n.push(n[0]);for(g=l;0<=g;g--)f=180-360/l*g,d.push(b*Math.sin(f/180*Math.PI)),n.push(b*Math.cos(f/180*Math.PI));this.fill=AmCharts.polygon(c,d,n,e,p)}else this.fill=AmCharts.wedge(c,0,0,f,d-f,m,m,b,0,{fill:e,"fill-opacity":p,stroke:"#000","stroke-opacity":0,"stroke-width":1});this.set.push(this.fill);this.fill.translate(a.x,a.y)},graphics:function(){return this.set},getLabel:function(){}});
AmCharts.AmSerialChart=AmCharts.Class({inherits:AmCharts.AmRectangularChart,construct:function(a){this.type="serial";AmCharts.AmSerialChart.base.construct.call(this,a);this.cname="AmSerialChart";this.theme=a;this.createEvents("changed");this.columnSpacing=5;this.columnSpacing3D=0;this.columnWidth=.8;this.updateScrollbar=!0;var b=new AmCharts.CategoryAxis(a);b.chart=this;this.categoryAxis=b;this.zoomOutOnDataUpdate=!0;this.mouseWheelZoomEnabled=this.mouseWheelScrollEnabled=this.rotate=this.skipZoom=
!1;this.minSelectedTime=0;AmCharts.applyTheme(this,a,this.cname)},initChart:function(){AmCharts.AmSerialChart.base.initChart.call(this);this.updateCategoryAxis(this.categoryAxis,this.rotate,"categoryAxis");this.dataChanged&&(this.updateData(),this.dataChanged=!1,this.dispatchDataUpdated=!0);var a=this.chartCursor;a&&(a.updateData(),a.fullWidth&&(a.fullRectSet=this.cursorLineSet));var a=this.countColumns(),b=this.graphs,c;for(c=0;c<b.length;c++)b[c].columnCount=a;this.updateScrollbar=!0;this.drawChart();
this.autoMargins&&!this.marginsUpdated&&(this.marginsUpdated=!0,this.measureMargins());(this.mouseWheelScrollEnabled||this.mouseWheelZoomEnabled)&&this.addMouseWheel()},handleWheelReal:function(a,b){if(!this.wheelBusy){var c=this.categoryAxis,d=c.parseDates,e=c.minDuration(),f=c=1;this.mouseWheelZoomEnabled?b||(c=-1):b&&(c=-1);var l=this.chartData.length,h=this.lastTime,g=this.firstTime;0>a?d?(l=this.endTime-this.startTime,d=this.startTime+c*e,e=this.endTime+f*e,0<f&&0<c&&e>=h&&(e=h,d=h-l),this.zoomToDates(new Date(d),
new Date(e))):(0<f&&0<c&&this.end>=l-1&&(c=f=0),d=this.start+c,e=this.end+f,this.zoomToIndexes(d,e)):d?(l=this.endTime-this.startTime,d=this.startTime-c*e,e=this.endTime-f*e,0<f&&0<c&&d<=g&&(d=g,e=g+l),this.zoomToDates(new Date(d),new Date(e))):(0<f&&0<c&&1>this.start&&(c=f=0),d=this.start-c,e=this.end-f,this.zoomToIndexes(d,e))}},validateData:function(a){this.marginsUpdated=!1;this.zoomOutOnDataUpdate&&!a&&(this.endTime=this.end=this.startTime=this.start=NaN);AmCharts.AmSerialChart.base.validateData.call(this)},
drawChart:function(){AmCharts.AmSerialChart.base.drawChart.call(this);var a=this.chartData;if(AmCharts.ifArray(a)){var b=this.chartScrollbar;b&&b.draw();if(0<this.realWidth&&0<this.realHeight){var a=a.length-1,c,b=this.categoryAxis;if(b.parseDates&&!b.equalSpacing){if(b=this.startTime,c=this.endTime,isNaN(b)||isNaN(c))b=this.firstTime,c=this.lastTime}else if(b=this.start,c=this.end,isNaN(b)||isNaN(c))b=0,c=a;this.endTime=this.startTime=this.end=this.start=void 0;this.zoom(b,c)}}else this.cleanChart();
this.dispDUpd();this.chartCreated=!0},cleanChart:function(){AmCharts.callMethod("destroy",[this.valueAxes,this.graphs,this.categoryAxis,this.chartScrollbar,this.chartCursor])},updateCategoryAxis:function(a,b,c){a.chart=this;a.id=c;a.rotate=b;a.axisRenderer=AmCharts.RecAxis;a.guideFillRenderer=AmCharts.RecFill;a.axisItemRenderer=AmCharts.RecItem;a.setOrientation(!this.rotate);a.x=this.marginLeftReal;a.y=this.marginTopReal;a.dx=this.dx;a.dy=this.dy;a.width=this.plotAreaWidth-1;a.height=this.plotAreaHeight-
1;a.viW=this.plotAreaWidth-1;a.viH=this.plotAreaHeight-1;a.viX=this.marginLeftReal;a.viY=this.marginTopReal;a.marginsChanged=!0},updateValueAxes:function(){AmCharts.AmSerialChart.base.updateValueAxes.call(this);var a=this.valueAxes,b;for(b=0;b<a.length;b++){var c=a[b],d=this.rotate;c.rotate=d;c.setOrientation(d);d=this.categoryAxis;if(!d.startOnAxis||d.parseDates)c.expandMinMax=!0}},updateData:function(){this.parseData();var a=this.graphs,b,c=this.chartData;for(b=0;b<a.length;b++)a[b].data=c;0<c.length&&
(this.firstTime=this.getStartTime(c[0].time),this.lastTime=this.getEndTime(c[c.length-1].time))},getStartTime:function(a){var b=this.categoryAxis;return AmCharts.resetDateToMin(new Date(a),b.minPeriod,1,b.firstDayOfWeek).getTime()},getEndTime:function(a){var b=AmCharts.extractPeriod(this.categoryAxis.minPeriod);return AmCharts.changeDate(new Date(a),b.period,b.count,!0).getTime()-1},updateMargins:function(){AmCharts.AmSerialChart.base.updateMargins.call(this);var a=this.chartScrollbar;a&&(this.getScrollbarPosition(a,
this.rotate,this.categoryAxis.position),this.adjustMargins(a,this.rotate))},updateScrollbars:function(){AmCharts.AmSerialChart.base.updateScrollbars.call(this);this.updateChartScrollbar(this.chartScrollbar,this.rotate)},zoom:function(a,b){var c=this.categoryAxis;c.parseDates&&!c.equalSpacing?this.timeZoom(a,b):this.indexZoom(a,b);this.updateLegendValues()},timeZoom:function(a,b){var c=this.maxSelectedTime;isNaN(c)||(b!=this.endTime&&b-a>c&&(a=b-c,this.updateScrollbar=!0),a!=this.startTime&&b-a>c&&
(b=a+c,this.updateScrollbar=!0));var d=this.minSelectedTime;if(0<d&&b-a<d){var e=Math.round(a+(b-a)/2),d=Math.round(d/2);a=e-d;b=e+d}var f=this.chartData,e=this.categoryAxis;if(AmCharts.ifArray(f)&&(a!=this.startTime||b!=this.endTime)){var l=e.minDuration(),d=this.firstTime,h=this.lastTime;a||(a=d,isNaN(c)||(a=h-c));b||(b=h);a>h&&(a=h);b<d&&(b=d);a<d&&(a=d);b>h&&(b=h);b<a&&(b=a+l);b-a<l/5&&(b<h?b=a+l/5:a=b-l/5);this.startTime=a;this.endTime=b;c=f.length-1;l=this.getClosestIndex(f,"time",a,!0,0,c);
f=this.getClosestIndex(f,"time",b,!1,l,c);e.timeZoom(a,b);e.zoom(l,f);this.start=AmCharts.fitToBounds(l,0,c);this.end=AmCharts.fitToBounds(f,0,c);this.zoomAxesAndGraphs();this.zoomScrollbar();a!=d||b!=h?this.showZB(!0):this.showZB(!1);this.updateColumnsDepth();this.dispatchTimeZoomEvent()}},indexZoom:function(a,b){var c=this.maxSelectedSeries;isNaN(c)||(b!=this.end&&b-a>c&&(a=b-c,this.updateScrollbar=!0),a!=this.start&&b-a>c&&(b=a+c,this.updateScrollbar=!0));if(a!=this.start||b!=this.end){var d=this.chartData.length-
1;isNaN(a)&&(a=0,isNaN(c)||(a=d-c));isNaN(b)&&(b=d);b<a&&(b=a);b>d&&(b=d);a>d&&(a=d-1);0>a&&(a=0);this.start=a;this.end=b;this.categoryAxis.zoom(a,b);this.zoomAxesAndGraphs();this.zoomScrollbar();0!==a||b!=this.chartData.length-1?this.showZB(!0):this.showZB(!1);this.updateColumnsDepth();this.dispatchIndexZoomEvent()}},updateGraphs:function(){AmCharts.AmSerialChart.base.updateGraphs.call(this);var a=this.graphs,b;for(b=0;b<a.length;b++){var c=a[b];c.columnWidthReal=this.columnWidth;c.categoryAxis=
this.categoryAxis;AmCharts.isString(c.fillToGraph)&&(c.fillToGraph=this.getGraphById(c.fillToGraph))}},updateColumnsDepth:function(){var a,b=this.graphs,c;AmCharts.remove(this.columnsSet);this.columnsArray=[];for(a=0;a<b.length;a++){c=b[a];var d=c.columnsArray;if(d){var e;for(e=0;e<d.length;e++)this.columnsArray.push(d[e])}}this.columnsArray.sort(this.compareDepth);if(0<this.columnsArray.length){b=this.container.set();this.columnSet.push(b);for(a=0;a<this.columnsArray.length;a++)b.push(this.columnsArray[a].column.set);
c&&b.translate(c.x,c.y);this.columnsSet=b}},compareDepth:function(a,b){return a.depth>b.depth?1:-1},zoomScrollbar:function(){var a=this.chartScrollbar,b=this.categoryAxis;a&&this.updateScrollbar&&(b.parseDates&&!b.equalSpacing?a.timeZoom(this.startTime,this.endTime):a.zoom(this.start,this.end),this.updateScrollbar=!0)},updateTrendLines:function(){var a=this.trendLines,b;for(b=0;b<a.length;b++){var c=a[b],c=AmCharts.processObject(c,AmCharts.TrendLine,this.theme);a[b]=c;c.chart=this;AmCharts.isString(c.valueAxis)&&
(c.valueAxis=this.getValueAxisById(c.valueAxis));c.valueAxis||(c.valueAxis=this.valueAxes[0]);c.categoryAxis=this.categoryAxis}},zoomAxesAndGraphs:function(){if(!this.scrollbarOnly){var a=this.valueAxes,b;for(b=0;b<a.length;b++)a[b].zoom(this.start,this.end);a=this.graphs;for(b=0;b<a.length;b++)a[b].zoom(this.start,this.end);this.zoomTrendLines();(b=this.chartCursor)&&b.zoom(this.start,this.end,this.startTime,this.endTime)}},countColumns:function(){var a=0,b=this.valueAxes.length,c=this.graphs.length,
d,e,f=!1,l,h;for(h=0;h<b;h++){e=this.valueAxes[h];var g=e.stackType;if("100%"==g||"regular"==g)for(f=!1,l=0;l<c;l++)d=this.graphs[l],d.tcc=1,d.valueAxis==e&&"column"==d.type&&(!f&&d.stackable&&(a++,f=!0),(!d.stackable&&d.clustered||d.newStack)&&a++,d.columnIndex=a-1,d.clustered||(d.columnIndex=0));if("none"==g||"3d"==g){f=!1;for(l=0;l<c;l++)d=this.graphs[l],d.valueAxis==e&&"column"==d.type&&(d.clustered?(d.tcc=1,d.newStack&&(a=0),d.hidden||(d.columnIndex=a,a++)):d.hidden||(f=!0,d.tcc=1,d.columnIndex=
0));f&&0==a&&(a=1)}if("3d"==g){e=1;for(h=0;h<c;h++)d=this.graphs[h],d.newStack&&e++,d.depthCount=e,d.tcc=a;a=e}}return a},parseData:function(){AmCharts.AmSerialChart.base.parseData.call(this);this.parseSerialData()},getCategoryIndexByValue:function(a){var b=this.chartData,c,d;for(d=0;d<b.length;d++)b[d].category==a&&(c=d);return c},handleCursorChange:function(a){this.updateLegendValues(a.index)},handleCursorZoom:function(a){this.updateScrollbar=!0;this.zoom(a.start,a.end)},handleScrollbarZoom:function(a){this.updateScrollbar=
!1;this.zoom(a.start,a.end)},dispatchTimeZoomEvent:function(){if(this.prevStartTime!=this.startTime||this.prevEndTime!=this.endTime){var a={type:"zoomed"};a.startDate=new Date(this.startTime);a.endDate=new Date(this.endTime);a.startIndex=this.start;a.endIndex=this.end;this.startIndex=this.start;this.endIndex=this.end;this.startDate=a.startDate;this.endDate=a.endDate;this.prevStartTime=this.startTime;this.prevEndTime=this.endTime;var b=this.categoryAxis,c=AmCharts.extractPeriod(b.minPeriod).period,
b=b.dateFormatsObject[c];a.startValue=AmCharts.formatDate(a.startDate,b,this);a.endValue=AmCharts.formatDate(a.endDate,b,this);a.chart=this;a.target=this;this.fire(a.type,a)}},dispatchIndexZoomEvent:function(){if(this.prevStartIndex!=this.start||this.prevEndIndex!=this.end){this.startIndex=this.start;this.endIndex=this.end;var a=this.chartData;if(AmCharts.ifArray(a)&&!isNaN(this.start)&&!isNaN(this.end)){var b={chart:this,target:this,type:"zoomed"};b.startIndex=this.start;b.endIndex=this.end;b.startValue=
a[this.start].category;b.endValue=a[this.end].category;this.categoryAxis.parseDates&&(this.startTime=a[this.start].time,this.endTime=a[this.end].time,b.startDate=new Date(this.startTime),b.endDate=new Date(this.endTime));this.prevStartIndex=this.start;this.prevEndIndex=this.end;this.fire(b.type,b)}}},updateLegendValues:function(a){var b=this.graphs,c;for(c=0;c<b.length;c++){var d=b[c];isNaN(a)?d.currentDataItem=void 0:d.currentDataItem=this.chartData[a].axes[d.valueAxis.id].graphs[d.id]}this.legend&&
this.legend.updateValues()},getClosestIndex:function(a,b,c,d,e,f){0>e&&(e=0);f>a.length-1&&(f=a.length-1);var l=e+Math.round((f-e)/2),h=a[l][b];if(1>=f-e){if(d)return e;d=a[f][b];return Math.abs(a[e][b]-c)<Math.abs(d-c)?e:f}return c==h?l:c<h?this.getClosestIndex(a,b,c,d,e,l):this.getClosestIndex(a,b,c,d,l,f)},zoomToIndexes:function(a,b){this.updateScrollbar=!0;var c=this.chartData;if(c){var d=c.length;0<d&&(0>a&&(a=0),b>d-1&&(b=d-1),d=this.categoryAxis,d.parseDates&&!d.equalSpacing?this.zoom(c[a].time,
this.getEndTime(c[b].time)):this.zoom(a,b))}},zoomToDates:function(a,b){this.updateScrollbar=!0;var c=this.chartData;if(this.categoryAxis.equalSpacing){var d=this.getClosestIndex(c,"time",a.getTime(),!0,0,c.length);b=AmCharts.resetDateToMin(b,this.categoryAxis.minPeriod,1);c=this.getClosestIndex(c,"time",b.getTime(),!1,0,c.length);this.zoom(d,c)}else this.zoom(a.getTime(),b.getTime())},zoomToCategoryValues:function(a,b){this.updateScrollbar=!0;this.zoom(this.getCategoryIndexByValue(a),this.getCategoryIndexByValue(b))},
formatPeriodString:function(a,b){if(b){var c=["value","open","low","high","close"],d="value open low high close average sum count".split(" "),e=b.valueAxis,f=this.chartData,l=b.numberFormatter;l||(l=this.nf);for(var h=0;h<c.length;h++){for(var g=c[h],k=0,m=0,p,v,r,s,n,w=0,q=0,x,t,z,y,B,D=this.start;D<=this.end;D++){var u=f[D];if(u&&(u=u.axes[e.id].graphs[b.id])){if(u.values){var A=u.values[g];if(!isNaN(A)){isNaN(p)&&(p=A);v=A;if(isNaN(r)||r>A)r=A;if(isNaN(s)||s<A)s=A;n=AmCharts.getDecimals(k);var H=
AmCharts.getDecimals(A),k=k+A,k=AmCharts.roundTo(k,Math.max(n,H));m++;n=k/m}}if(u.percents&&(u=u.percents[g],!isNaN(u))){isNaN(x)&&(x=u);t=u;if(isNaN(z)||z>u)z=u;if(isNaN(y)||y<u)y=u;B=AmCharts.getDecimals(w);A=AmCharts.getDecimals(u);w+=u;w=AmCharts.roundTo(w,Math.max(B,A));q++;B=w/q}}}w={open:x,close:t,high:y,low:z,average:B,sum:w,count:q};a=AmCharts.formatValue(a,{open:p,close:v,high:s,low:r,average:n,sum:k,count:m},d,l,g+"\\.",this.usePrefixes,this.prefixesOfSmallNumbers,this.prefixesOfBigNumbers);
a=AmCharts.formatValue(a,w,d,this.pf,"percents\\."+g+"\\.")}}return a=AmCharts.cleanFromEmpty(a)},formatString:function(a,b,c){var d=b.graph;if(-1!=a.indexOf("[[category]]")){var e=b.serialDataItem.category;if(this.categoryAxis.parseDates){var f=this.balloonDateFormat,l=this.chartCursor;l&&(f=l.categoryBalloonDateFormat);-1!=a.indexOf("[[category]]")&&(f=AmCharts.formatDate(e,f,this),-1!=f.indexOf("fff")&&(f=AmCharts.formatMilliseconds(f,e)),e=f)}a=a.replace(/\[\[category\]\]/g,String(e))}d=d.numberFormatter;
d||(d=this.nf);e=b.graph.valueAxis;(f=e.duration)&&!isNaN(b.values.value)&&(e=AmCharts.formatDuration(b.values.value,f,"",e.durationUnits,e.maxInterval,d),a=a.replace(RegExp("\\[\\[value\\]\\]","g"),e));e="value open low high close total".split(" ");f=this.pf;a=AmCharts.formatValue(a,b.percents,e,f,"percents\\.");a=AmCharts.formatValue(a,b.values,e,d,"",this.usePrefixes,this.prefixesOfSmallNumbers,this.prefixesOfBigNumbers);a=AmCharts.formatValue(a,b.values,["percents"],f);-1!=a.indexOf("[[")&&(a=
AmCharts.formatDataContextValue(a,b.dataContext));return a=AmCharts.AmSerialChart.base.formatString.call(this,a,b,c)},addChartScrollbar:function(a){AmCharts.callMethod("destroy",[this.chartScrollbar]);a&&(a.chart=this,this.listenTo(a,"zoomed",this.handleScrollbarZoom));this.rotate?void 0===a.width&&(a.width=a.scrollbarHeight):void 0===a.height&&(a.height=a.scrollbarHeight);this.chartScrollbar=a},removeChartScrollbar:function(){AmCharts.callMethod("destroy",[this.chartScrollbar]);this.chartScrollbar=
null},handleReleaseOutside:function(a){AmCharts.AmSerialChart.base.handleReleaseOutside.call(this,a);AmCharts.callMethod("handleReleaseOutside",[this.chartScrollbar])}});AmCharts.Cuboid=AmCharts.Class({construct:function(a,b,c,d,e,f,l,h,g,k,m,p,v,r,s,n){this.set=a.set();this.container=a;this.h=Math.round(c);this.w=Math.round(b);this.dx=d;this.dy=e;this.colors=f;this.alpha=l;this.bwidth=h;this.bcolor=g;this.balpha=k;this.dashLength=r;this.topRadius=n;this.pattern=s;(this.rotate=v)?0>b&&0===m&&(m=180):0>c&&270==m&&(m=90);this.gradientRotation=m;0===d&&0===e&&(this.cornerRadius=p);this.draw()},draw:function(){var a=this.set;a.clear();var b=this.container,c=this.w,d=
this.h,e=this.dx,f=this.dy,l=this.colors,h=this.alpha,g=this.bwidth,k=this.bcolor,m=this.balpha,p=this.gradientRotation,v=this.cornerRadius,r=this.dashLength,s=this.pattern,n=this.topRadius,w=l,q=l;"object"==typeof l&&(w=l[0],q=l[l.length-1]);var x,t,z,y,B,D,u,A,H,M=h;s&&(h=0);var C,E,F,G,I=this.rotate;if(0<Math.abs(e)||0<Math.abs(f))if(isNaN(n))u=q,q=AmCharts.adjustLuminosity(w,-.2),q=AmCharts.adjustLuminosity(w,-.2),x=AmCharts.polygon(b,[0,e,c+e,c,0],[0,f,f,0,0],q,h,1,k,0,p),0<m&&(H=AmCharts.line(b,
[0,e,c+e],[0,f,f],k,m,g,r)),t=AmCharts.polygon(b,[0,0,c,c,0],[0,d,d,0,0],q,h,1,k,0,p),t.translate(e,f),0<m&&(z=AmCharts.line(b,[e,e],[f,f+d],k,m,g,r)),y=AmCharts.polygon(b,[0,0,e,e,0],[0,d,d+f,f,0],q,h,1,k,0,p),B=AmCharts.polygon(b,[c,c,c+e,c+e,c],[0,d,d+f,f,0],q,h,1,k,0,p),0<m&&(D=AmCharts.line(b,[c,c+e,c+e,c],[0,f,d+f,d],k,m,g,r)),q=AmCharts.adjustLuminosity(u,.2),u=AmCharts.polygon(b,[0,e,c+e,c,0],[d,d+f,d+f,d,d],q,h,1,k,0,p),0<m&&(A=AmCharts.line(b,[0,e,c+e],[d,d+f,d+f],k,m,g,r));else{var J,K,
L;I?(J=d/2,q=e/2,L=d/2,K=c+e/2,E=Math.abs(d/2),C=Math.abs(e/2)):(q=c/2,J=f/2,K=c/2,L=d+f/2+1,C=Math.abs(c/2),E=Math.abs(f/2));F=C*n;G=E*n;.1<C&&.1<C&&(x=AmCharts.circle(b,C,w,h,g,k,m,!1,E),x.translate(q,J));.1<F&&.1<F&&(u=AmCharts.circle(b,F,AmCharts.adjustLuminosity(w,.5),h,g,k,m,!1,G),u.translate(K,L))}h=M;1>Math.abs(d)&&(d=0);1>Math.abs(c)&&(c=0);!isNaN(n)&&(0<Math.abs(e)||0<Math.abs(f))?(l=[w],l={fill:l,stroke:k,"stroke-width":g,"stroke-opacity":m,"fill-opacity":h},I?(h="M0,0 L"+c+","+(d/2-d/
2*n),g=" B",0<c&&(g=" A"),AmCharts.VML?(h+=g+Math.round(c-F)+","+Math.round(d/2-G)+","+Math.round(c+F)+","+Math.round(d/2+G)+","+c+",0,"+c+","+d,h=h+(" L0,"+d)+(g+Math.round(-C)+","+Math.round(d/2-E)+","+Math.round(C)+","+Math.round(d/2+E)+",0,"+d+",0,0")):(h+="A"+F+","+G+",0,0,0,"+c+","+(d-d/2*(1-n))+"L0,"+d,h+="A"+C+","+E+",0,0,1,0,0"),C=90):(g=c/2-c/2*n,h="M0,0 L"+g+","+d,AmCharts.VML?(h="M0,0 L"+g+","+d,g=" B",0>d&&(g=" A"),h+=g+Math.round(c/2-F)+","+Math.round(d-G)+","+Math.round(c/2+F)+","+
Math.round(d+G)+",0,"+d+","+c+","+d,h+=" L"+c+",0",h+=g+Math.round(c/2+C)+","+Math.round(E)+","+Math.round(c/2-C)+","+Math.round(-E)+","+c+",0,0,0"):(h+="A"+F+","+G+",0,0,0,"+(c-c/2*(1-n))+","+d+"L"+c+",0",h+="A"+C+","+E+",0,0,1,0,0"),C=180),b=b.path(h).attr(l),b.gradient("linearGradient",[w,AmCharts.adjustLuminosity(w,-.3),AmCharts.adjustLuminosity(w,-.3),w],C),I?b.translate(e/2,0):b.translate(0,f/2)):b=0===d?AmCharts.line(b,[0,c],[0,0],k,m,g,r):0===c?AmCharts.line(b,[0,0],[0,d],k,m,g,r):0<v?AmCharts.rect(b,
c,d,l,h,g,k,m,v,p,r):AmCharts.polygon(b,[0,0,c,c,0],[0,d,d,0,0],l,h,g,k,m,p,!1,r);c=isNaN(n)?0>d?[x,H,t,z,y,B,D,u,A,b]:[u,A,t,z,y,B,x,H,D,b]:I?0<c?[x,b,u]:[u,b,x]:0>d?[x,b,u]:[u,b,x];for(d=0;d<c.length;d++)(e=c[d])&&a.push(e);s&&b.pattern(s)},width:function(a){this.w=Math.round(a);this.draw()},height:function(a){this.h=Math.round(a);this.draw()},animateHeight:function(a,b){var c=this;c.easing=b;c.totalFrames=Math.round(1E3*a/AmCharts.updateRate);c.rh=c.h;c.frame=0;c.height(1);setTimeout(function(){c.updateHeight.call(c)},
AmCharts.updateRate)},updateHeight:function(){var a=this;a.frame++;var b=a.totalFrames;a.frame<=b&&(b=a.easing(0,a.frame,1,a.rh-1,b),a.height(b),setTimeout(function(){a.updateHeight.call(a)},AmCharts.updateRate))},animateWidth:function(a,b){var c=this;c.easing=b;c.totalFrames=Math.round(1E3*a/AmCharts.updateRate);c.rw=c.w;c.frame=0;c.width(1);setTimeout(function(){c.updateWidth.call(c)},AmCharts.updateRate)},updateWidth:function(){var a=this;a.frame++;var b=a.totalFrames;a.frame<=b&&(b=a.easing(0,
a.frame,1,a.rw-1,b),a.width(b),setTimeout(function(){a.updateWidth.call(a)},AmCharts.updateRate))}});AmCharts.CategoryAxis=AmCharts.Class({inherits:AmCharts.AxisBase,construct:function(a){this.cname="CategoryAxis";AmCharts.CategoryAxis.base.construct.call(this,a);this.minPeriod="DD";this.equalSpacing=this.parseDates=!1;this.position="bottom";this.startOnAxis=!1;this.firstDayOfWeek=1;this.gridPosition="middle";this.markPeriodChange=this.boldPeriodBeginning=!0;this.safeDistance=30;this.centerLabelOnFullPeriod=!0;this.periods=[{period:"ss",count:1},{period:"ss",count:5},{period:"ss",count:10},{period:"ss",
count:30},{period:"mm",count:1},{period:"mm",count:5},{period:"mm",count:10},{period:"mm",count:30},{period:"hh",count:1},{period:"hh",count:3},{period:"hh",count:6},{period:"hh",count:12},{period:"DD",count:1},{period:"DD",count:2},{period:"DD",count:3},{period:"DD",count:4},{period:"DD",count:5},{period:"WW",count:1},{period:"MM",count:1},{period:"MM",count:2},{period:"MM",count:3},{period:"MM",count:6},{period:"YYYY",count:1},{period:"YYYY",count:2},{period:"YYYY",count:5},{period:"YYYY",count:10},
{period:"YYYY",count:50},{period:"YYYY",count:100}];this.dateFormats=[{period:"fff",format:"JJ:NN:SS"},{period:"ss",format:"JJ:NN:SS"},{period:"mm",format:"JJ:NN"},{period:"hh",format:"JJ:NN"},{period:"DD",format:"MMM DD"},{period:"WW",format:"MMM DD"},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}];this.nextPeriod={};this.nextPeriod.fff="ss";this.nextPeriod.ss="mm";this.nextPeriod.mm="hh";this.nextPeriod.hh="DD";this.nextPeriod.DD="MM";this.nextPeriod.MM="YYYY";AmCharts.applyTheme(this,
a,this.cname)},draw:function(){AmCharts.CategoryAxis.base.draw.call(this);this.generateDFObject();var a=this.chart.chartData;this.data=a;if(AmCharts.ifArray(a)){var b,c=this.chart,d=this.start,e=this.labelFrequency,f=0;b=this.end-d+1;var l=this.gridCountR,h=this.showFirstLabel,g=this.showLastLabel,k,m="",p=AmCharts.extractPeriod(this.minPeriod);k=AmCharts.getPeriodDuration(p.period,p.count);var v,r,s,n,w,q;v=this.rotate;var x=this.firstDayOfWeek,t=this.boldPeriodBeginning,a=AmCharts.resetDateToMin(new Date(a[a.length-
1].time+1.05*k),this.minPeriod,1,x).getTime(),z;this.endTime>a&&(this.endTime=a);q=this.minorGridEnabled;var y,a=this.gridAlpha,B;if(this.parseDates&&!this.equalSpacing){this.timeDifference=this.endTime-this.startTime;d=this.choosePeriod(0);e=d.period;v=d.count;r=AmCharts.getPeriodDuration(e,v);r<k&&(e=p.period,v=p.count,r=k);s=e;"WW"==s&&(s="DD");this.stepWidth=this.getStepWidth(this.timeDifference);var l=Math.ceil(this.timeDifference/r)+5,D=m=AmCharts.resetDateToMin(new Date(this.startTime-r),e,
v,x).getTime();s==e&&1==v&&this.centerLabelOnFullPeriod&&(w=r*this.stepWidth);this.cellWidth=k*this.stepWidth;b=Math.round(m/r);d=-1;b/2==Math.round(b/2)&&(d=-2,m-=r);var u=c.firstTime,A=0;q&&1<v&&(y=this.chooseMinorFrequency(v),B=AmCharts.getPeriodDuration(e,y));if(0<this.gridCountR)for(b=d;b<=l;b++){p=u+r*(b+Math.floor((D-u)/r))-A;"DD"==e&&(p+=36E5);p=AmCharts.resetDateToMin(new Date(p),e,v,x).getTime();"MM"==e&&(q=(p-m)/r,1.5<=(p-m)/r&&(p=p-(q-1)*r+AmCharts.getPeriodDuration("DD",3),p=AmCharts.resetDateToMin(new Date(p),
e,1).getTime(),A+=r));k=(p-this.startTime)*this.stepWidth;q=!1;this.nextPeriod[s]&&(q=this.checkPeriodChange(this.nextPeriod[s],1,p,m,s));z=!1;q&&this.markPeriodChange?(q=this.dateFormatsObject[this.nextPeriod[s]],this.twoLineMode&&(q=this.dateFormatsObject[s]+"\n"+q,q=AmCharts.fixBrakes(q)),z=!0):q=this.dateFormatsObject[s];t||(z=!1);m=AmCharts.formatDate(new Date(p),q,c);if(b==d&&!h||b==l&&!g)m=" ";this.labelFunction&&(m=this.labelFunction(m,new Date(p),this,e,v,n).toString());this.boldLabels&&
(z=!0);n=new this.axisItemRenderer(this,k,m,!1,w,0,!1,z);this.pushAxisItem(n);n=m=p;if(!isNaN(y))for(k=1;k<v;k+=y)this.gridAlpha=this.minorGridAlpha,q=p+B*k,q=AmCharts.resetDateToMin(new Date(q),e,y,x).getTime(),q=new this.axisItemRenderer(this,(q-this.startTime)*this.stepWidth),this.pushAxisItem(q);this.gridAlpha=a}}else if(!this.parseDates){if(this.cellWidth=this.getStepWidth(b),b<l&&(l=b),f+=this.start,this.stepWidth=this.getStepWidth(b),0<l)for(t=Math.floor(b/l),y=this.chooseMinorFrequency(t),
k=f,k/2==Math.round(k/2)&&k--,0>k&&(k=0),l=0,this.end-k+1>=this.autoRotateCount&&(this.labelRotation=this.autoRotateAngle),b=k;b<=this.end+2;b++){n=!1;0<=b&&b<this.data.length?(s=this.data[b],m=s.category,n=s.forceShow):m="";if(q&&!isNaN(y))if(b/y==Math.round(b/y)||n)b/t==Math.round(b/t)||n||(this.gridAlpha=this.minorGridAlpha,m=void 0);else continue;else if(b/t!=Math.round(b/t)&&!n)continue;k=this.getCoordinate(b-f);n=0;"start"==this.gridPosition&&(k-=this.cellWidth/2,n=this.cellWidth/2);x=!0;tickShift=
n;"start"==this.tickPosition&&(tickShift=0,x=!1,n=0);if(b==d&&!h||b==this.end&&!g)m=void 0;Math.round(l/e)!=l/e&&(m=void 0);l++;D=this.cellWidth;v&&(D=NaN);this.labelFunction&&s&&(m=this.labelFunction(m,s,this));m=AmCharts.fixBrakes(m);z=!1;this.boldLabels&&(z=!0);b>this.end&&"start"==this.tickPosition&&(m=" ");n=new this.axisItemRenderer(this,k,m,x,D,n,void 0,z,tickShift,!1,s.labelColor);n.serialDataItem=s;this.pushAxisItem(n);this.gridAlpha=a}}else if(this.parseDates&&this.equalSpacing){f=this.start;
this.startTime=this.data[this.start].time;this.endTime=this.data[this.end].time;this.timeDifference=this.endTime-this.startTime;d=this.choosePeriod(0);e=d.period;v=d.count;r=AmCharts.getPeriodDuration(e,v);r<k&&(e=p.period,v=p.count,r=k);s=e;"WW"==s&&(s="DD");this.stepWidth=this.getStepWidth(b);l=Math.ceil(this.timeDifference/r)+1;m=AmCharts.resetDateToMin(new Date(this.startTime-r),e,v,x).getTime();this.cellWidth=this.getStepWidth(b);b=Math.round(m/r);d=-1;b/2==Math.round(b/2)&&(d=-2,m-=r);k=this.start;
k/2==Math.round(k/2)&&k--;0>k&&(k=0);w=this.end+2;w>=this.data.length&&(w=this.data.length);B=!1;B=!h;this.previousPos=-1E3;20<this.labelRotation&&(this.safeDistance=5);r=k;if(this.data[k].time!=AmCharts.resetDateToMin(new Date(this.data[k].time),e,v,x).getTime())for(x=0,z=m,b=k;b<w;b++)p=this.data[b].time,this.checkPeriodChange(e,v,p,z)&&(x++,2<=x&&(r=b,b=w),z=p);q&&1<v&&(y=this.chooseMinorFrequency(v),AmCharts.getPeriodDuration(e,y));if(0<this.gridCountR)for(b=k;b<w;b++)if(p=this.data[b].time,this.checkPeriodChange(e,
v,p,m)&&b>=r){k=this.getCoordinate(b-this.start);q=!1;this.nextPeriod[s]&&(q=this.checkPeriodChange(this.nextPeriod[s],1,p,m,s));z=!1;q&&this.markPeriodChange?(q=this.dateFormatsObject[this.nextPeriod[s]],z=!0):q=this.dateFormatsObject[s];m=AmCharts.formatDate(new Date(p),q,c);if(b==d&&!h||b==l&&!g)m=" ";B?B=!1:(t||(z=!1),k-this.previousPos>this.safeDistance*Math.cos(this.labelRotation*Math.PI/180)&&(this.labelFunction&&(m=this.labelFunction(m,new Date(p),this,e,v,n)),this.boldLabels&&(z=!0),n=new this.axisItemRenderer(this,
k,m,void 0,void 0,void 0,void 0,z),x=n.graphics(),this.pushAxisItem(n),n=x.getBBox().width,AmCharts.isModern||(n-=k),this.previousPos=k+n));n=m=p}else isNaN(y)||(this.checkPeriodChange(e,y,p,D)&&(this.gridAlpha=this.minorGridAlpha,k=this.getCoordinate(b-this.start),q=new this.axisItemRenderer(this,k),this.pushAxisItem(q),D=p),this.gridAlpha=a)}for(b=0;b<this.data.length;b++)if(h=this.data[b])g=this.parseDates&&!this.equalSpacing?Math.round((h.time-this.startTime)*this.stepWidth+this.cellWidth/2):
this.getCoordinate(b-f),h.x[this.id]=g;h=this.guides.length;for(b=0;b<h;b++)g=this.guides[b],t=t=t=a=d=NaN,y=g.above,g.toCategory&&(t=c.getCategoryIndexByValue(g.toCategory),isNaN(t)||(d=this.getCoordinate(t-f),g.expand&&(d+=this.cellWidth/2),n=new this.axisItemRenderer(this,d,"",!0,NaN,NaN,g),this.pushAxisItem(n,y))),g.category&&(t=c.getCategoryIndexByValue(g.category),isNaN(t)||(a=this.getCoordinate(t-f),g.expand&&(a-=this.cellWidth/2),t=(d-a)/2,n=new this.axisItemRenderer(this,a,g.label,!0,NaN,
t,g),this.pushAxisItem(n,y))),g.toDate&&(g.toDate instanceof Date||(g.toDate=AmCharts.stringToDate(g.toDate,c.dataDateFormat)),this.equalSpacing?(t=c.getClosestIndex(this.data,"time",g.toDate.getTime(),!1,0,this.data.length-1),isNaN(t)||(d=this.getCoordinate(t-f))):d=(g.toDate.getTime()-this.startTime)*this.stepWidth,n=new this.axisItemRenderer(this,d,"",!0,NaN,NaN,g),this.pushAxisItem(n,y)),g.date&&(g.date instanceof Date||(g.date=AmCharts.stringToDate(g.date,c.dataDateFormat)),this.equalSpacing?
(t=c.getClosestIndex(this.data,"time",g.date.getTime(),!1,0,this.data.length-1),isNaN(t)||(a=this.getCoordinate(t-f))):a=(g.date.getTime()-this.startTime)*this.stepWidth,t=(d-a)/2,n="H"==this.orientation?new this.axisItemRenderer(this,a,g.label,!1,2*t,NaN,g):new this.axisItemRenderer(this,a,g.label,!1,NaN,t,g),this.pushAxisItem(n,y)),(0<d||0<a)&&(d<this.width||a<this.width)&&(d=new this.guideFillRenderer(this,a,d,g),a=d.graphics(),this.pushAxisItem(d,y),g.graphics=a,a.index=b,g.balloonText&&this.addEventListeners(a,
g))}this.axisCreated=!0;c=this.x;f=this.y;this.set.translate(c,f);this.labelsSet.translate(c,f);this.positionTitle();(c=this.axisLine.set)&&c.toFront();c=this.getBBox().height;2<c-this.previousHeight&&this.autoWrap&&!this.parseDates&&(this.axisCreated=this.chart.marginsUpdated=!1);this.previousHeight=c},chooseMinorFrequency:function(a){for(var b=10;0<b;b--)if(a/b==Math.round(a/b))return a/b},choosePeriod:function(a){var b=AmCharts.getPeriodDuration(this.periods[a].period,this.periods[a].count),c=
Math.ceil(this.timeDifference/b),d=this.periods;return this.timeDifference<b&&0<a?d[a-1]:c<=this.gridCountR?d[a]:a+1<d.length?this.choosePeriod(a+1):d[a]},getStepWidth:function(a){var b;this.startOnAxis?(b=this.axisWidth/(a-1),1==a&&(b=this.axisWidth)):b=this.axisWidth/a;return b},getCoordinate:function(a){a*=this.stepWidth;this.startOnAxis||(a+=this.stepWidth/2);return Math.round(a)},timeZoom:function(a,b){this.startTime=a;this.endTime=b},minDuration:function(){var a=AmCharts.extractPeriod(this.minPeriod);
return AmCharts.getPeriodDuration(a.period,a.count)},checkPeriodChange:function(a,b,c,d,e){c=new Date(c);var f=new Date(d),l=this.firstDayOfWeek;d=b;"DD"==a&&(b=1);c=AmCharts.resetDateToMin(c,a,b,l).getTime();b=AmCharts.resetDateToMin(f,a,b,l).getTime();return"DD"==a&&"hh"!=e&&c-b<=AmCharts.getPeriodDuration(a,d)?!1:c!=b?!0:!1},generateDFObject:function(){this.dateFormatsObject={};var a;for(a=0;a<this.dateFormats.length;a++){var b=this.dateFormats[a];this.dateFormatsObject[b.period]=b.format}},xToIndex:function(a){var b=
this.data,c=this.chart,d=c.rotate,e=this.stepWidth;this.parseDates&&!this.equalSpacing?(a=this.startTime+Math.round(a/e)-this.minDuration()/2,c=c.getClosestIndex(b,"time",a,!1,this.start,this.end+1)):(this.startOnAxis||(a-=e/2),c=this.start+Math.round(a/e));var c=AmCharts.fitToBounds(c,0,b.length-1),f;b[c]&&(f=b[c].x[this.id]);d?f>this.height+1&&c--:f>this.width+1&&c--;0>f&&c++;return c=AmCharts.fitToBounds(c,0,b.length-1)},dateToCoordinate:function(a){return this.parseDates&&!this.equalSpacing?(a.getTime()-
this.startTime)*this.stepWidth:this.parseDates&&this.equalSpacing?(a=this.chart.getClosestIndex(this.data,"time",a.getTime(),!1,0,this.data.length-1),this.getCoordinate(a-this.start)):NaN},categoryToCoordinate:function(a){return this.chart?(a=this.chart.getCategoryIndexByValue(a),this.getCoordinate(a-this.start)):NaN},coordinateToDate:function(a){return this.equalSpacing?(a=this.xToIndex(a),new Date(this.data[a].time)):new Date(this.startTime+a/this.stepWidth)}});
AmCharts.AmXYChart=AmCharts.Class({inherits:AmCharts.AmRectangularChart,construct:function(a){this.type="xy";AmCharts.AmXYChart.base.construct.call(this,a);this.cname="AmXYChart";this.theme=a;this.createEvents("zoomed");this.maxZoomFactor=20;AmCharts.applyTheme(this,a,this.cname)},initChart:function(){AmCharts.AmXYChart.base.initChart.call(this);this.dataChanged&&(this.updateData(),this.dataChanged=!1,this.dispatchDataUpdated=!0);this.updateScrollbar=!0;this.drawChart();this.autoMargins&&!this.marginsUpdated&&
(this.marginsUpdated=!0,this.measureMargins());var a=this.marginLeftReal,c=this.marginTopReal,b=this.plotAreaWidth,d=this.plotAreaHeight;this.graphsSet.clipRect(a,c,b,d);this.bulletSet.clipRect(a,c,b,d);this.trendLinesSet.clipRect(a,c,b,d)},prepareForExport:function(){var a=this.bulletSet;a.clipPath&&this.container.remove(a.clipPath)},createValueAxes:function(){var a=[],c=[];this.xAxes=a;this.yAxes=c;var b=this.valueAxes,d,e;for(e=0;e<b.length;e++){d=b[e];var f=d.position;if("top"==f||"bottom"==f)d.rotate=
!0;d.setOrientation(d.rotate);f=d.orientation;"V"==f&&c.push(d);"H"==f&&a.push(d)}0===c.length&&(d=new AmCharts.ValueAxis(this.theme),d.rotate=!1,d.setOrientation(!1),b.push(d),c.push(d));0===a.length&&(d=new AmCharts.ValueAxis(this.theme),d.rotate=!0,d.setOrientation(!0),b.push(d),a.push(d));for(e=0;e<b.length;e++)this.processValueAxis(b[e],e);a=this.graphs;for(e=0;e<a.length;e++)this.processGraph(a[e],e)},drawChart:function(){AmCharts.AmXYChart.base.drawChart.call(this);AmCharts.ifArray(this.chartData)?
(this.chartScrollbar&&this.updateScrollbars(),this.zoomChart()):this.cleanChart();if(this.hideXScrollbar){var a=this.scrollbarH;a&&(this.removeListener(a,"zoomed",this.handleHSBZoom),a.destroy());this.scrollbarH=null}if(this.hideYScrollbar){if(a=this.scrollbarV)this.removeListener(a,"zoomed",this.handleVSBZoom),a.destroy();this.scrollbarV=null}if(!this.autoMargins||this.marginsUpdated)this.dispDUpd(),this.chartCreated=!0,this.zoomScrollbars()},cleanChart:function(){AmCharts.callMethod("destroy",[this.valueAxes,
this.graphs,this.scrollbarV,this.scrollbarH,this.chartCursor])},zoomChart:function(){this.toggleZoomOutButton();this.zoomObjects(this.valueAxes);this.zoomObjects(this.graphs);this.zoomTrendLines();this.dispatchAxisZoom()},toggleZoomOutButton:function(){1==this.heightMultiplier&&1==this.widthMultiplier?this.showZB(!1):this.showZB(!0)},dispatchAxisZoom:function(){var a=this.valueAxes,c;for(c=0;c<a.length;c++){var b=a[c];if(!isNaN(b.min)&&!isNaN(b.max)){var d,e;"V"==b.orientation?(d=b.coordinateToValue(-this.verticalPosition),
e=b.coordinateToValue(-this.verticalPosition+this.plotAreaHeight)):(d=b.coordinateToValue(-this.horizontalPosition),e=b.coordinateToValue(-this.horizontalPosition+this.plotAreaWidth));if(!isNaN(d)&&!isNaN(e)){if(d>e){var f=e;e=d;d=f}b.dispatchZoomEvent(d,e)}}}},zoomObjects:function(a){var c=a.length,b;for(b=0;b<c;b++){var d=a[b];this.updateObjectSize(d);d.zoom(0,this.chartData.length-1)}},updateData:function(){this.parseData();var a=this.chartData,c=a.length-1,b=this.graphs,d=this.dataProvider,e=
-Infinity,f=Infinity,k,g;for(k=0;k<b.length;k++)if(g=b[k],g.data=a,g.zoom(0,c),g=g.valueField){var m;for(m=0;m<d.length;m++){var h=Number(d[m][g]);h>e&&(e=h);h<f&&(f=h)}}for(k=0;k<b.length;k++)g=b[k],g.maxValue=e,g.minValue=f;if(a=this.chartCursor)a.updateData(),a.type="crosshair",a.valueBalloonsEnabled=!1},zoomOut:function(){this.verticalPosition=this.horizontalPosition=0;this.heightMultiplier=this.widthMultiplier=1;this.zoomChart();this.zoomScrollbars()},processValueAxis:function(a){a.chart=this;
a.minMaxField="H"==a.orientation?"x":"y";a.minTemp=NaN;a.maxTemp=NaN;this.listenTo(a,"axisSelfZoomed",this.handleAxisSelfZoom)},processGraph:function(a){AmCharts.isString(a.xAxis)&&(a.xAxis=this.getValueAxisById(a.xAxis));AmCharts.isString(a.yAxis)&&(a.yAxis=this.getValueAxisById(a.yAxis));a.xAxis||(a.xAxis=this.xAxes[0]);a.yAxis||(a.yAxis=this.yAxes[0]);a.valueAxis=a.yAxis},parseData:function(){AmCharts.AmXYChart.base.parseData.call(this);this.chartData=[];var a=this.dataProvider,c=this.valueAxes,
b=this.graphs,d;if(a)for(d=0;d<a.length;d++){var e={axes:{},x:{},y:{}},f=a[d],k;for(k=0;k<c.length;k++){var g=c[k].id;e.axes[g]={};e.axes[g].graphs={};var m;for(m=0;m<b.length;m++){var h=b[m],q=h.id;if(h.xAxis.id==g||h.yAxis.id==g){var n={};n.serialDataItem=e;n.index=d;var p={},l=Number(f[h.valueField]);isNaN(l)||(p.value=l);l=Number(f[h.xField]);isNaN(l)||(p.x=l);l=Number(f[h.yField]);isNaN(l)||(p.y=l);l=Number(f[h.errorField]);isNaN(l)||(p.error=l);n.values=p;this.processFields(h,n,f);n.serialDataItem=
e;n.graph=h;e.axes[g].graphs[q]=n}}}this.chartData[d]=e}},formatString:function(a,c,b){var d=c.graph.numberFormatter;d||(d=this.nf);a=AmCharts.formatValue(a,c.values,["value","x","y"],d);-1!=a.indexOf("[[")&&(a=AmCharts.formatDataContextValue(a,c.dataContext));return a=AmCharts.AmXYChart.base.formatString.call(this,a,c,b)},addChartScrollbar:function(a){AmCharts.callMethod("destroy",[this.chartScrollbar,this.scrollbarH,this.scrollbarV]);if(a){this.chartScrollbar=a;this.scrollbarHeight=a.scrollbarHeight;
var c="backgroundColor backgroundAlpha selectedBackgroundColor selectedBackgroundAlpha scrollDuration resizeEnabled hideResizeGrips scrollbarHeight updateOnReleaseOnly".split(" ");if(!this.hideYScrollbar){var b=new AmCharts.SimpleChartScrollbar(this.theme);b.skipEvent=!0;b.chart=this;this.listenTo(b,"zoomed",this.handleVSBZoom);AmCharts.copyProperties(a,b,c);b.rotate=!0;this.scrollbarV=b}this.hideXScrollbar||(b=new AmCharts.SimpleChartScrollbar(this.theme),b.skipEvent=!0,b.chart=this,this.listenTo(b,
"zoomed",this.handleHSBZoom),AmCharts.copyProperties(a,b,c),b.rotate=!1,this.scrollbarH=b)}},updateTrendLines:function(){var a=this.trendLines,c;for(c=0;c<a.length;c++){var b=a[c],b=AmCharts.processObject(b,AmCharts.TrendLine,this.theme);a[c]=b;b.chart=this;var d=b.valueAxis;AmCharts.isString(d)&&(b.valueAxis=this.getValueAxisById(d));d=b.valueAxisX;AmCharts.isString(d)&&(b.valueAxisX=this.getValueAxisById(d));b.valueAxis||(b.valueAxis=this.yAxes[0]);b.valueAxisX||(b.valueAxisX=this.xAxes[0])}},updateMargins:function(){AmCharts.AmXYChart.base.updateMargins.call(this);
var a=this.scrollbarV;a&&(this.getScrollbarPosition(a,!0,this.yAxes[0].position),this.adjustMargins(a,!0));if(a=this.scrollbarH)this.getScrollbarPosition(a,!1,this.xAxes[0].position),this.adjustMargins(a,!1)},updateScrollbars:function(){AmCharts.AmXYChart.base.updateScrollbars.call(this);var a=this.scrollbarV;a&&(this.updateChartScrollbar(a,!0),a.draw());if(a=this.scrollbarH)this.updateChartScrollbar(a,!1),a.draw()},zoomScrollbars:function(){var a=this.scrollbarH;a&&a.relativeZoom(this.widthMultiplier,
-this.horizontalPosition/this.widthMultiplier);(a=this.scrollbarV)&&a.relativeZoom(this.heightMultiplier,-this.verticalPosition/this.heightMultiplier)},fitMultiplier:function(a){a>this.maxZoomFactor&&(a=this.maxZoomFactor);return a},handleHSBZoom:function(a){var c=this.fitMultiplier(a.multiplier);a=-a.position*c;var b=-(this.plotAreaWidth*c-this.plotAreaWidth);a<b&&(a=b);this.widthMultiplier=c;this.horizontalPosition=a;this.zoomChart()},handleVSBZoom:function(a){var c=this.fitMultiplier(a.multiplier);
a=-a.position*c;var b=-(this.plotAreaHeight*c-this.plotAreaHeight);a<b&&(a=b);this.heightMultiplier=c;this.verticalPosition=a;this.zoomChart()},handleAxisSelfZoom:function(a){if("H"==a.valueAxis.orientation){var c=this.fitMultiplier(a.multiplier);a=-a.position*c;var b=-(this.plotAreaWidth*c-this.plotAreaWidth);a<b&&(a=b);this.horizontalPosition=a;this.widthMultiplier=c}else c=this.fitMultiplier(a.multiplier),a=-a.position*c,b=-(this.plotAreaHeight*c-this.plotAreaHeight),a<b&&(a=b),this.verticalPosition=
a,this.heightMultiplier=c;this.zoomChart();c=this.graphs;for(a=0;a<c.length;a++)c[a].setAnimationPlayed();this.zoomScrollbars()},handleCursorZoom:function(a){var c=this.widthMultiplier*this.plotAreaWidth/a.selectionWidth,b=this.heightMultiplier*this.plotAreaHeight/a.selectionHeight,c=this.fitMultiplier(c),b=this.fitMultiplier(b);this.horizontalPosition=(this.horizontalPosition-a.selectionX)*c/this.widthMultiplier;this.verticalPosition=(this.verticalPosition-a.selectionY)*b/this.heightMultiplier;this.widthMultiplier=
c;this.heightMultiplier=b;this.zoomChart();this.zoomScrollbars()},removeChartScrollbar:function(){AmCharts.callMethod("destroy",[this.scrollbarH,this.scrollbarV]);this.scrollbarV=this.scrollbarH=null},handleReleaseOutside:function(a){AmCharts.AmXYChart.base.handleReleaseOutside.call(this,a);AmCharts.callMethod("handleReleaseOutside",[this.scrollbarH,this.scrollbarV])}});
AmCharts.AmExport = AmCharts.Class({
	construct: function(chart, cfg, init ) {
		var _this					= this;
		_this.DEBUG					= false;
		_this.chart					= chart;
		_this.canvas				= null;
		_this.svgs					= [];
		_this.userCFG				= cfg;

		_this.buttonIcon			= 'export.png';
		_this.exportPNG				= true;
		_this.exportPDF				= false;
		_this.exportJPG				= false;
		_this.exportSVG				= false;
		//_this.left;
		_this.right					= 0;
		//_this.bottom;
		_this.top					= 0;
		//_this.color;
		_this.buttonRollOverColor	= "#EFEFEF";
		//_this.buttonColor			= "#FFFFFF";
		//_this.buttonRollOverAlpha	= 0.5;
		_this.textRollOverColor		= "#CC0000";
		_this.buttonTitle			= "Save chart as an image";
		_this.buttonAlpha			= 0.75;
		_this.imageFileName			= "amChart";
		_this.imageBackgroundColor	= "#FFFFFF";

		if (init) {
			_this.init();
		}
	},

	toCoordinate:function(value){
		if(value === undefined){
			return "auto";
		}
		if(String(value).indexOf("%") != -1){
			return value;
		}
		else{
			return value + "px";
		}
	},

	init: function(){
		var _this = this;

		var formats = [];
		if (_this.exportPNG) {
			formats.push("png");
		}
		if (_this.exportPDF) {
			formats.push("pdf");
		}
		if (_this.exportJPG) {
			formats.push("jpg");
		}
		if (_this.exportSVG) {
			formats.push("svg");
		}

		var menuItems = [];
		if(formats.length == 1){
			var format = formats[0];
			menuItems.push({format:format, iconTitle:_this.buttonTitle, icon:_this.chart.pathToImages + _this.buttonIcon})
		}
		else if(formats.length > 1){
			var subItems = [];
			for(var i = 0; i < formats.length; i++){
				subItems.push({format:formats[i], title:formats[i].toUpperCase()});
			}
			menuItems.push({onclick: function() {}, icon:_this.chart.pathToImages + _this.buttonIcon, items:subItems})
		}


		var color = _this.color;
		if(color === undefined){
			color = _this.chart.color;
		}

		var buttonColor = _this.buttonColor;
		if(buttonColor === undefined){
			buttonColor = "transparent";
		}


		_this.cfg = {
			menuTop		: _this.toCoordinate(_this.top),
			menuLeft	: _this.toCoordinate(_this.left),
			menuRight	: _this.toCoordinate(_this.right),
			menuBottom	: _this.toCoordinate(_this.bottom),
			menuItems	: menuItems,
			menuItemStyle: {
				backgroundColor			: buttonColor,
				opacity					:_this.buttonAlpha,
				rollOverBackgroundColor	: _this.buttonRollOverColor,
				color					: color,
				rollOverColor			: _this.textRollOverColor,
				paddingTop				: '6px',
				paddingRight			: '6px',
				paddingBottom			: '6px',
				paddingLeft				: '6px',
				marginTop				: '0px',
				marginRight				: '0px',
				marginBottom			: '0px',
				marginLeft				: '0px',
				textAlign				: 'left',
				textDecoration			: 'none',
				fontFamily				: _this.chart.fontFamily,
				fontSize				: _this.chart.fontSize + 'px'
			},
			menuItemOutput: {
				backgroundColor	: _this.imageBackgroundColor,
				fileName		: _this.imageFileName,
				format			: 'png',
				output			: 'dataurlnewwindow',
				render			: 'browser',
				dpi				: 90,
				onclick			: function(instance, config, event) {
					event.preventDefault();
					instance.output(config);
				}
			},
			removeImagery: true
		};

		_this.processing = {
			buffer: [],
			drawn: 0,
			timer: 0
		};

		// Config dependency adaption
		if (typeof(window.canvg) != 'undefined' && typeof(window.RGBColor) != 'undefined') {
			_this.cfg.menuItemOutput.render = 'canvg';
		}
		if (typeof(window.saveAs) != 'undefined') {
			_this.cfg.menuItemOutput.output = 'save';
		}
		if (AmCharts.isIE && AmCharts.IEversion < 10) {
			_this.cfg.menuItemOutput.output = 'dataurlnewwindow';
		}

		// Merge given configs
		var cfg = _this.userCFG;
		if (cfg) {
			cfg.menuItemOutput = AmCharts.extend(_this.cfg.menuItemOutput, cfg.menuItemOutput || {});
			cfg.menuItemStyle = AmCharts.extend(_this.cfg.menuItemStyle, cfg.menuItemStyle || {});
			_this.cfg = AmCharts.extend(_this.cfg, cfg);
		}

		// Add reference to chart
		_this.chart.AmExport = _this;

		// Listen to the drawer
		_this.chart.addListener('rendered', function() {
			_this.setup();
		});

		// DEBUG; Public reference
		if (_this.DEBUG) {
			window.AmExport = _this;
		}
	},


	/*
	Simple log function for internal purpose
	@param **args
	*/
	log: function() {
		console.log('AmExport: ', arguments);
	},

	/* PUBLIC
	Prepares everything to get exported
	@param none
	*/
	setup: function() {
		var _this = this;

		if (_this.DEBUG == 10) {
			_this.log('SETUP START');
		} // DEBUG


		if (!AmCharts.isIE || (AmCharts.isIE && AmCharts.IEversion > 9)) {
			// Build Buttons
			_this.generateButtons();
			if (_this.DEBUG == 10) {
				_this.log('SETUP END');
			} // DEBUG
		} else {
			if (_this.DEBUG == 10) {
				_this.log('< IE10 NOT SUPPORTED');
			} // DEBUG
		}
	},

	/* PUBLIC
	Decodes base64 string to binary array
	@param base64_string
	@copyright Eli Grey, http://eligrey.com and Devin Samarin, https://github.com/eboyjr
	*/
	generateBinaryArray: function(base64_string) {
		var
		len = base64_string.length,
			buffer = new Uint8Array(len / 4 * 3 | 0),
			i = 0,
			outptr = 0,
			last = [0, 0],
			state = 0,
			save = 0,
			rank, code, undef, base64_ranks = new Uint8Array([
				62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, 0, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51
			]);
		while (len--) {
			code = base64_string.charCodeAt(i++);
			rank = base64_ranks[code - 43];
			if (rank !== 255 && rank !== undef) {
				last[1] = last[0];
				last[0] = code;
				save = (save << 6) | rank;
				state++;
				if (state === 4) {
					buffer[outptr++] = save >>> 16;
					if (last[1] !== 61 /* padding character */ ) {
						buffer[outptr++] = save >>> 8;
					}
					if (last[0] !== 61 /* padding character */ ) {
						buffer[outptr++] = save;
					}
					state = 0;
				}
			}
		}
		// 2/3 chance there's going to be some null bytes at the end, but that
		// doesn't really matter with most image formats.
		// If it somehow matters for you, truncate the buffer up outptr.
		return buffer;
	},

	/*
	Creates blob object
	@param base64_datastring string
	@param type string
	*/
	generateBlob: function(datastring, type) {
		var _this	= this,
		header_end	= type!='image/svg+xml'?datastring.indexOf(',') + 1:0,
		header		= datastring.substring(0, header_end),
		data		= datastring,
		blob		= new Blob();

		if (header.indexOf('base64') != -1) {
			data = _this.generateBinaryArray(datastring.substring(header_end));
		}

		// Fake blob for IE
		if (AmCharts.isIE && AmCharts.IEversion < 10) {
			blob.data = data;
			blob.size = data.length;
			blob.type = type;
			blob.encoding = 'base64';
		} else {
			blob = new Blob([data], {
				type: type
			});
		}
		return blob;
	},

	/*
	Creates PDF object
	@param config object
	*/
	generatePDF: function(cfg) {
		var _this = this,
			pdf = {
				output: function() {
					return '';
				}
			},
			data = _this.canvas.toDataURL('image/jpeg'), // JSPDF ONLY SUPPORTS JPG
			width = (_this.canvas.width * 25.4) / cfg.dpi,
			height = (_this.canvas.height * 25.4) / cfg.dpi;

		// Check
		if (window.jsPDF) {
			pdf = new jsPDF();
			if (pdf.addImage) {
				pdf.addImage(data, 'JPEG', 0, 0, width, height);
			} else {
				alert("Missing jsPDF plugin; Please add the 'addImage' plugin.");
			}
		} else {
			alert("Missing jsPDF lib; Don't forget to add the addImage plugin.");
		}

		return pdf;
	},

	/*
	Creates the CANVAS to receive the image data
	@param format void()
	@param callback; given callback function which returns the blob or datastring of the configured ouput type
	*/
	output: function(cfg, externalCallback) {
		var _this = this;
		cfg = AmCharts.extend(AmCharts.extend({}, _this.cfg.menuItemOutput), cfg || {});

		// Prepare chart
		if(_this.chart.prepareForExport){
			_this.chart.prepareForExport();
		}

		/* PRIVATE
		Callback function which gets called after the drawing process is done
		@param none
		*/
		function internalCallback() {
			var data = null;
			var blob;
			if (_this.DEBUG == 10) {
				_this.log('OUTPUT', cfg.format);
			} // DEBUG

			// SVG
			if (cfg.format == 'image/svg+xml' || cfg.format == 'svg') {
				data = _this.generateSVG();
				blob = _this.generateBlob(data, 'image/svg+xml');

				if (cfg.output == 'save') {
					saveAs(blob, cfg.fileName + '.svg');
				} else if (cfg.output == 'datastring' || cfg.output == 'datauristring' || cfg.output == 'dataurlstring') {
					blob = 'data:image/svg+xml;base64,' + btoa(data);
				} else if (cfg.output == 'dataurlnewwindow') {
					window.open('data:image/svg+xml;base64,' + btoa(data));
				} else if (cfg.output == 'datauri' || cfg.output == 'dataurl') {
					location.href = 'data:image/svg+xml;base64,' + btoa(data);
				} else if (cfg.output == 'datastream') {
					location.href = 'data:image/octet-stream;base64,' + data;
				}

				if (externalCallback)
					externalCallback.apply(_this, [blob]);

				// PDF
			} else if (cfg.format == 'application/pdf' || cfg.format == 'pdf') {
				data = _this.generatePDF(cfg).output('dataurlstring');
				blob = _this.generateBlob(data, 'application/pdf');

				if (cfg.output == 'save') {
					saveAs(blob, cfg.fileName + '.pdf');
				} else if (cfg.output == 'datastring' || cfg.output == 'datauristring' || cfg.output == 'dataurlstring') {
					blob = data;
				} else if (cfg.output == 'dataurlnewwindow') {
					window.open(data);
				} else if (cfg.output == 'datauri' || cfg.output == 'dataurl') {
					location.href = data;
				} else if (cfg.output == 'datastream') {
					location.href = data.replace('application/pdf', 'application/octet-stream');
				}

				if (externalCallback)
					externalCallback.apply(_this, [blob]);

				// PNG
			} else if (cfg.format == 'image/png' || cfg.format == 'png') {
				data = _this.canvas.toDataURL('image/png');
				blob = _this.generateBlob(data, 'image/png');

				if (cfg.output == 'save') {
					saveAs(blob, cfg.fileName + '.png');
				} else if (cfg.output == 'datastring' || cfg.output == 'datauristring' || cfg.output == 'dataurlstring') {
					blob = data;
				} else if (cfg.output == 'dataurlnewwindow') {
					window.open(data);
				} else if (cfg.output == 'datauri' || cfg.output == 'dataurl') {
					location.href = data;
				} else if (cfg.output == 'datastream') {
					location.href = data.replace('image/png', 'image/octet-stream');
				}

				if (externalCallback)
					externalCallback.apply(_this, [blob]);

				// JPG
			} else if (cfg.format == 'image/jpeg' || cfg.format == 'jpeg' || cfg.format == 'jpg') {
				data = _this.canvas.toDataURL('image/jpeg');
				blob = _this.generateBlob(data, 'image/jpeg');

				if (cfg.output == 'save') {
					saveAs(blob, cfg.fileName + '.jpg');
				} else if (cfg.output == 'datastring' || cfg.output == 'datauristring' || cfg.output == 'dataurlstring') {
					blob = data;
				} else if (cfg.output == 'dataurlnewwindow') {
					window.open(data);
				} else if (cfg.output == 'datauri' || cfg.output == 'dataurl') {
					location.href = data;
				} else if (cfg.output == 'datastream') {
					location.href = data.replace('image/jpeg', 'image/octet-stream');
				}

				if (externalCallback)
					externalCallback.apply(_this, [blob]);
			}

		}

		return _this.generateOutput(cfg, internalCallback);
	},

	/* PUBLIC
	Polifies missing attributes to the SVG and replaces images to embedded base64 images
	@param none
	*/
	polifySVG: function(svg) {
		var _this	= this;

		// Recursive function to force the attributes
		function recursiveChange(svg, tag) {
			var items	= svg.getElementsByTagName(tag);
			var i		= items.length;

			while(i--) {
				if (_this.cfg.removeImagery) {
					items[i].parentNode.removeChild(items[i]);

				} else {
					var image		= document.createElement('img');
					var canvas		= document.createElement('canvas');
					var ctx			= canvas.getContext('2d');

					canvas.width	= items[i].getAttribute('width');
					canvas.height	= items[i].getAttribute('height');
					image.src		= items[i].getAttribute('xlink:href');
					image.width		= items[i].getAttribute('width');
					image.height	= items[i].getAttribute('height');

					try {
						ctx.drawImage(image, 0, 0, image.width, image.height);
						datastring = canvas.toDataURL(); // image.src; // canvas.toDataURL(); //
					} catch (err) {
						datastring = image.src; // image.src; // canvas.toDataURL(); //

						_this.log('Tainted canvas, reached browser CORS security; origin from imagery must be equal to the server!');
						throw new Error(err);
					}

					items[i].setAttribute('xlink:href', datastring);
				}

				if (_this.DEBUG == 10) {
					_this.log('POLIFIED', items[i]);
				} // DEBUG
			}
		}

		// Put some attrs to it; fixed 20/03/14 xmlns is required to produce a valid svg file
		if (AmCharts.IEversion == 0) {
			svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
			if ( !_this.cfg.removeImagery ) {
				svg.setAttribute('xmlns:xlink','http://www.w3.org/1999/xlink');
			}
		}

		// DEBUG
		if (_this.DEBUG == 10) {
			_this.log('POLIFIED', svg);
		}

		// Force link adaption
		recursiveChange(svg, 'pattern');
		recursiveChange(svg, 'image');

		_this.svgs.push(svg);

		return svg;
	},


	/* PUBLIC
	Stacks multiple SVGs into one
	@param none
	*/
	generateSVG: function() {
		var _this	= this;
		var context	= document.createElement('svg');
		context.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
		context.setAttribute('xmlns:xlink','http://www.w3.org/1999/xlink');

		for (var i = 0; i < _this.processing.buffer.length; i++) {
			var group	= document.createElement('g'),
				data	= _this.processing.buffer[i];

			data[0].setAttribute('xmlns', 'http://www.w3.org/2000/svg');
			data[0].setAttribute('xmlns:xlink','http://www.w3.org/1999/xlink');

			group.setAttribute('transform', 'translate('+data[1].x+','+data[1].y+')');
			group.appendChild(data[0]);
			context.appendChild(group);
		}

		return new XMLSerializer().serializeToString(context);
	},

	/* PUBLIC
	Generates the canvas with the given SVGs and configured renderer
	@param callback; function(); gets called after drawing process on the canvas has been finished
	*/
	generateOutput: function(cfg, callback) {
		var _this	= this,
		coll		= [],
		svgs		= [],
		canvas		= document.createElement('canvas'),
		context		= canvas.getContext('2d'),
		offset		= {
			y: 0,
			x: 0
		},

		// Push svgs into array
		coll = _this.chart.div.getElementsByTagName('svg');
		for ( var i = 0; i < coll.length; i++ ) svgs.push(coll[i]);

		// Add external legend
		if ( _this.chart.legend && _this.chart.legend.position == 'outside' ) {
			_this.chart.legend.container.container.externalLegend = true
			svgs.push(_this.chart.legend.container.container);

			// Add offset
			if ( _this.cfg.legendPosition == 'left' ) {
				offset.x = _this.chart.legend.div.offsetWidth;
			} else if ( _this.cfg.legendPosition == 'top' ) {
				offset.y = _this.chart.legend.div.offsetHeight;
			} else if ( typeof _this.cfg.legendPosition == 'object' ) {
				offset.y = _this.cfg.legendPosition.chartTop;
				offset.x = _this.cfg.legendPosition.chartLeft;
			}
		}

		// Reset
		_this.processing.buffer	= [];
		_this.processing.drawn	= 0;
		_this.canvas			= canvas;
		_this.svgs				= [];

		// Walkthroug SVGs
		if (_this.DEBUG == 10) {
			_this.log('START EXPORT');
		} // DEBUG
		if (_this.DEBUG == 10) {
			_this.log('START BUFFERING');
		} // DEBUG
		for (var i = 0; i < svgs.length; i++) {
			var parent	= svgs[i].parentNode,
			svgX		= Number(parent.style.left.slice(0, -2)),
			svgY		= Number(parent.style.top.slice(0, -2)),
			svgClone	= _this.polifySVG(svgs[i].cloneNode(true)),
			tmp			= AmCharts.extend({}, offset);

			// Add external legend
			if ( svgs[i].externalLegend ) {
				if ( _this.cfg.legendPosition == 'right' ) {
					offset.y = 0;
					offset.x = _this.chart.divRealWidth;

				} else if ( _this.cfg.legendPosition == 'bottom' ) {
					offset.y = svgY ? svgY : offset.y;

				} else if ( typeof _this.cfg.legendPosition == 'object' ) {
					offset.x = _this.cfg.legendPosition.left;
					offset.y = _this.cfg.legendPosition.top;

				} else {
					offset.x = 0;
					offset.y = 0;
				}

			// Overtake parent position if given; fixed 20/03/14 distinguish between relativ and others
			} else {
				if ( parent.style.position == 'relative' ) {
					offset.x = svgX ? svgX : offset.x;
					offset.y = svgY ? svgY : offset.y;
				} else {
					offset.x = svgX;
					offset.y = svgY;
				}
			}

			_this.processing.buffer.push([svgClone, AmCharts.extend({}, offset)]);

			// Put back from "cache"
			if (svgY && svgX) {
				offset = tmp;

			// New offset for next one
			} else {
				offset.y += svgY ? 0 : parent.offsetHeight;
			}

			if (_this.DEBUG == 10) {
				_this.log('BUFFERED', svgs[i], offset);
			} // DEBUG
		}
		if (_this.DEBUG == 10) {
			_this.log('END BUFFERING');
		} // DEBUG

		// Apply background
		if (_this.DEBUG == 10) {
			_this.log('START DRAWING', cfg.render);
		} // DEBUG
		if (_this.DEBUG == 10) {
			_this.log('FILL BACKGROUND');
		} // DEBUG
		canvas.id		= AmCharts.getUniqueId();
		canvas.width	= _this.chart.divRealWidth;
		canvas.height	= _this.chart.divRealHeight;

		// External legend exception
		if ( _this.chart.legend && _this.chart.legend.position == "outside" ) {
			if ( ['left','right'].indexOf(_this.cfg.legendPosition) != -1 ) {
				canvas.width	+= _this.chart.legend.div.offsetWidth;

			} else if ( typeof _this.cfg.legendPosition == 'object' ) {
				canvas.width	+= _this.cfg.legendPosition.width;
				canvas.height	+= _this.cfg.legendPosition.height;

			} else {
				canvas.height	+= _this.chart.legend.div.offsetHeight;
			}
		}

		// Stockchart exception
		var adapted = {
			width: false,
			height: false
		};
		if ( _this.chart.periodSelector ) {
			if ( ['left','right'].indexOf(_this.chart.periodSelector.position) != -1 ) {
				canvas.width -= _this.chart.periodSelector.div.offsetWidth + 16;
				adapted.width = true;
			} else {
				canvas.height -= _this.chart.periodSelector.div.offsetHeight;
				adapted.height = true;
			}
		}

		if ( _this.chart.dataSetSelector ) {
			if ( ['left','right'].indexOf(_this.chart.dataSetSelector.position) != -1 ) {
				if ( !adapted.width ) {
					canvas.width -= _this.chart.dataSetSelector.div.offsetWidth + 16;
				}
			} else {
				canvas.height -= _this.chart.dataSetSelector.div.offsetHeight;
			}
		}

		// Set given background; jpeg default
		if (cfg.backgroundColor || cfg.format == 'image/jpeg') {
			context.fillStyle = cfg.backgroundColor || '#FFFFFF';
			context.fillRect(0, 0, canvas.width, canvas.height);
		}

		/* PRIVATE
		Recursive function to draw the images to the canvas;
		@param none;
		*/
		function drawItWhenItsLoaded() {
			var img, buffer, offset, source;

			// DRAWING PROCESS DONE
			if (_this.processing.buffer.length == _this.processing.drawn || cfg.format == 'svg' ) {
				if (_this.DEBUG == 10) {
					_this.log('END DRAWING');
				} // DEBUG
				return callback();

				// LOOPING LUI
			} else {
				if (_this.DEBUG == 10) {
					_this.log('DRAW', _this.processing.drawn + 1, 'OF', _this.processing.buffer.length);
				} // DEBUG

				buffer = _this.processing.buffer[_this.processing.drawn];
				source = new XMLSerializer().serializeToString(buffer[0]); //source = 'data:image/svg+xml;base64,' + btoa();
				offset = buffer[1];

				if (_this.DEBUG == 10) {
					_this.log('SOURCE', source);
				} // DEBUG

				// NATIVE
				if (cfg.render == 'browser') {
					img		= new Image();
					img.id	= AmCharts.getUniqueId();
					source	= 'data:image/svg+xml;base64,' + btoa(source);

					//img.crossOrigin	= "Anonymous";
					img.onload = function() {
						context.drawImage(this, buffer[1].x, buffer[1].y);
						_this.processing.drawn++;

						if (_this.DEBUG == 10) {
							_this.log('ONLOAD', this);
						} // DEBUG
						drawItWhenItsLoaded();
					};
					img.onerror = function() {
						if (_this.DEBUG == 10) {
							_this.log('ONERROR', this);
						} // DEBUG
						context.drawImage(this, buffer[1].x, buffer[1].y);
						_this.processing.drawn++;
						drawItWhenItsLoaded();
					};
					img.src = source;

					if (_this.DEBUG == 10) {
						_this.log('ADD', img);
					} // DEBUG
					if (img.complete || typeof(img.complete) == 'undefined' || img.complete === undefined) {
						if (_this.DEBUG == 10) {
							_this.log('FORCE ONLOAD', img);
						} // DEBUG
						img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
						img.src = source;
					}

					// CANVG
				} else if (cfg.render == 'canvg') {
					canvg(canvas, source, {
						offsetX: offset.x,
						offsetY: offset.y,
						ignoreMouse: true,
						ignoreAnimation: true,
						ignoreDimensions: true,
						ignoreClear: true,
						renderCallback: function() {
							_this.processing.drawn++;
							drawItWhenItsLoaded();
						}
					});
				}
			}
		}
		return drawItWhenItsLoaded();
	},

	/*
	Generates the export menu to trigger the exportation
	@param none;
	*/
	generateButtons: function() {
		var _this = this,lvl = 0;

		if(_this.div){
			div = _this.div;
			div.innerHTML = "";
		}
		else{
			div = document.createElement('div'),
			_this.div = div;
		}

		// Push sublings
		function createList(items) {
			var ul = document.createElement('ul');

			ul.setAttribute('style', 'list-style: none; margin: 0; padding: 0;');

			// Walkthrough items
			for (var i = 0; i < items.length; i++) {
				var li = document.createElement('li'),
					img = document.createElement('img'),
					a = document.createElement('a'),
					item = items[i],
					children = null,
					itemStyle = AmCharts.extend(AmCharts.extend({}, _this.cfg.menuItemStyle), items[i]);

				// MERGE CFG
				item = AmCharts.extend(AmCharts.extend({}, _this.cfg.menuItemOutput), item);

				// ICON
				if (item['icon']) {
					img.alt = '';
					img.src = item['icon'];
					img.setAttribute('style', 'margin: 0 auto;border: none;outline: none');
					if (item['iconTitle']) {
						img.title = item['iconTitle'];
					}
					a.appendChild(img);
				}

				// TITLE; STYLING
				a.href = '#';
				if (item['title']) {
					img.setAttribute('style', 'margin: 0px 5px;');
					a.innerHTML += item.title;
				}
				a.setAttribute('style', 'display: block;');
				AmCharts.extend(a.style, itemStyle);

				// ONCLICK
				a.onclick = item.onclick.bind(a, _this, item);
				li.appendChild(a);

				// APPEND SIBLINGS
				if (item.items) {
					children = createList(item.items);
					li.appendChild(children);

					li.onmouseover = function() {
						children.style.display = 'block';
					};
					li.onmouseout = function() {
						children.style.display = 'none';
					};
					children.style.display = 'none';
				}

				// Append to parent
				ul.appendChild(li);

				// Apply hover
				a.onmouseover = function() {
					this.style.backgroundColor = itemStyle.rollOverBackgroundColor;
					this.style.color = itemStyle.rollOverColor;
					this.style.borderColor = itemStyle.rollOverBorderColor;
				};
				a.onmouseout = function() {
					this.style.backgroundColor = itemStyle.backgroundColor;
					this.style.color = itemStyle.color;
					this.style.borderColor = itemStyle.borderColor;
				};
			}
			lvl++;

			if (_this.DEBUG == 10) {
				_this.log('MENU', ul);
			} // DEBUG

			return ul;
		}

		// Style wrapper; Push into chart div
		div.setAttribute('style', 'position: absolute;top:' + _this.cfg.menuTop + ';right:' + _this.cfg.menuRight + ';bottom:' + _this.cfg.menuBottom + ';left:' + _this.cfg.menuLeft + ';');
		div.setAttribute('class', 'amExportButton');
		div.appendChild(createList(_this.cfg.menuItems));
		_this.chart.containerDiv.appendChild(div);
	}
});
/*
 * canvg.js - Javascript SVG parser and renderer on Canvas
 * MIT Licensed 
 * Gabe Lerner (gabelerner@gmail.com)
 * http://code.google.com/p/canvg/
 *
 * Requires: rgbcolor.js - http://www.phpied.com/rgb-color-parser-in-javascript/
 */
(function(){
	// canvg(target, s)
	// empty parameters: replace all 'svg' elements on page with 'canvas' elements
	// target: canvas element or the id of a canvas element
	// s: svg string, url to svg file, or xml document
	// opts: optional hash of options
	//		 ignoreMouse: true => ignore mouse events
	//		 ignoreAnimation: true => ignore animations
	//		 ignoreDimensions: true => does not try to resize canvas
	//		 ignoreClear: true => does not clear canvas
	//		 offsetX: int => draws at a x offset
	//		 offsetY: int => draws at a y offset
	//		 scaleWidth: int => scales horizontally to width
	//		 scaleHeight: int => scales vertically to height
	//		 renderCallback: function => will call the function after the first render is completed
	//		 forceRedraw: function => will call the function on every frame, if it returns true, will redraw
	this.canvg = function (target, s, opts) {
		// no parameters
		if (target == null && s == null && opts == null) {
			var svgTags = document.getElementsByTagName('svg');
			for (var i=0; i<svgTags.length; i++) {
				var svgTag = svgTags[i];
				var c = document.createElement('canvas');
				c.width = svgTag.clientWidth;
				c.height = svgTag.clientHeight;
				svgTag.parentNode.insertBefore(c, svgTag);
				svgTag.parentNode.removeChild(svgTag);
				var div = document.createElement('div');
				div.appendChild(svgTag);
				canvg(c, div.innerHTML);
			}
			return;
		}	
		opts = opts || {};
	
		if (typeof target == 'string') {
			target = document.getElementById(target);
		}
		
		// store class on canvas
		if (target.svg != null) target.svg.stop();
		var svg = build();
		// on i.e. 8 for flash canvas, we can't assign the property so check for it
		if (!(target.childNodes.length == 1 && target.childNodes[0].nodeName == 'OBJECT')) target.svg = svg;
		svg.opts = opts;
		
		var ctx = target.getContext('2d');
		if (typeof(s.documentElement) != 'undefined') {
			// load from xml doc
			svg.loadXmlDoc(ctx, s);
		}
		else if (s.substr(0,1) == '<') {
			// load from xml string
			svg.loadXml(ctx, s);
		}
		else {
			// load from url
			svg.load(ctx, s);
		}
	}

	function build() {
		var svg = { };
		
		svg.FRAMERATE = 30;
		svg.MAX_VIRTUAL_PIXELS = 30000;
		
		// globals
		svg.init = function(ctx) {
			var uniqueId = 0;
			svg.UniqueId = function () { uniqueId++; return 'canvg' + uniqueId;	};
			svg.Definitions = {};
			svg.Styles = {};
			svg.Animations = [];
			svg.Images = [];
			svg.ctx = ctx;
			svg.ViewPort = new (function () {
				this.viewPorts = [];
				this.Clear = function() { this.viewPorts = []; }
				this.SetCurrent = function(width, height) { this.viewPorts.push({ width: width, height: height }); }
				this.RemoveCurrent = function() { this.viewPorts.pop(); }
				this.Current = function() { return this.viewPorts[this.viewPorts.length - 1]; }
				this.width = function() { return this.Current().width; }
				this.height = function() { return this.Current().height; }
				this.ComputeSize = function(d) {
					if (d != null && typeof(d) == 'number') return d;
					if (d == 'x') return this.width();
					if (d == 'y') return this.height();
					return Math.sqrt(Math.pow(this.width(), 2) + Math.pow(this.height(), 2)) / Math.sqrt(2);			
				}
			});
		}
		svg.init();
		
		// images loaded
		svg.ImagesLoaded = function() { 
			for (var i=0; i<svg.Images.length; i++) {
				if (!svg.Images[i].loaded) return false;
			}
			return true;
		}

		// trim
		svg.trim = function(s) { return s.replace(/^\s+|\s+$/g, ''); }
		
		// compress spaces
		svg.compressSpaces = function(s) { return s.replace(/[\s\r\t\n]+/gm,' '); }
		
		// ajax
		svg.ajax = function(url) {
			var AJAX;
			if(window.XMLHttpRequest){AJAX=new XMLHttpRequest();}
			else{AJAX=new ActiveXObject('Microsoft.XMLHTTP');}
			if(AJAX){
			   AJAX.open('GET',url,false);
			   AJAX.send(null);
			   return AJAX.responseText;
			}
			return null;
		} 
		
		// parse xml
		
		svg.parseXml = function(xml) {			
			if (window.DOMParser)
			{
				var parser = new DOMParser();
				return parser.parseFromString(xml, 'text/xml');
			}
			else 
			{
				xml = xml.replace(/<!DOCTYPE svg[^>]*>/, '');
				var xmlDoc = new ActiveXObject('Microsoft.XMLDOM');
				xmlDoc.async = 'false';
				xmlDoc.loadXML(xml); 
				return xmlDoc;
			}		
		}
		
		svg.Property = function(name, value) {
			this.name = name;
			this.value = value;
		}	
			svg.Property.prototype.getValue = function() {
				return this.value;
			}
		
			svg.Property.prototype.hasValue = function() {
				return (this.value != null && this.value !== '');
			}
							
			// return the numerical value of the property
			svg.Property.prototype.numValue = function() {
				if (!this.hasValue()) return 0;
				
				var n = parseFloat(this.value);
				if ((this.value + '').match(/%$/)) {
					n = n / 100.0;
				}
				return n;
			}
			
			svg.Property.prototype.valueOrDefault = function(def) {
				if (this.hasValue()) return this.value;
				return def;
			}
			
			svg.Property.prototype.numValueOrDefault = function(def) {
				if (this.hasValue()) return this.numValue();
				return def;
			}
			
			// color extensions
				// augment the current color value with the opacity
				svg.Property.prototype.addOpacity = function(opacity) {
					var newValue = this.value;
					if (opacity != null && opacity != '' && typeof(this.value)=='string') { // can only add opacity to colors, not patterns
						var color = new RGBColor(this.value);
						if (color.ok) {
							newValue = 'rgba(' + color.r + ', ' + color.g + ', ' + color.b + ', ' + opacity + ')';
						}
					}
					return new svg.Property(this.name, newValue);
				}
			
			// definition extensions
				// get the definition from the definitions table
				svg.Property.prototype.getDefinition = function() {
					var name = this.value.match(/#([^\)'"]+)/);
					if (name) { name = name[1]; }
					if (!name) { name = this.value; }
					return svg.Definitions[name];
				}
				
				svg.Property.prototype.isUrlDefinition = function() {
					return this.value.indexOf('url(') == 0
				}
				
				svg.Property.prototype.getFillStyleDefinition = function(e, opacityProp) {
					var def = this.getDefinition();
					
					// gradient
					if (def != null && def.createGradient) {
						return def.createGradient(svg.ctx, e, opacityProp);
					}
					
					// pattern
					if (def != null && def.createPattern) {
						if (def.getHrefAttribute().hasValue()) {
							var pt = def.attribute('patternTransform');
							def = def.getHrefAttribute().getDefinition();
							if (pt.hasValue()) { def.attribute('patternTransform', true).value = pt.value; }
						}
						return def.createPattern(svg.ctx, e);
					}
					
					return null;
				}
			
			// length extensions
				svg.Property.prototype.getDPI = function(viewPort) {
					return 96.0; // TODO: compute?
				}
				
				svg.Property.prototype.getEM = function(viewPort) {
					var em = 12;
					
					var fontSize = new svg.Property('fontSize', svg.Font.Parse(svg.ctx.font).fontSize);
					if (fontSize.hasValue()) em = fontSize.toPixels(viewPort);
					
					return em;
				}
				
				svg.Property.prototype.getUnits = function() {
					var s = this.value+'';
					return s.replace(/[0-9\.\-]/g,'');
				}
			
				// get the length as pixels
				svg.Property.prototype.toPixels = function(viewPort, processPercent) {
					if (!this.hasValue()) return 0;
					var s = this.value+'';
					if (s.match(/em$/)) return this.numValue() * this.getEM(viewPort);
					if (s.match(/ex$/)) return this.numValue() * this.getEM(viewPort) / 2.0;
					if (s.match(/px$/)) return this.numValue();
					if (s.match(/pt$/)) return this.numValue() * this.getDPI(viewPort) * (1.0 / 72.0);
					if (s.match(/pc$/)) return this.numValue() * 15;
					if (s.match(/cm$/)) return this.numValue() * this.getDPI(viewPort) / 2.54;
					if (s.match(/mm$/)) return this.numValue() * this.getDPI(viewPort) / 25.4;
					if (s.match(/in$/)) return this.numValue() * this.getDPI(viewPort);
					if (s.match(/%$/)) return this.numValue() * svg.ViewPort.ComputeSize(viewPort);
					var n = this.numValue();
					if (processPercent && n < 1.0) return n * svg.ViewPort.ComputeSize(viewPort);
					return n;
				}

			// time extensions
				// get the time as milliseconds
				svg.Property.prototype.toMilliseconds = function() {
					if (!this.hasValue()) return 0;
					var s = this.value+'';
					if (s.match(/s$/)) return this.numValue() * 1000;
					if (s.match(/ms$/)) return this.numValue();
					return this.numValue();
				}
			
			// angle extensions
				// get the angle as radians
				svg.Property.prototype.toRadians = function() {
					if (!this.hasValue()) return 0;
					var s = this.value+'';
					if (s.match(/deg$/)) return this.numValue() * (Math.PI / 180.0);
					if (s.match(/grad$/)) return this.numValue() * (Math.PI / 200.0);
					if (s.match(/rad$/)) return this.numValue();
					return this.numValue() * (Math.PI / 180.0);
				}
		
		// fonts
		svg.Font = new (function() {
			this.Styles = 'normal|italic|oblique|inherit';
			this.Variants = 'normal|small-caps|inherit';
			this.Weights = 'normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit';
			
			this.CreateFont = function(fontStyle, fontVariant, fontWeight, fontSize, fontFamily, inherit) { 
				var f = inherit != null ? this.Parse(inherit) : this.CreateFont('', '', '', '', '', svg.ctx.font);
				return { 
					fontFamily: fontFamily || f.fontFamily, 
					fontSize: fontSize || f.fontSize, 
					fontStyle: fontStyle || f.fontStyle, 
					fontWeight: fontWeight || f.fontWeight, 
					fontVariant: fontVariant || f.fontVariant,
					toString: function () { return [this.fontStyle, this.fontVariant, this.fontWeight, this.fontSize, this.fontFamily].join(' ') } 
				} 
			}
			
			var that = this;
			this.Parse = function(s) {
				var f = {};
				var d = svg.trim(svg.compressSpaces(s || '')).split(' ');
				var set = { fontSize: false, fontStyle: false, fontWeight: false, fontVariant: false }
				var ff = '';
				for (var i=0; i<d.length; i++) {
					if (!set.fontStyle && that.Styles.indexOf(d[i]) != -1) { if (d[i] != 'inherit') f.fontStyle = d[i]; set.fontStyle = true; }
					else if (!set.fontVariant && that.Variants.indexOf(d[i]) != -1) { if (d[i] != 'inherit') f.fontVariant = d[i]; set.fontStyle = set.fontVariant = true;	}
					else if (!set.fontWeight && that.Weights.indexOf(d[i]) != -1) {	if (d[i] != 'inherit') f.fontWeight = d[i]; set.fontStyle = set.fontVariant = set.fontWeight = true; }
					else if (!set.fontSize) { if (d[i] != 'inherit') f.fontSize = d[i].split('/')[0]; set.fontStyle = set.fontVariant = set.fontWeight = set.fontSize = true; }
					else { if (d[i] != 'inherit') ff += d[i]; }
				} if (ff != '') f.fontFamily = ff;
				return f;
			}
		});
		
		// points and paths
		svg.ToNumberArray = function(s) {
			var a = svg.trim(svg.compressSpaces((s || '').replace(/,/g, ' '))).split(' ');
			for (var i=0; i<a.length; i++) {
				a[i] = parseFloat(a[i]);
			}
			return a;
		}		
		svg.Point = function(x, y) {
			this.x = x;
			this.y = y;
		}	
			svg.Point.prototype.angleTo = function(p) {
				return Math.atan2(p.y - this.y, p.x - this.x);
			}
			
			svg.Point.prototype.applyTransform = function(v) {
				var xp = this.x * v[0] + this.y * v[2] + v[4];
				var yp = this.x * v[1] + this.y * v[3] + v[5];
				this.x = xp;
				this.y = yp;
			}

		svg.CreatePoint = function(s) {
			var a = svg.ToNumberArray(s);
			return new svg.Point(a[0], a[1]);
		}
		svg.CreatePath = function(s) {
			var a = svg.ToNumberArray(s);
			var path = [];
			for (var i=0; i<a.length; i+=2) {
				path.push(new svg.Point(a[i], a[i+1]));
			}
			return path;
		}
		
		// bounding box
		svg.BoundingBox = function(x1, y1, x2, y2) { // pass in initial points if you want
			this.x1 = Number.NaN;
			this.y1 = Number.NaN;
			this.x2 = Number.NaN;
			this.y2 = Number.NaN;
			
			this.x = function() { return this.x1; }
			this.y = function() { return this.y1; }
			this.width = function() { return this.x2 - this.x1; }
			this.height = function() { return this.y2 - this.y1; }
			
			this.addPoint = function(x, y) {	
				if (x != null) {
					if (isNaN(this.x1) || isNaN(this.x2)) {
						this.x1 = x;
						this.x2 = x;
					}
					if (x < this.x1) this.x1 = x;
					if (x > this.x2) this.x2 = x;
				}
			
				if (y != null) {
					if (isNaN(this.y1) || isNaN(this.y2)) {
						this.y1 = y;
						this.y2 = y;
					}
					if (y < this.y1) this.y1 = y;
					if (y > this.y2) this.y2 = y;
				}
			}			
			this.addX = function(x) { this.addPoint(x, null); }
			this.addY = function(y) { this.addPoint(null, y); }
			
			this.addBoundingBox = function(bb) {
				this.addPoint(bb.x1, bb.y1);
				this.addPoint(bb.x2, bb.y2);
			}
			
			this.addQuadraticCurve = function(p0x, p0y, p1x, p1y, p2x, p2y) {
				var cp1x = p0x + 2/3 * (p1x - p0x); // CP1 = QP0 + 2/3 *(QP1-QP0)
				var cp1y = p0y + 2/3 * (p1y - p0y); // CP1 = QP0 + 2/3 *(QP1-QP0)
				var cp2x = cp1x + 1/3 * (p2x - p0x); // CP2 = CP1 + 1/3 *(QP2-QP0)
				var cp2y = cp1y + 1/3 * (p2y - p0y); // CP2 = CP1 + 1/3 *(QP2-QP0)
				this.addBezierCurve(p0x, p0y, cp1x, cp2x, cp1y,	cp2y, p2x, p2y);
			}
			
			this.addBezierCurve = function(p0x, p0y, p1x, p1y, p2x, p2y, p3x, p3y) {
				// from http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html
				var p0 = [p0x, p0y], p1 = [p1x, p1y], p2 = [p2x, p2y], p3 = [p3x, p3y];
				this.addPoint(p0[0], p0[1]);
				this.addPoint(p3[0], p3[1]);
				
				for (i=0; i<=1; i++) {
					var f = function(t) { 
						return Math.pow(1-t, 3) * p0[i]
						+ 3 * Math.pow(1-t, 2) * t * p1[i]
						+ 3 * (1-t) * Math.pow(t, 2) * p2[i]
						+ Math.pow(t, 3) * p3[i];
					}
					
					var b = 6 * p0[i] - 12 * p1[i] + 6 * p2[i];
					var a = -3 * p0[i] + 9 * p1[i] - 9 * p2[i] + 3 * p3[i];
					var c = 3 * p1[i] - 3 * p0[i];
					
					if (a == 0) {
						if (b == 0) continue;
						var t = -c / b;
						if (0 < t && t < 1) {
							if (i == 0) this.addX(f(t));
							if (i == 1) this.addY(f(t));
						}
						continue;
					}
					
					var b2ac = Math.pow(b, 2) - 4 * c * a;
					if (b2ac < 0) continue;
					var t1 = (-b + Math.sqrt(b2ac)) / (2 * a);
					if (0 < t1 && t1 < 1) {
						if (i == 0) this.addX(f(t1));
						if (i == 1) this.addY(f(t1));
					}
					var t2 = (-b - Math.sqrt(b2ac)) / (2 * a);
					if (0 < t2 && t2 < 1) {
						if (i == 0) this.addX(f(t2));
						if (i == 1) this.addY(f(t2));
					}
				}
			}
			
			this.isPointInBox = function(x, y) {
				return (this.x1 <= x && x <= this.x2 && this.y1 <= y && y <= this.y2);
			}
			
			this.addPoint(x1, y1);
			this.addPoint(x2, y2);
		}
		
		// transforms
		svg.Transform = function(v) {	
			var that = this;
			this.Type = {}
		
			// translate
			this.Type.translate = function(s) {
				this.p = svg.CreatePoint(s);			
				this.apply = function(ctx) {
					ctx.translate(this.p.x || 0.0, this.p.y || 0.0);
				}
				this.unapply = function(ctx) {
					ctx.translate(-1.0 * this.p.x || 0.0, -1.0 * this.p.y || 0.0);
				}
				this.applyToPoint = function(p) {
					p.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);
				}
			}
			
			// rotate
			this.Type.rotate = function(s) {
				var a = svg.ToNumberArray(s);
				this.angle = new svg.Property('angle', a[0]);
				this.cx = a[1] || 0;
				this.cy = a[2] || 0;
				this.apply = function(ctx) {
					ctx.translate(this.cx, this.cy);
					ctx.rotate(this.angle.toRadians());
					ctx.translate(-this.cx, -this.cy);
				}
				this.unapply = function(ctx) {
					ctx.translate(this.cx, this.cy);
					ctx.rotate(-1.0 * this.angle.toRadians());
					ctx.translate(-this.cx, -this.cy);
				}
				this.applyToPoint = function(p) {
					var a = this.angle.toRadians();
					p.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);
					p.applyTransform([Math.cos(a), Math.sin(a), -Math.sin(a), Math.cos(a), 0, 0]);
					p.applyTransform([1, 0, 0, 1, -this.p.x || 0.0, -this.p.y || 0.0]);
				}			
			}
			
			this.Type.scale = function(s) {
				this.p = svg.CreatePoint(s);
				this.apply = function(ctx) {
					ctx.scale(this.p.x || 1.0, this.p.y || this.p.x || 1.0);
				}
				this.unapply = function(ctx) {
					ctx.scale(1.0 / this.p.x || 1.0, 1.0 / this.p.y || this.p.x || 1.0);
				}
				this.applyToPoint = function(p) {
					p.applyTransform([this.p.x || 0.0, 0, 0, this.p.y || 0.0, 0, 0]);
				}				
			}
			
			this.Type.matrix = function(s) {
				this.m = svg.ToNumberArray(s);
				this.apply = function(ctx) {
					ctx.transform(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5]);
				}
				this.applyToPoint = function(p) {
					p.applyTransform(this.m);
				}					
			}
			
			this.Type.SkewBase = function(s) {
				this.base = that.Type.matrix;
				this.base(s);
				this.angle = new svg.Property('angle', s);
			}
			this.Type.SkewBase.prototype = new this.Type.matrix;
			
			this.Type.skewX = function(s) {
				this.base = that.Type.SkewBase;
				this.base(s);
				this.m = [1, 0, Math.tan(this.angle.toRadians()), 1, 0, 0];
			}
			this.Type.skewX.prototype = new this.Type.SkewBase;
			
			this.Type.skewY = function(s) {
				this.base = that.Type.SkewBase;
				this.base(s);
				this.m = [1, Math.tan(this.angle.toRadians()), 0, 1, 0, 0];
			}
			this.Type.skewY.prototype = new this.Type.SkewBase;
		
			this.transforms = [];
			
			this.apply = function(ctx) {
				for (var i=0; i<this.transforms.length; i++) {
					this.transforms[i].apply(ctx);
				}
			}
			
			this.unapply = function(ctx) {
				for (var i=this.transforms.length-1; i>=0; i--) {
					this.transforms[i].unapply(ctx);
				}
			}
			
			this.applyToPoint = function(p) {
				for (var i=0; i<this.transforms.length; i++) {
					this.transforms[i].applyToPoint(p);
				}
			}
			
			var data = svg.trim(svg.compressSpaces(v)).replace(/\)(\s?,\s?)/g,') ').split(/\s(?=[a-z])/);
			for (var i=0; i<data.length; i++) {
				var type = svg.trim(data[i].split('(')[0]);
				var s = data[i].split('(')[1].replace(')','');
				var transform = new this.Type[type](s);
				transform.type = type;
				this.transforms.push(transform);
			}
		}
		
		// aspect ratio
		svg.AspectRatio = function(ctx, aspectRatio, width, desiredWidth, height, desiredHeight, minX, minY, refX, refY) {
			// aspect ratio - http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute
			aspectRatio = svg.compressSpaces(aspectRatio);
			aspectRatio = aspectRatio.replace(/^defer\s/,''); // ignore defer
			var align = aspectRatio.split(' ')[0] || 'xMidYMid';
			var meetOrSlice = aspectRatio.split(' ')[1] || 'meet';					
	
			// calculate scale
			var scaleX = width / desiredWidth;
			var scaleY = height / desiredHeight;
			var scaleMin = Math.min(scaleX, scaleY);
			var scaleMax = Math.max(scaleX, scaleY);
			if (meetOrSlice == 'meet') { desiredWidth *= scaleMin; desiredHeight *= scaleMin; }
			if (meetOrSlice == 'slice') { desiredWidth *= scaleMax; desiredHeight *= scaleMax; }	
			
			refX = new svg.Property('refX', refX);
			refY = new svg.Property('refY', refY);
			if (refX.hasValue() && refY.hasValue()) {				
				ctx.translate(-scaleMin * refX.toPixels('x'), -scaleMin * refY.toPixels('y'));
			} 
			else {					
				// align
				if (align.match(/^xMid/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width / 2.0 - desiredWidth / 2.0, 0); 
				if (align.match(/YMid$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height / 2.0 - desiredHeight / 2.0); 
				if (align.match(/^xMax/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width - desiredWidth, 0); 
				if (align.match(/YMax$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height - desiredHeight); 
			}
			
			// scale
			if (align == 'none') ctx.scale(scaleX, scaleY);
			else if (meetOrSlice == 'meet') ctx.scale(scaleMin, scaleMin); 
			else if (meetOrSlice == 'slice') ctx.scale(scaleMax, scaleMax); 	
			
			// translate
			ctx.translate(minX == null ? 0 : -minX, minY == null ? 0 : -minY);			
		}
		
		// elements
		svg.Element = {}
		
		svg.EmptyProperty = new svg.Property('EMPTY', '');
		
		svg.Element.ElementBase = function(node) {	
			this.attributes = {};
			this.styles = {};
			this.children = [];
			
			// get or create attribute
			this.attribute = function(name, createIfNotExists) {
				var a = this.attributes[name];
				if (a != null) return a;
							
				if (createIfNotExists == true) { a = new svg.Property(name, ''); this.attributes[name] = a; }
				return a || svg.EmptyProperty;
			}
			
			this.getHrefAttribute = function() {
				for (var a in this.attributes) { 
					if (a.match(/:href$/)) { 
						return this.attributes[a]; 
					} 
				}
				return svg.EmptyProperty;
			}
			
			// get or create style, crawls up node tree
			this.style = function(name, createIfNotExists) {
				var s = this.styles[name];
				if (s != null) return s;
				
				var a = this.attribute(name);
				if (a != null && a.hasValue()) {
					this.styles[name] = a; // move up to me to cache
					return a;
				}
				
				var p = this.parent;
				if (p != null) {
					var ps = p.style(name);
					if (ps != null && ps.hasValue()) {
						return ps;
					}
				}
					
				if (createIfNotExists == true) { s = new svg.Property(name, ''); this.styles[name] = s; }
				return s || svg.EmptyProperty;
			}
			
			// base render
			this.render = function(ctx) {
				// don't render display=none
				if (this.style('display').value == 'none') return;
				
				// don't render visibility=hidden
				if (this.attribute('visibility').value == 'hidden') return;
			
				ctx.save();
				if (this.attribute('mask').hasValue()) { // mask
					var mask = this.attribute('mask').getDefinition();
					if (mask != null) mask.apply(ctx, this);
				}
				else if (this.style('filter').hasValue()) { // filter
					var filter = this.style('filter').getDefinition();
					if (filter != null) filter.apply(ctx, this);
				}
				else {	
					this.setContext(ctx);
					this.renderChildren(ctx);	
					this.clearContext(ctx);							
				}
				ctx.restore();
			}
			
			// base set context
			this.setContext = function(ctx) {
				// OVERRIDE ME!
			}
			
			// base clear context
			this.clearContext = function(ctx) {
				// OVERRIDE ME!
			}			
			
			// base render children
			this.renderChildren = function(ctx) {
				for (var i=0; i<this.children.length; i++) {
					this.children[i].render(ctx);
				}
			}
			
			this.addChild = function(childNode, create) {
				var child = childNode;
				if (create) child = svg.CreateElement(childNode);
				child.parent = this;
				this.children.push(child);			
			}
				
			if (node != null && node.nodeType == 1) { //ELEMENT_NODE
				// add children
				for (var i=0; i<node.childNodes.length; i++) {
					var childNode = node.childNodes[i];
					if (childNode.nodeType == 1) this.addChild(childNode, true); //ELEMENT_NODE
					if (this.captureTextNodes && childNode.nodeType == 3) {
						var text = childNode.nodeValue || childNode.text || '';
						if (svg.trim(svg.compressSpaces(text)) != '') {
							this.addChild(new svg.Element.tspan(childNode), false); // TEXT_NODE
						}
					}
				}
				
				// add attributes
				for (var i=0; i<node.attributes.length; i++) {
					var attribute = node.attributes[i];
					this.attributes[attribute.nodeName] = new svg.Property(attribute.nodeName, attribute.nodeValue);
				}
										
				// add tag styles
				var styles = svg.Styles[node.nodeName];
				if (styles != null) {
					for (var name in styles) {
						this.styles[name] = styles[name];
					}
				}					
				
				// add class styles
				if (this.attribute('class').hasValue()) {
					var classes = svg.compressSpaces(this.attribute('class').value).split(' ');
					for (var j=0; j<classes.length; j++) {
						styles = svg.Styles['.'+classes[j]];
						if (styles != null) {
							for (var name in styles) {
								this.styles[name] = styles[name];
							}
						}
						styles = svg.Styles[node.nodeName+'.'+classes[j]];
						if (styles != null) {
							for (var name in styles) {
								this.styles[name] = styles[name];
							}
						}
					}
				}
				
				// add id styles
				if (this.attribute('id').hasValue()) {
					var styles = svg.Styles['#' + this.attribute('id').value];
					if (styles != null) {
						for (var name in styles) {
							this.styles[name] = styles[name];
						}
					}
				}
				
				// add inline styles
				if (this.attribute('style').hasValue()) {
					var styles = this.attribute('style').value.split(';');
					for (var i=0; i<styles.length; i++) {
						if (svg.trim(styles[i]) != '') {
							var style = styles[i].split(':');
							var name = svg.trim(style[0]);
							var value = svg.trim(style[1]);
							this.styles[name] = new svg.Property(name, value);
						}
					}
				}	

				// add id
				if (this.attribute('id').hasValue()) {
					if (svg.Definitions[this.attribute('id').value] == null) {
						svg.Definitions[this.attribute('id').value] = this;
					}
				}
			}
		}
		
		svg.Element.RenderedElementBase = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			this.setContext = function(ctx) {
				// fill
				if (this.style('fill').isUrlDefinition()) {
					var fs = this.style('fill').getFillStyleDefinition(this, this.style('fill-opacity'));
					if (fs != null) ctx.fillStyle = fs;
				}
				else if (this.style('fill').hasValue()) {
					var fillStyle = this.style('fill');
					if (fillStyle.value == 'currentColor') fillStyle.value = this.style('color').value;
					ctx.fillStyle = (fillStyle.value == 'none' ? 'rgba(0,0,0,0)' : fillStyle.value);
				}
				if (this.style('fill-opacity').hasValue()) {
					var fillStyle = new svg.Property('fill', ctx.fillStyle);
					fillStyle = fillStyle.addOpacity(this.style('fill-opacity').value);
					ctx.fillStyle = fillStyle.value;
				}
									
				// stroke
				if (this.style('stroke').isUrlDefinition()) {
					var fs = this.style('stroke').getFillStyleDefinition(this, this.style('stroke-opacity'));
					if (fs != null) ctx.strokeStyle = fs;
				}
				else if (this.style('stroke').hasValue()) {
					var strokeStyle = this.style('stroke');
					if (strokeStyle.value == 'currentColor') strokeStyle.value = this.style('color').value;
					ctx.strokeStyle = (strokeStyle.value == 'none' ? 'rgba(0,0,0,0)' : strokeStyle.value);
				}
				if (this.style('stroke-opacity').hasValue()) {
					var strokeStyle = new svg.Property('stroke', ctx.strokeStyle);
					strokeStyle = strokeStyle.addOpacity(this.style('stroke-opacity').value);
					ctx.strokeStyle = strokeStyle.value;
				}
				if (this.style('stroke-width').hasValue()) {
					var newLineWidth = this.style('stroke-width').toPixels();
					ctx.lineWidth = newLineWidth == 0 ? 0.001 : newLineWidth; // browsers don't respect 0
			    }
				if (this.style('stroke-linecap').hasValue()) ctx.lineCap = this.style('stroke-linecap').value;
				if (this.style('stroke-linejoin').hasValue()) ctx.lineJoin = this.style('stroke-linejoin').value;
				if (this.style('stroke-miterlimit').hasValue()) ctx.miterLimit = this.style('stroke-miterlimit').value;
				if (this.style('stroke-dasharray').hasValue()) {
					var gaps = svg.ToNumberArray(this.style('stroke-dasharray').value);
					if (typeof(ctx.setLineDash) != 'undefined') { ctx.setLineDash(gaps); }
					else if (typeof(ctx.webkitLineDash) != 'undefined') { ctx.webkitLineDash = gaps; }
					else if (typeof(ctx.mozDash ) != 'undefined') { ctx.mozDash  = gaps; }
					
					var offset = this.style('stroke-dashoffset').numValueOrDefault(1);
					if (typeof(ctx.lineDashOffset) != 'undefined') { ctx.lineDashOffset = offset; }
					else if (typeof(ctx.webkitLineDashOffset) != 'undefined') { ctx.webkitLineDashOffset = offset; }
					else if (typeof(ctx.mozDashOffset) != 'undefined') { ctx.mozDashOffset = offset; }
				}

				// font
				if (typeof(ctx.font) != 'undefined') {
					ctx.font = svg.Font.CreateFont( 
						this.style('font-style').value, 
						this.style('font-variant').value, 
						this.style('font-weight').value, 
						this.style('font-size').hasValue() ? this.style('font-size').toPixels() + 'px' : '', 
						this.style('font-family').value).toString();
				}
				
				// transform
				if (this.attribute('transform').hasValue()) { 
					var transform = new svg.Transform(this.attribute('transform').value);
					transform.apply(ctx);
				}
				
				// clip
				if (this.style('clip-path').hasValue()) {
					var clip = this.style('clip-path').getDefinition();
					if (clip != null) clip.apply(ctx);
				}
				
				// opacity
				if (this.style('opacity').hasValue()) {
					ctx.globalAlpha = this.style('opacity').numValue();
				}
			}		
		}
		svg.Element.RenderedElementBase.prototype = new svg.Element.ElementBase;
		
		svg.Element.PathElementBase = function(node) {
			this.base = svg.Element.RenderedElementBase;
			this.base(node);
			
			this.path = function(ctx) {
				if (ctx != null) ctx.beginPath();
				return new svg.BoundingBox();
			}
			
			this.renderChildren = function(ctx) {
				this.path(ctx);
				svg.Mouse.checkPath(this, ctx);
				if (ctx.fillStyle != '') {
					if (this.attribute('fill-rule').hasValue()) { ctx.fill(this.attribute('fill-rule').value); }
					else { ctx.fill(); }
				}
				if (ctx.strokeStyle != '') ctx.stroke();
				
				var markers = this.getMarkers();
				if (markers != null) {
					if (this.style('marker-start').isUrlDefinition()) {
						var marker = this.style('marker-start').getDefinition();
						marker.render(ctx, markers[0][0], markers[0][1]);
					}
					if (this.style('marker-mid').isUrlDefinition()) {
						var marker = this.style('marker-mid').getDefinition();
						for (var i=1;i<markers.length-1;i++) {
							marker.render(ctx, markers[i][0], markers[i][1]);
						}
					}
					if (this.style('marker-end').isUrlDefinition()) {
						var marker = this.style('marker-end').getDefinition();
						marker.render(ctx, markers[markers.length-1][0], markers[markers.length-1][1]);
					}
				}					
			}
			
			this.getBoundingBox = function() {
				return this.path();
			}
			
			this.getMarkers = function() {
				return null;
			}
		}
		svg.Element.PathElementBase.prototype = new svg.Element.RenderedElementBase;
		
		// svg element
		svg.Element.svg = function(node) {
			this.base = svg.Element.RenderedElementBase;
			this.base(node);
			
			this.baseClearContext = this.clearContext;
			this.clearContext = function(ctx) {
				this.baseClearContext(ctx);
				svg.ViewPort.RemoveCurrent();
			}
			
			this.baseSetContext = this.setContext;
			this.setContext = function(ctx) {
				// initial values
				ctx.strokeStyle = 'rgba(0,0,0,0)';
				ctx.lineCap = 'butt';
				ctx.lineJoin = 'miter';
				ctx.miterLimit = 4;			
			
				this.baseSetContext(ctx);
				
				// create new view port
				if (!this.attribute('x').hasValue()) this.attribute('x', true).value = 0;
				if (!this.attribute('y').hasValue()) this.attribute('y', true).value = 0;
				ctx.translate(this.attribute('x').toPixels('x'), this.attribute('y').toPixels('y'));
				
				var width = svg.ViewPort.width();
				var height = svg.ViewPort.height();
				
				if (!this.attribute('width').hasValue()) this.attribute('width', true).value = '100%';
				if (!this.attribute('height').hasValue()) this.attribute('height', true).value = '100%';
				if (typeof(this.root) == 'undefined') {
					width = this.attribute('width').toPixels('x');
					height = this.attribute('height').toPixels('y');
					
					var x = 0;
					var y = 0;
					if (this.attribute('refX').hasValue() && this.attribute('refY').hasValue()) {
						x = -this.attribute('refX').toPixels('x');
						y = -this.attribute('refY').toPixels('y');
					}
					
					ctx.beginPath();
					ctx.moveTo(x, y);
					ctx.lineTo(width, y);
					ctx.lineTo(width, height);
					ctx.lineTo(x, height);
					ctx.closePath();
					ctx.clip();
				}
				svg.ViewPort.SetCurrent(width, height);	
						
				// viewbox
				if (this.attribute('viewBox').hasValue()) {				
					var viewBox = svg.ToNumberArray(this.attribute('viewBox').value);
					var minX = viewBox[0];
					var minY = viewBox[1];
					width = viewBox[2];
					height = viewBox[3];
					
					svg.AspectRatio(ctx,
									this.attribute('preserveAspectRatio').value, 
									svg.ViewPort.width(), 
									width,
									svg.ViewPort.height(),
									height,
									minX,
									minY,
									this.attribute('refX').value,
									this.attribute('refY').value);
										
					svg.ViewPort.RemoveCurrent();	
					svg.ViewPort.SetCurrent(viewBox[2], viewBox[3]);						
				}				
			}
		}
		svg.Element.svg.prototype = new svg.Element.RenderedElementBase;

		// rect element
		svg.Element.rect = function(node) {
			this.base = svg.Element.PathElementBase;
			this.base(node);
			
			this.path = function(ctx) {
				var x = this.attribute('x').toPixels('x');
				var y = this.attribute('y').toPixels('y');
				var width = this.attribute('width').toPixels('x');
				var height = this.attribute('height').toPixels('y');
				var rx = this.attribute('rx').toPixels('x');
				var ry = this.attribute('ry').toPixels('y');
				if (this.attribute('rx').hasValue() && !this.attribute('ry').hasValue()) ry = rx;
				if (this.attribute('ry').hasValue() && !this.attribute('rx').hasValue()) rx = ry;
				rx = Math.min(rx, width / 2.0);
				ry = Math.min(ry, height / 2.0);
				if (ctx != null) {
					ctx.beginPath();
					ctx.moveTo(x + rx, y);
					ctx.lineTo(x + width - rx, y);
					ctx.quadraticCurveTo(x + width, y, x + width, y + ry)
					ctx.lineTo(x + width, y + height - ry);
					ctx.quadraticCurveTo(x + width, y + height, x + width - rx, y + height)
					ctx.lineTo(x + rx, y + height);
					ctx.quadraticCurveTo(x, y + height, x, y + height - ry)
					ctx.lineTo(x, y + ry);
					ctx.quadraticCurveTo(x, y, x + rx, y)
					ctx.closePath();
				}
				
				return new svg.BoundingBox(x, y, x + width, y + height);
			}
		}
		svg.Element.rect.prototype = new svg.Element.PathElementBase;
		
		// circle element
		svg.Element.circle = function(node) {
			this.base = svg.Element.PathElementBase;
			this.base(node);
			
			this.path = function(ctx) {
				var cx = this.attribute('cx').toPixels('x');
				var cy = this.attribute('cy').toPixels('y');
				var r = this.attribute('r').toPixels();
			
				if (ctx != null) {
					ctx.beginPath();
					ctx.arc(cx, cy, r, 0, Math.PI * 2, true); 
					ctx.closePath();
				}
				
				return new svg.BoundingBox(cx - r, cy - r, cx + r, cy + r);
			}
		}
		svg.Element.circle.prototype = new svg.Element.PathElementBase;	

		// ellipse element
		svg.Element.ellipse = function(node) {
			this.base = svg.Element.PathElementBase;
			this.base(node);
			
			this.path = function(ctx) {
				var KAPPA = 4 * ((Math.sqrt(2) - 1) / 3);
				var rx = this.attribute('rx').toPixels('x');
				var ry = this.attribute('ry').toPixels('y');
				var cx = this.attribute('cx').toPixels('x');
				var cy = this.attribute('cy').toPixels('y');
				
				if (ctx != null) {
					ctx.beginPath();
					ctx.moveTo(cx, cy - ry);
					ctx.bezierCurveTo(cx + (KAPPA * rx), cy - ry,  cx + rx, cy - (KAPPA * ry), cx + rx, cy);
					ctx.bezierCurveTo(cx + rx, cy + (KAPPA * ry), cx + (KAPPA * rx), cy + ry, cx, cy + ry);
					ctx.bezierCurveTo(cx - (KAPPA * rx), cy + ry, cx - rx, cy + (KAPPA * ry), cx - rx, cy);
					ctx.bezierCurveTo(cx - rx, cy - (KAPPA * ry), cx - (KAPPA * rx), cy - ry, cx, cy - ry);
					ctx.closePath();
				}
				
				return new svg.BoundingBox(cx - rx, cy - ry, cx + rx, cy + ry);
			}
		}
		svg.Element.ellipse.prototype = new svg.Element.PathElementBase;			
		
		// line element
		svg.Element.line = function(node) {
			this.base = svg.Element.PathElementBase;
			this.base(node);
			
			this.getPoints = function() {
				return [
					new svg.Point(this.attribute('x1').toPixels('x'), this.attribute('y1').toPixels('y')),
					new svg.Point(this.attribute('x2').toPixels('x'), this.attribute('y2').toPixels('y'))];
			}
								
			this.path = function(ctx) {
				var points = this.getPoints();
				
				if (ctx != null) {
					ctx.beginPath();
					ctx.moveTo(points[0].x, points[0].y);
					ctx.lineTo(points[1].x, points[1].y);
				}
				
				return new svg.BoundingBox(points[0].x, points[0].y, points[1].x, points[1].y);
			}
			
			this.getMarkers = function() {
				var points = this.getPoints();	
				var a = points[0].angleTo(points[1]);
				return [[points[0], a], [points[1], a]];
			}
		}
		svg.Element.line.prototype = new svg.Element.PathElementBase;		
				
		// polyline element
		svg.Element.polyline = function(node) {
			this.base = svg.Element.PathElementBase;
			this.base(node);
			
			this.points = svg.CreatePath(this.attribute('points').value);
			this.path = function(ctx) {
				var bb = new svg.BoundingBox(this.points[0].x, this.points[0].y);
				if (ctx != null) {
					ctx.beginPath();
					ctx.moveTo(this.points[0].x, this.points[0].y);
				}
				for (var i=1; i<this.points.length; i++) {
					bb.addPoint(this.points[i].x, this.points[i].y);
					if (ctx != null) ctx.lineTo(this.points[i].x, this.points[i].y);
				}
				return bb;
			}
			
			this.getMarkers = function() {
				var markers = [];
				for (var i=0; i<this.points.length - 1; i++) {
					markers.push([this.points[i], this.points[i].angleTo(this.points[i+1])]);
				}
				markers.push([this.points[this.points.length-1], markers[markers.length-1][1]]);
				return markers;
			}			
		}
		svg.Element.polyline.prototype = new svg.Element.PathElementBase;				
				
		// polygon element
		svg.Element.polygon = function(node) {
			this.base = svg.Element.polyline;
			this.base(node);
			
			this.basePath = this.path;
			this.path = function(ctx) {
				var bb = this.basePath(ctx);
				if (ctx != null) {
					ctx.lineTo(this.points[0].x, this.points[0].y);
					ctx.closePath();
				}
				return bb;
			}
		}
		svg.Element.polygon.prototype = new svg.Element.polyline;

		// path element
		svg.Element.path = function(node) {
			this.base = svg.Element.PathElementBase;
			this.base(node);
					
			var d = this.attribute('d').value;
			// TODO: convert to real lexer based on http://www.w3.org/TR/SVG11/paths.html#PathDataBNF
			d = d.replace(/,/gm,' '); // get rid of all commas
			d = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,'$1 $2'); // separate commands from commands
			d = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,'$1 $2'); // separate commands from commands
			d = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,'$1 $2'); // separate commands from points
			d = d.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,'$1 $2'); // separate commands from points
			d = d.replace(/([0-9])([+\-])/gm,'$1 $2'); // separate digits when no comma
			d = d.replace(/(\.[0-9]*)(\.)/gm,'$1 $2'); // separate digits when no comma
			d = d.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,'$1 $3 $4 '); // shorthand elliptical arc path syntax
			d = svg.compressSpaces(d); // compress multiple spaces
			d = svg.trim(d);
			this.PathParser = new (function(d) {
				this.tokens = d.split(' ');
				
				this.reset = function() {
					this.i = -1;
					this.command = '';
					this.previousCommand = '';
					this.start = new svg.Point(0, 0);
					this.control = new svg.Point(0, 0);
					this.current = new svg.Point(0, 0);
					this.points = [];
					this.angles = [];
				}
								
				this.isEnd = function() {
					return this.i >= this.tokens.length - 1;
				}
				
				this.isCommandOrEnd = function() {
					if (this.isEnd()) return true;
					return this.tokens[this.i + 1].match(/^[A-Za-z]$/) != null;
				}
				
				this.isRelativeCommand = function() {
					switch(this.command)
					{
						case 'm':
						case 'l':
						case 'h':
						case 'v':
						case 'c':
						case 's':
						case 'q':
						case 't':
						case 'a':
						case 'z':
							return true;
							break;
					}
					return false;
				}
							
				this.getToken = function() {
					this.i++;
					return this.tokens[this.i];
				}
				
				this.getScalar = function() {
					return parseFloat(this.getToken());
				}
				
				this.nextCommand = function() {
					this.previousCommand = this.command;
					this.command = this.getToken();
				}				
				
				this.getPoint = function() {
					var p = new svg.Point(this.getScalar(), this.getScalar());
					return this.makeAbsolute(p);
				}
				
				this.getAsControlPoint = function() {
					var p = this.getPoint();
					this.control = p;
					return p;
				}
				
				this.getAsCurrentPoint = function() {
					var p = this.getPoint();
					this.current = p;
					return p;	
				}
				
				this.getReflectedControlPoint = function() {
					if (this.previousCommand.toLowerCase() != 'c' && 
					    this.previousCommand.toLowerCase() != 's' &&
						this.previousCommand.toLowerCase() != 'q' && 
						this.previousCommand.toLowerCase() != 't' ){
						return this.current;
					}
					
					// reflect point
					var p = new svg.Point(2 * this.current.x - this.control.x, 2 * this.current.y - this.control.y);					
					return p;
				}
				
				this.makeAbsolute = function(p) {
					if (this.isRelativeCommand()) {
						p.x += this.current.x;
						p.y += this.current.y;
					}
					return p;
				}
				
				this.addMarker = function(p, from, priorTo) {
					// if the last angle isn't filled in because we didn't have this point yet ...
					if (priorTo != null && this.angles.length > 0 && this.angles[this.angles.length-1] == null) {
						this.angles[this.angles.length-1] = this.points[this.points.length-1].angleTo(priorTo);
					}
					this.addMarkerAngle(p, from == null ? null : from.angleTo(p));
				}
				
				this.addMarkerAngle = function(p, a) {
					this.points.push(p);
					this.angles.push(a);
				}				
				
				this.getMarkerPoints = function() { return this.points; }
				this.getMarkerAngles = function() {
					for (var i=0; i<this.angles.length; i++) {
						if (this.angles[i] == null) {
							for (var j=i+1; j<this.angles.length; j++) {
								if (this.angles[j] != null) {
									this.angles[i] = this.angles[j];
									break;
								}
							}
						}
					}
					return this.angles;
				}
			})(d);

			this.path = function(ctx) {
				var pp = this.PathParser;
				pp.reset();

				var bb = new svg.BoundingBox();
				if (ctx != null) ctx.beginPath();
				while (!pp.isEnd()) {
					pp.nextCommand();
					switch (pp.command) {
					case 'M':
					case 'm':
						var p = pp.getAsCurrentPoint();
						pp.addMarker(p);
						bb.addPoint(p.x, p.y);
						if (ctx != null) ctx.moveTo(p.x, p.y);
						pp.start = pp.current;
						while (!pp.isCommandOrEnd()) {
							var p = pp.getAsCurrentPoint();
							pp.addMarker(p, pp.start);
							bb.addPoint(p.x, p.y);
							if (ctx != null) ctx.lineTo(p.x, p.y);
						}
						break;
					case 'L':
					case 'l':
						while (!pp.isCommandOrEnd()) {
							var c = pp.current;
							var p = pp.getAsCurrentPoint();
							pp.addMarker(p, c);
							bb.addPoint(p.x, p.y);
							if (ctx != null) ctx.lineTo(p.x, p.y);
						}
						break;
					case 'H':
					case 'h':
						while (!pp.isCommandOrEnd()) {
							var newP = new svg.Point((pp.isRelativeCommand() ? pp.current.x : 0) + pp.getScalar(), pp.current.y);
							pp.addMarker(newP, pp.current);
							pp.current = newP;
							bb.addPoint(pp.current.x, pp.current.y);
							if (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);
						}
						break;
					case 'V':
					case 'v':
						while (!pp.isCommandOrEnd()) {
							var newP = new svg.Point(pp.current.x, (pp.isRelativeCommand() ? pp.current.y : 0) + pp.getScalar());
							pp.addMarker(newP, pp.current);
							pp.current = newP;
							bb.addPoint(pp.current.x, pp.current.y);
							if (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);
						}
						break;
					case 'C':
					case 'c':
						while (!pp.isCommandOrEnd()) {
							var curr = pp.current;
							var p1 = pp.getPoint();
							var cntrl = pp.getAsControlPoint();
							var cp = pp.getAsCurrentPoint();
							pp.addMarker(cp, cntrl, p1);
							bb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);
							if (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);
						}
						break;
					case 'S':
					case 's':
						while (!pp.isCommandOrEnd()) {
							var curr = pp.current;
							var p1 = pp.getReflectedControlPoint();
							var cntrl = pp.getAsControlPoint();
							var cp = pp.getAsCurrentPoint();
							pp.addMarker(cp, cntrl, p1);
							bb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);
							if (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);
						}
						break;
					case 'Q':
					case 'q':
						while (!pp.isCommandOrEnd()) {
							var curr = pp.current;
							var cntrl = pp.getAsControlPoint();
							var cp = pp.getAsCurrentPoint();
							pp.addMarker(cp, cntrl, cntrl);
							bb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);
							if (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);
						}
						break;
					case 'T':
					case 't':
						while (!pp.isCommandOrEnd()) {
							var curr = pp.current;
							var cntrl = pp.getReflectedControlPoint();
							pp.control = cntrl;
							var cp = pp.getAsCurrentPoint();
							pp.addMarker(cp, cntrl, cntrl);
							bb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);
							if (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);
						}
						break;
					case 'A':
					case 'a':
						while (!pp.isCommandOrEnd()) {
						    var curr = pp.current;
							var rx = pp.getScalar();
							var ry = pp.getScalar();
							var xAxisRotation = pp.getScalar() * (Math.PI / 180.0);
							var largeArcFlag = pp.getScalar();
							var sweepFlag = pp.getScalar();
							var cp = pp.getAsCurrentPoint();

							// Conversion from endpoint to center parameterization
							// http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes
							// x1', y1'
							var currp = new svg.Point(
								Math.cos(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.sin(xAxisRotation) * (curr.y - cp.y) / 2.0,
								-Math.sin(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.cos(xAxisRotation) * (curr.y - cp.y) / 2.0
							);
							// adjust radii
							var l = Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);
							if (l > 1) {
								rx *= Math.sqrt(l);
								ry *= Math.sqrt(l);
							}
							// cx', cy'
							var s = (largeArcFlag == sweepFlag ? -1 : 1) * Math.sqrt(
								((Math.pow(rx,2)*Math.pow(ry,2))-(Math.pow(rx,2)*Math.pow(currp.y,2))-(Math.pow(ry,2)*Math.pow(currp.x,2))) /
								(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2))
							);
							if (isNaN(s)) s = 0;
							var cpp = new svg.Point(s * rx * currp.y / ry, s * -ry * currp.x / rx);
							// cx, cy
							var centp = new svg.Point(
								(curr.x + cp.x) / 2.0 + Math.cos(xAxisRotation) * cpp.x - Math.sin(xAxisRotation) * cpp.y,
								(curr.y + cp.y) / 2.0 + Math.sin(xAxisRotation) * cpp.x + Math.cos(xAxisRotation) * cpp.y
							);
							// vector magnitude
							var m = function(v) { return Math.sqrt(Math.pow(v[0],2) + Math.pow(v[1],2)); }
							// ratio between two vectors
							var r = function(u, v) { return (u[0]*v[0]+u[1]*v[1]) / (m(u)*m(v)) }
							// angle between two vectors
							var a = function(u, v) { return (u[0]*v[1] < u[1]*v[0] ? -1 : 1) * Math.acos(r(u,v)); }
							// initial angle
							var a1 = a([1,0], [(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]);
							// angle delta
							var u = [(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry];
							var v = [(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry];
							var ad = a(u, v);
							if (r(u,v) <= -1) ad = Math.PI;
							if (r(u,v) >= 1) ad = 0;

							// for markers
							var dir = 1 - sweepFlag ? 1.0 : -1.0;
							var ah = a1 + dir * (ad / 2.0);
							var halfWay = new svg.Point(
								centp.x + rx * Math.cos(ah),
								centp.y + ry * Math.sin(ah)
							);
							pp.addMarkerAngle(halfWay, ah - dir * Math.PI / 2);
							pp.addMarkerAngle(cp, ah - dir * Math.PI);

							bb.addPoint(cp.x, cp.y); // TODO: this is too naive, make it better
							if (ctx != null) {
								var r = rx > ry ? rx : ry;
								var sx = rx > ry ? 1 : rx / ry;
								var sy = rx > ry ? ry / rx : 1;

								ctx.translate(centp.x, centp.y);
								ctx.rotate(xAxisRotation);
								ctx.scale(sx, sy);
								ctx.arc(0, 0, r, a1, a1 + ad, 1 - sweepFlag);
								ctx.scale(1/sx, 1/sy);
								ctx.rotate(-xAxisRotation);
								ctx.translate(-centp.x, -centp.y);
							}
						}
						break;
					case 'Z':
					case 'z':
						if (ctx != null) ctx.closePath();
						pp.current = pp.start;
					}
				}

				return bb;
			}

			this.getMarkers = function() {
				var points = this.PathParser.getMarkerPoints();
				var angles = this.PathParser.getMarkerAngles();
				
				var markers = [];
				for (var i=0; i<points.length; i++) {
					markers.push([points[i], angles[i]]);
				}
				return markers;
			}
		}
		svg.Element.path.prototype = new svg.Element.PathElementBase;
		
		// pattern element
		svg.Element.pattern = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			this.createPattern = function(ctx, element) {
				var width = this.attribute('width').toPixels('x', true);
				var height = this.attribute('height').toPixels('y', true);
			
				// render me using a temporary svg element
				var tempSvg = new svg.Element.svg();
				tempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);
				tempSvg.attributes['width'] = new svg.Property('width', width + 'px');
				tempSvg.attributes['height'] = new svg.Property('height', height + 'px');
				tempSvg.attributes['transform'] = new svg.Property('transform', this.attribute('patternTransform').value);
				tempSvg.children = this.children;
				
				var c = document.createElement('canvas');
				c.width = width;
				c.height = height;
				var cctx = c.getContext('2d');
				if (this.attribute('x').hasValue() && this.attribute('y').hasValue()) {
					cctx.translate(this.attribute('x').toPixels('x', true), this.attribute('y').toPixels('y', true));
				}
				// render 3x3 grid so when we transform there's no white space on edges
				for (var x=-1; x<=1; x++) {
					for (var y=-1; y<=1; y++) {
						cctx.save();
						cctx.translate(x * c.width, y * c.height);
						tempSvg.render(cctx);
						cctx.restore();
					}
				}
				var pattern = ctx.createPattern(c, 'repeat');
				return pattern;
			}
		}
		svg.Element.pattern.prototype = new svg.Element.ElementBase;
		
		// marker element
		svg.Element.marker = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			this.baseRender = this.render;
			this.render = function(ctx, point, angle) {
				ctx.translate(point.x, point.y);
				if (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(angle);
				if (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(ctx.lineWidth, ctx.lineWidth);
				ctx.save();
							
				// render me using a temporary svg element
				var tempSvg = new svg.Element.svg();
				tempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);
				tempSvg.attributes['refX'] = new svg.Property('refX', this.attribute('refX').value);
				tempSvg.attributes['refY'] = new svg.Property('refY', this.attribute('refY').value);
				tempSvg.attributes['width'] = new svg.Property('width', this.attribute('markerWidth').value);
				tempSvg.attributes['height'] = new svg.Property('height', this.attribute('markerHeight').value);
				tempSvg.attributes['fill'] = new svg.Property('fill', this.attribute('fill').valueOrDefault('black'));
				tempSvg.attributes['stroke'] = new svg.Property('stroke', this.attribute('stroke').valueOrDefault('none'));
				tempSvg.children = this.children;
				tempSvg.render(ctx);
				
				ctx.restore();
				if (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(1/ctx.lineWidth, 1/ctx.lineWidth);
				if (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(-angle);
				ctx.translate(-point.x, -point.y);
			}
		}
		svg.Element.marker.prototype = new svg.Element.ElementBase;
		
		// definitions element
		svg.Element.defs = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);	
			
			this.render = function(ctx) {
				// NOOP
			}
		}
		svg.Element.defs.prototype = new svg.Element.ElementBase;
		
		// base for gradients
		svg.Element.GradientBase = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			this.gradientUnits = this.attribute('gradientUnits').valueOrDefault('objectBoundingBox');
			
			this.stops = [];			
			for (var i=0; i<this.children.length; i++) {
				var child = this.children[i];
				if (child.type == 'stop') this.stops.push(child);
			}	
			
			this.getGradient = function() {
				// OVERRIDE ME!
			}			

			this.createGradient = function(ctx, element, parentOpacityProp) {
				var stopsContainer = this;
				if (this.getHrefAttribute().hasValue()) {
					stopsContainer = this.getHrefAttribute().getDefinition();
				}
				
				var addParentOpacity = function (color) {
					if (parentOpacityProp.hasValue()) {
						var p = new svg.Property('color', color);
						return p.addOpacity(parentOpacityProp.value).value;
					}
					return color;
				};
			
				var g = this.getGradient(ctx, element);
				if (g == null) return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length - 1].color);
				for (var i=0; i<stopsContainer.stops.length; i++) {
					g.addColorStop(stopsContainer.stops[i].offset, addParentOpacity(stopsContainer.stops[i].color));
				}
				
				if (this.attribute('gradientTransform').hasValue()) {
					// render as transformed pattern on temporary canvas
					var rootView = svg.ViewPort.viewPorts[0];
					
					var rect = new svg.Element.rect();
					rect.attributes['x'] = new svg.Property('x', -svg.MAX_VIRTUAL_PIXELS/3.0);
					rect.attributes['y'] = new svg.Property('y', -svg.MAX_VIRTUAL_PIXELS/3.0);
					rect.attributes['width'] = new svg.Property('width', svg.MAX_VIRTUAL_PIXELS);
					rect.attributes['height'] = new svg.Property('height', svg.MAX_VIRTUAL_PIXELS);
					
					var group = new svg.Element.g();
					group.attributes['transform'] = new svg.Property('transform', this.attribute('gradientTransform').value);
					group.children = [ rect ];
					
					var tempSvg = new svg.Element.svg();
					tempSvg.attributes['x'] = new svg.Property('x', 0);
					tempSvg.attributes['y'] = new svg.Property('y', 0);
					tempSvg.attributes['width'] = new svg.Property('width', rootView.width);
					tempSvg.attributes['height'] = new svg.Property('height', rootView.height);
					tempSvg.children = [ group ];
					
					var c = document.createElement('canvas');
					c.width = rootView.width;
					c.height = rootView.height;
					var tempCtx = c.getContext('2d');
					tempCtx.fillStyle = g;
					tempSvg.render(tempCtx);		
					return tempCtx.createPattern(c, 'no-repeat');
				}
				
				return g;				
			}
		}
		svg.Element.GradientBase.prototype = new svg.Element.ElementBase;
		
		// linear gradient element
		svg.Element.linearGradient = function(node) {
			this.base = svg.Element.GradientBase;
			this.base(node);
			
			this.getGradient = function(ctx, element) {
				var bb = element.getBoundingBox();
				
				if (!this.attribute('x1').hasValue()
				 && !this.attribute('y1').hasValue()
				 && !this.attribute('x2').hasValue()
				 && !this.attribute('y2').hasValue()) {
					this.attribute('x1', true).value = 0;
					this.attribute('y1', true).value = 0;
					this.attribute('x2', true).value = 1;
					this.attribute('y2', true).value = 0;
				 }
				
				var x1 = (this.gradientUnits == 'objectBoundingBox' 
					? bb.x() + bb.width() * this.attribute('x1').numValue() 
					: this.attribute('x1').toPixels('x'));
				var y1 = (this.gradientUnits == 'objectBoundingBox' 
					? bb.y() + bb.height() * this.attribute('y1').numValue()
					: this.attribute('y1').toPixels('y'));
				var x2 = (this.gradientUnits == 'objectBoundingBox' 
					? bb.x() + bb.width() * this.attribute('x2').numValue()
					: this.attribute('x2').toPixels('x'));
				var y2 = (this.gradientUnits == 'objectBoundingBox' 
					? bb.y() + bb.height() * this.attribute('y2').numValue()
					: this.attribute('y2').toPixels('y'));

				if (x1 == x2 && y1 == y2) return null;
				return ctx.createLinearGradient(x1, y1, x2, y2);
			}
		}
		svg.Element.linearGradient.prototype = new svg.Element.GradientBase;
		
		// radial gradient element
		svg.Element.radialGradient = function(node) {
			this.base = svg.Element.GradientBase;
			this.base(node);
			
			this.getGradient = function(ctx, element) {
				var bb = element.getBoundingBox();
				
				if (!this.attribute('cx').hasValue()) this.attribute('cx', true).value = '50%';
				if (!this.attribute('cy').hasValue()) this.attribute('cy', true).value = '50%';
				if (!this.attribute('r').hasValue()) this.attribute('r', true).value = '50%';
				
				var cx = (this.gradientUnits == 'objectBoundingBox' 
					? bb.x() + bb.width() * this.attribute('cx').numValue() 
					: this.attribute('cx').toPixels('x'));
				var cy = (this.gradientUnits == 'objectBoundingBox' 
					? bb.y() + bb.height() * this.attribute('cy').numValue() 
					: this.attribute('cy').toPixels('y'));
				
				var fx = cx;
				var fy = cy;
				if (this.attribute('fx').hasValue()) {
					fx = (this.gradientUnits == 'objectBoundingBox' 
					? bb.x() + bb.width() * this.attribute('fx').numValue() 
					: this.attribute('fx').toPixels('x'));
				}
				if (this.attribute('fy').hasValue()) {
					fy = (this.gradientUnits == 'objectBoundingBox' 
					? bb.y() + bb.height() * this.attribute('fy').numValue() 
					: this.attribute('fy').toPixels('y'));
				}
				
				var r = (this.gradientUnits == 'objectBoundingBox' 
					? (bb.width() + bb.height()) / 2.0 * this.attribute('r').numValue()
					: this.attribute('r').toPixels());
				
				return ctx.createRadialGradient(fx, fy, 0, cx, cy, r);
			}
		}
		svg.Element.radialGradient.prototype = new svg.Element.GradientBase;
		
		// gradient stop element
		svg.Element.stop = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			this.offset = this.attribute('offset').numValue();
			if (this.offset < 0) this.offset = 0;
			if (this.offset > 1) this.offset = 1;
			
			var stopColor = this.style('stop-color');
			if (this.style('stop-opacity').hasValue()) stopColor = stopColor.addOpacity(this.style('stop-opacity').value);
			this.color = stopColor.value;
		}
		svg.Element.stop.prototype = new svg.Element.ElementBase;
		
		// animation base element
		svg.Element.AnimateBase = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			svg.Animations.push(this);
			
			this.duration = 0.0;
			this.begin = this.attribute('begin').toMilliseconds();
			this.maxDuration = this.begin + this.attribute('dur').toMilliseconds();
			
			this.getProperty = function() {
				var attributeType = this.attribute('attributeType').value;
				var attributeName = this.attribute('attributeName').value;
				
				if (attributeType == 'CSS') {
					return this.parent.style(attributeName, true);
				}
				return this.parent.attribute(attributeName, true);			
			};
			
			this.initialValue = null;
			this.initialUnits = '';
			this.removed = false;			

			this.calcValue = function() {
				// OVERRIDE ME!
				return '';
			}
					
			this.update = function(delta) {	
				// set initial value
				if (this.initialValue == null) {
					this.initialValue = this.getProperty().value;
					this.initialUnits = this.getProperty().getUnits();
				}
			
				// if we're past the end time
				if (this.duration > this.maxDuration) {
					// loop for indefinitely repeating animations
					if (this.attribute('repeatCount').value == 'indefinite'
					 || this.attribute('repeatDur').value == 'indefinite') {
						this.duration = 0.0
					}
					else if (this.attribute('fill').valueOrDefault('remove') == 'remove' && !this.removed) {
						this.removed = true;
						this.getProperty().value = this.initialValue;
						return true;
					}
					else {
						return false; // no updates made
					}
				}			
				this.duration = this.duration + delta;
			
				// if we're past the begin time
				var updated = false;
				if (this.begin < this.duration) {
					var newValue = this.calcValue(); // tween
					
					if (this.attribute('type').hasValue()) {
						// for transform, etc.
						var type = this.attribute('type').value;
						newValue = type + '(' + newValue + ')';
					}
					
					this.getProperty().value = newValue;
					updated = true;
				}
				
				return updated;
			}
			
			this.from = this.attribute('from');
			this.to = this.attribute('to');
			this.values = this.attribute('values');
			if (this.values.hasValue()) this.values.value = this.values.value.split(';');
			
			// fraction of duration we've covered
			this.progress = function() {
				var ret = { progress: (this.duration - this.begin) / (this.maxDuration - this.begin) };
				if (this.values.hasValue()) {
					var p = ret.progress * (this.values.value.length - 1);
					var lb = Math.floor(p), ub = Math.ceil(p);
					ret.from = new svg.Property('from', parseFloat(this.values.value[lb]));
					ret.to = new svg.Property('to', parseFloat(this.values.value[ub]));
					ret.progress = (p - lb) / (ub - lb);
				}
				else {
					ret.from = this.from;
					ret.to = this.to;
				}
				return ret;
			}			
		}
		svg.Element.AnimateBase.prototype = new svg.Element.ElementBase;
		
		// animate element
		svg.Element.animate = function(node) {
			this.base = svg.Element.AnimateBase;
			this.base(node);
			
			this.calcValue = function() {
				var p = this.progress();
				
				// tween value linearly
				var newValue = p.from.numValue() + (p.to.numValue() - p.from.numValue()) * p.progress; 
				return newValue + this.initialUnits;
			};
		}
		svg.Element.animate.prototype = new svg.Element.AnimateBase;
			
		// animate color element
		svg.Element.animateColor = function(node) {
			this.base = svg.Element.AnimateBase;
			this.base(node);

			this.calcValue = function() {
				var p = this.progress();
				var from = new RGBColor(p.from.value);
				var to = new RGBColor(p.to.value);
				
				if (from.ok && to.ok) {
					// tween color linearly
					var r = from.r + (to.r - from.r) * p.progress;
					var g = from.g + (to.g - from.g) * p.progress;
					var b = from.b + (to.b - from.b) * p.progress;
					return 'rgb('+parseInt(r,10)+','+parseInt(g,10)+','+parseInt(b,10)+')';
				}
				return this.attribute('from').value;
			};
		}
		svg.Element.animateColor.prototype = new svg.Element.AnimateBase;
		
		// animate transform element
		svg.Element.animateTransform = function(node) {
			this.base = svg.Element.AnimateBase;
			this.base(node);
			
			this.calcValue = function() {
				var p = this.progress();
				
				// tween value linearly
				var from = svg.ToNumberArray(p.from.value);
				var to = svg.ToNumberArray(p.to.value);
				var newValue = '';
				for (var i=0; i<from.length; i++) {
					newValue += from[i] + (to[i] - from[i]) * p.progress + ' ';
				}
				return newValue;
			};
		}
		svg.Element.animateTransform.prototype = new svg.Element.animate;
		
		// font element
		svg.Element.font = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);

			this.horizAdvX = this.attribute('horiz-adv-x').numValue();			
			
			this.isRTL = false;
			this.isArabic = false;
			this.fontFace = null;
			this.missingGlyph = null;
			this.glyphs = [];			
			for (var i=0; i<this.children.length; i++) {
				var child = this.children[i];
				if (child.type == 'font-face') {
					this.fontFace = child;
					if (child.style('font-family').hasValue()) {
						svg.Definitions[child.style('font-family').value] = this;
					}
				}
				else if (child.type == 'missing-glyph') this.missingGlyph = child;
				else if (child.type == 'glyph') {
					if (child.arabicForm != '') {
						this.isRTL = true;
						this.isArabic = true;
						if (typeof(this.glyphs[child.unicode]) == 'undefined') this.glyphs[child.unicode] = [];
						this.glyphs[child.unicode][child.arabicForm] = child;
					}
					else {
						this.glyphs[child.unicode] = child;
					}
				}
			}	
		}
		svg.Element.font.prototype = new svg.Element.ElementBase;
		
		// font-face element
		svg.Element.fontface = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);	
			
			this.ascent = this.attribute('ascent').value;
			this.descent = this.attribute('descent').value;
			this.unitsPerEm = this.attribute('units-per-em').numValue();				
		}
		svg.Element.fontface.prototype = new svg.Element.ElementBase;
		
		// missing-glyph element
		svg.Element.missingglyph = function(node) {
			this.base = svg.Element.path;
			this.base(node);	
			
			this.horizAdvX = 0;
		}
		svg.Element.missingglyph.prototype = new svg.Element.path;
		
		// glyph element
		svg.Element.glyph = function(node) {
			this.base = svg.Element.path;
			this.base(node);	
			
			this.horizAdvX = this.attribute('horiz-adv-x').numValue();
			this.unicode = this.attribute('unicode').value;
			this.arabicForm = this.attribute('arabic-form').value;
		}
		svg.Element.glyph.prototype = new svg.Element.path;
		
		// text element
		svg.Element.text = function(node) {
			this.captureTextNodes = true;
			this.base = svg.Element.RenderedElementBase;
			this.base(node);
			
			this.baseSetContext = this.setContext;
			this.setContext = function(ctx) {
				this.baseSetContext(ctx);
				if (this.style('dominant-baseline').hasValue()) ctx.textBaseline = this.style('dominant-baseline').value;
				if (this.style('alignment-baseline').hasValue()) ctx.textBaseline = this.style('alignment-baseline').value;
			}
			
			this.getBoundingBox = function () {
				// TODO: implement
				return new svg.BoundingBox(this.attribute('x').toPixels('x'), this.attribute('y').toPixels('y'), 0, 0);
			}
			
			this.renderChildren = function(ctx) {
				this.x = this.attribute('x').toPixels('x');
				this.y = this.attribute('y').toPixels('y');
				this.x += this.getAnchorDelta(ctx, this, 0);
				for (var i=0; i<this.children.length; i++) {
					this.renderChild(ctx, this, i);
				}
			}
			
			this.getAnchorDelta = function (ctx, parent, startI) {
				var textAnchor = this.style('text-anchor').valueOrDefault('start');
				if (textAnchor != 'start') {
					var width = 0;
					for (var i=startI; i<parent.children.length; i++) {
						var child = parent.children[i];
						if (i > startI && child.attribute('x').hasValue()) break; // new group
						width += child.measureTextRecursive(ctx);
					}
					return -1 * (textAnchor == 'end' ? width : width / 2.0);
				}
				return 0;
			}
			
			this.renderChild = function(ctx, parent, i) {
				var child = parent.children[i];
				if (child.attribute('x').hasValue()) {
					child.x = child.attribute('x').toPixels('x') + this.getAnchorDelta(ctx, parent, i);
				}
				else {
					if (this.attribute('dx').hasValue()) this.x += this.attribute('dx').toPixels('x');
					if (child.attribute('dx').hasValue()) this.x += child.attribute('dx').toPixels('x');
					child.x = this.x;
				}
				this.x = child.x + child.measureText(ctx);
				
				if (child.attribute('y').hasValue()) {
					child.y = child.attribute('y').toPixels('y');
				}
				else {
					if (this.attribute('dy').hasValue()) this.y += this.attribute('dy').toPixels('y');
					if (child.attribute('dy').hasValue()) this.y += child.attribute('dy').toPixels('y');
					child.y = this.y;
				}
				this.y = child.y;
				
				child.render(ctx);
				
				for (var i=0; i<child.children.length; i++) {
					this.renderChild(ctx, child, i);
				}
			}
		}
		svg.Element.text.prototype = new svg.Element.RenderedElementBase;
		
		// text base
		svg.Element.TextElementBase = function(node) {
			this.base = svg.Element.RenderedElementBase;
			this.base(node);
			
			this.getGlyph = function(font, text, i) {
				var c = text[i];
				var glyph = null;
				if (font.isArabic) {
					var arabicForm = 'isolated';
					if ((i==0 || text[i-1]==' ') && i<text.length-2 && text[i+1]!=' ') arabicForm = 'terminal'; 
					if (i>0 && text[i-1]!=' ' && i<text.length-2 && text[i+1]!=' ') arabicForm = 'medial';
					if (i>0 && text[i-1]!=' ' && (i == text.length-1 || text[i+1]==' ')) arabicForm = 'initial';
					if (typeof(font.glyphs[c]) != 'undefined') {
						glyph = font.glyphs[c][arabicForm];
						if (glyph == null && font.glyphs[c].type == 'glyph') glyph = font.glyphs[c];
					}
				}
				else {
					glyph = font.glyphs[c];
				}
				if (glyph == null) glyph = font.missingGlyph;
				return glyph;
			}
			
			this.renderChildren = function(ctx) {
				var customFont = this.parent.style('font-family').getDefinition();
				if (customFont != null) {
					var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);
					var fontStyle = this.parent.style('font-style').valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle);
					var text = this.getText();
					if (customFont.isRTL) text = text.split("").reverse().join("");
					
					var dx = svg.ToNumberArray(this.parent.attribute('dx').value);
					for (var i=0; i<text.length; i++) {
						var glyph = this.getGlyph(customFont, text, i);
						var scale = fontSize / customFont.fontFace.unitsPerEm;
						ctx.translate(this.x, this.y);
						ctx.scale(scale, -scale);
						var lw = ctx.lineWidth;
						ctx.lineWidth = ctx.lineWidth * customFont.fontFace.unitsPerEm / fontSize;
						if (fontStyle == 'italic') ctx.transform(1, 0, .4, 1, 0, 0);
						glyph.render(ctx);
						if (fontStyle == 'italic') ctx.transform(1, 0, -.4, 1, 0, 0);
						ctx.lineWidth = lw;
						ctx.scale(1/scale, -1/scale);
						ctx.translate(-this.x, -this.y);	
						
						this.x += fontSize * (glyph.horizAdvX || customFont.horizAdvX) / customFont.fontFace.unitsPerEm;
						if (typeof(dx[i]) != 'undefined' && !isNaN(dx[i])) {
							this.x += dx[i];
						}
					}
					return;
				}
			
				if (ctx.fillStyle != '') ctx.fillText(svg.compressSpaces(this.getText()), this.x, this.y);
				if (ctx.strokeStyle != '') ctx.strokeText(svg.compressSpaces(this.getText()), this.x, this.y);
			}
			
			this.getText = function() {
				// OVERRIDE ME
			}
			
			this.measureTextRecursive = function(ctx) {
				var width = this.measureText(ctx);
				for (var i=0; i<this.children.length; i++) {
					width += this.children[i].measureTextRecursive(ctx);
				}
				return width;
			}
			
			this.measureText = function(ctx) {
				var customFont = this.parent.style('font-family').getDefinition();
				if (customFont != null) {
					var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);
					var measure = 0;
					var text = this.getText();
					if (customFont.isRTL) text = text.split("").reverse().join("");
					var dx = svg.ToNumberArray(this.parent.attribute('dx').value);
					for (var i=0; i<text.length; i++) {
						var glyph = this.getGlyph(customFont, text, i);
						measure += (glyph.horizAdvX || customFont.horizAdvX) * fontSize / customFont.fontFace.unitsPerEm;
						if (typeof(dx[i]) != 'undefined' && !isNaN(dx[i])) {
							measure += dx[i];
						}
					}
					return measure;
				}
			
				var textToMeasure = svg.compressSpaces(this.getText());
				if (!ctx.measureText) return textToMeasure.length * 10;
				
				ctx.save();
				this.setContext(ctx);
				var width = ctx.measureText(textToMeasure).width;
				ctx.restore();
				return width;
			}
		}
		svg.Element.TextElementBase.prototype = new svg.Element.RenderedElementBase;
		
		// tspan 
		svg.Element.tspan = function(node) {
			this.captureTextNodes = true;
			this.base = svg.Element.TextElementBase;
			this.base(node);
			
			this.text = node.nodeValue || node.text || '';
			this.getText = function() {
				return this.text;
			}
		}
		svg.Element.tspan.prototype = new svg.Element.TextElementBase;
		
		// tref
		svg.Element.tref = function(node) {
			this.base = svg.Element.TextElementBase;
			this.base(node);
			
			this.getText = function() {
				var element = this.getHrefAttribute().getDefinition();
				if (element != null) return element.children[0].getText();
			}
		}
		svg.Element.tref.prototype = new svg.Element.TextElementBase;		
		
		// a element
		svg.Element.a = function(node) {
			this.base = svg.Element.TextElementBase;
			this.base(node);
			
			this.hasText = true;
			for (var i=0; i<node.childNodes.length; i++) {
				if (node.childNodes[i].nodeType != 3) this.hasText = false;
			}
			
			// this might contain text
			this.text = this.hasText ? node.childNodes[0].nodeValue : '';
			this.getText = function() {
				return this.text;
			}		

			this.baseRenderChildren = this.renderChildren;
			this.renderChildren = function(ctx) {
				if (this.hasText) {
					// render as text element
					this.baseRenderChildren(ctx);
					var fontSize = new svg.Property('fontSize', svg.Font.Parse(svg.ctx.font).fontSize);
					svg.Mouse.checkBoundingBox(this, new svg.BoundingBox(this.x, this.y - fontSize.toPixels('y'), this.x + this.measureText(ctx), this.y));					
				}
				else {
					// render as temporary group
					var g = new svg.Element.g();
					g.children = this.children;
					g.parent = this;
					g.render(ctx);
				}
			}
			
			this.onclick = function() {
				window.open(this.getHrefAttribute().value);
			}
			
			this.onmousemove = function() {
				svg.ctx.canvas.style.cursor = 'pointer';
			}
		}
		svg.Element.a.prototype = new svg.Element.TextElementBase;		
		
		// image element
		svg.Element.image = function(node) {
			this.base = svg.Element.RenderedElementBase;
			this.base(node);
			
			var href = this.getHrefAttribute().value;
			var isSvg = href.match(/\.svg$/)
			
			svg.Images.push(this);
			this.loaded = false;
			if (!isSvg) {
				this.img = document.createElement('img');
				var self = this;
				this.img.onload = function() { self.loaded = true; }
				this.img.onerror = function() { if (typeof(console) != 'undefined') { console.log('ERROR: image "' + href + '" not found'); self.loaded = true; } }
				this.img.src = href;
			}
			else {
				this.img = svg.ajax(href);
				this.loaded = true;
			}
			
			this.renderChildren = function(ctx) {
				var x = this.attribute('x').toPixels('x');
				var y = this.attribute('y').toPixels('y');
				
				var width = this.attribute('width').toPixels('x');
				var height = this.attribute('height').toPixels('y');			
				if (width == 0 || height == 0) return;
			
				ctx.save();
				if (isSvg) {
					ctx.drawSvg(this.img, x, y, width, height);
				}
				else {
					ctx.translate(x, y);
					svg.AspectRatio(ctx,
									this.attribute('preserveAspectRatio').value,
									width,
									this.img.width,
									height,
									this.img.height,
									0,
									0);	
					ctx.drawImage(this.img, 0, 0);		
				}
				ctx.restore();
			}
			
			this.getBoundingBox = function() {
				var x = this.attribute('x').toPixels('x');
				var y = this.attribute('y').toPixels('y');
				var width = this.attribute('width').toPixels('x');
				var height = this.attribute('height').toPixels('y');
				return new svg.BoundingBox(x, y, x + width, y + height);
			}
		}
		svg.Element.image.prototype = new svg.Element.RenderedElementBase;
		
		// group element
		svg.Element.g = function(node) {
			this.base = svg.Element.RenderedElementBase;
			this.base(node);
			
			this.getBoundingBox = function() {
				var bb = new svg.BoundingBox();
				for (var i=0; i<this.children.length; i++) {
					bb.addBoundingBox(this.children[i].getBoundingBox());
				}
				return bb;
			};
		}
		svg.Element.g.prototype = new svg.Element.RenderedElementBase;

		// symbol element
		svg.Element.symbol = function(node) {
			this.base = svg.Element.RenderedElementBase;
			this.base(node);
			
			this.baseSetContext = this.setContext;
			this.setContext = function(ctx) {		
				this.baseSetContext(ctx);
				
				// viewbox
				if (this.attribute('viewBox').hasValue()) {				
					var viewBox = svg.ToNumberArray(this.attribute('viewBox').value);
					var minX = viewBox[0];
					var minY = viewBox[1];
					width = viewBox[2];
					height = viewBox[3];
					
					svg.AspectRatio(ctx,
									this.attribute('preserveAspectRatio').value, 
									this.attribute('width').toPixels('x'),
									width,
									this.attribute('height').toPixels('y'),
									height,
									minX,
									minY);

					svg.ViewPort.SetCurrent(viewBox[2], viewBox[3]);						
				}
			}			
		}
		svg.Element.symbol.prototype = new svg.Element.RenderedElementBase;		
			
		// style element
		svg.Element.style = function(node) { 
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			// text, or spaces then CDATA
			var css = ''
			for (var i=0; i<node.childNodes.length; i++) {
			  css += node.childNodes[i].nodeValue;
			}
			css = css.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm, ''); // remove comments
			css = svg.compressSpaces(css); // replace whitespace
			var cssDefs = css.split('}');
			for (var i=0; i<cssDefs.length; i++) {
				if (svg.trim(cssDefs[i]) != '') {
					var cssDef = cssDefs[i].split('{');
					var cssClasses = cssDef[0].split(',');
					var cssProps = cssDef[1].split(';');
					for (var j=0; j<cssClasses.length; j++) {
						var cssClass = svg.trim(cssClasses[j]);
						if (cssClass != '') {
							var props = {};
							for (var k=0; k<cssProps.length; k++) {
								var prop = cssProps[k].indexOf(':');
								var name = cssProps[k].substr(0, prop);
								var value = cssProps[k].substr(prop + 1, cssProps[k].length - prop);
								if (name != null && value != null) {
									props[svg.trim(name)] = new svg.Property(svg.trim(name), svg.trim(value));
								}
							}
							svg.Styles[cssClass] = props;
							if (cssClass == '@font-face') {
								var fontFamily = props['font-family'].value.replace(/"/g,'');
								var srcs = props['src'].value.split(',');
								for (var s=0; s<srcs.length; s++) {
									if (srcs[s].indexOf('format("svg")') > 0) {
										var urlStart = srcs[s].indexOf('url');
										var urlEnd = srcs[s].indexOf(')', urlStart);
										var url = srcs[s].substr(urlStart + 5, urlEnd - urlStart - 6);
										var doc = svg.parseXml(svg.ajax(url));
										var fonts = doc.getElementsByTagName('font');
										for (var f=0; f<fonts.length; f++) {
											var font = svg.CreateElement(fonts[f]);
											svg.Definitions[fontFamily] = font;
										}
									}
								}
							}
						}
					}
				}
			}
		}
		svg.Element.style.prototype = new svg.Element.ElementBase;
		
		// use element 
		svg.Element.use = function(node) {
			this.base = svg.Element.RenderedElementBase;
			this.base(node);
			
			this.baseSetContext = this.setContext;
			this.setContext = function(ctx) {
				this.baseSetContext(ctx);
				if (this.attribute('x').hasValue()) ctx.translate(this.attribute('x').toPixels('x'), 0);
				if (this.attribute('y').hasValue()) ctx.translate(0, this.attribute('y').toPixels('y'));
			}
			
			this.getDefinition = function() {
				var element = this.getHrefAttribute().getDefinition();
				if (this.attribute('width').hasValue()) element.attribute('width', true).value = this.attribute('width').value;
				if (this.attribute('height').hasValue()) element.attribute('height', true).value = this.attribute('height').value;
				return element;
			}
			
			this.path = function(ctx) {
				var element = this.getDefinition();
				if (element != null) element.path(ctx);
			}
			
			this.getBoundingBox = function() {
				var element = this.getDefinition();
				if (element != null) return element.getBoundingBox();
			}
			
			this.renderChildren = function(ctx) {
				var element = this.getDefinition();
				if (element != null) {
					// temporarily detach from parent and render
					var oldParent = element.parent;
					element.parent = null;
					element.render(ctx);
					element.parent = oldParent;
				}
			}
		}
		svg.Element.use.prototype = new svg.Element.RenderedElementBase;
		
		// mask element
		svg.Element.mask = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
						
			this.apply = function(ctx, element) {
				// render as temp svg	
				var x = this.attribute('x').toPixels('x');
				var y = this.attribute('y').toPixels('y');
				var width = this.attribute('width').toPixels('x');
				var height = this.attribute('height').toPixels('y');
				
				if (width == 0 && height == 0) {
					var bb = new svg.BoundingBox();
					for (var i=0; i<this.children.length; i++) {
						bb.addBoundingBox(this.children[i].getBoundingBox());
					}
					var x = Math.floor(bb.x1);
					var y = Math.floor(bb.y1);
					var width = Math.floor(bb.width());
					var	height = Math.floor(bb.height());
				}
				
				// temporarily remove mask to avoid recursion
				var mask = element.attribute('mask').value;
				element.attribute('mask').value = '';
				
					var cMask = document.createElement('canvas');
					cMask.width = x + width;
					cMask.height = y + height;
					var maskCtx = cMask.getContext('2d');
					this.renderChildren(maskCtx);
				
					var c = document.createElement('canvas');
					c.width = x + width;
					c.height = y + height;
					var tempCtx = c.getContext('2d');
					element.render(tempCtx);
					tempCtx.globalCompositeOperation = 'destination-in';
					tempCtx.fillStyle = maskCtx.createPattern(cMask, 'no-repeat');
					tempCtx.fillRect(0, 0, x + width, y + height);
					
					ctx.fillStyle = tempCtx.createPattern(c, 'no-repeat');
					ctx.fillRect(0, 0, x + width, y + height);
					
				// reassign mask
				element.attribute('mask').value = mask;	
			}
			
			this.render = function(ctx) {
				// NO RENDER
			}
		}
		svg.Element.mask.prototype = new svg.Element.ElementBase;
		
		// clip element
		svg.Element.clipPath = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			this.apply = function(ctx) {
				for (var i=0; i<this.children.length; i++) {
					var child = this.children[i];
					if (typeof(child.path) != 'undefined') {
						var transform = null;
						if (child.attribute('transform').hasValue()) { 
							transform = new svg.Transform(child.attribute('transform').value);
							transform.apply(ctx);
						}
						child.path(ctx);
						ctx.clip();
						if (transform) { transform.unapply(ctx); }
					}
				}
			}
			
			this.render = function(ctx) {
				// NO RENDER
			}
		}
		svg.Element.clipPath.prototype = new svg.Element.ElementBase;

		// filters
		svg.Element.filter = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
						
			this.apply = function(ctx, element) {
				// render as temp svg	
				var bb = element.getBoundingBox();
				var x = Math.floor(bb.x1);
				var y = Math.floor(bb.y1);
				var width = Math.floor(bb.width());
				var	height = Math.floor(bb.height());

				// temporarily remove filter to avoid recursion
				var filter = element.style('filter').value;
				element.style('filter').value = '';
				
				var px = 0, py = 0;
				for (var i=0; i<this.children.length; i++) {
					var efd = this.children[i].extraFilterDistance || 0;
					px = Math.max(px, efd);
					py = Math.max(py, efd);
				}
				
				var c = document.createElement('canvas');
				c.width = width + 2*px;
				c.height = height + 2*py;
				var tempCtx = c.getContext('2d');
				tempCtx.translate(-x + px, -y + py);
				element.render(tempCtx);
			
				// apply filters
				for (var i=0; i<this.children.length; i++) {
					this.children[i].apply(tempCtx, 0, 0, width + 2*px, height + 2*py);
				}
				
				// render on me
				ctx.drawImage(c, 0, 0, width + 2*px, height + 2*py, x - px, y - py, width + 2*px, height + 2*py);
				
				// reassign filter
				element.style('filter', true).value = filter;	
			}
			
			this.render = function(ctx) {
				// NO RENDER
			}		
		}
		svg.Element.filter.prototype = new svg.Element.ElementBase;
		
		svg.Element.feMorphology = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			this.apply = function(ctx, x, y, width, height) {
				// TODO: implement
			}
		}
		svg.Element.feMorphology.prototype = new svg.Element.ElementBase;
		
		svg.Element.feColorMatrix = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);
			
			function imGet(img, x, y, width, height, rgba) {
				return img[y*width*4 + x*4 + rgba];
			}
			
			function imSet(img, x, y, width, height, rgba, val) {
				img[y*width*4 + x*4 + rgba] = val;
			}
			
			this.apply = function(ctx, x, y, width, height) {
				// only supporting grayscale for now per Issue 195, need to extend to all matrix
				// assuming x==0 && y==0 for now
				var srcData = ctx.getImageData(0, 0, width, height);
				for (var y = 0; y < height; y++) {
					for (var x = 0; x < width; x++) {
						var r = imGet(srcData.data, x, y, width, height, 0);
						var g = imGet(srcData.data, x, y, width, height, 1);
						var b = imGet(srcData.data, x, y, width, height, 2);
						var gray = (r + g + b) / 3;
						imSet(srcData.data, x, y, width, height, 0, gray);
						imSet(srcData.data, x, y, width, height, 1, gray);
						imSet(srcData.data, x, y, width, height, 2, gray);
					}
				}
				ctx.clearRect(0, 0, width, height);
				ctx.putImageData(srcData, 0, 0);
			}
		}
		svg.Element.feColorMatrix.prototype = new svg.Element.ElementBase;
		
		svg.Element.feGaussianBlur = function(node) {
			this.base = svg.Element.ElementBase;
			this.base(node);

			this.blurRadius = Math.floor(this.attribute('stdDeviation').numValue());
			this.extraFilterDistance = this.blurRadius;
			
			this.apply = function(ctx, x, y, width, height) {
				if (typeof(stackBlurCanvasRGBA) == 'undefined') {
					if (typeof(console) != 'undefined') { console.log('ERROR: StackBlur.js must be included for blur to work'); }
					return;
				}
				
				// StackBlur requires canvas be on document
				ctx.canvas.id = svg.UniqueId();
				ctx.canvas.style.display = 'none';
				document.body.appendChild(ctx.canvas);
				stackBlurCanvasRGBA(ctx.canvas.id, x, y, width, height, this.blurRadius);
				document.body.removeChild(ctx.canvas);
			}
		}
		svg.Element.feGaussianBlur.prototype = new svg.Element.ElementBase;
		
		// title element, do nothing
		svg.Element.title = function(node) {
		}
		svg.Element.title.prototype = new svg.Element.ElementBase;

		// desc element, do nothing
		svg.Element.desc = function(node) {
		}
		svg.Element.desc.prototype = new svg.Element.ElementBase;		
		
		svg.Element.MISSING = function(node) {
			if (typeof(console) != 'undefined') { console.log('ERROR: Element \'' + node.nodeName + '\' not yet implemented.'); }
		}
		svg.Element.MISSING.prototype = new svg.Element.ElementBase;
		
		// element factory
		svg.CreateElement = function(node) {	
			var className = node.nodeName.replace(/^[^:]+:/,''); // remove namespace
			className = className.replace(/\-/g,''); // remove dashes
			var e = null;
			if (typeof(svg.Element[className]) != 'undefined') {
				e = new svg.Element[className](node);
			}
			else {
				e = new svg.Element.MISSING(node);
			}

			e.type = node.nodeName;
			return e;
		}
				
		// load from url
		svg.load = function(ctx, url) {
			svg.loadXml(ctx, svg.ajax(url));
		}
		
		// load from xml
		svg.loadXml = function(ctx, xml) {
			svg.loadXmlDoc(ctx, svg.parseXml(xml));
		}
		
		svg.loadXmlDoc = function(ctx, dom) {
			svg.init(ctx);
			
			var mapXY = function(p) {
				var e = ctx.canvas;
				while (e) {
					p.x -= e.offsetLeft;
					p.y -= e.offsetTop;
					e = e.offsetParent;
				}
				if (window.scrollX) p.x += window.scrollX;
				if (window.scrollY) p.y += window.scrollY;
				return p;
			}
			
			// bind mouse
			if (svg.opts['ignoreMouse'] != true) {
				ctx.canvas.onclick = function(e) {
					var p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));
					svg.Mouse.onclick(p.x, p.y);
				};
				ctx.canvas.onmousemove = function(e) {
					var p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));
					svg.Mouse.onmousemove(p.x, p.y);
				};
			}
		
			var e = svg.CreateElement(dom.documentElement);
			e.root = true;
					
			// render loop
			var isFirstRender = true;
			var draw = function() {
				svg.ViewPort.Clear();
				if (ctx.canvas.parentNode) svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth, ctx.canvas.parentNode.clientHeight);
			
				if (svg.opts['ignoreDimensions'] != true) {
					// set canvas size
					if (e.style('width').hasValue()) {
						ctx.canvas.width = e.style('width').toPixels('x');
						ctx.canvas.style.width = ctx.canvas.width + 'px';
					}
					if (e.style('height').hasValue()) {
						ctx.canvas.height = e.style('height').toPixels('y');
						ctx.canvas.style.height = ctx.canvas.height + 'px';
					}
				}
				var cWidth = ctx.canvas.clientWidth || ctx.canvas.width;
				var cHeight = ctx.canvas.clientHeight || ctx.canvas.height;
				if (svg.opts['ignoreDimensions'] == true && e.style('width').hasValue() && e.style('height').hasValue()) {
					cWidth = e.style('width').toPixels('x');
					cHeight = e.style('height').toPixels('y');
				}
				svg.ViewPort.SetCurrent(cWidth, cHeight);		
				
				if (svg.opts['offsetX'] != null) e.attribute('x', true).value = svg.opts['offsetX'];
				if (svg.opts['offsetY'] != null) e.attribute('y', true).value = svg.opts['offsetY'];
				if (svg.opts['scaleWidth'] != null && svg.opts['scaleHeight'] != null) {
					var xRatio = 1, yRatio = 1, viewBox = svg.ToNumberArray(e.attribute('viewBox').value);
					if (e.attribute('width').hasValue()) xRatio = e.attribute('width').toPixels('x') / svg.opts['scaleWidth'];
					else if (!isNaN(viewBox[2])) xRatio = viewBox[2] / svg.opts['scaleWidth'];
					if (e.attribute('height').hasValue()) yRatio = e.attribute('height').toPixels('y') / svg.opts['scaleHeight'];
					else if (!isNaN(viewBox[3])) yRatio = viewBox[3] / svg.opts['scaleHeight'];
					
					e.attribute('width', true).value = svg.opts['scaleWidth'];
					e.attribute('height', true).value = svg.opts['scaleHeight'];			
					e.attribute('viewBox', true).value = '0 0 ' + (cWidth * xRatio) + ' ' + (cHeight * yRatio);
					e.attribute('preserveAspectRatio', true).value = 'none';
				}
			
				// clear and render
				if (svg.opts['ignoreClear'] != true) {
					ctx.clearRect(0, 0, cWidth, cHeight);
				}
				e.render(ctx);
				if (isFirstRender) {
					isFirstRender = false;
					if (typeof(svg.opts['renderCallback']) == 'function') svg.opts['renderCallback'](dom);
				}			
			}
			
			var waitingForImages = true;
			if (svg.ImagesLoaded()) {
				waitingForImages = false;
				draw();
			}
			svg.intervalID = setInterval(function() { 
				var needUpdate = false;
				
				if (waitingForImages && svg.ImagesLoaded()) {
					waitingForImages = false;
					needUpdate = true;
				}
			
				// need update from mouse events?
				if (svg.opts['ignoreMouse'] != true) {
					needUpdate = needUpdate | svg.Mouse.hasEvents();
				}
			
				// need update from animations?
				if (svg.opts['ignoreAnimation'] != true) {
					for (var i=0; i<svg.Animations.length; i++) {
						needUpdate = needUpdate | svg.Animations[i].update(1000 / svg.FRAMERATE);
					}
				}
				
				// need update from redraw?
				if (typeof(svg.opts['forceRedraw']) == 'function') {
					if (svg.opts['forceRedraw']() == true) needUpdate = true;
				}
				
				// render if needed
				if (needUpdate) {
					draw();				
					svg.Mouse.runEvents(); // run and clear our events
				}
			}, 1000 / svg.FRAMERATE);
		}
		
		svg.stop = function() {
			if (svg.intervalID) {
				clearInterval(svg.intervalID);
			}
		}
		
		svg.Mouse = new (function() {
			this.events = [];
			this.hasEvents = function() { return this.events.length != 0; }
		
			this.onclick = function(x, y) {
				this.events.push({ type: 'onclick', x: x, y: y, 
					run: function(e) { if (e.onclick) e.onclick(); }
				});
			}
			
			this.onmousemove = function(x, y) {
				this.events.push({ type: 'onmousemove', x: x, y: y,
					run: function(e) { if (e.onmousemove) e.onmousemove(); }
				});
			}			
			
			this.eventElements = [];
			
			this.checkPath = function(element, ctx) {
				for (var i=0; i<this.events.length; i++) {
					var e = this.events[i];
					if (ctx.isPointInPath && ctx.isPointInPath(e.x, e.y)) this.eventElements[i] = element;
				}
			}
			
			this.checkBoundingBox = function(element, bb) {
				for (var i=0; i<this.events.length; i++) {
					var e = this.events[i];
					if (bb.isPointInBox(e.x, e.y)) this.eventElements[i] = element;
				}			
			}
			
			this.runEvents = function() {
				svg.ctx.canvas.style.cursor = '';
				
				for (var i=0; i<this.events.length; i++) {
					var e = this.events[i];
					var element = this.eventElements[i];
					while (element) {
						e.run(element);
						element = element.parent;
					}
				}		
			
				// done running, clear
				this.events = []; 
				this.eventElements = [];
			}
		});
		
		return svg;
	}
})();

if (typeof(CanvasRenderingContext2D) != 'undefined') {
	CanvasRenderingContext2D.prototype.drawSvg = function(s, dx, dy, dw, dh) {
		canvg(this.canvas, s, { 
			ignoreMouse: true, 
			ignoreAnimation: true, 
			ignoreDimensions: true, 
			ignoreClear: true, 
			offsetX: dx, 
			offsetY: dy, 
			scaleWidth: dw, 
			scaleHeight: dh
		});
	}
}
/* FileSaver.js
 * A saveAs() FileSaver implementation.
 * 2013-10-21
 *
 * By Eli Grey, http://eligrey.com
 * License: X11/MIT
 *   See LICENSE.md
 */

/*global self */
/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,
  plusplus: true */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
if(AmCharts.isModern){ /// added by AmCharts to avoid old IE problems if this file is included
var saveAs = saveAs
  || (typeof navigator !== 'undefined' && navigator.msSaveOrOpenBlob && navigator.msSaveOrOpenBlob.bind(navigator))
  || (function(view) {
	"use strict";
	var
		  doc = view.document
		  // only get URL when necessary in case BlobBuilder.js hasn't overridden it yet
		, get_URL = function() {
			return view.URL || view.webkitURL || view;
		}
		, URL = view.URL || view.webkitURL || view
		, save_link = doc.createElementNS("http://www.w3.org/1999/xhtml", "a")
		, can_use_save_link =  !view.externalHost && "download" in save_link
		, click = function(node) {
			var event = doc.createEvent("MouseEvents");
			event.initMouseEvent(
				"click", true, false, view, 0, 0, 0, 0, 0
				, false, false, false, false, 0, null
			);
			node.dispatchEvent(event);
		}
		, webkit_req_fs = view.webkitRequestFileSystem
		, req_fs = view.requestFileSystem || webkit_req_fs || view.mozRequestFileSystem
		, throw_outside = function (ex) {
			(view.setImmediate || view.setTimeout)(function() {
				throw ex;
			}, 0);
		}
		, force_saveable_type = "application/octet-stream"
		, fs_min_size = 0
		, deletion_queue = []
		, process_deletion_queue = function() {
			var i = deletion_queue.length;
			while (i--) {
				var file = deletion_queue[i];
				if (typeof file === "string") { // file is an object URL
					URL.revokeObjectURL(file);
				} else { // file is a File
					file.remove();
				}
			}
			deletion_queue.length = 0; // clear queue
		}
		, dispatch = function(filesaver, event_types, event) {
			event_types = [].concat(event_types);
			var i = event_types.length;
			while (i--) {
				var listener = filesaver["on" + event_types[i]];
				if (typeof listener === "function") {
					try {
						listener.call(filesaver, event || filesaver);
					} catch (ex) {
						throw_outside(ex);
					}
				}
			}
		}
		, FileSaver = function(blob, name) {
			// First try a.download, then web filesystem, then object URLs
			var
				  filesaver = this
				, type = blob.type
				, blob_changed = false
				, object_url
				, target_view
				, get_object_url = function() {
					var object_url = get_URL().createObjectURL(blob);
					deletion_queue.push(object_url);
					return object_url;
				}
				, dispatch_all = function() {
					dispatch(filesaver, "writestart progress write writeend".split(" "));
				}
				// on any filesys errors revert to saving with object URLs
				, fs_error = function() {
					// don't create more object URLs than needed
					if (blob_changed || !object_url) {
						object_url = get_object_url(blob);
					}
					if (target_view) {
						target_view.location.href = object_url;
					} else {
                        window.open(object_url, "_blank");
                    }
					filesaver.readyState = filesaver.DONE;
					dispatch_all();
				}
				, abortable = function(func) {
					return function() {
						if (filesaver.readyState !== filesaver.DONE) {
							return func.apply(this, arguments);
						}
					};
				}
				, create_if_not_found = {create: true, exclusive: false}
				, slice
			;
			filesaver.readyState = filesaver.INIT;
			if (!name) {
				name = "download";
			}
			if (can_use_save_link) {
				object_url = get_object_url(blob);
				// FF for Android has a nasty garbage collection mechanism
				// that turns all objects that are not pure javascript into 'deadObject'
				// this means `doc` and `save_link` are unusable and need to be recreated
				// `view` is usable though:
				doc = view.document;
				save_link = doc.createElementNS("http://www.w3.org/1999/xhtml", "a");
				save_link.href = object_url;
				save_link.download = name;
				var event = doc.createEvent("MouseEvents");
				event.initMouseEvent(
					"click", true, false, view, 0, 0, 0, 0, 0
					, false, false, false, false, 0, null
				);
				save_link.dispatchEvent(event);
				filesaver.readyState = filesaver.DONE;
				dispatch_all();
				return;
			}
			// Object and web filesystem URLs have a problem saving in Google Chrome when
			// viewed in a tab, so I force save with application/octet-stream
			// http://code.google.com/p/chromium/issues/detail?id=91158
			if (view.chrome && type && type !== force_saveable_type) {
				slice = blob.slice || blob.webkitSlice;
				blob = slice.call(blob, 0, blob.size, force_saveable_type);
				blob_changed = true;
			}
			// Since I can't be sure that the guessed media type will trigger a download
			// in WebKit, I append .download to the filename.
			// https://bugs.webkit.org/show_bug.cgi?id=65440
			if (webkit_req_fs && name !== "download") {
				name += ".download";
			}
			if (type === force_saveable_type || webkit_req_fs) {
				target_view = view;
			}
			if (!req_fs) {
				fs_error();
				return;
			}
			fs_min_size += blob.size;
			req_fs(view.TEMPORARY, fs_min_size, abortable(function(fs) {
				fs.root.getDirectory("saved", create_if_not_found, abortable(function(dir) {
					var save = function() {
						dir.getFile(name, create_if_not_found, abortable(function(file) {
							file.createWriter(abortable(function(writer) {
								writer.onwriteend = function(event) {
									target_view.location.href = file.toURL();
									deletion_queue.push(file);
									filesaver.readyState = filesaver.DONE;
									dispatch(filesaver, "writeend", event);
								};
								writer.onerror = function() {
									var error = writer.error;
									if (error.code !== error.ABORT_ERR) {
										fs_error();
									}
								};
								"writestart progress write abort".split(" ").forEach(function(event) {
									writer["on" + event] = filesaver["on" + event];
								});
								writer.write(blob);
								filesaver.abort = function() {
									writer.abort();
									filesaver.readyState = filesaver.DONE;
								};
								filesaver.readyState = filesaver.WRITING;
							}), fs_error);
						}), fs_error);
					};
					dir.getFile(name, {create: false}, abortable(function(file) {
						// delete file if it already exists
						file.remove();
						save();
					}), abortable(function(ex) {
						if (ex.code === ex.NOT_FOUND_ERR) {
							save();
						} else {
							fs_error();
						}
					}));
				}), fs_error);
			}), fs_error);
		}
		, FS_proto = FileSaver.prototype
		, saveAs = function(blob, name) {
			return new FileSaver(blob, name);
		}
	;
	FS_proto.abort = function() {
		var filesaver = this;
		filesaver.readyState = filesaver.DONE;
		dispatch(filesaver, "abort");
	};
	FS_proto.readyState = FS_proto.INIT = 0;
	FS_proto.WRITING = 1;
	FS_proto.DONE = 2;

	FS_proto.error =
	FS_proto.onwritestart =
	FS_proto.onprogress =
	FS_proto.onwrite =
	FS_proto.onabort =
	FS_proto.onerror =
	FS_proto.onwriteend =
		null;

	view.addEventListener("unload", process_deletion_queue, false);
	return saveAs;
}(this.self || this.window || this.content));
// `self` is undefined in Firefox for Android content script context
// while `this` is nsIContentFrameMessageManager
// with an attribute `content` that corresponds to the window

if (typeof module !== 'undefined') module.exports = saveAs;
}/// added by AmCharts to avoid old IE problems if this file is included
/** @preserve jsPDF 0.9.0rc2 ( ${buildDate} ${commitID} )
Copyright (c) 2010-2012 James Hall, james@snapshotmedia.co.uk, https://github.com/MrRio/jsPDF
Copyright (c) 2012 Willow Systems Corporation, willow-systems.com
MIT license.
*/

/*
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */


/**
Creates new jsPDF document object instance
@class
@param orientation One of "portrait" or "landscape" (or shortcuts "p" (Default), "l")
@param unit Measurement unit to be used when coordinates are specified. One of "pt" (points), "mm" (Default), "cm", "in"
@param format One of 'a0', 'a1', 'a2', 'a3', 'a4' (Default) etc to 'a10', 'b0' to 'b10', 'c0' to 'c10', 'letter', 'government-letter', 'legal', 'junior-legal', 'ledger' or 'tabloid'
@returns {jsPDF}
@name jsPDF
*/
var jsPDF = (function () {
    'use strict';
    /*jslint browser:true, plusplus: true, bitwise: true, nomen: true */
    /*global document: false, btoa, atob, zpipe, Uint8Array, ArrayBuffer, Blob, saveAs, adler32cs, Deflater */

// this will run on <=IE9, possibly some niche browsers
// new webkit-based, FireFox, IE10 already have native version of this.
    if (typeof btoa === 'undefined') {
        window.btoa = function (data) {
        // DO NOT ADD UTF8 ENCODING CODE HERE!!!!

        // UTF8 encoding encodes bytes over char code 128
        // and, essentially, turns an 8-bit binary streams
        // (that base64 can deal with) into 7-bit binary streams.
        // (by default server does not know that and does not recode the data back to 8bit)
        // You destroy your data.

        // binary streams like jpeg image data etc, while stored in JavaScript strings,
        // (which are 16bit arrays) are in 8bit format already.
        // You do NOT need to char-encode that before base64 encoding.

        // if you, by act of fate
        // have string which has individual characters with code
        // above 255 (pure unicode chars), encode that BEFORE you base64 here.
        // you can use absolutely any approch there, as long as in the end,
        // base64 gets an 8bit (char codes 0 - 255) stream.
        // when you get it on the server after un-base64, you must
        // UNencode it too, to get back to 16, 32bit or whatever original bin stream.

        // Note, Yes, JavaScript strings are, in most cases UCS-2 -
        // 16-bit character arrays. This does not mean, however,
        // that you always have to UTF8 it before base64.
        // it means that if you have actual characters anywhere in
        // that string that have char code above 255, you need to
        // recode *entire* string from 16-bit (or 32bit) to 8-bit array.
        // You can do binary split to UTF16 (BE or LE)
        // you can do utf8, you can split the thing by hand and prepend BOM to it,
        // but whatever you do, make sure you mirror the opposite on
        // the server. If server does not expect to post-process un-base64
        // 8-bit binary stream, think very very hard about messing around with encoding.

        // so, long story short:
        // DO NOT ADD UTF8 ENCODING CODE HERE!!!!

        /* @preserve
        ====================================================================
        base64 encoder
        MIT, GPL

        version: 1109.2015
        discuss at: http://phpjs.org/functions/base64_encode
        +   original by: Tyler Akins (http://rumkin.com)
        +   improved by: Bayron Guevara
        +   improved by: Thunder.m
        +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        +   bugfixed by: Pellentesque Malesuada
        +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        +   improved by: Rafal Kukawski (http://kukawski.pl)
        +                Daniel Dotsenko, Willow Systems Corp, willow-systems.com
        ====================================================================
        */

            var b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
                b64a = b64.split(''),
                o1,
                o2,
                o3,
                h1,
                h2,
                h3,
                h4,
                bits,
                i = 0,
                ac = 0,
                enc = "",
                tmp_arr = [],
                r;

            do { // pack three octets into four hexets
                o1 = data.charCodeAt(i++);
                o2 = data.charCodeAt(i++);
                o3 = data.charCodeAt(i++);

                bits = o1 << 16 | o2 << 8 | o3;

                h1 = bits >> 18 & 0x3f;
                h2 = bits >> 12 & 0x3f;
                h3 = bits >> 6 & 0x3f;
                h4 = bits & 0x3f;

                // use hexets to index into b64, and append result to encoded string
                tmp_arr[ac++] = b64a[h1] + b64a[h2] + b64a[h3] + b64a[h4];
            } while (i < data.length);

            enc = tmp_arr.join('');
            r = data.length % 3;
            return (r ? enc.slice(0, r - 3) : enc) + '==='.slice(r || 3);
            // end of base64 encoder MIT, GPL
        };
    }

    if (typeof atob === 'undefined') {
        window.atob = function (data) {
        // http://kevin.vanzonneveld.net
        // +   original by: Tyler Akins (http://rumkin.com)
        // +   improved by: Thunder.m
        // +      input by: Aman Gupta
        // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        // +   bugfixed by: Onno Marsman
        // +   bugfixed by: Pellentesque Malesuada
        // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        // +      input by: Brett Zamir (http://brett-zamir.me)
        // +   bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        // *     example 1: base64_decode('S2V2aW4gdmFuIFpvbm5ldmVsZA==');
        // *     returns 1: 'Kevin van Zonneveld'
        // mozilla has this native
        // - but breaks in 2.0.0.12!
        //if (typeof this.window['atob'] == 'function') {
        //    return atob(data);
        //}
            var b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
                o1,
                o2,
                o3,
                h1,
                h2,
                h3,
                h4,
                bits,
                i = 0,
                ac = 0,
                dec = "",
                tmp_arr = [];

            if (!data) {
                return data;
            }

            data += '';

            do { // unpack four hexets into three octets using index points in b64
                h1 = b64.indexOf(data.charAt(i++));
                h2 = b64.indexOf(data.charAt(i++));
                h3 = b64.indexOf(data.charAt(i++));
                h4 = b64.indexOf(data.charAt(i++));

                bits = h1 << 18 | h2 << 12 | h3 << 6 | h4;

                o1 = bits >> 16 & 0xff;
                o2 = bits >> 8 & 0xff;
                o3 = bits & 0xff;

                if (h3 === 64) {
                    tmp_arr[ac++] = String.fromCharCode(o1);
                } else if (h4 === 64) {
                    tmp_arr[ac++] = String.fromCharCode(o1, o2);
                } else {
                    tmp_arr[ac++] = String.fromCharCode(o1, o2, o3);
                }
            } while (i < data.length);
            dec = tmp_arr.join('');
            return dec;
        };
    }

    var getObjectLength = typeof Object.keys === 'function' ?
                function (object) {
                    return Object.keys(object).length;
                } :
                function (object) {
                    var i = 0, e;
                    for (e in object) {
                        if (object.hasOwnProperty(e)) {
                            i++;
                        }
                    }
                    return i;
                },

/**
PubSub implementation

@class
@name PubSub
*/
        PubSub = function (context) {
            /**  @preserve
            -----------------------------------------------------------------------------------------------
            JavaScript PubSub library
            2012 (c) ddotsenko@willowsystems.com
            based on Peter Higgins (dante@dojotoolkit.org)
            Loosely based on Dojo publish/subscribe API, limited in scope. Rewritten blindly.
            Original is (c) Dojo Foundation 2004-2010. Released under either AFL or new BSD, see:
            http://dojofoundation.org/license for more information.
            -----------------------------------------------------------------------------------------------
            */
            /**
            @private
            @fieldOf PubSub
            */
            this.topics = {};
            /**
            Stores what will be `this` within the callback functions.

            @private
            @fieldOf PubSub#
            */
            this.context = context;
            /**
            Allows caller to emit an event and pass arguments to event listeners.
            @public
            @function
            @param topic {String} Name of the channel on which to voice this event
            @param args Any number of arguments you want to pass to the listeners of this event.
            @methodOf PubSub#
            @name publish
            */
            this.publish = function (topic, args) {
                if (this.topics[topic]) {
                    var currentTopic = this.topics[topic],
                        toremove = [],
                        fn,
                        i,
                        l,
                        pair,
                        emptyFunc = function () {};
                    args = Array.prototype.slice.call(arguments, 1);
                    for (i = 0, l = currentTopic.length; i < l; i++) {
                        pair = currentTopic[i]; // this is a [function, once_flag] array
                        fn = pair[0];
                        if (pair[1]) { /* 'run once' flag set */
                            pair[0] = emptyFunc;
                            toremove.push(i);
                        }
                        fn.apply(this.context, args);
                    }
                    for (i = 0, l = toremove.length; i < l; i++) {
                        currentTopic.splice(toremove[i], 1);
                    }
                }
            };
            /**
            Allows listener code to subscribe to channel and be called when data is available
            @public
            @function
            @param topic {String} Name of the channel on which to voice this event
            @param callback {Function} Executable (function pointer) that will be ran when event is voiced on this channel.
            @param once {Boolean} (optional. False by default) Flag indicating if the function is to be triggered only once.
            @returns {Object} A token object that cen be used for unsubscribing.
            @methodOf PubSub#
            @name subscribe
            */
            this.subscribe = function (topic, callback, once) {
                if (!this.topics[topic]) {
                    this.topics[topic] = [[callback, once]];
                } else {
                    this.topics[topic].push([callback, once]);
                }
                return {
                    "topic": topic,
                    "callback": callback
                };
            };
            /**
            Allows listener code to unsubscribe from a channel
            @public
            @function
            @param token {Object} A token object that was returned by `subscribe` method
            @methodOf PubSub#
            @name unsubscribe
            */
            this.unsubscribe = function (token) {
                if (this.topics[token.topic]) {
                    var currentTopic = this.topics[token.topic], i, l;

                    for (i = 0, l = currentTopic.length; i < l; i++) {
                        if (currentTopic[i][0] === token.callback) {
                            currentTopic.splice(i, 1);
                        }
                    }
                }
            };
        };


/**
@constructor
@private
*/
    function jsPDF(orientation, unit, format, compressPdf) { /** String orientation, String unit, String format, Boolean compressed */

        // Default parameter values
        if (typeof orientation === 'undefined') {
            orientation = 'p';
        } else {
            orientation = orientation.toString().toLowerCase();
        }
        if (typeof unit === 'undefined') { unit = 'mm'; }
        if (typeof format === 'undefined') { format = 'a4'; }
        if (typeof compressPdf === 'undefined' && typeof zpipe === 'undefined') { compressPdf = false; }

        var format_as_string = format.toString().toLowerCase(),
            version = '0.9.0rc2',
            content = [],
            content_length = 0,
            compress = compressPdf,
            pdfVersion = '1.3', // PDF Version
            pageFormats = { // Size in pt of various paper formats
                'a0': [2383.94, 3370.39],
                'a1': [1683.78, 2383.94],
                'a2': [1190.55, 1683.78],
                'a3': [841.89,  1190.55],
                'a4': [595.28,  841.89],
                'a5': [419.53,  595.28],
                'a6': [297.64,  419.53],
                'a7': [209.76,  297.64],
                'a8': [147.4 ,  209.76],
                'a9': [104.88,  147.4],
                'a10': [73.7,  104.88],
                'b0': [2834.65, 4008.19],
                'b1': [2004.09, 2834.65],
                'b2': [1417.32, 2004.09],
                'b3': [1000.63, 1417.32],
                'b4': [708.66,  1000.63],
                'b5': [498.9,  708.66],
                'b6': [354.33,  498.9],
                'b7': [249.45,  354.33],
                'b8': [175.75,  249.45],
                'b9': [124.72,  175.75],
                'b10': [87.87,  124.72],
                'c0': [2599.37, 3676.54],
                'c1': [1836.85, 2599.37],
                'c2': [1298.27, 1836.85],
                'c3': [918.43,  1298.27],
                'c4': [649.13,  918.43],
                'c5': [459.21,  649.13],
                'c6': [323.15,  459.21],
                'c7': [229.61,  323.15],
                'c8': [161.57,  229.61],
                'c9': [113.39,  161.57],
                'c10': [79.37,   113.39],
                'letter': [612, 792],
                'government-letter': [576, 756],
                'legal': [612, 1008],
                'junior-legal': [576, 360],
                'ledger': [1224, 792],
                'tabloid': [792, 1224]
            },
            textColor = '0 g',
            drawColor = '0 G',
            page = 0,
            pages = [],
            objectNumber = 2, // 'n' Current object number
            outToPages = false, // switches where out() prints. outToPages true = push to pages obj. outToPages false = doc builder content
            offsets = [], // List of offsets. Activated and reset by buildDocument(). Pupulated by various calls buildDocument makes.
            fonts = {}, // collection of font objects, where key is fontKey - a dynamically created label for a given font.
            fontmap = {}, // mapping structure fontName > fontStyle > font key - performance layer. See addFont()
            activeFontSize = 16,
            activeFontKey, // will be string representing the KEY of the font as combination of fontName + fontStyle
            lineWidth = 0.200025, // 2mm
            lineHeightProportion = 1.15,
            pageHeight,
            pageWidth,
            k, // Scale factor
            documentProperties = {'title': '', 'subject': '', 'author': '', 'keywords': '', 'creator': ''},
            lineCapID = 0,
            lineJoinID = 0,
            API = {},
            events = new PubSub(API),
            tmp,
            plugin,
            /////////////////////
            // Private functions
            /////////////////////
            // simplified (speedier) replacement for sprintf's %.2f conversion
            f2 = function (number) {
                return number.toFixed(2);
            },
            // simplified (speedier) replacement for sprintf's %.3f conversion
            f3 = function (number) {
                return number.toFixed(3);
            },
            // simplified (speedier) replacement for sprintf's %02d
            padd2 = function (number) {
                var n = (number).toFixed(0);
                if (number < 10) {
                    return '0' + n;
                } else {
                    return n;
                }
            },
            // simplified (speedier) replacement for sprintf's %02d
            padd10 = function (number) {
                var n = (number).toFixed(0);
                if (n.length < 10) {
                    return new Array( 11 - n.length ).join('0') + n;
                } else {
                    return n;
                }
            },
            out = function (string) {
                if (outToPages) { /* set by beginPage */
                    pages[page].push(string);
                } else {
                    content.push(string);
                    content_length += string.length + 1; // +1 is for '\n' that will be used to join contents of content
                }
            },
            newObject = function () {
                // Begin a new object
                objectNumber++;
                offsets[objectNumber] = content_length;
                out(objectNumber + ' 0 obj');
                return objectNumber;
            },
            putStream = function (str) {
                out('stream');
                out(str);
                out('endstream');
            },
            wPt,
            hPt,
            kids,
            i,
            putPages = function () {
                wPt = pageWidth * k;
                hPt = pageHeight * k;

                // outToPages = false as set in endDocument(). out() writes to content.

                var n, p, arr, uint, i, deflater, adler32;
                for (n = 1; n <= page; n++) {
                    newObject();
                    out('<</Type /Page');
                    out('/Parent 1 0 R');
                    out('/Resources 2 0 R');
                    out('/Contents ' + (objectNumber + 1) + ' 0 R>>');
                    out('endobj');

                    // Page content
                    p = pages[n].join('\n');
                    newObject();
                    if (compress) {
                        arr = [];
                        for (i = 0; i < p.length; ++i) {
                            arr[i] = p.charCodeAt(i);
                        }
                        adler32 = adler32cs.from(p);
                        deflater = new Deflater(6);
                        deflater.append(new Uint8Array(arr));
                        p = deflater.flush();
                        arr = [new Uint8Array([120, 156]), new Uint8Array(p),
                               new Uint8Array([adler32 & 0xFF, (adler32 >> 8) & 0xFF, (adler32 >> 16) & 0xFF, (adler32 >> 24) & 0xFF])];
                        p = '';
                        for (i in arr) {
                            if (arr.hasOwnProperty(i)) {
                                p += String.fromCharCode.apply(null, arr[i]);
                            }
                        }
                        out('<</Length ' + p.length  + ' /Filter [/FlateDecode]>>');
                    } else {
                        out('<</Length ' + p.length  + '>>');
                    }
                    putStream(p);
                    out('endobj');
                }
                offsets[1] = content_length;
                out('1 0 obj');
                out('<</Type /Pages');
                kids = '/Kids [';
                for (i = 0; i < page; i++) {
                    kids += (3 + 2 * i) + ' 0 R ';
                }
                out(kids + ']');
                out('/Count ' + page);
                out('/MediaBox [0 0 ' + f2(wPt) + ' ' + f2(hPt) + ']');
                out('>>');
                out('endobj');
            },
            putFont = function (font) {
                font.objectNumber = newObject();
                out('<</BaseFont/' + font.PostScriptName + '/Type/Font');
                if (typeof font.encoding === 'string') {
                    out('/Encoding/' + font.encoding);
                }
                out('/Subtype/Type1>>');
                out('endobj');
            },
            putFonts = function () {
                var fontKey;
                for (fontKey in fonts) {
                    if (fonts.hasOwnProperty(fontKey)) {
                        putFont(fonts[fontKey]);
                    }
                }
            },
            putXobjectDict = function () {
                // Loop through images, or other data objects
                events.publish('putXobjectDict');
            },
            putResourceDictionary = function () {
                out('/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]');
                out('/Font <<');
                // Do this for each font, the '1' bit is the index of the font
                var fontKey;
                for (fontKey in fonts) {
                    if (fonts.hasOwnProperty(fontKey)) {
                        out('/' + fontKey + ' ' + fonts[fontKey].objectNumber + ' 0 R');
                    }
                }
                out('>>');
                out('/XObject <<');
                putXobjectDict();
                out('>>');
            },
            putResources = function () {
                putFonts();
                events.publish('putResources');
                // Resource dictionary
                offsets[2] = content_length;
                out('2 0 obj');
                out('<<');
                putResourceDictionary();
                out('>>');
                out('endobj');
                events.publish('postPutResources');
            },
            addToFontDictionary = function (fontKey, fontName, fontStyle) {
                // this is mapping structure for quick font key lookup.
                // returns the KEY of the font (ex: "F1") for a given pair of font name and type (ex: "Arial". "Italic")
                var undef;
                if (fontmap[fontName] === undef) {
                    fontmap[fontName] = {}; // fontStyle is a var interpreted and converted to appropriate string. don't wrap in quotes.
                }
                fontmap[fontName][fontStyle] = fontKey;
            },
            /**
            FontObject describes a particular font as member of an instnace of jsPDF

            It's a collection of properties like 'id' (to be used in PDF stream),
            'fontName' (font's family name), 'fontStyle' (font's style variant label)

            @class
            @public
            @property id {String} PDF-document-instance-specific label assinged to the font.
            @property PostScriptName {String} PDF specification full name for the font
            @property encoding {Object} Encoding_name-to-Font_metrics_object mapping.
            @name FontObject
            */
            FontObject = {},
            addFont = function (PostScriptName, fontName, fontStyle, encoding) {
                var fontKey = 'F' + (getObjectLength(fonts) + 1).toString(10),
                    // This is FontObject
                    font = fonts[fontKey] = {
                        'id': fontKey,
                        // , 'objectNumber':   will be set by putFont()
                        'PostScriptName': PostScriptName,
                        'fontName': fontName,
                        'fontStyle': fontStyle,
                        'encoding': encoding,
                        'metadata': {}
                    };

                addToFontDictionary(fontKey, fontName, fontStyle);

                events.publish('addFont', font);

                return fontKey;
            },
            addFonts = function () {

                var HELVETICA = "helvetica",
                    TIMES = "times",
                    COURIER = "courier",
                    NORMAL = "normal",
                    BOLD = "bold",
                    ITALIC = "italic",
                    BOLD_ITALIC = "bolditalic",
                    encoding = 'StandardEncoding',
                    standardFonts = [
                        ['Helvetica', HELVETICA, NORMAL],
                        ['Helvetica-Bold', HELVETICA, BOLD],
                        ['Helvetica-Oblique', HELVETICA, ITALIC],
                        ['Helvetica-BoldOblique', HELVETICA, BOLD_ITALIC],
                        ['Courier', COURIER, NORMAL],
                        ['Courier-Bold', COURIER, BOLD],
                        ['Courier-Oblique', COURIER, ITALIC],
                        ['Courier-BoldOblique', COURIER, BOLD_ITALIC],
                        ['Times-Roman', TIMES, NORMAL],
                        ['Times-Bold', TIMES, BOLD],
                        ['Times-Italic', TIMES, ITALIC],
                        ['Times-BoldItalic', TIMES, BOLD_ITALIC]
                    ],
                    i,
                    l,
                    fontKey,
                    parts;
                for (i = 0, l = standardFonts.length; i < l; i++) {
                    fontKey = addFont(
                        standardFonts[i][0],
                        standardFonts[i][1],
                        standardFonts[i][2],
                        encoding
                    );

                    // adding aliases for standard fonts, this time matching the capitalization
                    parts = standardFonts[i][0].split('-');
                    addToFontDictionary(fontKey, parts[0], parts[1] || '');
                }

                events.publish('addFonts', {'fonts': fonts, 'dictionary': fontmap});
            },
            /**

            @public
            @function
            @param text {String}
            @param flags {Object} Encoding flags.
            @returns {String} Encoded string
            */
            to8bitStream = function (text, flags) {
                /* PDF 1.3 spec:
                "For text strings encoded in Unicode, the first two bytes must be 254 followed by
                255, representing the Unicode byte order marker, U+FEFF. (This sequence conflicts
                with the PDFDocEncoding character sequence thorn ydieresis, which is unlikely
                to be a meaningful beginning of a word or phrase.) The remainder of the
                string consists of Unicode character codes, according to the UTF-16 encoding
                specified in the Unicode standard, version 2.0. Commonly used Unicode values
                are represented as 2 bytes per character, with the high-order byte appearing first
                in the string."

                In other words, if there are chars in a string with char code above 255, we
                recode the string to UCS2 BE - string doubles in length and BOM is prepended.

                HOWEVER!
                Actual *content* (body) text (as opposed to strings used in document properties etc)
                does NOT expect BOM. There, it is treated as a literal GID (Glyph ID)

                Because of Adobe's focus on "you subset your fonts!" you are not supposed to have
                a font that maps directly Unicode (UCS2 / UTF16BE) code to font GID, but you could
                fudge it with "Identity-H" encoding and custom CIDtoGID map that mimics Unicode
                code page. There, however, all characters in the stream are treated as GIDs,
                including BOM, which is the reason we need to skip BOM in content text (i.e. that
                that is tied to a font).

                To signal this "special" PDFEscape / to8bitStream handling mode,
                API.text() function sets (unless you overwrite it with manual values
                given to API.text(.., flags) )
                    flags.autoencode = true
                    flags.noBOM = true

                */

                /*
                `flags` properties relied upon:
                .sourceEncoding = string with encoding label.
                    "Unicode" by default. = encoding of the incoming text.
                    pass some non-existing encoding name
                    (ex: 'Do not touch my strings! I know what I am doing.')
                    to make encoding code skip the encoding step.
                .outputEncoding = Either valid PDF encoding name
                    (must be supported by jsPDF font metrics, otherwise no encoding)
                    or a JS object, where key = sourceCharCode, value = outputCharCode
                    missing keys will be treated as: sourceCharCode === outputCharCode
                .noBOM
                    See comment higher above for explanation for why this is important
                .autoencode
                    See comment higher above for explanation for why this is important
                */

                var i, l, undef, sourceEncoding, encodingBlock, outputEncoding, newtext, isUnicode, ch, bch;

                if (flags === undef) {
                    flags = {};
                }

                sourceEncoding = flags.sourceEncoding ? sourceEncoding : 'Unicode';

                outputEncoding = flags.outputEncoding;

                // This 'encoding' section relies on font metrics format
                // attached to font objects by, among others,
                // "Willow Systems' standard_font_metrics plugin"
                // see jspdf.plugin.standard_font_metrics.js for format
                // of the font.metadata.encoding Object.
                // It should be something like
                //   .encoding = {'codePages':['WinANSI....'], 'WinANSI...':{code:code, ...}}
                //   .widths = {0:width, code:width, ..., 'fof':divisor}
                //   .kerning = {code:{previous_char_code:shift, ..., 'fof':-divisor},...}
                if ((flags.autoencode || outputEncoding) &&
                        fonts[activeFontKey].metadata &&
                        fonts[activeFontKey].metadata[sourceEncoding] &&
                        fonts[activeFontKey].metadata[sourceEncoding].encoding
                        ) {
                    encodingBlock = fonts[activeFontKey].metadata[sourceEncoding].encoding;

                    // each font has default encoding. Some have it clearly defined.
                    if (!outputEncoding && fonts[activeFontKey].encoding) {
                        outputEncoding = fonts[activeFontKey].encoding;
                    }

                    // Hmmm, the above did not work? Let's try again, in different place.
                    if (!outputEncoding && encodingBlock.codePages) {
                        outputEncoding = encodingBlock.codePages[0]; // let's say, first one is the default
                    }

                    if (typeof outputEncoding === 'string') {
                        outputEncoding = encodingBlock[outputEncoding];
                    }
                    // we want output encoding to be a JS Object, where
                    // key = sourceEncoding's character code and
                    // value = outputEncoding's character code.
                    if (outputEncoding) {
                        isUnicode = false;
                        newtext = [];
                        for (i = 0, l = text.length; i < l; i++) {
                            ch = outputEncoding[text.charCodeAt(i)];
                            if (ch) {
                                newtext.push(
                                    String.fromCharCode(ch)
                                );
                            } else {
                                newtext.push(
                                    text[i]
                                );
                            }

                            // since we are looping over chars anyway, might as well
                            // check for residual unicodeness
                            if (newtext[i].charCodeAt(0) >> 8) { /* more than 255 */
                                isUnicode = true;
                            }
                        }
                        text = newtext.join('');
                    }
                }

                i = text.length;
                // isUnicode may be set to false above. Hence the triple-equal to undefined
                while (isUnicode === undef && i !== 0) {
                    if (text.charCodeAt(i - 1) >> 8) { /* more than 255 */
                        isUnicode = true;
                    }
                    i--;
                }
                if (!isUnicode) {
                    return text;
                } else {
                    newtext = flags.noBOM ? [] : [254, 255];
                    for (i = 0, l = text.length; i < l; i++) {
                        ch = text.charCodeAt(i);
                        bch = ch >> 8; // divide by 256
                        if (bch >> 8) { /* something left after dividing by 256 second time */
                            throw new Error("Character at position " + i.toString(10) + " of string '" + text + "' exceeds 16bits. Cannot be encoded into UCS-2 BE");
                        }
                        newtext.push(bch);
                        newtext.push(ch - (bch << 8));
                    }
                    return String.fromCharCode.apply(undef, newtext);
                }
            },
            // Replace '/', '(', and ')' with pdf-safe versions
            pdfEscape = function (text, flags) {
                // doing to8bitStream does NOT make this PDF display unicode text. For that
                // we also need to reference a unicode font and embed it - royal pain in the rear.

                // There is still a benefit to to8bitStream - PDF simply cannot handle 16bit chars,
                // which JavaScript Strings are happy to provide. So, while we still cannot display
                // 2-byte characters property, at least CONDITIONALLY converting (entire string containing)
                // 16bit chars to (USC-2-BE) 2-bytes per char + BOM streams we ensure that entire PDF
                // is still parseable.
                // This will allow immediate support for unicode in document properties strings.
                return to8bitStream(text, flags).replace(/\\/g, '\\\\').replace(/\(/g, '\\(').replace(/\)/g, '\\)');
            },
            putInfo = function () {
                out('/Producer (jsPDF ' + version + ')');
                if (documentProperties.title) {
                    out('/Title (' + pdfEscape(documentProperties.title) + ')');
                }
                if (documentProperties.subject) {
                    out('/Subject (' + pdfEscape(documentProperties.subject) + ')');
                }
                if (documentProperties.author) {
                    out('/Author (' + pdfEscape(documentProperties.author) + ')');
                }
                if (documentProperties.keywords) {
                    out('/Keywords (' + pdfEscape(documentProperties.keywords) + ')');
                }
                if (documentProperties.creator) {
                    out('/Creator (' + pdfEscape(documentProperties.creator) + ')');
                }
                var created = new Date();
                out('/CreationDate (D:' +
                    [
                        created.getFullYear(),
                        padd2(created.getMonth() + 1),
                        padd2(created.getDate()),
                        padd2(created.getHours()),
                        padd2(created.getMinutes()),
                        padd2(created.getSeconds())
                    ].join('') +
                    ')'
                    );
            },
            putCatalog = function () {
                out('/Type /Catalog');
                out('/Pages 1 0 R');
                // @TODO: Add zoom and layout modes
                out('/OpenAction [3 0 R /FitH null]');
                out('/PageLayout /OneColumn');
                events.publish('putCatalog');
            },
            putTrailer = function () {
                out('/Size ' + (objectNumber + 1));
                out('/Root ' + objectNumber + ' 0 R');
                out('/Info ' + (objectNumber - 1) + ' 0 R');
            },
            beginPage = function () {
                page++;
                // Do dimension stuff
                outToPages = true;
                pages[page] = [];
            },
            _addPage = function () {
                beginPage();
                // Set line width
                out(f2(lineWidth * k) + ' w');
                // Set draw color
                out(drawColor);
                // resurrecting non-default line caps, joins
                if (lineCapID !== 0) {
                    out(lineCapID.toString(10) + ' J');
                }
                if (lineJoinID !== 0) {
                    out(lineJoinID.toString(10) + ' j');
                }
                events.publish('addPage', {'pageNumber': page});
            },
            /**
            Returns a document-specific font key - a label assigned to a
            font name + font type combination at the time the font was added
            to the font inventory.

            Font key is used as label for the desired font for a block of text
            to be added to the PDF document stream.
            @private
            @function
            @param fontName {String} can be undefined on "falthy" to indicate "use current"
            @param fontStyle {String} can be undefined on "falthy" to indicate "use current"
            @returns {String} Font key.
            */
            getFont = function (fontName, fontStyle) {
                var key, undef;

                if (fontName === undef) {
                    fontName = fonts[activeFontKey].fontName;
                }
                if (fontStyle === undef) {
                    fontStyle = fonts[activeFontKey].fontStyle;
                }

                try {
                    key = fontmap[fontName][fontStyle]; // returns a string like 'F3' - the KEY corresponding tot he font + type combination.
                } catch (e) {
                    key = undef;
                }
                if (!key) {
                    throw new Error("Unable to look up font label for font '" + fontName + "', '" + fontStyle + "'. Refer to getFontList() for available fonts.");
                }

                return key;
            },
            buildDocument = function () {

                outToPages = false; // switches out() to content
                content = [];
                offsets = [];

                // putHeader()
                out('%PDF-' + pdfVersion);

                putPages();

                putResources();

                // Info
                newObject();
                out('<<');
                putInfo();
                out('>>');
                out('endobj');

                // Catalog
                newObject();
                out('<<');
                putCatalog();
                out('>>');
                out('endobj');

                // Cross-ref
                var o = content_length, i;
                out('xref');
                out('0 ' + (objectNumber + 1));
                out('0000000000 65535 f ');
                for (i = 1; i <= objectNumber; i++) {
                    out(padd10(offsets[i]) + ' 00000 n ');
                }
                // Trailer
                out('trailer');
                out('<<');
                putTrailer();
                out('>>');
                out('startxref');
                out(o);
                out('%%EOF');

                outToPages = true;

                return content.join('\n');
            },
            getStyle = function (style) {
                // see Path-Painting Operators of PDF spec
                var op = 'S'; // stroke
                if (style === 'F') {
                    op = 'f'; // fill
                } else if (style === 'FD' || style === 'DF') {
                    op = 'B'; // both
                }
                return op;
            },

            /**
            Generates the PDF document.
            Possible values:
                datauristring (alias dataurlstring) - Data-Url-formatted data returned as string.
                datauri (alias datauri) - Data-Url-formatted data pushed into current window's location (effectively reloading the window with contents of the PDF).

            If `type` argument is undefined, output is raw body of resulting PDF returned as a string.

            @param {String} type A string identifying one of the possible output types.
            @param {Object} options An object providing some additional signalling to PDF generator.
            @function
            @returns {jsPDF}
            @methodOf jsPDF#
            @name output
            */
            output = function (type, options) {
                var undef, data, length, array, i, blob;
                switch (type) {
                case undef:
                    return buildDocument();
                case 'save':
                    if (navigator.getUserMedia) {
                        if (window.URL === undefined) {
                            return API.output('dataurlnewwindow');
                        } else if (window.URL.createObjectURL === undefined) {
                            return API.output('dataurlnewwindow');
                        }
                    }
                    data = buildDocument();

                    // Need to add the file to BlobBuilder as a Uint8Array
                    length = data.length;
                    array = new Uint8Array(new ArrayBuffer(length));

                    for (i = 0; i < length; i++) {
                        array[i] = data.charCodeAt(i);
                    }

                    blob = new Blob([array], {type: "application/pdf"});

                    saveAs(blob, options);
                    break;
                case 'datauristring':
                case 'dataurlstring':
                    return 'data:application/pdf;base64,' + btoa(buildDocument());
                case 'datauri':
                case 'dataurl':
                    document.location.href = 'data:application/pdf;base64,' + btoa(buildDocument());
                    break;
                case 'dataurlnewwindow':
                    window.open('data:application/pdf;base64,' + btoa(buildDocument()));
                    break;
                default:
                    throw new Error('Output type "' + type + '" is not supported.');
                }
                // @TODO: Add different output options
            };

        if (unit === 'pt') {
            k = 1;
        } else if (unit === 'mm') {
            k = 72 / 25.4;
        } else if (unit === 'cm') {
            k = 72 / 2.54;
        } else if (unit === 'in') {
            k = 72;
        } else {
            throw ('Invalid unit: ' + unit);
        }

        // Dimensions are stored as user units and converted to points on output
        if (pageFormats.hasOwnProperty(format_as_string)) {
            pageHeight = pageFormats[format_as_string][1] / k;
            pageWidth = pageFormats[format_as_string][0] / k;
        } else {
            try {
                pageHeight = format[1];
                pageWidth = format[0];
            } catch (err) {
                throw ('Invalid format: ' + format);
            }
        }

        if (orientation === 'p' || orientation === 'portrait') {
            orientation = 'p';
            if (pageWidth > pageHeight) {
                tmp = pageWidth;
                pageWidth = pageHeight;
                pageHeight = tmp;
            }
        } else if (orientation === 'l' || orientation === 'landscape') {
            orientation = 'l';
            if (pageHeight > pageWidth) {
                tmp = pageWidth;
                pageWidth = pageHeight;
                pageHeight = tmp;
            }
        } else {
            throw ('Invalid orientation: ' + orientation);
        }



        //---------------------------------------
        // Public API

        /*
        Object exposing internal API to plugins
        @public
        */
        API.internal = {
            'pdfEscape': pdfEscape,
            'getStyle': getStyle,
            /**
            Returns {FontObject} describing a particular font.
            @public
            @function
            @param fontName {String} (Optional) Font's family name
            @param fontStyle {String} (Optional) Font's style variation name (Example:"Italic")
            @returns {FontObject}
            */
            'getFont': function () { return fonts[getFont.apply(API, arguments)]; },
            'getFontSize': function () { return activeFontSize;    },
            'getLineHeight': function () { return activeFontSize * lineHeightProportion;    },
            'btoa': btoa,
            'write': function (string1, string2, string3, etc) {
                out(
                    arguments.length === 1 ? string1 : Array.prototype.join.call(arguments, ' ')
                );
            },
            'getCoordinateString': function (value) {
                return f2(value * k);
            },
            'getVerticalCoordinateString': function (value) {
                return f2((pageHeight - value) * k);
            },
            'collections': {},
            'newObject': newObject,
            'putStream': putStream,
            'events': events,
            // ratio that you use in multiplication of a given "size" number to arrive to 'point'
            // units of measurement.
            // scaleFactor is set at initialization of the document and calculated against the stated
            // default measurement units for the document.
            // If default is "mm", k is the number that will turn number in 'mm' into 'points' number.
            // through multiplication.
            'scaleFactor': k,
            'pageSize': {'width': pageWidth, 'height': pageHeight},
            'output': function (type, options) {
                return output(type, options);
            },
            'getNumberOfPages': function () {return pages.length - 1; },
            'pages': pages
        };

        /**
        Adds (and transfers the focus to) new page to the PDF document.
        @function
        @returns {jsPDF}

        @methodOf jsPDF#
        @name addPage
         */
        API.addPage = function () {
            _addPage();
            return this;
        };

        /**
        Adds text to page. Supports adding multiline text when 'text' argument is an Array of Strings.
        @function
        @param {String|Array} text String or array of strings to be added to the page. Each line is shifted one line down per font, spacing settings declared before this call.
        @param {Number} x Coordinate (in units declared at inception of PDF document) against left edge of the page
        @param {Number} y Coordinate (in units declared at inception of PDF document) against upper edge of the page
        @param {Object} flags Collection of settings signalling how the text must be encoded. Defaults are sane. If you think you want to pass some flags, you likely can read the source.
        @returns {jsPDF}
        @methodOf jsPDF#
        @name text
         */
        API.text = function (text, x, y, flags) {
            /**
             * Inserts something like this into PDF
                BT
                /F1 16 Tf  % Font name + size
                16 TL % How many units down for next line in multiline text
                0 g % color
                28.35 813.54 Td % position
                (line one) Tj
                T* (line two) Tj
                T* (line three) Tj
                ET
            */

            var undef, _first, _second, _third, newtext, str, i;
            // Pre-August-2012 the order of arguments was function(x, y, text, flags)
            // in effort to make all calls have similar signature like
            //   function(data, coordinates... , miscellaneous)
            // this method had its args flipped.
            // code below allows backward compatibility with old arg order.
            if (typeof text === 'number') {
                _first = y;
                _second = text;
                _third = x;

                text = _first;
                x = _second;
                y = _third;
            }

            // If there are any newlines in text, we assume
            // the user wanted to print multiple lines, so break the
            // text up into an array.  If the text is already an array,
            // we assume the user knows what they are doing.
            if (typeof text === 'string' && text.match(/[\n\r]/)) {
                text = text.split(/\r\n|\r|\n/g);
            }

            if (typeof flags === 'undefined') {
                flags = {'noBOM': true, 'autoencode': true};
            } else {

                if (flags.noBOM === undef) {
                    flags.noBOM = true;
                }

                if (flags.autoencode === undef) {
                    flags.autoencode = true;
                }

            }

            if (typeof text === 'string') {
                str = pdfEscape(text, flags);
            } else if (text instanceof Array) {  /* Array */
                // we don't want to destroy  original text array, so cloning it
                newtext = text.concat();
                // we do array.join('text that must not be PDFescaped")
                // thus, pdfEscape each component separately
                for (i = newtext.length - 1; i !== -1; i--) {
                    newtext[i] = pdfEscape(newtext[i], flags);
                }
                str = newtext.join(") Tj\nT* (");
            } else {
                throw new Error('Type of text must be string or Array. "' + text + '" is not recognized.');
            }
            // Using "'" ("go next line and render text" mark) would save space but would complicate our rendering code, templates

            // BT .. ET does NOT have default settings for Tf. You must state that explicitely every time for BT .. ET
            // if you want text transformation matrix (+ multiline) to work reliably (which reads sizes of things from font declarations)
            // Thus, there is NO useful, *reliable* concept of "default" font for a page.
            // The fact that "default" (reuse font used before) font worked before in basic cases is an accident
            // - readers dealing smartly with brokenness of jsPDF's markup.
            out(
                'BT\n/' +
                    activeFontKey + ' ' + activeFontSize + ' Tf\n' + // font face, style, size
                    (activeFontSize * lineHeightProportion) + ' TL\n' + // line spacing
                    textColor +
                    '\n' + f2(x * k) + ' ' + f2((pageHeight - y) * k) + ' Td\n(' +
                    str +
                    ') Tj\nET'
            );
            return this;
        };

        API.line = function (x1, y1, x2, y2) {
            out(
                f2(x1 * k) + ' ' + f2((pageHeight - y1) * k) + ' m ' +
                    f2(x2 * k) + ' ' + f2((pageHeight - y2) * k) + ' l S'
            );
            return this;
        };

        /**
        Adds series of curves (straight lines or cubic bezier curves) to canvas, starting at `x`, `y` coordinates.
        All data points in `lines` are relative to last line origin.
        `x`, `y` become x1,y1 for first line / curve in the set.
        For lines you only need to specify [x2, y2] - (ending point) vector against x1, y1 starting point.
        For bezier curves you need to specify [x2,y2,x3,y3,x4,y4] - vectors to control points 1, 2, ending point. All vectors are against the start of the curve - x1,y1.

        @example .lines([[2,2],[-2,2],[1,1,2,2,3,3],[2,1]], 212,110, 10) // line, line, bezier curve, line
        @param {Array} lines Array of *vector* shifts as pairs (lines) or sextets (cubic bezier curves).
        @param {Number} x Coordinate (in units declared at inception of PDF document) against left edge of the page
        @param {Number} y Coordinate (in units declared at inception of PDF document) against upper edge of the page
        @param {Number} scale (Defaults to [1.0,1.0]) x,y Scaling factor for all vectors. Elements can be any floating number Sub-one makes drawing smaller. Over-one grows the drawing. Negative flips the direction.
        @param {String} style One of 'S' (the default), 'F', 'FD' or 'DF'.  'S' draws just the curve. 'F' fills the region defined by the curves. 'DF' or 'FD' draws the curves and fills the region. 
        @param {Boolean} closed If true, the path is closed with a straight line from the end of the last curve to the starting point. 
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name lines
         */
        API.lines = function (lines, x, y, scale, style, closed) {
            var undef, _first, _second, _third, scalex, scaley, i, l, leg, x2, y2, x3, y3, x4, y4;

            // Pre-August-2012 the order of arguments was function(x, y, lines, scale, style)
            // in effort to make all calls have similar signature like
            //   function(content, coordinateX, coordinateY , miscellaneous)
            // this method had its args flipped.
            // code below allows backward compatibility with old arg order.
            if (typeof lines === 'number') {
                _first = y;
                _second = lines;
                _third = x;

                lines = _first;
                x = _second;
                y = _third;
            }

            style = getStyle(style);
            scale = scale === undef ? [1, 1] : scale;

            // starting point
            out(f3(x * k) + ' ' + f3((pageHeight - y) * k) + ' m ');

            scalex = scale[0];
            scaley = scale[1];
            l = lines.length;
            //, x2, y2 // bezier only. In page default measurement "units", *after* scaling
            //, x3, y3 // bezier only. In page default measurement "units", *after* scaling
            // ending point for all, lines and bezier. . In page default measurement "units", *after* scaling
            x4 = x; // last / ending point = starting point for first item.
            y4 = y; // last / ending point = starting point for first item.

            for (i = 0; i < l; i++) {
                leg = lines[i];
                if (leg.length === 2) {
                    // simple line
                    x4 = leg[0] * scalex + x4; // here last x4 was prior ending point
                    y4 = leg[1] * scaley + y4; // here last y4 was prior ending point
                    out(f3(x4 * k) + ' ' + f3((pageHeight - y4) * k) + ' l');
                } else {
                    // bezier curve
                    x2 = leg[0] * scalex + x4; // here last x4 is prior ending point
                    y2 = leg[1] * scaley + y4; // here last y4 is prior ending point
                    x3 = leg[2] * scalex + x4; // here last x4 is prior ending point
                    y3 = leg[3] * scaley + y4; // here last y4 is prior ending point
                    x4 = leg[4] * scalex + x4; // here last x4 was prior ending point
                    y4 = leg[5] * scaley + y4; // here last y4 was prior ending point
                    out(
                        f3(x2 * k) + ' ' +
                            f3((pageHeight - y2) * k) + ' ' +
                            f3(x3 * k) + ' ' +
                            f3((pageHeight - y3) * k) + ' ' +
                            f3(x4 * k) + ' ' +
                            f3((pageHeight - y4) * k) + ' c'
                    );
                }
            }

            if (closed == true) {
                out(' h');
            }

            // stroking / filling / both the path
            out(style);
            return this;
        };

        /**
        Adds a rectangle to PDF

        @param {Number} x Coordinate (in units declared at inception of PDF document) against left edge of the page
        @param {Number} y Coordinate (in units declared at inception of PDF document) against upper edge of the page
        @param {Number} w Width (in units declared at inception of PDF document)
        @param {Number} h Height (in units declared at inception of PDF document)
        @param {String} style (Defaults to active fill/stroke style) A string signalling if stroke, fill or both are to be applied.
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name rect
         */
        API.rect = function (x, y, w, h, style) {
            var op = getStyle(style);
            out([
                f2(x * k),
                f2((pageHeight - y) * k),
                f2(w * k),
                f2(-h * k),
                're',
                op
            ].join(' '));
            return this;
        };

        /**
        Adds a triangle to PDF

        @param {Number} x1 Coordinate (in units declared at inception of PDF document) against left edge of the page
        @param {Number} y1 Coordinate (in units declared at inception of PDF document) against upper edge of the page
        @param {Number} x2 Coordinate (in units declared at inception of PDF document) against left edge of the page
        @param {Number} y2 Coordinate (in units declared at inception of PDF document) against upper edge of the page
        @param {Number} x3 Coordinate (in units declared at inception of PDF document) against left edge of the page
        @param {Number} y3 Coordinate (in units declared at inception of PDF document) against upper edge of the page
        @param {String} style (Defaults to active fill/stroke style) A string signalling if stroke, fill or both are to be applied.
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name triangle
         */
        API.triangle = function (x1, y1, x2, y2, x3, y3, style) {
            this.lines(
                [
                    [ x2 - x1, y2 - y1 ], // vector to point 2
                    [ x3 - x2, y3 - y2 ], // vector to point 3
                    [ x1 - x3, y1 - y3 ] // closing vector back to point 1
                ],
                x1,
                y1, // start of path
                [1, 1],
                style,
                true
            );
            return this;
        };

        /**
        Adds a rectangle with rounded corners to PDF

        @param {Number} x Coordinate (in units declared at inception of PDF document) against left edge of the page
        @param {Number} y Coordinate (in units declared at inception of PDF document) against upper edge of the page
        @param {Number} w Width (in units declared at inception of PDF document)
        @param {Number} h Height (in units declared at inception of PDF document)
        @param {Number} rx Radius along x axis (in units declared at inception of PDF document)
        @param {Number} rx Radius along y axis (in units declared at inception of PDF document)
        @param {String} style (Defaults to active fill/stroke style) A string signalling if stroke, fill or both are to be applied.
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name roundedRect
        */
        API.roundedRect = function (x, y, w, h, rx, ry, style) {
            var MyArc = 4 / 3 * (Math.SQRT2 - 1);
            this.lines(
                [
                    [ (w - 2 * rx), 0 ],
                    [ (rx * MyArc), 0, rx, ry - (ry * MyArc), rx, ry ],
                    [ 0, (h - 2 * ry) ],
                    [ 0, (ry * MyArc), -(rx * MyArc), ry, -rx, ry],
                    [ (-w + 2 * rx), 0],
                    [ -(rx * MyArc), 0, -rx, -(ry * MyArc), -rx, -ry],
                    [ 0, (-h + 2 * ry)],
                    [ 0, -(ry * MyArc), (rx * MyArc), -ry, rx, -ry]
                ],
                x + rx,
                y, // start of path
                [1, 1],
                style
            );
            return this;
        };

        /**
        Adds an ellipse to PDF

        @param {Number} x Coordinate (in units declared at inception of PDF document) against left edge of the page
        @param {Number} y Coordinate (in units declared at inception of PDF document) against upper edge of the page
        @param {Number} rx Radius along x axis (in units declared at inception of PDF document)
        @param {Number} rx Radius along y axis (in units declared at inception of PDF document)
        @param {String} style (Defaults to active fill/stroke style) A string signalling if stroke, fill or both are to be applied.
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name ellipse
         */
        API.ellipse = function (x, y, rx, ry, style) {
            var op = getStyle(style),
                lx = 4 / 3 * (Math.SQRT2 - 1) * rx,
                ly = 4 / 3 * (Math.SQRT2 - 1) * ry;

            out([
                f2((x + rx) * k),
                f2((pageHeight - y) * k),
                'm',
                f2((x + rx) * k),
                f2((pageHeight - (y - ly)) * k),
                f2((x + lx) * k),
                f2((pageHeight - (y - ry)) * k),
                f2(x * k),
                f2((pageHeight - (y - ry)) * k),
                'c'
            ].join(' '));
            out([
                f2((x - lx) * k),
                f2((pageHeight - (y - ry)) * k),
                f2((x - rx) * k),
                f2((pageHeight - (y - ly)) * k),
                f2((x - rx) * k),
                f2((pageHeight - y) * k),
                'c'
            ].join(' '));
            out([
                f2((x - rx) * k),
                f2((pageHeight - (y + ly)) * k),
                f2((x - lx) * k),
                f2((pageHeight - (y + ry)) * k),
                f2(x * k),
                f2((pageHeight - (y + ry)) * k),
                'c'
            ].join(' '));
            out([
                f2((x + lx) * k),
                f2((pageHeight - (y + ry)) * k),
                f2((x + rx) * k),
                f2((pageHeight - (y + ly)) * k),
                f2((x + rx) * k),
                f2((pageHeight - y) * k),
                'c',
                op
            ].join(' '));
            return this;
        };

        /**
        Adds an circle to PDF

        @param {Number} x Coordinate (in units declared at inception of PDF document) against left edge of the page
        @param {Number} y Coordinate (in units declared at inception of PDF document) against upper edge of the page
        @param {Number} r Radius (in units declared at inception of PDF document)
        @param {String} style (Defaults to active fill/stroke style) A string signalling if stroke, fill or both are to be applied.
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name circle
         */
        API.circle = function (x, y, r, style) {
            return this.ellipse(x, y, r, r, style);
        };

        /**
        Adds a properties to the PDF document

        @param {Object} A property_name-to-property_value object structure.
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setProperties
         */
        API.setProperties = function (properties) {
            // copying only those properties we can render.
            var property;
            for (property in documentProperties) {
                if (documentProperties.hasOwnProperty(property) && properties[property]) {
                    documentProperties[property] = properties[property];
                }
            }
            return this;
        };

        /**
        Sets font size for upcoming text elements.

        @param {Number} size Font size in points.
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setFontSize
         */
        API.setFontSize = function (size) {
            activeFontSize = size;
            return this;
        };

        /**
        Sets text font face, variant for upcoming text elements.
        See output of jsPDF.getFontList() for possible font names, styles.

        @param {String} fontName Font name or family. Example: "times"
        @param {String} fontStyle Font style or variant. Example: "italic"
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setFont
         */
        API.setFont = function (fontName, fontStyle) {
            activeFontKey = getFont(fontName, fontStyle);
            // if font is not found, the above line blows up and we never go further
            return this;
        };

        /**
        Switches font style or variant for upcoming text elements,
        while keeping the font face or family same.
        See output of jsPDF.getFontList() for possible font names, styles.

        @param {String} style Font style or variant. Example: "italic"
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setFontStyle
         */
        API.setFontStyle = API.setFontType = function (style) {
            var undef;
            activeFontKey = getFont(undef, style);
            // if font is not found, the above line blows up and we never go further
            return this;
        };

        /**
        Returns an object - a tree of fontName to fontStyle relationships available to
        active PDF document.

        @public
        @function
        @returns {Object} Like {'times':['normal', 'italic', ... ], 'arial':['normal', 'bold', ... ], ... }
        @methodOf jsPDF#
        @name getFontList
        */
        API.getFontList = function () {
            // TODO: iterate over fonts array or return copy of fontmap instead in case more are ever added.
            var list = {},
                fontName,
                fontStyle,
                tmp;

            for (fontName in fontmap) {
                if (fontmap.hasOwnProperty(fontName)) {
                    list[fontName] = tmp = [];
                    for (fontStyle in fontmap[fontName]) {
                        if (fontmap[fontName].hasOwnProperty(fontStyle)) {
                            tmp.push(fontStyle);
                        }
                    }
                }
            }

            return list;
        };

        /**
        Sets line width for upcoming lines.

        @param {Number} width Line width (in units declared at inception of PDF document)
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setLineWidth
         */
        API.setLineWidth = function (width) {
            out((width * k).toFixed(2) + ' w');
            return this;
        };

        /**
        Sets the stroke color for upcoming elements.

        Depending on the number of arguments given, Gray, RGB, or CMYK
        color space is implied.

        When only ch1 is given, "Gray" color space is implied and it
        must be a value in the range from 0.00 (solid black) to to 1.00 (white)
        if values are communicated as String types, or in range from 0 (black)
        to 255 (white) if communicated as Number type.
        The RGB-like 0-255 range is provided for backward compatibility.

        When only ch1,ch2,ch3 are given, "RGB" color space is implied and each
        value must be in the range from 0.00 (minimum intensity) to to 1.00
        (max intensity) if values are communicated as String types, or
        from 0 (min intensity) to to 255 (max intensity) if values are communicated
        as Number types.
        The RGB-like 0-255 range is provided for backward compatibility.

        When ch1,ch2,ch3,ch4 are given, "CMYK" color space is implied and each
        value must be a in the range from 0.00 (0% concentration) to to
        1.00 (100% concentration)

        Because JavaScript treats fixed point numbers badly (rounds to
        floating point nearest to binary representation) it is highly advised to
        communicate the fractional numbers as String types, not JavaScript Number type.

        @param {Number|String} ch1 Color channel value
        @param {Number|String} ch2 Color channel value
        @param {Number|String} ch3 Color channel value
        @param {Number|String} ch4 Color channel value

        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setDrawColor
         */
        API.setDrawColor = function (ch1, ch2, ch3, ch4) {
            var color;
            if (ch2 === undefined || (ch4 === undefined && ch1 === ch2 === ch3)) {
                // Gray color space.
                if (typeof ch1 === 'string') {
                    color = ch1 + ' G';
                } else {
                    color = f2(ch1 / 255) + ' G';
                }
            } else if (ch4 === undefined) {
                // RGB
                if (typeof ch1 === 'string') {
                    color = [ch1, ch2, ch3, 'RG'].join(' ');
                } else {
                    color = [f2(ch1 / 255), f2(ch2 / 255), f2(ch3 / 255), 'RG'].join(' ');
                }
            } else {
                // CMYK
                if (typeof ch1 === 'string') {
                    color = [ch1, ch2, ch3, ch4, 'K'].join(' ');
                } else {
                    color = [f2(ch1), f2(ch2), f2(ch3), f2(ch4), 'K'].join(' ');
                }
            }

            out(color);
            return this;
        };

        /**
        Sets the fill color for upcoming elements.

        Depending on the number of arguments given, Gray, RGB, or CMYK
        color space is implied.

        When only ch1 is given, "Gray" color space is implied and it
        must be a value in the range from 0.00 (solid black) to to 1.00 (white)
        if values are communicated as String types, or in range from 0 (black)
        to 255 (white) if communicated as Number type.
        The RGB-like 0-255 range is provided for backward compatibility.

        When only ch1,ch2,ch3 are given, "RGB" color space is implied and each
        value must be in the range from 0.00 (minimum intensity) to to 1.00
        (max intensity) if values are communicated as String types, or
        from 0 (min intensity) to to 255 (max intensity) if values are communicated
        as Number types.
        The RGB-like 0-255 range is provided for backward compatibility.

        When ch1,ch2,ch3,ch4 are given, "CMYK" color space is implied and each
        value must be a in the range from 0.00 (0% concentration) to to
        1.00 (100% concentration)

        Because JavaScript treats fixed point numbers badly (rounds to
        floating point nearest to binary representation) it is highly advised to
        communicate the fractional numbers as String types, not JavaScript Number type.

        @param {Number|String} ch1 Color channel value
        @param {Number|String} ch2 Color channel value
        @param {Number|String} ch3 Color channel value
        @param {Number|String} ch4 Color channel value

        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setFillColor
         */
        API.setFillColor = function (ch1, ch2, ch3, ch4) {
            var color;

            if (ch2 === undefined || (ch4 === undefined && ch1 === ch2 === ch3)) {
                // Gray color space.
                if (typeof ch1 === 'string') {
                    color = ch1 + ' g';
                } else {
                    color = f2(ch1 / 255) + ' g';
                }
            } else if (ch4 === undefined) {
                // RGB
                if (typeof ch1 === 'string') {
                    color = [ch1, ch2, ch3, 'rg'].join(' ');
                } else {
                    color = [f2(ch1 / 255), f2(ch2 / 255), f2(ch3 / 255), 'rg'].join(' ');
                }
            } else {
                // CMYK
                if (typeof ch1 === 'string') {
                    color = [ch1, ch2, ch3, ch4, 'k'].join(' ');
                } else {
                    color = [f2(ch1), f2(ch2), f2(ch3), f2(ch4), 'k'].join(' ');
                }
            }

            out(color);
            return this;
        };

        /**
        Sets the text color for upcoming elements.
        If only one, first argument is given,
        treats the value as gray-scale color value.

        @param {Number} r Red channel color value in range 0-255 or {String} r color value in hexadecimal, example: '#FFFFFF'
        @param {Number} g Green channel color value in range 0-255
        @param {Number} b Blue channel color value in range 0-255
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setTextColor
        */
        API.setTextColor = function (r, g, b) {
            var patt = /#[0-9A-Fa-f]{6}/;
            if ((typeof r == 'string') && patt.test(r)) {
                var hex = r.replace('#','');
                var bigint = parseInt(hex, 16);
                r = (bigint >> 16) & 255;
                g = (bigint >> 8) & 255;
                b = bigint & 255;
            }

            if ((r === 0 && g === 0 && b === 0) || (typeof g === 'undefined')) {
                textColor = f3(r / 255) + ' g';
            } else {
                textColor = [f3(r / 255), f3(g / 255), f3(b / 255), 'rg'].join(' ');
            }
            return this;
        };

        /**
        Is an Object providing a mapping from human-readable to
        integer flag values designating the varieties of line cap
        and join styles.

        @returns {Object}
        @fieldOf jsPDF#
        @name CapJoinStyles
        */
        API.CapJoinStyles = {
            0: 0,
            'butt': 0,
            'but': 0,
            'miter': 0,
            1: 1,
            'round': 1,
            'rounded': 1,
            'circle': 1,
            2: 2,
            'projecting': 2,
            'project': 2,
            'square': 2,
            'bevel': 2
        };

        /**
        Sets the line cap styles
        See {jsPDF.CapJoinStyles} for variants

        @param {String|Number} style A string or number identifying the type of line cap
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setLineCap
        */
        API.setLineCap = function (style) {
            var id = this.CapJoinStyles[style];
            if (id === undefined) {
                throw new Error("Line cap style of '" + style + "' is not recognized. See or extend .CapJoinStyles property for valid styles");
            }
            lineCapID = id;
            out(id.toString(10) + ' J');

            return this;
        };

        /**
        Sets the line join styles
        See {jsPDF.CapJoinStyles} for variants

        @param {String|Number} style A string or number identifying the type of line join
        @function
        @returns {jsPDF}
        @methodOf jsPDF#
        @name setLineJoin
        */
        API.setLineJoin = function (style) {
            var id = this.CapJoinStyles[style];
            if (id === undefined) {
                throw new Error("Line join style of '" + style + "' is not recognized. See or extend .CapJoinStyles property for valid styles");
            }
            lineJoinID = id;
            out(id.toString(10) + ' j');

            return this;
        };

        // Output is both an internal (for plugins) and external function
        API.output = output;

        /**
         * Saves as PDF document. An alias of jsPDF.output('save', 'filename.pdf')
         * @param  {String} filename The filename including extension.
         *
         * @function
         * @returns {jsPDF}
         * @methodOf jsPDF#
         * @name save
         */
        API.save = function (filename) {
            API.output('save', filename);
        };

        // applying plugins (more methods) ON TOP of built-in API.
        // this is intentional as we allow plugins to override
        // built-ins
        for (plugin in jsPDF.API) {
            if (jsPDF.API.hasOwnProperty(plugin)) {
                if (plugin === 'events' && jsPDF.API.events.length) {
                    (function (events, newEvents) {

                        // jsPDF.API.events is a JS Array of Arrays
                        // where each Array is a pair of event name, handler
                        // Events were added by plugins to the jsPDF instantiator.
                        // These are always added to the new instance and some ran
                        // during instantiation.

                        var eventname, handler_and_args, i;

                        for (i = newEvents.length - 1; i !== -1; i--) {
                            // subscribe takes 3 args: 'topic', function, runonce_flag
                            // if undefined, runonce is false.
                            // users can attach callback directly,
                            // or they can attach an array with [callback, runonce_flag]
                            // that's what the "apply" magic is for below.
                            eventname = newEvents[i][0];
                            handler_and_args = newEvents[i][1];
                            events.subscribe.apply(
                                events,
                                [eventname].concat(
                                    typeof handler_and_args === 'function' ?
                                            [ handler_and_args ] :
                                            handler_and_args
                                )
                            );
                        }
                    }(events, jsPDF.API.events));
                } else {
                    API[plugin] = jsPDF.API[plugin];
                }
            }
        }

        /////////////////////////////////////////
        // continuing initilisation of jsPDF Document object
        /////////////////////////////////////////


        // Add the first page automatically
        addFonts();
        activeFontKey = 'F1';
        _addPage();

        events.publish('initialized');

        return API;
    }

/**
jsPDF.API is a STATIC property of jsPDF class.
jsPDF.API is an object you can add methods and properties to.
The methods / properties you add will show up in new jsPDF objects.

One property is prepopulated. It is the 'events' Object. Plugin authors can add topics, callbacks to this object. These will be reassigned to all new instances of jsPDF.
Examples:
    jsPDF.API.events['initialized'] = function(){ 'this' is API object }
    jsPDF.API.events['addFont'] = function(added_font_object){ 'this' is API object }

@static
@public
@memberOf jsPDF
@name API

@example
    jsPDF.API.mymethod = function(){
        // 'this' will be ref to internal API object. see jsPDF source
        // , so you can refer to built-in methods like so:
        //     this.line(....)
        //     this.text(....)
    }
    var pdfdoc = new jsPDF()
    pdfdoc.mymethod() // <- !!!!!!
*/
    jsPDF.API = {'events': []};

    return jsPDF;
}());
/** @preserve 
jsPDF addImage plugin (JPEG only at this time)
Copyright (c) 2012 https://github.com/siefkenj/
*/

/**
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 * 
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */

;(function(jsPDFAPI) {
'use strict'

var namespace = 'addImage_'

// takes a string imgData containing the raw bytes of
// a jpeg image and returns [width, height]
// Algorithm from: http://www.64lines.com/jpeg-width-height
var getJpegSize = function(imgData) {
	'use strict'
	var width, height;
	// Verify we have a valid jpeg header 0xff,0xd8,0xff,0xe0,?,?,'J','F','I','F',0x00
	if (!imgData.charCodeAt(0) === 0xff ||
		!imgData.charCodeAt(1) === 0xd8 ||
		!imgData.charCodeAt(2) === 0xff ||
		!imgData.charCodeAt(3) === 0xe0 ||
		!imgData.charCodeAt(6) === 'J'.charCodeAt(0) ||
		!imgData.charCodeAt(7) === 'F'.charCodeAt(0) ||
		!imgData.charCodeAt(8) === 'I'.charCodeAt(0) ||
		!imgData.charCodeAt(9) === 'F'.charCodeAt(0) ||
		!imgData.charCodeAt(10) === 0x00) {
			throw new Error('getJpegSize requires a binary jpeg file')
	}
	var blockLength = imgData.charCodeAt(4)*256 + imgData.charCodeAt(5);
	var i = 4, len = imgData.length;
	while ( i < len ) {
		i += blockLength;
		if (imgData.charCodeAt(i) !== 0xff) {
			throw new Error('getJpegSize could not find the size of the image');
		}
		if (imgData.charCodeAt(i+1) === 0xc0 || //(SOF) Huffman  - Baseline DCT
		    imgData.charCodeAt(i+1) === 0xc1 || //(SOF) Huffman  - Extended sequential DCT 
		    imgData.charCodeAt(i+1) === 0xc2 || // Progressive DCT (SOF2)
		    imgData.charCodeAt(i+1) === 0xc3 || // Spatial (sequential) lossless (SOF3)
		    imgData.charCodeAt(i+1) === 0xc4 || // Differential sequential DCT (SOF5)
		    imgData.charCodeAt(i+1) === 0xc5 || // Differential progressive DCT (SOF6)
		    imgData.charCodeAt(i+1) === 0xc6 || // Differential spatial (SOF7)
		    imgData.charCodeAt(i+1) === 0xc7) {
			height = imgData.charCodeAt(i+5)*256 + imgData.charCodeAt(i+6);
			width = imgData.charCodeAt(i+7)*256 + imgData.charCodeAt(i+8);
			return [width, height];
		} else {
			i += 2;
			blockLength = imgData.charCodeAt(i)*256 + imgData.charCodeAt(i+1)
		}
	}
}
// Image functionality ported from pdf.js
, putImage = function(img) {
	var objectNumber = this.internal.newObject()
	, out = this.internal.write
	, putStream = this.internal.putStream

	img['n'] = objectNumber

	out('<</Type /XObject')
	out('/Subtype /Image')
	out('/Width ' + img['w'])
	out('/Height ' + img['h'])
	if (img['cs'] === 'Indexed') {
		out('/ColorSpace [/Indexed /DeviceRGB '
				+ (img['pal'].length / 3 - 1) + ' ' + (objectNumber + 1)
				+ ' 0 R]');
	} else {
		out('/ColorSpace /' + img['cs']);
		if (img['cs'] === 'DeviceCMYK') {
			out('/Decode [1 0 1 0 1 0 1 0]');
		}
	}
	out('/BitsPerComponent ' + img['bpc']);
	if ('f' in img) {
		out('/Filter /' + img['f']);
	}
	if ('dp' in img) {
		out('/DecodeParms <<' + img['dp'] + '>>');
	}
	if ('trns' in img && img['trns'].constructor == Array) {
		var trns = '';
		for ( var i = 0; i < img['trns'].length; i++) {
			trns += (img[trns][i] + ' ' + img['trns'][i] + ' ');
			out('/Mask [' + trns + ']');
		}
	}
	if ('smask' in img) {
		out('/SMask ' + (objectNumber + 1) + ' 0 R');
	}
	out('/Length ' + img['data'].length + '>>');

	putStream(img['data']);

	out('endobj');
}
, putResourcesCallback = function() {
	var images = this.internal.collections[namespace + 'images']
	for ( var i in images ) {
		putImage.call(this, images[i])
	}
}
, putXObjectsDictCallback = function(){
	var images = this.internal.collections[namespace + 'images']
	, out = this.internal.write
	, image
	for (var i in images) {
		image = images[i]
		out(
			'/I' + image['i']
			, image['n']
			, '0'
			, 'R'
		)
	}
}

jsPDFAPI.addImage = function(imageData, format, x, y, w, h) {
	'use strict'
	if (typeof imageData === 'object' && imageData.nodeType === 1) {
        var canvas = document.createElement('canvas');
        canvas.width = imageData.clientWidth;
	    canvas.height = imageData.clientHeight;

        var ctx = canvas.getContext('2d');
        if (!ctx) {
            throw ('addImage requires canvas to be supported by browser.');
        }
        ctx.drawImage(imageData, 0, 0, canvas.width, canvas.height);
        imageData = canvas.toDataURL('image/jpeg');
	    format = "JPEG";
	}
	if (format.toUpperCase() !== 'JPEG') {
		throw new Error('addImage currently only supports format \'JPEG\', not \''+format+'\'');
	}

	var imageIndex
	, images = this.internal.collections[namespace + 'images']
	, coord = this.internal.getCoordinateString
	, vcoord = this.internal.getVerticalCoordinateString;

	// Detect if the imageData is raw binary or Data URL
	if (imageData.substring(0, 23) === 'data:image/jpeg;base64,') {
		imageData = atob(imageData.replace('data:image/jpeg;base64,', ''));
	}

	if (images){
		// this is NOT the first time this method is ran on this instance of jsPDF object.
		imageIndex = Object.keys ? 
		Object.keys(images).length :
		(function(o){
			var i = 0
			for (var e in o){if(o.hasOwnProperty(e)){ i++ }}
			return i
		})(images)
	} else {
		// this is the first time this method is ran on this instance of jsPDF object.
		imageIndex = 0
		this.internal.collections[namespace + 'images'] = images = {}
		this.internal.events.subscribe('putResources', putResourcesCallback)
		this.internal.events.subscribe('putXobjectDict', putXObjectsDictCallback)
	}

	var dims = getJpegSize(imageData);
	var info = {
		w : dims[0],
		h : dims[1],
		cs : 'DeviceRGB',
		bpc : 8,
		f : 'DCTDecode',
		i : imageIndex,
		data : imageData
		// n: objectNumber will be added by putImage code

	};
	images[imageIndex] = info
	if (!w && !h) {
		w = -96;
		h = -96;
	}
	if (w < 0) {
		w = (-1) * info['w'] * 72 / w / this.internal.scaleFactor;
	}
	if (h < 0) {
		h = (-1) * info['h'] * 72 / h / this.internal.scaleFactor;
	}
	if (w === 0) {
		w = h * info['w'] / info['h'];
	}
	if (h === 0) {
		h = w * info['h'] / info['w'];
	}

	this.internal.write(
		'q'
		, coord(w)
		, '0 0'
		, coord(h) // TODO: check if this should be shifted by vcoord
		, coord(x)
		, vcoord(y + h)
		, 'cm /I'+info['i']
		, 'Do Q'
	)

	return this 
}
})(jsPDF.API)
/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */
function RGBColor(color_string)
{
    this.ok = false;

    // strip any leading #
    if (color_string.charAt(0) == '#') { // remove # if any
        color_string = color_string.substr(1,6);
    }

    color_string = color_string.replace(/ /g,'');
    color_string = color_string.toLowerCase();

    // before getting into regexps, try simple matches
    // and overwrite the input
    var simple_colors = {
        aliceblue: 'f0f8ff',
        antiquewhite: 'faebd7',
        aqua: '00ffff',
        aquamarine: '7fffd4',
        azure: 'f0ffff',
        beige: 'f5f5dc',
        bisque: 'ffe4c4',
        black: '000000',
        blanchedalmond: 'ffebcd',
        blue: '0000ff',
        blueviolet: '8a2be2',
        brown: 'a52a2a',
        burlywood: 'deb887',
        cadetblue: '5f9ea0',
        chartreuse: '7fff00',
        chocolate: 'd2691e',
        coral: 'ff7f50',
        cornflowerblue: '6495ed',
        cornsilk: 'fff8dc',
        crimson: 'dc143c',
        cyan: '00ffff',
        darkblue: '00008b',
        darkcyan: '008b8b',
        darkgoldenrod: 'b8860b',
        darkgray: 'a9a9a9',
        darkgreen: '006400',
        darkkhaki: 'bdb76b',
        darkmagenta: '8b008b',
        darkolivegreen: '556b2f',
        darkorange: 'ff8c00',
        darkorchid: '9932cc',
        darkred: '8b0000',
        darksalmon: 'e9967a',
        darkseagreen: '8fbc8f',
        darkslateblue: '483d8b',
        darkslategray: '2f4f4f',
        darkturquoise: '00ced1',
        darkviolet: '9400d3',
        deeppink: 'ff1493',
        deepskyblue: '00bfff',
        dimgray: '696969',
        dodgerblue: '1e90ff',
        feldspar: 'd19275',
        firebrick: 'b22222',
        floralwhite: 'fffaf0',
        forestgreen: '228b22',
        fuchsia: 'ff00ff',
        gainsboro: 'dcdcdc',
        ghostwhite: 'f8f8ff',
        gold: 'ffd700',
        goldenrod: 'daa520',
        gray: '808080',
        green: '008000',
        greenyellow: 'adff2f',
        honeydew: 'f0fff0',
        hotpink: 'ff69b4',
        indianred : 'cd5c5c',
        indigo : '4b0082',
        ivory: 'fffff0',
        khaki: 'f0e68c',
        lavender: 'e6e6fa',
        lavenderblush: 'fff0f5',
        lawngreen: '7cfc00',
        lemonchiffon: 'fffacd',
        lightblue: 'add8e6',
        lightcoral: 'f08080',
        lightcyan: 'e0ffff',
        lightgoldenrodyellow: 'fafad2',
        lightgrey: 'd3d3d3',
        lightgreen: '90ee90',
        lightpink: 'ffb6c1',
        lightsalmon: 'ffa07a',
        lightseagreen: '20b2aa',
        lightskyblue: '87cefa',
        lightslateblue: '8470ff',
        lightslategray: '778899',
        lightsteelblue: 'b0c4de',
        lightyellow: 'ffffe0',
        lime: '00ff00',
        limegreen: '32cd32',
        linen: 'faf0e6',
        magenta: 'ff00ff',
        maroon: '800000',
        mediumaquamarine: '66cdaa',
        mediumblue: '0000cd',
        mediumorchid: 'ba55d3',
        mediumpurple: '9370d8',
        mediumseagreen: '3cb371',
        mediumslateblue: '7b68ee',
        mediumspringgreen: '00fa9a',
        mediumturquoise: '48d1cc',
        mediumvioletred: 'c71585',
        midnightblue: '191970',
        mintcream: 'f5fffa',
        mistyrose: 'ffe4e1',
        moccasin: 'ffe4b5',
        navajowhite: 'ffdead',
        navy: '000080',
        oldlace: 'fdf5e6',
        olive: '808000',
        olivedrab: '6b8e23',
        orange: 'ffa500',
        orangered: 'ff4500',
        orchid: 'da70d6',
        palegoldenrod: 'eee8aa',
        palegreen: '98fb98',
        paleturquoise: 'afeeee',
        palevioletred: 'd87093',
        papayawhip: 'ffefd5',
        peachpuff: 'ffdab9',
        peru: 'cd853f',
        pink: 'ffc0cb',
        plum: 'dda0dd',
        powderblue: 'b0e0e6',
        purple: '800080',
        red: 'ff0000',
        rosybrown: 'bc8f8f',
        royalblue: '4169e1',
        saddlebrown: '8b4513',
        salmon: 'fa8072',
        sandybrown: 'f4a460',
        seagreen: '2e8b57',
        seashell: 'fff5ee',
        sienna: 'a0522d',
        silver: 'c0c0c0',
        skyblue: '87ceeb',
        slateblue: '6a5acd',
        slategray: '708090',
        snow: 'fffafa',
        springgreen: '00ff7f',
        steelblue: '4682b4',
        tan: 'd2b48c',
        teal: '008080',
        thistle: 'd8bfd8',
        tomato: 'ff6347',
        turquoise: '40e0d0',
        violet: 'ee82ee',
        violetred: 'd02090',
        wheat: 'f5deb3',
        white: 'ffffff',
        whitesmoke: 'f5f5f5',
        yellow: 'ffff00',
        yellowgreen: '9acd32'
    };
    for (var key in simple_colors) {
        if (color_string == key) {
            color_string = simple_colors[key];
        }
    }
    // emd of simple type-in colors

    // array of color definition objects
    var color_defs = [
        {
            re: /^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,
            example: ['rgb(123, 234, 45)', 'rgb(255,234,245)'],
            process: function (bits){
                return [
                    parseInt(bits[1]),
                    parseInt(bits[2]),
                    parseInt(bits[3])
                ];
            }
        },
        {
            re: /^(\w{2})(\w{2})(\w{2})$/,
            example: ['#00ff00', '336699'],
            process: function (bits){
                return [
                    parseInt(bits[1], 16),
                    parseInt(bits[2], 16),
                    parseInt(bits[3], 16)
                ];
            }
        },
        {
            re: /^(\w{1})(\w{1})(\w{1})$/,
            example: ['#fb0', 'f0f'],
            process: function (bits){
                return [
                    parseInt(bits[1] + bits[1], 16),
                    parseInt(bits[2] + bits[2], 16),
                    parseInt(bits[3] + bits[3], 16)
                ];
            }
        }
    ];

    // search through the definitions to find a match
    for (var i = 0; i < color_defs.length; i++) {
        var re = color_defs[i].re;
        var processor = color_defs[i].process;
        var bits = re.exec(color_string);
        if (bits) {
            channels = processor(bits);
            this.r = channels[0];
            this.g = channels[1];
            this.b = channels[2];
            this.ok = true;
        }

    }

    // validate/cleanup values
    this.r = (this.r < 0 || isNaN(this.r)) ? 0 : ((this.r > 255) ? 255 : this.r);
    this.g = (this.g < 0 || isNaN(this.g)) ? 0 : ((this.g > 255) ? 255 : this.g);
    this.b = (this.b < 0 || isNaN(this.b)) ? 0 : ((this.b > 255) ? 255 : this.b);

    // some getters
    this.toRGB = function () {
        return 'rgb(' + this.r + ', ' + this.g + ', ' + this.b + ')';
    }
    this.toHex = function () {
        var r = this.r.toString(16);
        var g = this.g.toString(16);
        var b = this.b.toString(16);
        if (r.length == 1) r = '0' + r;
        if (g.length == 1) g = '0' + g;
        if (b.length == 1) b = '0' + b;
        return '#' + r + g + b;
    }

    // help
    this.getHelpXML = function () {

        var examples = new Array();
        // add regexps
        for (var i = 0; i < color_defs.length; i++) {
            var example = color_defs[i].example;
            for (var j = 0; j < example.length; j++) {
                examples[examples.length] = example[j];
            }
        }
        // add type-in colors
        for (var sc in simple_colors) {
            examples[examples.length] = sc;
        }

        var xml = document.createElement('ul');
        xml.setAttribute('id', 'rgbcolor-examples');
        for (var i = 0; i < examples.length; i++) {
            try {
                var list_item = document.createElement('li');
                var list_color = new RGBColor(examples[i]);
                var example_div = document.createElement('div');
                example_div.style.cssText =
                        'margin: 3px; '
                        + 'border: 1px solid black; '
                        + 'background:' + list_color.toHex() + '; '
                        + 'color:' + list_color.toHex()
                ;
                example_div.appendChild(document.createTextNode('test'));
                var list_item_value = document.createTextNode(
                    ' ' + examples[i] + ' -> ' + list_color.toRGB() + ' -> ' + list_color.toHex()
                );
                list_item.appendChild(example_div);
                list_item.appendChild(list_item_value);
                xml.appendChild(list_item);

            } catch(e){}
        }
        return xml;

    }

}


AmCharts.translations.az = {"monthNames":["Yanvar","Fevral","Mart","Aprel","May","Iyun","Iyul","Avqust","Sentyabr","Oktyabr","Noyabr","Dekabr"],"shortMonthNames":["Yan","Fev","Mar","Apr","May","Iyn","Iyl","Avq","Sen","Okt","Noy","Dek"],"dayNames":["Bazar ertəsi","Çərşənbə axşamı","Çərşənbə","Cümə axşamı","Cümə","Şənbə","Bazar günü"],"shortDayNames":["Ber","Çax","Çər","Cax","Cüm","Şnb","Baz"],"zoomOutText":"Bütün göstər"}
AmCharts.translations.bg = {"monthNames":["Януари","Февруари","Март","Април","Май","Юни","Юли","Август","Септември","Октомври","Ноември","Декември"],"shortMonthNames":["Яну","Фев","Мар","Апр","Май","Юни","Юли","Авг","Сеп","Окт","Ное","Дек"],"dayNames":["Понеделник","Вторник","Сряда","Четвъртък","Петък","Събота","Неделя"],"shortDayNames":["Пн","Вт","Ср","Чт","Пт","Сб","Нд"],"zoomOutText":"Покажи всички"}
AmCharts.translations.de = {
	"monthNames": ["Januar", "Februar", "März", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"],
	"shortMonthNames": ["Jan", "Feb", "Mär", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez"],
	"dayNames": ["Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"],
	"shortDayNames": ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"],
	"zoomOutText": "Alle anzeigen",
	"fromText": "Von:",
	"toText":"Bis:",
	"periodsText":"Ansicht:",
	"selectText":"Auswahl:",
	"comboBoxSelectText":"Auswahl...",
	"compareText":"Vergleichen mit:"
}
AmCharts.translations.es = {"monthNames":["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],"shortMonthNames":["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],"dayNames":["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"],"shortDayNames":["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"],"zoomOutText":"Mostrar todos"}
AmCharts.translations.fi = {"monthNames":["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],"shortMonthNames":["Tammi ","Helmi ","Maalis","Huhti ","Touko ","Kesä  ","Heinä ","Elo   ","Syys  ","Loka  ","Marras","Joulu "],"dayNames":["Maanantai","Tiistai","Keskiviikko","Torstai","Perjantai","Lauantai","Sunnuntai"],"shortDayNames":["Ma","Ti","Ke","To","Pe","La","Su"],"zoomOutText":"Näytä kaikki"}
AmCharts.translations.fo = {"monthNames":["Januar","Februar","Mars","Apríl","Mai","Juni","Juli","August","September","Oktober","November","Desember"],"shortMonthNames":["Jan","Feb","Mar","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Des"],"dayNames":["Mánadagur","Týsdagur","Mikudagur","Hósdagur","Fríggjadagur","Leygardagur","Sunnudagur"],"shortDayNames":["Mán","Týs","Mik","Hós","Frí","Ley","Sun"],"zoomOutText":"Show all"}
AmCharts.translations.fr = {"monthNames":["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],"shortMonthNames":["Janv.","Févr.","Mars","Avril","Mai","Juin","Juil.","Août","Sept.","Oct.","Nov.","Déc."],"dayNames":["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],"shortDayNames":["Lun.","Mar.","Mer.","Jeu.","Ven.","Sam.","Dim."],"zoomOutText":"Voir tous"}
AmCharts.translations.hr = {"monthNames":["Siječanj","Veljača","Ožujak","Travanj","Svibanj","Lipanj","Srpanj","Kolovoz","Rujan","Listopad","Studeni","Prosinac"],"shortMonthNames":["Sij","Vel","Ožu","Tra","Svi","Lip","Srp","Kol","Ruj","Lis","Stu","Pro"],"dayNames":["Ponedjeljak","Utorak","Srijeda","Četvrtak","Petak","Subota","Nedjelja"],"shortDayNames":["Pon","Uto","Sri","Čet","Pet","Sub","Ned"],"zoomOutText":"Prikaži sve"}
AmCharts.translations.hu = {"monthNames":["Január","Február","Március","Április","Május","Június","Július","Augusztus","Szeptember","Október","November","December"],"shortMonthNames":["Jan","Febr","Márc","Ápr","Máj","Jún","Júl","Aug","Szept","Okt","Nov","Dec"],"dayNames":["Hétfő","Kedd","Szerda","Csütörtök","Péntek","Szombat","Vasárnap"],"shortDayNames":["H","K","Sze","Cs","P","Szo","V"],"zoomOutText":"Összes"}
AmCharts.translations.id = {"monthNames":["Januari","Pebruari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],"shortMonthNames":["Jan","Peb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"],"dayNames":["Senin","Selasa","Rabu","Kamis","Jumat","Sabtu","Minggu"],"shortDayNames":["Sen","Sel","Rab","Kam","Jum","Sab","Min"],"zoomOutText":"Tampilkan semua"}
AmCharts.translations.is = {"monthNames":["Janúar","Febrúar","Mars","Apríl","Maí","Júní","Júlí","Ágúst","September","Október","Nóvember","Desember"],"shortMonthNames":["Jan","Feb","Mar","Apr","Maí","Jún","Júl","Ágú","Sep","Okt","Nóv","Des"],"dayNames":["Mánudagur","Þriðjudagur","Miðvikudagur","Fimmtudagur","Föstudagur","Laugardagur","Sunnudagur"],"shortDayNames":["Mán","Þri","Mið","Fim","Fös","Lau","Sun"],"zoomOutText":"Sýna allt"}
AmCharts.translations.it = {"monthNames":["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],"shortMonthNames":["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],"dayNames":["Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato","Domenica"],"shortDayNames":["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],"zoomOutText":"Mostra tutti"}
AmCharts.translations.lt = {"monthNames":["Sausio","Vasario","Kovo","Balandžio","Gegužės","Birželio","Liepos","Rugpjūčio","Rugsėjo","Spalio","Lapkričio","Gruodžio"],"shortMonthNames":["Sau","Vas","Kov","Bal","Geg","Bir","Lie","Rgp","Rgs","Spa","Lap","Grd"],"dayNames":["Pirmadienis","Antradienis","Trečiadienis","Ketvirtadienis","Penktadienis","Šeštadienis","Sekmadienis"],"shortDayNames":["Pr","An","Tr","Kt","Pn","Št","Sk"],"zoomOutText":"Rodyti viską"}
AmCharts.translations.lv = {"monthNames":["Janvāris","Februāris","Marts","Aprīlis","Maijs","Jūnijs","Jūlijs","Augusts","Septembris","Oktobris","Novembris","Decembris"],"shortMonthNames":["Jan","Feb","Mar","Apr","Mai","Jūn","Jūl","Aug","Sep","Okt","Nov","Dec"],"dayNames":["Pirmdiena","Otrdiena","Trešdiena","Ceturtdiena","Piektdiena","Sestdiena","Svētdiena"],"shortDayNames":["P ","O ","T ","C ","Pk","S ","Sv"],"zoomOutText":"Parādīt visu"}
AmCharts.translations.mk = {"monthNames":["Јануари","Февруари","Март","Април","Мај","Јуни","Јули","Август","Септември","Октомври","Ноември","Декември"],"shortMonthNames":["Јан","Фев","Мар","Апр","Мај","Јун","Јул","Авг","Сеп","Окт","Ное","Дек"],"dayNames":["Понеделник","Вторник","Среда","Четврток","Петок","Сабота","Недела"],"shortDayNames":["Пон","Вто","Сре","Чет","Пет","Саб","Нед"],"zoomOutText":"Прикажи ги сите"}
AmCharts.translations.mn = {"monthNames":["Хулгана сарын","Үхэр сарын","Бар сарын","Туулай сарын","Луу сарын","Могой сарын","Морь сарын","Хонь сарын","Бич сарын","Тахиа сарын","Нохой сарын","Гахай сарын"],"shortMonthNames":["Хул","Үхэ","Бар","Туу","Луу","Мог","Мор","Хон","Бич","Тах","Нох","Гах"],"dayNames":["Даваа","Мягмар","Лхагва","Пүрэв","Баасан","Бямба","Ням"],"shortDayNames":["Да","Мя","Лх","Пү","Ба","Бя","Ня"],"zoomOutText":"Бүх харуулах"}
AmCharts.translations.mt = {"monthNames":["Jannar","Frar","Marzu","April","Mejju","Ġunju","Lulju","Awwissu","Settembru","Ottubru","Novembru","Diċembru "],"shortMonthNames":["Jan","Fra","Mar","Apr","Mej","Ġun","Lul","Aww","Set","Ott","Nov","Diċ"],"dayNames":["It-tnejn","It-tlieta","L-erbgħa","Il-ħamis","Il-ġimgħa","Is-sibt","Il-ħadd"],"shortDayNames":["Tne","Tli","Erb","Ħam","Ġim","Sib","Ħad"],"zoomOutText":"Turi kollha"}
AmCharts.translations.nl = {"monthNames":["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],"shortMonthNames":["Jan","Feb","Mrt","Apr","Mei","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],"dayNames":["Maandag","Dinsdag","Woensdag","Donderdag","Vrijdag","Zaterdag","Zondag"],"shortDayNames":["Ma","Di","Wo","Do","Vr","Za","Zo"],"zoomOutText":"Alles weergeven"}
AmCharts.translations.no = {"monthNames":["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],"shortMonthNames":["Jan.","Feb.","Mars","April","Mai","Juni","Juli","Aug.","Sep.","Okt.","Nov.","Des."],"dayNames":["Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag","Søndag"],"shortDayNames":["Ma.","Ti.","On.","To.","Fr.","Lø.","Sø."],"zoomOutText":"Vis alle"}
AmCharts.translations.pl = {"monthNames":["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],"shortMonthNames":["Sty","Lut","Mar","Kwi","Maj","Cze","Lip","Sie","Wrz","Paź","Lis","Gru"],"dayNames":["Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota","Niedziela"],"shortDayNames":["Pon","Wto","Śro","Czw","Pią","Sob","Nie"],"zoomOutText":"Pokaż wszystko"}
AmCharts.translations.pt = {"monthNames":["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],"shortMonthNames":["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],"dayNames":["Segunda","Terça","Quarta","Quinta","Sexta","Sábado","Domingo"],"shortDayNames":["Seg","Ter","Qua","Qui","Sex","Sáb","Dom"],"zoomOutText":"Mostrar todos"}
AmCharts.translations.ro = {"monthNames":["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],"shortMonthNames":["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"],"dayNames":["Luni","Marţi","Miercuri","Joi","Vineri","Sâmbătă","Duminică"],"shortDayNames":["Lu","Ma","Mi","Jo","Vi","Sb","Du"],"zoomOutText":"Arată tot"}
AmCharts.translations.ru = {"monthNames":["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],"shortMonthNames":["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],"dayNames":["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],"shortDayNames":["Пнд","Втр","Срд","Чтв","Птн","Сбт","Вск"],"zoomOutText":"Показать все"}
AmCharts.translations.rw = {"monthNames":["Mutarama","Gashyantare","Werurwe","Mata","Gicuransi","Kamena","Nyakanga","Kanama","Nzeli","Ukwakira","Ugushyingo","Ukuboza"],"shortMonthNames":["Mut","Gas","Wer","Mat","Gic","Kam","Nya","Kan","Nze","Ukw","Ugu","Uku"],"dayNames":["Kuwa mbere","Kuwa kabiri","Kuwa gatatu","Kuwa kane","Kuwa gatanu","Kuwa gatandatu","Ku cyumweru"],"shortDayNames":["Mbe","Kab","Gtu","Kan","Gnu","Gnd","Mwe"],"zoomOutText":"Show all"}
AmCharts.translations.sk = {"monthNames":["Január","Február","Marec","Apríl","Máj","Jún","Júl","August","September","Október","November","December"],"shortMonthNames":["Jan","Feb","Mar","Apr","Máj","Jún","Júl","Aug","Sep","Okt","Nov","Dec"],"dayNames":["Pondelok","Utorok","Streda","Štvrtok","Piatok","Sobota","Nedeľa"],"shortDayNames":["Po","Ut","St","Št","Pi","So","Ne"],"zoomOutText":"Zobraziť všetky"}
AmCharts.translations.so = {"monthNames":["Bisha koobaad","Bisha labaad","Bisha saddexaad","Bisha afraad","Bisha shanaad","Bisha lixaad","Bisha todobaad","Bisha sideedaad","Bisha sagaalaad","Bisha tobnaad","Bisha kow iyo tobnaad","Bisha laba iyo tobnaad"],"shortMonthNames":["Kob","Lab","Sad","Afr","Sha","Lix","Tod","Sid","Sag","Tob","Kit","Lit"],"dayNames":["Isniin","Salaaso","Arbaco","Khamiis","Jimco","Sabti","Axad"],"shortDayNames":["Isn","Sal","Arb","Kha","Jim","Sab","Axa"],"zoomOutText":"Tus dhammaan"}
AmCharts.translations.th = {"monthNames":["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],"shortMonthNames":["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],"dayNames":["จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์","อาทิตย์"],"shortDayNames":["จ.","อ.","พ.","พฤ.","ศ.","ส.","อา."],"zoomOutText":"แสดงทั้งหมด"}
AmCharts.translations.tr = {"monthNames":["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],"shortMonthNames":["Oca","Şub","Mar","Nis","May","Haz","Tem","Ağu","Eyl","Eki","Kas","Ara"],"dayNames":["Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi","Pazar"],"shortDayNames":["Pzt","Sal","Çrş","Prş","Cum","Cts","Paz"],"zoomOutText":"Tümünü göster"}
AmCharts.themes.black = {

	themeName: "black",

	AmChart: {
		color: "#e7e7e7", backgroundColor: "#222222"
	},

	AmCoordinateChart: {
		colors: ["#de4c4f", "#d8854f", "#eea638", "#a7a737", "#86a965", "#8aabb0", "#69c8ff", "#cfd27e", "#9d9888", "#916b8a", "#724887", "#7256bc"]
	},

	AmStockChart: {
		colors: ["#de4c4f", "#d8854f", "#eea638", "#a7a737", "#86a965", "#8aabb0", "#69c8ff", "#cfd27e", "#9d9888", "#916b8a", "#724887", "#7256bc"]
	},

	AmSlicedChart: {
		outlineAlpha: 1,
		outlineThickness: 2,
		labelTickColor: "#FFFFFF",
		labelTickAlpha: 0.3,
		colors: ["#de4c4f", "#d8854f", "#eea638", "#a7a737", "#86a965", "#8aabb0", "#69c8ff", "#cfd27e", "#9d9888", "#916b8a", "#724887", "#7256bc"]
	},

	AmRectangularChart: {
		zoomOutButtonColor: '#FFFFFF',
		zoomOutButtonRollOverAlpha: 0.15,
		zoomOutButtonImage: "lensWhite.png"
	},

	AxisBase: {
		axisColor: "#FFFFFF",
		axisAlpha: 0.3,
		gridAlpha: 0.1,
		gridColor: "#FFFFFF",
		dashLength: 3
	},

	ChartScrollbar: {
		backgroundColor: "#000000",
		backgroundAlpha: 0.2,
		graphFillAlpha: 0.2,
		graphLineAlpha: 0,
		graphFillColor: "#FFFFFF",
		selectedGraphFillColor: "#FFFFFF",
		selectedGraphFillAlpha: 0.4,
		selectedGraphLineColor: "#FFFFFF",
		selectedBackgroundColor: "#FFFFFF",
		selectedBackgroundAlpha: 0.09,
		gridAlpha: 0.15
	},

	ChartCursor: {
		cursorColor: "#FFFFFF",
		color: "#000000",
		cursorAlpha: 0.5
	},

	AmLegend: {
		color: "#e7e7e7"
	},

	AmGraph: {
		lineAlpha: 0.9
	},


	GaugeArrow: {
		color: "#FFFFFF",
		alpha: 0.8,
		nailAlpha: 0,
		innerRadius: "40%",
		nailRadius: 15,
		startWidth: 15,
		borderAlpha: 0.8,
		nailBorderAlpha: 0
	},

	GaugeAxis: {
		tickColor: "#FFFFFF",
		tickAlpha: 1,
		tickLength: 15,
		minorTickLength: 8,
		axisThickness: 3,
		axisColor: '#FFFFFF',
		axisAlpha: 1,
		bandAlpha: 0.8
	},

	TrendLine: {
		lineColor: "#c03246",
		lineAlpha: 0.8
	},

	// ammap
	AreasSettings: {
		alpha: 0.8,
		color: "#FFFFFF",
		colorSolid: "#000000",
		unlistedAreasAlpha: 0.4,
		unlistedAreasColor: "#FFFFFF",
		outlineColor: "#000000",
		outlineAlpha: 0.5,
		outlineThickness: 0.5,
		rollOverColor: "#3c5bdc",
		rollOverOutlineColor: "#000000",
		selectedOutlineColor: "#000000",
		selectedColor: "#f15135",
		unlistedAreasOutlineColor: "#000000",
		unlistedAreasOutlineAlpha: 0.5
	},

	LinesSettings: {
		color: "#FFFFFF",
		alpha: 0.8
	},

	ImagesSettings: {
		alpha: 0.8,
		labelColor: "#FFFFFF",
		color: "#FFFFFF",
		labelRollOverColor: "#3c5bdc"
	},

	ZoomControl: {
		buttonRollOverColor: "#3c5bdc",
		buttonFillColor: "#738f58",
		buttonBorderColor: "#738f58",
		buttonFillAlpha: 0.8,
		gridBackgroundColor: "#FFFFFF",
		buttonBorderAlpha:0,
		buttonCornerRadius:2,
		gridAlpha:0.5,
		gridBackgroundColor:"#FFFFFF",
		homeIconFile:"homeIconWhite.gif",
		buttonIconAlpha:0.6,
		gridAlpha: 0.2,
		buttonSize:20
	},

	SmallMap: {
		mapColor: "#FFFFFF",
		rectangleColor: "#FFFFFF",
		backgroundColor: "#000000",
		backgroundAlpha: 0.7,
		borderThickness: 1,
		borderAlpha: 0.8
	},

	// the defaults below are set using CSS syntax, you can use any existing css property
	// if you don't use Stock chart, you can delete lines below
	PeriodSelector: {
		color: "#e7e7e7"
	},

	PeriodButton: {
		color: "#e7e7e7",
		background: "transparent",
		opacity: 0.7,
		border: "1px solid rgba(255, 255, 255, .15)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		boxSizing: "border-box"
	},

	PeriodButtonSelected: {
		color: "#e7e7e7",
		backgroundColor: "rgba(255, 255, 255, 0.1)",
		border: "1px solid rgba(255, 255, 255, .3)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		opacity: 1,
		boxSizing: "border-box"
	},

	PeriodInputField: {
		color: "#e7e7e7",
		background: "transparent",
		border: "1px solid rgba(255, 255, 255, .15)",
		outline: "none"
	},

	DataSetSelector: {
		color: "#e7e7e7",
		selectedBackgroundColor: "rgba(255, 255, 255, .25)",
		rollOverBackgroundColor: "rgba(255, 255, 255, .15)"
	},

	DataSetCompareList: {
		color: "#e7e7e7",
		lineHeight: "100%",
		boxSizing: "initial",
		webkitBoxSizing: "initial",
		border: "1px solid rgba(255, 255, 255, .15)"
	},

	DataSetSelect: {
		border: "1px solid rgba(255, 255, 255, .15)",
		outline: "none"
	}

};
AmCharts.themes.chalk = {

	themeName: "chalk",

	AmChart: {
		color: "#e7e7e7",
		fontFamily: "Covered By Your Grace",
		fontSize: 18,
		handDrawn: true,
		backgroundColor: "#282828"
	},

	AmCoordinateChart: {
		colors: ["#FFFFFF", "#e384a6", "#f4d499", "#4d90d6", "#c7e38c", "#9986c8", "#edf28c", "#ffd1d4", "#5ee1dc", "#b0eead", "#fef85a", "#8badd2"]
	},

	AmSlicedChart: {
		outlineAlpha: 1,
		labelTickColor: "#FFFFFF",
		labelTickAlpha: 0.3,
		colors: ["#FFFFFF", "#e384a6", "#f4d499", "#4d90d6", "#c7e38c", "#9986c8", "#edf28c", "#ffd1d4", "#5ee1dc", "#b0eead", "#fef85a", "#8badd2"]
	},

	AmStockChart: {
		colors: ["#FFFFFF", "#e384a6", "#f4d499", "#4d90d6", "#c7e38c", "#9986c8", "#edf28c", "#ffd1d4", "#5ee1dc", "#b0eead", "#fef85a", "#8badd2"]
	},

	AmRectangularChart: {

		zoomOutButtonColor: '#FFFFFF',
		zoomOutButtonRollOverAlpha: 0.15,
		zoomOutButtonImage: "lensWhite.png"
	},

	AxisBase: {
		axisColor: "#FFFFFF",
		gridColor: "#FFFFFF"
	},

	ChartScrollbar: {
		backgroundColor: "#FFFFFF",
		backgroundAlpha: 0.2,
		graphFillAlpha: 0.5,
		graphLineAlpha: 0,
		selectedBackgroundColor: "#000000",
		selectedBackgroundAlpha: 0.25,
		fontSize: 15,
		gridAlpha: 0.15
	},

	ChartCursor: {
		cursorColor: "#FFFFFF",
		color: "#000000"
	},

	AmLegend: {
		color: "#e7e7e7",
		markerSize: 20
	},

	AmGraph: {
		lineAlpha: 0.8
	},


	GaugeArrow: {
		color: "#FFFFFF",
		alpha: 0.1,
		nailAlpha: 0,
		innerRadius: "40%",
		nailRadius: 15,
		startWidth: 15,
		borderAlpha: 0.8,
		nailBorderAlpha: 0
	},

	GaugeAxis: {
		tickColor: "#FFFFFF",
		tickAlpha: 0.8,
		tickLength: 15,
		minorTickLength: 8,
		axisThickness: 3,
		axisColor: '#FFFFFF',
		axisAlpha: 0.8,
		bandAlpha: 0.4
	},

	TrendLine: {
		lineColor: "#c03246",
		lineAlpha: 0.8
	},

	// ammap
	AmMap: {
		handDrawn: false
	},

	AreasSettings: {
		alpha: 0.8,
		color: "#FFFFFF",
		colorSolid: "#000000",
		unlistedAreasAlpha: 0.4,
		unlistedAreasColor: "#FFFFFF",
		outlineColor: "#000000",
		outlineAlpha: 0.5,
		outlineThickness: 0.5,
		rollOverColor: "#4d90d6",
		rollOverOutlineColor: "#000000",
		selectedOutlineColor: "#000000",
		selectedColor: "#e384a6",
		unlistedAreasOutlineColor: "#000000",
		unlistedAreasOutlineAlpha: 0.5
	},

	LinesSettings: {
		color: "#FFFFFF",
		alpha: 0.8
	},

	ImagesSettings: {
		alpha: 0.8,
		labelFontSize: 16,
		labelColor: "#FFFFFF",
		color: "#FFFFFF",
		labelRollOverColor: "#4d90d6"
	},

	ZoomControl: {
		buttonRollOverColor: "#4d90d6",
		buttonFillColor: "#e384a6",
		buttonFillAlpha: 0.8,
		buttonBorderColor: "#FFFFFF",
		gridBackgroundColor: "#FFFFFF",
		gridAlpha: 0.8
	},

	SmallMap: {
		mapColor: "#FFFFFF",
		rectangleColor: "#FFFFFF",
		backgroundColor: "#000000",
		backgroundAlpha: 0.7,
		borderThickness: 1,
		borderAlpha: 0.8
	},


	// the defaults below are set using CSS syntax, you can use any existing css property
	// if you don't use Stock chart, you can delete lines below
	PeriodSelector: {
		fontFamily: "Covered By Your Grace",
		fontSize:"16px",
		color: "#e7e7e7"
	},

	PeriodButton: {
		fontFamily: "Covered By Your Grace",
		fontSize:"16px",
		color: "#e7e7e7",
		background: "transparent",
		opacity: 0.7,
		border: "1px solid rgba(255, 255, 255, .15)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		boxSizing: "border-box"
	},

	PeriodButtonSelected: {
		fontFamily: "Covered By Your Grace",
		fontSize:"16px",
		color: "#e7e7e7",
		backgroundColor: "rgba(255, 255, 255, 0.1)",
		border: "1px solid rgba(255, 255, 255, .3)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		opacity: 1,
		boxSizing: "border-box"
	},

	PeriodInputField: {
		fontFamily: "Covered By Your Grace",
		fontSize:"16px",
		color: "#e7e7e7",
		background: "transparent",
		border: "1px solid rgba(255, 255, 255, .15)",
		outline: "none"
	},

	DataSetSelector: {
		fontFamily: "Covered By Your Grace",
		fontSize:"16px",
		color: "#e7e7e7",
		selectedBackgroundColor: "rgba(255, 255, 255, .25)",
		rollOverBackgroundColor: "rgba(255, 255, 255, .15)"
	},

	DataSetCompareList: {
		fontFamily: "Covered By Your Grace",
		fontSize:"16px",
		color: "#e7e7e7",
		lineHeight: "100%",
		boxSizing: "initial",
		webkitBoxSizing: "initial",
		border: "1px solid rgba(255, 255, 255, .15)"
	},

	DataSetSelect: {
		fontFamily: "Covered By Your Grace",
		fontSize:"16px",
		border: "1px solid rgba(255, 255, 255, .15)",
		outline: "none"
	}

};
AmCharts.themes.dark = {

	themeName: "dark",

	AmChart: {
		color: "#e7e7e7", backgroundColor: "#282828"
	},

	AmCoordinateChart: {
		colors: ["#ae85c9", "#aab9f7", "#b6d2ff", "#c9e6f2", "#c9f0e1", "#e8d685", "#e0ad63", "#d48652", "#d27362", "#495fba", "#7a629b", "#8881cc"]
	},

	AmStockChart: {
		colors: ["#639dbd", "#e8d685", "#ae85c9", "#c9f0e1", "#d48652", "#629b6d", "#719dc3", "#719dc3"]
	},

	AmSlicedChart: {
		outlineAlpha: 1,
		outlineThickness: 2,
		labelTickColor: "#FFFFFF",
		labelTickAlpha: 0.3,
		colors: ["#495fba", "#e8d685", "#ae85c9", "#c9f0e1", "#d48652", "#629b6d", "#719dc3", "#719dc3"]
	},

	AmRectangularChart: {
		zoomOutButtonColor: '#FFFFFF',
		zoomOutButtonRollOverAlpha: 0.15,
		zoomOutButtonImage: "lensWhite.png"
	},

	AxisBase: {
		axisColor: "#FFFFFF",
		axisAlpha: 0.3,
		gridAlpha: 0.1,
		gridColor: "#FFFFFF",
		dashLength: 3
	},

	ChartScrollbar: {
		backgroundColor: "#000000",
		backgroundAlpha: 0.2,
		graphFillAlpha: 0.2,
		graphLineAlpha: 0,
		graphFillColor: "#FFFFFF",
		selectedGraphFillColor: "#FFFFFF",
		selectedGraphFillAlpha: 0.4,
		selectedGraphLineColor: "#FFFFFF",
		selectedBackgroundColor: "#FFFFFF",
		selectedBackgroundAlpha: 0.09,
		gridAlpha: 0.15
	},

	ChartCursor: {
		cursorColor: "#FFFFFF",
		color: "#000000",
		cursorAlpha: 0.5
	},

	AmLegend: {
		color: "#e7e7e7"
	},

	AmGraph: {
		lineAlpha: 0.9
	},


	GaugeArrow: {
		color: "#FFFFFF",
		alpha: 0.8,
		nailAlpha: 0,
		innerRadius: "40%",
		nailRadius: 15,
		startWidth: 15,
		borderAlpha: 0.8,
		nailBorderAlpha: 0
	},

	GaugeAxis: {
		tickColor: "#FFFFFF",
		tickAlpha: 1,
		tickLength: 15,
		minorTickLength: 8,
		axisThickness: 3,
		axisColor: '#FFFFFF',
		axisAlpha: 1,
		bandAlpha: 0.8
	},

	TrendLine: {
		lineColor: "#c03246",
		lineAlpha: 0.8
	},

	// ammap
	AreasSettings: {
		alpha: 0.8,
		color: "#FFFFFF",
		colorSolid: "#000000",
		unlistedAreasAlpha: 0.4,
		unlistedAreasColor: "#FFFFFF",
		outlineColor: "#000000",
		outlineAlpha: 0.5,
		outlineThickness: 0.5,
		rollOverColor: "#3c5bdc",
		rollOverOutlineColor: "#000000",
		selectedOutlineColor: "#000000",
		selectedColor: "#f15135",
		unlistedAreasOutlineColor: "#000000",
		unlistedAreasOutlineAlpha: 0.5
	},

	LinesSettings: {
		color: "#FFFFFF",
		alpha: 0.8
	},

	ImagesSettings: {
		alpha: 0.8,
		labelColor: "#FFFFFF",
		color: "#FFFFFF",
		labelRollOverColor: "#3c5bdc"
	},

	ZoomControl: {
		buttonRollOverColor: "#3c5bdc",
		buttonFillColor: "#f15135",
		buttonFillAlpha: 0.8,
		gridBackgroundColor: "#FFFFFF",
		buttonBorderAlpha:0,
		buttonCornerRadius:2,
		gridAlpha:0.5,
		gridBackgroundColor:"#FFFFFF",
		homeIconFile:"homeIconWhite.gif",
		buttonIconAlpha:0.6,
		gridAlpha: 0.2,
		buttonSize:20
	},

	SmallMap: {
		mapColor: "#FFFFFF",
		rectangleColor: "#FFFFFF",
		backgroundColor: "#000000",
		backgroundAlpha: 0.7,
		borderThickness: 1,
		borderAlpha: 0.8
	},

	// the defaults below are set using CSS syntax, you can use any existing css property
	// if you don't use Stock chart, you can delete lines below
	PeriodSelector: {
		color: "#e7e7e7"
	},

	PeriodButton: {
		color: "#e7e7e7",
		background: "transparent",
		opacity: 0.7,
		border: "1px solid rgba(255, 255, 255, .15)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		boxSizing: "border-box"
	},

	PeriodButtonSelected: {
		color: "#e7e7e7",
		backgroundColor: "rgba(255, 255, 255, 0.1)",
		border: "1px solid rgba(255, 255, 255, .3)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		opacity: 1,
		boxSizing: "border-box"
	},

	PeriodInputField: {
		color: "#e7e7e7",
		background: "transparent",
		border: "1px solid rgba(255, 255, 255, .15)",
		outline: "none"
	},

	DataSetSelector: {
		color: "#e7e7e7",
		selectedBackgroundColor: "rgba(255, 255, 255, .25)",
		rollOverBackgroundColor: "rgba(255, 255, 255, .15)"
	},

	DataSetCompareList: {
		color: "#e7e7e7",
		lineHeight: "100%",
		boxSizing: "initial",
		webkitBoxSizing: "initial",
		border: "1px solid rgba(255, 255, 255, .15)"
	},

	DataSetSelect: {
		border: "1px solid rgba(255, 255, 255, .15)",
		outline: "none"
	}

};
AmCharts.themes.light = {

	themeName:"light",

	AmChart: {
		color: "#000000", backgroundColor: "#FFFFFF"
	},

	AmCoordinateChart: {
		colors: ["#67b7dc", "#fdd400", "#84b761", "#cc4748", "#cd82ad", "#2f4074", "#448e4d", "#b7b83f", "#b9783f", "#b93e3d", "#913167"]
	},

	AmStockChart: {
		colors: ["#67b7dc", "#fdd400", "#84b761", "#cc4748", "#cd82ad", "#2f4074", "#448e4d", "#b7b83f", "#b9783f", "#b93e3d", "#913167"]
	},

	AmSlicedChart: {
		colors: ["#67b7dc", "#fdd400", "#84b761", "#cc4748", "#cd82ad", "#2f4074", "#448e4d", "#b7b83f", "#b9783f", "#b93e3d", "#913167"],
		outlineAlpha: 1,
		outlineThickness: 2,
		labelTickColor: "#000000",
		labelTickAlpha: 0.3
	},

	AmRectangularChart: {
		zoomOutButtonColor: '#000000',
		zoomOutButtonRollOverAlpha: 0.15,
		zoomOutButtonImage: "lens.png"
	},

	AxisBase: {
		axisColor: "#000000",
		axisAlpha: 0.3,
		gridAlpha: 0.1,
		gridColor: "#000000"
	},

	ChartScrollbar: {
		backgroundColor: "#000000",
		backgroundAlpha: 0.12,
		graphFillAlpha: 0.5,
		graphLineAlpha: 0,
		selectedBackgroundColor: "#FFFFFF",
		selectedBackgroundAlpha: 0.4,
		gridAlpha: 0.15
	},

	ChartCursor: {
		cursorColor: "#000000",
		color: "#FFFFFF",
		cursorAlpha: 0.5
	},

	AmLegend: {
		color: "#000000"
	},

	AmGraph: {
		lineAlpha: 0.9
	},
	GaugeArrow: {
		color: "#000000",
		alpha: 0.8,
		nailAlpha: 0,
		innerRadius: "40%",
		nailRadius: 15,
		startWidth: 15,
		borderAlpha: 0.8,
		nailBorderAlpha: 0
	},

	GaugeAxis: {
		tickColor: "#000000",
		tickAlpha: 1,
		tickLength: 15,
		minorTickLength: 8,
		axisThickness: 3,
		axisColor: '#000000',
		axisAlpha: 1,
		bandAlpha: 0.8
	},

	TrendLine: {
		lineColor: "#c03246",
		lineAlpha: 0.8
	},

	// ammap
	AreasSettings: {
		alpha: 0.8,
		color: "#67b7dc",
		colorSolid: "#003767",
		unlistedAreasAlpha: 0.4,
		unlistedAreasColor: "#000000",
		outlineColor: "#FFFFFF",
		outlineAlpha: 0.5,
		outlineThickness: 0.5,
		rollOverColor: "#3c5bdc",
		rollOverOutlineColor: "#FFFFFF",
		selectedOutlineColor: "#FFFFFF",
		selectedColor: "#f15135",
		unlistedAreasOutlineColor: "#FFFFFF",
		unlistedAreasOutlineAlpha: 0.5
	},

	LinesSettings: {
		color: "#000000",
		alpha: 0.8
	},

	ImagesSettings: {
		alpha: 0.8,
		labelColor: "#000000",
		color: "#000000",
		labelRollOverColor: "#3c5bdc"
	},

	ZoomControl: {
		buttonRollOverColor: "#3c5bdc",
		buttonFillColor: "#3994e2",
		buttonBorderColor: "#3994e2",
		buttonFillAlpha: 0.8,
		gridBackgroundColor: "#FFFFFF",
		buttonBorderAlpha:0,
		buttonCornerRadius:2,
		gridColor:"#FFFFFF",
		gridBackgroundColor:"#000000",
		buttonIconAlpha:0.6,
		gridAlpha: 0.6,
		buttonSize:20
	},

	SmallMap: {
		mapColor: "#000000",
		rectangleColor: "#f15135",
		backgroundColor: "#FFFFFF",
		backgroundAlpha: 0.7,
		borderThickness: 1,
		borderAlpha: 0.8
	},

	// the defaults below are set using CSS syntax, you can use any existing css property
	// if you don't use Stock chart, you can delete lines below
	PeriodSelector: {
		color: "#000000"
	},

	PeriodButton: {
		color: "#000000",
		background: "transparent",
		opacity: 0.7,
		border: "1px solid rgba(0, 0, 0, .3)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		boxSizing: "border-box"
	},

	PeriodButtonSelected: {
		color: "#000000",
		backgroundColor: "#b9cdf5",
		border: "1px solid rgba(0, 0, 0, .3)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		opacity: 1,
		boxSizing: "border-box"
	},

	PeriodInputField: {
		color: "#000000",
		background: "transparent",
		border: "1px solid rgba(0, 0, 0, .3)",
		outline: "none"
	},

	DataSetSelector: {

		color: "#000000",
		selectedBackgroundColor: "#b9cdf5",
		rollOverBackgroundColor: "#a8b0e4"
	},

	DataSetCompareList: {
		color: "#000000",
		lineHeight: "100%",
		boxSizing: "initial",
		webkitBoxSizing: "initial",
		border: "1px solid rgba(0, 0, 0, .3)"
	},

	DataSetSelect: {
		border: "1px solid rgba(0, 0, 0, .3)",
		outline: "none"
	}

};
AmCharts.themes.patterns = {

	themeName:"patterns",

	AmChart: {
		color: "#000000", backgroundColor: "#FFFFFF"
	},

	AmCoordinateChart: {
		colors:["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],
		patterns:[
		{"url":"../amcharts/patterns/black/pattern1.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern2.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern3.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern4.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern5.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern6.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern7.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern8.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern9.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern10.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern11.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern12.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern13.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern14.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern15.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern16.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern17.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern18.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern19.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern20.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern21.png", "width":4, "height":4}]
	},


	AmStockChart: {
		colors:["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"]
	},

	AmPieChart: {
		depth3D:0,
		angle:0,
		labelRadius:10
	},

	AmSlicedChart: {
		outlineAlpha: 0.3,
		colors:["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],
		outlineThickness: 1,
		outlineColor:"#000000",
		labelTickColor: "#000000",
		labelTickAlpha: 0.3,
		patterns:[
		{"url":"../amcharts/patterns/black/pattern1.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern2.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern3.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern4.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern5.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern6.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern7.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern8.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern9.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern10.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern11.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern12.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern13.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern14.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern15.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern16.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern17.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern18.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern19.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern20.png", "width":4, "height":4},
		{"url":"../amcharts/patterns/black/pattern21.png", "width":4, "height":4}]
	},

	AmRectangularChart: {
		zoomOutButtonColor: '#000000',
		zoomOutButtonRollOverAlpha: 0.15,
		zoomOutButtonImage: "lens.png"
	},



	AxisBase: {
		axisColor: "#000000",
		axisAlpha: 0.3,
		gridAlpha: 0.05,
		gridColor: "#000000"
	},

	ChartScrollbar: {
		backgroundColor: "#000000",
		backgroundAlpha: 0.13,
		graphFillAlpha: 0.4,
		selectedGraphFillAlpha: 0.7,
		graphLineAlpha: 0,
		selectedBackgroundColor: "#FFFFFF",
		selectedBackgroundAlpha: 0.9,
		gridAlpha: 0.15
	},

	ChartCursor: {
		cursorColor: "#000000",
		color: "#FFFFFF",
		cursorAlpha: 0.5
	},

	AmLegend: {
		color: "#000000",
		markerBorderAlpha:0.1,
		markerSize:20,
		switchColor:"#000000"
	},

	AmGraph: {
		lineAlpha: 0.4,
		fillAlphas:0.5
	},

	AmAngularGauge:{
		faceAlpha:0.5,
		facePattern:{"url":"../amcharts/patterns/black/pattern1.png", "width":4, "height":4}
	},


	GaugeArrow: {
		color: "#000000",
		alpha: 1,
		nailAlpha: 1,
		innerRadius: "0%",
		nailRadius: 15,
		startWidth: 15,
		borderAlpha: 1,
		radius:"70%",
		nailBorderAlpha: 1
	},

	GaugeAxis: {
		tickColor: "#000000",
		tickAlpha: 1,
		tickLength: 15,
		minorTickLength: 8,
		axisThickness: 1,
		axisColor: '#000000',
		axisAlpha: 1,
		bandAlpha: 1
	},

	TrendLine: {
		lineColor: "#c03246",
		lineAlpha: 0.8
	},

	// ammap
	AreasSettings: {
		alpha: 0.8,
		color: "#000000",
		colorSolid: "#000000",
		unlistedAreasAlpha: 0.4,
		unlistedAreasColor: "#000000",
		outlineColor: "#FFFFFF",
		outlineAlpha: 0.5,
		outlineThickness: 0.5,
		rollOverColor: "#3c5bdc",
		rollOverOutlineColor: "#FFFFFF",
		selectedOutlineColor: "#FFFFFF",
		selectedColor: "#f15135",
		unlistedAreasOutlineColor: "#FFFFFF",
		unlistedAreasOutlineAlpha: 0.5
	},

	LinesSettings: {
		color: "#000000",
		alpha: 0.8
	},

	ImagesSettings: {
		alpha: 0.8,
		labelColor: "#000000",
		color: "#000000",
		labelRollOverColor: "#3c5bdc"
	},

	ZoomControl: {
		buttonRollOverColor: "#3c5bdc",
		buttonFillColor: "#f15135",
		buttonFillAlpha: 0.8,
		buttonBorderColor: "#000000",
		gridBackgroundColor: "#000000",
		gridAlpha: 0.8
	},

	SmallMap: {
		mapColor: "#000000",
		rectangleColor: "#FFFFFF",
		backgroundColor: "#FFFFFF",
		backgroundAlpha: 0.7,
		borderThickness: 1,
		borderAlpha: 0.8
	},

	// the defaults below are set using CSS syntax, you can use any existing css property
	// if you don't use Stock chart, you can delete lines below
	PeriodSelector: {
		color: "#000000"
	},

	PeriodButton: {
		color: "#000000",
		background: "transparent",
		opacity: 0.7,
		border: "1px solid rgba(0, 0, 0, .3)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		boxSizing: "border-box"
	},

	PeriodButtonSelected: {
		color: "#000000",
		backgroundColor: "rgba(0, 0, 0, 0.1)",
		border: "1px solid rgba(0, 0, 0, .3)",
		MozBorderRadius: "5px",
		borderRadius: "5px",
		margin: "1px",
		outline: "none",
		opacity: 1,
		boxSizing: "border-box"
	},

	PeriodInputField: {
		color: "#000000",
		background: "transparent",
		border: "1px solid rgba(0, 0, 0, .3)",
		outline: "none"
	},

	DataSetSelector: {
		color: "#000000",
		selectedBackgroundColor: "rgba(0, 0, 0, .25)",
		rollOverBackgroundColor: "rgba(0, 0, 0, .15)"
	},

	DataSetCompareList: {
		color: "#000000",
		lineHeight: "100%",
		boxSizing: "initial",
		webkitBoxSizing: "initial",
		border: "1px solid rgba(0, 0, 0, .3)"
	},

	DataSetSelect: {
		border: "1px solid rgba(0, 0, 0, .3)",
		outline: "none"
	}

};